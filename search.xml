<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>2017-2018年实习工作总结</title>
    <url>/posts/37315/</url>
    <content><![CDATA[<p>这是2017年11月-2018年2月在丁丁当实习时的笔记，当时记录在笔记本上，现在进行迁移到博客中。感谢宾哥，虽然没有实习很长时间，但是学到了很多，从最开始写一个页面需要一天半到两三个小时完成，细节不断优化，代码不断规范，还有充足的自学时间，十分感激。最开始实习的时候以为自己很厉害，其实现在看来真的经验不足，在实习之前都是一个人写根本没有发现自身的问题，仅仅就样式实现了就好，理论知识倒是可以，但是实践经验真的时不足，没有人提点，所以当时看2016年写的前端想重构，现在看2017年写的前端也想重构。</p>
<h4 id="HTML-CSS"><a href="#HTML-CSS" class="headerlink" title="HTML + CSS"></a>HTML + CSS</h4><h5 id="基础知识"><a href="#基础知识" class="headerlink" title="基础知识"></a>基础知识</h5><ul>
<li><p><code>css</code> 顺序执行</p>
</li>
<li><p>内盒尺寸（元素大小）：</p>
<ul>
<li>Element Height: content height + padding + border</li>
<li>Element Width: content width + padding + border</li>
</ul>
</li>
<li><p>外盒尺寸（元素空间尺寸）：</p>
<ul>
<li>Element空间高度: content height + padding + border + margin</li>
<li>Element空间宽度: content width + padding + border + margin</li>
</ul>
</li>
<li><p>子元素设置为绝对定位时，父元素要设置<code>position: relative</code></p>
</li>
<li><p><code>float</code>浮动：float未脱离正常的文档流，参照元素是父级元素</p>
</li>
<li><p>绝对定位：脱离了正常的文档流。</p>
</li>
<li><p>opacity会将文字和背景都设置透明，如果只要背景设置透明需要设置<code>rgba</code>。父元素的<code>filter: blur(50px);</code>会影响到子元素。</p>
</li>
<li><p><code>data-*</code>属性：一般用于数据存放，div元素只有id和class属性，要设置其他属性存值，需要使用h5的自定义属性，<code>css</code>设置样式<code>[data-*] &#123;xxx&#125;</code></p>
</li>
<li><p>图像预装载：提高图像访问速度</p>
</li>
<li><p>css雪碧图：图像合并，将多个小图标和背景图像合并到一张图片上用css定位来显示</p>
</li>
<li><p>响应式布局：目的时为移动设备提供更好的体验，并且整合从桌面到手机的各种屏幕尺寸和分辨率</p>
</li>
<li><p><noscript>元素用来定义在脚本未被执行时的替代内容（文本），此标签可以被用于可识别<script>标签但无法支持其中的脚本的浏览器。</p>
</li>
</ul>
<h5 id="规范-amp-经验"><a href="#规范-amp-经验" class="headerlink" title="规范 &amp; 经验"></a>规范 &amp; 经验</h5><ul>
<li><code>html</code>类名使用顺序要和<code>css</code>定义顺序一致，注意样式复用。</li>
<li><code>div</code>一般要命名类名，不能直接引用子元素</li>
<li>子元素选择器要加上父元素的类名</li>
<li>行内块一般要有最大宽度，多个行内块在一行显示时注意行内块之间的间隙（<code>font-size: 0;</code>），和设置顶部对齐（<code>vertical-align: top;</code>）</li>
<li>叠在一起的元素要用绝对定位，定位<code>left</code>、<code>bottom</code>等，不用浮动</li>
<li>字体一定要设置高度和行高，注意设置超过部分省略</li>
<li>一行的容器一般都会设置最小或最大宽度</li>
<li>移动端边框一般为1<code>px</code>，不用<code>rem</code></li>
<li><code>img</code>图像<code>src</code>地址后加<code>?1</code>表示从服务器请求拖资源不从缓存中读取图片，一般情况下<code>src</code>不变，浏览器会直接读取缓存资源</li>
<li>loading图片展示时间：利用<code>document.ready</code>与<code>window.onload</code>的时间差</li>
<li><i>标签通常用来放图标</li>
<li><code>Array.prototype.slice.call(arguments)</code>能将具有length属性的对象转成数组</li>
<li><code>num.toFixed(2)</code>保留两位小数</li>
</ul>
<h5 id="兼容性"><a href="#兼容性" class="headerlink" title="兼容性"></a>兼容性</h5><ul>
<li><code>pc端</code>尽量减少使用<code>CSS3</code>样式，注意设置样式前缀</li>
<li>多行字体省略，一般PC端都是设置单行字体隐藏，多行时需要<code>js</code>控制字体省略</li>
</ul>
<h4 id="FreeMarker"><a href="#FreeMarker" class="headerlink" title="FreeMarker"></a>FreeMarker</h4><ul>
<li>语法类似EL表达式</li>
<li>数组使用前先判断数组是否存在及size不为0，对象使用前先判断对象是否存在</li>
<li>后端无法给定确切数据时，前端自己判断获取，先将值取出来，使用时要判断值是否存在</li>
<li><code>?c</code>为数字的内建函数，当必须为数字的情况下使用</li>
<li><code>list_index</code>获取<code>list</code>的索引</li>
<li><code>longint</code>转为<code>date/time</code>显示：<code>$&#123;data.startTime?c?number?number_to_datetime?string(&quot;yyyy-MM-dd&quot;)&#125;</code>，time为<code>?string(&quot;HH:mm:ss&quot;)</code></li>
<li>数字的内建函数：floor（向下舍弃），celling（进1法），round（四舍五入）</li>
</ul>
<h4 id="jQuery"><a href="#jQuery" class="headerlink" title="jQuery"></a>jQuery</h4><ul>
<li>siblings(): 遍历同胞</li>
<li>index(): 返回索引位置，若未找到元素返回-1</li>
</ul>
<h5 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h5><ul>
<li><p>移动端适配</p>
</li>
<li><p>css动画和js动画应用场景</p>
<ul>
<li>css动画：一般做简单的元素操作，如简单的平移或旋转，放大缩小</li>
<li>js动画：一般复杂的动画是由js完成，比如特定移动到某个位置或者碰撞效果等</li>
</ul>
</li>
<li><p><code>this</code>的作用域</p>
<ul>
<li><p>全局的函数调用</p>
<p>全局的函数中的<code>this</code>指的是<code>window</code></p>
</li>
<li><p>对象方法的调用</p>
<p><code>this</code>指上一级对象，即调用方法的对象</p>
</li>
<li><p>构造函数的调用</p>
<p>构造函数中的<code>this</code>指向新创建的对象本身</p>
</li>
</ul>
</li>
</ul>
]]></content>
      <categories>
        <category>总结</category>
        <category>工作</category>
      </categories>
      <tags>
        <tag>前端</tag>
        <tag>HTML</tag>
        <tag>CSS</tag>
        <tag>FreeMarker</tag>
        <tag>jQuery</tag>
        <tag>工作</tag>
      </tags>
  </entry>
  <entry>
    <title>20191031技术分享总结</title>
    <url>/posts/19020/</url>
    <content><![CDATA[<h4 id="代码review"><a href="#代码review" class="headerlink" title="代码review"></a>代码review</h4><h5 id="原代码问题："><a href="#原代码问题：" class="headerlink" title="原代码问题："></a>原代码问题：</h5><ol>
<li>动画过于僵硬，当两条消息间隔时间过短时会省略进入动画</li>
<li>动画间隔过短会给人同时消失和同时出现的错觉</li>
<li>如果1秒内有100条消息进入，会造成显示时间过长、阻塞</li>
</ol>
<h5 id="优化建议："><a href="#优化建议：" class="headerlink" title="优化建议："></a>优化建议：</h5><ol>
<li>设置消息进入的最短间隔或固定间隔，给消息进入动画展示时间</li>
<li>根据等待队列的长度动态设置消息展示时间</li>
</ol>
<h4 id="KOA入门"><a href="#KOA入门" class="headerlink" title="KOA入门"></a>KOA入门</h4><h5 id="补充部分："><a href="#补充部分：" class="headerlink" title="补充部分："></a>补充部分：</h5><ol>
<li><code>eventproxy</code>控制并发</li>
<li><code>koa</code>框架自动生成项目结构插件<code>koa-generator</code></li>
<li>并发模型与事件循环：<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/EventLoop">https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/EventLoop</a></li>
</ol>
<h4 id="技巧总结"><a href="#技巧总结" class="headerlink" title="技巧总结"></a>技巧总结</h4><ol>
<li>加强与其他人的互动，避免枯燥的文字照读，最好搭配示例讲解。</li>
<li>代码review部分可以先看效果，再看代码结构逻辑，最好先抛出问题，引导问题方向，把握时间。</li>
<li>技术分享部分，需要提前一周预告给其他人充分了解的时间，不然，分享的时候其他人容易云里雾里。重要概念最好结合示例讲解能更加容易理解。</li>
</ol>
]]></content>
      <categories>
        <category>总结</category>
      </categories>
      <tags>
        <tag>总结</tag>
      </tags>
  </entry>
  <entry>
    <title>2020年工作总结</title>
    <url>/posts/61373/</url>
    <content><![CDATA[<h3 id="小程序"><a href="#小程序" class="headerlink" title="小程序"></a>小程序</h3><p>我的小程序常见bug就是code失效的问题，做法是code使用过后重新生成新的code，其实就是刷新sessionKey，所以后端维护session就变得很难，因此就直接传入code就好了。但是新生成的code容易失效（大概3分钟左右），在使用之前就已失效，所以是我的常见bug。</p>
<h4 id="大亲家红娘系列"><a href="#大亲家红娘系列" class="headerlink" title="大亲家红娘系列"></a>大亲家红娘系列</h4><p>很简单的一系列小程序</p>
<h4 id="三分钟约会"><a href="#三分钟约会" class="headerlink" title="三分钟约会"></a>三分钟约会</h4><p>主要功能：实现在线匹配和在线实时聊天，以及聊天倒计时和结束时状态判断。</p>
<p>难点：IOS和Android的息屏和亮屏状态不一致，对于websocket连接需要进行区别处理，以及匹配动画和聊天。</p>
<p>总结在另外一篇：<a href="https://datura35422.github.io/2020/06/16/%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E8%B8%A9%E5%9D%91%E8%AE%B0-1/">微信小程序踩坑记-1</a></p>
<h4 id="朋友星球"><a href="#朋友星球" class="headerlink" title="朋友星球"></a>朋友星球</h4><p>主要功能：实现六角星的动画效果。</p>
<p>难点：需要头像点击，感觉没有什么好的想法，就只有CSS3样式 + JS控制了。</p>
<p>优化思想：海报生成一次之后就缓存起来，然后点击再次生成的时候就可以用之前生成过的了。但是根据需求来。将两个海报生成函数封装起来了，每次根据参数的不同而生成不同的海报效果。</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> wepy <span class="token keyword">from</span> <span class="token string">'@wepy/core'</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> mapGetters <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'@wepy/x'</span>
<span class="token keyword">import</span> store <span class="token keyword">from</span> <span class="token string">'../store'</span>
<span class="token keyword">import</span> apis <span class="token keyword">from</span> <span class="token string">'../utils/apis'</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> showToast<span class="token punctuation">,</span> timeout2Promise <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'../utils/util'</span>

<span class="token keyword">const</span> <span class="token constant">POSITIONS</span> <span class="token operator">=</span> <span class="token punctuation">[</span> <span class="token string">'topRight'</span><span class="token punctuation">,</span> <span class="token string">'topLeft'</span><span class="token punctuation">,</span> <span class="token string">'centerLeft'</span><span class="token punctuation">,</span> <span class="token string">'bottomLeft'</span><span class="token punctuation">,</span> <span class="token string">'bottomRight'</span> <span class="token punctuation">]</span>

wepy<span class="token punctuation">.</span><span class="token function">component</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
  store<span class="token punctuation">,</span>
  <span class="token literal-property property">props</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token literal-property property">userInfo</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
      <span class="token literal-property property">type</span><span class="token operator">:</span> Object<span class="token punctuation">,</span>
      <span class="token literal-property property">required</span><span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token literal-property property">totalPages</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token literal-property property">page</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token literal-property property">isInit</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// 避免每次修改userinfo触发获取朋友列表</span>
    <span class="token literal-property property">members</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token literal-property property">friends</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">allSmallFriends</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">smallFriends</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">clickFriend</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
    <span class="token literal-property property">lineTransition</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
    <span class="token literal-property property">hexagonSmallPosition</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">friendChangeTransform</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
    <span class="token literal-property property">friendChangeImgStyle</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
    <span class="token literal-property property">friendStyle</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">centerAvatar</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
    <span class="token literal-property property">showCircleAni</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token literal-property property">showInviteTip</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token literal-property property">inviteTipAni</span><span class="token operator">:</span> <span class="token string">'fade-in'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">showSmallFriend</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token literal-property property">smallMyPos</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>

    <span class="token literal-property property">clicking</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token comment">// 记录点击状态</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">computed</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token operator">...</span><span class="token function">mapGetters</span><span class="token punctuation">(</span><span class="token punctuation">[</span> <span class="token string">'appId'</span> <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">watch</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token function">userInfo</span><span class="token punctuation">(</span><span class="token parameter">newVal</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>newVal<span class="token punctuation">.</span>is_has_union_id <span class="token operator">===</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token operator">!</span>newVal<span class="token punctuation">.</span>wx_avatar_url<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>isInit<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>isInit <span class="token operator">=</span> <span class="token boolean">true</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>centerAvatar <span class="token operator">=</span> newVal<span class="token punctuation">.</span>wx_avatar_url
          <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getGroupFriends</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span>
      <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token function">created</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">initSmallPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">methods</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token function">initSmallPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>showCircleAni <span class="token operator">=</span> <span class="token boolean">false</span> <span class="token comment">// 隐藏中心背景动效</span>

      <span class="token keyword">const</span> y1 <span class="token operator">=</span> <span class="token number">246</span>
      <span class="token keyword">const</span> y2 <span class="token operator">=</span> <span class="token number">300</span>
      <span class="token keyword">const</span> x1 <span class="token operator">=</span> <span class="token number">216</span>
      <span class="token keyword">const</span> x2 <span class="token operator">=</span> <span class="token number">176</span>
      <span class="token keyword">const</span> x3 <span class="token operator">=</span> <span class="token number">106</span>
      <span class="token keyword">const</span> smallPosition <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
      smallPosition<span class="token punctuation">.</span>topRight <span class="token operator">=</span> <span class="token punctuation">[</span>
        <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">transform: translate(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>x1<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">rpx, -</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>y1<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">rpx)</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
        <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">transform: translate(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>x2<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">rpx, -</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>y2<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">rpx)</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
        <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">transform: translate(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>x3<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">rpx, -</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>y2<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">rpx)</span><span class="token template-punctuation string">`</span></span>
      <span class="token punctuation">]</span>
      smallPosition<span class="token punctuation">.</span>topLeft <span class="token operator">=</span> <span class="token punctuation">[</span>
        <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">transform: translate(-</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>x3<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">rpx, -</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>y2<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">rpx)</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
        <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">transform: translate(-</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>x2<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">rpx, -</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>y2<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">rpx)</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
        <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">transform: translate(-</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>x1<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">rpx, -</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>y1<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">rpx)</span><span class="token template-punctuation string">`</span></span>
      <span class="token punctuation">]</span>
      smallPosition<span class="token punctuation">.</span>centerLeft <span class="token operator">=</span> <span class="token punctuation">[</span>
        <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">transform: translate(-320rpx, -60rpx)</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
        <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">transform: translate(-350rpx)</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
        <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">transform: translate(-320rpx, 60rpx)</span><span class="token template-punctuation string">`</span></span>
      <span class="token punctuation">]</span>
      smallPosition<span class="token punctuation">.</span>centerRight <span class="token operator">=</span> <span class="token punctuation">[</span>
        <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">transform: translate(320rpx, -60rpx)</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
        <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">transform: translate(350rpx)</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
        <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">transform: translate(320rpx, 60rpx)</span><span class="token template-punctuation string">`</span></span>
      <span class="token punctuation">]</span>
      smallPosition<span class="token punctuation">.</span>bottomRight <span class="token operator">=</span> <span class="token punctuation">[</span>
        <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">transform: translate(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>x3<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">rpx, </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>y2<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">rpx)</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
        <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">transform: translate(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>x1<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">rpx, </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>y1<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">rpx)</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
        <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">transform: translate(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>x2<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">rpx, </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>y2<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">rpx)</span><span class="token template-punctuation string">`</span></span>
      <span class="token punctuation">]</span>
      smallPosition<span class="token punctuation">.</span>bottomLeft <span class="token operator">=</span> <span class="token punctuation">[</span>
        <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">transform: translate(-</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>x1<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">rpx, </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>y1<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">rpx)</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
        <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">transform: translate(-</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>x2<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">rpx, </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>y2<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">rpx)</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
        <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">transform: translate(-</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>x3<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">rpx, </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>y2<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">rpx)</span><span class="token template-punctuation string">`</span></span>
      <span class="token punctuation">]</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>hexagonSmallPosition <span class="token operator">=</span> smallPosition
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token function">getGroupFriends</span><span class="token punctuation">(</span><span class="token parameter">page <span class="token operator">=</span> <span class="token number">1</span></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      apis<span class="token punctuation">.</span><span class="token function">getGroupFriends</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
        page
      <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> total<span class="token punctuation">,</span> members <span class="token punctuation">&#125;</span> <span class="token operator">=</span> res<span class="token punctuation">.</span>data
        <span class="token keyword">this</span><span class="token punctuation">.</span>page <span class="token operator">=</span> page
        <span class="token keyword">this</span><span class="token punctuation">.</span>totalPages <span class="token operator">=</span> total
        <span class="token keyword">let</span> friends <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
        <span class="token keyword">let</span> smallFriends <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> len <span class="token operator">=</span> members<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> len<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
          friends<span class="token punctuation">[</span><span class="token constant">POSITIONS</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> members<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>member_avatar_url
          smallFriends<span class="token punctuation">[</span><span class="token constant">POSITIONS</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> members<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>members<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>page <span class="token operator">&lt;</span> total <span class="token operator">||</span> total <span class="token operator">></span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">// 显示换一批</span>
          friends<span class="token punctuation">.</span>bottomRight <span class="token operator">=</span> <span class="token string">'nextPage'</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>members <span class="token operator">=</span> members
        <span class="token keyword">this</span><span class="token punctuation">.</span>friends <span class="token operator">=</span> friends
        <span class="token keyword">this</span><span class="token punctuation">.</span>allSmallFriends <span class="token operator">=</span> smallFriends
        <span class="token keyword">this</span><span class="token punctuation">.</span>smallFriends <span class="token operator">=</span> smallFriends
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span><span class="token string">'load'</span><span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>clicking <span class="token operator">=</span> <span class="token boolean">false</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>clicking <span class="token operator">=</span> <span class="token boolean">false</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token function">onNextPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>clicking<span class="token punctuation">)</span> <span class="token keyword">return</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>page <span class="token operator">&lt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>totalPages<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getGroupFriends</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>page <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>
      <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
        <span class="token function">showToast</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
          <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">'已无更多单身团成员，请邀请单身好友加入'</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getGroupFriends</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
      <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token function">onClickSmallImg</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>showSmallFriend<span class="token punctuation">)</span> <span class="token keyword">return</span> 
      <span class="token function">showToast</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
        <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">'直接联系朋友的朋友的功能暂未开放'</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token function">onClickFriendImg</span><span class="token punctuation">(</span><span class="token parameter">pos</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>clicking<span class="token punctuation">)</span> <span class="token keyword">return</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>clicking <span class="token operator">=</span> <span class="token boolean">true</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>showSmallFriend<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>pos <span class="token operator">===</span> <span class="token keyword">this</span><span class="token punctuation">.</span>smallMyPos<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
          <span class="token comment">// 在朋友的朋友状态下 点击我的头像</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">showChangeAnimation</span><span class="token punctuation">(</span>pos<span class="token punctuation">,</span> <span class="token string">'my'</span><span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
          <span class="token function">showToast</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
            <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">'直接联系朋友的朋友的功能暂未开放'</span>
          <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>clicking <span class="token operator">=</span> <span class="token boolean">false</span>
          <span class="token keyword">return</span>
        <span class="token punctuation">&#125;</span>
      <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>inviteTipAni <span class="token operator">=</span> <span class="token string">'fade-out'</span>
        <span class="token function">timeout2Promise</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>showInviteTip <span class="token operator">=</span> <span class="token boolean">false</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">showChangeAnimation</span><span class="token punctuation">(</span>pos<span class="token punctuation">,</span> <span class="token string">'friend'</span><span class="token punctuation">)</span>
      <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token function">showChangeAnimation</span><span class="token punctuation">(</span><span class="token parameter">pos<span class="token punctuation">,</span> type</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>clickFriend <span class="token operator">=</span> pos
      <span class="token keyword">const</span> index <span class="token operator">=</span> <span class="token constant">POSITIONS</span><span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>pos<span class="token punctuation">)</span>
      <span class="token function">timeout2Promise</span><span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// 收缩虚线</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>lineTransition <span class="token operator">=</span> <span class="token string">'line-shrink'</span>
        <span class="token keyword">return</span> <span class="token function">timeout2Promise</span><span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">)</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">hideSmallPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token function">timeout2Promise</span><span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">)</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">changeCenterImg</span><span class="token punctuation">(</span>pos<span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token function">timeout2Promise</span><span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">)</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// 收缩朋友图片</span>
        <span class="token keyword">const</span> style <span class="token operator">=</span> <span class="token string">'transform: translate(0, 0)'</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>friendStyle <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
          <span class="token literal-property property">centerRight</span><span class="token operator">:</span> style<span class="token punctuation">,</span>
          <span class="token literal-property property">topRight</span><span class="token operator">:</span> style<span class="token punctuation">,</span>
          <span class="token literal-property property">topLeft</span><span class="token operator">:</span> style<span class="token punctuation">,</span>
          <span class="token literal-property property">centerLeft</span><span class="token operator">:</span> style<span class="token punctuation">,</span>
          <span class="token literal-property property">bottomLeft</span><span class="token operator">:</span> style<span class="token punctuation">,</span>
          <span class="token literal-property property">bottomRight</span><span class="token operator">:</span> style
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">return</span> <span class="token function">timeout2Promise</span><span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">)</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">handleChangeAnimate</span><span class="token punctuation">(</span>type<span class="token punctuation">,</span> index<span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token function">timeout2Promise</span><span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">)</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// 放射虚线</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>lineTransition <span class="token operator">=</span> <span class="token string">''</span>
        <span class="token keyword">return</span> <span class="token function">timeout2Promise</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">)</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>friendStyle <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
          <span class="token literal-property property">centerRight</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
          <span class="token literal-property property">topRight</span><span class="token operator">:</span> <span class="token string">'transition-delay: 50ms'</span><span class="token punctuation">,</span>
          <span class="token literal-property property">topLeft</span><span class="token operator">:</span> <span class="token string">'transition-delay: 100ms'</span><span class="token punctuation">,</span>
          <span class="token literal-property property">centerLeft</span><span class="token operator">:</span> <span class="token string">'transition-delay: 150ms'</span><span class="token punctuation">,</span>
          <span class="token literal-property property">bottomLeft</span><span class="token operator">:</span> <span class="token string">'transition-delay: 200ms'</span><span class="token punctuation">,</span>
          <span class="token literal-property property">bottomRight</span><span class="token operator">:</span> <span class="token string">'transition-delay: 250ms'</span><span class="token punctuation">,</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>type <span class="token operator">===</span> <span class="token string">'my'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>smallFriends <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>allSmallFriends
          <span class="token function">timeout2Promise</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">initSmallPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token function">timeout2Promise</span><span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">)</span>
          <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>inviteTipAni <span class="token operator">=</span> <span class="token string">'fade-in'</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>showInviteTip <span class="token operator">=</span> <span class="token boolean">true</span>
          <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
          <span class="token keyword">const</span> smallFriends <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
          smallFriends<span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>smallMyPos<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>members<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>smallFriends <span class="token operator">=</span> smallFriends
          <span class="token function">timeout2Promise</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">initSmallPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
          <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>clicking <span class="token operator">=</span> <span class="token boolean">false</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token function">handleChangeAnimate</span><span class="token punctuation">(</span><span class="token parameter">type<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token comment">// 更换为动态背景图</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>showCircleAni <span class="token operator">=</span> <span class="token boolean">true</span>
      
      <span class="token comment">// 初始化更换的效果</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>clickFriend <span class="token operator">=</span> <span class="token string">''</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>friendChangeTransform <span class="token operator">=</span> <span class="token string">''</span> 
      <span class="token keyword">this</span><span class="token punctuation">.</span>friendChangeImgStyle <span class="token operator">=</span> <span class="token string">''</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>type <span class="token operator">===</span> <span class="token string">'friend'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">const</span> supFriend <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>members<span class="token punctuation">[</span>index<span class="token punctuation">]</span>
        <span class="token keyword">const</span> subFriend <span class="token operator">=</span> supFriend<span class="token punctuation">.</span>members
        <span class="token comment">// 更换中心图片 </span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>centerAvatar <span class="token operator">=</span> supFriend<span class="token punctuation">.</span>member_avatar_url
        
        <span class="token comment">// 展示朋友的朋友的图片 更换朋友图片</span>
        <span class="token keyword">let</span> friends <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
        <span class="token keyword">const</span> len <span class="token operator">=</span> subFriend<span class="token punctuation">.</span>length <span class="token operator">></span> <span class="token number">5</span> <span class="token operator">?</span> <span class="token number">5</span> <span class="token operator">:</span> subFriend<span class="token punctuation">.</span>length <span class="token comment">// 确保即使朋友的朋友返回的是大于4个的 最后一个位置还是我的</span>
        <span class="token keyword">const</span> position <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'centerRight'</span><span class="token punctuation">,</span> <span class="token operator">...</span><span class="token constant">POSITIONS</span><span class="token punctuation">]</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> len<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
          friends<span class="token punctuation">[</span>position<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> subFriend<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>member_avatar_url
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">const</span> myPos <span class="token operator">=</span> position<span class="token punctuation">[</span>len<span class="token punctuation">]</span> <span class="token comment">//  ? len : 1 避免第一个centerRight</span>
        friends<span class="token punctuation">[</span>myPos<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>userInfo<span class="token punctuation">.</span>wx_avatar_url <span class="token comment">// 自己的头像 附在最后一个位置上</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>showSmallFriend <span class="token operator">=</span> <span class="token boolean">true</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>friends <span class="token operator">=</span> friends
        <span class="token keyword">this</span><span class="token punctuation">.</span>smallMyPos <span class="token operator">=</span> myPos
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span><span class="token string">'small'</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
      <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// 更换中心图片 </span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>centerAvatar <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>userInfo<span class="token punctuation">.</span>wx_avatar_url

        <span class="token comment">// 展示朋友的图片</span>
        <span class="token keyword">let</span> friends <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
        <span class="token keyword">const</span> len <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>members<span class="token punctuation">.</span>length
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> len<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
          friends<span class="token punctuation">[</span><span class="token constant">POSITIONS</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>members<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>member_avatar_url
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>page <span class="token operator">&lt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>totalPages <span class="token operator">||</span> <span class="token keyword">this</span><span class="token punctuation">.</span>totalPages <span class="token operator">></span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">// 显示换一批</span>
          friends<span class="token punctuation">.</span>bottomRight <span class="token operator">=</span> <span class="token string">'nextPage'</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>friends <span class="token operator">=</span> friends
        <span class="token keyword">this</span><span class="token punctuation">.</span>smallMyPos <span class="token operator">=</span> <span class="token string">''</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>showSmallFriend <span class="token operator">=</span> <span class="token boolean">false</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span><span class="token string">'small'</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
      <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token function">hideSmallPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">const</span> top <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">212</span>
      <span class="token keyword">const</span> bottom <span class="token operator">=</span> <span class="token number">206</span>
      <span class="token keyword">const</span> left <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">126</span>
      <span class="token keyword">const</span> right <span class="token operator">=</span> <span class="token number">136</span>
      <span class="token keyword">const</span> topRight <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">transform: translate(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>right<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">rpx, </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>top<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">rpx); opacity: 0</span><span class="token template-punctuation string">`</span></span>
      <span class="token keyword">const</span> topLeft <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">transform: translate(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>left<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">rpx, </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>top<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">rpx); opacity: 0</span><span class="token template-punctuation string">`</span></span>
      <span class="token keyword">const</span> centerLeft <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">transform: translate(-240rpx); opacity: 0</span><span class="token template-punctuation string">`</span></span>
      <span class="token keyword">const</span> centerRight <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">transform: translate(240rpx); opacity: 0</span><span class="token template-punctuation string">`</span></span>
      <span class="token keyword">const</span> bottomRight <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">transform: translate(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>right<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">rpx, </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>bottom<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">rpx); opacity: 0</span><span class="token template-punctuation string">`</span></span>
      <span class="token keyword">const</span> bottomLeft <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">transform: translate(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>left<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">rpx, </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>bottom<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">rpx); opacity: 0</span><span class="token template-punctuation string">`</span></span>
      <span class="token keyword">const</span> smallPosition <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
        <span class="token literal-property property">topRight</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Array</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">fill</span><span class="token punctuation">(</span>topRight<span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token literal-property property">topLeft</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Array</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">fill</span><span class="token punctuation">(</span>topLeft<span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token literal-property property">centerLeft</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Array</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">fill</span><span class="token punctuation">(</span>centerLeft<span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token literal-property property">centerRight</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Array</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">fill</span><span class="token punctuation">(</span>centerRight<span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token literal-property property">bottomRight</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Array</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">fill</span><span class="token punctuation">(</span>bottomRight<span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token literal-property property">bottomLeft</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Array</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">fill</span><span class="token punctuation">(</span>bottomLeft<span class="token punctuation">)</span>
      <span class="token punctuation">&#125;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>hexagonSmallPosition <span class="token operator">=</span> smallPosition

    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token function">changeCenterImg</span><span class="token punctuation">(</span><span class="token parameter">pos</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>friendChangeImgStyle <span class="token operator">=</span> <span class="token string">'width: 136rpx; height: 136rpx; border: none;'</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>friendChangeTransform <span class="token operator">=</span> pos
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token function">onShare</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>clicking<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span>
      <span class="token punctuation">&#125;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span><span class="token string">'share'</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="VUE-全家桶"><a href="#VUE-全家桶" class="headerlink" title="VUE 全家桶"></a>VUE 全家桶</h3><h4 id="CRM"><a href="#CRM" class="headerlink" title="CRM"></a>CRM</h4><p>主要职责：搭建基础组件框架，项目从无到有，从 0 到 1。</p>
<p>负责部分：</p>
<ul>
<li>基础组件框架包括页头、菜单、面包屑、弹窗等。</li>
<li>权限管理部分，axios拦截和路由前置。</li>
<li>文档管理，创建并编写公共部分配置文档。</li>
</ul>
<p>步骤：</p>
<ul>
<li>确定技术选型</li>
<li>搭建项目结构（组织框架）</li>
<li>搭建样式结构，样式标准化，确定主题颜色、字体等全局元素，定义常量文件。</li>
<li>封装基础内容，如网络请求、路由模块、store模块、权限校验、常量数据（角色常量、错误码）</li>
<li>搭建基础框架，构建通用组件。大致布局包括左侧菜单栏、顶部信息展示、底部信息，留出中间部分作为内容模块</li>
<li>构建基础页面，如登录页面、404页面等</li>
<li>每个步骤都需要文档编写，后续根据UI和业务需求，合理划分组件，公用组件和业务模块内部组件</li>
<li>前期可能会避免过度设计，根据业务需求需要持续精益划分</li>
</ul>
<h5 id="权限管理"><a href="#权限管理" class="headerlink" title="权限管理"></a>权限管理</h5><p>页面级权限管理</p>
<ol>
<li>在 vue-router 的 meta 路由元信息属性中配置自定义属性 premise ，设置权限数组。</li>
</ol>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token punctuation">&#123;</span>
    <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">'clue'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'Clue'</span><span class="token punctuation">,</span>
    <span class="token function-variable function">component</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'@/views/saleOcean/Qcard'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token literal-property property">meta</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">'相亲名片'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'tab'</span><span class="token punctuation">,</span>
        <span class="token comment">// keepAlive: true,</span>
        <span class="token literal-property property">permission</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token constant">ADMIN</span><span class="token punctuation">,</span> <span class="token constant">OPERATOR</span><span class="token punctuation">,</span> <span class="token constant">STOREMANAGER</span><span class="token punctuation">,</span> <span class="token constant">EXPERIENCE</span><span class="token punctuation">]</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="2">
<li><p>路由挂载，虽然是按照权限分配，但是所有页面路由都会挂在到前端。</p>
</li>
<li><p>用户登录后获取的用户权限信息存储在store中，根据用户权限信息通过路由元信息中的promise属性过滤路由数组生成权限路由。</p>
</li>
</ol>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> asyncRouterMap<span class="token punctuation">,</span> constantRouterMap <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'@/router'</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span>
  <span class="token constant">ADMIN</span><span class="token punctuation">,</span>
  <span class="token constant">OPERATOR</span><span class="token punctuation">,</span>
  <span class="token constant">STOREMANAGER</span><span class="token punctuation">,</span>
  <span class="token constant">SALER</span><span class="token punctuation">,</span>
  <span class="token constant">EXPERIENCE</span>
<span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'@/configs/enum'</span>
<span class="token comment">/**
 * 单页面多角色时,过滤页面
 *
 * @param role
 * @param route
 * @returns &#123;*&#125;
 */</span>
<span class="token keyword">function</span> <span class="token function">hasPermission</span><span class="token punctuation">(</span><span class="token parameter">role<span class="token punctuation">,</span> route</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>route<span class="token punctuation">.</span>meta <span class="token operator">&amp;&amp;</span> route<span class="token punctuation">.</span>meta<span class="token punctuation">.</span>permission<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> route<span class="token punctuation">.</span>meta<span class="token punctuation">.</span>permission<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>role<span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token boolean">true</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">function</span> <span class="token function">filterAsyncRouter</span><span class="token punctuation">(</span><span class="token parameter">routerMap<span class="token punctuation">,</span> role<span class="token punctuation">,</span> filterPageName</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> pageList <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token keyword">let</span> list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token keyword">const</span> accessedRouters <span class="token operator">=</span> routerMap<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">route</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">hasPermission</span><span class="token punctuation">(</span>role<span class="token punctuation">,</span> route<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>filterPageName<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>route<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>route<span class="token punctuation">.</span>children <span class="token operator">&amp;&amp;</span> route<span class="token punctuation">.</span>children<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token punctuation">[</span>route<span class="token punctuation">.</span>children<span class="token punctuation">,</span> list<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">filterAsyncRouter</span><span class="token punctuation">(</span>route<span class="token punctuation">.</span>children<span class="token punctuation">,</span> role<span class="token punctuation">,</span> filterPageName<span class="token punctuation">)</span>
        pageList<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token operator">...</span>list<span class="token punctuation">)</span>
      <span class="token punctuation">&#125;</span>
      pageList<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>route<span class="token punctuation">.</span>name<span class="token punctuation">)</span>
      <span class="token keyword">return</span> <span class="token boolean">true</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">return</span> <span class="token boolean">false</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token punctuation">[</span>accessedRouters<span class="token punctuation">,</span> pageList<span class="token punctuation">]</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">const</span> permission <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  <span class="token literal-property property">state</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token literal-property property">routers</span><span class="token operator">:</span> constantRouterMap<span class="token punctuation">,</span>
    <span class="token literal-property property">addRouters</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token literal-property property">pageList</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token literal-property property">isAdmin</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token literal-property property">isOperator</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token literal-property property">isStoreManager</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token literal-property property">isSaler</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token literal-property property">isExperience</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token literal-property property">isAdminOrOperator</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token literal-property property">isStoreOrSaler</span><span class="token operator">:</span> <span class="token boolean">false</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">mutations</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token function-variable function">SET_ROUTERS</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> routers</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
      state<span class="token punctuation">.</span>addRouters <span class="token operator">=</span> routers
      state<span class="token punctuation">.</span>routers <span class="token operator">=</span> constantRouterMap<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>routers<span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token function-variable function">SET_PAGELIST</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> pages</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
      state<span class="token punctuation">.</span>pageList <span class="token operator">=</span> pages
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token function-variable function">SET_ROLE</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> role</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">switch</span> <span class="token punctuation">(</span><span class="token function">Number</span><span class="token punctuation">(</span>role<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">case</span> <span class="token constant">ADMIN</span><span class="token operator">:</span> 
          state<span class="token punctuation">.</span>isAdmin <span class="token operator">=</span> <span class="token boolean">true</span>
          state<span class="token punctuation">.</span>isAdminOrOperator <span class="token operator">=</span> <span class="token boolean">true</span>
          <span class="token keyword">break</span>
        <span class="token keyword">case</span> <span class="token constant">OPERATOR</span><span class="token operator">:</span>
          state<span class="token punctuation">.</span>isOperator <span class="token operator">=</span> <span class="token boolean">true</span>
          state<span class="token punctuation">.</span>isAdminOrOperator <span class="token operator">=</span> <span class="token boolean">true</span>
          <span class="token keyword">break</span>
        <span class="token keyword">case</span> <span class="token constant">STOREMANAGER</span><span class="token operator">:</span>
          state<span class="token punctuation">.</span>isStoreManager <span class="token operator">=</span> <span class="token boolean">true</span>
          state<span class="token punctuation">.</span>isStoreOrSaler <span class="token operator">=</span> <span class="token boolean">true</span>
          <span class="token keyword">break</span>
        <span class="token keyword">case</span> <span class="token constant">SALER</span><span class="token operator">:</span>
          state<span class="token punctuation">.</span>isSaler <span class="token operator">=</span> <span class="token boolean">true</span>
          state<span class="token punctuation">.</span>isStoreOrSaler <span class="token operator">=</span> <span class="token boolean">true</span>
          <span class="token keyword">break</span>
        <span class="token keyword">case</span> <span class="token constant">EXPERIENCE</span><span class="token operator">:</span>
          state<span class="token punctuation">.</span>isExperience <span class="token operator">=</span> <span class="token boolean">true</span>
          <span class="token keyword">break</span>
        <span class="token keyword">default</span><span class="token operator">:</span>
          <span class="token keyword">break</span>
      <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">actions</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token function">GenerateRoutes</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">&#123;</span> commit<span class="token punctuation">,</span> <span class="token literal-property property">getters</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> userInfo <span class="token punctuation">&#125;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> role</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>role<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
          <span class="token keyword">const</span> filterPageName <span class="token operator">=</span> <span class="token operator">!</span><span class="token punctuation">[</span><span class="token constant">ADMIN</span><span class="token punctuation">,</span> <span class="token constant">OPERATOR</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>role<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> userInfo<span class="token punctuation">.</span>virtual_number_status <span class="token operator">!==</span> <span class="token number">1</span> <span class="token operator">?</span> <span class="token punctuation">[</span><span class="token string">'Call'</span><span class="token punctuation">]</span> <span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
          <span class="token keyword">const</span> <span class="token punctuation">[</span>accessedRouters<span class="token punctuation">,</span> pageList<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">filterAsyncRouter</span><span class="token punctuation">(</span>asyncRouterMap<span class="token punctuation">,</span> role<span class="token punctuation">,</span> filterPageName<span class="token punctuation">)</span>
          <span class="token function">commit</span><span class="token punctuation">(</span><span class="token string">'SET_ROUTERS'</span><span class="token punctuation">,</span> accessedRouters<span class="token punctuation">)</span>
          <span class="token function">commit</span><span class="token punctuation">(</span><span class="token string">'SET_PAGELIST'</span><span class="token punctuation">,</span> pageList<span class="token punctuation">)</span>
          <span class="token function">commit</span><span class="token punctuation">(</span><span class="token string">'SET_ROLE'</span><span class="token punctuation">,</span> role<span class="token punctuation">)</span>
          <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">[</span>accessedRouters<span class="token punctuation">,</span> pageList<span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
          <span class="token function">reject</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> permission<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="4">
<li><p>设置路由全局前置守卫 <strong>beforeEach</strong>，可以改变导航本身，守卫是异步解析执行，此时导航在所有守卫 resolve 完之前一直处于 <strong>等待中</strong>。</p>
<p>所以在此时校验当前用户的权限，从store中获取权限路由，进行判断当前路由页面是否存在权限路由中，如果不存在则返回登录界面或404界面。</p>
</li>
</ol>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> router <span class="token keyword">from</span> <span class="token string">'./router'</span>
<span class="token keyword">import</span> store <span class="token keyword">from</span> <span class="token string">'./store'</span>

<span class="token keyword">import</span> NProgress <span class="token keyword">from</span> <span class="token string">'nprogress'</span> <span class="token comment">// progress bar</span>
<span class="token keyword">import</span> <span class="token string">'nprogress/nprogress.css'</span> <span class="token comment">// progress bar style</span>
<span class="token keyword">import</span> notification <span class="token keyword">from</span> <span class="token string">'ant-design-vue/es/notification'</span>

<span class="token keyword">import</span> <span class="token punctuation">&#123;</span>
  getUserInfoByStorage
<span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'@/store/storage'</span>

NProgress<span class="token punctuation">.</span><span class="token function">configure</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token literal-property property">showSpinner</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span> <span class="token comment">// NProgress Configuration</span>

<span class="token keyword">const</span> whiteList <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'login'</span><span class="token punctuation">]</span>

<span class="token keyword">const</span> <span class="token function-variable function">relogin</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">next</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  notification<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
    <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">'错误'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">description</span><span class="token operator">:</span> <span class="token string">'请重新登录'</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
  <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">'/login'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

router<span class="token punctuation">.</span><span class="token function">beforeEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">to<span class="token punctuation">,</span> from<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  NProgress<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// start progress bar</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>to<span class="token punctuation">.</span>path <span class="token operator">===</span> <span class="token string">'/login'</span> <span class="token operator">||</span> whiteList<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>to<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">// 在免登录白名单，直接进入</span>
    NProgress<span class="token punctuation">.</span><span class="token function">done</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">let</span> <span class="token punctuation">&#123;</span> addRouters<span class="token punctuation">,</span> userInfo<span class="token punctuation">,</span> pageList <span class="token punctuation">&#125;</span> <span class="token operator">=</span> store<span class="token punctuation">.</span>getters
    <span class="token keyword">if</span> <span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>userInfo<span class="token punctuation">)</span><span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">// 避免刷新页面时vuex重置后userinfo为空, 刷新后从storage中获取userInfo</span>
      userInfo <span class="token operator">=</span> <span class="token function">getUserInfoByStorage</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      userInfo<span class="token punctuation">.</span>token <span class="token operator">&amp;&amp;</span> store<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token string">'SET_ACCESS_TOKEN'</span><span class="token punctuation">,</span> userInfo<span class="token punctuation">.</span>token<span class="token punctuation">)</span>
      store<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token string">'SET_USERINFO'</span><span class="token punctuation">,</span> userInfo<span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>addRouters<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>userInfo <span class="token operator">&amp;&amp;</span> userInfo<span class="token punctuation">.</span>role<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">// storage中没有userinfo</span>
        store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'GenerateRoutes'</span><span class="token punctuation">,</span> userInfo<span class="token punctuation">.</span>role<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">[</span><span class="token punctuation">,</span> list<span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>list<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>to<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
          <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span> <span class="token comment">// 没有下一个页面的权限</span>
            notification<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
              <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">'错误'</span><span class="token punctuation">,</span>
              <span class="token literal-property property">description</span><span class="token operator">:</span> <span class="token string">'没有权限, 请重新登录'</span>
            <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
            <span class="token function">relogin</span><span class="token punctuation">(</span>next<span class="token punctuation">)</span>
          <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
          <span class="token comment">// role is undefined</span>
          <span class="token function">relogin</span><span class="token punctuation">(</span>next<span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
      <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
        <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">'/login'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
      <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
      <span class="token comment">// 在已登录情况下跳转到不属于该用户的页面,返回到登录页面</span>
      pageList<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>to<span class="token punctuation">.</span>name<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">relogin</span><span class="token punctuation">(</span>next<span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>

router<span class="token punctuation">.</span><span class="token function">afterEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  NProgress<span class="token punctuation">.</span><span class="token function">done</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// finish progress bar</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h4 id="后台管理系统"><a href="#后台管理系统" class="headerlink" title="后台管理系统"></a>后台管理系统</h4><h5 id="权限可交互树状图"><a href="#权限可交互树状图" class="headerlink" title="权限可交互树状图"></a>权限可交互树状图</h5><p>主要加了D3库进行展示树形结构。涉及到简单的<code>svg</code>。</p>
<p>SVG：</p>
<ul>
<li>所有 SVG 显示属性都可以作为 CSS 属性来使用。</li>
<li>SVG 有自己的事件属性，可以在元素上绑定事件进行事件响应。实现SVG可交互动画效果。</li>
<li>SVG 有相关的 DOM api，可以进行一系列元素选择和操作。</li>
</ul>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token operator">&lt;</span>template<span class="token operator">></span>
  <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"tree-container"</span> <span class="token operator">:</span>id<span class="token operator">=</span><span class="token string">"id"</span><span class="token operator">></span>
    <span class="token operator">&lt;</span>svg <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"d3-tree"</span><span class="token operator">></span>
      <span class="token operator">&lt;</span>g <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"container"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>g<span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>svg<span class="token operator">></span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">></span>
<span class="token operator">&lt;</span>script<span class="token operator">></span>
  <span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> d3 <span class="token keyword">from</span> <span class="token string">'d3'</span>
  <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">&#123;</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'MindMap'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">props</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
      <span class="token literal-property property">dataset</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> Object<span class="token punctuation">,</span>
        <span class="token keyword">default</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
          <span class="token keyword">return</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
      <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>
        <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
        <span class="token literal-property property">zoom</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
        <span class="token literal-property property">index</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token literal-property property">duration</span><span class="token operator">:</span> <span class="token number">750</span><span class="token punctuation">,</span>
        <span class="token literal-property property">root</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
        <span class="token literal-property property">nodes</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token literal-property property">links</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token literal-property property">dTreeData</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
        <span class="token literal-property property">transform</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
        <span class="token literal-property property">margin</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
          <span class="token literal-property property">top</span><span class="token operator">:</span> <span class="token number">20</span><span class="token punctuation">,</span>
          <span class="token literal-property property">right</span><span class="token operator">:</span> <span class="token number">90</span><span class="token punctuation">,</span>
          <span class="token literal-property property">bottom</span><span class="token operator">:</span> <span class="token number">30</span><span class="token punctuation">,</span>
          <span class="token literal-property property">left</span><span class="token operator">:</span> <span class="token number">90</span>
        <span class="token punctuation">&#125;</span>
      <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token function">created</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>id <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">uuid</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token function">mounted</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token comment">//创建svg画布</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>width <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">.</span>clientWidth
      <span class="token keyword">this</span><span class="token punctuation">.</span>height <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">.</span>clientHeight
      <span class="token comment">// $el提供一个在页面上已存在的 DOM 元素作为 Vue 实例的挂载目标</span>
      <span class="token keyword">const</span> svg <span class="token operator">=</span> d3<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$el<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token string">'svg.d3-tree'</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'width'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>width<span class="token punctuation">)</span> <span class="token comment">// 设置属性</span>
        <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'height'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>height<span class="token punctuation">)</span>
      <span class="token keyword">const</span> transform <span class="token operator">=</span> d3<span class="token punctuation">.</span>zoomIdentity<span class="token punctuation">.</span><span class="token function">translate</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>margin<span class="token punctuation">.</span>left<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>margin<span class="token punctuation">.</span>top<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">scale</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">// 恒等变换</span>
      <span class="token keyword">const</span> container <span class="token operator">=</span> svg<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token string">'g.container'</span><span class="token punctuation">)</span>

      <span class="token comment">// init zoom behavior, which is both an object and function</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>zoom <span class="token operator">=</span> d3<span class="token punctuation">.</span><span class="token function">zoom</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 移动缩放</span>
        <span class="token punctuation">.</span><span class="token function">scaleExtent</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">// 可缩放范围</span>
        <span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'zoom'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>zoomed<span class="token punctuation">)</span> <span class="token comment">// 绑定缩放动作监听</span>

      container<span class="token punctuation">.</span><span class="token function">transition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">duration</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>duration<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>zoom<span class="token punctuation">.</span>transform<span class="token punctuation">,</span> transform<span class="token punctuation">)</span> <span class="token comment">// 平滑的重置缩放(750ms)</span>
      <span class="token function">svg</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>zoom<span class="token punctuation">)</span> <span class="token comment">// 重置缩放变换</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>root <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getRoot</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>root<span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">computed</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
      <span class="token function">treemap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// 创建一个新的整齐(同深度节点对齐)的树布局</span>
        <span class="token keyword">return</span> d3<span class="token punctuation">.</span><span class="token function">tree</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
          <span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>height<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>width<span class="token punctuation">]</span><span class="token punctuation">)</span>
      <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">methods</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
      <span class="token function">uuid</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">function</span> <span class="token function">s4</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
          <span class="token keyword">return</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">+</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">0x10000</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>
          <span class="token function">s4</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">s4</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'-'</span> <span class="token operator">+</span> <span class="token function">s4</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'-'</span> <span class="token operator">+</span> <span class="token function">s4</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'-'</span> <span class="token operator">+</span> <span class="token function">s4</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'-'</span> <span class="token operator">+</span> <span class="token function">s4</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">s4</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">s4</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
      <span class="token comment">/**
       * @description 获取构造根节点，先遍历数据赋值每个节点属性返回一整棵树
       */</span>
      <span class="token function">getRoot</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">let</span> root <span class="token operator">=</span> d3<span class="token punctuation">.</span><span class="token function">hierarchy</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>dataset<span class="token punctuation">,</span> <span class="token parameter">d</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span> <span class="token comment">// 根据指定的层次结构数据构造一个根节点，设置value、children、parent、height、depth、data</span>
          <span class="token keyword">return</span> d<span class="token punctuation">.</span>children <span class="token comment">// 子元素</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
        <span class="token keyword">const</span> multiple <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>root<span class="token punctuation">.</span><span class="token function">leaves</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length <span class="token operator">/</span> <span class="token number">20</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token number">1</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>height <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>height <span class="token operator">*</span> multiple
        root<span class="token punctuation">.</span>x0 <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>height <span class="token operator">/</span> <span class="token number">2</span> <span class="token comment">// 容器中心点，x为纵向</span>
        root<span class="token punctuation">.</span>y0 <span class="token operator">=</span> <span class="token number">0</span>
        <span class="token keyword">return</span> root
      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
      <span class="token comment">/**
       * @description 点击节点进行展开、收缩
       */</span>
      <span class="token function">clickNode</span><span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>d<span class="token punctuation">.</span>_children <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>d<span class="token punctuation">.</span>children<span class="token punctuation">)</span>
          <span class="token keyword">return</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>d<span class="token punctuation">.</span>children<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$set</span><span class="token punctuation">(</span>d<span class="token punctuation">,</span> <span class="token string">'_children'</span><span class="token punctuation">,</span> d<span class="token punctuation">.</span>children<span class="token punctuation">)</span>
          d<span class="token punctuation">.</span>children <span class="token operator">=</span> <span class="token keyword">null</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$set</span><span class="token punctuation">(</span>d<span class="token punctuation">,</span> <span class="token string">'children'</span><span class="token punctuation">,</span> d<span class="token punctuation">.</span>_children<span class="token punctuation">)</span>
          d<span class="token punctuation">.</span>_children <span class="token operator">=</span> <span class="token keyword">null</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$nextTick</span><span class="token punctuation">(</span>
          <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span>
          <span class="token punctuation">&#125;</span>
        <span class="token punctuation">)</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>

      <span class="token function">diagonal</span><span class="token punctuation">(</span><span class="token parameter">s<span class="token punctuation">,</span> d</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">M </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>s<span class="token punctuation">.</span>y<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>s<span class="token punctuation">.</span>x<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">
                    C </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span>y <span class="token operator">+</span> d<span class="token punctuation">.</span>y<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>s<span class="token punctuation">.</span>x<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">,
                    </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span>y <span class="token operator">+</span> d<span class="token punctuation">.</span>y<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>d<span class="token punctuation">.</span>x<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">,
                    </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>d<span class="token punctuation">.</span>y<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>d<span class="token punctuation">.</span>x<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>

      <span class="token comment">/**
       * @description 获取构造的node数据和link数据, 构造每个节点的x,y值
       */</span>
      <span class="token function">getNodesAndLinks</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// treemap generate new x、y coordinate according to root node, </span>
        <span class="token comment">// so can‘t use computed propter of vue</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>dTreeData <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">treemap</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>root<span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>nodes <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>dTreeData<span class="token punctuation">.</span><span class="token function">descendants</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 返回后代节点数组，第一个节点为自身，然后依次为所有子节点的拓扑排序。</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>links <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>dTreeData<span class="token punctuation">.</span><span class="token function">descendants</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>

      <span class="token comment">/** 
       * @description 数据与Dom进行绑定
       */</span>
      <span class="token function">update</span><span class="token punctuation">(</span><span class="token parameter">source</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getNodesAndLinks</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>nodes<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">d</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span> <span class="token comment">// 遍历每个点，重定义y值=深度（depth）*180, 即横向偏移量</span>
          d<span class="token punctuation">.</span>y <span class="token operator">=</span> d<span class="token punctuation">.</span>depth <span class="token operator">*</span> <span class="token number">180</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
        <span class="token comment">// *************************** Nodes section *************************** //</span>
        <span class="token comment">// Update the nodes...</span>
        <span class="token keyword">const</span> svg <span class="token operator">=</span> d3<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$el<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token string">'svg.d3-tree'</span><span class="token punctuation">)</span>
        <span class="token keyword">const</span> container <span class="token operator">=</span> svg<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token string">'g.container'</span><span class="token punctuation">)</span>
        <span class="token keyword">let</span> node <span class="token operator">=</span> container<span class="token punctuation">.</span><span class="token function">selectAll</span><span class="token punctuation">(</span><span class="token string">'g.node'</span><span class="token punctuation">)</span> <span class="token comment">// 选择所有与指定的 selector 匹配的元素。</span>
          <span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>nodes<span class="token punctuation">,</span> <span class="token parameter">d</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span> <span class="token comment">// 将数据集传递给子元素，设置子元素的id</span>
            <span class="token keyword">return</span> d<span class="token punctuation">.</span>id <span class="token operator">||</span> <span class="token punctuation">(</span>d<span class="token punctuation">.</span>id <span class="token operator">=</span> <span class="token operator">++</span><span class="token keyword">this</span><span class="token punctuation">.</span>index<span class="token punctuation">)</span>
          <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
        <span class="token comment">// Enter any new sources at the parent's previous position.</span>
        <span class="token keyword">let</span> nodeEnter <span class="token operator">=</span> node<span class="token punctuation">.</span><span class="token function">enter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'g'</span><span class="token punctuation">)</span> <span class="token comment">// 添加子节点</span>
          <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'class'</span><span class="token punctuation">,</span> <span class="token string">'node'</span><span class="token punctuation">)</span>
          <span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>clickNode<span class="token punctuation">)</span>
          <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'transform'</span><span class="token punctuation">,</span> <span class="token parameter">d</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">return</span> <span class="token string">'translate('</span> <span class="token operator">+</span> source<span class="token punctuation">.</span>y0 <span class="token operator">+</span> <span class="token string">','</span> <span class="token operator">+</span> source<span class="token punctuation">.</span>x0 <span class="token operator">+</span> <span class="token string">')'</span>
          <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
        nodeEnter<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'circle'</span><span class="token punctuation">)</span> <span class="token comment">// 每个子节点中包含的元素</span>
          <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'r'</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span>
          <span class="token punctuation">.</span><span class="token function">style</span><span class="token punctuation">(</span><span class="token string">'fill'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">let</span> color <span class="token operator">=</span> d<span class="token punctuation">.</span>data<span class="token punctuation">.</span>color <span class="token operator">||</span> <span class="token string">'#fff'</span>
            <span class="token keyword">return</span> d<span class="token punctuation">.</span>children <span class="token operator">||</span> d<span class="token punctuation">.</span>_children <span class="token operator">?</span> <span class="token string">'#40A9FF'</span> <span class="token operator">:</span> color<span class="token punctuation">;</span>
          <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        nodeEnter<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'text'</span><span class="token punctuation">)</span>
          <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'x'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">return</span> d<span class="token punctuation">.</span>children <span class="token operator">||</span> d<span class="token punctuation">.</span>_children <span class="token operator">?</span> <span class="token operator">-</span><span class="token number">15</span> <span class="token operator">:</span> <span class="token number">15</span><span class="token punctuation">;</span>
          <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
          <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'dy'</span><span class="token punctuation">,</span> <span class="token string">'.35em'</span><span class="token punctuation">)</span> <span class="token comment">// 文字的偏移量</span>
          <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'text-anchor'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">return</span> d<span class="token punctuation">.</span>children <span class="token operator">||</span> d<span class="token punctuation">.</span>_children <span class="token operator">?</span> <span class="token string">'end'</span> <span class="token operator">:</span> <span class="token string">'start'</span><span class="token punctuation">;</span>
          <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
          <span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">return</span> d<span class="token punctuation">.</span>data<span class="token punctuation">.</span>name
          <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
          <span class="token punctuation">.</span><span class="token function">style</span><span class="token punctuation">(</span><span class="token string">'fill-opacity'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          
        <span class="token comment">// Transition nodes to their new position.</span>
        <span class="token comment">// 这个方法通常用来在 data-join 操作之后合并 enter 和 update。在单独修改输入和更新元素之后对其进行合并执行其他的操作而不需要额外的代码。</span>
        <span class="token keyword">let</span> nodeUpdate <span class="token operator">=</span> nodeEnter<span class="token punctuation">.</span><span class="token function">merge</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span> <span class="token comment">// 返回一个将当前选择集和指定的 other 选择集合并之后的新的选择集</span>
          <span class="token punctuation">.</span><span class="token function">transition</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
          <span class="token punctuation">.</span><span class="token function">duration</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>duration<span class="token punctuation">)</span>
          <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'transform'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">return</span> <span class="token string">'translate('</span> <span class="token operator">+</span> d<span class="token punctuation">.</span>y <span class="token operator">+</span> <span class="token string">','</span> <span class="token operator">+</span> d<span class="token punctuation">.</span>x <span class="token operator">+</span> <span class="token string">')'</span><span class="token punctuation">;</span>
          <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        nodeUpdate<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token string">'circle'</span><span class="token punctuation">)</span>
          <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'r'</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span>
          <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'stroke'</span><span class="token punctuation">,</span> <span class="token string">'#40A9FF'</span><span class="token punctuation">)</span>
          <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'stroke-width'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
          <span class="token punctuation">.</span><span class="token function">style</span><span class="token punctuation">(</span><span class="token string">'fill'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">let</span> color <span class="token operator">=</span> d<span class="token punctuation">.</span>data<span class="token punctuation">.</span>color <span class="token operator">||</span> <span class="token string">'#fff'</span>
            <span class="token keyword">return</span> d<span class="token punctuation">.</span>children <span class="token operator">||</span> d<span class="token punctuation">.</span>_children <span class="token operator">?</span> <span class="token string">'#40A9FF'</span> <span class="token operator">:</span> color<span class="token punctuation">;</span>
          <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        nodeUpdate<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token string">'text'</span><span class="token punctuation">)</span>
          <span class="token punctuation">.</span><span class="token function">style</span><span class="token punctuation">(</span><span class="token string">'fill-opacity'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// Transition exiting nodes to the parent's new position.</span>
        <span class="token keyword">let</span> nodeExit <span class="token operator">=</span> node<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
          <span class="token punctuation">.</span><span class="token function">transition</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
          <span class="token punctuation">.</span><span class="token function">duration</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>duration<span class="token punctuation">)</span>
          <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'transform'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">return</span> <span class="token string">'translate('</span> <span class="token operator">+</span> source<span class="token punctuation">.</span>y <span class="token operator">+</span> <span class="token string">','</span> <span class="token operator">+</span> source<span class="token punctuation">.</span>x <span class="token operator">+</span> <span class="token string">')'</span><span class="token punctuation">;</span>
          <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
          <span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        nodeExit<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token string">'circle'</span><span class="token punctuation">)</span>
          <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'r'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        nodeExit<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token string">'text'</span><span class="token punctuation">)</span>
          <span class="token punctuation">.</span><span class="token function">style</span><span class="token punctuation">(</span><span class="token string">'fill-opacity'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// *************************** Links section *************************** //</span>
        <span class="token comment">// Update the links…</span>
        <span class="token keyword">let</span> link <span class="token operator">=</span> container<span class="token punctuation">.</span><span class="token function">selectAll</span><span class="token punctuation">(</span><span class="token string">'path.link'</span><span class="token punctuation">)</span>
          <span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>links<span class="token punctuation">,</span> <span class="token parameter">d</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">return</span> d<span class="token punctuation">.</span>id
          <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>

        <span class="token comment">// Enter any new links at the parent's previous position.</span>
        <span class="token keyword">let</span> linkEnter <span class="token operator">=</span> link<span class="token punctuation">.</span><span class="token function">enter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">,</span> <span class="token string">'g'</span><span class="token punctuation">)</span>
          <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">"class"</span><span class="token punctuation">,</span> <span class="token string">"link"</span><span class="token punctuation">)</span>
          <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'d'</span><span class="token punctuation">,</span> <span class="token parameter">d</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">let</span> o <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
              <span class="token literal-property property">x</span><span class="token operator">:</span> source<span class="token punctuation">.</span>x0<span class="token punctuation">,</span>
              <span class="token literal-property property">y</span><span class="token operator">:</span> source<span class="token punctuation">.</span>y0
            <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">diagonal</span><span class="token punctuation">(</span>o<span class="token punctuation">,</span> o<span class="token punctuation">)</span>
          <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
          <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'fill'</span><span class="token punctuation">,</span> <span class="token string">'none'</span><span class="token punctuation">)</span>
          <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'stroke-width'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
          <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'stroke'</span><span class="token punctuation">,</span> <span class="token string">'#999'</span><span class="token punctuation">)</span>
        <span class="token comment">// Transition links to their new position.</span>
        <span class="token keyword">let</span> linkUpdate <span class="token operator">=</span> linkEnter<span class="token punctuation">.</span><span class="token function">merge</span><span class="token punctuation">(</span>link<span class="token punctuation">)</span>
        linkUpdate<span class="token punctuation">.</span><span class="token function">transition</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
          <span class="token punctuation">.</span><span class="token function">duration</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>duration<span class="token punctuation">)</span>
          <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'d'</span><span class="token punctuation">,</span> <span class="token parameter">d</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">diagonal</span><span class="token punctuation">(</span>d<span class="token punctuation">,</span> d<span class="token punctuation">.</span>parent<span class="token punctuation">)</span> <span class="token comment">// link的两端</span>
          <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>

        <span class="token comment">// Transition exiting nodes to the parent's new position.</span>
        link<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">transition</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
          <span class="token punctuation">.</span><span class="token function">duration</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>duration<span class="token punctuation">)</span>
          <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'d'</span><span class="token punctuation">,</span> <span class="token parameter">d</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">let</span> o <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
              <span class="token literal-property property">x</span><span class="token operator">:</span> source<span class="token punctuation">.</span>x<span class="token punctuation">,</span>
              <span class="token literal-property property">y</span><span class="token operator">:</span> source<span class="token punctuation">.</span>y
            <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">diagonal</span><span class="token punctuation">(</span>o<span class="token punctuation">,</span> o<span class="token punctuation">)</span>
          <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
          <span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// Stash the old positions for transition.</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>nodes<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">d</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
          d<span class="token punctuation">.</span>x0 <span class="token operator">=</span> d<span class="token punctuation">.</span>x
          d<span class="token punctuation">.</span>y0 <span class="token operator">=</span> d<span class="token punctuation">.</span>y
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
      <span class="token comment">/** 
       * @description control the canvas zoom to up or down
       */</span>
      <span class="token function">zoomed</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        d3<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$el<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token string">'g.container'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'transform'</span><span class="token punctuation">,</span> d3<span class="token punctuation">.</span>event<span class="token punctuation">.</span>transform<span class="token punctuation">)</span>
      <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span>
<span class="token operator">&lt;</span>style lang<span class="token operator">=</span><span class="token string">'less'</span> scoped<span class="token operator">></span>
  <span class="token punctuation">.</span>tree<span class="token operator">-</span>container <span class="token punctuation">&#123;</span>
    <span class="token literal-property property">width</span><span class="token operator">:</span> <span class="token number">100</span><span class="token operator">%</span><span class="token punctuation">;</span>
    <span class="token literal-property property">height</span><span class="token operator">:</span> 600px<span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>

  <span class="token punctuation">.</span>d3<span class="token operator">-</span>tree <span class="token punctuation">&#123;</span>
    <span class="token punctuation">.</span>node <span class="token punctuation">&#123;</span>
      <span class="token literal-property property">cursor</span><span class="token operator">:</span> pointer<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token punctuation">.</span>node text <span class="token punctuation">&#123;</span>
      <span class="token literal-property property">font</span><span class="token operator">:</span> 18px<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>style<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h5 id="权限控制"><a href="#权限控制" class="headerlink" title="权限控制"></a>权限控制</h5><p>按钮级别的权限控制。每个用户拥有自己角色的权限同时拥有自己特有的权限。</p>
<p>后端存储角色按钮控制权限和用户的按钮控制权限。</p>
<p>每个按钮都有唯一的key值。前端保存页面和按钮的映射表。</p>
<p>用户登录后从后端获取的权限列表，从按钮key值通过映射表倒推到页面路由，获取权限路由数组。</p>
<blockquote>
<p>这里会比单纯的页面级权限控制要复杂一些。</p>
</blockquote>
<p>前端会挂载所有权限的路由，但是通过全局路由守卫 beforeEnter 控制导航，每次导航都需要检测是否在权限路由数组中。</p>
<p>如果权限不足，则跳转到登录页面或当前权限路由的第一页。</p>
<p>用户手动刷新页面时会导致store数据清空，则需要部分 store 数据做加密持久化存储。</p>
<h5 id="后台管理系统优化方向"><a href="#后台管理系统优化方向" class="headerlink" title="后台管理系统优化方向"></a>后台管理系统优化方向</h5><ul>
<li>组件懒加载</li>
<li>图片懒加载</li>
<li>使用<code>v-once</code>加载静态组件</li>
<li>webpack开启tree-shaking、使用DII方式打包antd（全包导入未使用懒加载）相关包</li>
</ul>
<h3 id="官网"><a href="#官网" class="headerlink" title="官网"></a>官网</h3><h4 id="大亲家系列网站"><a href="#大亲家系列网站" class="headerlink" title="大亲家系列网站"></a>大亲家系列网站</h4><p>前期使用html + css + jQuery改写其他公司官网，直接 down 的其他公司的网站修改的。所以需要快速开发出来，就暂时在旧的页面上使用。</p>
<p>后期使用webpack + pug进行修改。可以设置 babel 的 polyfill 和 使用 less 以及模板。将页面按照功能模块分为页头、侧边栏、弹窗、固定页尾、页尾。</p>
<p>后期修改优势：</p>
<ul>
<li><p>可以减少对低兼容的忌讳，使用 babel 进行补充polyfill。</p>
</li>
<li><p>使用less，对 css 进行合理的拆分和通用样式。</p>
</li>
<li><p>降低维护成本，如需要改动关键字，第一版传统写法则需要搜索出所有的文档进行改动，使用模板引擎能够减少改动部分，方便维护。</p>
</li>
<li><p>使用 tree-shaking 可以减少代码冗余。</p>
</li>
</ul>
]]></content>
      <categories>
        <category>总结</category>
        <category>工作</category>
      </categories>
      <tags>
        <tag>前端</tag>
        <tag>工作</tag>
        <tag>vue</tag>
        <tag>微信小程序</tag>
        <tag>websocket</tag>
      </tags>
  </entry>
  <entry>
    <title>2025年随笔-1</title>
    <url>/posts/ece4365a/</url>
    <content><![CDATA[]]></content>
  </entry>
  <entry>
    <title>2021年工作总结</title>
    <url>/posts/32636/</url>
    <content><![CDATA[<p>此次二次开发圈子小程序，有一个主包，三个分包，代码量一直处于快溢出阈值的程度。</p>
<p>二次开发通常是基于不动或尽量少的去动原代码开发逻辑，轻易去调整容易崩。</p>
<p>所以整理一下使用的技巧。</p>
<h3 id="判断条件"><a href="#判断条件" class="headerlink" title="判断条件"></a>判断条件</h3><h4 id="多个函数执行需要新增相同的判断条件"><a href="#多个函数执行需要新增相同的判断条件" class="headerlink" title="多个函数执行需要新增相同的判断条件"></a>多个函数执行需要新增相同的判断条件</h4><p>记录时间：2021年1月</p>
<p>笨方法是创建一个公共条件函数，每个函数中去添加条件函数，需要修改所有的函数，且后续新增需求也要考虑到是否需要条件函数。或者创建前置函数设置条件处理函数，修改所有的函数调用方式，新增函数同样需要考虑是否条件一致。</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token parameter">a</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'a: '</span><span class="token punctuation">,</span> a<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 方法一(推荐)</span>
<span class="token comment">// function handleClick(fn, ...args) &#123;</span>
<span class="token comment">//   // ...前置处理逻辑</span>
<span class="token comment">//   fn &amp;&amp; typeof fn === 'function' &amp;&amp; fn.apply(this, args)</span>
<span class="token comment">// &#125;</span>

<span class="token comment">// 方法二</span>
<span class="token keyword">function</span> <span class="token function">handleClick</span><span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// ...前置处理逻辑</span>
    fn <span class="token operator">&amp;&amp;</span> <span class="token keyword">typeof</span> fn <span class="token operator">===</span> <span class="token string">'function'</span> <span class="token operator">&amp;&amp;</span> <span class="token function">fn</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token class-name">Array</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>arguments<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token function">handleClick</span><span class="token punctuation">(</span>foo<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>也可以根据需求，使用事件委托利用事件捕获进行处理。</p>
<p>同一模块下，会先响应最外层的事件捕获 -&gt; 最内层的事件捕获 -&gt; 最内层的事件冒泡 -&gt; 最外层的事件冒泡。</p>
<h3 id="新增处理逻辑"><a href="#新增处理逻辑" class="headerlink" title="新增处理逻辑"></a>新增处理逻辑</h3><h4 id="在一串回调中间新增一块处理逻辑"><a href="#在一串回调中间新增一块处理逻辑" class="headerlink" title="在一串回调中间新增一块处理逻辑"></a>在一串回调中间新增一块处理逻辑</h4><p>记录时间：2021年2月</p>
<p>逻辑复杂的时候难免跳来跳去使用回调。需求是在中间的一个回调函数中添加一段处理逻辑，所需参数是前几个回调中的数据，可以使用笨办法，一层一层的传递参数，但是这样前面的回调都要修改一层一层向下传值，修改范围太大，且不美观和容易数据丢失和出错。可以使用<strong>闭包</strong>进行处理。</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">data <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    <span class="token literal-property property">postStatistics</span><span class="token operator">:</span> <span class="token keyword">null</span> <span class="token comment">// 声明</span>
<span class="token punctuation">&#125;</span>

<span class="token function">onLaunch</span><span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	<span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span>postStatistics <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">postStatistics</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span> <span class="token comment">// 保存执行上下文环境</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">// ... 经过一系列请求-回调之后</span>
<span class="token function">userLogin</span> <span class="token punctuation">(</span><span class="token parameter">code<span class="token punctuation">,</span> tokenCache</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    circleApi<span class="token punctuation">.</span><span class="token function">login</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
		<span class="token comment">// ...</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// ...</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span>postStatistics <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span><span class="token function">postStatistics</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 调用</span>
        <span class="token comment">// ...</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token function">postStatistics</span><span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">// 定义闭包函数</span>
    <span class="token keyword">const</span> opt <span class="token operator">=</span> options
    <span class="token keyword">const</span> that <span class="token operator">=</span> <span class="token keyword">this</span>
    <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
            <span class="token literal-property property">app_id</span><span class="token operator">:</span> that<span class="token punctuation">.</span>globalData<span class="token punctuation">.</span>appId<span class="token punctuation">,</span>
            <span class="token literal-property property">scenes</span><span class="token operator">:</span> opt<span class="token punctuation">.</span>scene<span class="token punctuation">,</span>
            <span class="token literal-property property">wx_info</span><span class="token operator">:</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>opt<span class="token punctuation">.</span>referrerInfo<span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token literal-property property">way_id</span><span class="token operator">:</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>opt<span class="token punctuation">.</span>query<span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span>
        circleApi<span class="token punctuation">.</span><span class="token function">postStatistics</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
            data<span class="token punctuation">,</span>
            <span class="token literal-property property">getToken</span><span class="token operator">:</span> <span class="token boolean">true</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h4 id="添加-WebSocket-相关"><a href="#添加-WebSocket-相关" class="headerlink" title="添加 WebSocket 相关"></a>添加 WebSocket 相关</h4><p>记录时间：2021年2月</p>
<p>app.wpy 中统一处理 WebSocket 相关逻辑，全局仅生成一个 SocketTask 对象，方便管理。</p>
<p>使用单例模式。</p>
<p>监听处理逻辑：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token function">handleOpenSocket</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">// socket创建新的连接之后后端会关闭掉之前的连接，不区分安卓和ios 统一处理</span>
    <span class="token keyword">const</span> that <span class="token operator">=</span> <span class="token keyword">this</span>
    <span class="token keyword">const</span> socketTask <span class="token operator">=</span> that<span class="token punctuation">.</span>globalData<span class="token punctuation">.</span>socketTask
    <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> userPlatform<span class="token punctuation">,</span> token <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>globalData
    <span class="token keyword">if</span> <span class="token punctuation">(</span>userPlatform <span class="token operator">===</span> <span class="token string">''</span> <span class="token operator">||</span> token <span class="token operator">===</span> <span class="token string">''</span><span class="token punctuation">)</span> <span class="token keyword">return</span>
    <span class="token keyword">const</span> socket <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Socket</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
        <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>wsUrl<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">?XqCircleToken=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>token<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
        <span class="token function">onAcceptMsg</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token comment">// ... 接受到信息处理逻辑</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token comment">// 关闭</span>
        <span class="token function">onClose</span><span class="token punctuation">(</span><span class="token parameter">socketTaskId</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>that<span class="token punctuation">.</span>globalData<span class="token punctuation">.</span>socketTask <span class="token operator">!==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> socketTaskId <span class="token operator">===</span> that<span class="token punctuation">.</span>globalData<span class="token punctuation">.</span>socketTask<span class="token punctuation">.</span>socketTaskId<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                that<span class="token punctuation">.</span>globalData<span class="token punctuation">.</span>socketTask <span class="token operator">=</span> <span class="token keyword">null</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
    that<span class="token punctuation">.</span>globalData<span class="token punctuation">.</span>socketTask <span class="token operator">=</span> socket
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>Socket,js</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> <span class="token constant">HEARTBEAT_MSG</span> <span class="token operator">=</span> <span class="token string">'--HEARTBEAT--'</span>
<span class="token keyword">const</span> <span class="token constant">HEARTBEAT_RATE</span> <span class="token operator">=</span> <span class="token number">5000</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Socket</span> <span class="token punctuation">&#123;</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>heartbeatTimer <span class="token operator">=</span> <span class="token keyword">null</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>isOpen <span class="token operator">=</span> <span class="token boolean">false</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>heartbeatStatus <span class="token operator">=</span> <span class="token boolean">false</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>onOpen <span class="token operator">=</span> <span class="token keyword">typeof</span> options<span class="token punctuation">.</span>onOpen <span class="token operator">===</span> <span class="token string">'function'</span> <span class="token operator">?</span> options<span class="token punctuation">.</span>onOpen <span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>handleOpen
        <span class="token keyword">this</span><span class="token punctuation">.</span>onClose <span class="token operator">=</span> <span class="token keyword">typeof</span> options<span class="token punctuation">.</span>onClose <span class="token operator">===</span> <span class="token string">'function'</span> <span class="token operator">?</span> options<span class="token punctuation">.</span>onClose <span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>handleClose
        <span class="token keyword">this</span><span class="token punctuation">.</span>acceptMsg <span class="token operator">=</span> <span class="token keyword">typeof</span> options<span class="token punctuation">.</span>onAcceptMsg <span class="token operator">===</span> <span class="token string">'function'</span> <span class="token operator">?</span> options<span class="token punctuation">.</span>onAcceptMsg <span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>handleAcceptMsg
        
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span>options<span class="token punctuation">.</span>url<span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>

    <span class="token function">init</span><span class="token punctuation">(</span><span class="token parameter">url</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>url<span class="token punctuation">)</span> <span class="token keyword">return</span>
        <span class="token keyword">const</span> that <span class="token operator">=</span> <span class="token keyword">this</span>
        <span class="token keyword">const</span> socketTask <span class="token operator">=</span> wx<span class="token punctuation">.</span><span class="token function">connectSocket</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
            url<span class="token punctuation">,</span>
            <span class="token function">success</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                that<span class="token punctuation">.</span>socketTaskId <span class="token operator">=</span> res<span class="token punctuation">.</span>socketTaskId
            <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
            <span class="token function">fail</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">connectSocket err</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
        socketTask<span class="token punctuation">.</span><span class="token function">onOpen</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>isOpen <span class="token operator">=</span> <span class="token boolean">true</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">onOpen</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
        socketTask<span class="token punctuation">.</span><span class="token function">onMessage</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>res<span class="token punctuation">.</span>data<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token constant">HEARTBEAT_MSG</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">acceptMsg</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token comment">// 非心跳包</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
        socketTask<span class="token punctuation">.</span><span class="token function">onClose</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">handleInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">onClose</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>socketTaskId<span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
        socketTask<span class="token punctuation">.</span><span class="token function">onError</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">handleInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">onClose</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>socketTaskId<span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>instance <span class="token operator">=</span> socketTask
    <span class="token punctuation">&#125;</span>

    <span class="token function">handleOpen</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">sendHeartbeat</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>

    <span class="token function">handleClose</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'handleClose'</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>

    <span class="token function">handleInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>isOpen <span class="token operator">=</span> <span class="token boolean">false</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>instance <span class="token operator">=</span> <span class="token keyword">null</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">clearHeartbeat</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>

    <span class="token function">handleCloseConnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">const</span> instance <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>instance
        <span class="token keyword">const</span> that <span class="token operator">=</span> <span class="token keyword">this</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
            instance <span class="token operator">&amp;&amp;</span> instance<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
                <span class="token function">success</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    <span class="token function">resolve</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
                <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
                <span class="token function">fail</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    <span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
                <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
                <span class="token function">complete</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    <span class="token comment">// 重置</span>
                    that<span class="token punctuation">.</span><span class="token function">handleInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    that<span class="token punctuation">.</span><span class="token function">onClose</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
          <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>

    <span class="token function">handleSendMsg</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">const</span> that <span class="token operator">=</span> <span class="token keyword">this</span>
        <span class="token keyword">const</span> instance <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>instance
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
            instance <span class="token operator">&amp;&amp;</span> instance<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
                <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token keyword">typeof</span> data <span class="token operator">===</span> <span class="token string">'object'</span> <span class="token operator">?</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token operator">:</span> data<span class="token punctuation">,</span>
                <span class="token function">success</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    <span class="token function">resolve</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
                    that<span class="token punctuation">.</span>heartbeatStatus <span class="token operator">=</span> <span class="token boolean">true</span>
                <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
                <span class="token function">fail</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    <span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
                    that<span class="token punctuation">.</span>heartbeatStatus <span class="token operator">=</span> <span class="token boolean">false</span>
                    that<span class="token punctuation">.</span>instance <span class="token operator">&amp;&amp;</span> that<span class="token punctuation">.</span><span class="token function">handleCloseConnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>

    <span class="token function">handleAcceptMsg</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'accept msg: '</span><span class="token punctuation">,</span> res<span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>

    <span class="token function">sendHeartbeat</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>heartbeatTimer <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">handleSendMsg</span><span class="token punctuation">(</span><span class="token constant">HEARTBEAT_MSG</span><span class="token punctuation">)</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">sendHeartbeat</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token constant">HEARTBEAT_RATE</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>

    <span class="token function">clearHeartbeat</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>heartbeatTimer<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token function">clearTimeout</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>heartbeatTimer<span class="token punctuation">)</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>heartbeatTimer <span class="token operator">=</span> <span class="token keyword">null</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h4 id="ASCII正则表达式"><a href="#ASCII正则表达式" class="headerlink" title="ASCII正则表达式"></a>ASCII正则表达式</h4><p>记录时间：2021年3月</p>
<p>需求修改，用户自定义输入微信号，需要支持英文字母、数字和英文字符，所以使用ASCII的方式进行正则判断。整理在<a href="https://datura35422.github.io/2021/03/22/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/">正则表达式文章</a>中。</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">verifyWxId</span><span class="token punctuation">(</span><span class="token parameter">wxId</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> wxreg<span class="token operator">=</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^[\x21-\x7e]&#123;6,64&#125;$</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">;</span> <span class="token comment">// 自定义规范 英文标点符号</span>
  <span class="token keyword">return</span> wxreg<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>wxId<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="CSS样式"><a href="#CSS样式" class="headerlink" title="CSS样式"></a>CSS样式</h3><h4 id="实现字体渐变"><a href="#实现字体渐变" class="headerlink" title="实现字体渐变"></a>实现字体渐变</h4><p>参考链接： </p>
<p><a href="https://segmentfault.com/a/1190000011882933">https://segmentfault.com/a/1190000011882933</a></p>
<p><a href="https://blog.csdn.net/CarsonWoo/article/details/89168346">https://blog.csdn.net/CarsonWoo/article/details/89168346</a></p>
<h4 id="九宫格处理"><a href="#九宫格处理" class="headerlink" title="九宫格处理"></a>九宫格处理</h4><p>动态图片需要九宫格查看</p>
<pre class="line-numbers language-less" data-language="less"><code class="language-less"><span class="token selector">.dynamicWrap</span> <span class="token punctuation">&#123;</span>
    <span class="token property">margin-bottom</span><span class="token punctuation">:</span> 60rpx<span class="token punctuation">;</span>
    <span class="token property">width</span><span class="token punctuation">:</span> 654rpx<span class="token punctuation">;</span>
    <span class="token selector">.imagesWrap</span> <span class="token punctuation">&#123;</span>
        <span class="token property">margin-right</span><span class="token punctuation">:</span> <span class="token operator">-</span>6rpx<span class="token punctuation">;</span>
        <span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">;</span>
        <span class="token property">flex-wrap</span><span class="token punctuation">:</span> wrap<span class="token punctuation">;</span>
        <span class="token selector">.dynaminImg</span> <span class="token punctuation">&#123;</span>
            <span class="token property">margin</span><span class="token punctuation">:</span> 0 6rpx 6rpx 0<span class="token punctuation">;</span>
            <span class="token property">width</span><span class="token punctuation">:</span> 214rpx<span class="token punctuation">;</span>
            <span class="token property">height</span><span class="token punctuation">:</span> 214rpx<span class="token punctuation">;</span>
            <span class="token property">border-radius</span><span class="token punctuation">:</span> 8rpx<span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>view 布局样式</p>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>dynamicWrap<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>imagesWrap<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>image</span> 
               <span class="token attr-name"><span class="token namespace">wx:</span>for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>&#123;&#123; info.photos &#125;&#125;<span class="token punctuation">"</span></span> 
               <span class="token attr-name"><span class="token namespace">wx:</span>key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>*this<span class="token punctuation">"</span></span> 
               <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>dynaminImg<span class="token punctuation">"</span></span> 
               <span class="token attr-name">lazy-load</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span> 
               <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>&#123;&#123; item &#125;&#125;?imageView2/1/w/214/h/214<span class="token punctuation">"</span></span> 
               <span class="token attr-name">mode</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>aspectFill<span class="token punctuation">"</span></span>
               <span class="token attr-name">@tap.stop</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>onPreview(&#123;&#123; item &#125;&#125;, &#123;&#123; info.photos &#125;&#125;)<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>image</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>我总是会陷入图片之间的间距问题，想要图片间距自动实现距离问题使用 justify-content: space-between ，但是会遇到两张图片间距过大的问题，所以不能单纯的使用这个属性进行间距控制。使用 margin-right 是最为保险的使用方式。</p>
</blockquote>
<h4 id="实现波纹动效"><a href="#实现波纹动效" class="headerlink" title="实现波纹动效"></a>实现波纹动效</h4><p><img src="/posts/32636/wave.gif" alt="wave"></p>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>recommending<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>recommendingContent<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>avatarWrap<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>open-data</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>userAvatarUrl<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>open-data</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>recommendRipple<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ripple<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ripple<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ripple<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>样式</p>
<pre class="line-numbers language-less" data-language="less"><code class="language-less"><span class="token selector">.recommending</span> <span class="token punctuation">&#123;</span>
    <span class="token property">position</span><span class="token punctuation">:</span> fixed<span class="token punctuation">;</span>
    <span class="token property">top</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
    <span class="token property">width</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>
    <span class="token property">height</span><span class="token punctuation">:</span> 100vh<span class="token punctuation">;</span>
    <span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">;</span>
    <span class="token property">justify-content</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span>
    <span class="token property">align-items</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span>
    <span class="token property">background</span><span class="token punctuation">:</span> #fff<span class="token punctuation">;</span>
    <span class="token property">z-index</span><span class="token punctuation">:</span> 20<span class="token punctuation">;</span>
    <span class="token selector">.recommendingContent</span> <span class="token punctuation">&#123;</span>
        <span class="token property">position</span><span class="token punctuation">:</span> relative<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token selector">.avatarWrap</span> <span class="token punctuation">&#123;</span>
        <span class="token property">width</span><span class="token punctuation">:</span> 200rpx<span class="token punctuation">;</span>
        <span class="token property">height</span><span class="token punctuation">:</span> 200rpx<span class="token punctuation">;</span>
        <span class="token property">border-radius</span><span class="token punctuation">:</span> 50%<span class="token punctuation">;</span>
        <span class="token property">overflow</span><span class="token punctuation">:</span> hidden<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token selector">.recommendRipple</span> <span class="token punctuation">&#123;</span>
        <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span>
        <span class="token property">top</span><span class="token punctuation">:</span> 50%<span class="token punctuation">;</span>
        <span class="token property">left</span><span class="token punctuation">:</span> 50%<span class="token punctuation">;</span>
        <span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">;</span>
        <span class="token property">justify-content</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span>
        <span class="token property">align-items</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span>
        <span class="token property">border-radius</span><span class="token punctuation">:</span> 50%<span class="token punctuation">;</span>
        <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">translate</span><span class="token punctuation">(</span><span class="token operator">-</span>50%<span class="token punctuation">,</span> <span class="token operator">-</span>50%<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token property">overflow</span><span class="token punctuation">:</span> hidden<span class="token punctuation">;</span>
        <span class="token property">animation</span><span class="token punctuation">:</span> ripple 1000ms step<span class="token operator">-</span>start 0s infinite<span class="token punctuation">;</span>
        <span class="token selector">.ripple</span> <span class="token punctuation">&#123;</span>
            <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span>
            <span class="token property">width</span><span class="token punctuation">:</span> 240rpx<span class="token punctuation">;</span>
            <span class="token property">height</span><span class="token punctuation">:</span> 240rpx<span class="token punctuation">;</span>
            <span class="token property">border-radius</span><span class="token punctuation">:</span> 50%<span class="token punctuation">;</span>
            <span class="token property">border</span><span class="token punctuation">:</span> 1px solid<span class="token punctuation">;</span>
            <span class="token property">border-color</span><span class="token punctuation">:</span> <span class="token function">rgba</span><span class="token punctuation">(</span>239<span class="token punctuation">,</span> 75<span class="token punctuation">,</span> 75<span class="token punctuation">,</span> 1<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token selector">&amp;:nth-child(1)</span> <span class="token punctuation">&#123;</span>
                <span class="token property">width</span><span class="token punctuation">:</span> 280rpx<span class="token punctuation">;</span>
                <span class="token property">height</span><span class="token punctuation">:</span> 280rpx<span class="token punctuation">;</span>
                <span class="token property">border-color</span><span class="token punctuation">:</span> <span class="token function">rgba</span><span class="token punctuation">(</span>239<span class="token punctuation">,</span> 75<span class="token punctuation">,</span> 75<span class="token punctuation">,</span> .6<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
            <span class="token selector">&amp;:nth-child(2)</span> <span class="token punctuation">&#123;</span>
                <span class="token property">width</span><span class="token punctuation">:</span> 320rpx<span class="token punctuation">;</span>
                <span class="token property">height</span><span class="token punctuation">:</span> 320rpx<span class="token punctuation">;</span>
                <span class="token property">border-color</span><span class="token punctuation">:</span> <span class="token function">rgba</span><span class="token punctuation">(</span>239<span class="token punctuation">,</span> 75<span class="token punctuation">,</span> 75<span class="token punctuation">,</span> .2<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
        
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token atrule">@keyframes ripple</span> <span class="token punctuation">&#123;</span>
    <span class="token selector">0%, 100%</span> <span class="token punctuation">&#123;</span>
        <span class="token property">width</span><span class="token punctuation">:</span> 220rpx<span class="token punctuation">;</span>
        <span class="token property">height</span><span class="token punctuation">:</span> 220rpx<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token selector">25%</span> <span class="token punctuation">&#123;</span>
        <span class="token property">width</span><span class="token punctuation">:</span> 260rpx<span class="token punctuation">;</span>
        <span class="token property">height</span><span class="token punctuation">:</span> 260rpx<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token selector">50%</span> <span class="token punctuation">&#123;</span>
        <span class="token property">width</span><span class="token punctuation">:</span> 300rpx<span class="token punctuation">;</span>
        <span class="token property">height</span><span class="token punctuation">:</span> 300rpx<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token selector">75%</span> <span class="token punctuation">&#123;</span>
        <span class="token property">width</span><span class="token punctuation">:</span> 340rpx<span class="token punctuation">;</span>
        <span class="token property">height</span><span class="token punctuation">:</span> 340rpx<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="小程序踩坑"><a href="#小程序踩坑" class="headerlink" title="小程序踩坑"></a>小程序踩坑</h3><h4 id="兼容问题"><a href="#兼容问题" class="headerlink" title="兼容问题"></a>兼容问题</h4><p>记录时间：2021-4-8</p>
<p>需要更换<code>getUserInfo</code>的逻辑，换为<code>wx.getUserProfile</code>，但是官方给的兼容例子里，低版本微信也可以成功调用<code>wx.getUserProfile</code>，但是缺少必要的加解密信息，所以低版本也是支持<code>wx.getUserProfile</code>但是功能不完善，所以判断当前版本是否能使用具体某个功能时需要使用<code>wx.canIUse()</code>进行判断，如果使用常用浏览器判断是否支持某个特定<code>api</code>的方法是会触发异常<code>bug</code>。</p>
<h4 id="背景图片"><a href="#背景图片" class="headerlink" title="背景图片"></a>背景图片</h4><p>记录时间：2021-4-21</p>
<p>小程序不支持静态背景图片，主要是路径名会变，所以即使在开发工具中没有问题，可能会在真机测试出现问题。</p>
<p>所以使用动态链接 <code>url</code> 进行设置背景图片。</p>
<p>设置 background-image 没有作用，只能设置 background，相应的 background-size 也是没有作用的。</p>
<p><a href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/background">background</a> 简写属性：<a href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/background-clip"><code>background-clip</code></a>、<a href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/background-color"><code>background-color</code></a>、<a href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/background-image"><code>background-image</code></a>、<a href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/background-origin"><code>background-origin</code></a>、<a href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/background-position"><code>background-position</code></a>、<a href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/background-repeat"><code>background-repeat</code></a>、<a href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/background-size"><code>background-size</code></a> 、<a href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/background-attachment"><code>background-attachment</code></a></p>
<ul>
<li>在每一层中，下列的值可以出现 0 次或 1 次：<ul>
<li><code>&lt;attachment&gt;</code></li>
<li><code>&lt;bg-image&gt;</code></li>
<li><code>&lt;position&gt;</code></li>
<li><code>&lt;bg-size&gt;</code></li>
<li><code>&lt;repeat-style&gt;</code></li>
</ul>
</li>
<li><code>&lt;bg-size&gt;</code> 只能紧接着 <code>&lt;position&gt;</code> 出现，以”/“分割，如： “<code>center/80%</code>“.</li>
<li><code>&lt;box&gt;</code> 可能出现 0 次、1 次或 2 次。如果出现 1 次，它同时设定 <a href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/background-origin"><code>background-origin</code></a> 和 <a href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/background-clip"><code>background-clip</code></a>。如果出现 2 次，第一次的出现设置 <a href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/background-origin"><code>background-origin</code></a>，第二次的出现设置 <a href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/background-clip"><code>background-clip</code></a>。</li>
<li><code>&lt;background-color&gt;</code> 只能被包含在最后一层。</li>
</ul>
<h4 id="动画"><a href="#动画" class="headerlink" title="动画"></a>动画</h4><p>记录时间：2021-4-27</p>
<p>需求想要实现动画第二种效果：参考链接 - <a href="https://blog.csdn.net/sange77/article/details/102597074">Android:仿“某音”APP 多头像跳动动画+轮播动画+心跳动画+输入框抖动动画</a></p>
<p><img src="/posts/32636/20191018091903771.gif" alt="20191018091903771"></p>
<p>对于实现想法：</p>
<ol>
<li><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/CSS_Transitions/Using_CSS_transitions">CSS transitions</a> + <a href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/CSS_Animations/Using_CSS_animations">CSS 动画</a></p>
<p>如果仅仅使用 CSS 动画帧：</p>
<ul>
<li>如果第一个元素进入在容器最左侧，第一个元素消失时第二个元素和第三个元素前移，第四个元素进入，如何控制第二个元素和第三个元素的移动位置。（目前想法，设置三种动画帧，设置延时时间）</li>
<li>如果第一个元素和第四个元素效果一样，则可以不用考虑第二个元素和第三个元素迁移的动画帧和距离。</li>
<li>面临如何循环显示问题。</li>
</ul>
<p>采用了第一种方法</p>
<p>wxml</p>
<pre class="line-numbers language-wxml" data-language="wxml"><code class="language-wxml">&lt;view class&#x3D;&quot;container&quot;&gt;
  &lt;view class&#x3D;&quot;content&quot; bind:tap&#x3D;&quot;onStartAnimation&quot;&gt;
    &lt;view id&#x3D;&quot;item_&#123;&#123; item &#125;&#125;&quot; 
      wx:for&#x3D;&quot;&#123;&#123; itemList &#125;&#125;&quot; wx:key&#x3D;&quot;item&quot; 
      class&#x3D;&quot;item &#123;&#123; index &lt; 2 ? &#39;fade&#39; + index : &#39;fade2&#39; &#125;&#125;&quot; 
      style&#x3D;&quot;animation-delay: &#123;&#123; (index + 1) * 500 &#125;&#125;ms&quot;
    &gt;&lt;&#x2F;view&gt;
  &lt;&#x2F;view&gt;
  &lt;button bind:tap&#x3D;&quot;onClick&quot;&gt;fibonacci&lt;&#x2F;button&gt;
&lt;&#x2F;view&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>wxss</p>
<pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token selector">.container</span> <span class="token punctuation">&#123;</span>
  <span class="token property">height</span><span class="token punctuation">:</span> 100vh<span class="token punctuation">;</span>
  <span class="token property">width</span><span class="token punctuation">:</span> 100vw<span class="token punctuation">;</span>
  <span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">;</span>
  <span class="token property">justify-content</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span>
  <span class="token property">align-items</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token selector">.content</span> <span class="token punctuation">&#123;</span>
  <span class="token property">position</span><span class="token punctuation">:</span> relative<span class="token punctuation">;</span>
  <span class="token property">height</span><span class="token punctuation">:</span> 100rpx<span class="token punctuation">;</span>
  <span class="token property">width</span><span class="token punctuation">:</span> 300rpx<span class="token punctuation">;</span>
  <span class="token property">background-color</span><span class="token punctuation">:</span> aqua<span class="token punctuation">;</span>
  <span class="token property">overflow</span><span class="token punctuation">:</span> hidden<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token selector">.item</span> <span class="token punctuation">&#123;</span>
  <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span>
  <span class="token property">left</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
  <span class="token property">top</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
  <span class="token property">height</span><span class="token punctuation">:</span> 80rpx<span class="token punctuation">;</span>
  <span class="token property">width</span><span class="token punctuation">:</span> 80rpx<span class="token punctuation">;</span>
  <span class="token property">border-radius</span><span class="token punctuation">:</span> 50%<span class="token punctuation">;</span>
  <span class="token property">border</span><span class="token punctuation">:</span> 1px solid #fff<span class="token punctuation">;</span>
  <span class="token property">background</span><span class="token punctuation">:</span> red<span class="token punctuation">;</span>
  <span class="token property">opacity</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token selector">.fade0</span> <span class="token punctuation">&#123;</span>
  <span class="token property">animation-name</span><span class="token punctuation">:</span> fadeFirst<span class="token punctuation">;</span>
  <span class="token property">animation-duration</span><span class="token punctuation">:</span> 2000ms<span class="token punctuation">;</span>
  <span class="token property">animation-fill-mode</span><span class="token punctuation">:</span> both<span class="token punctuation">;</span>
  <span class="token property">animation-delay</span><span class="token punctuation">:</span> 500ms<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token selector">.fade1</span> <span class="token punctuation">&#123;</span>
  <span class="token property">animation-name</span><span class="token punctuation">:</span> fadeSecond<span class="token punctuation">;</span>
  <span class="token property">animation-duration</span><span class="token punctuation">:</span> 2000ms<span class="token punctuation">;</span>
  <span class="token property">animation-fill-mode</span><span class="token punctuation">:</span> both<span class="token punctuation">;</span>
  <span class="token property">animation-delay</span><span class="token punctuation">:</span> 1000ms<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token selector">.fade2</span> <span class="token punctuation">&#123;</span>
  <span class="token property">animation-name</span><span class="token punctuation">:</span> fadeThird<span class="token punctuation">;</span>
  <span class="token property">animation-duration</span><span class="token punctuation">:</span> 2000ms<span class="token punctuation">;</span>
  <span class="token property">animation-fill-mode</span><span class="token punctuation">:</span> both<span class="token punctuation">;</span>
  <span class="token property">animation-delay</span><span class="token punctuation">:</span> 1500ms<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">/* 500ms 时到达边缘位置 1500ms时c出现 a开始消失和移动 */</span>

<span class="token atrule"><span class="token rule">@keyframes</span> fadeFirst</span> <span class="token punctuation">&#123;</span>
  <span class="token selector">0%</span> <span class="token punctuation">&#123;</span>
    <span class="token property">opacity</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
    <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">translateX</span><span class="token punctuation">(</span>50%<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>

  <span class="token selector">25%, 75%</span> <span class="token punctuation">&#123;</span>
    <span class="token property">opacity</span><span class="token punctuation">:</span> 1<span class="token punctuation">;</span>
    <span class="token property">transform</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>

  <span class="token selector">100%</span> <span class="token punctuation">&#123;</span>
    <span class="token property">opacity</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
    <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">translateX</span><span class="token punctuation">(</span>-50%<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token atrule"><span class="token rule">@keyframes</span> fadeSecond</span> <span class="token punctuation">&#123;</span>
  <span class="token selector">0%</span> <span class="token punctuation">&#123;</span>
    <span class="token property">opacity</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
    <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">translateX</span><span class="token punctuation">(</span>100%<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>

  <span class="token selector">25%, 50%</span> <span class="token punctuation">&#123;</span>
    <span class="token property">opacity</span><span class="token punctuation">:</span> 1<span class="token punctuation">;</span>
    <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">translateX</span><span class="token punctuation">(</span>50%<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>

  <span class="token selector">75%</span> <span class="token punctuation">&#123;</span>
    <span class="token property">opacity</span><span class="token punctuation">:</span> 1<span class="token punctuation">;</span>
    <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">translateX</span><span class="token punctuation">(</span>0<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>

  <span class="token selector">100%</span> <span class="token punctuation">&#123;</span>
    <span class="token property">opacity</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
    <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">translateX</span><span class="token punctuation">(</span>-50%<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token atrule"><span class="token rule">@keyframes</span> fadeThird</span> <span class="token punctuation">&#123;</span>
  <span class="token selector">0%</span> <span class="token punctuation">&#123;</span>
    <span class="token property">opacity</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
    <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">translateX</span><span class="token punctuation">(</span>150%<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>

  <span class="token selector">25%</span> <span class="token punctuation">&#123;</span>
    <span class="token property">opacity</span><span class="token punctuation">:</span> 1<span class="token punctuation">;</span>
    <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">translateX</span><span class="token punctuation">(</span>100%<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>

  <span class="token selector">50%</span> <span class="token punctuation">&#123;</span>
    <span class="token property">opacity</span><span class="token punctuation">:</span> 1<span class="token punctuation">;</span>
    <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">translateX</span><span class="token punctuation">(</span>50%<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>

  <span class="token selector">75%</span> <span class="token punctuation">&#123;</span>
    <span class="token property">opacity</span><span class="token punctuation">:</span> 1<span class="token punctuation">;</span>
    <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">translateX</span><span class="token punctuation">(</span>0<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>

  <span class="token selector">100%</span> <span class="token punctuation">&#123;</span>
    <span class="token property">opacity</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
    <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">translateX</span><span class="token punctuation">(</span>-50%<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>最后实现效果</p>
<p><img src="/posts/32636/2021-4-28_10-16-45.gif" alt="GIF 2021-4-28 10-16-45"></p>
</li>
<li><p>对于每个已显示的头像使用 setTimeout 进行设置每个时间段的动画（会有卡顿不圆滑）</p>
</li>
<li><p>微信小程序的关键帧动画</p>
<p>将每个元素动态绑定动画，但是没有延时设置，所以手动 setTimeout 挂载动画实现，由于是单线程的，如在进行动画的时候点击运行斐波那契数列，就会出现动画卡住的问题。</p>
<p>实现延时绑定的方法参考链接：<a href="https://github.com/Advanced-Frontend/Daily-Interview-Question/issues/389">每隔 1s 输出一个结果</a></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> <span class="token punctuation">&#123;</span> log <span class="token punctuation">&#125;</span> <span class="token operator">=</span> console
<span class="token keyword">const</span> <span class="token function-variable function">delay</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">context<span class="token punctuation">,</span> fn<span class="token punctuation">,</span> params</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'delay'</span><span class="token punctuation">)</span>
      <span class="token function">fn</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> params<span class="token punctuation">)</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>
<span class="token function">Page</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
  <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token literal-property property">itemList</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token function-variable function">onLoad</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">const</span> list <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span>itemList
    <span class="token keyword">const</span> that <span class="token operator">=</span> <span class="token keyword">this</span>
    <span class="token keyword">function</span> <span class="token function">setDelay</span><span class="token punctuation">(</span><span class="token parameter">i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> promise <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">></span> list<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token keyword">return</span>
      promise <span class="token operator">=</span> promise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token function">delay</span><span class="token punctuation">(</span>that<span class="token punctuation">,</span> that<span class="token punctuation">.</span>animation<span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">item_</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>i<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
      <span class="token function">setDelay</span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> promise<span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
    <span class="token function">setDelay</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token function">animation</span><span class="token punctuation">(</span><span class="token parameter">id</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">animate</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">#</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>id<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
      <span class="token punctuation">&#123;</span> <span class="token literal-property property">opacity</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token literal-property property">translateX</span><span class="token operator">:</span> <span class="token number">40</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
      <span class="token punctuation">&#123;</span> <span class="token literal-property property">opacity</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token literal-property property">translateX</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
      <span class="token punctuation">&#123;</span> <span class="token literal-property property">opacity</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token literal-property property">translateX</span><span class="token operator">:</span> <span class="token operator">-</span><span class="token number">40</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">5000</span><span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token function">transitionend</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// log('transitionend')</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>小程序对async、await支持度不高</p>
</blockquote>
<p>以上代码实现效果：</p>
<p><img src="/posts/32636/2021-4-27_16-15-13.gif" alt="GIF 2021-4-27 16-15-13"></p>
<p>动画卡住问题：运行一段时间之后点击运行斐波那契数列，运行结束后才继续执行。</p>
<p><img src="/posts/32636/2021-4-27_17-25-20.gif" alt="GIF 2021-4-27 17-25-20"></p>
</li>
</ol>
<p>最后使用 CSS 动画的样式实现，运行 Fibonacci 函数时不会发生卡顿现象。</p>
<p>最后和产品沟通 最终实现效果是 简单的滑动</p>
<p><img src="/posts/32636/2021-5-26_15-55-25.gif" alt="GIF 2021-5-26 15-55-25"></p>
<p>这种比较简单，使用了两个重复数组进行拼接，会在动画的结尾回到头部，但是不会给人明显的跳动感</p>
<p>样式部分：</p>
<pre class="line-numbers language-less" data-language="less"><code class="language-less"><span class="token variable">@avatarWidth<span class="token punctuation">:</span></span> 48rpx<span class="token punctuation">;</span>
<span class="token variable">@avatarSpace<span class="token punctuation">:</span></span> <span class="token operator">-</span>18rpx<span class="token punctuation">;</span>
<span class="token variable">@avatarItem<span class="token punctuation">:</span></span> 10<span class="token punctuation">;</span>

<span class="token variable">@startPos<span class="token punctuation">:</span></span> <span class="token operator">-</span>50rpx<span class="token punctuation">;</span>
<span class="token variable">@endPos<span class="token punctuation">:</span></span> <span class="token variable">@startPos</span> <span class="token operator">-</span> <span class="token variable">@avatarItem</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token variable">@avatarWidth</span> <span class="token operator">+</span> <span class="token variable">@avatarSpace</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token selector">.avatarList</span> <span class="token punctuation">&#123;</span>
    <span class="token property">margin-right</span><span class="token punctuation">:</span> 12rpx<span class="token punctuation">;</span>
    <span class="token property">height</span><span class="token punctuation">:</span> 48rpx<span class="token punctuation">;</span>
    <span class="token property">width</span><span class="token punctuation">:</span> 108rpx<span class="token punctuation">;</span>
    <span class="token property">overflow</span><span class="token punctuation">:</span> hidden<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token selector">.listWrap</span> <span class="token punctuation">&#123;</span>
    <span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">;</span>
    <span class="token property">align-items</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token selector">.move</span> <span class="token punctuation">&#123;</span>
    <span class="token property">animation</span><span class="token punctuation">:</span> 5s move infinite linear<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token selector">.avatarItem</span> <span class="token punctuation">&#123;</span>
    <span class="token property">flex-shrink</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
    <span class="token property">margin-right</span><span class="token punctuation">:</span> <span class="token variable">@avatarSpace</span><span class="token punctuation">;</span>
    <span class="token property">height</span><span class="token punctuation">:</span> <span class="token variable">@avatarWidth</span><span class="token punctuation">;</span>
    <span class="token property">width</span><span class="token punctuation">:</span> <span class="token variable">@avatarWidth</span><span class="token punctuation">;</span>
    <span class="token property">background</span><span class="token punctuation">:</span> #eee<span class="token punctuation">;</span>
    <span class="token property">border</span><span class="token punctuation">:</span> 1px solid #fff<span class="token punctuation">;</span>
    <span class="token property">border-radius</span><span class="token punctuation">:</span> 50%<span class="token punctuation">;</span>
    <span class="token property">box-sizing</span><span class="token punctuation">:</span> border<span class="token operator">-</span>box<span class="token punctuation">;</span>
    <span class="token property">overflow</span><span class="token punctuation">:</span> hidden<span class="token punctuation">;</span>
    <span class="token selector">.avatar</span> <span class="token punctuation">&#123;</span>
        <span class="token property">height</span><span class="token punctuation">:</span> <span class="token variable">@avatarWidth</span><span class="token punctuation">;</span>
        <span class="token property">width</span><span class="token punctuation">:</span> <span class="token variable">@avatarWidth</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token atrule">@keyframes move</span> <span class="token punctuation">&#123;</span>
  <span class="token selector">0%</span> <span class="token punctuation">&#123;</span>
    <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">translateX</span><span class="token punctuation">(</span><span class="token variable">@startPos</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>

  <span class="token selector">100%</span> <span class="token punctuation">&#123;</span>
    <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">translateX</span><span class="token punctuation">(</span><span class="token variable">@endPos</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>布局部分：</p>
<pre class="line-numbers language-vue" data-language="vue"><code class="language-vue">&lt;view class&#x3D;&quot;avatarList&quot;&gt;
    &lt;view class&#x3D;&quot;listWrap &#123;&#123; isCurrent ? &#39;move&#39; : &#39;&#39; &#125;&#125;&quot;&gt;
        &lt;view class&#x3D;&quot;avatarItem&quot; wx:for&#x3D;&quot;&#123;&#123; info.members &#125;&#125;&quot; wx:key&#x3D;&quot;index&quot;&gt;
            &lt;image class&#x3D;&quot;avatar&quot; lazy-load&#x3D;&quot;true&quot; mode&#x3D;&quot;aspectFill&quot; src&#x3D;&quot;&#123;&#123; item &#125;&#125;?imageView2&#x2F;1&#x2F;w&#x2F;20&#x2F;h&#x2F;20&quot;&gt;&lt;&#x2F;image&gt;
        &lt;&#x2F;view&gt;
        &lt;view class&#x3D;&quot;avatarItem&quot; wx:for&#x3D;&quot;&#123;&#123; info.members &#125;&#125;&quot; wx:key&#x3D;&quot;*this&quot;&gt;
            &lt;image class&#x3D;&quot;avatar&quot; lazy-load&#x3D;&quot;true&quot; mode&#x3D;&quot;aspectFill&quot; src&#x3D;&quot;&#123;&#123; item &#125;&#125;?imageView2&#x2F;1&#x2F;w&#x2F;20&#x2F;h&#x2F;20&quot;&gt;&lt;&#x2F;image&gt;
        &lt;&#x2F;view&gt;
    &lt;&#x2F;view&gt;
&lt;&#x2F;view&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h4 id="swiper踩坑"><a href="#swiper踩坑" class="headerlink" title="swiper踩坑"></a>swiper踩坑</h4><p>记录时间：2021-5-26</p>
<p>swiper 如果使用动态加载的方式，如果重新设置已经渲染的列表，会打乱swiper内部顺序。需要保证前面加载过的item不能被挪掉否则swiper内部可能会错乱。</p>
<p>社区中类似问题：</p>
<p><a href="https://developers.weixin.qq.com/community/develop/doc/000cae89c0cc485873a77891056400">动态改变渲染swiper-item的数组时出现current为-1的情况</a></p>
<p><a href="https://developers.weixin.qq.com/community/develop/doc/0004a643b348b096b8b95cb1e56c00?_at=1622043738957">【必现】动态修改 swiper-item bug：添加 swiper-item 当前页面变空白</a></p>
<p>current变为-1问题，使用开关控制显隐强制重新渲染，解决问题。</p>
<p>动态加载更换当前页面内容变为空白时，改变 <code>currentIndex</code> 为有效位后再进行移动。</p>
<blockquote>
<p>会滑动到列表中的某一位置，而不是指定位置。</p>
<p>业务逻辑会判断当前需要过滤的列表内容是否包含首位数据项。</p>
<p>特殊情况，过滤项包含当前显示项和首位数据项，则要先滑动到有效位（即未过滤数据项）后，再更新列表数据，滑动到第一项。</p>
<p>如果过滤项不包含首位数据项可以直接手动滑动到第一项，再更新列表，如果包含则不能直接滑动到第一项，否则会同样出现空白问题，需要先更新列表后滑动到第一项。</p>
</blockquote>
<p>动态加载问题总结：</p>
<ul>
<li><p>整个列表全换</p>
</li>
<li><p>只减少部分列表内容</p>
<ul>
<li>减少部分是否包含首位数据项</li>
<li>减少部分是否包含当前加载数据项 且 包含首位数据项</li>
<li>其他情况</li>
</ul>
</li>
</ul>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> <span class="token punctuation">&#123;</span> data<span class="token punctuation">,</span> errcode<span class="token punctuation">,</span> circle_data <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> is_all_buy <span class="token punctuation">&#125;</span> <span class="token operator">=</span> res<span class="token punctuation">.</span>data
<span class="token keyword">const</span> firstId <span class="token operator">=</span> circle_data<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>id
<span class="token keyword">const</span> originCircleLen <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>circleList<span class="token punctuation">.</span>length
<span class="token keyword">const</span> newCircleLen <span class="token operator">=</span> circle_data<span class="token punctuation">.</span>length
<span class="token keyword">this</span><span class="token punctuation">.</span>customData<span class="token punctuation">.</span>currentItemId <span class="token operator">=</span> firstId
<span class="token comment">// 初始加载</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>originCircleLen <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>circleList <span class="token operator">=</span> circle_data
    <span class="token keyword">this</span><span class="token punctuation">.</span>circlePurchaseStatus <span class="token operator">=</span> <span class="token operator">!</span><span class="token operator">!</span>is_all_buy
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$apply</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getRecommend</span><span class="token punctuation">(</span>firstId<span class="token punctuation">)</span>
    <span class="token keyword">return</span> 
<span class="token punctuation">&#125;</span>

<span class="token comment">// 判断是否买了新圈子</span>
<span class="token keyword">const</span> currentCircles <span class="token operator">=</span> circle_data<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=></span> item<span class="token punctuation">.</span>id<span class="token punctuation">)</span>
<span class="token comment">// 判断之前的圈子列表和新的列表是否有出入</span>
<span class="token keyword">const</span> filterIds <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">const</span> filters <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>circleList<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>currentCircles<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        filterIds<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">return</span> <span class="token boolean">false</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> filterFirst <span class="token operator">=</span> filterIds<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>circlePurchaseStatus <span class="token operator">=</span> <span class="token operator">!</span><span class="token operator">!</span>is_all_buy
<span class="token comment">// 没有买圈子 全买 与全未购之间也无差别 仅修改性别 不修改地区 无差别</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>filters<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> 
    <span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>circlePurchaseStatus <span class="token operator">&amp;&amp;</span> 
    <span class="token operator">!</span>refresh <span class="token operator">&amp;&amp;</span> 
    originCircleLen <span class="token operator">===</span> newCircleLen<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">let</span> timer <span class="token operator">=</span> <span class="token keyword">null</span>
<span class="token keyword">const</span> changeFullCircle <span class="token operator">=</span> filterIds<span class="token punctuation">.</span>length <span class="token operator">===</span> originCircleLen <span class="token comment">// 过滤更换圈子和旧圈子列表长度相等 可能是换整个圈子列表</span>
<span class="token comment">// 换地区 换整个圈子： 如果没有滑动 走初始先置 如果已经滑动</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>changeFullCircle <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>customData<span class="token punctuation">.</span>hasSwitchSwiper<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>showSwiper <span class="token operator">=</span> <span class="token boolean">false</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>currentItemIndex <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>circleList <span class="token operator">=</span> circle_data
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$apply</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    timer <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>showSwiper <span class="token operator">=</span> <span class="token boolean">true</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$apply</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getRecommend</span><span class="token punctuation">(</span>firstId<span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">// 特殊情况：过滤列表包含当前滑动位 不是全部换圈子 还是同一个地区列表</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>filterFirst <span class="token operator">&amp;&amp;</span> filterIds<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>currentItemIndex<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>changeFullCircle<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// 找到一个不等于 currentItemIndex 且有效的位置 不是连续的前三位 不是连续的后三位</span>
    <span class="token keyword">let</span> validIndex <span class="token operator">=</span> filterIds<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">let</span> lastIndex <span class="token operator">=</span> originCircleLen <span class="token operator">-</span> <span class="token number">1</span>
    <span class="token comment">// 等于最后一个位置 从后往前找 找到有效位</span>
    validIndex <span class="token operator">=</span> validIndex <span class="token operator">===</span> lastIndex <span class="token operator">?</span> <span class="token function">findBackValid</span><span class="token punctuation">(</span>filterIds<span class="token punctuation">,</span> lastIndex<span class="token punctuation">,</span> validIndex<span class="token punctuation">,</span> validIndex<span class="token punctuation">)</span> <span class="token operator">:</span> validIndex <span class="token operator">+</span> <span class="token number">1</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>currentItemIndex <span class="token operator">=</span> validIndex
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$apply</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">// 过滤列表包含第一个圈子 初始先置</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>filterFirst<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// 如果买的是第一个圈子 则不能先置index</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>circleList <span class="token operator">=</span> circle_data
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$apply</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    timer <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        timer <span class="token operator">=</span> <span class="token keyword">null</span>
        <span class="token comment">// 特殊情况下没有用 小程序会自动再置回特殊情况位</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>currentItemIndex <span class="token operator">=</span> <span class="token number">0</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$apply</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getRecommend</span><span class="token punctuation">(</span>firstId<span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">// 其他情况 refresh</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>currentItemIndex <span class="token operator">=</span> <span class="token number">0</span>
<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$apply</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
timer <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    timer <span class="token operator">=</span> <span class="token keyword">null</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>circleList <span class="token operator">=</span> circle_data
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$apply</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getRecommend</span><span class="token punctuation">(</span>firstId<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>


<span class="token comment">// =============================</span>
<span class="token comment">/**
 * 从后向前找有效位
 * @param &#123;Number[]&#125; list
 * @param &#123;Number&#125; last 
 * @param &#123;Number&#125; previous 
 * @param &#123;Number&#125; current 
 * @returns 
 */</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">findBackValid</span><span class="token punctuation">(</span><span class="token parameter">list<span class="token punctuation">,</span> last<span class="token punctuation">,</span> previous<span class="token punctuation">,</span> current <span class="token operator">=</span> previous</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token comment">// 如果当前的index 等于最后一个 往前找</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>current <span class="token operator">===</span> last<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      previous <span class="token operator">=</span> current <span class="token comment">// 保存当前值</span>
      current <span class="token operator">=</span> list<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      last <span class="token operator">-=</span> <span class="token number">1</span>
      <span class="token keyword">return</span> <span class="token function">findBackValid</span><span class="token punctuation">(</span>last<span class="token punctuation">,</span> previous<span class="token punctuation">,</span> current<span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span>
  <span class="token comment">// 当前的index 不等于最后一个index 判断和上一个是否是连续的index</span>
  <span class="token keyword">const</span> next <span class="token operator">=</span> previous <span class="token operator">-</span> <span class="token number">1</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>next <span class="token operator">===</span> current<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token comment">// 是连续的index 返回最前面的index</span>
      <span class="token keyword">return</span> next <span class="token operator">-</span> <span class="token number">1</span>
  <span class="token punctuation">&#125;</span>
  <span class="token comment">// 不是连续的index 就返回中间的</span>
  <span class="token keyword">return</span> next
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h5 id="粗暴的解决方案："><a href="#粗暴的解决方案：" class="headerlink" title="粗暴的解决方案："></a>粗暴的解决方案：</h5><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 直接控制显隐问题</span>
<span class="token keyword">let</span> timer <span class="token operator">=</span> <span class="token keyword">null</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>showSwiper <span class="token operator">=</span> <span class="token boolean">false</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>currentItemIndex <span class="token operator">=</span> <span class="token number">0</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>circleList <span class="token operator">=</span> circle_data
<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$apply</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
timer <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>showSwiper <span class="token operator">=</span> <span class="token boolean">true</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$apply</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getRecommend</span><span class="token punctuation">(</span>firstId<span class="token punctuation">)</span>
    timer <span class="token operator">=</span> <span class="token keyword">null</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h5 id="swiper-其他相关问题"><a href="#swiper-其他相关问题" class="headerlink" title="swiper 其他相关问题"></a>swiper 其他相关问题</h5><p>答案记录：</p>
<p><a href="https://developers.weixin.qq.com/community/develop/article/doc/000ecafb3486f07000c92c3225c013">微信小程序答题页——swiper渲染优化及swiper分页实现</a></p>
<h4 id="web-view-缓存问题"><a href="#web-view-缓存问题" class="headerlink" title="web-view 缓存问题"></a>web-view 缓存问题</h4><p>记录时间：2021-5-27</p>
<p><a href="https://blog.csdn.net/qq_36131788/article/details/106750835">微信公众号H5页面缓存问题解决方案！</a></p>
<p><a href="https://developers.weixin.qq.com/community/develop/doc/0008c2ffd30188f862ba7fe3b57800">小程序里webview打开的H5页面怎么清除缓存？</a></p>
<h4 id="image-自适应高度"><a href="#image-自适应高度" class="headerlink" title="image 自适应高度"></a>image 自适应高度</h4><p>记录时间：2021-6-8</p>
<p>style 设置 <code>width: 100%</code></p>
<p>image 标签 <code>mode=&quot;widthFix&quot;</code></p>
<h4 id="IOS-时间处理兼容"><a href="#IOS-时间处理兼容" class="headerlink" title="IOS 时间处理兼容"></a>IOS 时间处理兼容</h4><p>记录时间：2021-6-30</p>
<p>IOS 中将 <code>String</code> 转换成 <code>Date</code> 类型时需要注意 <code>String</code> 的格式</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 兼容 ios 无法识别 yyyy-MM-dd hh:mm:ss 格式 需要转换成 yyyy/MM/dd hh:mm:ss 或 yyyy-MM-ddThh:mm:ss</span>
<span class="token keyword">let</span> serverTime <span class="token operator">=</span> <span class="token string">'2021-06-30 17:12:23'</span> <span class="token comment">// || Date.now()</span>
<span class="token keyword">typeof</span> serverTime <span class="token operator">===</span> <span class="token string">'string'</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>serverTime <span class="token operator">=</span> serverTime<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">,</span> <span class="token string">'T'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">// 或</span>
<span class="token comment">// typeof serverTime === 'string' &amp;&amp; (serverTime = serverTime.replace(/-/g, '/'))</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h4 id="音频播放"><a href="#音频播放" class="headerlink" title="音频播放"></a>音频播放</h4><p>记录时间：2021-7-23</p>
<p>iOS 静音模式下，如果不进行特殊的设置，在有音量的情况下无法播放出声音，需要使用 <code>wx.setInnerAudioOption(Object object)</code> API 进行全局设置。</p>
<p>如果在相同的音频地址下，重复设置地址不是重新播放而是继续播放。</p>
<p>Android 环境下，如果正在播放第一条音频，再点开第二条音频，即使重新设置了音频对象的src，但会出现两条音频同时播放的情况，所以需要手动 stop 之后再设置 src 进行 play。</p>
<h4 id="无限列表"><a href="#无限列表" class="headerlink" title="无限列表"></a>无限列表</h4><p>记录时间：2021-7-23</p>
<p>需求是页面实现一个列表，但是产品没有限制列表长度，导致刷到34页（20条/页）时，爆栈了。</p>
<p>小程序社区官方回复页面可以存在 16000 个节点，如果页面过于复杂则需要删减。</p>
<p>如果限制了页码长度（趋于极限位），刷到极限页面，再在页面上做操作时会非常的卡顿，所以利用滑动窗口原理实现一个无限列表，仅维持页面上的2页（40条）数据。</p>
<blockquote>
<p>至于为什么是2页数据，是为了下滑/上滑加载新的一页时，当前屏显示的数据仍保持在原位，加载完成后，用户可以继续往下滑查看数据，有更好的交互体验。可以大于2页，但是需要根据当前页面的复杂程度，页面节点越多页面性能越差。</p>
</blockquote>
<p>Android 和 iOS 的表现差异在于，iOS有回弹机制，而 Android 则需要手动定位。但是在 wepy 框架和原生小程序中表现不一致，不确定是否是页面结构的问题。</p>
<p>实现方案：分页加载 + 分页显示</p>
<p>项目截图效果和实验截图效果：</p>
<p><img src="./无限列表1.gif" alt="无限列表1" style="zoom:80%;" /><img src="./无限列表2.gif" alt="无限列表2" style="zoom:80%;" /></p>
<p>项目中使用的是 wepy 1.7.x 写的，子组件中监听 scroll-view 的 <code>scrolltoupper</code> 事件和 <code>scrolltolower</code> 事件，并向父组件进行派发，父组件进一步处理响应事件。</p>
<p>父组件中的相关逻辑：</p>
<p>框架编译后有个问题就是无法关闭 iOS 的<strong>回弹效果，因此会在一段时间内持续触发 <code>scrolltoupper</code> 事件和 <code>scrolltolower</code> 事件</strong> ，如果不设置时间间隔，设置好的滚动位会被回弹重新设置到顶部位置。</p>
<blockquote>
<p>无法关闭 iOS 的回弹效果：微信小程序中的文档属性设置也都设置正确（真机打开调试模式查看 WXML 文档结构上组件的属性，加以验证），也增加了 ScrollViewContext 的 bounces 控制，但是依旧不生效，可能和页面结构有关，没有深究。 </p>
</blockquote>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">customData <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    <span class="token literal-property property">voiceCurrentPage</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token literal-property property">tempVoiceList</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token literal-property property">isAllVoice</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>          <span class="token comment">// 已经加载完所有的voice list</span>
    <span class="token literal-property property">waitBounceTime</span><span class="token operator">:</span> <span class="token number">1000</span><span class="token punctuation">,</span>       <span class="token comment">// 处理 ios回弹问题</span>
    <span class="token literal-property property">voiceScrollNode</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>      <span class="token comment">// scroll 节点</span>
<span class="token punctuation">&#125;</span>

<span class="token function">onReady</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    wx<span class="token punctuation">.</span><span class="token function">createSelectorQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token string">'#voicesView'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">node</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">const</span> scrollView <span class="token operator">=</span> res<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>node
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>scrollView<span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>customData<span class="token punctuation">.</span>voiceScrollNode <span class="token operator">=</span> scrollView
        scrollView<span class="token punctuation">.</span>bounces <span class="token operator">=</span> <span class="token boolean">false</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// =================== 核心代码部分 ===============================</span>
<span class="token comment">// 上一页</span>
<span class="token function">handlePrevPage</span><span class="token punctuation">(</span><span class="token parameter">scrollTop</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// TODO</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>customData<span class="token punctuation">.</span>isVoiceLoading<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span>
    <span class="token punctuation">&#125;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'handlePrevPage'</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> voiceCurrentPage<span class="token punctuation">,</span> tempVoiceList<span class="token punctuation">,</span> voiceScrollNode <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>customData
    <span class="token keyword">const</span> len <span class="token operator">=</span> tempVoiceList<span class="token punctuation">.</span>length
    <span class="token keyword">if</span> <span class="token punctuation">(</span>len <span class="token operator">&lt;</span> <span class="token number">3</span> <span class="token operator">||</span> voiceCurrentPage <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span>
    <span class="token punctuation">&#125;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'handlePrevPage before: '</span><span class="token punctuation">,</span> voiceCurrentPage<span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>customData<span class="token punctuation">.</span>isVoiceLoading <span class="token operator">=</span> <span class="token boolean">true</span>
    wx<span class="token punctuation">.</span><span class="token function">showLoading</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
        <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">'上一页'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">mask</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
    voiceScrollNode<span class="token punctuation">.</span>scrollEnabled <span class="token operator">=</span> <span class="token boolean">false</span>
    <span class="token comment">// 窗口滑动</span>
    <span class="token keyword">let</span> timer1 <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">let</span> list <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>voiceList<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span> <span class="token comment">// 当前列表第一页数据</span>
        <span class="token keyword">const</span> viewId <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">item_</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span> list<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>id <span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span>
        list<span class="token punctuation">.</span><span class="token function">unshift</span><span class="token punctuation">(</span><span class="token operator">...</span>tempVoiceList<span class="token punctuation">[</span>voiceCurrentPage <span class="token operator">-</span> <span class="token number">2</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">// 数组的index 要比页数少一</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>voiceList <span class="token operator">=</span> list
        <span class="token keyword">this</span><span class="token punctuation">.</span>customData<span class="token punctuation">.</span>voiceCurrentPage <span class="token operator">=</span> voiceCurrentPage <span class="token operator">-</span> <span class="token number">1</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$apply</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'handlePrevPage after: '</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>customData<span class="token punctuation">.</span>voiceCurrentPage<span class="token punctuation">)</span>
        <span class="token keyword">let</span> timer2 <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>voiceViewId <span class="token operator">=</span> viewId
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$apply</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            timer2 <span class="token operator">=</span> <span class="token keyword">null</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>customData<span class="token punctuation">.</span>isVoiceLoading <span class="token operator">=</span> <span class="token boolean">false</span>
            wx<span class="token punctuation">.</span><span class="token function">hideLoading</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            voiceScrollNode<span class="token punctuation">.</span>scrollEnabled <span class="token operator">=</span> <span class="token boolean">true</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
        timer1 <span class="token operator">=</span> <span class="token keyword">null</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>customData<span class="token punctuation">.</span>waitBounceTime<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 下一页</span>
<span class="token function">handleNextPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// TODO</span>
    <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> voiceCurrentPage<span class="token punctuation">,</span> tempVoiceList<span class="token punctuation">,</span> voiceScrollNode <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>customData
    <span class="token keyword">if</span> <span class="token punctuation">(</span>voiceCurrentPage <span class="token operator">===</span> tempVoiceList<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'handleNextPage new'</span><span class="token punctuation">,</span> voiceCurrentPage<span class="token punctuation">,</span> tempVoiceList<span class="token punctuation">.</span>length<span class="token punctuation">)</span>
        <span class="token comment">// 获取下一页数据</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getVoiceList</span><span class="token punctuation">(</span>voiceCurrentPage <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'handleNextPage old before'</span><span class="token punctuation">,</span> voiceCurrentPage<span class="token punctuation">,</span> tempVoiceList<span class="token punctuation">.</span>length<span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>customData<span class="token punctuation">.</span>isVoiceLoading<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">return</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>customData<span class="token punctuation">.</span>isVoiceLoading <span class="token operator">=</span> <span class="token boolean">true</span>
        wx<span class="token punctuation">.</span><span class="token function">showLoading</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
            <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">'下一页'</span><span class="token punctuation">,</span>
            <span class="token literal-property property">mask</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
        voiceScrollNode<span class="token punctuation">.</span>scrollEnabled <span class="token operator">=</span> <span class="token boolean">false</span>
        <span class="token keyword">let</span> timer <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
            <span class="token comment">// 窗口滑动</span>
            <span class="token keyword">let</span> list <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>voiceList<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">20</span><span class="token punctuation">)</span>
            list <span class="token operator">=</span> list<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>tempVoiceList<span class="token punctuation">[</span>voiceCurrentPage<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">// 最后一页数据 + 数组的index 要比页数少一</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>voiceList <span class="token operator">=</span> list
            <span class="token keyword">this</span><span class="token punctuation">.</span>customData<span class="token punctuation">.</span>voiceCurrentPage <span class="token operator">=</span> voiceCurrentPage <span class="token operator">+</span> <span class="token number">1</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$apply</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'handleNextPage old after'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>customData<span class="token punctuation">.</span>voiceCurrentPage<span class="token punctuation">)</span>

            <span class="token keyword">this</span><span class="token punctuation">.</span>customData<span class="token punctuation">.</span>isVoiceLoading <span class="token operator">=</span> <span class="token boolean">false</span>
            wx<span class="token punctuation">.</span><span class="token function">hideLoading</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            voiceScrollNode<span class="token punctuation">.</span>scrollEnabled <span class="token operator">=</span> <span class="token boolean">true</span>
            timer <span class="token operator">=</span> <span class="token keyword">null</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>customData<span class="token punctuation">.</span>waitBounceTime<span class="token punctuation">)</span> 
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 获取新数据</span>
<span class="token function">getVoiceList</span><span class="token punctuation">(</span><span class="token parameter">page</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>customData<span class="token punctuation">.</span>isVoiceLoading <span class="token operator">||</span> <span class="token keyword">this</span><span class="token punctuation">.</span>customData<span class="token punctuation">.</span>isAllVoice<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>customData<span class="token punctuation">.</span>isVoiceLoading <span class="token operator">=</span> <span class="token boolean">true</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$apply</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">loading</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
        circleApi<span class="token punctuation">.</span><span class="token function">getRecommendVoice</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
            <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
                page
            <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
            <span class="token literal-property property">getToken</span><span class="token operator">:</span> <span class="token boolean">true</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
            <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
                <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>customData<span class="token punctuation">.</span>waitBounceTime<span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> errcode<span class="token punctuation">,</span> data <span class="token punctuation">&#125;</span> <span class="token operator">=</span> res<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>data
        <span class="token keyword">if</span> <span class="token punctuation">(</span>errcode <span class="token operator">!==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">return</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> user_list<span class="token punctuation">,</span> man_mask_list<span class="token punctuation">,</span> woman_mask_list <span class="token punctuation">&#125;</span> <span class="token operator">=</span> data
        <span class="token keyword">if</span> <span class="token punctuation">(</span>user_list<span class="token punctuation">.</span>length <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token comment">// 缓存新数据</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>customData<span class="token punctuation">.</span>tempVoiceList<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>user_list<span class="token punctuation">)</span>

            <span class="token keyword">this</span><span class="token punctuation">.</span>voiceList <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>voiceList<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>user_list<span class="token punctuation">)</span>

            <span class="token keyword">this</span><span class="token punctuation">.</span>customData<span class="token punctuation">.</span>voiceCurrentPage <span class="token operator">=</span> page
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'voiceCurrentPage: '</span><span class="token punctuation">,</span> page<span class="token punctuation">)</span>

        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>customData<span class="token punctuation">.</span>isAllVoice <span class="token operator">=</span> <span class="token boolean">true</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>customData<span class="token punctuation">.</span>isVoiceLoading <span class="token operator">=</span> <span class="token boolean">false</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$apply</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">hideLoading</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>customData<span class="token punctuation">.</span>isVoiceLoading <span class="token operator">=</span> <span class="token boolean">false</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">hideLoading</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>实验代码：</p>
<p>实验代码会和实际项目有差异，原因在于实验小程序成功取消了 iOS 的回弹效果。</p>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token comment">&lt;!-- WXML --></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>container<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scroll-view</span> 
                 <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>scrollView<span class="token punctuation">"</span></span>
                 <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>scrollView<span class="token punctuation">"</span></span>
                 <span class="token attr-name">scroll-y</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span>
                 <span class="token attr-name">scroll-anchoring</span>
                 <span class="token attr-name">enhanced</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>&#123;&#123; true &#125;&#125;<span class="token punctuation">"</span></span>
                 <span class="token attr-name">bounces</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>&#123;&#123; false &#125;&#125;<span class="token punctuation">"</span></span>
                 <span class="token attr-name">scroll-into-view</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>&#123;&#123; toView &#125;&#125;<span class="token punctuation">"</span></span>
                 <span class="token attr-name">bindscrolltoupper</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>upper<span class="token punctuation">"</span></span> 
                 <span class="token attr-name">bindscrolltolower</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>lower<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name"><span class="token namespace">wx:</span>for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>&#123;&#123; itemList &#125;&#125;<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">wx:</span>key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>item<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>item_&#123;&#123; item &#125;&#125;<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>scroll-view-item<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
            &#123;&#123; item &#125;&#125;
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scroll-view</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token comment">/* WXSS */</span>
<span class="token selector">.scrollView</span> <span class="token punctuation">&#123;</span>
  <span class="token property">width</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>
  <span class="token property">height</span><span class="token punctuation">:</span> 100vh<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token selector">.scroll-view-item</span><span class="token punctuation">&#123;</span>
  <span class="token property">height</span><span class="token punctuation">:</span> 300rpx<span class="token punctuation">;</span>
  <span class="token property">line-height</span><span class="token punctuation">:</span> 300rpx<span class="token punctuation">;</span>
  <span class="token property">text-align</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span>
  <span class="token property">font-size</span><span class="token punctuation">:</span> 48rpx<span class="token punctuation">;</span>
  <span class="token property">font-weight</span><span class="token punctuation">:</span> bold<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token selector">.scroll-view-item:nth-child(odd)</span> <span class="token punctuation">&#123;</span>
  <span class="token property">background-color</span><span class="token punctuation">:</span> beige<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token selector">.scroll-view-item:nth-child(even)</span> <span class="token punctuation">&#123;</span>
  <span class="token property">background-color</span><span class="token punctuation">:</span> bisque<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">more</span><span class="token punctuation">(</span><span class="token parameter">start</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> start<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> start <span class="token operator">+</span> <span class="token number">20</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    list<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span>
  <span class="token keyword">return</span> list
<span class="token punctuation">&#125;</span>

<span class="token function">Page</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
  <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token literal-property property">toView</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
    <span class="token literal-property property">itemList</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>

  <span class="token literal-property property">customData</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token literal-property property">tempList</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token literal-property property">currentPage</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token literal-property property">loading</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token literal-property property">scrollView</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
    <span class="token literal-property property">itemNum</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>

  <span class="token function">onLoad</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">const</span> list <span class="token operator">=</span> <span class="token function">more</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>customData<span class="token punctuation">.</span>tempList<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>list<span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
      <span class="token literal-property property">itemList</span><span class="token operator">:</span> list
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>

  <span class="token function">onReady</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">const</span> query <span class="token operator">=</span> wx<span class="token punctuation">.</span><span class="token function">createSelectorQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    query<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token string">'#scrollView'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">node</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    query<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token string">'#scrollView'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">boundingClientRect</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    query<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token string">'.scroll-view-item'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">boundingClientRect</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    query<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">const</span> scrollView <span class="token operator">=</span> res<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>node
      scrollView<span class="token punctuation">.</span>bounces <span class="token operator">=</span> <span class="token boolean">false</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>customData<span class="token punctuation">.</span>itemNum <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>res<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>height <span class="token operator">/</span> res<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span>height<span class="token punctuation">)</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>customData<span class="token punctuation">.</span>itemNum<span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>

  <span class="token function">upper</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>customData<span class="token punctuation">.</span>loading<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">return</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>customData<span class="token punctuation">.</span>loading <span class="token operator">=</span> <span class="token boolean">true</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">promiseTimeout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">prevItems</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>customData<span class="token punctuation">.</span>loading <span class="token operator">=</span> <span class="token boolean">false</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>

  <span class="token function">lower</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>customData<span class="token punctuation">.</span>loading<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">return</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>customData<span class="token punctuation">.</span>loading <span class="token operator">=</span> <span class="token boolean">true</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">promiseTimeout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">nextItems</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>customData<span class="token punctuation">.</span>loading <span class="token operator">=</span> <span class="token boolean">false</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>

  <span class="token function">prevItems</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> tempList<span class="token punctuation">,</span> currentPage <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>customData
    <span class="token keyword">let</span> list <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span>itemList
    <span class="token keyword">this</span><span class="token punctuation">.</span>customData<span class="token punctuation">.</span>currentPage <span class="token operator">=</span> currentPage <span class="token operator">-</span> <span class="token number">1</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>tempList<span class="token punctuation">.</span>len <span class="token operator">&lt;</span> <span class="token number">2</span> <span class="token operator">||</span> currentPage <span class="token operator">&lt;</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">return</span>
    <span class="token punctuation">&#125;</span>
    list <span class="token operator">=</span> list<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> itemId <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">item_</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>list<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span>
    list<span class="token punctuation">.</span><span class="token function">unshift</span><span class="token punctuation">(</span><span class="token operator">...</span>tempList<span class="token punctuation">[</span>currentPage <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
      <span class="token literal-property property">itemList</span><span class="token operator">:</span> list
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
        <span class="token literal-property property">toView</span><span class="token operator">:</span> itemId
      <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>

  <span class="token function">nextItems</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> tempList<span class="token punctuation">,</span> currentPage<span class="token punctuation">,</span> itemNum <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>customData
    <span class="token keyword">const</span> len <span class="token operator">=</span> tempList<span class="token punctuation">.</span>length
    <span class="token keyword">let</span> list <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span>itemList
    <span class="token keyword">this</span><span class="token punctuation">.</span>customData<span class="token punctuation">.</span>currentPage <span class="token operator">=</span> currentPage <span class="token operator">+</span> <span class="token number">1</span>
    list <span class="token operator">=</span> list<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">20</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> itemId <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">item_</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>list<span class="token punctuation">[</span>list<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span> <span class="token operator">-</span> itemNum<span class="token punctuation">]</span><span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>currentPage <span class="token operator">===</span> len <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">const</span> newList <span class="token operator">=</span> <span class="token function">more</span><span class="token punctuation">(</span><span class="token punctuation">(</span>currentPage <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">20</span><span class="token punctuation">)</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>customData<span class="token punctuation">.</span>tempList<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>newList<span class="token punctuation">)</span>
      list <span class="token operator">=</span> list<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>newList<span class="token punctuation">)</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
        <span class="token literal-property property">itemList</span><span class="token operator">:</span> list
      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
          <span class="token literal-property property">toView</span><span class="token operator">:</span> itemId
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
      list <span class="token operator">=</span> list<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>tempList<span class="token punctuation">[</span>currentPage <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
        <span class="token literal-property property">itemList</span><span class="token operator">:</span> list
      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
          <span class="token literal-property property">toView</span><span class="token operator">:</span> itemId
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>

  <span class="token function">promiseTimeout</span><span class="token punctuation">(</span><span class="token parameter">time <span class="token operator">=</span> <span class="token number">0</span></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">let</span> timer <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        timer <span class="token operator">=</span> <span class="token keyword">null</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> time<span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>脱离小程序平台，可以使用虚拟 DOM 的方式进行实践，补充更多阅读的文章：<a href="https://juejin.cn/post/6995334008603148295">https://juejin.cn/post/6995334008603148295</a></p>
</blockquote>
<h3 id="wepy-1-7-X-踩坑"><a href="#wepy-1-7-X-踩坑" class="headerlink" title="wepy 1.7.X 踩坑"></a>wepy 1.7.X 踩坑</h3><h4 id="repeat"><a href="#repeat" class="headerlink" title="repeat"></a>repeat</h4><p>坑记录：<a href="https://github.com/Tencent/wepy/issues/1549">https://github.com/Tencent/wepy/issues/1549</a></p>
<h5 id="关于-swiper"><a href="#关于-swiper" class="headerlink" title="关于 swiper"></a>关于 swiper</h5><p>如果使用 repeat组件进行循环包裹 swiper-item 原生组件中使用的自定义组件，则向自定义组件传入的值无法进行隔离，接收的 prop 除渲染在 view 上的数据，其他数据则一直为首个数据项，如果需要传值，则需要将数据保存在 data-* 上，或方法定义传值。</p>
<h5 id="关于watch"><a href="#关于watch" class="headerlink" title="关于watch"></a>关于watch</h5><p>普通组件中可以使用watch属性，被repeat包裹的组件就无法进行watch</p>
<h5 id="关于循环组件中的data-状态切换"><a href="#关于循环组件中的data-状态切换" class="headerlink" title="关于循环组件中的data 状态切换"></a>关于循环组件中的data 状态切换</h5><p>状态切换不是单一的，会影响到整个 repeat 渲染列表。</p>
<h4 id="事件相关"><a href="#事件相关" class="headerlink" title="事件相关"></a>事件相关</h4><p>组件自定义事件，只能绑定自定义事件名</p>
<p>组件捕获，外部页面捕获能够截断组件内部捕获，同名 capture。</p>
<blockquote>
<p>注意 加上阻止事件冒泡 capture-catch（<code>@tap.capture.stop</code>）</p>
</blockquote>
<p>父子组件事件捕获是用的同一个链上的，如果同名，会响应父组件定义的事件捕获。</p>
<p>最后的解决方法是用遮罩。</p>
<p>wepy v1.7.* 中的写法  <code>@tap=&quot;onAvatar(&#123;&#123; item.user_id &#125;&#125;)&quot;</code> 编译后会拆成两部分，传入的参数和调用的函数，所以后续新增的方法没有做兼容旧不能使用 wepy v1.7.* 中事件传入参数的方式。</p>
<h4 id="组件"><a href="#组件" class="headerlink" title="组件"></a>组件</h4><p>记录时间：2021-7-23</p>
<p>子组件绑定到小程序组件上的属性值必须要通过 data 定义的方式进行传递，否则编译后，会找不到数据。</p>
<p>编译前的开发代码</p>
<img src="./wepy组件编译前.jpg" alt="wepy组件编译前" style="zoom:67%;" />

<p>编译后的 page 页面中的代码，会直接将组件嵌入到页面中。</p>
<p><img src="/./wepy%E7%BC%96%E8%AF%91%E5%90%8E.jpg" alt="wepy编译后"></p>
<blockquote>
<p>wepy 出现的时候小程序不支持组件化开发，所以 wepy 低版本中是将组件中的 html 直接嵌入到 page 中。</p>
</blockquote>
<p>编译前后的子组件数据。</p>
<img src="./wepy data编译前.jpg" alt="wepy data编译前" style="zoom: 67%;" />

<p><img src="/./wepy%E7%BC%96%E8%AF%91%E5%90%8E%E7%9A%84%E5%AD%90%E7%BB%84%E4%BB%B6.jpg" alt="wepy编译后的子组件"></p>
<p>组件中定义属性错误的使用方式示例：</p>
<img src="./wepy开发错误示例.jpg" alt="wepy开发错误示例" style="zoom:67%;" />

<p><img src="/./wepy%E7%BC%96%E8%AF%91%E5%90%8E%E7%9A%84%E9%94%99%E8%AF%AF%E7%A4%BA%E4%BE%8B.jpg" alt="wepy编译后的错误示例"></p>
<p>子组件中并没有定义 变量名为 true / false 的变量，取不到时则为 undefined， 所以设置的属性并不生效。</p>
<h4 id="数据更新"><a href="#数据更新" class="headerlink" title="数据更新"></a>数据更新</h4><p>记录时间：2021-8-9</p>
<p>自定义数据 customData 在页面销毁后仍然保存在内存中，下次创建页面时仍然上上一次遗留的数据，而 data 就不会。</p>
<h3 id="工作问题总结"><a href="#工作问题总结" class="headerlink" title="工作问题总结"></a>工作问题总结</h3><p>总是会觉得自己没有认真的做事，负责任的做事，出了事情就陷入无限自责，但是仍然不知悔改下次继续再犯，就像惯犯说的，只有无限次和零的区别。</p>
<p>每次都会生气，生同事的气，生自己的气，生自己之前错怪同事的气，开始陷入无限的自怨自艾中，开启自暴自弃，放弃学习，放弃积极向上的想法。人生失败是常事，但是不能掉入坑中顺势躺平了，觉得现在这样也挺好，慢慢的会变成井底之蛙，丧失了竞争力和积极性，人生的意义大打折扣。</p>
<p>希望每次我做错事情之后能够反思并且牢记下次不再犯。</p>
<h4 id="5月问题记录"><a href="#5月问题记录" class="headerlink" title="5月问题记录"></a>5月问题记录</h4><p>记录时间：2021-5-28</p>
<h5 id="promise-await"><a href="#promise-await" class="headerlink" title="promise await"></a>promise await</h5><p>promise reject 错误抛出后使用 await 没有处理 reject 抛出的错误，await 只接受 resolve 正确返回，所以要使用 try … catch … 的方式处理 await 的错误。</p>
<h5 id="问题处理过于复杂化"><a href="#问题处理过于复杂化" class="headerlink" title="问题处理过于复杂化"></a>问题处理过于复杂化</h5><p>总是会在 wepy 框架的坑中常住，每次开发都会光顾同样的坑。</p>
<p>对于特殊问题需要进行特殊方式处理。</p>
<p>以全页点击进行获取用户授权信息为例，之前的做法是使用组件页面内容作为组件的slot，组件内部根据用户授权状态判断是否使用button进行包裹，结果最简单粗暴的方法就是直接全页覆盖一个 button 的遮罩，如果用户已经授权就隐藏遮罩，简单直接，不需要组件包裹。</p>
<p>这种做法是不符合逻辑的嘛？不是，只是更加的简单有效，就像解一道数学题一样，传统解法和另辟蹊径的解法结果都是一样的。然而传统解法需要考虑很多东西，另辟蹊径的解法简单粗暴，当然优劣因实际情况而异，上述问题应该使用简单粗暴的解法。</p>
<p>学的多容易进入化简为繁的死胡同，适时跳出来未尝不可。</p>
<p><strong>过度在乎性能问题！</strong></p>
<p><strong>对于性能损耗问题是在于能够完全解决问题的基础上再考虑的事情！</strong></p>
<h5 id="偷懒"><a href="#偷懒" class="headerlink" title="偷懒"></a>偷懒</h5><p>总是做完不喜欢自测，然后直接将问题抛给测试，让测试推动开发，这种习惯很不好，所以需要端正工作态度，如果问题过多抛给他人解决，反而会浪费更多的时间。</p>
]]></content>
      <categories>
        <category>总结</category>
        <category>工作</category>
      </categories>
      <tags>
        <tag>前端</tag>
        <tag>工作</tag>
        <tag>微信小程序</tag>
        <tag>技巧</tag>
        <tag>二次开发</tag>
        <tag>小程序动画</tag>
      </tags>
  </entry>
  <entry>
    <title>API集合</title>
    <url>/posts/22470/</url>
    <content><![CDATA[<h4 id="参考链接："><a href="#参考链接：" class="headerlink" title="参考链接："></a>参考链接：</h4><p>各类免费API推荐，再也不怕找不到免费API了： <a href="https://www.jianshu.com/p/d0ffe5f482dc">https://www.jianshu.com/p/d0ffe5f482dc</a></p>
<p>免费API接口汇总：<a href="https://segmentfault.com/a/1190000017047048?utm_source=tag-newest">https://segmentfault.com/a/1190000017047048?utm_source=tag-newest</a></p>
<h4 id="平台："><a href="#平台：" class="headerlink" title="平台："></a>平台：</h4><p>openapi.top： <a href="https://www.apiopen.top/api.html">https://www.apiopen.top/api.html</a></p>
<p>bejson： <a href="http://www.bejson.com/knownjson/webInterface/">http://www.bejson.com/knownjson/webInterface/</a></p>
<p>wanandroid： <a href="https://www.wanandroid.com/blog/show/2">https://www.wanandroid.com/blog/show/2</a></p>
<p>sojson： <a href="https://www.sojson.com/api/weather.html">https://www.sojson.com/api/weather.html</a></p>
]]></content>
      <categories>
        <category>工具</category>
      </categories>
      <tags>
        <tag>工具</tag>
        <tag>API</tag>
      </tags>
  </entry>
  <entry>
    <title>CSS-块级布局</title>
    <url>/posts/87e30cee/</url>
    <content><![CDATA[<h3 id="相关定义"><a href="#相关定义" class="headerlink" title="相关定义"></a><a href="https://developer.mozilla.org/zh-CN/docs/Learn/CSS/CSS_layout">相关定义</a></h3><p>自适应布局：一套代码，多设备自适应显示。</p>
<p>响应式布局：多套代码，不同设备尺寸范围布局方案不同。</p>
<h3 id="布局样式"><a href="#布局样式" class="headerlink" title="布局样式"></a>布局样式</h3><h4 id="弹性盒"><a href="#弹性盒" class="headerlink" title="弹性盒"></a><a href="https://developer.mozilla.org/zh-CN/docs/Learn/CSS/CSS_layout/Flexbox">弹性盒</a></h4><p>弹性盒子是一种用于按行或按列布局元素的一维布局方法 。元素可以膨胀以填充额外的空间, 收缩以适应更小的空间。</p>
<h5 id="Flex-基本概念"><a href="#Flex-基本概念" class="headerlink" title="Flex 基本概念"></a>Flex 基本概念</h5><p>Flex 用来为盒状模型提供最大的灵活性，弹性盒子。</p>
<p>采用 Flex 布局的元素，称为 Flex 容器，它的所有子元素自动成为容器成员。</p>
<p>容器默认存在两根轴：水平的主轴（main axis）和垂直的交叉轴（cross axis）。主轴的开始位置（与边框的交叉点）叫做<code>main start</code>，结束位置叫做<code>main end</code>；交叉轴的开始位置叫做<code>cross start</code>，结束位置叫做<code>cross end</code>。</p>
<p>项目默认沿主轴排列。单个项目占据的主轴空间叫做<code>main size</code>，占据的交叉轴空间叫做<code>cross size</code>。</p>
<p><img src="/posts/87e30cee/flex.png" alt="flex"></p>
<h5 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h5><pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">;</span> <span class="token comment">/* 将对象作为弹性伸缩盒显示 */</span>
<span class="token property">display</span><span class="token punctuation">:</span> inline-flex<span class="token punctuation">;</span> <span class="token comment">/* 将对象作为内联块级弹性伸缩盒显示 */</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>块级会默认 width = 100%，而内联样式需要指定 width，或者内容撑开 width。</p>
<h5 id="父元素属性"><a href="#父元素属性" class="headerlink" title="父元素属性"></a>父元素属性</h5><h6 id="flex-direction-主轴方向"><a href="#flex-direction-主轴方向" class="headerlink" title="flex-direction 主轴方向"></a>flex-direction 主轴方向</h6><p>决定主轴方向，即子元素排列方向。</p>
<pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token selector">.box</span> <span class="token punctuation">&#123;</span>
  <span class="token property">flex-direction</span><span class="token punctuation">:</span> row | row-reverse | column | column-reverse<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>flex 默认横向。</p>
<ul>
<li><code>row</code>（默认值）：主轴为水平方向，起点在左端。</li>
<li><code>row-reverse</code>：主轴为水平方向，起点在右端。</li>
<li><code>column</code>：主轴为垂直方向，起点在上沿。</li>
<li><code>column-reverse</code>：主轴为垂直方向，起点在下沿。</li>
</ul>
<h6 id="flex-wrap-换行"><a href="#flex-wrap-换行" class="headerlink" title="flex-wrap 换行"></a>flex-wrap 换行</h6><p>默认情况下，项目都排在一条线（又称”轴线”）上。<code>flex-wrap</code>属性定义，如果一条轴线排不下，如何换行。</p>
<pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token selector">.box</span><span class="token punctuation">&#123;</span>
  <span class="token property">flex-wrap</span><span class="token punctuation">:</span> nowrap | wrap | wrap-reverse<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<ul>
<li><code>nowrap</code>（默认值）：不换行。</li>
<li><code>wrap</code>：换行，第一行在上方。</li>
<li><code>wrap-reverse</code>：换行，第一行在下方。</li>
</ul>
<h6 id="flex-flow-联合属性"><a href="#flex-flow-联合属性" class="headerlink" title="flex-flow 联合属性"></a>flex-flow 联合属性</h6><p><code>flex-flow</code>属性是<code>flex-direction</code>属性和<code>flex-wrap</code>属性的简写形式，默认值为<code>row nowrap</code>。</p>
<pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token selector">.box</span> <span class="token punctuation">&#123;</span>
  <span class="token property">flex-flow</span><span class="token punctuation">:</span> &lt;flex-direction> || &lt;flex-wrap><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<h6 id="justify-content-主轴对齐方式"><a href="#justify-content-主轴对齐方式" class="headerlink" title="justify-content 主轴对齐方式"></a>justify-content 主轴对齐方式</h6><p><code>justify-content</code>属性定义了项目在主轴上的对齐方式。</p>
<pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token selector">.box</span> <span class="token punctuation">&#123;</span>
  <span class="token property">justify-content</span><span class="token punctuation">:</span> flex-start | flex-end | center | space-between | space-around<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>默认主轴方向横向：</p>
<ul>
<li><code>flex-start</code>（默认值）：左对齐</li>
<li><code>flex-end</code>：右对齐</li>
<li><code>center</code>： 居中</li>
<li><code>space-between</code>：两端对齐，项目之间的间隔都相等。</li>
<li><code>space-around</code>：每个项目两侧的间隔相等。所以，项目之间的间隔比项目与边框的间隔大一倍。</li>
</ul>
<h6 id="align-items-交叉轴上对齐方式"><a href="#align-items-交叉轴上对齐方式" class="headerlink" title="align-items 交叉轴上对齐方式"></a>align-items 交叉轴上对齐方式</h6><p><code>align-items</code>属性定义项目在交叉轴上如何对齐。</p>
<pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token selector">.box</span> <span class="token punctuation">&#123;</span>
  <span class="token property">align-items</span><span class="token punctuation">:</span> flex-start | flex-end | center | baseline | stretch<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>默认交叉轴为纵轴：</p>
<ul>
<li><code>flex-start</code>：交叉轴的起点对齐。</li>
<li><code>flex-end</code>：交叉轴的终点对齐。</li>
<li><code>center</code>：交叉轴的中点对齐。</li>
<li><code>baseline</code>: 项目的第一行文字的基线对齐。</li>
<li><code>stretch</code>（默认值）：如果项目未设置高度或设为auto，将占满整个容器的高度。</li>
</ul>
<h6 id="align-content-多根轴线对齐方式"><a href="#align-content-多根轴线对齐方式" class="headerlink" title="align-content 多根轴线对齐方式"></a>align-content 多根轴线对齐方式</h6><pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token selector">.box</span> <span class="token punctuation">&#123;</span>
  <span class="token property">align-content</span><span class="token punctuation">:</span> flex-start | flex-end | center | space-between | space-around | stretch<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>一般换行才会有多根轴线情况出现：</p>
<ul>
<li><code>flex-start</code>：与交叉轴的起点对齐。</li>
<li><code>flex-end</code>：与交叉轴的终点对齐。</li>
<li><code>center</code>：与交叉轴的中点对齐。</li>
<li><code>space-between</code>：与交叉轴两端对齐，轴线之间的间隔平均分布。</li>
<li><code>space-around</code>：每根轴线两侧的间隔都相等。所以，轴线之间的间隔比轴线与边框的间隔大一倍。</li>
<li><code>stretch</code>（默认值）：轴线占满整个交叉轴。</li>
</ul>
<h5 id="子元素属性"><a href="#子元素属性" class="headerlink" title="子元素属性"></a>子元素属性</h5><h6 id="order-排列顺序"><a href="#order-排列顺序" class="headerlink" title="order 排列顺序"></a>order 排列顺序</h6><p><code>order</code>属性定义项目的排列顺序。数值越小，排列越靠前，默认为0。</p>
<pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token selector">.item</span> <span class="token punctuation">&#123;</span>
  <span class="token property">order</span><span class="token punctuation">:</span> &lt;integer><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<h6 id="flex-grow-放大比例"><a href="#flex-grow-放大比例" class="headerlink" title="flex-grow 放大比例"></a>flex-grow 放大比例</h6><p><code>flex-grow</code>属性定义项目的放大比例，默认为<code>0</code>，即如果存在剩余空间，也不放大。</p>
<pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token selector">.item</span> <span class="token punctuation">&#123;</span>
  <span class="token property">flex-grow</span><span class="token punctuation">:</span> &lt;number><span class="token punctuation">;</span> <span class="token comment">/* default 0 */</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>如果所有项目的<code>flex-grow</code>属性都为1，则它们将等分剩余空间（如果有的话）。如果一个项目的<code>flex-grow</code>属性为2，其他项目都为1，则前者占据的剩余空间将比其他项多一倍。</p>
<h6 id="flex-shrink-缩小比例"><a href="#flex-shrink-缩小比例" class="headerlink" title="flex-shrink 缩小比例"></a>flex-shrink 缩小比例</h6><p><code>flex-shrink</code>属性定义了项目的缩小比例，默认为1，即如果空间不足，该项目将缩小。</p>
<pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token selector">.item</span> <span class="token punctuation">&#123;</span>
  <span class="token property">flex-shrink</span><span class="token punctuation">:</span> &lt;number><span class="token punctuation">;</span> <span class="token comment">/* default 1 */</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>设置为0时，不缩小。负值对该属性无效。</p>
<p>如果所有项目的<code>flex-shrink</code>属性都为1，当空间不足时，都将等比例缩小。如果一个项目的<code>flex-shrink</code>属性为0，其他项目都为1，则空间不足时，前者不缩小。</p>
<h6 id="flex-basis-占主轴空间大小"><a href="#flex-basis-占主轴空间大小" class="headerlink" title="flex-basis  占主轴空间大小"></a>flex-basis  占主轴空间大小</h6><p><code>flex-basis</code>属性定义了在分配多余空间之前，项目占据的主轴空间（main size）。浏览器根据这个属性，计算主轴是否有多余空间。它的默认值为<code>auto</code>，即项目的本来大小。</p>
<pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token selector">.item</span> <span class="token punctuation">&#123;</span>
  <span class="token property">flex-basis</span><span class="token punctuation">:</span> &lt;length> | auto<span class="token punctuation">;</span> <span class="token comment">/* default auto */</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>它可以设为跟<code>width</code>或<code>height</code>属性一样的值（比如350px），则项目将占据固定空间。</p>
<blockquote>
<p>flex-basis 属性设置的 0 和 0%，表示的不一样，0% 的效果和 auto 的效果是一样的。</p>
<p>参考链接：<a href="https://stackoverflow.com/questions/63475073/css-flex-basis-0-has-different-behaviour-to-flex-basis-0px">https://stackoverflow.com/questions/63475073/css-flex-basis-0-has-different-behaviour-to-flex-basis-0px</a></p>
<blockquote>
<p>The issue is related to the usage of percentage. Using <code>0</code> or <code>0px</code> is trivial since you will set the initial height to be <code>0</code> and then the element will grow to fill the remaining space.</p>
<p>Using <code>N%</code> is a different story because in this case you are setting the initial height to be based on the parent height.</p>
<blockquote>
<p>Percentages: relative to the flex container’s inner main size <a href="https://www.w3.org/TR/css-flexbox-1/#flex-basis-property">ref</a></p>
</blockquote>
<p>In your case, the flex container doesn’t have any explicit size since your are using only a <code>min-height</code> definition so we cannot resolve the percentange value and it will fail to <code>auto</code></p>
</blockquote>
</blockquote>
<h6 id="flex-联合属性"><a href="#flex-联合属性" class="headerlink" title="flex 联合属性"></a>flex 联合属性</h6><p><code>flex</code>属性是<code>flex-grow</code>, <code>flex-shrink</code> 和 <code>flex-basis</code>的简写，默认值为<code>0 1 auto</code>。后两个属性可选。</p>
<pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token selector">.item</span> <span class="token punctuation">&#123;</span>
  <span class="token property">flex</span><span class="token punctuation">:</span> none | [ &lt;<span class="token string">'flex-grow'</span>> &lt;<span class="token string">'flex-shrink'</span>>? || &lt;<span class="token string">'flex-basis'</span>> ]
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>该属性有两个快捷值：<code>auto</code> (<code>1 1 auto</code>) 和 <code>none</code> (<code>0 0 auto</code>)。</p>
<p><strong>建议优先使用这个属性，而不是单独写三个分离的属性</strong>，因为浏览器会推算相关值。</p>
<blockquote>
<p>参考链接：</p>
<p><a href="https://www.zhangxinxu.com/wordpress/2020/10/css-flex-0-1-none/">flex:0 flex:1 flex:none flex:auto应该在什么场景下使用？- 张鑫旭</a></p>
<p><a href="https://www.zhangxinxu.com/wordpress/2019/12/css-flex-deep/">CSS flex属性深入理解 - 张鑫旭</a></p>
</blockquote>
<p><strong>缩写语法</strong>：</p>
<table>
<thead>
<tr>
<th align="center">单值语法</th>
<th align="center">等同于</th>
<th align="center">备注</th>
</tr>
</thead>
<tbody><tr>
<td align="center">flex: initial</td>
<td align="center">flex: 0 1 auto</td>
<td align="center">初始值，常用</td>
</tr>
<tr>
<td align="center">flex: 0</td>
<td align="center">flex: 0 1 0%</td>
<td align="center">适用场景少</td>
</tr>
<tr>
<td align="center">flex: none</td>
<td align="center">flex: 0 0 auto</td>
<td align="center">推荐</td>
</tr>
<tr>
<td align="center">flex: 1</td>
<td align="center">flex: 1 1 0%</td>
<td align="center">推荐</td>
</tr>
<tr>
<td align="center">flex: auto</td>
<td align="center">flex: 1 1 auto</td>
<td align="center">适用场景少</td>
</tr>
</tbody></table>
<p>其中：</p>
<ul>
<li><code>flex:0 1 0%</code>表示<code>flex-grow</code>是0，<code>flex-shrink</code>是1，因此元素尺寸会收缩但不会扩展，在加上<code>flex-basis:0%</code>表示建议支持是0，因此，设置<code>flex:0</code>的元素的最终尺寸表现为最小内容宽度；</li>
<li><code>flex:0 0 auto</code>表示元素尺寸不会收缩也不会扩展，再加上<code>flex-basis:auto</code>表示固定尺寸由内容决定，由于元素不具有弹性，因此，元素内的内容不会换行，最终尺寸通常表现为最大内容宽度。</li>
</ul>
<blockquote>
<p>需要注意单值语法会不会被 loader 插件进行转换，浏览器自动推算不生效。可能会出现和预想不一样的效果。</p>
</blockquote>
<p><strong>应用场景</strong>：</p>
<ul>
<li><p><code>flex: none;</code> 当flex子项的宽度就是内容的宽度，且内容永远不会换行，则适合使用<code>flex:none</code>，这个场景比<code>flex:0</code>适用的场景要更常见。</p>
</li>
<li><p><code>flex:1</code>的尺寸表现更为内敛（优先牺牲自己的尺寸）。当希望元素充分利用剩余空间，同时不会侵占其他元素应有的宽度的时候，适合使用<code>flex:1</code>，这样的场景在Flex布局中非常的多。<strong>不确定可分配到的空间，且子元素不会撑开父元素空间</strong>。</p>
<p><code>flex: 1;</code> 和  <code>flex: 1 1;</code> 最后浏览器推算的是一样的。</p>
</li>
<li><p><code>flex:auto</code>的尺寸表现则更为霸道（优先扩展自己的尺寸）。当希望元素充分利用剩余空间，但是各自的尺寸按照各自内容进行分配的时候，适合使用<code>flex:auto</code>。<code>flex:auto</code>多用于内容固定，或者内容可控的布局场景，</p>
</li>
</ul>
<p><strong>总结</strong>：</p>
<ul>
<li><code>flex:initial</code>表示默认的flex状态，无需专门设置，适合小控件元素的分布布局，或者某一项内容动态变化的布局；</li>
<li><code>flex:0</code>适用场景较少，适合设置在替换元素的父元素上；</li>
<li><code>flex:none</code>适用于不换行的内容固定或者较少的小控件元素上，如按钮。</li>
<li><code>flex:1</code>适合等分布局；</li>
<li><code>flex:auto</code>适合基于内容动态适配的布局；</li>
</ul>
<h6 id="align-self-当前元素对齐方式"><a href="#align-self-当前元素对齐方式" class="headerlink" title="align-self 当前元素对齐方式"></a>align-self 当前元素对齐方式</h6><p><code>align-self</code>属性允许单个项目有与其他项目不一样的对齐方式，可覆盖<code>align-items</code>属性。默认值为<code>auto</code>，表示继承父元素的<code>align-items</code>属性，如果没有父元素，则等同于<code>stretch</code>。</p>
<pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token selector">.item</span> <span class="token punctuation">&#123;</span>
  <span class="token property">align-self</span><span class="token punctuation">:</span> auto | flex-start | flex-end | center | baseline | stretch<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<ul>
<li><code>auto</code>（默认值）：表示继承父元素的<code>align-items</code>属性，如果没有父元素，则等同于<code>stretch</code>。</li>
<li><code>flex-start</code>：交叉轴的起点对齐。</li>
<li><code>flex-end</code>：交叉轴的终点对齐。</li>
<li><code>center</code>：交叉轴的中点对齐。</li>
<li><code>baseline</code>: 项目的第一行文字的基线对齐。</li>
<li><code>stretch</code>（默认值）：如果项目未设置高度或设为auto，将占满整个容器的高度。</li>
</ul>
<h5 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h5><p>Flex 布局教程：语法篇 - 阮一峰： <a href="https://www.ruanyifeng.com/blog/2015/07/flex-grammar.html">https://www.ruanyifeng.com/blog/2015/07/flex-grammar.html</a></p>
<p>Flex 布局教程：实例篇 - 阮一峰：<a href="https://www.ruanyifeng.com/blog/2015/07/flex-examples.html">https://www.ruanyifeng.com/blog/2015/07/flex-examples.html</a></p>
<p>A Complete Guide to Flexbox ： <a href="https://css-tricks.com/snippets/css/a-guide-to-flexbox/">https://css-tricks.com/snippets/css/a-guide-to-flexbox/</a></p>
<h4 id="网格"><a href="#网格" class="headerlink" title="网格"></a><a href="https://developer.mozilla.org/zh-CN/docs/Learn/CSS/CSS_layout/Grids">网格</a></h4><p>网格是一个用于web的二维布局系统。利用网格，你可以把内容按照行与列的格式进行排版。</p>
<h5 id="Grid概念"><a href="#Grid概念" class="headerlink" title="Grid概念"></a>Grid概念</h5><p>网格布局，它将网页划分成一个个网格，可以任意组合不同的网格，做出各种各样的布局。</p>
<p><img src="/posts/87e30cee/grid.png" alt="grid"></p>
<p>行和列：网格布局有行和列的概念。</p>
<p>单元格：行和列的交叉区域。</p>
<p>网格线：划分网络的线。</p>
<h5 id="与-Flex-的区别"><a href="#与-Flex-的区别" class="headerlink" title="与 Flex 的区别"></a>与 Flex 的区别</h5><p>Grid 布局与 <a href="https://www.ruanyifeng.com/blog/2015/07/flex-grammar.html">Flex 布局</a>有一定的相似性，都可以指定容器内部多个项目的位置。但是，它们也存在重大区别。</p>
<p>Flex 布局是轴线布局，只能指定”项目”针对轴线的位置，可以看作是<strong>一维布局</strong>。Grid 布局则是将容器划分成”行”和”列”，产生单元格，然后指定”项目所在”的单元格，可以看作是<strong>二维布局</strong>。Grid 布局远比 Flex 布局强大。</p>
<h5 id="语法-1"><a href="#语法-1" class="headerlink" title="语法"></a>语法</h5><pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token selector">.container</span> <span class="token punctuation">&#123;</span>
  <span class="token property">display</span><span class="token punctuation">:</span> grid | inline-grid<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<ul>
<li><code>grid</code>：块级元素</li>
<li><code>inline-grid</code>：内联块级元素</li>
</ul>
<h5 id="父元素属性-1"><a href="#父元素属性-1" class="headerlink" title="父元素属性"></a>父元素属性</h5><h6 id="grid-template-columns-列-amp-grid-template-rows-行"><a href="#grid-template-columns-列-amp-grid-template-rows-行" class="headerlink" title="grid-template-columns 列 &amp; grid-template-rows 行"></a>grid-template-columns 列 &amp; grid-template-rows 行</h6><p><code>grid-template-columns</code> 划分容器的列，定义每一列的列宽。</p>
<p><code>grid-template-rows</code> 划分容器的行，定义每一列的行高。</p>
<ul>
<li><p><code>none</code>关键字，所有的列和其大小都将由<a href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/grid-auto-columns"><code>grid-auto-columns</code></a> 属性隐式的指定。</p>
</li>
<li><p>绝对单位</p>
</li>
<li><p>百分比</p>
</li>
<li><p><code>repeat()</code> 函数，简化重复值。接受两个参数，重复的次数和重复的值。</p>
<p><code>auto-fill</code>关键字，如果希望每一行（列）容纳尽可能多的单元格，这时可以使用 <code>auto-fill</code> 关键字表示自动填充。</p>
</li>
<li><p><code>fr</code> 关键字，为了方便表示比例关系，网格布局提供了 <code>fr</code> 关键字。如果两列的宽度分别为 <code>1fr</code> 和 <code>2fr</code>，就表示后者是前者的两倍。<code>fr</code>可以与绝对长度的单位结合使用，这时会非常方便。</p>
</li>
<li><p><code>minmax()</code>函数产生一个长度范围，表示长度就在这个范围之中。它接受两个参数，分别为最小值和最大值。</p>
</li>
<li><p><code>auto</code>关键字表示由浏览器自己决定长度。</p>
</li>
<li><p>网格线名称，可以使用方括号指定网格线的名称，方便以后引用。网格线可以拥有多个名字。</p>
</li>
</ul>
<pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token comment">/* Keyword value 这个关键字表示不明确的网格。所有的列和其大小都将由 grid-auto-columns 属性隐式的指定。 */</span>
<span class="token property">grid-template-columns</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span>

<span class="token comment">/* &lt;track-list> values */</span>
<span class="token property">grid-template-columns</span><span class="token punctuation">:</span> 100px 1fr<span class="token punctuation">;</span>
<span class="token property">grid-template-columns</span><span class="token punctuation">:</span> [linename] 100px<span class="token punctuation">;</span>
<span class="token property">grid-template-columns</span><span class="token punctuation">:</span> [linename1] 100px [linename2 linename3]<span class="token punctuation">;</span>
<span class="token property">grid-template-columns</span><span class="token punctuation">:</span> <span class="token function">minmax</span><span class="token punctuation">(</span>100px<span class="token punctuation">,</span> 1fr<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token property">grid-template-columns</span><span class="token punctuation">:</span> <span class="token function">fit-content</span><span class="token punctuation">(</span>40%<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token property">grid-template-columns</span><span class="token punctuation">:</span> <span class="token function">repeat</span><span class="token punctuation">(</span>3<span class="token punctuation">,</span> 200px<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/* &lt;auto-track-list> values */</span>
<span class="token property">grid-template-columns</span><span class="token punctuation">:</span> 200px <span class="token function">repeat</span><span class="token punctuation">(</span>auto-fill<span class="token punctuation">,</span> 100px<span class="token punctuation">)</span> 300px<span class="token punctuation">;</span>
<span class="token property">grid-template-columns</span><span class="token punctuation">:</span> <span class="token function">minmax</span><span class="token punctuation">(</span>100px<span class="token punctuation">,</span> max-content<span class="token punctuation">)</span>
                       <span class="token function">repeat</span><span class="token punctuation">(</span>auto-fill<span class="token punctuation">,</span> 200px<span class="token punctuation">)</span> 20%<span class="token punctuation">;</span>
<span class="token property">grid-template-columns</span><span class="token punctuation">:</span> [linename1] 100px [linename2]
                       <span class="token function">repeat</span><span class="token punctuation">(</span>auto-fit<span class="token punctuation">,</span> [linename3 linename4] 300px<span class="token punctuation">)</span>
                       100px<span class="token punctuation">;</span>
<span class="token property">grid-template-columns</span><span class="token punctuation">:</span> [linename1 linename2] 100px
                       <span class="token function">repeat</span><span class="token punctuation">(</span>auto-fit<span class="token punctuation">,</span> [linename1] 300px<span class="token punctuation">)</span> [linename3]<span class="token punctuation">;</span>

<span class="token comment">/* Global values */</span>
<span class="token property">grid-template-columns</span><span class="token punctuation">:</span> inherit<span class="token punctuation">;</span>
<span class="token property">grid-template-columns</span><span class="token punctuation">:</span> initial<span class="token punctuation">;</span>
<span class="token property">grid-template-columns</span><span class="token punctuation">:</span> unset<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h6 id="grid-template-areas-区域"><a href="#grid-template-areas-区域" class="headerlink" title="grid-template-areas 区域"></a>grid-template-areas 区域</h6><p>网格布局允许指定”区域”（area），一个区域由单个或多个单元格组成。</p>
<p>网格区块(grid areas)和网格项(grid item)沒有关联，但是它们可以和一些网格定位属性(grid-placement properties)关联起来</p>
<p><code>grid-template-areas</code>属性用于定义区域。</p>
<ul>
<li>none：网格容器没有定义任何的网格区块(grid areas)。</li>
<li>string+：每一个给定的字符串会生成一行，一个字符串中用空格分隔的每一个单元(cell)会生成一列。多个同名的，跨越相邻行或列的单元称为网格区块(grid area)。非矩形的网格区块是无效的。string 可以是 grid-area-name。</li>
</ul>
<blockquote>
<p>CSS 类中设置 grid-area-name。如：（grid-area也可为子元素指定区域）</p>
<pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token selector">.a</span> <span class="token punctuation">&#123;</span> <span class="token property">grid-area</span><span class="token punctuation">:</span> a <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</blockquote>
<pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token comment">/* Keyword value */</span>
<span class="token property">grid-template-areas</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span>

<span class="token comment">/* &lt;string> values */</span>
<span class="token property">grid-template-areas</span><span class="token punctuation">:</span> <span class="token string">"a b"</span><span class="token punctuation">;</span> <span class="token comment">/* 一行 两列 */</span>
<span class="token property">grid-template-areas</span><span class="token punctuation">:</span> <span class="token string">"a b b"</span>
                     <span class="token string">"a c d"</span><span class="token punctuation">;</span> <span class="token comment">/* 两行 三列 */</span>
<span class="token property">grid-template-areas</span><span class="token punctuation">:</span> <span class="token string">"a a ."</span> <span class="token comment">/* .表示空的表格 */</span>
           			 <span class="token string">"a a ."</span>
            		 <span class="token string">". b c"</span><span class="token punctuation">;</span>

<span class="token comment">/* Global values */</span>
<span class="token property">grid-template-areas</span><span class="token punctuation">:</span> inherit<span class="token punctuation">;</span> <span class="token comment">/* 继承 */</span>
<span class="token property">grid-template-areas</span><span class="token punctuation">:</span> initial<span class="token punctuation">;</span> <span class="token comment">/* 默认值 */</span>
<span class="token property">grid-template-areas</span><span class="token punctuation">:</span> unset<span class="token punctuation">;</span> <span class="token comment">/* 未设置 */</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>注意，区域的命名会影响到网格线。每个区域的起始网格线，会自动命名为<code>区域名-start</code>，终止网格线自动命名为<code>区域名-end</code>。</p>
<p>比如，区域名为<code>header</code>，则起始位置的水平网格线和垂直网格线叫做<code>header-start</code>，终止位置的水平网格线和垂直网格线叫做<code>header-end</code>。</p>
</blockquote>
<h6 id="grid-template-联合属性"><a href="#grid-template-联合属性" class="headerlink" title="grid-template 联合属性"></a>grid-template 联合属性</h6><p><code>grid-template</code>，CSS属性简写，用以定义网格中rows、columns与areas。</p>
<pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token comment">/* 值为关键词 */</span>
<span class="token property">grid-template</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span>

<span class="token comment">/* 为 grid-template-rows / grid-template-columns */</span>
<span class="token property">grid-template</span><span class="token punctuation">:</span> 100px 1fr / 50px 1fr<span class="token punctuation">;</span>
<span class="token property">grid-template</span><span class="token punctuation">:</span> auto 1fr / auto 1fr auto<span class="token punctuation">;</span>
<span class="token property">grid-template</span><span class="token punctuation">:</span> [linename] 100px / [columnname1] 30% [columnname2] 70%<span class="token punctuation">;</span>
<span class="token property">grid-template</span><span class="token punctuation">:</span> <span class="token function">fit-content</span><span class="token punctuation">(</span>100px<span class="token punctuation">)</span> / <span class="token function">fit-content</span><span class="token punctuation">(</span>40%<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/* 为 grid-template-areas grid-template-rows / grid-template-column */</span>
<span class="token property">grid-template</span><span class="token punctuation">:</span> <span class="token string">"a a a"</span>
               <span class="token string">"b b b"</span><span class="token punctuation">;</span>
<span class="token property">grid-template</span><span class="token punctuation">:</span> <span class="token string">"a a a"</span> 20%
               <span class="token string">"b b b"</span> auto<span class="token punctuation">;</span>
<span class="token property">grid-template</span><span class="token punctuation">:</span> [header-top] <span class="token string">"a a a"</span>     [header-bottom]
                 [main-top] <span class="token string">"b b b"</span> 1fr [main-bottom]
                            / auto 1fr auto<span class="token punctuation">;</span>

<span class="token comment">/* 为全局值 */</span>
<span class="token property">grid-template</span><span class="token punctuation">:</span> inherit<span class="token punctuation">;</span>
<span class="token property">grid-template</span><span class="token punctuation">:</span> initial<span class="token punctuation">;</span>
<span class="token property">grid-template</span><span class="token punctuation">:</span> unset<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h6 id="row-gap-行间距-amp-column-gap-列间距-amp-gap-联合间距"><a href="#row-gap-行间距-amp-column-gap-列间距-amp-gap-联合间距" class="headerlink" title="row-gap 行间距 &amp; column-gap 列间距 &amp; gap 联合间距"></a>row-gap 行间距 &amp; column-gap 列间距 &amp; gap 联合间距</h6><p><code>row-gap</code>属性设置行与行的间隔（行间距）。</p>
<p><code>column-gap</code>属性设置列与列的间隔（列间距）。</p>
<p><code>gap</code>属性是<code>row-gap</code>和<code>column-gap</code>的合并简写形式。</p>
<pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token selector">.container</span> <span class="token punctuation">&#123;</span>
  <span class="token property">row-gap</span><span class="token punctuation">:</span> 20px<span class="token punctuation">;</span>
  <span class="token property">column-gap</span><span class="token punctuation">:</span> 20px<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token selector">.container</span> <span class="token punctuation">&#123;</span>
  <span class="token property">gap</span><span class="token punctuation">:</span> 20px 20px<span class="token punctuation">;</span> <span class="token comment">/* &lt;row-gap> &lt;column-gap> */</span>
<span class="token punctuation">&#125;</span>
<span class="token selector">.container</span> <span class="token punctuation">&#123;</span>
  <span class="token property">gap</span><span class="token punctuation">:</span> 20px<span class="token punctuation">;</span> <span class="token comment">/* &lt;row-gap> = &lt;column-gap> */</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h6 id="grid-auto-flow-子元素顺序"><a href="#grid-auto-flow-子元素顺序" class="headerlink" title="grid-auto-flow 子元素顺序"></a>grid-auto-flow 子元素顺序</h6><p>划分网格以后，容器的子元素会按照顺序，自动放置在每一个网格。默认的放置顺序是”先行后列”，即先填满第一行，再开始放入第二行，即下图数字的顺序。</p>
<ul>
<li><p><code>row</code>（默认值）：先行后列</p>
</li>
<li><p><code>column</code>：先列后行</p>
</li>
<li><p><code>dense</code>：剩下的位置如何摆放。“稠密”堆积算法，如果后面出现了稍小的元素，则会试图去填充网格中前面留下的空白。这样做会填上稍大元素留下的空白，但同时也可能导致原来出现的次序被打乱。</p>
<p>如果省略它，使用一种「稀疏」算法，在网格中布局元素时，布局算法只会「向前」移动，永远不会倒回去填补空白。这保证了所有自动布局元素「按照次序」出现，即使可能会留下被后面元素填充的空白。</p>
</li>
</ul>
<pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token comment">/* Keyword values */</span>
<span class="token property">grid-auto-flow</span><span class="token punctuation">:</span> row<span class="token punctuation">;</span>
<span class="token property">grid-auto-flow</span><span class="token punctuation">:</span> column<span class="token punctuation">;</span>
<span class="token property">grid-auto-flow</span><span class="token punctuation">:</span> dense<span class="token punctuation">;</span>
<span class="token property">grid-auto-flow</span><span class="token punctuation">:</span> row dense<span class="token punctuation">;</span>
<span class="token property">grid-auto-flow</span><span class="token punctuation">:</span> column dense<span class="token punctuation">;</span>

<span class="token comment">/* Global values */</span>
<span class="token property">grid-auto-flow</span><span class="token punctuation">:</span> inherit<span class="token punctuation">;</span>
<span class="token property">grid-auto-flow</span><span class="token punctuation">:</span> initial<span class="token punctuation">;</span>
<span class="token property">grid-auto-flow</span><span class="token punctuation">:</span> unset<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h6 id="justify-items-单元格内水平位置-amp-align-items-单元格内垂直位置-amp-place-items-联合属性"><a href="#justify-items-单元格内水平位置-amp-align-items-单元格内垂直位置-amp-place-items-联合属性" class="headerlink" title="justify-items 单元格内水平位置 &amp; align-items 单元格内垂直位置 &amp; place-items 联合属性"></a>justify-items 单元格内水平位置 &amp; align-items 单元格内垂直位置 &amp; place-items 联合属性</h6><p><code>justify-items</code>属性设置单元格内容的水平位置（左中右）。</p>
<p><code>align-items</code>属性设置单元格内容的垂直位置（上中下）。</p>
<p><code>place-item</code>属性是<code>align-items</code>属性和<code>justify-items</code>属性的合并简写形式。</p>
<ul>
<li>start：对齐单元格的起始边缘。</li>
<li>end：对齐单元格的结束边缘。</li>
<li>center：单元格内部居中。</li>
<li>stretch：拉伸，占满单元格的整个宽度（默认值）。</li>
</ul>
<pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token selector">.container</span> <span class="token punctuation">&#123;</span>
	<span class="token property">justify-items</span><span class="token punctuation">:</span> start<span class="token punctuation">;</span>
	<span class="token property">align-items</span><span class="token punctuation">:</span> start<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token selector">.container</span> <span class="token punctuation">&#123;</span>
	<span class="token property">place-items</span><span class="token punctuation">:</span> start start<span class="token punctuation">;</span> <span class="token comment">/* &lt;align-items>, &lt;justify-items> */</span>
<span class="token punctuation">&#125;</span>
<span class="token selector">.container</span> <span class="token punctuation">&#123;</span>
	<span class="token property">place-items</span><span class="token punctuation">:</span> start<span class="token punctuation">;</span> <span class="token comment">/* &lt;align-items> = &lt;justify-items> */</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h6 id="justify-content-整体内容水平位置-amp-align-content-整体内容垂直位置-amp-place-content-联合属性"><a href="#justify-content-整体内容水平位置-amp-align-content-整体内容垂直位置-amp-place-content-联合属性" class="headerlink" title="justify-content 整体内容水平位置 &amp; align-content 整体内容垂直位置 &amp; place-content 联合属性"></a>justify-content 整体内容水平位置 &amp; align-content 整体内容垂直位置 &amp; place-content 联合属性</h6><p><code>justify-content</code>属性是整个内容区域在容器里面的水平位置（左中右）。</p>
<p><code>align-content</code>属性是整个内容区域的垂直位置（上中下）。</p>
<p><code>place-content</code> 属性是<code>align-content</code>属性和<code>justify-content</code>属性的合并简写形式。</p>
<ul>
<li>start： 对齐容器的起始边框。</li>
<li>end ：对齐容器的结束边框。</li>
<li>center： 容器内部居中。</li>
<li>stretch： 项目大小没有指定时，拉伸占据整个网格容器。</li>
<li>space-around： 每个项目两侧的间隔相等。所以，项目之间的间隔比项目与容器边框的间隔大一倍。</li>
<li>space-between： 项目与项目的间隔相等，项目与容器边框之间没有间隔。</li>
<li>space-evenly： 项目与项目的间隔相等，项目与容器边框之间也是同样长度的间隔。</li>
</ul>
<h6 id="grid-auto-columns-自动创建列-amp-grid-auto-rows-自动创建行"><a href="#grid-auto-columns-自动创建列-amp-grid-auto-rows-自动创建行" class="headerlink" title="grid-auto-columns 自动创建列 &amp; grid-auto-rows 自动创建行"></a>grid-auto-columns 自动创建列 &amp; grid-auto-rows 自动创建行</h6><p> <code>grid-auto-columns</code> 指定了隐式创建的网格纵向轨道（<a href="https://developer.mozilla.org/zh-CN/docs/Glossary/Grid_Tracks">track</a>）的宽度。</p>
<p><code>grid-auto-rows</code> 用于指定隐式创建的行轨道大小。</p>
<p>有时候，一些项目的指定位置，在现有网格的外部。比如网格只有3列，但是某一个项目指定在第5行。这时，浏览器会自动生成多余的网格，以便放置项目。</p>
<p><code>grid-auto-columns</code>属性和<code>grid-auto-rows</code>属性用来设置，浏览器自动创建的多余网格的列宽和行高。它们的写法与<code>grid-template-columns</code>和<code>grid-template-rows</code>完全相同。如果不指定这两个属性，浏览器完全根据单元格内容的大小，决定新增网格的列宽和行高。</p>
<pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token selector">.container</span> <span class="token punctuation">&#123;</span>
  <span class="token property">display</span><span class="token punctuation">:</span> grid<span class="token punctuation">;</span>
  <span class="token property">grid-template-columns</span><span class="token punctuation">:</span> 100px 100px 100px<span class="token punctuation">;</span>
  <span class="token property">grid-template-rows</span><span class="token punctuation">:</span> 100px 100px 100px<span class="token punctuation">;</span>
  <span class="token property">grid-auto-rows</span><span class="token punctuation">:</span> 50px<span class="token punctuation">;</span> 
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>划分好的网格是3行 x 3列，但是，8号项目指定在第4行，9号项目指定在第5行。</p>
<h6 id="grid-合并属性"><a href="#grid-合并属性" class="headerlink" title="grid 合并属性"></a>grid 合并属性</h6><p><code>grid</code>属性是<code>grid-template-rows</code>、<code>grid-template-columns</code>、<code>grid-template-areas</code>、 <code>grid-auto-rows</code>、<code>grid-auto-columns</code>、<code>grid-auto-flow</code>这六个属性的合并简写形式。</p>
<pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token comment">/* &lt;'grid-template'> values */</span>
<span class="token property">grid</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span>
<span class="token property">grid</span><span class="token punctuation">:</span> <span class="token string">"a"</span> 100px <span class="token string">"b"</span> 1fr<span class="token punctuation">;</span>
<span class="token property">grid</span><span class="token punctuation">:</span> [linename1] <span class="token string">"a"</span> 100px [linename2]<span class="token punctuation">;</span>
<span class="token property">grid</span><span class="token punctuation">:</span> <span class="token string">"a"</span> 200px <span class="token string">"b"</span> min-content<span class="token punctuation">;</span>
<span class="token property">grid</span><span class="token punctuation">:</span> <span class="token string">"a"</span> <span class="token function">minmax</span><span class="token punctuation">(</span>100px<span class="token punctuation">,</span> max-content<span class="token punctuation">)</span> <span class="token string">"b"</span> 20%<span class="token punctuation">;</span>
<span class="token property">grid</span><span class="token punctuation">:</span> 100px / 200px<span class="token punctuation">;</span>
<span class="token property">grid</span><span class="token punctuation">:</span> <span class="token function">minmax</span><span class="token punctuation">(</span>400px<span class="token punctuation">,</span> min-content<span class="token punctuation">)</span> / <span class="token function">repeat</span><span class="token punctuation">(</span>auto-fill<span class="token punctuation">,</span> 50px<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/* &lt;'grid-template-rows'> /
   [ auto-flow &amp;&amp; dense? ] &lt;'grid-auto-columns'>? values */</span>
<span class="token property">grid</span><span class="token punctuation">:</span> 200px / auto-flow<span class="token punctuation">;</span>
<span class="token property">grid</span><span class="token punctuation">:</span> 30% / auto-flow dense<span class="token punctuation">;</span>
<span class="token property">grid</span><span class="token punctuation">:</span> <span class="token function">repeat</span><span class="token punctuation">(</span>3<span class="token punctuation">,</span> [line1 line2 line3] 200px<span class="token punctuation">)</span> / auto-flow 300px<span class="token punctuation">;</span>
<span class="token property">grid</span><span class="token punctuation">:</span> [line1] <span class="token function">minmax</span><span class="token punctuation">(</span>20em<span class="token punctuation">,</span> max-content<span class="token punctuation">)</span> / auto-flow dense 40%<span class="token punctuation">;</span>

<span class="token comment">/* [ auto-flow &amp;&amp; dense? ] &lt;'grid-auto-rows'>? /
   &lt;'grid-template-columns'> values */</span>
<span class="token property">grid</span><span class="token punctuation">:</span> auto-flow / 200px<span class="token punctuation">;</span>
<span class="token property">grid</span><span class="token punctuation">:</span> auto-flow dense / 30%<span class="token punctuation">;</span>
<span class="token property">grid</span><span class="token punctuation">:</span> auto-flow 300px / <span class="token function">repeat</span><span class="token punctuation">(</span>3<span class="token punctuation">,</span> [line1 line2 line3] 200px<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token property">grid</span><span class="token punctuation">:</span> auto-flow dense 40% / [line1] <span class="token function">minmax</span><span class="token punctuation">(</span>20em<span class="token punctuation">,</span> max-content<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/* Global values */</span>
<span class="token property">grid</span><span class="token punctuation">:</span> inherit<span class="token punctuation">;</span>
<span class="token property">grid</span><span class="token punctuation">:</span> initial<span class="token punctuation">;</span>
<span class="token property">grid</span><span class="token punctuation">:</span> unset<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h5 id="子元素属性-1"><a href="#子元素属性-1" class="headerlink" title="子元素属性"></a>子元素属性</h5><h6 id="gird-column-start-amp-grid-column-end-amp-grid-row-start-amp-grid-row-end-指定边框"><a href="#gird-column-start-amp-grid-column-end-amp-grid-row-start-amp-grid-row-end-指定边框" class="headerlink" title="gird-column-start &amp; grid-column-end &amp; grid-row-start &amp; grid-row-end 指定边框"></a>gird-column-start &amp; grid-column-end &amp; grid-row-start &amp; grid-row-end 指定边框</h6><p>项目的位置是可以指定的，具体方法就是指定项目的四个边框，分别定位在哪根网格线。</p>
<ul>
<li><code>grid-column-start</code>属性：左边框所在的垂直网格线</li>
<li><code>grid-column-end</code>属性：右边框所在的垂直网格线</li>
<li><code>grid-row-start</code>属性：上边框所在的水平网格线</li>
<li><code>grid-row-end</code>属性：下边框所在的水平网格线</li>
</ul>
<p>值为网格线序列号或者网格线名称。</p>
<p>使用<code>span</code>关键字，表示”跨越”，即左右边框（上下边框）之间跨越多少个网格。</p>
<p>使用这四个属性，如果产生了项目的重叠，则使用<code>z-index</code>属性指定项目的重叠顺序。</p>
<h6 id="grid-column-amp-grid-row-边框合并属性"><a href="#grid-column-amp-grid-row-边框合并属性" class="headerlink" title="grid-column &amp; grid-row 边框合并属性"></a>grid-column &amp; grid-row 边框合并属性</h6><p><code>grid-column</code>属性是<code>grid-column-start</code>和<code>grid-column-end</code>的合并简写形式。</p>
<p><code>grid-row</code>属性是<code>grid-row-start</code>属性和<code>grid-row-end</code>的合并简写形式。</p>
<pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token selector">.item</span> <span class="token punctuation">&#123;</span>
  <span class="token property">grid-column</span><span class="token punctuation">:</span> &lt;start-line> / &lt;end-line><span class="token punctuation">;</span>
  <span class="token property">grid-row</span><span class="token punctuation">:</span> &lt;start-line> / &lt;end-line><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token selector">.item-1</span> <span class="token punctuation">&#123;</span>
  <span class="token property">grid-column</span><span class="token punctuation">:</span> 1 / 3<span class="token punctuation">;</span>
  <span class="token property">grid-row</span><span class="token punctuation">:</span> 1 / 2<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">/* 等同于 */</span>
<span class="token selector">.item-1</span> <span class="token punctuation">&#123;</span>
  <span class="token property">grid-column-start</span><span class="token punctuation">:</span> 1<span class="token punctuation">;</span>
  <span class="token property">grid-column-end</span><span class="token punctuation">:</span> 3<span class="token punctuation">;</span>
  <span class="token property">grid-row-start</span><span class="token punctuation">:</span> 1<span class="token punctuation">;</span>
  <span class="token property">grid-row-end</span><span class="token punctuation">:</span> 2<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h6 id="grid-area-指定区域"><a href="#grid-area-指定区域" class="headerlink" title="grid-area 指定区域"></a>grid-area 指定区域</h6><p><code>grid-area</code>属性指定项目放在哪一个区域。值可以为指定的 <code>grid-area-name</code></p>
<p> <code>grid-area</code> 是一种对于 <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/grid-row-start"><code>grid-row-start</code> (en-US)</a>、<a href="https://developer.mozilla.org/en-US/docs/Web/CSS/grid-column-start"><code>grid-column-start</code> (en-US)</a>、<a href="https://developer.mozilla.org/en-US/docs/Web/CSS/grid-row-end"><code>grid-row-end</code> (en-US)</a> 和 <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/grid-column-end"><code>grid-column-end</code> (en-US)</a> 的简写，通过基线（line），跨度（span）或没有（自动）的网格放置在 <a href="https://developer.mozilla.org/zh-CN/docs/Glossary/Grid_Rows">grid row</a> 中指定一个网格项的大小和位置，继而确定 <a href="https://developer.mozilla.org/zh-CN/docs/Glossary/Grid_Areas">grid area</a> 的边界。</p>
<pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token comment">/* Keyword values */</span>
<span class="token property">grid-area</span><span class="token punctuation">:</span> auto<span class="token punctuation">;</span>
<span class="token property">grid-area</span><span class="token punctuation">:</span> auto / auto<span class="token punctuation">;</span>
<span class="token property">grid-area</span><span class="token punctuation">:</span> auto / auto / auto<span class="token punctuation">;</span>
<span class="token property">grid-area</span><span class="token punctuation">:</span> auto / auto / auto / auto<span class="token punctuation">;</span>

<span class="token comment">/* &lt;custom-ident> values */</span>
<span class="token property">grid-area</span><span class="token punctuation">:</span> some-grid-area<span class="token punctuation">;</span>
<span class="token property">grid-area</span><span class="token punctuation">:</span> some-grid-area / another-grid-area<span class="token punctuation">;</span>

<span class="token comment">/* &lt;integer> &amp;&amp; &lt;custom-ident>? values */</span>
<span class="token property">grid-area</span><span class="token punctuation">:</span> some-grid-area 4<span class="token punctuation">;</span>
<span class="token property">grid-area</span><span class="token punctuation">:</span> some-grid-area 4 / 2 another-grid-area<span class="token punctuation">;</span>

<span class="token comment">/* span &amp;&amp; [ &lt;integer> || &lt;custom-ident> ] values */</span>
<span class="token property">grid-area</span><span class="token punctuation">:</span> span 3<span class="token punctuation">;</span>
<span class="token property">grid-area</span><span class="token punctuation">:</span> span 3 / span some-grid-area<span class="token punctuation">;</span>
<span class="token property">grid-area</span><span class="token punctuation">:</span> 2 span / another-grid-area span<span class="token punctuation">;</span>

<span class="token comment">/* Global values */</span>
<span class="token property">grid-area</span><span class="token punctuation">:</span> inherit<span class="token punctuation">;</span>
<span class="token property">grid-area</span><span class="token punctuation">:</span> initial<span class="token punctuation">;</span>
<span class="token property">grid-area</span><span class="token punctuation">:</span> unset<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h6 id="justify-self-单元格内容水平位置-amp-align-self-单元格内容的垂直位置-amp-place-self-联合属性"><a href="#justify-self-单元格内容水平位置-amp-align-self-单元格内容的垂直位置-amp-place-self-联合属性" class="headerlink" title="justify-self 单元格内容水平位置 &amp; align-self 单元格内容的垂直位置 &amp; place-self 联合属性"></a>justify-self 单元格内容水平位置 &amp; align-self 单元格内容的垂直位置 &amp; place-self 联合属性</h6><p><code>justify-self</code>属性设置单元格内容的水平位置（左中右），跟<code>justify-items</code>属性的用法完全一致，但只作用于单个项目。</p>
<p><code>align-self</code>属性设置单元格内容的垂直位置（上中下），跟<code>align-items</code>属性的用法完全一致，也是只作用于单个项目。</p>
<p><code>place-self</code>属性是<code>align-self</code>属性和<code>justify-self</code>属性的合并简写形式。</p>
<ul>
<li>start：对齐单元格的起始边缘。</li>
<li>end：对齐单元格的结束边缘。</li>
<li>center：单元格内部居中。</li>
<li>stretch：拉伸，占满单元格的整个宽度（默认值）。</li>
</ul>
<pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token selector">.item-1</span>  <span class="token punctuation">&#123;</span>
  <span class="token property">justify-self</span><span class="token punctuation">:</span> start<span class="token punctuation">;</span>
  <span class="token property">align-self</span><span class="token punctuation">:</span> start<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token selector">.item-1</span> <span class="token punctuation">&#123;</span>
  <span class="token property">place-self</span><span class="token punctuation">:</span> start start<span class="token punctuation">;</span> <span class="token comment">/* &lt;align-self> &lt;justify-self> */</span>
<span class="token punctuation">&#125;</span>
<span class="token selector">.item-1</span> <span class="token punctuation">&#123;</span>
  <span class="token property">place-self</span><span class="token punctuation">:</span> start<span class="token punctuation">;</span> <span class="token comment">/* &lt;align-self> = &lt;justify-self> */</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h5 id="参考链接-1"><a href="#参考链接-1" class="headerlink" title="参考链接"></a>参考链接</h5><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/CSS_Grid_Layout">网格布局 - MDN</a></p>
<p><a href="http://www.ruanyifeng.com/blog/2019/03/grid-layout-tutorial.html">CSS Grid 网格布局教程 - 阮一峰</a></p>
<p><a href="https://juejin.cn/post/6854573220306255880">最强大的 CSS 布局 —— Grid 布局 - 掘金</a></p>
<p><a href="https://css-tricks.com/snippets/css/complete-guide-grid/#introduction">A Complete Guide to Grid - CSS Tricks</a></p>
<h5 id="更多阅读"><a href="#更多阅读" class="headerlink" title="更多阅读"></a>更多阅读</h5><p><a href="https://cssgridgarden.com/#zh-cn">一个用来学CSS grid 的游戏</a></p>
<p><a href="https://cssgrid-generator.netlify.app/">CSS Grid Generator</a></p>
<h3 id="格式上下文"><a href="#格式上下文" class="headerlink" title="格式上下文"></a>格式上下文</h3><h4 id="BFC-块级格式上下文"><a href="#BFC-块级格式上下文" class="headerlink" title="BFC - 块级格式上下文"></a>BFC - 块级格式上下文</h4><p>Block formatting contexts</p>
<p><strong>具有 BFC 特性的元素可以看作是隔离了的独立容器，容器里面的元素不会在布局上影响到外面的元素，并且 BFC 具有普通容器所没有的一些特性。</strong></p>
<h5 id="触发BFC"><a href="#触发BFC" class="headerlink" title="触发BFC"></a>触发BFC</h5><ul>
<li>body 根元素</li>
<li>浮动元素：float 除 none 以外的值</li>
<li>绝对定位元素：position (absolute、fixed)</li>
<li>display 为 inline-block、table-cells、flex、table-caption </li>
<li>overflow 除了 visible 以外的值 (hidden、auto、scroll)</li>
</ul>
<h5 id="应用"><a href="#应用" class="headerlink" title="应用"></a>应用</h5><ul>
<li>BFC 可以包含浮动的元素（清除浮动）</li>
<li>BFC 可以阻止元素被浮动元素覆盖</li>
</ul>
<h4 id="IFC-内联格式上下文"><a href="#IFC-内联格式上下文" class="headerlink" title="IFC - 内联格式上下文"></a>IFC - 内联格式上下文</h4><p>IFC（Inline formatting contexts） 的线框高度由其包含行内元素中最高的实际高度计算而来，不受到竖直方向的 padding / margin 影响。</p>
<p>IFC 中的 line box 一般左右都贴紧整个 IFC，但是会因为 float 元素而扰乱。</p>
<p>float 元素会位于 IFC 与 line box 之间，使得 line box 宽度缩短。</p>
<p>同个 IFC 下的多个 line box 高度会不同。</p>
<p>IFC 中不能有块级元素，当插入块级元素时（如 p 中插入 div）会产生两个匿名块与 div 分隔开，即产生两个 IFC，每个 IFC 对外表现为块级元素，与 div 垂直排列。</p>
<h5 id="应用-1"><a href="#应用-1" class="headerlink" title="应用"></a>应用</h5><p>水平居中：当一个块要在环境中水平居中时，设置其为 inline-block 则会在外层产生 IFC，通过 text-align 则可以使其水平居中。</p>
<p>垂直居中：创建一个 IFC，用其中一个元素撑开父元素的高度，然后设置其 vertical-align: middle，其他行内元素则可以在此父元素中垂直居中。</p>
<h4 id="GFC-网格布局格式化上下文"><a href="#GFC-网格布局格式化上下文" class="headerlink" title="GFC - 网格布局格式化上下文"></a>GFC - 网格布局格式化上下文</h4><p>GrideLayout formatting contexts</p>
<h5 id="触发条件"><a href="#触发条件" class="headerlink" title="触发条件"></a>触发条件</h5><p><strong>设置 display 值为 grid。</strong></p>
<h4 id="FFC-自适应格式上下文"><a href="#FFC-自适应格式上下文" class="headerlink" title="FFC - 自适应格式上下文"></a>FFC - 自适应格式上下文</h4><p>Flex formatting contexts</p>
<h5 id="触发条件-1"><a href="#触发条件-1" class="headerlink" title="触发条件"></a>触发条件</h5><p><strong>display 值为 flex 或者 inline-flex 的元素</strong>将会生成自适应容器（flex container）。</p>
<p>通过设置元素的 display 属性为 flex 或 inline-flex 可以得到一个伸缩容器。</p>
<p>设置为 flex 的容器被渲染为一个块级元素，而设置为 inline-flex 的容器则渲染为一个行内元素。</p>
<p>伸缩容器中的每一个子元素都是一个伸缩项目。伸缩项目可以是任意数量的。伸缩容器外和伸缩项目内的一切元素都不受影响。</p>
<h3 id="实践"><a href="#实践" class="headerlink" title="实践"></a>实践</h3><p>flex：</p>
<ul>
<li><p>聊天界面</p>
</li>
<li><p>瀑布流</p>
</li>
</ul>
<p>grid：</p>
<ul>
<li>等分响应式</li>
<li>固定列宽，改变列数量</li>
<li>去掉右侧空白</li>
<li>补全空缺</li>
</ul>
]]></content>
      <categories>
        <category>前端</category>
        <category>CSS</category>
      </categories>
      <tags>
        <tag>前端</tag>
        <tag>CSS</tag>
        <tag>布局</tag>
        <tag>flex</tag>
        <tag>grid</tag>
        <tag>面试</tag>
      </tags>
  </entry>
  <entry>
    <title>CSS-基础</title>
    <url>/posts/390259bc/</url>
    <content><![CDATA[<h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><h4 id="推荐阅读"><a href="#推荐阅读" class="headerlink" title="推荐阅读"></a>推荐阅读</h4><h5 id="掘金"><a href="#掘金" class="headerlink" title="掘金"></a>掘金</h5><p><a href="https://juejin.cn/post/6844903902123393032">你未必知道的49个CSS知识点</a></p>
<p><a href="https://juejin.cn/post/6844903960386469895">你未必知道的CSS知识点（第二季）</a></p>
<p><a href="https://juejin.cn/post/6844904116611727367">CSS揭秘实用技巧总结</a></p>
<p><a href="https://juejin.cn/post/6844903894313598989">前端基础篇之CSS世界</a></p>
<h3 id="基础知识"><a href="#基础知识" class="headerlink" title="基础知识"></a>基础知识</h3><p>很基础的用法就不进行整理了，主要是主观地记录一些易忘和非常规的用法。</p>
<h4 id="盒模型"><a href="#盒模型" class="headerlink" title="盒模型"></a>盒模型</h4><h5 id="padding-百分比的使用"><a href="#padding-百分比的使用" class="headerlink" title="padding 百分比的使用"></a>padding 百分比的使用</h5><p><code>padding</code>属性值如果是百分比值，则无论是水平方向还是垂直方向都相对于宽度计算。</p>
<p>应用场景：可以用于 <code>img</code> 元素的占位使用。</p>
<h5 id="height-100-不生效"><a href="#height-100-不生效" class="headerlink" title="height: 100%; 不生效"></a>height: 100%; 不生效</h5><p>浏览器的 css 渲染是自上而下、自外而内的，即先渲染父元素，再渲染子元素。</p>
<p>height 默认的是 auto 模式，即由浏览器进行计算并给出高度，如果不受其他样式元素影响则高度由子元素高度决定。</p>
<p><strong>对于height属性，如果父元素 height 为 auto，只要子元素在文档流中，其百分比值完全就被忽略了。在 flex 布局中，父元素没有确定的 height 值，子元素的 flex: 1; 也会失效。</strong>所以需要父级元素有一个确定的高度。</p>
<p>如果包含块的高度没有显式指定（即高度由内容决定），并且该元素不是绝对定位，则计算值为auto。auto和百分比计算，肯定是算不了的：<code>auto * 100/100 = NaN</code>。</p>
<p>示例：</p>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>X-UA-Compatible<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>IE=edge<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>width=device-width, initial-scale=1.0<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>Document<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">></span></span><span class="token style"><span class="token language-css">
    <span class="token selector">*</span> <span class="token punctuation">&#123;</span>
      <span class="token property">margin</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
      <span class="token property">padding</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token selector">body</span> <span class="token punctuation">&#123;</span>
      <span class="token property">height</span><span class="token punctuation">:</span> 100vh<span class="token punctuation">;</span> <span class="token comment">/* 令后续子元素 height: 100%; 生效的关键所在 */</span>
    <span class="token punctuation">&#125;</span>
    <span class="token selector">.container</span> <span class="token punctuation">&#123;</span>
      <span class="token property">width</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>
      <span class="token property">height</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token selector">.wrap</span> <span class="token punctuation">&#123;</span>
      <span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">;</span>
      <span class="token property">flex-direction</span><span class="token punctuation">:</span> column<span class="token punctuation">;</span>
      <span class="token property">height</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token selector">.box1</span> <span class="token punctuation">&#123;</span>
      <span class="token property">height</span><span class="token punctuation">:</span> 80px<span class="token punctuation">;</span>
      <span class="token property">background-color</span><span class="token punctuation">:</span> burlywood<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token selector">.box2</span> <span class="token punctuation">&#123;</span>
      <span class="token property">flex</span><span class="token punctuation">:</span> 1<span class="token punctuation">;</span>
      <span class="token comment">/* height: 100%; */</span>
      <span class="token property">background-color</span><span class="token punctuation">:</span> cadetblue<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>container<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>wrap<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>box1<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>box2<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h6 id="如何使-height-100-生效"><a href="#如何使-height-100-生效" class="headerlink" title="如何使 height: 100% 生效"></a>如何使 height: 100% 生效</h6><ol>
<li><p>父元素给定明确的高度。</p>
</li>
<li><p>使用绝对定位。</p>
<p>绝对定位元素的百分比计算和非绝对定位元素的百分比计算是有区别的，区别在于绝对定位的宽高百分比计算是相对于padding box的，也就是说会把 padding 大小值计算在内，但是，非绝对定位元素则是相对于 content box 计算的。</p>
<p>这种方式支持隐式高度计算，但本身脱离文档流，所以在特殊场景下使用会有奇效：如图片左右半区点击分别上一张图下一张图效果。</p>
</li>
</ol>
<blockquote>
<p>《 CSS 世界》- 3.2 width / height 作用的具体细节</p>
<p>扩展阅读：</p>
<p><a href="https://www.zhangxinxu.com/wordpress/2016/09/talking-about-css-infinite-endless-loop/">从height:100%不支持聊聊CSS中的“死循环” - 张鑫旭</a></p>
<p>简单总结一下：CSS 是静态渲染的，先渲染父元素的宽高再渲染子元素的宽高，所以不会存在进入样式渲染死循环当中，但是有时父元素会出现滚动条，那么子元素可操作的空间 content box 需要减去滚动条的距离。</p>
</blockquote>
]]></content>
      <categories>
        <category>前端</category>
        <category>CSS</category>
      </categories>
      <tags>
        <tag>前端</tag>
        <tag>CSS</tag>
      </tags>
  </entry>
  <entry>
    <title>Cookie、Session、Token、JWT</title>
    <url>/posts/21067/</url>
    <content><![CDATA[<h3 id="Cookie、Session、Token、JWT"><a href="#Cookie、Session、Token、JWT" class="headerlink" title="Cookie、Session、Token、JWT"></a>Cookie、Session、Token、JWT</h3><blockquote>
<p> 引入这些技术主要是为了<strong>保持状态</strong>。HTTP协议是无状态协议。</p>
</blockquote>
<h4 id="Cookie"><a href="#Cookie" class="headerlink" title="Cookie"></a><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Cookies">Cookie</a></h4><h5 id="cookie存储在客户端"><a href="#cookie存储在客户端" class="headerlink" title="cookie存储在客户端"></a>cookie存储在客户端</h5><p>   <code>cookie</code> 是服务器发送到用户浏览器并保存在本地的一小块数据，它会在浏览器下次向同一服务器再发起请求时被携带并发送到服务器上。浏览器可储存<code>cookie</code>总大小为4095~4097个字节（不同浏览器不同）。</p>
<h5 id="cookie是不可跨域的"><a href="#cookie是不可跨域的" class="headerlink" title="cookie是不可跨域的"></a>cookie是不可跨域的</h5><p>   每个 <code>cookie</code> 都会绑定单一的域名，无法在别的域名下获取使用，一级域名和二级域名之间是允许共享使用的（靠的是 <code>domain</code>， 如： <a href="http://www.baidu.com)./">www.baidu.com）。</a></p>
<h5 id="限制Cookie访问"><a href="#限制Cookie访问" class="headerlink" title="限制Cookie访问"></a>限制Cookie访问</h5><h6 id="Secure属性"><a href="#Secure属性" class="headerlink" title="Secure属性"></a>Secure属性</h6><p>标记为 <code>Secure</code> 的 Cookie 只应通过被 HTTPS 协议加密过的请求发送给服务端，因此可以预防 <a href="https://developer.mozilla.org/en-US/docs/Glossary/MitM">man-in-the-middle</a> 攻击者的攻击。但即便设置了 <code>Secure</code> 标记，敏感信息也不应该通过 Cookie 传输，因为 Cookie 有其固有的不安全性，<code>Secure</code> 标记也无法提供确实的安全保障, 例如，可以访问客户端硬盘的人可以读取它。</p>
<h6 id="HttpOnly属性"><a href="#HttpOnly属性" class="headerlink" title="HttpOnly属性"></a>HttpOnly属性</h6><p>JavaScript <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Document/cookie"><code>Document.cookie</code></a> API 无法访问带有 <code>HttpOnly</code> 属性的cookie；此类 Cookie 仅作用于服务器。例如，持久化服务器端会话的 Cookie 不需要对 JavaScript 可用，而应具有 <code>HttpOnly</code> 属性。此预防措施有助于缓解<a href="https://wiki.developer.mozilla.org/zh-CN/docs/Web/Security/Types_of_attacks#Cross-site_scripting_(XSS)">跨站点脚本（XSS）</a>攻击。</p>
<pre class="line-numbers language-none"><code class="language-none">Set-Cookie: id&#x3D;a3fWa; Expires&#x3D;Wed, 21 Oct 2015 07:28:00 GMT; Secure; HttpOnly<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>



<h4 id="Session"><a href="#Session" class="headerlink" title="Session"></a>Session</h4><h5 id="session存储在服务器端"><a href="#session存储在服务器端" class="headerlink" title="session存储在服务器端"></a>session存储在服务器端</h5><p><code>session</code> 是基于 <code>cookie</code> 实现的，<code>session</code> 存储在服务器端，<code>sessionId</code> 会被存储到客户端的<code>cookie</code>中。</p>
<p><code>sessionId</code> 用于关联 <code>Cookie</code> 和 <code>Session</code> </p>
<h4 id="Cookie和Session验证用户的流程"><a href="#Cookie和Session验证用户的流程" class="headerlink" title="Cookie和Session验证用户的流程"></a>Cookie和Session验证用户的流程</h4><ol>
<li><p>用户第一次请求服务器的时候，服务器根据用户提交的相关信息，创建对应的 <code>Session</code> </p>
</li>
<li><p>请求返回时将此 <code>Session</code> 的唯一标识信息 <code>SessionID</code> 返回给浏览器 </p>
</li>
<li><p>浏览器接收到服务器返回的 <code>SessionID</code> 信息后，会将此信息存入到 <code>Cookie</code> 中，同时 Cookie 记录此 <code>SessionID</code> 属于哪个域名 </p>
</li>
<li><p>当用户第二次访问服务器的时候，请求会自动判断此域名下是否存在 <code>Cookie</code> 信息，如果存在自动将 <code>Cookie</code> 信息也发送给服务端，服务端会从 <code>Cookie</code> 中获取<code>SessionID</code>，再根据 <code>SessionID</code> 查找对应的 <code>Session</code> 信息，如果没有找到说明用户没有登录或者登录失效，如果找到 <code>Session</code> 证明用户已经登录可执行后面操作。</p>
</li>
</ol>
<h4 id="Token"><a href="#Token" class="headerlink" title="Token"></a>Token</h4><p>访问资源接口（<code>API</code>）时所需要的资源凭证。</p>
<blockquote>
<p>基于 token 的用户认证是一种服务端无状态的认证方式，服务端不用存放 token 数据。用解析 token 的计算时间换取 session 的存储空间，从而减轻服务器的压力，减少频繁的查询数据库</p>
<p>token 完全由应用管理，所以它可以避开同源策略</p>
</blockquote>
<h5 id="Access-Token"><a href="#Access-Token" class="headerlink" title="Access Token"></a>Access Token</h5><p>用于每次请求校验</p>
<h6 id="简单Token的组成："><a href="#简单Token的组成：" class="headerlink" title="简单Token的组成："></a>简单Token的组成：</h6><p><code>uid</code>(用户唯一的身份标识)、<code>time</code>(当前时间的时间戳)、<code>sign</code>（签名，<code>token</code> 的前几位以哈希算法压缩成的一定长度的十六进制字符串）</p>
<h6 id="特点："><a href="#特点：" class="headerlink" title="特点："></a>特点：</h6><p>服务端无状态化、可扩展性好、支持移动端设备、支持跨程序调用</p>
<h6 id="Access-Token-验证用户的流程"><a href="#Access-Token-验证用户的流程" class="headerlink" title="Access Token 验证用户的流程"></a>Access Token 验证用户的流程</h6><ol>
<li><p>客户端使用用户名跟密码请求登录，服务器端收到请求，去验证用户名与密码</p>
</li>
<li><p>验证成功后，服务器端会签发一个 <code>token</code> 并把这个 <code>token</code> 发送给客户端</p>
</li>
<li><p>客户端收到 <code>token</code> 以后，会把它存储起来，比如放在  <code>localStorage</code>或者<code>sessionStorage</code> 里 </p>
</li>
<li><p>客户端每次向服务端请求资源的时候需要在<code>Header</code>中携带着服务端签发的 <code>token</code></p>
</li>
<li><p>服务端收到请求，然后去验证客户端请求里面带着的 <code>token</code> ，如果验证成功，就向客户端返回请求的数据</p>
</li>
</ol>
<h5 id="Refresh-Token"><a href="#Refresh-Token" class="headerlink" title="Refresh Token"></a>Refresh Token</h5><p><code>refresh token</code> 是专用于刷新 <code>access token</code> </p>
<p><code>refresh token</code> 有效期要比 <code>access token</code> 长</p>
<blockquote>
<p>access token 过期失效后，每次刷新 access token 都需要用户输入登录用户名与密码，</p>
<p>使用 refresh token，客户端可以直接用 refresh token 去更新 access token，无需用户进行额外的操作。（实现无感知刷新）</p>
</blockquote>
<p><code>Refresh Token</code> 及过期时间是<strong>存储在服务器的数据库中</strong>，只有在申请新的 <code>Acesss Token</code> 时才会验证，不会对业务接口响应时间造成影响，也不需要向 <code>Session</code> 一样一直保持在内存中以应对大量的请求。</p>
<h6 id="Refresh-Token-刷新-Access-Token-的流程"><a href="#Refresh-Token-刷新-Access-Token-的流程" class="headerlink" title="Refresh Token 刷新 Access Token 的流程"></a>Refresh Token 刷新 Access Token 的流程</h6><ol>
<li>客户端使用用户名跟密码请求登录，服务器端收到请求，去验证用户名与密码</li>
<li>验证成功后，服务器端签发并返回给客户端有效期为1个月的 <code>refresh token</code> 和有效期为1天的 <code>access token</code> </li>
<li>客户端收到两个 <code>token</code> 后，存储起来，客户端每次请求数据时，使用 <code>access token</code> </li>
<li> <code>access token</code> 失效后，服务器端返回错误，客户端使用 <code>refresh token</code> 向服务器端发送请求刷新 <code>access token</code></li>
<li>服务器端需要判断 <code>refresh token</code> 是否过期，如果 <code>refresh token</code> 有效，则服务器端返回新签发的 <code>access token</code>，如果 <code>refresh token</code> 过期，则服务器端返回错误，客户端需要用户重新登录</li>
</ol>
<h4 id="Session-和-Token-的区别"><a href="#Session-和-Token-的区别" class="headerlink" title="Session 和 Token 的区别"></a>Session 和 Token 的区别</h4><p><code>Session</code> 是一种记录服务器和客户端会话状态的机制，使服务端有状态化，可以记录会话信息。而 <code>Token</code> 是令牌，访问资源接口时所需要的资源凭证。<code>Token</code> 使服务端无状态化，不会存储会话信息。</p>
<p><code>Session</code> 和 <code>Token</code> 并不矛盾，作为身份认证 <code>Token</code> 安全性比 <code>Session</code> 好，因为每一个请求都有签名还能防止监听以及重放攻击，而 <code>Session</code> 就必须依赖链路层来保障通讯安全了。<strong>如果你需要实现有状态的会话，仍然可以增加 <code>Session</code> 来在服务器端保存一些状态。</strong></p>
<p><code>Session</code> 只提供一种简单的认证，即只要有此 <code>SessionID</code> ，即认为有此 <code>User</code> 的全部权限。需要严格保密，这个数据应该只保存在站方，不应该共享给其它网站或者第三方 <code>App</code>。如果你的用户数据可能需要和第三方共享，或者允许第三方调用 <code>API</code> 接口，则应使用 <code>Token</code>。</p>
<blockquote>
<p> session 模式扩展性不好。单机当然没有问题，如果是服务器集群，或者是跨域的服务导向架构，就要求 session 数据共享，每台服务器都能够读取 session。</p>
<p>token 可以避免 CSRF 攻击(因为不需要cookie 了)</p>
</blockquote>
<h4 id="JWT-JSON-Web-Token"><a href="#JWT-JSON-Web-Token" class="headerlink" title="JWT ( JSON Web Token )"></a>JWT ( JSON Web Token )</h4><p>目前最流行的跨域认证解决方案。<code>JWT</code>在线网站 <a href="https://jwt.io/">https://jwt.io/</a> </p>
<p><code>JWT</code> 是为了在网络应用环境间传递声明而执行的一种基于 <code>JSON</code> 的开放标准（RFC 7519）。</p>
<p>是一种<strong>认证授权机制</strong>。</p>
<p><code>JWT</code> 是 <code>Token</code> 的一种实现形式。将 <code>Token</code> 和 <code>Payload</code>（负载，包括签发人等信息） 加密后存储于客户端，服务端只需要使用密钥解密进行校验（校验也是 <code>JWT</code> 自己实现的）即可，不需要查询或者减少查询数据库，因为 <code>JWT</code> 自包含了用户信息和加密的数据。</p>
<p><code>JWT</code> 的<strong>原理</strong>是，服务器认证以后，生成一个 <code>JSON</code> 对象并携带签名，发回给用户。</p>
<p><code>JWT</code> 的声明一般被用来在身份提供者和服务提供者间传递被认证的用户身份信息，以便于从资源服务器获取资源。比如用在用户登录上。</p>
<p>可以使用 <code>HMAC</code> 算法或者是 <code>RSA</code> 的公/私秘钥对 <code>JWT</code> 进行签名。因为数字签名的存在，这些传递的信息是可信的。</p>
<blockquote>
<p>因为用户的状态不再存储在服务端的内存中，所以这是一种无状态的认证机制</p>
<p>使用过程中无法废弃某个 Token 或者更改 Token 的权限。也就是说一旦 JWT 签发了，到期之前就会始终有效，除非服务器部署额外的逻辑。</p>
</blockquote>
<h5 id="JWT-认证流程"><a href="#JWT-认证流程" class="headerlink" title="JWT 认证流程"></a>JWT 认证流程</h5><ol>
<li>用户输入用户名/密码登录，服务端认证成功后，使用密钥创建 <code>JWT</code> 后并返回给客户端 </li>
<li>客户端将 <code>JWT</code> 保存到本地</li>
<li>当用户希望访问一个受保护的路由或者资源的时候，需要请求头的 <code>Authorization</code> 字段中使用<code>Bearer</code> 模式添加 <code>JWT</code></li>
<li>服务端的保护路由将会检查请求头 <code>Authorization</code> 中的 <code>JWT</code> 信息，如果合法，则允许用户的行为</li>
</ol>
<h4 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h4><p><a href="http://www.ruanyifeng.com/blog/2018/07/json_web_token-tutorial.html">JSON Web Token 入门教程</a></p>
]]></content>
      <categories>
        <category>计算机网络</category>
      </categories>
      <tags>
        <tag>面试</tag>
        <tag>计算机网络</tag>
      </tags>
  </entry>
  <entry>
    <title>android调试</title>
    <url>/posts/3562/</url>
    <content><![CDATA[<h4 id="百度智能小程序真机调试"><a href="#百度智能小程序真机调试" class="headerlink" title="百度智能小程序真机调试"></a>百度智能小程序真机调试</h4><p>1.连接USB，打开开发者模式，USB调试功能</p>
<p>2.开启了USB调试也无法找到设备<br>两种解决方法：<br>(1) 在电脑中安装 Android Debug Bridge（安卓调试桥） 后再尝试连接；在命令行中运行adb devices查找连接的设备<br>(2) 执行如下命令，使用npm全局安装adb-devtools，并在终端执行devtools，在手机上点击确认授权后再次尝试；</p>
<pre class="line-numbers language-none"><code class="language-none">&#96;npm install adb-devtools -gdevtools&#96;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>参考链接：</p>
<p><a href="https://www.cnblogs.com/lsdb/p/9438215.html">adb（Android Debug Bridge）安装使用教程</a><a href="https://www.cnblogs.com/lsdb/p/9438215.html">https://www.cnblogs.com/lsdb/p/9438215.html</a></p>
]]></content>
      <categories>
        <category>整理</category>
      </categories>
      <tags>
        <tag>调试</tag>
        <tag>百度小程序</tag>
      </tags>
  </entry>
  <entry>
    <title>git常用命令</title>
    <url>/posts/953/</url>
    <content><![CDATA[<h3 id="理论"><a href="#理论" class="headerlink" title="理论"></a>理论</h3><p>Git 是一个分布式版本管理系统，是为了更好地管理Linux内核开发而创立的。</p>
<p>Git可以在任何时间点，把文档的状态作为更新记录保存起来。因此可以把编辑过的文档复原到以前的状态，也可以显示编辑前后的内容差异。</p>
<h4 id="管理历史记录的数据库"><a href="#管理历史记录的数据库" class="headerlink" title="管理历史记录的数据库"></a>管理历史记录的数据库</h4><p>数据库 (Repository) 是记录文件或目录状态的地方，存储着内容修改的历史记录。在数据库的管理下，把文件和目录修改的历史记录放在对应的目录下。</p>
<p>远程数据库：配有专用的服务器，为了多人共享而建立的数据库。</p>
<p>本地数据库：为了方便用户个人使用，在自己的机器上配置的数据库。</p>
<h4 id="提交"><a href="#提交" class="headerlink" title="提交"></a>提交</h4><p>若要把文件或目录的添加和变更保存到数据库，就需要进行提交。</p>
<p>执行提交后，数据库中会生成上次提交的状态与当前状态的差异记录（也被称为revision）。</p>
<p>提交是以时间顺序排列状态被保存到数据库中的。凭借该提交和最新的文件状态，就可以知道过去的修改记录以及内容。</p>
<p>每次提交系统会自动生成没有重复的40位英文数字的 hash 值用来命名本次提交。</p>
<h4 id="工作树和索引"><a href="#工作树和索引" class="headerlink" title="工作树和索引"></a>工作树和索引</h4><p>在Git管理下，大家实际操作的目录被称为工作树。</p>
<p>在数据库和工作树之间有索引，索引是为了向数据库提交作准备的区域。</p>
<p>Git在执行提交的时候，不是直接将工作树的状态保存到数据库，而是将设置在中间索引区域的状态保存到数据库。因此，要提交文件，首先需要把文件加入到索引区域中。</p>
<p>所以，凭借中间的索引，可以避免工作树中不必要的文件提交，还可以将文件修改内容的一部分加入索引区域并提交。</p>
<h3 id="实战"><a href="#实战" class="headerlink" title="实战"></a>实战</h3><p>git bash中的命令行是linux操作模式。</p>
<p>查找git命令手册：</p>
<pre class="line-numbers language-console" data-language="console"><code class="language-console">$ git help &lt;verb&gt;
$ git &lt;verb&gt; --help
$ man git-&lt;verb&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>如查找config命令手册，执行<code>git help config</code></p>
<h4 id="git-配置"><a href="#git-配置" class="headerlink" title="git 配置"></a>git 配置</h4><h5 id="1-本地创建ssh-key"><a href="#1-本地创建ssh-key" class="headerlink" title="1. 本地创建ssh key"></a>1. 本地创建ssh key</h5><p>在命令行中输入<code>ssh-keygen -t rsa -C &quot;your_email@youremail.com&quot;</code>，确认路径和输入密码，进入.ssh文件夹中可以看到id_ras(私钥)和id_ras.pub(公钥)，复制公钥中的key配置到git远程仓库，或在命令行中输入<code>cd ~/.ssh</code>进入.ssh文件夹中，再输入<code>cat id_rsa</code>查看私钥，输入<code>cat id_rsa.pub</code>查看公钥。</p>
<h5 id="2-与远程仓库的连接"><a href="#2-与远程仓库的连接" class="headerlink" title="2. 与远程仓库的连接"></a>2. 与远程仓库的连接</h5><p>初始化git之后连接，<code>git remote add origin git@github.com:Datura35422/vueDemo.git</code></p>
<p>查看远程仓库信息：<code>git remote -v</code></p>
<p>删除远程仓库：<code>git remote remove &lt;name&gt;</code></p>
<h5 id="3-验证与远程仓库连接"><a href="#3-验证与远程仓库连接" class="headerlink" title="3. 验证与远程仓库连接"></a>3. 验证与远程仓库连接</h5><p>在命令行中输入如<code>ssh -T git@github.com</code>进行验证与github远程仓库的连接，如果命令行中返回<code>You&#39;ve successfully authenticated, but GitHub does not provide shell access</code>表示验证成功，注意：每个git仓库的验证成功信息不同。</p>
<p>本地已存在仓库建立与远程仓库联系，从远程仓库拉取代码，<code>git pull origin master --allow-unrelated-histories</code></p>
<p>将新的分支推送到远程仓库中，<code>git push origin new_branch</code></p>
<h5 id="4-全局配置"><a href="#4-全局配置" class="headerlink" title="4. 全局配置"></a>4. 全局配置</h5><p>全局配置username：<code>git config --global user.name &quot;your name&quot;</code></p>
<p>全局配置email：<code>git config --global user.email &quot;youremail@email.com&quot;</code></p>
<p>全局配置文本编辑器：git默认编辑器是Vim，如果想配置不同的文本编辑器，如Emacs可以配置<code>git config --global core.editor emacs</code></p>
<p>查看所有配置项：<code>git config --list</code>，如果有重复变量名，git会使用每个变量的最后一个配置。</p>
<p>查看某一项配置：如查看user.name配置，<code>git config user.name</code></p>
<p>配置别名：<code>git config --global alias.st status</code></p>
<h4 id="git-基本操作"><a href="#git-基本操作" class="headerlink" title="git 基本操作"></a>git 基本操作</h4><h5 id="1-克隆远程仓库代码-git-clone"><a href="#1-克隆远程仓库代码-git-clone" class="headerlink" title="1. 克隆远程仓库代码 git clone"></a>1. 克隆远程仓库代码 <code>git clone</code></h5><p>如<code>git clone git@github.com:michaelliao/gitskills.git</code></p>
<p>Git支持多种协议，包括https，但通过ssh支持的原生git协议速度最快</p>
<p>克隆远程仓库就不需要初始化本地仓库</p>
<p>克隆远程仓库的某个分支<code>git clone -b dev git@github.com:michaelliao/gitskills.git</code></p>
<h5 id="2-拉取远程仓库代码-git-pull"><a href="#2-拉取远程仓库代码-git-pull" class="headerlink" title="2. 拉取远程仓库代码 git pull"></a>2. 拉取远程仓库代码 <code>git pull</code></h5><p><code>git pull</code></p>
<h5 id="3-初始化本地仓库-git-init"><a href="#3-初始化本地仓库-git-init" class="headerlink" title="3. 初始化本地仓库 git init"></a>3. 初始化本地仓库 <code>git init</code></h5><p><code>git init</code></p>
<h5 id="4-将工作区代码提交到暂存区-git-add"><a href="#4-将工作区代码提交到暂存区-git-add" class="headerlink" title="4. 将工作区代码提交到暂存区 git add"></a>4. 将工作区代码提交到暂存区 <code>git add</code></h5><p>提交工作区所有修改后的文件：<code>git add .</code></p>
<p>提交工作区具体的某个文件：<code>git add &lt;filename&gt;</code></p>
<p>提交工作区某个文件夹：<code>git add 文件夹</code></p>
<p>提交所有被删除和修改的文件到数据暂存区： <code>git add -u</code> 或<code>git add –update</code></p>
<p>提交所有被删除、被替换、被修改和新增的文件到数据暂存区:  <code>git add -A </code>或<code>git add -all </code></p>
<p>*只有将工作区中的文件添加到暂存区之后才能提交到远程仓库或本地分支</p>
<h5 id="5-查看区别-git-diff"><a href="#5-查看区别-git-diff" class="headerlink" title="5. 查看区别 git diff"></a>5. 查看区别 <code>git diff</code></h5><p>查看工作区与版本库中最新版本的区别：<code>git diff HEAD -- &lt;filename&gt;</code></p>
<p>查看文件详细区别：<code>git diff &lt;filename&gt;</code>, 按<code>Q</code>退出</p>
<h5 id="6-撤销修改git-checkout-lt-filename-gt"><a href="#6-撤销修改git-checkout-lt-filename-gt" class="headerlink" title="6. 撤销修改git checkout -- &lt;filename&gt;"></a>6. 撤销修改<code>git checkout -- &lt;filename&gt;</code></h5><p>撤销工作区的修改，会用最近一次commit或add的文件来覆盖当前修改过的文件。如果修改已经commit到暂存区，则需要进行版本回退。</p>
<p>*如果命令中没有<code>--</code>则是切换到其他分支</p>
<blockquote>
<p><code>git checkout</code> 命令也可以从历史提交（或暂存区域）中拷贝文件到工作目录。当给定某个文件名（或 <code>-p</code> 选项，或同时使用）时，git 会从指定的提交中拷贝文件到暂存区域和工作目录。比如，<code>git checkout HEAD~ foo.c</code>会将提交节点<em>HEAD~</em>(即当前提交节点的父节点)中的<code>foo.c</code>复制到工作目录并且加到暂存区域中。（如果命令中没有指定提交节点，则会从暂存区域中拷贝内容。）注意当前分支不会发生变化。</p>
</blockquote>
<h5 id="7-将暂存区代码提交到分支-git-commit"><a href="#7-将暂存区代码提交到分支-git-commit" class="headerlink" title="7. 将暂存区代码提交到分支 git commit"></a>7. 将暂存区代码提交到分支 <code>git commit</code></h5><p>然后<code>git commit</code>提交更改，将缓存区的所有内容提交到当前分支。</p>
<p>其中，<code>git commit -m &#39;xxxx&#39;</code>写提交备注</p>
<p>如果出现权限问题和403错误，就是远程仓库没有授权，请查看远程仓库的配置。</p>
<p>如果想要更改一次提交，可以使用 <code>git commit --amend</code> 命令。git 会使用与当前提交相同的父节点进行一次新提交，旧的提交会被取消。</p>
<h5 id="8-删除文件-git-rm"><a href="#8-删除文件-git-rm" class="headerlink" title="8. 删除文件 git rm"></a>8. 删除文件 <code>git rm</code></h5><p>删除版本库中的文件：<code>git rm &lt;filename&gt;</code></p>
<p>不删除物理文件，仅将该文件从缓存中删除：<code>git rm --cached</code></p>
<p>如果在工作区误删了文件，可以使用<code>git checkout &lt;filename&gt;</code>恢复文件</p>
<h5 id="9-查看历史记录-git-log"><a href="#9-查看历史记录-git-log" class="headerlink" title="9. 查看历史记录 git log"></a>9. 查看历史记录 <code>git log</code></h5><p>简化历史记录： <code>git log --pretty=oneline</code></p>
<p>树形结构查看历史记录：<code>git log --oneline --graph --decorate --all</code></p>
<h5 id="10-查看命令历史-git-reflog"><a href="#10-查看命令历史-git-reflog" class="headerlink" title="10. 查看命令历史 git reflog"></a>10. 查看命令历史 <code>git reflog</code></h5><p>从中获知未来版本的版本号并进行穿梭。</p>
<p>记录每一次HEAD指针版本指向问题。</p>
<h5 id="11-版本回退-git-reset"><a href="#11-版本回退-git-reset" class="headerlink" title="11.版本回退 git reset"></a>11.版本回退 <code>git reset</code></h5><p>将暂存区修改回退到工作区：<code>git reset HEAD &lt;filename&gt;</code>，如果修改已经添加至暂存区，可以使用<code>git reset</code>，将暂存区的版本回退，重新放回工作区。</p>
<p>回退当前版本：<code>git reset --hard HEAD</code></p>
<p>回退上一个版本：<code>git reset --hard HEAD^</code></p>
<p>回退上上个版本：<code>git reset --hard HEAD^^</code></p>
<p>回退指定版本：<code>git reset --hard headname</code>，其中headname可以在<code>git log</code>中查看到版本号。版本号（哈希值）可以不用写全。</p>
<p><code>git reset --mixed</code>：默认方式，版本库中回退到某个版本，工作区保留源码。</p>
<p><code>git reset --soft</code>：回退到某个版本，只回退了 commit 的信息，不会恢复到 index file 一级，如果需要提交则 commit。</p>
<p><code>git reset --hard</code>：彻底回退到某个版本，本地源码也会变为上一个版本的内容。</p>
<blockquote>
<p>回退之后想要修改代码，需要强制推代码上去覆盖远程仓库 history：<code>git push -f</code></p>
</blockquote>
<h5 id="12-tag标签-git-tag"><a href="#12-tag标签-git-tag" class="headerlink" title="12. tag标签 git tag"></a>12. tag标签 <code>git tag</code></h5><p>版本标签，对某一个时间点上的版本打上标签。</p>
<p>列出已有的标签：<code>git tag</code></p>
<p>查看一系列的标签：<code>git tag -l &#39;v1.4.2.*&#39;</code></p>
<p>新建轻量级标签：<code>git tag v1.4</code>（指向特定提交对象的引用）</p>
<p>新建含附注的标签：<code>git tag -a v1.4 -m &#39;备注&#39;</code>（存储在仓库中的一个独立对象，它有自身的校验和信息，包含着标签的名字，电子邮件地址和日期，以及标签说明，标签本身也允许使用GPG来签署或验证）</p>
<p>查看相应标签的版本信息：<code>git show v1.4</code></p>
<p>签署标签：<code>git tag -s v1.4 -m &#39;my signed 1.4 tag&#39;</code>（自己的私钥，还可以用 GPG 来签署标签）</p>
<p>验证标签：<code>git tag -v v1.4</code>（会调用 GPG 来验证签名，没有公钥会报错）</p>
<p>后期加注标签：<code>git tag -a v1.2 提交历史哈希值</code>（使用<code>git log --pretty=oneline</code>查看提交历史，哈希值不用写全）</p>
<p>提交标签：<code>git push origin v1.4</code></p>
<p>提交所有新增标签：<code>git push origin --tags</code></p>
<p>删除标签：<code>git tag -d v1.4</code></p>
<p>删除远程标签：需要先删除本地标签，<code>git push origin :refs/tags/v1.4</code></p>
<h5 id="13-备份当前工作内容-git-stash"><a href="#13-备份当前工作内容-git-stash" class="headerlink" title="13. 备份当前工作内容 git stash"></a>13. 备份当前工作内容 <code>git stash</code></h5><p><code>git stash</code>：备份当前的工作区的内容，从最近的一次提交中读取相关内容，让工作区保证和上次提交的内容一致。同时，将当前的工作区内容保存到Git栈中。</p>
<p><code>git stash save [message]</code> ：备份当前的工作区内容且设置备注。</p>
<p><code>git stash pop</code>：从Git栈中读取最近一次保存的内容，恢复工作区的相关内容并删除stash中的内容。由于可能存在多个Stash的内容，所以用栈来管理，pop会从最近的一个stash中读取内容并恢复。</p>
<p>显示Git栈内的所有备份：<code>git stash list</code>，可以利用这个列表来决定从那个地方恢复。</p>
<p>清空Git栈：<code>git stash clear</code></p>
<p>恢复现场：<code>git stash apply</code>，需要用<code>git stash drop</code>删除stash中的内容。</p>
<p>删除stash中的内容：<code>git stash drop</code></p>
<p>多次保存工作现场后，恢复指定的工作现场，<code>git stash apply stash@&#123;0&#125;</code>。</p>
<h5 id="14-改写提交-git-cherry-pick"><a href="#14-改写提交-git-cherry-pick" class="headerlink" title="14. 改写提交 git cherry-pick"></a>14. 改写提交 <code>git cherry-pick</code></h5><p><code>cherry-pick</code> 命令”复制”一个提交节点并在当前分支做一次完全一样的新提交。</p>
<p>参考链接： <a href="https://backlog.com/git-tutorial/cn/stepup/stepup7_4.html">https://backlog.com/git-tutorial/cn/stepup/stepup7_4.html</a></p>
<h5 id="15-合并命令-git-rebase"><a href="#15-合并命令-git-rebase" class="headerlink" title="15. 合并命令 git rebase"></a>15. 合并命令 <code>git rebase</code></h5><p>衍合是合并命令的另一种选择。合并把两个父分支合并进行一次提交，提交历史不是线性的。衍合在当前分支上重演另一个分支的历史，提交历史是线性的。 本质上，这是线性化的自动的 <code>cherry-pick</code> </p>
<p><code>git rebase -i HEAD~~</code>：合并最近的两次提交，合并后进行提交。</p>
<p>fast-forward 合并</p>
<p><code>git rebase 分支名</code>：和 merge 时的操作相同，如果有冲突需要修改冲突，冲突修改后会 history 指针为最新的提交。</p>
<p><code>git rebase --continue</code>：修改冲突后的提交不是使用commit命令，而是执行rebase命令指定 –continue选项。若要取消rebase，指定 –abort选项。</p>
<h5 id="16-取消过去的提交-git-revert"><a href="#16-取消过去的提交-git-revert" class="headerlink" title="16. 取消过去的提交 git revert"></a>16. 取消过去的提交 <code>git revert</code></h5><p><code>git revert HEAD</code>：取消最新的一次提交，可以把 HEAD 改为提交的哈希值。</p>
<h4 id="git-分支操作"><a href="#git-分支操作" class="headerlink" title="git 分支操作"></a>git 分支操作</h4><h5 id="1-创建分支-dev"><a href="#1-创建分支-dev" class="headerlink" title="1. 创建分支 dev"></a>1. 创建分支 dev</h5><p>创建并切换分支： <code>git checkout -b dev</code> </p>
<p>创建分支： <code>git branch dev</code>,在需要创建的分支上创建子分支。</p>
<p>在本地上创建与远程分支对应的分支：<code>git checkout -b &lt;分支名&gt; origin/&lt;分支名&gt;</code> 或 <code>git checkout -t origin/&lt;分支名&gt;</code></p>
<p>本地分支与远程分支进行连接: <code>git branch --set-upstream-to=origin/&lt;branch&gt; &lt;branch&gt;</code></p>
<blockquote>
<p>创建分支注意不要和标签名发生冲突，否则会存在一对多的情况，最后只能删除分支或者标签，同名标签和分支不能共存。</p>
</blockquote>
<h5 id="2-切换分支"><a href="#2-切换分支" class="headerlink" title="2. 切换分支"></a>2. 切换分支</h5><p>切换分支：<code>git checkout 分支名</code> (可以在未创建与远程分支对应分支情况下切换到该分支并拉取代码)</p>
<h5 id="3-查看分支"><a href="#3-查看分支" class="headerlink" title="3. 查看分支"></a>3. 查看分支</h5><p>查看本地分支和当前分支 ：<code>git branch</code></p>
<p>查看远程和本地分支： <code>git branch -a</code></p>
<p>查看远程分支：<code>git branch -r</code></p>
<p>查看已删除分支情况：<code>git remote show origin</code></p>
<h5 id="4-合并分支"><a href="#4-合并分支" class="headerlink" title="4. 合并分支"></a>4. 合并分支</h5><p>合并指定分支到当前分支：<code>git merge &lt;分支名&gt;</code></p>
<h5 id="5-删除分支"><a href="#5-删除分支" class="headerlink" title="5. 删除分支"></a>5. 删除分支</h5><p>删除分支：<code>git branch -d &lt;分支名&gt;</code></p>
<p>强行删除分支：<code>git branch -D &lt;分支名&gt;</code></p>
<p>删除远程分支：<code>git push origin --delete &lt;分支名&gt;</code></p>
<p>删除远程不存在的分支：<code>git remote prune origin</code></p>
<p>删除分支的远程追踪：<code>git branch -r -d origin/分支名</code></p>
<h5 id="6-分支冲突"><a href="#6-分支冲突" class="headerlink" title="6. 分支冲突"></a>6. 分支冲突</h5><p>在主分支上必须手动解决冲突之后再提交</p>
<p>查看分支冲突部分：<code>git status</code></p>
<p>查看分支合并情况： <code>git log --graph --petty=online --abbrev-commit</code></p>
<p>查看分支合并图：<code>git log --graph</code></p>
<h5 id="7-合并远程分支"><a href="#7-合并远程分支" class="headerlink" title="7. 合并远程分支"></a>7. 合并远程分支</h5><p>先将需要合并的远程分支拉取到本地，然后进行合并，如果有冲突需要解决冲突后提交。</p>
<p>推送到远程分支：<code>git push origin master</code></p>
<p>将新分支推送到远程仓库：<code>git push --set-upstream origin &lt;分支名&gt;</code></p>
<h5 id="8-重命名分支"><a href="#8-重命名分支" class="headerlink" title="8.重命名分支"></a>8.重命名分支</h5><p>重命名分支： <code>git branch -m &lt;分支名&gt;</code> 或 <code>git branch -m &lt;旧分支名&gt; &lt;新分支名&gt;</code></p>
<h4 id="异常"><a href="#异常" class="headerlink" title="异常"></a>异常</h4><h5 id="1-git-pull-时出现冲突"><a href="#1-git-pull-时出现冲突" class="headerlink" title="1. git pull 时出现冲突"></a>1. git pull 时出现冲突</h5><p>错误提示：<code>error: Your local changes to the following files would be overwritten by merge</code></p>
<p>方法1：如果你想保留刚才本地修改的代码，并把<code>git</code>服务器上的代码<code>pull</code>到本地（本地刚才修改的代码将会被暂时封存起来）</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">git</span> stash // 保存当前工作区内容
<span class="token function">git</span> pull origin master // 拉取远程仓库master分支
<span class="token function">git</span> stash pop // 恢复工作区内容<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>方法2：如果你想完全地覆盖本地的代码，只保留服务器端代码，则直接回退到上一个版本，再进行pull</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">git</span> reset <span class="token parameter variable">--hard</span> // 版本回退
<span class="token function">git</span> pull orgin master // 拉取远程仓库master分支<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<h5 id="2-推送异常"><a href="#2-推送异常" class="headerlink" title="2.推送异常"></a>2.推送异常</h5><p><strong>错误提示</strong>：<code>error: failed to push some refs to xxx</code></p>
<p>大致意思：本地和远程的文件应该合并后才能上传本地的新文件</p>
<p>解决方法：先更新再提交，<code>git pull</code> -&gt; <code>git push</code></p>
<p>如果<code>git pull</code>出现错误：<code>Pull is not possible because you have unmerged files.</code></p>
<p>本地的<code>push</code>和<code>merge</code>会形成<code>MERGE-HEAD(FETCH-HEAD)</code>, <code>HEAD（PUSH-HEAD）</code>这样的引用。<code>HEAD</code>代表本地最近成功<code>push</code>后形成的引用。<code>MERGE-HEAD</code>表示成功<code>pull</code>后形成的引用。可以通过<code>MERGE-HEAD</code>或者<code>HEAD</code>来实现类型与<code>svn revet</code>的效果。</p>
<p>解决方法：</p>
<p>1.<code>pull</code>会使用<code>git merge</code>导致冲突，需要将冲突的文件<code>resolve</code>掉 <code>git add -u</code>, <code>git commit</code>之后才能成功<code>pull</code>。</p>
<p>2.如果想放弃本地的文件修改，将本地的冲突文件冲掉，不仅需要<code>reset</code>到<code>MERGE-HEAD</code>或者<code>HEAD</code>,还需要<code>--hard</code>。没有后面的<code>hard</code>，不会冲掉本地工作区。只会冲掉<code>stage</code>区。可以使用<code>git reset --hard FETCH_HEAD</code>，<code>FETCH_HEAD</code>表示上一次成功<code>git pull</code>之后形成的<code>commit</code>点。然后<code>git pull</code>。<br>注意：</p>
<p><code>git merge</code>会形成<code>MERGE-HEAD(FETCH-HEAD)</code> 。<code>git push</code>会形成<code>HEAD</code>这样的引用。<code>HEAD</code>代表本地最近成功<code>push</code>后形成的引用。</p>
<p><strong>错误提示</strong>：<code>fatal: refusing to merge unrelated histories</code></p>
<p>大致意思：拒绝合并不相关的历史。因本地仓库和远程仓库是两个独立的仓库，所以要强制合并成一个仓库。</p>
<p>解决方法： <code>git pull origin master --allow-unrelated-histories</code></p>
<h4 id="学习链接"><a href="#学习链接" class="headerlink" title="学习链接"></a>学习链接</h4><p><a href="https://backlog.com/git-tutorial/cn/">猴子都能懂的GIT入门</a></p>
<p><a href="https://github.com/521xueweihan/git-tips">GIT奇技淫巧</a>：<a href="https://github.com/git-tips/tips">英文版原文</a></p>
]]></content>
      <categories>
        <category>git操作指南</category>
      </categories>
      <tags>
        <tag>工具</tag>
        <tag>git</tag>
        <tag>ssh</tag>
      </tags>
  </entry>
  <entry>
    <title>git操作指南-git-rebase</title>
    <url>/posts/1023ce04/</url>
    <content><![CDATA[<p>参考文章：<br><a href="https://backlog.com/git-tutorial/tw/stepup/stepup2_8.html">连猴子都能懂的Git入门指南-使用 rebase 合并</a></p>
<p><a href="https://www.liaoxuefeng.com/wiki/896043488029600/1216289527823648">廖雪峰：git rebase</a></p>
<p><a href="https://git-scm.com/docs/git-rebase">https://git-scm.com/docs/git-rebase</a></p>
<p><a href="https://git-scm.com/book/en/v2/Git-Branching-Rebasing">https://git-scm.com/book/en/v2/Git-Branching-Rebasing</a></p>
<p><a href="https://www.atlassian.com/git/tutorials/rewriting-history/git-rebase">https://www.atlassian.com/git/tutorials/rewriting-history/git-rebase</a></p>
<h3 id="Git-rebase"><a href="#Git-rebase" class="headerlink" title="Git rebase"></a>Git rebase</h3><h4 id="什么是-git-rebase？"><a href="#什么是-git-rebase？" class="headerlink" title="什么是 git rebase？"></a>什么是 git rebase？</h4><blockquote>
<p>Rebasing is the process of moving or combining a sequence of commits to a new base commit. Rebasing is most useful and easily visualized in the context of a feature branching workflow.</p>
</blockquote>
<p>rebase 即 “变基”。</p>
<p>将提交到某一分支上的所有修改都移至另一分支上。</p>
<p><img src="/posts/1023ce04/image-20220531130625465.png" alt="image-20220531130625465"></p>
<blockquote>
<p>From a content perspective, rebasing is changing the base of your branch from one commit to another making it appear as if you’d created your branch from a different commit. Internally, Git accomplishes this by creating new commits and applying them to the specified base. It’s very important to understand that even though the branch looks the same, it’s composed of entirely new commits.</p>
</blockquote>
<p>例如：</p>
<pre class="line-numbers language-none"><code class="language-none">$ git checkout experiment
$ git rebase master
First, rewinding head to replay your work on top of it...
Applying: added staged command<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>原理是首先找到这两个分支(即当前分支 experiment、变基操作的目标基底分支 master)的最近共同祖先 C2，然后对比当前分支相对于该祖先的历次提交，提取相应的修改并存为临时文件，然后将当前分支指向目标基底 C3, 最后以此将之前另存为临时文件的修改依序应用。</p>
<p><img src="/posts/1023ce04/image-20220531132016396.png" alt="image-20220531132016396"></p>
<p><strong>Git rebase 会将提交历史变成一条直线。</strong>使提交记录变得更加的整洁。</p>
<p>使用 git rebase 之前<br><img src="/posts/1023ce04/image-20220531135532739.png" alt="image-20220531135532739"></p>
<p>使用命令</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">git</span> rebase second<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>使用 git rebase 之后</p>
<p><img src="/posts/1023ce04/image-20220531135810246.png" alt="image-20220531135810246"> </p>
<p>这样就能得到一个干净的提交记录了。</p>
<blockquote>
<p>git rebase 和 git merge 的操作在提交记录的显示上也有很大的不同。</p>
</blockquote>
<p>开发模式下</p>
<h4 id="如何使用？"><a href="#如何使用？" class="headerlink" title="如何使用？"></a>如何使用？</h4><h4 id="与-git-merge-的不同"><a href="#与-git-merge-的不同" class="headerlink" title="与 git merge 的不同"></a>与 git merge 的不同</h4>]]></content>
      <categories>
        <category>git操作指南</category>
      </categories>
      <tags>
        <tag>工具</tag>
        <tag>git</tag>
      </tags>
  </entry>
  <entry>
    <title>iOS调试</title>
    <url>/posts/ef7ecee1/</url>
    <content><![CDATA[<p>主要是调试 H5 页面。审查各个系统环境下的样式和断点调试。</p>
<h3 id="在Mac-OS-上调试"><a href="#在Mac-OS-上调试" class="headerlink" title="在Mac OS 上调试"></a>在Mac OS 上调试</h3><p>iOS 生态环境调试会很容易。</p>
<h4 id="模拟环境"><a href="#模拟环境" class="headerlink" title="模拟环境"></a>模拟环境</h4><h5 id="环境准备"><a href="#环境准备" class="headerlink" title="环境准备"></a>环境准备</h5><ul>
<li>Xcode</li>
<li>Safari 浏览器</li>
</ul>
<h5 id="具体步骤"><a href="#具体步骤" class="headerlink" title="具体步骤"></a>具体步骤</h5><ol>
<li><p>打开 Xcode 后，如果没有 Xcode 项目可以按照步骤 A 创建一个测试项目。如果已有项目，可以按照步骤 B 打开项目。</p>
<img src="./WX20211030-170117@2x.png" alt="WX20211030-170117@2x" style="zoom: 33%;" /></li>
<li><p>选择想要调试的环境。可以选择Xcode提供的环境，也可以自定义手机型号和系统版本，如果需要测试特殊版本且 Xcode 中没有提供就需要去下载。</p>
<img src="./WX20211030-170505@2x.jpg" alt="WX20211030-170505@2x" style="zoom: 25%;" />

<img src="./WX20211030-170852@2x.png" alt="WX20211030-170852@2x" style="zoom: 25%;" /></li>
<li><p>选择具体环境后运行项目</p>
<p><img src="/posts/ef7ecee1/WX20211030-172002@2x.png" alt="WX20211030-172002@2x"></p>
</li>
<li><p>项目运行后会自动打开模拟器，然后点击【首页】按钮，回到首页后，打开模拟器的 Safari 浏览器。</p>
<p><img src="./WX20211030-171210@2x.png" alt="WX20211030-171210@2x" style="zoom:25%;" /><img src="./WX20211030-171523@2x.png" alt="WX20211030-171523@2x" style="zoom:25%;" /><img src="./WX20211030-171800@2x.png" alt="WX20211030-171800@2x" style="zoom:25%;" /></p>
</li>
<li><p>打开电脑的 Safari 浏览器进行调试。</p>
<img src="./WX20211031-213620@2x.png" alt="WX20211031-213620@2x" style="zoom:25%;" /></li>
<li><p>进入调试界面，这样就可以进行元素审查或断点调试了。</p>
<img src="./WX20211031-213524@2x.png" alt="WX20211031-213524@2x" style="zoom:25%;" /></li>
</ol>
<h4 id="真机调试"><a href="#真机调试" class="headerlink" title="真机调试"></a>真机调试</h4><p>需要搭配一台iPhone进行调试。</p>
<h5 id="环境准备-1"><a href="#环境准备-1" class="headerlink" title="环境准备"></a>环境准备</h5><ul>
<li><p>一台 iPhone</p>
</li>
<li><p>Safari 浏览器</p>
</li>
</ul>
<h5 id="具体步骤-1"><a href="#具体步骤-1" class="headerlink" title="具体步骤"></a>具体步骤</h5><ol>
<li><p>iPhone 需要进行【设置】-&gt; 【Safari浏览器】-&gt; 【高级】-&gt; 打开【JavaScript】&amp;【网页检查器】设置。</p>
<p><img src="./IMG_9365.jpg" alt="IMG_9365" style="zoom:25%;" /><img src="./IMG_9366.jpg" alt="IMG_9366" style="zoom:25%;" /></p>
</li>
<li><p>使用【数据线】连接 iPhone 和Mac OS电脑。</p>
</li>
<li><p>在电脑上的 Safari浏览器中就可以看到具体的真机设备，进行调试。</p>
<img src="./WX20211031-224833@2x.png" alt="WX20211031-224833@2x" style="zoom:25%;" /></li>
</ol>
]]></content>
      <categories>
        <category>整理</category>
      </categories>
      <tags>
        <tag>调试</tag>
        <tag>iOS</tag>
      </tags>
  </entry>
  <entry>
    <title>freeCodeCamp</title>
    <url>/posts/11355/</url>
    <content><![CDATA[<h3 id="1-翻转字符串"><a href="#1-翻转字符串" class="headerlink" title="1.翻转字符串"></a>1.翻转字符串</h3><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">reverseString</span><span class="token punctuation">(</span><span class="token parameter">str</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>

  <span class="token keyword">var</span> arr <span class="token operator">=</span> str<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">reverse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  str <span class="token operator">=</span> arr<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> str<span class="token punctuation">;</span>

<span class="token punctuation">&#125;</span>

<span class="token function">reverseString</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="2-实现阶乘"><a href="#2-实现阶乘" class="headerlink" title="2.实现阶乘"></a>2.实现阶乘</h3><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">factorialize</span><span class="token punctuation">(</span><span class="token parameter">num</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>

  <span class="token keyword">var</span> newNum <span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>

  <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> i<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>i<span class="token operator">&lt;=</span>num<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>

    newNum <span class="token operator">*=</span> i<span class="token punctuation">;</span>

  <span class="token punctuation">&#125;</span>

  num <span class="token operator">=</span> newNum<span class="token punctuation">;</span>

  <span class="token keyword">return</span> num<span class="token punctuation">;</span>

<span class="token punctuation">&#125;</span>

<span class="token function">factorialize</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="3-判断回文字符串"><a href="#3-判断回文字符串" class="headerlink" title="3.判断回文字符串"></a>3.判断回文字符串</h3><p><strong>即字符从左到右和从右到左都是一样的****。</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">palindrome</span><span class="token punctuation">(</span><span class="token parameter">str</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>

  str<span class="token operator">=</span>str<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\W|\s|_</span><span class="token regex-delimiter">/</span><span class="token regex-flags">ig</span></span><span class="token punctuation">,</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> str<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> str<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">reverse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">&#125;</span>

<span class="token function">palindrome</span><span class="token punctuation">(</span><span class="token string">"eye"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="4-返回字符串中最长的单词长度"><a href="#4-返回字符串中最长的单词长度" class="headerlink" title="4.返回字符串中最长的单词长度"></a>4.返回字符串中最长的单词长度</h3><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">findLongestWord</span><span class="token punctuation">(</span><span class="token parameter">str</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>

   <span class="token keyword">var</span> arr <span class="token operator">=</span> str<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

       len<span class="token operator">=</span>arr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>length<span class="token punctuation">;</span>

    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>arr<span class="token punctuation">.</span>length<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>

        <span class="token keyword">if</span><span class="token punctuation">(</span>len<span class="token operator">&lt;</span>arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>

            len<span class="token operator">=</span>arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>length<span class="token punctuation">;</span>

        <span class="token punctuation">&#125;</span>

    <span class="token punctuation">&#125;</span>

    <span class="token keyword">return</span> len<span class="token punctuation">;</span>

<span class="token punctuation">&#125;</span>

<span class="token function">findLongestWord</span><span class="token punctuation">(</span><span class="token string">"Google do a barrel roll"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="5-返回字符串中首字母大写"><a href="#5-返回字符串中首字母大写" class="headerlink" title="5.返回字符串中首字母大写"></a>5.返回字符串中首字母大写</h3><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token string">'Hi, my name\'s Han Meimei, a SOFTWARE engineer'</span><span class="token punctuation">;</span>  

<span class="token comment">//for循环  </span>

<span class="token keyword">function</span> <span class="token function">titleCase</span><span class="token punctuation">(</span><span class="token parameter">s</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  

    <span class="token keyword">var</span> i<span class="token punctuation">,</span> ss <span class="token operator">=</span> s<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\s+</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>  

    <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> ss<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  

        ss<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> ss<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> ss<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  

    <span class="token punctuation">&#125;</span>  

    <span class="token keyword">return</span> ss<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  

<span class="token punctuation">&#125;</span>  

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">titleCase</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="6-查找多个数组中的最大值，并返回最大值数组"><a href="#6-查找多个数组中的最大值，并返回最大值数组" class="headerlink" title="6.查找多个数组中的最大值，并返回最大值数组"></a>6.查找多个数组中的最大值，并返回最大值数组</h3><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">largestOfFour</span><span class="token punctuation">(</span><span class="token parameter">arr</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>

  <span class="token keyword">var</span> newArr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>arr<span class="token punctuation">.</span>length<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>

    newArr<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> j<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>j<span class="token operator">&lt;</span>arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>length<span class="token punctuation">;</span>j<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>

      <span class="token keyword">if</span><span class="token punctuation">(</span>newArr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">&lt;</span>arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>

        newArr<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span>

      <span class="token punctuation">&#125;</span>

    <span class="token punctuation">&#125;</span>

  <span class="token punctuation">&#125;</span>

  <span class="token keyword">return</span> newArr<span class="token punctuation">;</span>

<span class="token punctuation">&#125;</span>

<span class="token function">largestOfFour</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">27</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">,</span> <span class="token number">26</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">35</span><span class="token punctuation">,</span> <span class="token number">37</span><span class="token punctuation">,</span> <span class="token number">39</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1000</span><span class="token punctuation">,</span> <span class="token number">1001</span><span class="token punctuation">,</span> <span class="token number">857</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="7-截断字符串"><a href="#7-截断字符串" class="headerlink" title="7.截断字符串"></a>7.截断字符串</h3><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">truncate</span><span class="token punctuation">(</span><span class="token parameter">str<span class="token punctuation">,</span> num</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>

  <span class="token keyword">var</span> len <span class="token operator">=</span> str<span class="token punctuation">.</span>length<span class="token punctuation">;</span>

  <span class="token keyword">if</span><span class="token punctuation">(</span>len <span class="token operator">></span> num<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span>num<span class="token operator">></span><span class="token number">3</span><span class="token punctuation">)</span>

      str <span class="token operator">=</span> str<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>num<span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">"..."</span><span class="token punctuation">;</span>

    <span class="token keyword">else</span>

      str <span class="token operator">=</span> str<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>num<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">"..."</span><span class="token punctuation">;</span>

  <span class="token punctuation">&#125;</span>

  <span class="token keyword">return</span> str<span class="token punctuation">;</span>

<span class="token punctuation">&#125;</span>

<span class="token function">truncate</span><span class="token punctuation">(</span><span class="token string">"A-tisket a-tasket A green and yellow basket"</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="8-分割数组，将原一维数组分割成二维数组。"><a href="#8-分割数组，将原一维数组分割成二维数组。" class="headerlink" title="8.分割数组，将原一维数组分割成二维数组。"></a>8.分割数组，将原一维数组分割成二维数组。</h3><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">chunk</span><span class="token punctuation">(</span><span class="token parameter">arr<span class="token punctuation">,</span> size</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>

  <span class="token keyword">var</span> newArr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

  <span class="token keyword">var</span> j<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>

  <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>arr<span class="token punctuation">.</span>length<span class="token operator">/</span>size<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>

    newArr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span>arr<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>j<span class="token punctuation">,</span>j<span class="token operator">+</span>size<span class="token punctuation">)</span><span class="token punctuation">;</span>

    j<span class="token operator">+=</span>size<span class="token punctuation">;</span>

  <span class="token punctuation">&#125;</span>

  <span class="token keyword">return</span> newArr<span class="token punctuation">;</span>

<span class="token punctuation">&#125;</span>

<span class="token function">chunk</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"a"</span><span class="token punctuation">,</span> <span class="token string">"b"</span><span class="token punctuation">,</span> <span class="token string">"c"</span><span class="token punctuation">,</span> <span class="token string">"d"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>方法二：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">chunk</span><span class="token punctuation">(</span><span class="token parameter">arr<span class="token punctuation">,</span> size</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>

 <span class="token keyword">var</span> newArr<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

  <span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>arr<span class="token punctuation">.</span>length<span class="token punctuation">;</span>i<span class="token operator">+=</span>size<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>

    newArr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>arr<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span>i<span class="token operator">+</span>size<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token punctuation">&#125;</span>

  <span class="token keyword">return</span> newArr<span class="token punctuation">;</span>

<span class="token punctuation">&#125;</span>

<span class="token function">chunk</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"a"</span><span class="token punctuation">,</span> <span class="token string">"b"</span><span class="token punctuation">,</span> <span class="token string">"c"</span><span class="token punctuation">,</span> <span class="token string">"d"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="9-截断数组，返回一个数组被截断n个元素后还剩余的元素，截断从索引0开始。"><a href="#9-截断数组，返回一个数组被截断n个元素后还剩余的元素，截断从索引0开始。" class="headerlink" title="9.截断数组，返回一个数组被截断n个元素后还剩余的元素，截断从索引0开始。"></a>9.截断数组，返回一个数组被截断n个元素后还剩余的元素，截断从索引0开始。</h3><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">slasher</span><span class="token punctuation">(</span><span class="token parameter">arr<span class="token punctuation">,</span> howMany</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>

 <span class="token keyword">return</span> arr<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>howMany<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">&#125;</span>

<span class="token function">slasher</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="10-比较字符串，包含问题"><a href="#10-比较字符串，包含问题" class="headerlink" title="10.比较字符串，包含问题"></a>10.比较字符串，包含问题</h3><p><strong>若第一个字符串包含第二个字符串，返回true，反之，返回false。</strong></p>
<p>方法一：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">mutation</span><span class="token punctuation">(</span><span class="token parameter">arr</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>

  arr<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">=</span>arr<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">var</span> flag <span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

  <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>arr<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>length<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>

    flag<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span>arr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>arr<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token punctuation">&#125;</span>

  <span class="token keyword">return</span> flag<span class="token punctuation">.</span><span class="token function">every</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>

    <span class="token keyword">return</span> e <span class="token operator">></span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>

  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">&#125;</span>

<span class="token function">mutation</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"hello"</span><span class="token punctuation">,</span> <span class="token string">"hey"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>方法二：（简化方法一）</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">arr<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">=</span>arr<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">return</span> arr<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">every</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>

    <span class="token keyword">return</span> arr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token operator">></span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>

<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="11-过滤数组假值，删除数组中的所有假值。"><a href="#11-过滤数组假值，删除数组中的所有假值。" class="headerlink" title="11.过滤数组假值，删除数组中的所有假值。"></a>11.过滤数组假值，删除数组中的所有假值。</h3><p><strong>在JavaScript中，假值有false、null、0、””、undefined 和 NaN。</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">bouncer</span><span class="token punctuation">(</span><span class="token parameter">arr</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>

  <span class="token keyword">return</span> arr<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>

    <span class="token keyword">return</span> e<span class="token punctuation">;</span>

  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">&#125;</span>

<span class="token function">bouncer</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token string">"ate"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="12-摧毁数组"><a href="#12-摧毁数组" class="headerlink" title="12.摧毁数组"></a>12.摧毁数组</h3><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">destroyer</span><span class="token punctuation">(</span><span class="token parameter">arr</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>

  <span class="token keyword">var</span> args <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

  <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> arguments<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> 

<span class="token comment">//arguments表示函数参数输入值，将待摧毁的值放入一个数组中，赋值给变量args</span>

    args<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>arguments<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token punctuation">&#125;</span>

  <span class="token keyword">var</span> newArr<span class="token operator">=</span>arr<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token comment">//两个数组去重；</span>

    <span class="token keyword">return</span> args<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>

  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> newArr<span class="token punctuation">;</span>

<span class="token punctuation">&#125;</span>

<span class="token function">destroyer</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="13-数组排序并找出元素索引，"><a href="#13-数组排序并找出元素索引，" class="headerlink" title="13.数组排序并找出元素索引，"></a>13.数组排序并找出元素索引，</h3><p><strong>先给数组排序，然后找到指定的值在数组的位置，最后返回位置对应的索引。</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">where</span><span class="token punctuation">(</span><span class="token parameter">arr<span class="token punctuation">,</span> num</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>

  <span class="token keyword">if</span><span class="token punctuation">(</span>arr<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token operator">&lt;</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>

    arr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token punctuation">&#125;</span>

  arr<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span>b</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>

    <span class="token keyword">return</span> a<span class="token operator">-</span>b<span class="token punctuation">;</span>

  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> arr<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">&#125;</span>

<span class="token function">where</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="14-移位密码，字母会按照指定的数量来做移位。"><a href="#14-移位密码，字母会按照指定的数量来做移位。" class="headerlink" title="14.移位密码，字母会按照指定的数量来做移位。"></a>14.移位密码，字母会按照指定的数量来做移位。</h3><p><strong>所有的字母都是大写，不要转化任何非字母形式的字符(例如：空格，标点符号)，遇到这些特殊字符，跳过它们。</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">rot13</span><span class="token punctuation">(</span><span class="token parameter">str</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>

  <span class="token keyword">var</span> arr<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

  <span class="token keyword">var</span> <span class="token constant">A</span> <span class="token operator">=</span> <span class="token string">'A'</span><span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token constant">Z</span> <span class="token operator">=</span> <span class="token string">'Z'</span><span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">var</span> code<span class="token punctuation">;</span>

  <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>str<span class="token punctuation">.</span>length<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>

    code <span class="token operator">=</span> str<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span>code <span class="token operator">>=</span> <span class="token constant">A</span> <span class="token operator">&amp;&amp;</span> str<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token constant">Z</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>

      <span class="token keyword">if</span><span class="token punctuation">(</span>code <span class="token operator">&lt;</span> <span class="token constant">A</span><span class="token operator">+</span><span class="token number">13</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>

        arr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>String<span class="token punctuation">.</span><span class="token function">fromCharCode</span><span class="token punctuation">(</span>code<span class="token operator">+</span><span class="token number">13</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>

        arr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>String<span class="token punctuation">.</span><span class="token function">fromCharCode</span><span class="token punctuation">(</span>code<span class="token operator">-</span><span class="token number">13</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token punctuation">&#125;</span>

    <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>

      arr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>String<span class="token punctuation">.</span><span class="token function">fromCharCode</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">&#125;</span>

  <span class="token punctuation">&#125;</span>

  <span class="token keyword">return</span> arr<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">&#125;</span>

<span class="token function">rot13</span><span class="token punctuation">(</span><span class="token string">"SERR PBQR PNZC"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="15-区间累加求值"><a href="#15-区间累加求值" class="headerlink" title="15.区间累加求值"></a>15.区间累加求值</h3><p><strong>返回这两个数字和它们之间所有数字的和。</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">sumAll</span><span class="token punctuation">(</span><span class="token parameter">arr</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>

  arr<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span>b</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>

    <span class="token keyword">return</span> a<span class="token operator">-</span>b<span class="token punctuation">;</span>

  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">var</span> min<span class="token operator">=</span>arr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>max<span class="token operator">=</span>arr<span class="token punctuation">[</span>arr<span class="token punctuation">.</span>length<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

  <span class="token keyword">var</span> sum<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>

  <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> i<span class="token operator">=</span>min<span class="token punctuation">;</span>i<span class="token operator">&lt;=</span>max<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>

    sum<span class="token operator">+=</span>min<span class="token punctuation">;</span>

    min<span class="token operator">++</span><span class="token punctuation">;</span>

  <span class="token punctuation">&#125;</span>

  <span class="token keyword">return</span> sum<span class="token punctuation">;</span>

<span class="token punctuation">&#125;</span>

<span class="token function">sumAll</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="16-返回两个数组的不同值"><a href="#16-返回两个数组的不同值" class="headerlink" title="16.返回两个数组的不同值"></a>16.返回两个数组的不同值</h3><p><strong>返回两个数组的差异。</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">diff</span><span class="token punctuation">(</span><span class="token parameter">arr1<span class="token punctuation">,</span> arr2</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>

  <span class="token keyword">var</span> newArr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

 newArr<span class="token operator">=</span>arr1<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>arr2<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>

   <span class="token keyword">return</span> arr1<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token operator">==</span><span class="token operator">-</span><span class="token number">1</span><span class="token operator">||</span>arr2<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token operator">==</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>

 <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> newArr<span class="token punctuation">;</span>

<span class="token punctuation">&#125;</span>

<span class="token function">diff</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="17-匹配数组中的对象，返回匹配的值"><a href="#17-匹配数组中的对象，返回匹配的值" class="headerlink" title="17.匹配数组中的对象，返回匹配的值"></a>17.匹配数组中的对象，返回匹配的值</h3><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">where</span><span class="token punctuation">(</span><span class="token parameter">collection<span class="token punctuation">,</span> source</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>

  <span class="token keyword">var</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

  <span class="token keyword">var</span> sourcePro <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">var</span> flag <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>pro<span class="token punctuation">;</span>

  <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>collection<span class="token punctuation">.</span>length<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>

    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> j<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>j<span class="token operator">&lt;</span>sourcePro<span class="token punctuation">.</span>length<span class="token punctuation">;</span>j<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>

      pro <span class="token operator">=</span> sourcePro<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span>

      <span class="token keyword">if</span><span class="token punctuation">(</span>collection<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">(</span>pro<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>

        <span class="token keyword">if</span><span class="token punctuation">(</span>collection<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>pro<span class="token punctuation">]</span><span class="token operator">==</span>source<span class="token punctuation">[</span>pro<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>

          flag <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>

        <span class="token punctuation">&#125;</span><span class="token comment">/*else&#123;flag = 0; &#125;*/</span>

      <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>flag <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>

    <span class="token punctuation">&#125;</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span>flag <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>

      arr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>collection<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">&#125;</span>

  <span class="token punctuation">&#125;</span>

  <span class="token keyword">return</span> arr<span class="token punctuation">;</span>

<span class="token punctuation">&#125;</span>

<span class="token function">where</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">&#123;</span> <span class="token literal-property property">first</span><span class="token operator">:</span> <span class="token string">"Romeo"</span><span class="token punctuation">,</span> <span class="token literal-property property">last</span><span class="token operator">:</span> <span class="token string">"Montague"</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">first</span><span class="token operator">:</span> <span class="token string">"Mercutio"</span><span class="token punctuation">,</span> <span class="token literal-property property">last</span><span class="token operator">:</span> <span class="token keyword">null</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">first</span><span class="token operator">:</span> <span class="token string">"Tybalt"</span><span class="token punctuation">,</span> <span class="token literal-property property">last</span><span class="token operator">:</span> <span class="token string">"Capulet"</span> <span class="token punctuation">&#125;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">last</span><span class="token operator">:</span> <span class="token string">"Capulet"</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="18-搜索替换，"><a href="#18-搜索替换，" class="headerlink" title="18.搜索替换，"></a>18.搜索替换，</h3><p><strong>使用给定的参数对句子执行一次查找和替换，然后返回新句子。第一个参数是将要对其执行查找和替换的句子。第二个参数是将被替换掉的单词（替换前的单词）。第三个参数用于替换第二个参数（替换后的单词）。</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">myReplace</span><span class="token punctuation">(</span><span class="token parameter">str<span class="token punctuation">,</span> before<span class="token punctuation">,</span> after</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>

  <span class="token keyword">var</span> arr<span class="token operator">=</span>str<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>arr<span class="token punctuation">.</span>length<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span>arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">==</span>before<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>

      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">[a-z]</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>before<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token comment">//判断首字母是否大写</span>

        arr<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span>after<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>

       after<span class="token operator">=</span>after<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>after<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>after<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 

       arr<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span>after<span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token punctuation">&#125;</span>

    <span class="token punctuation">&#125;</span>

  <span class="token punctuation">&#125;</span>

  str <span class="token operator">=</span> arr<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> str<span class="token punctuation">;</span>

<span class="token punctuation">&#125;</span>

<span class="token function">myReplace</span><span class="token punctuation">(</span><span class="token string">"A quick brown fox jumped over the lazy dog"</span><span class="token punctuation">,</span> <span class="token string">"jumped"</span><span class="token punctuation">,</span> <span class="token string">"leaped"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="19-字符串移动插入算法，"><a href="#19-字符串移动插入算法，" class="headerlink" title="19.字符串移动插入算法，"></a>19.字符串移动插入算法，</h3><p><strong>把一个英文单词的第一个辅音或辅音丛（consonant cluster）移到词尾，然后加上后缀 “ay”。如果单词以元音开始，你只需要在词尾添加 “way” 就可以了。输入字符串保证是英文单词全部小写。</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">translate</span><span class="token punctuation">(</span><span class="token parameter">str</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>

  <span class="token keyword">var</span> latin<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"a"</span><span class="token punctuation">,</span><span class="token string">"o"</span><span class="token punctuation">,</span><span class="token string">"e"</span><span class="token punctuation">,</span><span class="token string">"i"</span><span class="token punctuation">,</span><span class="token string">"u"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

  <span class="token keyword">var</span> arr <span class="token operator">=</span> str<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>b<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span>flag<span class="token punctuation">;</span>

  <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>latin<span class="token punctuation">.</span>length<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span>arr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>latin<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">></span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>

      a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span>arr<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>latin<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">></span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>

      b <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>

  <span class="token punctuation">&#125;</span>

  <span class="token keyword">if</span><span class="token punctuation">(</span>a <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> b <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>

    arr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>arr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">+</span>arr<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token string">"ay"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>arr<span class="token punctuation">.</span><span class="token function">shift</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>arr<span class="token punctuation">.</span><span class="token function">shift</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>a <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>

    arr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">"way"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>a<span class="token operator">==</span><span class="token number">0</span> <span class="token operator">&amp;&amp;</span> b <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>

    arr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>arr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token string">"ay"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>arr<span class="token punctuation">.</span><span class="token function">shift</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token punctuation">&#125;</span>

    str <span class="token operator">=</span> arr<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> str<span class="token punctuation">;</span>

<span class="token punctuation">&#125;</span>

<span class="token function">translate</span><span class="token punctuation">(</span><span class="token string">"glove"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="20-DNA-链缺少配对的碱基。"><a href="#20-DNA-链缺少配对的碱基。" class="headerlink" title="20.DNA 链缺少配对的碱基。"></a>20.DNA 链缺少配对的碱基。</h3><p><strong>依据每一个碱基，为其找到配对的碱基，然后将结果作为第二个数组返回。Base pairs（碱基对） 是一对 AT 和 CG，为给定的字母匹配缺失的碱基。</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">pair</span><span class="token punctuation">(</span><span class="token parameter">str</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">var</span> arr <span class="token operator">=</span> str<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">var</span> newArr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>arr<span class="token punctuation">.</span>length<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>

        <span class="token keyword">switch</span><span class="token punctuation">(</span>arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>

            <span class="token keyword">case</span> <span class="token string">"G"</span> <span class="token operator">:</span> newArr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"G"</span><span class="token punctuation">,</span><span class="token string">"C"</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">break</span><span class="token punctuation">;</span>

            <span class="token keyword">case</span> <span class="token string">"C"</span> <span class="token operator">:</span> newArr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"C"</span><span class="token punctuation">,</span><span class="token string">"G"</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">break</span><span class="token punctuation">;</span>

            <span class="token keyword">case</span> <span class="token string">"A"</span> <span class="token operator">:</span> newArr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"A"</span><span class="token punctuation">,</span><span class="token string">"T"</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">break</span><span class="token punctuation">;</span>

            <span class="token keyword">case</span> <span class="token string">"T"</span> <span class="token operator">:</span> newArr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"T"</span><span class="token punctuation">,</span><span class="token string">"A"</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">break</span><span class="token punctuation">;</span>

        <span class="token punctuation">&#125;</span>

    <span class="token punctuation">&#125;</span>

    <span class="token keyword">return</span> newArr<span class="token punctuation">;</span>

<span class="token punctuation">&#125;</span>

<span class="token function">pair</span><span class="token punctuation">(</span><span class="token string">"GCG"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="21-字符串查询补充算法。"><a href="#21-字符串查询补充算法。" class="headerlink" title="21.字符串查询补充算法。"></a>21.字符串查询补充算法。</h3><p><strong>从传递进来的字母序列中找到缺失的字母并返回它。如果所有字母都在序列中，返回 undefined。</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">fearNotLetter</span><span class="token punctuation">(</span><span class="token parameter">str</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">var</span> code <span class="token operator">=</span> str<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">var</span> newStr <span class="token operator">=</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>

    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>str<span class="token punctuation">.</span>length<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>

        <span class="token keyword">if</span><span class="token punctuation">(</span>str<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">!=</span> String<span class="token punctuation">.</span><span class="token function">fromCharCode</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>

            newStr <span class="token operator">=</span> String<span class="token punctuation">.</span><span class="token function">fromCharCode</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">;</span>

          code<span class="token operator">++</span><span class="token punctuation">;</span>

        <span class="token punctuation">&#125;</span>

        code<span class="token operator">++</span><span class="token punctuation">;</span>

    <span class="token punctuation">&#125;</span>

<span class="token keyword">return</span> newStr<span class="token punctuation">;</span>

<span class="token punctuation">&#125;</span>

<span class="token function">fearNotLetter</span><span class="token punctuation">(</span><span class="token string">"bcd"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="22-数据类型检查算法，"><a href="#22-数据类型检查算法，" class="headerlink" title="22.数据类型检查算法，"></a>22.数据类型检查算法，</h3><p><strong>检查一个值是否是基本布尔类型，并返回 true 或 false。</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">boo</span><span class="token punctuation">(</span><span class="token parameter">bool</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>

   <span class="token keyword">return</span> <span class="token keyword">typeof</span> bool<span class="token operator">==</span><span class="token string">"boolean"</span><span class="token punctuation">;</span>

<span class="token punctuation">&#125;</span>

<span class="token function">boo</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="23-多个数组去重算法"><a href="#23-多个数组去重算法" class="headerlink" title="23.多个数组去重算法"></a>23.多个数组去重算法</h3><p><strong>传入两个或两个以上的数组，返回一个以给定的原始数组排序的不包含重复值的新数组。</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">unite</span><span class="token punctuation">(</span><span class="token parameter">arr1<span class="token punctuation">,</span> arr2<span class="token punctuation">,</span> arr3</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>

  <span class="token keyword">var</span> args <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

  <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>arguments<span class="token punctuation">.</span>length<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>

    args<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>arguments<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token punctuation">&#125;</span>

  args <span class="token operator">=</span> args<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span>b</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>

    <span class="token keyword">return</span> a<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  args <span class="token operator">=</span> args<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e<span class="token punctuation">,</span>index<span class="token punctuation">,</span>args</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>

    <span class="token keyword">return</span> args<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token operator">===</span>index<span class="token punctuation">;</span>

  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> args<span class="token punctuation">;</span>

<span class="token punctuation">&#125;</span>

<span class="token function">unite</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="24-html符号转实体算法，"><a href="#24-html符号转实体算法，" class="headerlink" title="24.html符号转实体算法，"></a>24.html符号转实体算法，</h3><p><strong>将字符串中的字符 &amp;、&lt;、&gt;、” （双引号）, 以及 ‘ （单引号）转换为它们对应的 HTML 实体。</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">convert</span><span class="token punctuation">(</span><span class="token parameter">str</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>

  <span class="token keyword">var</span> regObj <span class="token operator">=</span> <span class="token punctuation">&#123;</span>

    <span class="token string-property property">"&amp;"</span><span class="token operator">:</span><span class="token string">"&amp;amp;"</span><span class="token punctuation">,</span><span class="token string-property property">"&lt;"</span><span class="token operator">:</span><span class="token string">"&amp;lt;"</span><span class="token punctuation">,</span><span class="token string-property property">">"</span><span class="token operator">:</span><span class="token string">"&amp;gt;"</span><span class="token punctuation">,</span><span class="token string-property property">'"'</span><span class="token operator">:</span><span class="token string">"&amp;quot;"</span><span class="token punctuation">,</span><span class="token string-property property">"'"</span><span class="token operator">:</span><span class="token string">"&amp;apos;"</span>

  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

  <span class="token keyword">var</span> reg <span class="token operator">=</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">[&amp;&lt;>"']</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">;</span>

  <span class="token keyword">var</span> arr <span class="token operator">=</span> str<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>reg<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>

    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token keyword">in</span> arr<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>

      str <span class="token operator">=</span> str<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span>regObj<span class="token punctuation">[</span>arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">&#125;</span>

  <span class="token punctuation">&#125;</span>

  <span class="token keyword">return</span> str<span class="token punctuation">;</span>

<span class="token punctuation">&#125;</span>

<span class="token function">convert</span><span class="token punctuation">(</span><span class="token string">"Hamburgers &lt; Pizza &lt; Tacos"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="25-字符串连接算法"><a href="#25-字符串连接算法" class="headerlink" title="25.字符串连接算法"></a>25.字符串连接算法</h3><p><strong>将字符串转换为 spinal case ，Spinal case 是 all-lowercase-words-joined-by-dashes 这种形式的，也就是以连字符连接所有小写单词。</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">spinalCase</span><span class="token punctuation">(</span><span class="token parameter">str</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>

  <span class="token keyword">var</span> reg1 <span class="token operator">=</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">[\W_]</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">;</span>

  <span class="token keyword">var</span> reg2 <span class="token operator">=</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">[A-Z]</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">;</span>

  <span class="token keyword">var</span> arr <span class="token operator">=</span> str<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>reg1<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">var</span> arr2 <span class="token operator">=</span> str<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>reg2<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span><span class="token punctuation">(</span>arr <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>

    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token keyword">in</span> arr<span class="token punctuation">)</span>

    str <span class="token operator">=</span> str<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string">"-"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token punctuation">&#125;</span>

  <span class="token keyword">if</span><span class="token punctuation">(</span>arr2 <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>

    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token keyword">in</span> arr2<span class="token punctuation">)</span>

    str <span class="token operator">=</span> str<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>arr2<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string">"-"</span><span class="token operator">+</span>arr2<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token punctuation">&#125;</span>

  <span class="token keyword">return</span> str<span class="token punctuation">;</span>

<span class="token punctuation">&#125;</span>

<span class="token function">spinalCase</span><span class="token punctuation">(</span><span class="token string">'thisIsSpinalTap'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="26-计算斐波那契奇数和"><a href="#26-计算斐波那契奇数和" class="headerlink" title="26.计算斐波那契奇数和"></a>26.计算斐波那契奇数和</h3><p><strong>给一个正整数num，返回小于或等于num的斐波纳契奇数之和。</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">sumFibs</span><span class="token punctuation">(</span><span class="token parameter">num</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>

  <span class="token keyword">var</span> cache <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

   <span class="token keyword">if</span> <span class="token punctuation">(</span>num <span class="token operator">>=</span> cache<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>

        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> cache<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> num <span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>

            cache<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> cache<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">+</span> cache<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

         <span class="token punctuation">&#125;</span>

   <span class="token punctuation">&#125;</span>

  <span class="token keyword">var</span> arr<span class="token operator">=</span>cache<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">val</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>

       <span class="token keyword">return</span> val<span class="token operator">%</span><span class="token number">2</span><span class="token operator">!==</span><span class="token number">0</span><span class="token operator">&amp;&amp;</span>val<span class="token operator">&lt;=</span>num<span class="token punctuation">;</span>

   <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

   <span class="token keyword">return</span> arr<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">pre<span class="token punctuation">,</span>next</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>

          <span class="token keyword">return</span> pre<span class="token operator">+</span>next<span class="token punctuation">;</span>

   <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">&#125;</span>

<span class="token function">sumFibs</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="27-求小于等于给定数值的质数之和。"><a href="#27-求小于等于给定数值的质数之和。" class="headerlink" title="27.求小于等于给定数值的质数之和。"></a>27.求小于等于给定数值的质数之和。</h3><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">sumPrimes</span><span class="token punctuation">(</span><span class="token parameter">num</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>

  <span class="token keyword">var</span> sum<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>

  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> num<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>

     <span class="token keyword">var</span> isPN<span class="token operator">=</span><span class="token boolean">true</span><span class="token punctuation">;</span>

     <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> j<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">;</span>j<span class="token operator">&lt;</span>i<span class="token punctuation">;</span>j<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>

        <span class="token keyword">if</span><span class="token punctuation">(</span>i<span class="token operator">%</span>j <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>

          isPN<span class="token operator">=</span><span class="token boolean">false</span><span class="token punctuation">;</span>

          <span class="token keyword">break</span><span class="token punctuation">;</span>

        <span class="token punctuation">&#125;</span>

     <span class="token punctuation">&#125;</span>

  <span class="token keyword">if</span><span class="token punctuation">(</span>isPN<span class="token punctuation">)</span> sum<span class="token operator">+=</span>i<span class="token punctuation">;</span>

  <span class="token punctuation">&#125;</span>

  <span class="token keyword">return</span> sum<span class="token punctuation">;</span>

<span class="token punctuation">&#125;</span>

<span class="token function">sumPrimes</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="28-欧几里得算法（最小公倍数）"><a href="#28-欧几里得算法（最小公倍数）" class="headerlink" title="28.欧几里得算法（最小公倍数）"></a>28.欧几里得算法（最小公倍数）</h3><p><strong>找出能被两个给定参数和它们之间的连续数字整除的最小公倍数。（欧几里得算法）</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">smallestCommons</span><span class="token punctuation">(</span><span class="token parameter">arr</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>

  arr<span class="token operator">=</span>arr<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span>b</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>

    <span class="token keyword">return</span> a<span class="token operator">-</span>b<span class="token punctuation">;</span>

  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">var</span> num<span class="token operator">=</span>arr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

  <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> i<span class="token operator">=</span> arr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span>i<span class="token operator">&lt;=</span>arr<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>

    num<span class="token operator">*=</span>i<span class="token operator">/</span><span class="token function">gcd</span><span class="token punctuation">(</span>num<span class="token punctuation">,</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token punctuation">&#125;</span>

  <span class="token keyword">return</span> num<span class="token punctuation">;</span>

<span class="token punctuation">&#125;</span>

<span class="token keyword">function</span> <span class="token function">gcd</span><span class="token punctuation">(</span><span class="token parameter">m<span class="token punctuation">,</span>n</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>

  <span class="token keyword">if</span><span class="token punctuation">(</span>m<span class="token operator">%</span>n<span class="token operator">===</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token keyword">return</span> n<span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token function">gcd</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span>m<span class="token operator">%</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">&#125;</span>

<span class="token function">smallestCommons</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="29-返回参数数组中第一个满足参数函数-func-返回值的元素。"><a href="#29-返回参数数组中第一个满足参数函数-func-返回值的元素。" class="headerlink" title="29.返回参数数组中第一个满足参数函数 func 返回值的元素。"></a>29.返回参数数组中第一个满足参数函数 func 返回值的元素。</h3><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">find</span><span class="token punctuation">(</span><span class="token parameter">arr<span class="token punctuation">,</span> func</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>

  <span class="token keyword">var</span> num <span class="token operator">=</span> arr<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>func<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> num<span class="token punctuation">;</span>

<span class="token punctuation">&#125;</span>

<span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">num</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token keyword">return</span> num <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="30-丢弃数组-arr-的元素，"><a href="#30-丢弃数组-arr-的元素，" class="headerlink" title="30.丢弃数组(arr)的元素，"></a>30.丢弃数组(arr)的元素，</h3><p><strong>从左边开始，直到回调函数return true就停止。</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">drop</span><span class="token punctuation">(</span><span class="token parameter">arr<span class="token punctuation">,</span> func</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>

  <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">func</span><span class="token punctuation">(</span>arr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>

    arr<span class="token punctuation">.</span><span class="token function">shift</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token punctuation">&#125;</span>

  <span class="token keyword">return</span> arr<span class="token punctuation">;</span>

<span class="token punctuation">&#125;</span>

<span class="token function">drop</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">n</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token keyword">return</span> n <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="31-对嵌套的数组进行扁平化处理。"><a href="#31-对嵌套的数组进行扁平化处理。" class="headerlink" title="31.对嵌套的数组进行扁平化处理。"></a>31.对嵌套的数组进行扁平化处理。</h3><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">steamroller</span><span class="token punctuation">(</span><span class="token parameter">arr</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">return</span> arr<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">prev<span class="token punctuation">,</span>item</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>

        <span class="token keyword">return</span> prev<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token operator">?</span><span class="token function">steamroller</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token operator">:</span>item<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">&#125;</span>

<span class="token function">steamroller</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="32-传入二进制字符串，翻译成英语句子并返回。"><a href="#32-传入二进制字符串，翻译成英语句子并返回。" class="headerlink" title="32.传入二进制字符串，翻译成英语句子并返回。"></a>32.传入二进制字符串，翻译成英语句子并返回。</h3><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">binaryAgent</span><span class="token punctuation">(</span><span class="token parameter">str</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>

  <span class="token keyword">var</span> arr <span class="token operator">=</span> str<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  arr <span class="token operator">=</span> arr<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>

    <span class="token keyword">return</span> String<span class="token punctuation">.</span><span class="token function">fromCharCode</span><span class="token punctuation">(</span><span class="token function">parseInt</span><span class="token punctuation">(</span>e<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> arr<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">&#125;</span>

<span class="token function">binaryAgent</span><span class="token punctuation">(</span><span class="token string">"01000001 01110010 01100101 01101110 00100111 01110100 00100000 01100010 01101111 01101110 01100110 01101001 01110010 01100101 01110011 00100000 01100110 01110101 01101110 00100001 00111111"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="33-数组元素判断"><a href="#33-数组元素判断" class="headerlink" title="33.数组元素判断"></a>33.数组元素判断</h3><p><strong>如果集合(collection)中的所有对象都存在对应的属性(pre)，并且属性(pre)对应的值为真。函数返回ture。反之，返回false。</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">every</span><span class="token punctuation">(</span><span class="token parameter">collection<span class="token punctuation">,</span> pre</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>

  <span class="token comment">// Is everyone being true?</span>

  <span class="token keyword">return</span> collection<span class="token punctuation">.</span><span class="token function">every</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>

    <span class="token keyword">return</span> e<span class="token punctuation">[</span>pre<span class="token punctuation">]</span><span class="token punctuation">;</span>

  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">&#125;</span>

<span class="token function">every</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">&#123;</span><span class="token string-property property">"user"</span><span class="token operator">:</span> <span class="token string">"Tinky-Winky"</span><span class="token punctuation">,</span> <span class="token string-property property">"sex"</span><span class="token operator">:</span> <span class="token string">"male"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token string-property property">"user"</span><span class="token operator">:</span> <span class="token string">"Dipsy"</span><span class="token punctuation">,</span> <span class="token string-property property">"sex"</span><span class="token operator">:</span> <span class="token string">"male"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token string-property property">"user"</span><span class="token operator">:</span> <span class="token string">"Laa-Laa"</span><span class="token punctuation">,</span> <span class="token string-property property">"sex"</span><span class="token operator">:</span> <span class="token string">"female"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token string-property property">"user"</span><span class="token operator">:</span> <span class="token string">"Po"</span><span class="token punctuation">,</span> <span class="token string-property property">"sex"</span><span class="token operator">:</span> <span class="token string">"female"</span><span class="token punctuation">&#125;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">"sex"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="34-函数迭代参数求和"><a href="#34-函数迭代参数求和" class="headerlink" title="34.函数迭代参数求和"></a>34.函数迭代参数求和</h3><p><strong>创建一个计算两个参数之和的 function。如果只有一个参数，则返回一个 function，该 function 请求一个参数然后返回求和的结果。</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>

  <span class="token keyword">var</span> arr <span class="token operator">=</span> <span class="token class-name">Array</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span><span class="token punctuation">(</span>arr<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span>Number<span class="token punctuation">.</span><span class="token function">isFinite</span><span class="token punctuation">(</span>arr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> Number<span class="token punctuation">.</span><span class="token function">isFinite</span><span class="token punctuation">(</span>arr<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>

      <span class="token keyword">return</span> arr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">+</span>arr<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>

      <span class="token keyword">return</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>

    <span class="token punctuation">&#125;</span>

  <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span>Number<span class="token punctuation">.</span><span class="token function">isFinite</span><span class="token punctuation">(</span>arr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>

      <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">b</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>

        <span class="token keyword">if</span><span class="token punctuation">(</span>Number<span class="token punctuation">.</span><span class="token function">isFinite</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>

          <span class="token keyword">return</span> arr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">+</span>b<span class="token punctuation">;</span>

        <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>

          <span class="token keyword">return</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>

        <span class="token punctuation">&#125;</span>

      <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

    <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>

      <span class="token keyword">return</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>

    <span class="token punctuation">&#125;</span>

  <span class="token punctuation">&#125;</span>

  <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

<span class="token punctuation">&#125;</span>

<span class="token function">add</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="35-电话正则检测"><a href="#35-电话正则检测" class="headerlink" title="35. 电话正则检测"></a>35. 电话正则检测</h3><p><strong>如果传入字符串是一个有效的美国电话号码，则返回 true.</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">telephoneCheck</span><span class="token punctuation">(</span><span class="token parameter">str</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>

  <span class="token keyword">var</span> reg <span class="token operator">=</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^1? ?(\(\d&#123;3&#125;\)|\d&#123;3&#125;)[ |-]?\d&#123;3&#125;[ |-]?\d&#123;4&#125;$</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> reg<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">&#125;</span>

<span class="token function">telephoneCheck</span><span class="token punctuation">(</span><span class="token string">"555-555-5555"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>在线正则表达式检测：<a href="http://tool.oschina.net/regex">http://tool.oschina.net/regex</a></p>
<h3 id="36-对等差分"><a href="#36-对等差分" class="headerlink" title="36. 对等差分"></a>36. 对等差分</h3><p><strong>创建一个函数，接受两个或多个数组，返回所给数组的对等差分(△ or ⊕)数组.</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">sym</span><span class="token punctuation">(</span><span class="token parameter">args</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>

  <span class="token keyword">var</span> arr<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

  <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>arguments<span class="token punctuation">.</span>length<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>

    arr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>arguments<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token punctuation">&#125;</span>

  <span class="token keyword">var</span> temp <span class="token operator">=</span> arr<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">prev<span class="token punctuation">,</span>cur<span class="token punctuation">,</span>index<span class="token punctuation">,</span>array</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>

    <span class="token keyword">var</span> a <span class="token operator">=</span> prev<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>

      <span class="token keyword">return</span> cur<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">;</span>

    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">var</span> b <span class="token operator">=</span> cur<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>

      <span class="token keyword">return</span> prev<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">;</span>

    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> a<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> temp<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">item<span class="token punctuation">,</span>index<span class="token punctuation">,</span>array</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>

    <span class="token keyword">return</span> array<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span> <span class="token operator">==</span> index<span class="token punctuation">;</span>

  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">&#125;</span>

<span class="token function">sym</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="37-收银程序，找零算法"><a href="#37-收银程序，找零算法" class="headerlink" title="37. 收银程序，找零算法"></a>37. 收银程序，找零算法</h3><p><strong>其把购买价格(price)作为第一个参数 , 付款金额 (cash)作为第二个参数, 和收银机中零钱 (cid) 作为第三个参数.</strong></p>
<p><strong>参考博客：<a href="https://www.cnblogs.com/suifengershi/p/7442811.html">https://www.cnblogs.com/suifengershi/p/7442811.html</a></strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">checkCashRegister</span><span class="token punctuation">(</span><span class="token parameter">price<span class="token punctuation">,</span> cash<span class="token punctuation">,</span> cid</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>

  <span class="token keyword">var</span> change<span class="token punctuation">;</span>

  change <span class="token operator">=</span> cash <span class="token operator">-</span> price<span class="token punctuation">;</span><span class="token comment">//找的钱</span>

  <span class="token keyword">var</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">var</span> j<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>

  <span class="token keyword">var</span> array <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0.01</span><span class="token punctuation">,</span><span class="token number">0.05</span><span class="token punctuation">,</span><span class="token number">0.1</span><span class="token punctuation">,</span><span class="token number">0.25</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">//对应cid[i][0]</span>

  <span class="token keyword">var</span> total <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token keyword">var</span> money <span class="token operator">=</span> change<span class="token punctuation">;</span>                    

<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> i<span class="token operator">=</span>cid<span class="token punctuation">.</span>length<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>i<span class="token operator">>=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">--</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>

     total <span class="token operator">+=</span> cid<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">//总钱数</span>

    <span class="token comment">//cid[i][0]:PENNY单位,cid[i][1]:1.01总数</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span>change <span class="token operator">></span> array<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> cid<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">></span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token comment">//</span>

       <span class="token keyword">var</span> c <span class="token operator">=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>change<span class="token operator">/</span>array<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//可以找多少张这个钱</span>

       <span class="token comment">//如果change中可以找的这个钱的金额，比实际这个金额的钱大,说明可以将现有的钱找完，cid[i]应该放到数组中</span>

　　　<span class="token comment">//如果小，则将change可以找的金额放进去</span>

      <span class="token keyword">if</span><span class="token punctuation">(</span>c<span class="token operator">*</span>array<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">></span> cid<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>

         change <span class="token operator">-=</span> cid<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

      <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>

         change <span class="token operator">-=</span> c<span class="token operator">*</span>array<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>

         cid<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> c<span class="token operator">*</span>array<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>

      <span class="token punctuation">&#125;</span>

      change <span class="token operator">=</span> change<span class="token punctuation">.</span><span class="token function">toFixed</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//四舍五入，保留两位小数</span>

      <span class="token comment">//arr.push(cid[i]);</span>

      arr<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> cid<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>

      j<span class="token operator">++</span><span class="token punctuation">;</span>

    <span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span>

  <span class="token keyword">if</span><span class="token punctuation">(</span>total <span class="token operator">==</span> money<span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token comment">//总钱数等于要找的钱，closed</span>

    <span class="token keyword">return</span> <span class="token string">"Closed"</span><span class="token punctuation">;</span>

  <span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>total <span class="token operator">&lt;</span> money <span class="token operator">||</span> change <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token comment">//总钱数小于要找的钱，或者不能找整</span>

    <span class="token keyword">return</span> <span class="token string">"Insufficient Funds"</span><span class="token punctuation">;</span>

  <span class="token punctuation">&#125;</span>

  <span class="token keyword">return</span> arr<span class="token punctuation">;</span>

<span class="token punctuation">&#125;</span>

<span class="token comment">// Example cash-in-drawer array:</span>

<span class="token comment">// [["PENNY", 1.01],</span>

<span class="token comment">// ["NICKEL", 2.05],</span>

<span class="token comment">// ["DIME", 3.10],</span>

<span class="token comment">// ["QUARTER", 4.25],</span>

<span class="token comment">// ["ONE", 90.00],</span>

<span class="token comment">// ["FIVE", 55.00],</span>

<span class="token comment">// ["TEN", 20.00],</span>

<span class="token comment">// ["TWENTY", 60.00],</span>

<span class="token comment">// ["ONE HUNDRED", 100.00]]</span>

 

<span class="token function">checkCashRegister</span><span class="token punctuation">(</span><span class="token number">19.50</span><span class="token punctuation">,</span> <span class="token number">20.00</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">"PENNY"</span><span class="token punctuation">,</span> <span class="token number">1.01</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">"NICKEL"</span><span class="token punctuation">,</span> <span class="token number">2.05</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">"DIME"</span><span class="token punctuation">,</span> <span class="token number">3.10</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">"QUARTER"</span><span class="token punctuation">,</span> <span class="token number">4.25</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">"ONE"</span><span class="token punctuation">,</span> <span class="token number">90.00</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">"FIVE"</span><span class="token punctuation">,</span> <span class="token number">55.00</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">"TEN"</span><span class="token punctuation">,</span> <span class="token number">20.00</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">"TWENTY"</span><span class="token punctuation">,</span> <span class="token number">60.00</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">"ONE HUNDRED"</span><span class="token punctuation">,</span> <span class="token number">100.00</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="38-库存更新"><a href="#38-库存更新" class="headerlink" title="38.库存更新"></a>38.库存更新</h3><p><strong>依照一个存着新进货物的二维数组，更新存着现有库存(在 arr1 中)的二维数组. 如果货物已存在则更新数量 . 如果没有对应货物则把其加入到数组中，更新最新的数量. 返回当前的库存数组，且按货物名称的字母顺序排列.</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">updateInventory</span><span class="token punctuation">(</span><span class="token parameter">arr1<span class="token punctuation">,</span> arr2</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>

  <span class="token keyword">var</span> array1<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>array2<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

  <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>arr1<span class="token punctuation">.</span>length<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>

    array1<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>arr1<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token punctuation">&#125;</span>

  <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> j<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>j<span class="token operator">&lt;</span>arr2<span class="token punctuation">.</span>length<span class="token punctuation">;</span>j<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>

    array2<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>arr2<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token punctuation">&#125;</span>

  array1<span class="token operator">=</span>array1<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>array2<span class="token punctuation">)</span><span class="token punctuation">;</span>

  array2<span class="token operator">=</span>array1<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e<span class="token punctuation">,</span>index<span class="token punctuation">,</span>array1</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>

    <span class="token keyword">return</span> array1<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">!==</span>index<span class="token punctuation">;</span>

  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">var</span> curNum<span class="token punctuation">;</span>

  <span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>array2<span class="token punctuation">.</span>length<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>

    <span class="token keyword">for</span><span class="token punctuation">(</span>j<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>j<span class="token operator">&lt;</span>arr1<span class="token punctuation">.</span>length<span class="token punctuation">;</span>j<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>

      <span class="token keyword">if</span><span class="token punctuation">(</span>arr1<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">==</span>array2<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>

        curNum <span class="token operator">=</span> arr1<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

        arr1<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>j<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token punctuation">&#125;</span>

    <span class="token punctuation">&#125;</span>

    <span class="token keyword">for</span><span class="token punctuation">(</span>j<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>j<span class="token operator">&lt;</span>arr2<span class="token punctuation">.</span>length<span class="token punctuation">;</span>j<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>

      <span class="token keyword">if</span><span class="token punctuation">(</span>arr2<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">==</span>array2<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>

        arr2<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">+=</span>curNum<span class="token punctuation">;</span>

      <span class="token punctuation">&#125;</span>

    <span class="token punctuation">&#125;</span>

  <span class="token punctuation">&#125;</span>

  arr1<span class="token operator">=</span>arr1<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>arr2<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span>b</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>

    <span class="token keyword">return</span> a<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">localeCompare</span><span class="token punctuation">(</span>b<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> arr1<span class="token punctuation">;</span>

<span class="token punctuation">&#125;</span>

<span class="token comment">// 仓库库存示例</span>

<span class="token keyword">var</span> curInv <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">21</span><span class="token punctuation">,</span> <span class="token string">"Bowling Ball"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">"Dirty Sock"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"Hair Pin"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token string">"Microphone"</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> newInv <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">"Hair Pin"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">"Half-Eaten Apple"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">67</span><span class="token punctuation">,</span> <span class="token string">"Bowling Ball"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token string">"Toothpaste"</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token function">updateInventory</span><span class="token punctuation">(</span>curInv<span class="token punctuation">,</span> newInv<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="39-链表"><a href="#39-链表" class="headerlink" title="39.链表"></a>39.链表</h3><p>由一组结点组成的集合，每个结点都使用一个对象的引用指向它的后继，指向另一个结点的引用叫做链。链表一般有一个头结点。</p>
<p>①<strong>创建链表</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">LinkedList</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">var</span> <span class="token function-variable function">Node</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">element</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>

        <span class="token keyword">this</span><span class="token punctuation">.</span>element <span class="token operator">=</span> element<span class="token punctuation">;</span>

        <span class="token keyword">this</span><span class="token punctuation">.</span>next <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

	<span class="token punctuation">&#125;</span>

<span class="token comment">//其他方法</span>

<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>②<strong>向链表尾部添加元素</strong></p>
<p>列表为空，添加的是第一个元素。列表不为空，向其追加元素。要循环访问列表中的所有元素，就需要有一个起点，就是head。</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">append</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">element</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">var</span> node <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Node</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">//传入值创建Node项</span>

        current<span class="token punctuation">;</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span>head <span class="token operator">===</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">//如果为空链表</span>

        head <span class="token operator">=</span> node<span class="token punctuation">;</span> <span class="token comment">//设置node为head（head为第一个节点的引用）</span>

    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>

        current <span class="token operator">=</span> head<span class="token punctuation">;</span> <span class="token comment">//从表头开始</span>

        <span class="token keyword">while</span><span class="token punctuation">(</span>current<span class="token punctuation">.</span>next<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> 

            <span class="token comment">//循环列表，找到最后一项（列表最后一个节点的下一个元素始终是null）</span>

            current <span class="token operator">=</span> current<span class="token punctuation">.</span>next<span class="token punctuation">;</span>

        <span class="token punctuation">&#125;</span>

        <span class="token comment">//使当前最后一项的指针指向node</span>

        current<span class="token punctuation">.</span>next <span class="token operator">=</span> node<span class="token punctuation">;</span>

    <span class="token punctuation">&#125;</span>

    length<span class="token operator">++</span><span class="token punctuation">;</span> <span class="token comment">//更新列表长度</span>

<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token comment">// 使用append</span>

<span class="token keyword">var</span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LinkedList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

list<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

list<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>③<strong>从链表移除元素</strong></p>
<p>输入位置，从特定的位置移除元素</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">removeAt</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">position</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span>position <span class="token operator">></span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">&amp;&amp;</span> position <span class="token operator">&lt;</span> length<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">//有效性检测</span>

        <span class="token keyword">var</span> current <span class="token operator">=</span> head<span class="token punctuation">,</span> <span class="token comment">//用current来循环列表</span>

        previous<span class="token punctuation">,</span>

        index <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

 

        <span class="token keyword">if</span><span class="token punctuation">(</span>position <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>

            head <span class="token operator">=</span> current<span class="token punctuation">.</span>next<span class="token punctuation">;</span> <span class="token comment">//移除第一个元素，直接把head指向下一个元素</span>

        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>

            <span class="token keyword">while</span><span class="token punctuation">(</span>index<span class="token operator">++</span> <span class="token operator">&lt;</span> position<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">//循环列表找到满足条件的那个元素</span>

                previous <span class="token operator">=</span> current<span class="token punctuation">;</span> <span class="token comment">//</span>

                current <span class="token operator">=</span> current<span class="token punctuation">.</span>next<span class="token punctuation">;</span> <span class="token comment">//把下一个变量覆给current</span>

            <span class="token punctuation">&#125;</span>

            <span class="token comment">//跳过current，将当前要移除的元素的上一个与下一项直接连接起来。</span>

            previous<span class="token punctuation">.</span>next <span class="token operator">=</span> current<span class="token punctuation">.</span>next<span class="token punctuation">;</span>

        <span class="token punctuation">&#125;</span>

        length <span class="token operator">--</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> current<span class="token punctuation">.</span>element<span class="token punctuation">;</span>

    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>

        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

    <span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>④<strong>在任意位置插入元素</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">insert</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">position<span class="token punctuation">,</span> element</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span>position <span class="token operator">>=</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> position <span class="token operator">&lt;=</span> length<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>

        <span class="token keyword">var</span> node <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Node</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span><span class="token punctuation">,</span>

            current <span class="token operator">=</span> head<span class="token punctuation">;</span> <span class="token comment">//通过current从head位置开始迭代</span>

            previous<span class="token punctuation">,</span>

            index <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

 

        <span class="token keyword">if</span><span class="token punctuation">(</span>position <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">//第一个位置</span>

            node<span class="token punctuation">.</span>next <span class="token operator">=</span> current<span class="token punctuation">;</span> <span class="token comment">//此时current = head,指向head那么node就成了第一个</span>

            head <span class="token operator">=</span> node<span class="token punctuation">;</span> <span class="token comment">//node指向为head</span>

        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>

            <span class="token keyword">while</span> <span class="token punctuation">(</span>index<span class="token operator">++</span> <span class="token operator">&lt;</span> position <span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">//循环迭代到目标位置</span>

                previous <span class="token operator">=</span> current<span class="token punctuation">;</span> 

                current <span class="token operator">=</span> current<span class="token punctuation">.</span>next<span class="token punctuation">;</span>

            <span class="token punctuation">&#125;</span>

 

            node<span class="token punctuation">.</span>next <span class="token operator">=</span> current<span class="token punctuation">;</span> <span class="token comment">// node的下一个为current</span>

            previous<span class="token punctuation">.</span>next <span class="token operator">=</span> node<span class="token punctuation">;</span> <span class="token comment">// node的上一个位置为previous</span>

        <span class="token punctuation">&#125;</span>

        length<span class="token operator">++</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>

        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

    <span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>⑤<strong>把LinkedList对象转换成字符串</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">toString</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">var</span> current <span class="token operator">=</span> head<span class="token punctuation">,</span>

        string <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>

    <span class="token keyword">while</span><span class="token punctuation">(</span>current<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">//循环访问列表</span>

        string <span class="token operator">+=</span> current<span class="token punctuation">.</span>element <span class="token operator">+</span> <span class="token punctuation">(</span>current<span class="token punctuation">.</span>next <span class="token operator">?</span> <span class="token string">'\n'</span> <span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        current <span class="token operator">=</span> current<span class="token punctuation">.</span>next<span class="token punctuation">;</span>

    <span class="token punctuation">&#125;</span>

    <span class="token keyword">return</span> string<span class="token punctuation">;</span> <span class="token comment">//返回字符串</span>

<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>⑥<strong>返回元素的位置</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">indexOf</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">element</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">var</span> current <span class="token operator">=</span> head<span class="token punctuation">,</span>

        index <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

    <span class="token keyword">while</span><span class="token punctuation">(</span>current<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>

        <span class="token keyword">if</span><span class="token punctuation">(</span>element <span class="token operator">===</span> current<span class="token punctuation">.</span>element<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>

            <span class="token keyword">return</span> index<span class="token punctuation">;</span> <span class="token comment">//找到返回当前位置</span>

        <span class="token punctuation">&#125;</span>

        index <span class="token operator">++</span><span class="token punctuation">;</span>

        current <span class="token operator">=</span> current<span class="token punctuation">.</span>next<span class="token punctuation">;</span>

    <span class="token punctuation">&#125;</span>

    <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>    <span class="token comment">//找不到返回-1</span>

<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>⑦<strong>输入元素，移除该元素</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">remove</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">element</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">var</span> index <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//得到元素的位置</span>

    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">removeAt</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//移除该元素</span>

<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>⑧<strong>判断是否为空</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">isEmpty</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">return</span> length <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">;</span>

<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>⑨<strong>获取链表长度</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">size</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">return</span> length<span class="token punctuation">;</span>

<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>⑩<strong>获取第一个元素</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">getHead</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">return</span> head<span class="token punctuation">;</span>

<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="40-双向链表"><a href="#40-双向链表" class="headerlink" title="40.双向链表"></a>40.双向链表</h3><p><strong>在双向链表中，链接是双向的，一个链向下一个元素一个链向上一个元素。在操作双向链表的时候既要像普通链表一样考虑next，也要考虑prev。双向列表提供了两种迭代列表的方法：从头到尾迭代，或者反过来。</strong></p>
<p><strong>①</strong>    <strong>创建双向链表</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">DoublyLinkedList</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">var</span> <span class="token function-variable function">Node</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">element</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>

        <span class="token keyword">this</span><span class="token punctuation">.</span>element <span class="token operator">=</span> element<span class="token punctuation">;</span>

        <span class="token keyword">this</span><span class="token punctuation">.</span>next <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

        <span class="token keyword">this</span><span class="token punctuation">.</span>prev <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token comment">//新指针</span>

    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

    

    <span class="token keyword">var</span> length <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

    <span class="token keyword">var</span> head <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

    <span class="token keyword">var</span> tail <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token comment">//对列表最后一项的引用</span>

    

    <span class="token comment">//各种方法</span>

<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>②</strong>    <strong>在任意位置插入一个新元素</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">insert</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">position<span class="token punctuation">,</span> element</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span>position <span class="token operator">>=</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> position <span class="token operator">&lt;=</span> length<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>

        <span class="token keyword">var</span> node <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Node</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span><span class="token punctuation">,</span>

            current <span class="token operator">=</span> head<span class="token punctuation">,</span>

            previous<span class="token punctuation">,</span>

            index <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

            

        <span class="token keyword">if</span><span class="token punctuation">(</span>position <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">//在第一个位置添加</span>

            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>head<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">//如果head不存在即链表为空</span>

                head <span class="token operator">=</span> node<span class="token punctuation">;</span>

                tail <span class="token operator">=</span> node<span class="token punctuation">;</span>

            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span> <span class="token comment">//链表不为空</span>

                node<span class="token punctuation">.</span>next <span class="token operator">=</span> current<span class="token punctuation">;</span>

                current<span class="token punctuation">.</span>prev <span class="token operator">=</span> node<span class="token punctuation">;</span>

                head <span class="token operator">=</span> node<span class="token punctuation">;</span>

            <span class="token punctuation">&#125;</span>

        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>position <span class="token operator">===</span> length<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">//在最后一个位置添加</span>

            current <span class="token operator">=</span> tail<span class="token punctuation">;</span>

            current<span class="token punctuation">.</span>next <span class="token operator">=</span> node<span class="token punctuation">;</span>

            node<span class="token punctuation">.</span>prev <span class="token operator">=</span> current<span class="token punctuation">;</span>

            tail <span class="token operator">=</span> node<span class="token punctuation">;</span>

        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>

            <span class="token keyword">while</span><span class="token punctuation">(</span>index<span class="token operator">++</span> <span class="token operator">&lt;</span> position<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">//在列表中间添加</span>

                previous <span class="token operator">=</span> current<span class="token punctuation">;</span> <span class="token comment">//循环迭代</span>

                current <span class="token operator">=</span> current<span class="token punctuation">.</span>next<span class="token punctuation">;</span>

            <span class="token punctuation">&#125;</span>

            node<span class="token punctuation">.</span>next <span class="token operator">=</span> current<span class="token punctuation">;</span>

            previous<span class="token punctuation">.</span>next <span class="token operator">=</span> node<span class="token punctuation">;</span>          

            current<span class="token punctuation">.</span>prev <span class="token operator">=</span> node<span class="token punctuation">;</span>

            node<span class="token punctuation">.</span>prev <span class="token operator">=</span> previous<span class="token punctuation">;</span>

        <span class="token punctuation">&#125;</span>

        length <span class="token operator">++</span><span class="token punctuation">;</span> <span class="token comment">//更新列表长度</span>

        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>

        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

    <span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>③</strong>    <strong>从任意位置移除新元素</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">removeAt</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">position</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span>position <span class="token operator">></span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">&amp;&amp;</span> position <span class="token operator">&lt;</span> length<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">//检查越界值</span>

        <span class="token keyword">var</span> current <span class="token operator">=</span> head<span class="token punctuation">,</span>

            previous<span class="token punctuation">,</span>

            index <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span><span class="token punctuation">(</span>position <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">//第一个位置</span>

            head <span class="token operator">=</span> current<span class="token punctuation">.</span>next<span class="token punctuation">;</span>
           
            <span class="token keyword">if</span><span class="token punctuation">(</span>length <span class="token operator">===</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">//如果链表只有一项</span>

                tail <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span> <span class="token comment">//也就相当于把current.next.prev = null</span>

                head<span class="token punctuation">.</span>prev <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

            <span class="token punctuation">&#125;</span>

        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>position <span class="token operator">===</span> length <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">//最后一项</span>

            current <span class="token operator">=</span> tail<span class="token punctuation">;</span> <span class="token comment">//tail的引用赋给current变量</span>

            tail <span class="token operator">=</span> current<span class="token punctuation">.</span>prev<span class="token punctuation">;</span> <span class="token comment">//上一项指向tail</span>

            tail<span class="token punctuation">.</span>next <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token comment">//最后一项的next都是指向null的</span>

        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>

            <span class="token keyword">while</span><span class="token punctuation">(</span>index<span class="token operator">++</span> <span class="token operator">&lt;</span> position<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">//从中间位置移除</span>

                previous <span class="token operator">=</span> current<span class="token punctuation">;</span>

                current <span class="token operator">=</span> current<span class="token punctuation">.</span>next<span class="token punctuation">;</span>

            <span class="token punctuation">&#125;</span>            

            previous<span class="token punctuation">.</span>next <span class="token operator">=</span> current<span class="token punctuation">.</span>next<span class="token punctuation">;</span> <span class="token comment">//直接跳过current连接上一项和下一项</span>

            current<span class="token punctuation">.</span>next<span class="token punctuation">.</span>prev <span class="token operator">=</span> previous<span class="token punctuation">;</span>

        <span class="token punctuation">&#125;</span>

        length <span class="token operator">--</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> current<span class="token punctuation">.</span>element<span class="token punctuation">;</span>

    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>

        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

    <span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="https://imgchr.com/i/mYxRjx" alt="img"></p>
<h3 id="41-求最长公共子串"><a href="#41-求最长公共子串" class="headerlink" title="41.求最长公共子串"></a>41.求最长公共子串</h3><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">find</span><span class="token punctuation">(</span><span class="token parameter">str1<span class="token punctuation">,</span>str2</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>

<span class="token keyword">var</span> shorter<span class="token punctuation">,</span> longer<span class="token punctuation">;</span>

   <span class="token keyword">if</span><span class="token punctuation">(</span>str1<span class="token punctuation">.</span>length<span class="token operator">></span>str2<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>

     shorter <span class="token operator">=</span> str2<span class="token punctuation">;</span> longer <span class="token operator">=</span> str1

   <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>

     shorter <span class="token operator">=</span> str1<span class="token punctuation">;</span> longer <span class="token operator">=</span> str2<span class="token punctuation">;</span>

   <span class="token punctuation">&#125;</span>

   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> subLength <span class="token operator">=</span> shorter<span class="token punctuation">.</span>length<span class="token punctuation">;</span>subLength<span class="token operator">></span><span class="token number">0</span><span class="token punctuation">;</span>subLength<span class="token operator">--</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>

<span class="token comment">//先从第一个字符到最后一个字符检测，再从第一个字符到倒数第二个字符开始检测</span>

      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">+</span>subLength<span class="token operator">&lt;=</span>shorter<span class="token punctuation">.</span>length<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>

              <span class="token comment">//先从第一个字符到最后一个字符检测，再从第二个字符到最后一个字符检测</span>

         <span class="token keyword">var</span> subString <span class="token operator">=</span>shorter<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span>i<span class="token operator">+</span>subLength<span class="token punctuation">)</span><span class="token punctuation">;</span> 

         <span class="token keyword">if</span><span class="token punctuation">(</span>longer<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>subString<span class="token punctuation">)</span><span class="token operator">>=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>

              targetString <span class="token operator">=</span> subString<span class="token punctuation">;</span>

              <span class="token keyword">return</span> targetString<span class="token punctuation">;</span>

         <span class="token punctuation">&#125;</span>

      <span class="token punctuation">&#125;</span>

    <span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span>

<span class="token function">find</span><span class="token punctuation">(</span><span class="token string">"intesting"</span><span class="token punctuation">,</span><span class="token string">"string"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="42-找出数组中重复元素，并升序输出"><a href="#42-找出数组中重复元素，并升序输出" class="headerlink" title="42.找出数组中重复元素，并升序输出"></a>42.找出数组中重复元素，并升序输出</h3><p>//另一种解题思路，利用正则表达式求出相同数据的长度&gt;1则重复。</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">duplicates</span><span class="token punctuation">(</span><span class="token parameter">arr</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">var</span> arrNew<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>arr<span class="token punctuation">.</span>length<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>

        <span class="token keyword">if</span><span class="token punctuation">(</span>arr<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">!=</span>arr<span class="token punctuation">.</span><span class="token function">lastIndexOf</span><span class="token punctuation">(</span>arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>

            arrNew<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">&#125;</span>

    <span class="token punctuation">&#125;</span>

    arrNew <span class="token operator">=</span> arrNew<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span>index<span class="token punctuation">,</span>arrNew</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>

        <span class="token keyword">return</span> arrNew<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token operator">==</span>index<span class="token punctuation">;</span>

    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    arrNew <span class="token operator">=</span> arrNew<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span>b</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>

        <span class="token keyword">return</span> a<span class="token operator">-</span>b<span class="token punctuation">;</span>

    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> arrNew<span class="token punctuation">;</span>

<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

]]></content>
      <categories>
        <category>数据结构与算法</category>
      </categories>
      <tags>
        <tag>前端</tag>
        <tag>JavaScript</tag>
        <tag>算法</tag>
      </tags>
  </entry>
  <entry>
    <title>java基础-1</title>
    <url>/posts/41300/</url>
    <content><![CDATA[<h4 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h4><p>没有什么前言不前言的，就只是想记录一下去年写过的<code>Java</code>代码，有些逻辑还是很佩服自己的(乱七八糟的逻辑居然能跑通)，可能过段时间有更好的解决方案，记录一下。虽然目前我主做前端项目。</p>
<p>时间处理<code>util</code>是在写价格日历的时候用到的，本来想把价格日历的整个逻辑整理一下的，看着🤢，还是算了吧。</p>
<p>首先声明部分不是我写的，有些是百度的，有些是框架里的，年代久远也不想分太清了。</p>
<p>金额浮点数处理不只<code>java</code>中会有这个问题，<code>python</code>中也有，<code>javascript</code>就更不用说了，所以部分东西我认为是可以通用的。</p>
<h4 id="时间处理util"><a href="#时间处理util" class="headerlink" title="时间处理util"></a>时间处理util</h4><h5 id="获取一段时间内星期处理"><a href="#获取一段时间内星期处理" class="headerlink" title="获取一段时间内星期处理"></a>获取一段时间内星期处理</h5><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">xx<span class="token punctuation">.</span>xxx<span class="token punctuation">.</span>xxx<span class="token punctuation">.</span>util</span><span class="token punctuation">;</span> <span class="token comment">// 包名</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>text<span class="token punctuation">.</span></span><span class="token class-name">ParseException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>text<span class="token punctuation">.</span></span><span class="token class-name">SimpleDateFormat</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">ArrayList</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Calendar</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Date</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WeekDayUtil</span> <span class="token punctuation">&#123;</span>
<span class="token comment">//	public static void main(String[] args) &#123;</span>
<span class="token comment">//		String[] data = getDates("2018-12-01", "2018-12-31", "12");</span>
<span class="token comment">//		System.out.println(data);</span>
<span class="token comment">//	&#125;</span>

	<span class="token comment">/**
	 * 获取某一时间段特定星期几的日期
	 * 
	 * @param dateFrom 开始时间
	 * @param dateEnd 结束时间
	 * @param weekDays 星期
	 * @return 返回时间数组
	 */</span>
	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">getDates</span><span class="token punctuation">(</span><span class="token class-name">String</span> dateFrom<span class="token punctuation">,</span> <span class="token class-name">String</span> dateEnd<span class="token punctuation">,</span> <span class="token class-name">String</span> weekDays<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
		<span class="token keyword">long</span> time <span class="token operator">=</span> <span class="token number">1l</span><span class="token punctuation">;</span>
		<span class="token keyword">long</span> perDayMilSec <span class="token operator">=</span> <span class="token number">24</span> <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">;</span>
		<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> dateList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">SimpleDateFormat</span> sdf <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimpleDateFormat</span><span class="token punctuation">(</span><span class="token string">"yyyy-MM-dd"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">// 需要查询的星期系数</span>
		<span class="token class-name">String</span> strWeekNumber <span class="token operator">=</span> weekDays<span class="token punctuation">;</span> <span class="token comment">//weekForNum(weekDays);</span>
		<span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
			dateFrom <span class="token operator">=</span> sdf<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>sdf<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>dateFrom<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> perDayMilSec<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
				time <span class="token operator">=</span> sdf<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>dateFrom<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				time <span class="token operator">=</span> time <span class="token operator">+</span> perDayMilSec<span class="token punctuation">;</span>
				<span class="token class-name">Date</span> date <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>time<span class="token punctuation">)</span><span class="token punctuation">;</span>
				dateFrom <span class="token operator">=</span> sdf<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>date<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span>dateFrom<span class="token punctuation">.</span><span class="token function">compareTo</span><span class="token punctuation">(</span>dateEnd<span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
					<span class="token comment">// 查询的某一时间的星期系数</span>
					<span class="token class-name">Integer</span> weekDay <span class="token operator">=</span> <span class="token function">dayForWeek</span><span class="token punctuation">(</span>date<span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token comment">// 判断当期日期的星期系数是否是需要查询的</span>
					<span class="token keyword">if</span> <span class="token punctuation">(</span>strWeekNumber<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>weekDay<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
						dateList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>dateFrom<span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token punctuation">&#125;</span>
				<span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
					<span class="token keyword">break</span><span class="token punctuation">;</span>
				<span class="token punctuation">&#125;</span>
			<span class="token punctuation">&#125;</span>
		<span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">ParseException</span> e1<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
			e1<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">&#125;</span>
		<span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> dateArray <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span>dateList<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
		dateList<span class="token punctuation">.</span><span class="token function">toArray</span><span class="token punctuation">(</span>dateArray<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> dateArray<span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>

	<span class="token comment">// 等到当期时间的周系数。星期日：1，星期一：2，星期二：3，星期三：4，星期四：5，星期五：6，星期六：7</span>
	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Integer</span> <span class="token function">dayForWeek</span><span class="token punctuation">(</span><span class="token class-name">Date</span> date<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
		<span class="token class-name">Calendar</span> calendar <span class="token operator">=</span> <span class="token class-name">Calendar</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		calendar<span class="token punctuation">.</span><span class="token function">setTime</span><span class="token punctuation">(</span>date<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> calendar<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">Calendar</span><span class="token punctuation">.</span><span class="token constant">DAY_OF_WEEK</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>

	<span class="token comment">/**
	 * 得到对应星期的系数 星期日：1，星期一：2，星期二：3，星期三：4，星期四：5，星期五：6，星期六：7
	 * 
	 * @param weekDays 星期格式 星期一|星期二
	 */</span>
	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">weekForNum</span><span class="token punctuation">(</span><span class="token class-name">String</span> weekDays<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
		<span class="token comment">// 返回结果为组合的星期系数</span>
		<span class="token class-name">String</span> weekNumber <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>
		<span class="token comment">// 解析传入的星期</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>weekDays<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">"|"</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token comment">// 多个星期数</span>
			<span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> strWeeks <span class="token operator">=</span> weekDays<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">"\\|"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> strWeeks<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
				weekNumber <span class="token operator">=</span> weekNumber <span class="token operator">+</span> <span class="token string">""</span> <span class="token operator">+</span> <span class="token function">getWeekNum</span><span class="token punctuation">(</span>strWeeks<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">&#125;</span>
		<span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span><span class="token comment">// 一个星期数</span>
			weekNumber <span class="token operator">=</span> <span class="token function">getWeekNum</span><span class="token punctuation">(</span>weekDays<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">&#125;</span>
		<span class="token keyword">return</span> weekNumber<span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>
	
    <span class="token comment">// 注意：前端的星期与java获取的星期不一致</span>
	<span class="token comment">// 将星期转换为对应的系数 星期日：1，星期一：2，星期二：3，星期三：4，星期四：5，星期五：6，星期六：7</span>
	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Integer</span> <span class="token function">getWeekNum</span><span class="token punctuation">(</span><span class="token class-name">String</span> strWeek<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
		<span class="token class-name">Integer</span> number <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token comment">// 默认为星期日</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">"星期日"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>strWeek<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
			number <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
		<span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">"星期一"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>strWeek<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
			number <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
		<span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">"星期二"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>strWeek<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
			number <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
		<span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">"星期三"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>strWeek<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
			number <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>
		<span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">"星期四"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>strWeek<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
			number <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>
		<span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">"星期五"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>strWeek<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
			number <span class="token operator">=</span> <span class="token number">6</span><span class="token punctuation">;</span>
		<span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">"星期六"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>strWeek<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
			number <span class="token operator">=</span> <span class="token number">7</span><span class="token punctuation">;</span>
		<span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
			number <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
		<span class="token punctuation">&#125;</span>
		<span class="token keyword">return</span> number<span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h5 id="获取一段时间内的日期"><a href="#获取一段时间内的日期" class="headerlink" title="获取一段时间内的日期"></a>获取一段时间内的日期</h5><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">xx<span class="token punctuation">.</span>xxx<span class="token punctuation">.</span>xxx<span class="token punctuation">.</span>util</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>text<span class="token punctuation">.</span></span><span class="token class-name">SimpleDateFormat</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">ArrayList</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Calendar</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Date</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span>

<span class="token comment">/**
 * 获取一段时间内的日期
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FindDatesUtil</span> <span class="token punctuation">&#123;</span>

	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>

		<span class="token class-name">Calendar</span> cal <span class="token operator">=</span> <span class="token class-name">Calendar</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">String</span> start <span class="token operator">=</span> <span class="token string">"2012-02-01"</span><span class="token punctuation">;</span>
		<span class="token class-name">String</span> end <span class="token operator">=</span> <span class="token string">"2012-03-02"</span><span class="token punctuation">;</span>
		<span class="token class-name">SimpleDateFormat</span> sdf <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimpleDateFormat</span><span class="token punctuation">(</span><span class="token string">"yyyy-MM-dd"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">Date</span> dBegin <span class="token operator">=</span> sdf<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>start<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">Date</span> dEnd <span class="token operator">=</span> sdf<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>end<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Date</span><span class="token punctuation">></span></span> lDate <span class="token operator">=</span> <span class="token function">findDatesByDate</span><span class="token punctuation">(</span>dBegin<span class="token punctuation">,</span> dEnd<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Date</span> date <span class="token operator">:</span> lDate<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
			<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>sdf<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>date<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">&#125;</span>
		<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token function">getMaxDayByYearMonth</span><span class="token punctuation">(</span><span class="token number">2019</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>

	<span class="token comment">/**
	 * 获取一段时间内的日期,返回string
	 * @param Date dBegin
	 * @param Date dEnd
	 * @return List&lt;String>
	 */</span>
	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> <span class="token function">findDates</span><span class="token punctuation">(</span><span class="token class-name">Date</span> dBegin<span class="token punctuation">,</span> <span class="token class-name">Date</span> dEnd<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
		<span class="token class-name">List</span> lDate <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">SimpleDateFormat</span> sd <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimpleDateFormat</span><span class="token punctuation">(</span><span class="token string">"yyyy-MM-dd"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		lDate<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>sd<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>dBegin<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">Calendar</span> calBegin <span class="token operator">=</span> <span class="token class-name">Calendar</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">// 使用给定的 Date 设置此 Calendar 的时间</span>
		calBegin<span class="token punctuation">.</span><span class="token function">setTime</span><span class="token punctuation">(</span>dBegin<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">Calendar</span> calEnd <span class="token operator">=</span> <span class="token class-name">Calendar</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">// 使用给定的 Date 设置此 Calendar 的时间</span>
		calEnd<span class="token punctuation">.</span><span class="token function">setTime</span><span class="token punctuation">(</span>dEnd<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">// 测试此日期是否在指定日期之后</span>
		<span class="token keyword">while</span> <span class="token punctuation">(</span>dEnd<span class="token punctuation">.</span><span class="token function">after</span><span class="token punctuation">(</span>calBegin<span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
			<span class="token comment">// 根据日历的规则，为给定的日历字段添加或减去指定的时间量</span>
			calBegin<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">Calendar</span><span class="token punctuation">.</span><span class="token constant">DAY_OF_MONTH</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			lDate<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>sd<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>calBegin<span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">&#125;</span>
		<span class="token keyword">return</span> lDate<span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>
	
	<span class="token comment">/**
	 *  获取一段时间内的日期,返回date
	 * @param Date dBegin
	 * @param Date dEnd
	 * @return List&lt;Date>
	 */</span>
	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Date</span><span class="token punctuation">></span></span> <span class="token function">findDatesByDate</span><span class="token punctuation">(</span><span class="token class-name">Date</span> dBegin<span class="token punctuation">,</span> <span class="token class-name">Date</span> dEnd<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
		<span class="token class-name">List</span> lDate <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		lDate<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>dBegin<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">Calendar</span> calBegin <span class="token operator">=</span> <span class="token class-name">Calendar</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">// 使用给定的 Date 设置此 Calendar 的时间</span>
		calBegin<span class="token punctuation">.</span><span class="token function">setTime</span><span class="token punctuation">(</span>dBegin<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">Calendar</span> calEnd <span class="token operator">=</span> <span class="token class-name">Calendar</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">// 使用给定的 Date 设置此 Calendar 的时间</span>
		calEnd<span class="token punctuation">.</span><span class="token function">setTime</span><span class="token punctuation">(</span>dEnd<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">// 测试此日期是否在指定日期之后</span>
		<span class="token keyword">while</span> <span class="token punctuation">(</span>dEnd<span class="token punctuation">.</span><span class="token function">after</span><span class="token punctuation">(</span>calBegin<span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
			<span class="token comment">// 根据日历的规则，为给定的日历字段添加或减去指定的时间量</span>
			calBegin<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">Calendar</span><span class="token punctuation">.</span><span class="token constant">DAY_OF_MONTH</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			lDate<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>calBegin<span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">&#125;</span>
		<span class="token keyword">return</span> lDate<span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>
	
	<span class="token comment">/**
	 * 获得某个月最后一天
	 *
	 * @param year 年份
	 * @param month 月份 (1-12)
	 * @return 某个月最后一天日期
	 */</span>
	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">getLastDayByYearMonth</span><span class="token punctuation">(</span><span class="token keyword">int</span> year<span class="token punctuation">,</span> <span class="token keyword">int</span> month<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	  <span class="token class-name">SimpleDateFormat</span> format <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimpleDateFormat</span><span class="token punctuation">(</span><span class="token string">"yyyy-MM-dd"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
	  <span class="token class-name">Calendar</span> calendar <span class="token operator">=</span> <span class="token class-name">Calendar</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	  calendar<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token class-name">Calendar</span><span class="token punctuation">.</span><span class="token constant">YEAR</span><span class="token punctuation">,</span> year<span class="token punctuation">)</span><span class="token punctuation">;</span>
	  calendar<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token class-name">Calendar</span><span class="token punctuation">.</span><span class="token constant">MONTH</span><span class="token punctuation">,</span> month<span class="token punctuation">)</span><span class="token punctuation">;</span>
	  calendar<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token class-name">Calendar</span><span class="token punctuation">.</span><span class="token constant">DAY_OF_MONTH</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	  <span class="token comment">//return calendar.getActualMaximum(Calendar.DATE);</span>
	  <span class="token class-name">String</span> lastday <span class="token operator">=</span> format<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>calendar<span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	  <span class="token keyword">return</span> lastday<span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>
	
	<span class="token comment">/**
	 * 获得某个月第一天
	 *
	 * @param year 年份
	 * @param month 月份 (1-12)
	 * @return 某个月最后一天日期
	 */</span>
	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">getFirstDayByYearMonth</span><span class="token punctuation">(</span><span class="token keyword">int</span> year<span class="token punctuation">,</span> <span class="token keyword">int</span> month<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	  <span class="token class-name">SimpleDateFormat</span> format <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimpleDateFormat</span><span class="token punctuation">(</span><span class="token string">"yyyy-MM-dd"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
	  <span class="token class-name">Calendar</span> calendar <span class="token operator">=</span> <span class="token class-name">Calendar</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	  calendar<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token class-name">Calendar</span><span class="token punctuation">.</span><span class="token constant">YEAR</span><span class="token punctuation">,</span> year<span class="token punctuation">)</span><span class="token punctuation">;</span>
	  calendar<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token class-name">Calendar</span><span class="token punctuation">.</span><span class="token constant">MONTH</span><span class="token punctuation">,</span> month <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	  calendar<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token class-name">Calendar</span><span class="token punctuation">.</span><span class="token constant">DAY_OF_MONTH</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	  <span class="token comment">//return calendar.getActualMaximum(Calendar.DATE);</span>
	  <span class="token class-name">String</span> firstday <span class="token operator">=</span> format<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>calendar<span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	  <span class="token keyword">return</span> firstday<span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>
	
	<span class="token comment">/**
	 * 获得某个月最大天数
	 *
	 * @param year 年份
	 * @param month 月份 (1-12)
	 * @return 某个月最后一天日期
	 */</span>
	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">getMaxDayByYearMonth</span><span class="token punctuation">(</span><span class="token keyword">int</span> year<span class="token punctuation">,</span> <span class="token keyword">int</span> month<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	  <span class="token class-name">Calendar</span> calendar <span class="token operator">=</span> <span class="token class-name">Calendar</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	  calendar<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token class-name">Calendar</span><span class="token punctuation">.</span><span class="token constant">YEAR</span><span class="token punctuation">,</span> year<span class="token punctuation">)</span><span class="token punctuation">;</span>
	  calendar<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token class-name">Calendar</span><span class="token punctuation">.</span><span class="token constant">MONTH</span><span class="token punctuation">,</span> month<span class="token punctuation">)</span><span class="token punctuation">;</span>
	  <span class="token keyword">return</span> calendar<span class="token punctuation">.</span><span class="token function">getActualMaximum</span><span class="token punctuation">(</span><span class="token class-name">Calendar</span><span class="token punctuation">.</span><span class="token constant">DATE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>
	
	<span class="token comment">/**
	 * 想要获取的日期与传入日期的差值 比如想要获取传入日期前四天的日期 day=-4即可
     * @param date
     * @param day 
     * @return
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Date</span> <span class="token function">getDateByDiff</span><span class="token punctuation">(</span><span class="token class-name">Date</span> date<span class="token punctuation">,</span> <span class="token keyword">int</span> day<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token class-name">Calendar</span> calendar <span class="token operator">=</span> <span class="token class-name">Calendar</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        calendar<span class="token punctuation">.</span><span class="token function">setTime</span><span class="token punctuation">(</span>date<span class="token punctuation">)</span><span class="token punctuation">;</span>
        calendar<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">Calendar</span><span class="token punctuation">.</span><span class="token constant">DATE</span><span class="token punctuation">,</span> day<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> calendar<span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    

    <span class="token comment">/**
     * 判断时间是否在时间段内,返回boolean，区间为[beginTime,endTime)
     * @param nowTime
     * @param beginTime
     * @param endTime
     * @return
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">boolean</span> <span class="token function">isInPeriod</span><span class="token punctuation">(</span><span class="token class-name">Date</span> nowTime<span class="token punctuation">,</span> <span class="token class-name">Date</span> beginTime<span class="token punctuation">,</span> <span class="token class-name">Date</span> endTime<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">Calendar</span> date <span class="token operator">=</span> <span class="token class-name">Calendar</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        date<span class="token punctuation">.</span><span class="token function">setTime</span><span class="token punctuation">(</span>nowTime<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Calendar</span> begin <span class="token operator">=</span> <span class="token class-name">Calendar</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        begin<span class="token punctuation">.</span><span class="token function">setTime</span><span class="token punctuation">(</span>beginTime<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Calendar</span> end <span class="token operator">=</span> <span class="token class-name">Calendar</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        end<span class="token punctuation">.</span><span class="token function">setTime</span><span class="token punctuation">(</span>endTime<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>date<span class="token punctuation">.</span><span class="token function">after</span><span class="token punctuation">(</span>begin<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> date<span class="token punctuation">.</span><span class="token function">before</span><span class="token punctuation">(</span>end<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>nowTime<span class="token punctuation">.</span><span class="token function">compareTo</span><span class="token punctuation">(</span>beginTime<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">||</span> nowTime<span class="token punctuation">.</span><span class="token function">compareTo</span><span class="token punctuation">(</span>endTime<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h5 id="时间格式转换"><a href="#时间格式转换" class="headerlink" title="时间格式转换"></a>时间格式转换</h5><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">xx<span class="token punctuation">.</span>xxx<span class="token punctuation">.</span>xxx<span class="token punctuation">.</span>util</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>sql<span class="token punctuation">.</span></span><span class="token class-name">Timestamp</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>text<span class="token punctuation">.</span></span><span class="token class-name">DateFormat</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>text<span class="token punctuation">.</span></span><span class="token class-name">SimpleDateFormat</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Calendar</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Date</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DataFormatUtil</span> <span class="token punctuation">&#123;</span>
	
	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>
		<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">LongToStr</span><span class="token punctuation">(</span><span class="token number">1545350400</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>
	
	<span class="token comment">/**
	 * 时间戳转换为字符串
	 * @param time
	 * @return string
	 */</span>
	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">dateToStr</span><span class="token punctuation">(</span><span class="token class-name">Timestamp</span> time<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
		<span class="token class-name">DateFormat</span> df <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimpleDateFormat</span><span class="token punctuation">(</span><span class="token string">"yyyy-MM-dd HH:mm:ss"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">String</span> str <span class="token operator">=</span> df<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>time<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> str<span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>
	
	<span class="token comment">/**
	 * 整型转为字符串时间格式
	 * @param seconds
	 * @return
	 */</span>
	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token class-name">IntToStr</span><span class="token punctuation">(</span><span class="token keyword">int</span> seconds<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
		<span class="token class-name">Calendar</span> c<span class="token operator">=</span><span class="token class-name">Calendar</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">long</span> millions<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Long</span><span class="token punctuation">(</span>seconds<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">longValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">1000</span><span class="token punctuation">;</span>
		c<span class="token punctuation">.</span><span class="token function">setTimeInMillis</span><span class="token punctuation">(</span>millions<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">SimpleDateFormat</span> sdf <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimpleDateFormat</span><span class="token punctuation">(</span><span class="token string">"yyyy-MM-dd HH:mm:ss"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">String</span> dateString <span class="token operator">=</span> sdf<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>c<span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> dateString<span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>
	
	<span class="token comment">/**
	 * 整型转为字符串时间格式
	 * @param seconds
	 * @return
	 */</span>
	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token class-name">LongToStr</span><span class="token punctuation">(</span><span class="token keyword">long</span> seconds<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
		<span class="token class-name">Calendar</span> c<span class="token operator">=</span><span class="token class-name">Calendar</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">long</span> millions<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Long</span><span class="token punctuation">(</span>seconds<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">longValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">1000</span><span class="token punctuation">;</span>
		c<span class="token punctuation">.</span><span class="token function">setTimeInMillis</span><span class="token punctuation">(</span>millions<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">SimpleDateFormat</span> sdf <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimpleDateFormat</span><span class="token punctuation">(</span><span class="token string">"yyyy-MM-dd HH:mm:ss"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">String</span> dateString <span class="token operator">=</span> sdf<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>c<span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> dateString<span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>
	
	<span class="token comment">/**
	 * 字符串转Date时间格式
	 * @param strDate
	 * @return
	 */</span>
	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Date</span> <span class="token function">strToDate</span><span class="token punctuation">(</span><span class="token class-name">String</span> strDate<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
		<span class="token class-name">SimpleDateFormat</span> sdf <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimpleDateFormat</span><span class="token punctuation">(</span><span class="token string">"yyyy-MM-dd"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">Date</span> date<span class="token punctuation">;</span>
		<span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
			date <span class="token operator">=</span> sdf<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>strDate<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
			date <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
		<span class="token punctuation">&#125;</span>
		<span class="token keyword">return</span> date<span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h4 id="金额处理util"><a href="#金额处理util" class="headerlink" title="金额处理util"></a>金额处理util</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">xx<span class="token punctuation">.</span>xxx<span class="token punctuation">.</span>xxx<span class="token punctuation">.</span>util</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>math<span class="token punctuation">.</span></span><span class="token class-name">BigDecimal</span></span><span class="token punctuation">;</span>

<span class="token comment">/**
 * 由于Java的简单类型不能够精确的对浮点数进行运算， 这个工具类提供精确的浮点数运算，包括加减乘除和四舍五入。
 */</span>
<span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">CurrencyUtil</span> <span class="token punctuation">&#123;</span>

    <span class="token comment">// 默认除法运算精度</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token constant">DEF_DIV_SCALE</span> <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>

    <span class="token comment">// 这个类不能实例化</span>
    <span class="token keyword">private</span> <span class="token class-name">CurrencyUtil</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token comment">/**
     * 提供精确的加法运算。
     * @param v1 被加数
     * @param v2 加数
     * @return 两个参数的和
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Double</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">double</span> v1<span class="token punctuation">,</span> <span class="token keyword">double</span> v2<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">BigDecimal</span> b1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span><span class="token class-name">Double</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>v1<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">BigDecimal</span> b2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span><span class="token class-name">Double</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>v2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> b1<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>b2<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setScale</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">.</span><span class="token constant">ROUND_HALF_UP</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">doubleValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token comment">/**
     * 提供精确的减法运算。
     * @param v1 被减数
     * @param v2 减数
     * @return 两个参数的差
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">double</span> <span class="token function">sub</span><span class="token punctuation">(</span><span class="token keyword">double</span> v1<span class="token punctuation">,</span> <span class="token keyword">double</span> v2<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">BigDecimal</span> b1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span><span class="token class-name">Double</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>v1<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">BigDecimal</span> b2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span><span class="token class-name">Double</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>v2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> b1<span class="token punctuation">.</span><span class="token function">subtract</span><span class="token punctuation">(</span>b2<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setScale</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">.</span><span class="token constant">ROUND_HALF_UP</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">doubleValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token comment">/**
     * 提供精确的乘法运算。
     * @param v1 被乘数
     * @param v2 乘数
     * @return 两个参数的积
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Double</span> <span class="token function">mul</span><span class="token punctuation">(</span><span class="token keyword">double</span> v1<span class="token punctuation">,</span> <span class="token keyword">double</span> v2<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">BigDecimal</span> b1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span><span class="token class-name">Double</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>v1<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">BigDecimal</span> b2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span><span class="token class-name">Double</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>v2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> b1<span class="token punctuation">.</span><span class="token function">multiply</span><span class="token punctuation">(</span>b2<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setScale</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">.</span><span class="token constant">ROUND_HALF_UP</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">doubleValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token comment">/**
     * 提供精确的乘法运算。
     * @param v1 被乘数
     * @param v2 乘数
     * @return 两个参数的积
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Double</span> <span class="token function">mul</span><span class="token punctuation">(</span><span class="token keyword">double</span> v1<span class="token punctuation">,</span> <span class="token keyword">double</span> v2<span class="token punctuation">,</span> <span class="token class-name">Long</span> days<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">BigDecimal</span> b1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span><span class="token class-name">Double</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>v1<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">BigDecimal</span> b2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span><span class="token class-name">Double</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>v2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">BigDecimal</span> b3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span><span class="token class-name">Long</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>days<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">BigDecimal</span> onePrice <span class="token operator">=</span> b1<span class="token punctuation">.</span><span class="token function">multiply</span><span class="token punctuation">(</span>b2<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setScale</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">.</span><span class="token constant">ROUND_HALF_UP</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">BigDecimal</span> twoPrice <span class="token operator">=</span> onePrice<span class="token punctuation">.</span><span class="token function">multiply</span><span class="token punctuation">(</span>b3<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setScale</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">.</span><span class="token constant">ROUND_HALF_UP</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> twoPrice<span class="token punctuation">.</span><span class="token function">doubleValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token comment">/**
     * 提供（相对）精确的除法运算，当发生除不尽的情况时， 精确到小数点以后10位，以后的数字四舍五入。
     * @param v1 被除数
     * @param v2 除数
     * @return 两个参数的商
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">double</span> <span class="token function">div</span><span class="token punctuation">(</span><span class="token keyword">double</span> v1<span class="token punctuation">,</span> <span class="token keyword">double</span> v2<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token function">div</span><span class="token punctuation">(</span>v1<span class="token punctuation">,</span> v2<span class="token punctuation">,</span> <span class="token constant">DEF_DIV_SCALE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token comment">/**
     * 提供（相对）精确的除法运算。 当发生除不尽的情况时，由scale参数指定精度，以后的数字四舍五入。
     * @param v1 被除数
     * @param v2 除数
     * @param scale 表示表示需要精确到小数点以后几位。
     * @return 两个参数的商
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">double</span> <span class="token function">div</span><span class="token punctuation">(</span><span class="token keyword">double</span> v1<span class="token punctuation">,</span> <span class="token keyword">double</span> v2<span class="token punctuation">,</span> <span class="token keyword">int</span> scale<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>scale <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span><span class="token string">"The scale must be a positive integer or zero"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token class-name">BigDecimal</span> b1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span><span class="token class-name">Double</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>v1<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">BigDecimal</span> b2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span><span class="token class-name">Double</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>v2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> b1<span class="token punctuation">.</span><span class="token function">divide</span><span class="token punctuation">(</span>b2<span class="token punctuation">,</span> scale<span class="token punctuation">,</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">.</span><span class="token constant">ROUND_HALF_UP</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">doubleValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token comment">/**
     * 提供精确的小数位四舍五入处理。
     * @param v 需要四舍五入的数字
     * @param scale 小数点后保留几位
     * @return 四舍五入后的结果
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">double</span> <span class="token function">round</span><span class="token punctuation">(</span><span class="token keyword">double</span> v<span class="token punctuation">,</span> <span class="token keyword">int</span> scale<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>scale <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span><span class="token string">"The scale must be a positive integer or zero"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token class-name">BigDecimal</span> b <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span><span class="token class-name">Double</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">BigDecimal</span> one <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span><span class="token string">"1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> b<span class="token punctuation">.</span><span class="token function">divide</span><span class="token punctuation">(</span>one<span class="token punctuation">,</span> scale<span class="token punctuation">,</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">.</span><span class="token constant">ROUND_HALF_UP</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">doubleValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">Double</span> d1 <span class="token operator">=</span> <span class="token number">1.01</span><span class="token punctuation">;</span>
        <span class="token class-name">Double</span> d2 <span class="token operator">=</span> <span class="token number">0.42</span><span class="token punctuation">;</span>
        <span class="token comment">// //System.out.println(d1-d2);</span>
        <span class="token comment">// //System.out.println(Arith.sub(d1, d2));</span>
        <span class="token comment">// //System.out.println(Arith.sub1(d1, d2));</span>
        <span class="token comment">// long a = System.currentTimeMillis();</span>
        <span class="token comment">// for(int i=0;i&lt;10000;i++)&#123;</span>
        <span class="token comment">// double r = Arith.sub1(d1, d2);</span>
        <span class="token comment">// &#125;</span>
        <span class="token comment">// //System.out.println(System.currentTimeMillis() - a);</span>
        <span class="token comment">// //System.out.println(0.05+0.01);</span>
        <span class="token comment">// //System.out.println(1.0-0.42);</span>
        <span class="token comment">// //System.out.println(4.015*100);</span>
        <span class="token comment">// //System.out.println(123.3/100);</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">CurrencyUtil</span><span class="token punctuation">.</span><span class="token function">mul</span><span class="token punctuation">(</span><span class="token number">4.01511</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// System.out.println( CurrencyUtil.sub(2D, 10D) );</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

]]></content>
      <categories>
        <category>后端</category>
      </categories>
      <tags>
        <tag>后端</tag>
        <tag>java</tag>
      </tags>
  </entry>
  <entry>
    <title>node-jest使用</title>
    <url>/posts/3ab357ab/</url>
    <content><![CDATA[<p>参考阅读：</p>
<p>中文官网：<a href="http://nodejs.cn/api/assert.html">http://nodejs.cn/api/assert.html</a></p>
<p>node 中 自带的 assert api <a href="https://nodejs.org/docs/latest-v15.x/api/assert.html#assert_assert">https://nodejs.org/docs/latest-v15.x/api/assert.html#assert_assert</a></p>
]]></content>
      <categories>
        <category>前端</category>
        <category>node</category>
      </categories>
      <tags>
        <tag>node</tag>
        <tag>jest</tag>
        <tag>单元测试</tag>
      </tags>
  </entry>
  <entry>
    <title>node-koa2入门</title>
    <url>/posts/55ad86e2/</url>
    <content><![CDATA[<p>官网：<a href="https://koa.bootcss.com/">https://koa.bootcss.com/</a></p>
<p>中间件：<a href="https://github.com/koajs/koa/wiki#middleware">https://github.com/koajs/koa/wiki#middleware</a></p>
<p>学习教程：</p>
<p><a href="https://github.com/chenshenhai/koa2-note">koa2进阶学习笔记</a></p>
<p>项目地址：<a href="https://github.com/Datura35422/nodejs-demo-jiudao">https://github.com/Datura35422/nodejs-demo-jiudao</a></p>
<h3 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h3><h4 id="Koa2-被推出的原因"><a href="#Koa2-被推出的原因" class="headerlink" title="Koa2 被推出的原因"></a>Koa2 被推出的原因</h4><p>express 和 koa 框架都是相同的作者 TJ 写的。</p>
<p>express 框架内置了很多中间件，主要面对是企业级开发，底层采用的是 ES5 的方式。</p>
<p>koa2 出现主要是小而精，没有内置中间件，所以中间件自己安装，底层采用的是 ES7 的方式编写的。</p>
<p>两个框架的相关 api 大同小异。</p>
<h4 id="koa2-与-express-区别"><a href="#koa2-与-express-区别" class="headerlink" title="koa2 与 express  区别"></a>koa2 与 express  区别</h4><h5 id="express"><a href="#express" class="headerlink" title="express"></a>express</h5><ol>
<li>中间件调用呈直线型，即串行。使用 callback 的方式进行调用中间件，next() 函数只能在中间件底部使用，中间件一个一个往下执行。</li>
<li>基础Connect中间件，自身封装了路由、视图处理等功能。</li>
<li>弊端是callback回调方式，不可组合、异常不可捕获。</li>
<li>express 的路由是自身集成的；</li>
<li>express 采用传统的函数形式 function 进行启动； </li>
</ol>
<h5 id="koa2"><a href="#koa2" class="headerlink" title="koa2"></a>koa2</h5><ol>
<li>中间件呈U型，即“洋葱模型”。使用 Promise 的方式进行顺序调用中间件。所以中间件的 next() 函数可以使用 <code>async / await</code> 的方式进行调用，中间件一层一层往下执行，到达中心后再一层一层往外执行，因此是洋葱模型。</li>
<li>利用co作为底层运行框架，利用Generator的特性，实现“无回调”的异步处理。</li>
<li>利用 async 函数、Koa2丢弃回调函数，增强错误处理。</li>
<li>低级中间件层中提供高级“语法糖”，提高了互操性、稳健性。</li>
<li>Koa2新增了一个Context对象，用来代替Express的Request和Response，作为请求的上下文对象。  还有Node原生提供的req、res、socket等对象。</li>
<li>Koa的需要引入中间件Koa-router。</li>
<li>koa采用new Koa()方式启动；</li>
</ol>
<h5 id="使用区别"><a href="#使用区别" class="headerlink" title="使用区别"></a>使用区别</h5><p>参考链接：<a href="https://juejin.cn/post/6844903968041091080">https://juejin.cn/post/6844903968041091080</a></p>
<table>
<thead>
<tr>
<th></th>
<th>koa(Router = require(‘koa-router’))</th>
<th>express(假设不使用app.get之类的方法)</th>
</tr>
</thead>
<tbody><tr>
<td>初始化</td>
<td>const app = new koa()</td>
<td>const app = express()</td>
</tr>
<tr>
<td>实例化路由</td>
<td>const router = Router()</td>
<td>const router = express.Router()</td>
</tr>
<tr>
<td>app级别的中间件</td>
<td>app.use</td>
<td>app.use</td>
</tr>
<tr>
<td>路由级别的中间件</td>
<td>router.get</td>
<td>router.get</td>
</tr>
<tr>
<td>路由中间件挂载</td>
<td>app.use(router.routes())</td>
<td>app.use(‘/‘, router)</td>
</tr>
<tr>
<td>监听端口</td>
<td>app.listen(3000)</td>
<td>app.listen(3000)</td>
</tr>
</tbody></table>
<h4 id="koa2-中间件洋葱模型"><a href="#koa2-中间件洋葱模型" class="headerlink" title="koa2 中间件洋葱模型"></a>koa2 中间件洋葱模型</h4><p><img src="/./%E6%B4%8B%E8%91%B1%E6%A8%A1%E5%9E%8B.png" alt="洋葱模型"></p>
<h4 id="koa2-中间件处理逻辑-koa-compose"><a href="#koa2-中间件处理逻辑-koa-compose" class="headerlink" title="koa2 中间件处理逻辑 koa-compose"></a>koa2 中间件处理逻辑 koa-compose</h4><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token string">'use strict'</span>

<span class="token comment">/**
 * Expose compositor.
 */</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> compose

<span class="token comment">/**
 * Compose `middleware` returning
 * a fully valid middleware comprised
 * of all those which are passed.
 *
 * @param &#123;Array&#125; middleware
 * @return &#123;Function&#125;
 * @api public
 */</span>

<span class="token keyword">function</span> <span class="token function">compose</span> <span class="token punctuation">(</span><span class="token parameter">middleware</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token comment">// 判断中间件数组</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>middleware<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">TypeError</span><span class="token punctuation">(</span><span class="token string">'Middleware stack must be an array!'</span><span class="token punctuation">)</span>

  <span class="token comment">// 遍历 检测 中间件数组中的函数类型</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> fn <span class="token keyword">of</span> middleware<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> fn <span class="token operator">!==</span> <span class="token string">'function'</span><span class="token punctuation">)</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">TypeError</span><span class="token punctuation">(</span><span class="token string">'Middleware must be composed of functions!'</span><span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span>

  <span class="token comment">/**
   * @param &#123;Object&#125; context
   * @return &#123;Promise&#125;
   * @api public
   */</span>

  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">context<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// last called middleware #</span>
    <span class="token comment">// 传入当前内容和下一个中间件函数 闭包记录传入的中间件数组</span>
    <span class="token comment">// 初始化 index</span>
    <span class="token keyword">let</span> index <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span>
    <span class="token keyword">return</span> <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token comment">// 定义 dispatch 函数</span>
    <span class="token keyword">function</span> <span class="token function">dispatch</span> <span class="token punctuation">(</span><span class="token parameter">i</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token comment">// 如果 当前位置小于等于 index 则表示 next() 重复调用 </span>
      <span class="token comment">// next 会传入索引值 如果索引值没有改变则表示重复调用</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">&lt;=</span> index<span class="token punctuation">)</span> <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'next() called multiple times'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token comment">// 记录当前中间件的索引值</span>
      index <span class="token operator">=</span> i
      <span class="token comment">// 赋值当前中间件函数</span>
      <span class="token keyword">let</span> fn <span class="token operator">=</span> middleware<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
      <span class="token comment">// 如果当前位置超出了中间件的最后一个索引 则表示进入到了最里面的中间件 赋值为最里面中间件的next()</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">===</span> middleware<span class="token punctuation">.</span>length<span class="token punctuation">)</span> fn <span class="token operator">=</span> next
      <span class="token comment">// 如果下一个函数不存在 则返回完成状态</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>fn<span class="token punctuation">)</span> <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// 执行当前函数 将下一个中间件函数赋值给当前中间件next参数</span>
        <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token function">fn</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> <span class="token function">dispatch</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
      <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>jest 简单的测试用例</p>
<p>利用事件循环机制，将后续的内容加到微任务队列。</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'should work'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">const</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">const</span> stack <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

    <span class="token comment">// 中间件 1</span>
    stack<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">context<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        arr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token keyword">await</span> <span class="token function">wait</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token keyword">await</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 进入执行中间件2</span>
        <span class="token keyword">await</span> <span class="token function">wait</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
        arr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>

    <span class="token comment">// 中间件 2</span>
    stack<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">context<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        arr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
        <span class="token keyword">await</span> <span class="token function">wait</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token keyword">await</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 进入执行中间件3</span>
        <span class="token keyword">await</span> <span class="token function">wait</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
        arr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>

    <span class="token comment">// 中间件 3</span>
    stack<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">context<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        arr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
        <span class="token keyword">await</span> <span class="token function">wait</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token keyword">await</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 已经到洋葱中心 继续向下执行 回到上层中间件</span>
        <span class="token keyword">await</span> <span class="token function">wait</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
        arr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>

    <span class="token keyword">await</span> <span class="token function">compose</span><span class="token punctuation">(</span>stack<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEqual</span><span class="token punctuation">(</span>expect<span class="token punctuation">.</span><span class="token function">arrayContaining</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>







<p>1-1 koa2导学</p>
<p>遇到的问题</p>
<p>Koa框架到底为我们做了什么</p>
<p>他的内部到底是什么样子</p>
<p>他向下一直到Nodejs底层，到底是怎么处理事件循环的</p>
<p>一个异步的HTTP过程，到底是怎么进行的</p>
<p>技术栈：MongoDB、Puppeteer、AntDesign、Bootstrap、Parcel</p>
<h3 id="实战"><a href="#实战" class="headerlink" title="实战"></a>实战</h3><h4 id="上传图片-base64"><a href="#上传图片-base64" class="headerlink" title="上传图片 base64"></a>上传图片 base64</h4><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 教程：https://www.huaweicloud.com/articles/2687012349fabd74e9cc9da11c0ca640.html</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">&#123;</span> writeFileSync <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">&#123;</span> Buffer <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'buffer'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> Koa <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// https://github.com/koajs/router/blob/master/API.md</span>
<span class="token keyword">const</span> Router <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'@koa/router'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// https://github.com/koajs/koa-body</span>
<span class="token keyword">const</span> koaBody <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa-body'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// https://github.com/koajs/static</span>
<span class="token keyword">const</span> koaStatic <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa-static'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// https://github.com/koajs/cors</span>
<span class="token comment">// const cors = require('@koa/cors');</span>
<span class="token keyword">const</span> Crypto <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'crypto'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> SizeOf <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'image-size'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> images <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'images'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Koa</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// app.use(cors(&#123;</span>
<span class="token comment">//   'Access-Control-Allow-Methods': 'POST',</span>
<span class="token comment">//   'Access-Control-Allow-Origin': '*'</span>
<span class="token comment">// &#125;))</span>

<span class="token keyword">function</span> <span class="token function">_getHash</span><span class="token punctuation">(</span><span class="token parameter">salt <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> Crypto<span class="token punctuation">.</span><span class="token function">createHash</span><span class="token punctuation">(</span><span class="token string">'md5'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>salt<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">digest</span><span class="token punctuation">(</span><span class="token string">'hex'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">koaStatic</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'public'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

router<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/img'</span><span class="token punctuation">,</span> 
  <span class="token function">koaBody</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
    <span class="token literal-property property">multipart</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> 
    <span class="token comment">// https://github.com/node-formidable/formidable</span>
    <span class="token literal-property property">formidable</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
      <span class="token literal-property property">uploadDir</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'./public/uploads'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token literal-property property">keepExtensions</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token literal-property property">hash</span><span class="token operator">:</span> <span class="token string">'sha1'</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">const</span> file <span class="token operator">=</span> ctx<span class="token punctuation">.</span>request<span class="token punctuation">.</span>files<span class="token punctuation">.</span>file<span class="token punctuation">;</span>
    <span class="token keyword">const</span> basename <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">basename</span><span class="token punctuation">(</span>file<span class="token punctuation">.</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span>
    ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token punctuation">&#123;</span> 
      <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>ctx<span class="token punctuation">.</span>origin<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">/uploads/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>basename<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
      <span class="token literal-property property">hash</span><span class="token operator">:</span> file<span class="token punctuation">.</span>hash
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

router<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/pixel'</span><span class="token punctuation">,</span> 
  <span class="token function">koaBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">const</span> data <span class="token operator">=</span> ctx<span class="token punctuation">.</span>request<span class="token punctuation">.</span>body
    <span class="token comment">// => POST body</span>
    <span class="token keyword">const</span> pixel <span class="token operator">=</span> data<span class="token punctuation">.</span>pixel
    <span class="token keyword">if</span> <span class="token punctuation">(</span>pixel <span class="token operator">&amp;&amp;</span> Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>pixel<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">const</span> sizeOld <span class="token operator">=</span> pixel<span class="token punctuation">.</span>length <span class="token operator">/</span> <span class="token number">4</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>sizeOld<span class="token punctuation">)</span>
      <span class="token keyword">const</span> base64 <span class="token operator">=</span> pixel<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">base<span class="token punctuation">,</span> item</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">const</span> reg <span class="token operator">=</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">rgba\(([\d]+), ([\d]+), ([\d]+), 255\)</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> match <span class="token operator">=</span> reg<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        match<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>item <span class="token operator">!==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            base <span class="token operator">+=</span> String<span class="token punctuation">.</span><span class="token function">fromCharCode</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span>
          <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> base
      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment">// 转图片</span>
      <span class="token keyword">const</span> buf <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>base64<span class="token punctuation">,</span> <span class="token string">'base64'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> unit <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Uint8Array</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 返回一个被 string,编码格式是base64(默认编码格式是utf-8)的值初始化的新的 Buffer 实例</span>
      <span class="token keyword">const</span> salt <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> hash <span class="token operator">=</span> <span class="token function">_getHash</span><span class="token punctuation">(</span>salt<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> imgPath <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>hash<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">.jpg</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>

      <span class="token comment">// 计算图片大小</span>
      <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> width<span class="token punctuation">,</span> height <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token function">SizeOf</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>width<span class="token punctuation">,</span> height<span class="token punctuation">)</span>
      <span class="token keyword">const</span> sizeNew <span class="token operator">=</span> width <span class="token operator">*</span> height<span class="token punctuation">;</span>
      <span class="token keyword">const</span> multiple <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">abs</span><span class="token punctuation">(</span><span class="token punctuation">(</span>sizeOld <span class="token operator">/</span> sizeNew<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> newWidth <span class="token operator">=</span> multiple <span class="token operator">*</span> width<span class="token punctuation">;</span>
      <span class="token keyword">const</span> newHeight <span class="token operator">=</span> multiple <span class="token operator">*</span> height<span class="token punctuation">;</span>
      <span class="token keyword">const</span> newHash <span class="token operator">=</span> <span class="token function">_getHash</span><span class="token punctuation">(</span>salt <span class="token operator">+</span> <span class="token string">'new'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>multiple<span class="token punctuation">,</span> newHeight<span class="token punctuation">,</span> newWidth<span class="token punctuation">)</span>

      <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// 用fs写入文件</span>
        <span class="token keyword">const</span> uploadDir <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">./public/uploads</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">writeFileSync</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>uploadDir<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>imgPath<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> unit<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">images</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span>newWidth<span class="token punctuation">,</span> newHeight<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>uploadDir<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>newHash<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">.jpg</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
          <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>ctx<span class="token punctuation">.</span>origin<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">/uploads/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>imgPath<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
          hash
        <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
      <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

app
  <span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>router<span class="token punctuation">.</span><span class="token function">routes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>router<span class="token punctuation">.</span><span class="token function">allowedMethods</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'启动成功: http://localhost:3000'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>





]]></content>
      <categories>
        <category>前端</category>
        <category>node</category>
      </categories>
      <tags>
        <tag>node</tag>
        <tag>koa2</tag>
      </tags>
  </entry>
  <entry>
    <title>node-工具</title>
    <url>/posts/17067/</url>
    <content><![CDATA[<h3 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h3><h4 id="env"><a href="#env" class="headerlink" title="env"></a>env</h4><h3 id="工具库"><a href="#工具库" class="headerlink" title="工具库"></a>工具库</h3><h4 id="工具"><a href="#工具" class="headerlink" title="工具"></a>工具</h4><h5 id="cross-env"><a href="#cross-env" class="headerlink" title="cross-env"></a>cross-env</h5><p>window系统要获取到自定义的 env 参数，需要安装 <a href="https://www.npmjs.com/package/cross-env#installation"><code>cross-env</code></a> 依赖包，而 Linux 和 Mac 系统不需要。</p>
<p>更多相关阅读：</p>
<p><a href="https://gist.github.com/qiulang/31750f4cec0fe8aa800c1c5ccc032006">如何设置环境变量.md</a></p>
<h5 id="nodemon"><a href="#nodemon" class="headerlink" title="nodemon"></a><a href="https://github.com/remy/nodemon">nodemon</a></h5><p>当文件变化后自动重新运行项目。</p>
<h5 id="concurrently"><a href="#concurrently" class="headerlink" title="concurrently"></a><a href="https://github.com/kimmobrunfeldt/concurrently">concurrently</a></h5><p>并发运行多个命令。可以简写 “&amp;&amp;”。</p>
<h4 id="编译"><a href="#编译" class="headerlink" title="编译"></a>编译</h4><h5 id="node："><a href="#node：" class="headerlink" title="node："></a>node：</h5><p>部分项目需要设置特定的node版本环境。</p>
<h5 id="ts-node："><a href="#ts-node：" class="headerlink" title="ts-node："></a>ts-node：</h5><p>typescript 编译环境。</p>
<h4 id="请求库"><a href="#请求库" class="headerlink" title="请求库"></a>请求库</h4><p>参考链接：<a href="https://learn.vonage.com/blog/2020/09/23/5-ways-to-make-http-requests-in-node-js-2020-edition/">5 Ways To Make HTTP Requests In Node.js – 2020 Edition</a></p>
<h4 id="网页内容解析"><a href="#网页内容解析" class="headerlink" title="网页内容解析"></a>网页内容解析</h4><p><a href="https://github.com/cheeriojs/cheerio/wiki/Chinese-README">cheeriojs</a> ：为服务器特别定制的，快速、灵活、实施的jQuery核心实现。通常用于 node 端爬虫解析 HTML。</p>
]]></content>
      <categories>
        <category>前端</category>
        <category>node</category>
      </categories>
      <tags>
        <tag>工具</tag>
        <tag>node</tag>
      </tags>
  </entry>
  <entry>
    <title>node-项目部署</title>
    <url>/posts/43953bf1/</url>
    <content><![CDATA[<p>关于 <code>Linux</code> 环境搭建参考链接：<a href="https://datura35422.github.io/posts/62371/">Linux的使用</a></p>
<h3 id="node安装"><a href="#node安装" class="headerlink" title="node安装"></a>node安装</h3><p>参考链接：</p>
<p>Linux安装nodejs： <a href="https://blog.csdn.net/xerysherryx/article/details/78920978">https://blog.csdn.net/xerysherryx/article/details/78920978</a></p>
<p>centOS安装node：<a href="https://www.beiliangshizi.com/?p=671">https://www.beiliangshizi.com/?p=671</a></p>
<p>（比较详细）：<a href="https://www.cnblogs.com/fps2tao/p/9956139.html">https://www.cnblogs.com/fps2tao/p/9956139.html</a></p>
<h4 id="方法一：安装已编译版本"><a href="#方法一：安装已编译版本" class="headerlink" title="方法一：安装已编译版本"></a>方法一：安装已编译版本</h4><p>在官网选择 Linux 版本链接</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 安装环境</span>
<span class="token builtin class-name">cd</span> /usr/local/
<span class="token comment"># 不校验证书下载</span>
<span class="token function">wget</span> https://nodejs.org/dist/v10.11.0/node-v10.11.0-linux-x64.tar.xz --no-check-certificate
<span class="token comment"># 解压</span>
xz <span class="token parameter variable">-d</span> node-v10.11.0-linux-x64.tar.xz
<span class="token function">tar</span> <span class="token parameter variable">-xvf</span> node-v10.11.0-linux-x64.tar
<span class="token comment"># 文件重命名</span>
<span class="token function">mv</span> node-v10.11.0-linux-x64 nodejs
<span class="token comment"># 进入文件目录</span>
<span class="token builtin class-name">cd</span> nodejs
<span class="token comment"># 创建命令软连接</span>
<span class="token function">ln</span> <span class="token parameter variable">-s</span> /usr/local/nodejs/bin/node /usr/bin/node
<span class="token function">ln</span> <span class="token parameter variable">-s</span> /usr/local/nodejs/bin/npm /usr/bin/npm
<span class="token comment"># 或 进行批量创建</span>
<span class="token function">ln</span> <span class="token parameter variable">-s</span> /usr/local/nodejs/bin/* /usr/bin/<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>这个方法的弊端是，只要全局安装依赖包，就需要手动进行创建软连接</p>
<blockquote>
<p>或者可以根据情况来配置环境变量，但是创建软连接算是比较常用的方式</p>
</blockquote>
<h4 id="方法二：安装源代码"><a href="#方法二：安装源代码" class="headerlink" title="方法二：安装源代码"></a>方法二：安装源代码</h4><p>在官网选择源代码链接进行下载，自行进行编译</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 安装环境</span>
<span class="token builtin class-name">cd</span> /usr/local/
<span class="token comment"># 不校验证书下载</span>
<span class="token function">wget</span> https://nodejs.org/dist/v10.11.0/node-v10.11.0.tar.xz --no-check-certificate
<span class="token comment"># 解压</span>
xz <span class="token parameter variable">-d</span> node-v10.11.0-linux-x64.tar.xz
<span class="token function">tar</span> <span class="token parameter variable">-xvf</span> node-v10.11.0-linux-x64.tar
<span class="token comment"># 文件重命名</span>
<span class="token function">mv</span> node-v10.11.0-linux-x64 nodejs
<span class="token comment"># 进入文件目录</span>
<span class="token builtin class-name">cd</span> nodejs
<span class="token comment"># 进行安装编译环境（缺少什么安装什么，可能不止这些包）</span>
<span class="token function">sudo</span> yum <span class="token function">install</span> gcc gcc-c++ <span class="token function">make</span>
<span class="token comment"># 运行配置文件</span>
./configure
<span class="token comment"># 进行编译安装</span>
<span class="token function">make</span> <span class="token operator">&amp;&amp;</span> <span class="token function">make</span> <span class="token function">install</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>编译安装后会自动进行创建全局命令，好处是安装全局包的时候不用手动创建软连接，弊端是要搭建编译环境。</p>
<h4 id="安装验证"><a href="#安装验证" class="headerlink" title="安装验证"></a>安装验证</h4><p>安装成功</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">node</span> <span class="token parameter variable">-v</span>
<span class="token function">npm</span> <span class="token parameter variable">-v</span>
npx <span class="token parameter variable">-v</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>



<h4 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h4><h5 id="修改源"><a href="#修改源" class="headerlink" title="修改源"></a>修改源</h5><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment">#查看当前镜像源</span>
$ <span class="token function">npm</span> config get registry
<span class="token comment">#设置淘宝镜像源</span>
$ <span class="token function">npm</span> config <span class="token builtin class-name">set</span> registry https://registry.npm.taobao.org
<span class="token comment">#查看当前全局配置</span>
$ <span class="token function">npm</span> config list <span class="token parameter variable">-l</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="全局安装依赖"><a href="#全局安装依赖" class="headerlink" title="全局安装依赖"></a>全局安装依赖</h3><h4 id="pm2-进程管理工具"><a href="#pm2-进程管理工具" class="headerlink" title="pm2 - 进程管理工具"></a>pm2 - 进程管理工具</h4><p>官网：<a href="https://github.com/Unitech/pm2">https://github.com/Unitech/pm2</a></p>
<h5 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h5><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 普通安装，安装地址则是你执行命令得地址，使用默认镜像源</span>
$ <span class="token function">npm</span> <span class="token function">install</span> pm2
<span class="token comment"># 全局安装，安装在我们nodejs目录得lib中，使用默认镜像源</span>
$ <span class="token function">npm</span> <span class="token function">install</span> <span class="token parameter variable">-g</span> pm2
<span class="token comment"># 临时使用淘宝镜像源，全局安装</span>
$ <span class="token function">npm</span> <span class="token parameter variable">--registry</span> https://registry.npm.taobao.org <span class="token function">install</span> <span class="token parameter variable">-g</span> pm2
<span class="token comment"># 【如果是以方法一搭建的node环境，需要这一步】所有以pm2为前缀得文件建立连接</span>
$ <span class="token function">ln</span> <span class="token parameter variable">-s</span> /usr/local/nodejs/bin/pm2* /usr/local/bin/<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="局部安装依赖"><a href="#局部安装依赖" class="headerlink" title="局部安装依赖"></a>局部安装依赖</h3><h4 id="nodemon-监听文件改变自动编译"><a href="#nodemon-监听文件改变自动编译" class="headerlink" title="nodemon - 监听文件改变自动编译"></a>nodemon - 监听文件改变自动编译</h4><p>官网：<a href="https://github.com/remy/nodemon">https://github.com/remy/nodemon</a></p>
]]></content>
      <categories>
        <category>前端</category>
        <category>node</category>
      </categories>
      <tags>
        <tag>node</tag>
        <tag>部署</tag>
      </tags>
  </entry>
  <entry>
    <title>python学习-1</title>
    <url>/posts/58179/</url>
    <content><![CDATA[<h4 id="基础"><a href="#基础" class="headerlink" title="基础"></a>基础</h4><ul>
<li><p>输出：<code>print()</code></p>
</li>
<li><p>输入：<code>input()</code>，可以让用户输入字符串，并赋值，如：<code>name = input()</code>，提示符可以作为参数</p>
</li>
<li><p>注释：<code>#</code></p>
</li>
<li><p>代码块：语句以<code>:</code>结尾时，缩进的语句视为代码块，4个空格的缩进</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">a <span class="token operator">=</span> <span class="token number">100</span>
<span class="token keyword">if</span> a <span class="token operator">>=</span> <span class="token number">0</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>
<span class="token keyword">else</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token operator">-</span>a<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
<li><p>数据类型： </p>
<ul>
<li><p>整型</p>
</li>
<li><p>浮点数</p>
</li>
<li><p>字符串：单引号或双引号声明字符串，<code>r&#39;&#39;</code>表示<code>&#39;&#39;</code>中的字符串不转义，<code>&#39;&#39;&#39;...&#39;&#39;&#39;</code>表示多行内容，其中<code>...</code>在交互命令行中使用</p>
<ul>
<li><code>strip()</code>：去除字符串首尾的空格</li>
</ul>
</li>
<li><p>布尔值：<code>False</code>, <code>True</code>。布尔运算：<code>not</code>, <code>and</code>, <code>or</code> </p>
</li>
<li><p>空值：<code>None</code></p>
</li>
<li><p>变量：直接使用变量名（python是动态语言）</p>
</li>
<li><p>列表：</p>
<ul>
<li><code>list</code>（有序集合），类似于数组。使用<code>len()</code>获得<code>list</code>元素的个数，使用<code>-1</code>取到最后一个元素，使用负数可以从后获取元素。<ul>
<li><code>append(value)</code>：追加元素到末尾</li>
<li><code>insert(index, value)</code>：把元素插入到指定的位置</li>
<li><code>pop()</code>：删除末尾的元素，<code>list.pop(index)</code>删除指定位置的元素</li>
<li><code>len()</code>：获取元素个数<code>len(list)</code></li>
<li><code>+</code>：两个list拼接</li>
</ul>
</li>
<li><code>tuple</code>（元组），类似数组，但是一旦初始化就不能修改</li>
</ul>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># list定义</span>
<span class="token operator">>></span><span class="token operator">></span> classmates <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'Michael'</span><span class="token punctuation">,</span> <span class="token string">'Bob'</span><span class="token punctuation">,</span> <span class="token string">'Tracy'</span><span class="token punctuation">]</span>
<span class="token comment"># tuple定义</span>
<span class="token operator">>></span><span class="token operator">></span> t <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span> t <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span> t <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token punctuation">)</span> <span class="token comment"># 只有1个元素的tuple定义时必须加一个逗号，消除()运算符的歧义</span>
<span class="token comment"># 指针指向</span>
<span class="token operator">>></span><span class="token operator">></span> t <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'A'</span><span class="token punctuation">,</span> <span class="token string">'B'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span> t<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'X'</span>
<span class="token operator">>></span><span class="token operator">></span> t<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'Y'</span>
<span class="token operator">>></span><span class="token operator">></span> t
<span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'X'</span><span class="token punctuation">,</span> <span class="token string">'Y'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
<li><p>字典：</p>
<ul>
<li><code>dict</code>，类似map，使用键-值（key-value）存储<ul>
<li><code>in</code>，判断<code>dict</code>中是否存在key</li>
<li><code>get(key[，returnValue])</code>，判断<code>dict</code>中是否存在key，可以指定不存在时的返回值</li>
<li><code>pop(key)</code>，删除key值</li>
</ul>
</li>
<li><code>set</code>，类似无序集合，不储存value值，无重复key值<ul>
<li><code>add(key)</code>：添加元素到set中，可以重复添加，但是没有效果</li>
<li><code>remove(key)</code>：删除元素</li>
</ul>
</li>
</ul>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># dict定义</span>
<span class="token operator">>></span><span class="token operator">></span> d <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">'Michael'</span><span class="token punctuation">:</span> <span class="token number">95</span><span class="token punctuation">,</span> <span class="token string">'Bob'</span><span class="token punctuation">:</span> <span class="token number">75</span><span class="token punctuation">,</span> <span class="token string">'Tracy'</span><span class="token punctuation">:</span> <span class="token number">85</span><span class="token punctuation">&#125;</span>
<span class="token comment"># set定义</span>
<span class="token operator">>></span><span class="token operator">></span> s <span class="token operator">=</span> <span class="token builtin">set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li>与list区别：<ul>
<li>dict：查找和插入的速度极快，不会随着key的增加而变慢；需要占用大量的内存，内存浪费多。</li>
<li>list：查找和插入的时间随着元素的增加而增加；占用空间小，浪费内存很少。</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><p>运算：<code>+</code>，<code>-</code>，<code>*</code>，<code>/</code>（ 除法结果是浮点数），<code>//</code>（地板除，两个整数相除仍然是整数，除不尽的保留整数部分），<code>%</code>（取余）</p>
</li>
<li><p>编码：<code>ord()</code>获取字符的整数编码，<code>chr()</code>把编码转换为对应的字符，把<code>string</code>变为一字节为单位的<code>bytes</code>，<code>bytes</code>类型的数据用带<code>b</code>前缀的单引号或双引号表示，<code>bytes</code>的每个字符都只占用一个字节，以Unicode表示的<code>str</code>通过<code>encode()</code>方法可以编码为指定的<code>bytes</code>。纯英文的<code>str</code>可以用<code>ASCII</code>编码为<code>bytes</code>，内容是一样的，含有中文的<code>str</code>可以用<code>UTF-8</code>编码为<code>bytes</code>。含有中文的<code>str</code>无法用<code>ASCII</code>编码，因为中文编码的范围超过了<code>ASCII</code>编码的范围，Python会报错。</p>
<p>在<code>bytes</code>中，无法显示为ASCII字符的字节，用<code>\x##</code>显示。</p>
<p>从网络或磁盘上读取了字节流，那么读到的数据就是<code>bytes</code>。要把<code>bytes</code>变为<code>str</code>，就需要用<code>decode()</code>方法，如果<code>bytes</code>中包含无法解码的字节，<code>decode()</code>方法会报错。</p>
<p>如果<code>bytes</code>中只有一小部分无效的字节，可以传入<code>errors=&#39;ignore&#39;</code>忽略错误的字节。</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> <span class="token string">'中文'</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>
<span class="token string">b'\xe4\xb8\xad\xe6\x96\x87'</span>
<span class="token operator">>></span><span class="token operator">></span> <span class="token string">b'\xe4\xb8\xad\xff'</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">,</span> errors<span class="token operator">=</span><span class="token string">'ignore'</span><span class="token punctuation">)</span>
<span class="token string">'中'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>要计算<code>str</code>包含多少个字符，可以用<code>len()</code>函数，如果换成<code>bytes</code>，<code>len()</code>函数就计算字节数。</p>
<p>文件开头要写如下语句，第一句告诉Linux/OS X系统，这是一个Python可执行程序，第二句Python解释器，按照UTF-8编码读取源代码。文本编辑器里要设置UTF-8 without BOM编码。</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment">#!/usr/bin/env python3 </span>
<span class="token comment"># -*- coding: utf-8 -*-</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li>
<li><p>格式化：</p>
<ul>
<li><code>%</code>。在字符串内部，<code>%s</code>表示用字符串替换，<code>%d</code>表示用整数替换，<code>%f</code>表示用浮点数替换，<code>%x</code>表示用十六进制整数替换，转义也使用<code>%</code>，如<code>%%</code>转义为<code>%</code>。</li>
</ul>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> <span class="token string">'Hello, %s'</span> <span class="token operator">%</span> <span class="token string">'world'</span>
<span class="token string">'Hello, world'</span>
<span class="token operator">>></span><span class="token operator">></span> <span class="token string">'Hi, %s, you have $%d.'</span> <span class="token operator">%</span> <span class="token punctuation">(</span><span class="token string">'Michael'</span><span class="token punctuation">,</span> <span class="token number">1000000</span><span class="token punctuation">)</span>
<span class="token string">'Hi, Michael, you have $1000000.'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li>format()替换占位符<code>&#123;0&#125;</code>、<code>&#123;1&#125;</code>…</li>
</ul>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> <span class="token string">'Hello, &#123;0&#125;, 成绩提升了 &#123;1:.1f&#125;%'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token string">'小明'</span><span class="token punctuation">,</span> <span class="token number">17.125</span><span class="token punctuation">)</span>
<span class="token string">'Hello, 小明, 成绩提升了 17.1%'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li>
<li><p>条件判断： <code>if</code>、<code>elif(else if缩写)</code>、<code>else</code>（注意冒号缩进）</p>
</li>
<li><p>循环：</p>
<ul>
<li><code>for...in</code>循环list</li>
<li><code>while</code>循环</li>
<li><code>break</code>退出当前循环</li>
<li><code>continue</code>跳出当前循环进行下一次循环</li>
<li>注意不要滥用<code>break</code>和<code>continue</code>，分叉过多易出错</li>
</ul>
</li>
</ul>
<h4 id="作用域"><a href="#作用域" class="headerlink" title="作用域"></a>作用域</h4><p>当变量在Module(模块)、Class(类)、def(函数)中定义的时候，才会有作用域的概念。</p>
<p>在if-elif-else、for-else、while、try-except\try-finally等关键字的语句块中并不会产成作用域。</p>
<h5 id="作用域类型"><a href="#作用域类型" class="headerlink" title="作用域类型"></a>作用域类型</h5><p>在Python中，使用一个变量时并不严格要求需要预先声明它，但是在真正使用它之前，它必须被绑定到某个内存对象(被定义、赋值)；这种变量名的绑定将在当前作用域中引入新的变量，同时屏蔽外层作用域中的同名变量。</p>
<h6 id="局部作用域（Local）"><a href="#局部作用域（Local）" class="headerlink" title="局部作用域（Local）"></a>局部作用域（Local）</h6><p>包含在def关键字定义的语句块中，即在函数中定义的变量。每当函数被调用时都会创建一个新的局部作用域。</p>
<p>在局部作用域中声明全局变量需要使用<code>global</code>关键字</p>
<h6 id="嵌套作用域（Enclosing）"><a href="#嵌套作用域（Enclosing）" class="headerlink" title="嵌套作用域（Enclosing）"></a>嵌套作用域（Enclosing）</h6><p>在局部作用域中的def关键字中，嵌套作用域的上一层是局部作用域。闭包中的作用域。</p>
<h6 id="全局作用域（Global）"><a href="#全局作用域（Global）" class="headerlink" title="全局作用域（Global）"></a>全局作用域（Global）</h6><p>在模块层次中定义的变量，每一个模块都是一个全局作用域。</p>
<p>注意：全局作用域的作用范围仅限于单个模块文件内</p>
<h6 id="内置作用域（Built-in）"><a href="#内置作用域（Built-in）" class="headerlink" title="内置作用域（Built-in）"></a>内置作用域（Built-in）</h6><p>系统内固定模块里定义的变量，如预定义在<strong>builtin</strong> 模块内的变量。</p>
<h5 id="变量名解析LEGB法则"><a href="#变量名解析LEGB法则" class="headerlink" title="变量名解析LEGB法则"></a>变量名解析LEGB法则</h5><p>搜索变量名的优先级：局部作用域 &gt; 嵌套作用域 &gt; 全局作用域 &gt; 内置作用域</p>
<p><strong>LEGB法则</strong>： 当在函数中使用未确定的变量名时，Python会按照优先级依次搜索4个作用域，以此来确定该变量名的意义。首先搜索局部作用域(L)，之后是上一层嵌套结构中def或lambda函数的嵌套作用域(E)，之后是全局作用域(G)，最后是内置作用域(B)。按这个查找原则，在第一处找到的地方停止。如果没有找到，则会出发NameError错误。</p>
<p>当在当前作用域中的给变量赋值时，该变量将成为该作用域的局部变量，并在外部范围中<strong>隐藏任何类似命名的变量</strong></p>
<p><strong>Python中的模块代码在执行之前，并不会经过预编译，但是模块内的函数体代码在运行前会经过预编译，因此不管变量名的绑定发生在作用域的那个位置，都能被编译器知道。Python虽然是一个静态作用域语言，但变量名查找是动态发生的，直到在程序运行时，才会发现作用域方面的问题</strong></p>
<h4 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h4><h5 id="数学运算"><a href="#数学运算" class="headerlink" title="数学运算"></a>数学运算</h5><ul>
<li>绝对值：<code>abs(num)</code></li>
<li>阶乘：<code>fact(n)</code></li>
<li>最大值：<code>max(num1,num2,num3...)</code>，接受任意多个参数，并返回最大值</li>
<li>范围：<code>range(num)</code>，[0, num)区间的整数</li>
<li>加法：<code>sum()</code></li>
</ul>
<h5 id="数据类型转换"><a href="#数据类型转换" class="headerlink" title="数据类型转换"></a>数据类型转换</h5><ul>
<li>整型：<code>int(value)</code>，把其他数据类型转换为整数</li>
<li>浮点型：<code>float(value)</code>，把其他数据类型转换为浮点数</li>
<li>布尔值：<code>bool(value)</code>，把其他数据类型转换为布尔值</li>
<li>字符串：<code>str(value)</code>，把其他数据类型转换为字符</li>
<li>十六进制：<code>hex(value)</code>，把一个整数转换为十六进制表示的字符串</li>
<li>数据类型检查：<code>isinstance(num, (type1, type2))</code>: 对参数num做检查，只允许type1和type2类型的参数</li>
</ul>
<h5 id="函数定义-def"><a href="#函数定义-def" class="headerlink" title="函数定义 def"></a>函数定义 <code>def</code></h5><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># 不变参数</span>
<span class="token keyword">def</span> <span class="token function">my_abs</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token comment"># 可以设置参数的默认值，默认参数必须指向不变对象</span>
    <span class="token keyword">if</span> x <span class="token operator">>=</span> <span class="token number">0</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> x
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token operator">-</span>x
    
<span class="token comment"># 可变参数</span>
<span class="token keyword">def</span> <span class="token function">calc</span><span class="token punctuation">(</span><span class="token operator">*</span>numbers<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token comment"># numbers就是tuple数据类型</span>
    <span class="token builtin">sum</span> <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">for</span> n <span class="token keyword">in</span> numbers<span class="token punctuation">:</span>
        <span class="token builtin">sum</span> <span class="token operator">=</span> <span class="token builtin">sum</span> <span class="token operator">+</span> n <span class="token operator">*</span> n
    <span class="token keyword">return</span> <span class="token builtin">sum</span>
<span class="token comment"># 使用</span>
calc<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span>
<span class="token comment"># 或</span>
nums <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span>
calc<span class="token punctuation">(</span><span class="token operator">*</span>nums<span class="token punctuation">)</span>

<span class="token comment"># 关键字参数</span>
<span class="token keyword">def</span> <span class="token function">person</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> age<span class="token punctuation">,</span> <span class="token operator">**</span>kw<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token comment"># kw接收的是一个dict数据类型</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'name:'</span><span class="token punctuation">,</span> name<span class="token punctuation">,</span> <span class="token string">'age:'</span><span class="token punctuation">,</span> age<span class="token punctuation">,</span> <span class="token string">'other:'</span><span class="token punctuation">,</span> kw<span class="token punctuation">)</span>
<span class="token comment"># 使用</span>
person<span class="token punctuation">(</span><span class="token string">'Michael'</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span> <span class="token comment"># name: Michael age: 30 other: &#123;&#125;</span>
person<span class="token punctuation">(</span><span class="token string">'Adam'</span><span class="token punctuation">,</span> <span class="token number">45</span><span class="token punctuation">,</span> gender<span class="token operator">=</span><span class="token string">'M'</span><span class="token punctuation">,</span> job<span class="token operator">=</span><span class="token string">'Engineer'</span><span class="token punctuation">)</span> <span class="token comment"># name: Adam age: 45 other: &#123;'gender': 'M', 'job': 'Engineer'&#125;</span>
<span class="token comment"># 输出同上</span>
extra <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">'city'</span><span class="token punctuation">:</span> <span class="token string">'Beijing'</span><span class="token punctuation">,</span> <span class="token string">'job'</span><span class="token punctuation">:</span> <span class="token string">'Engineer'</span><span class="token punctuation">&#125;</span>
person<span class="token punctuation">(</span><span class="token string">'Jack'</span><span class="token punctuation">,</span> <span class="token number">24</span><span class="token punctuation">,</span> <span class="token operator">**</span>extra<span class="token punctuation">)</span> <span class="token comment"># **extra表示把extra这个dict的所有key-value用关键字参数传入到函数的**kw参数</span>

<span class="token comment"># 命名关键字参数，命名关键字参数需要一个特殊分隔符*，*后面的参数被视为命名关键字参数。</span>
<span class="token keyword">def</span> <span class="token function">person</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> age<span class="token punctuation">,</span> <span class="token operator">*</span><span class="token punctuation">,</span> city<span class="token punctuation">,</span> job<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> age<span class="token punctuation">,</span> city<span class="token punctuation">,</span> job<span class="token punctuation">)</span>
<span class="token comment"># 命名关键字参数必须传入参数名</span>
person<span class="token punctuation">(</span><span class="token string">'Jack'</span><span class="token punctuation">,</span> <span class="token number">24</span><span class="token punctuation">,</span> city<span class="token operator">=</span><span class="token string">'Beijing'</span><span class="token punctuation">,</span> job<span class="token operator">=</span><span class="token string">'Engineer'</span><span class="token punctuation">)</span>
<span class="token comment"># 如果函数定义中已经有了一个可变参数，后面跟着的命名关键字参数就不再需要一个特殊分隔符*了</span>
<span class="token keyword">def</span> <span class="token function">person</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> age<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> city<span class="token punctuation">,</span> job<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> age<span class="token punctuation">,</span> args<span class="token punctuation">,</span> city<span class="token punctuation">,</span> job<span class="token punctuation">)</span>
    
<span class="token comment"># 参数组合</span>
<span class="token comment"># 参数定义的顺序必须是：必选参数、默认参数、可变参数、命名关键字参数和关键字参数。</span>
<span class="token keyword">def</span> <span class="token function">f1</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kw<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'a ='</span><span class="token punctuation">,</span> a<span class="token punctuation">,</span> <span class="token string">'b ='</span><span class="token punctuation">,</span> b<span class="token punctuation">,</span> <span class="token string">'c ='</span><span class="token punctuation">,</span> c<span class="token punctuation">,</span> <span class="token string">'args ='</span><span class="token punctuation">,</span> args<span class="token punctuation">,</span> <span class="token string">'kw ='</span><span class="token punctuation">,</span> kw<span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">f2</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">*</span><span class="token punctuation">,</span> d<span class="token punctuation">,</span> <span class="token operator">**</span>kw<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'a ='</span><span class="token punctuation">,</span> a<span class="token punctuation">,</span> <span class="token string">'b ='</span><span class="token punctuation">,</span> b<span class="token punctuation">,</span> <span class="token string">'c ='</span><span class="token punctuation">,</span> c<span class="token punctuation">,</span> <span class="token string">'d ='</span><span class="token punctuation">,</span> d<span class="token punctuation">,</span> <span class="token string">'kw ='</span><span class="token punctuation">,</span> kw<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>空函数<code>pass</code></p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">nop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">pass</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p><code>pass</code>可以使用在其他语句中，先让代码能运行起来</p>
<p><code>raise</code>抛出错误</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">my_abs</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> <span class="token keyword">not</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token builtin">float</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">raise</span> TypeError<span class="token punctuation">(</span><span class="token string">'bad operand type'</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> x <span class="token operator">>=</span> <span class="token number">0</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> x
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token operator">-</span>x<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>函数返回多值时，就是返回的一个<code>tuple</code>，函数没有<code>return</code>返回时，自动`return None``</p>
<h4 id="高级特性"><a href="#高级特性" class="headerlink" title="高级特性"></a>高级特性</h4><h5 id="切片（Slice）："><a href="#切片（Slice）：" class="headerlink" title="切片（Slice）："></a>切片（Slice）：</h5><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> L <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'Michael'</span><span class="token punctuation">,</span> <span class="token string">'Sarah'</span><span class="token punctuation">,</span> <span class="token string">'Tracy'</span><span class="token punctuation">,</span> <span class="token string">'Bob'</span><span class="token punctuation">,</span> <span class="token string">'Jack'</span><span class="token punctuation">]</span>
<span class="token operator">>></span><span class="token operator">></span> L<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token comment"># L[0:3]表示，从索引0开始取，直到索引3为止，但不包括索引3,第一个索引为0可以省略</span>
<span class="token comment"># ['Michael', 'Sarah', 'Tracy']</span>
<span class="token operator">>></span><span class="token operator">></span> L<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token comment"># ['Sarah', 'Tracy']</span>
<span class="token operator">>></span><span class="token operator">></span> L<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">]</span> <span class="token comment"># ['Bob', 'Jack']</span>
<span class="token operator">>></span><span class="token operator">></span> L<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token comment"># ['Bob']</span>
<span class="token operator">>></span><span class="token operator">></span> L<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">]</span> <span class="token comment"># ['Michael', 'Sarah', 'Tracy', 'Bob', 'Jack']</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>tuple切片的结果仍为tuple</p>
<h5 id="迭代（for-in）："><a href="#迭代（for-in）：" class="headerlink" title="迭代（for...in）："></a>迭代（<code>for...in</code>）：</h5><p><code>for...in</code>可以用在可迭代对象上，如：<code>list</code>,<code>set</code>,<code>dict</code>,<code>tuple</code>,<code>str</code></p>
<p>迭代<code>dict</code>，默认情况下，迭代的是<code>key</code>，如果要迭代<code>value</code>，可以使用<code>for calue in d.values()</code>，如果要同时迭代<code>key</code>和<code>value</code>，可以用<code>for k, v in d.items()</code></p>
<p>判断一个对象是可迭代对象方法（通过<code>collections</code>模块的<code>Iterable</code>类型判断）</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">from</span> collections <span class="token keyword">import</span> Iterable
<span class="token operator">>></span><span class="token operator">></span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span><span class="token string">'abc'</span><span class="token punctuation">,</span> Iterable<span class="token punctuation">)</span> <span class="token comment"># str是否可迭代</span>
<span class="token boolean">True</span>
<span class="token operator">>></span><span class="token operator">></span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> Iterable<span class="token punctuation">)</span> <span class="token comment"># list是否可迭代</span>
<span class="token boolean">True</span>
<span class="token operator">>></span><span class="token operator">></span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span><span class="token number">123</span><span class="token punctuation">,</span> Iterable<span class="token punctuation">)</span> <span class="token comment"># 整数是否可迭代</span>
<span class="token boolean">False</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>通过索引循环<code>list</code>，python内置的<code>enumerate</code>函数可以把一个<code>list</code>变成索引-元素对</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">for</span> i<span class="token punctuation">,</span> value <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'A'</span><span class="token punctuation">,</span> <span class="token string">'B'</span><span class="token punctuation">,</span> <span class="token string">'C'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> value<span class="token punctuation">)</span>
<span class="token comment"># 同时引用两个变量</span>
<span class="token keyword">for</span> x<span class="token punctuation">,</span> y <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h5 id="列表生成式"><a href="#列表生成式" class="headerlink" title="列表生成式"></a>列表生成式</h5><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">]</span>

<span class="token operator">>></span><span class="token operator">></span> L <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>    L<span class="token punctuation">.</span>append<span class="token punctuation">(</span>x <span class="token operator">*</span> x<span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token operator">>></span><span class="token operator">></span> L
<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">,</span> <span class="token number">36</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">81</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">]</span>
<span class="token comment"># 列表生成式</span>
<span class="token operator">>></span><span class="token operator">></span> <span class="token punctuation">[</span>x <span class="token operator">*</span> x <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">,</span> <span class="token number">36</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">81</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">]</span>
<span class="token comment"># 筛选出仅偶数的平方</span>
<span class="token operator">>></span><span class="token operator">></span> <span class="token punctuation">[</span>x <span class="token operator">*</span> x <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">)</span> <span class="token keyword">if</span> x <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">36</span><span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">]</span>
<span class="token comment"># 全排列</span>
<span class="token operator">>></span><span class="token operator">></span> <span class="token punctuation">[</span>m <span class="token operator">+</span> n <span class="token keyword">for</span> m <span class="token keyword">in</span> <span class="token string">'ABC'</span> <span class="token keyword">for</span> n <span class="token keyword">in</span> <span class="token string">'XYZ'</span><span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token string">'AX'</span><span class="token punctuation">,</span> <span class="token string">'AY'</span><span class="token punctuation">,</span> <span class="token string">'AZ'</span><span class="token punctuation">,</span> <span class="token string">'BX'</span><span class="token punctuation">,</span> <span class="token string">'BY'</span><span class="token punctuation">,</span> <span class="token string">'BZ'</span><span class="token punctuation">,</span> <span class="token string">'CX'</span><span class="token punctuation">,</span> <span class="token string">'CY'</span><span class="token punctuation">,</span> <span class="token string">'CZ'</span><span class="token punctuation">]</span>
<span class="token comment"># 两个变量</span>
<span class="token operator">>></span><span class="token operator">></span> d <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">'x'</span><span class="token punctuation">:</span> <span class="token string">'A'</span><span class="token punctuation">,</span> <span class="token string">'y'</span><span class="token punctuation">:</span> <span class="token string">'B'</span><span class="token punctuation">,</span> <span class="token string">'z'</span><span class="token punctuation">:</span> <span class="token string">'C'</span> <span class="token punctuation">&#125;</span>
<span class="token operator">>></span><span class="token operator">></span> <span class="token punctuation">[</span>k <span class="token operator">+</span> <span class="token string">'='</span> <span class="token operator">+</span> v <span class="token keyword">for</span> k<span class="token punctuation">,</span> v <span class="token keyword">in</span> d<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token string">'y=B'</span><span class="token punctuation">,</span> <span class="token string">'x=A'</span><span class="token punctuation">,</span> <span class="token string">'z=C'</span><span class="token punctuation">]</span>
<span class="token comment"># 把list中所有的字符串变为小写</span>
<span class="token operator">>></span><span class="token operator">></span> L <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'Hello'</span><span class="token punctuation">,</span> <span class="token string">'World'</span><span class="token punctuation">,</span> <span class="token string">'IBM'</span><span class="token punctuation">,</span> <span class="token string">'Apple'</span><span class="token punctuation">]</span>
<span class="token operator">>></span><span class="token operator">></span> <span class="token punctuation">[</span>s<span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">for</span> s <span class="token keyword">in</span> L<span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token string">'hello'</span><span class="token punctuation">,</span> <span class="token string">'world'</span><span class="token punctuation">,</span> <span class="token string">'ibm'</span><span class="token punctuation">,</span> <span class="token string">'apple'</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h5 id="生成器（generator）"><a href="#生成器（generator）" class="headerlink" title="生成器（generator）"></a>生成器（generator）</h5><p>一边循环一边计算的机制</p>
<p>创建生成器：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># 创建list</span>
<span class="token operator">>></span><span class="token operator">></span> L <span class="token operator">=</span> <span class="token punctuation">[</span>x <span class="token operator">*</span> x <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token operator">>></span><span class="token operator">></span> L
<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">,</span> <span class="token number">36</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">81</span><span class="token punctuation">]</span>
<span class="token comment"># 创建generator</span>
<span class="token operator">>></span><span class="token operator">></span> g <span class="token operator">=</span> <span class="token punctuation">(</span>x <span class="token operator">*</span> x <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span> g
<span class="token operator">&lt;</span>generator <span class="token builtin">object</span> <span class="token operator">&lt;</span>genexpr<span class="token operator">></span> at <span class="token number">0x1022ef630</span><span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>通过<code>next()</code>函数获得generator的下一个返回值，或者使用<code>for</code>循环打印</p>
<p>如果一个函数定义中包含<code>yield</code>关键字，则该函数是一个<code>generator</code></p>
<h6 id="generator与函数的区别："><a href="#generator与函数的区别：" class="headerlink" title="generator与函数的区别："></a><code>generator</code>与函数的区别：</h6><p>函数是顺序执行，遇到<code>return</code>语句或者最后一行函数语句就返回。而变成generator的函数，在每次调用<code>next()</code>的时候执行，遇到<code>yield</code>语句返回，再次执行时从上次返回的<code>yield</code>语句处继续执行。</p>
<p>使用<code>for</code>循环调用generator时，发现拿不到generator的<code>return</code>语句的返回值。如果想要拿到返回值，必须捕获<code>StopIteration</code>错误，返回值包含在<code>StopIteration</code>的<code>value</code>中</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># 定义斐波那契generator</span>
<span class="token keyword">def</span> <span class="token function">fib</span><span class="token punctuation">(</span><span class="token builtin">max</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    n<span class="token punctuation">,</span> a<span class="token punctuation">,</span> b <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span>
    <span class="token keyword">while</span> n <span class="token operator">&lt;</span> <span class="token builtin">max</span><span class="token punctuation">:</span>
        <span class="token keyword">yield</span> b
        a<span class="token punctuation">,</span> b <span class="token operator">=</span> b<span class="token punctuation">,</span> a <span class="token operator">+</span> b
        n <span class="token operator">=</span> n <span class="token operator">+</span> <span class="token number">1</span>
    <span class="token keyword">return</span> <span class="token string">'done'</span>
g <span class="token operator">=</span> fib<span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span>
<span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        x <span class="token operator">=</span> <span class="token builtin">next</span><span class="token punctuation">(</span>g<span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'g:'</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span>
    <span class="token keyword">except</span> StopIteration <span class="token keyword">as</span> e<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Generator return value:'</span><span class="token punctuation">,</span> e<span class="token punctuation">.</span>value<span class="token punctuation">)</span>
        <span class="token keyword">break</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h5 id="迭代器（Iterator）"><a href="#迭代器（Iterator）" class="headerlink" title="迭代器（Iterator）"></a>迭代器（Iterator）</h5><p>可以被<code>next()</code>函数调用并不断返回下一个值的对象称为迭代器，<code>Iterator</code>的计算是惰性的，只有在需要返回下一个数据时它才会计算，不能提前知道序列的长度。</p>
<p>把<code>Iterable</code>变成<code>Iterator</code>可以使用<code>iter()</code>函数</p>
<h6 id="Iterable与Iterator的区别："><a href="#Iterable与Iterator的区别：" class="headerlink" title="Iterable与Iterator的区别："></a><code>Iterable</code>与<code>Iterator</code>的区别：</h6><p>凡是可作用于<code>for</code>循环的对象都是<code>Iterable</code>类型；</p>
<p>凡是可作用于<code>next()</code>函数的对象都是<code>Iterator</code>类型，它们表示一个惰性计算的序列；</p>
<p>集合数据类型如<code>list</code>、<code>dict</code>、<code>str</code>等是<code>Iterable</code>但不是<code>Iterator</code>，不过可以通过<code>iter()</code>函数获得一个<code>Iterator</code>对象。</p>
<h4 id="函数式编程"><a href="#函数式编程" class="headerlink" title="函数式编程"></a>函数式编程</h4><h5 id="高阶函数"><a href="#高阶函数" class="headerlink" title="高阶函数"></a>高阶函数</h5><p>变量可以指向函数</p>
<p>函数也可以作为参数</p>
<h6 id="map-function，-iterable-函数"><a href="#map-function，-iterable-函数" class="headerlink" title="map(function， iterable)函数"></a>map(function， iterable)函数</h6><p><code>map</code>将传入的函数依次作用到序列的每个元素，并把结果作为新的<code>Iterator</code>返回。</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">def</span> <span class="token function">f</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     <span class="token keyword">return</span> x <span class="token operator">*</span> x
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token operator">>></span><span class="token operator">></span> r <span class="token operator">=</span> <span class="token builtin">map</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment"># 返回结果是Iterator</span>
<span class="token operator">>></span><span class="token operator">></span> <span class="token builtin">list</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span> <span class="token comment"># list()函数把整个序列都计算出来并返回一个list</span>
<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">,</span> <span class="token number">36</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">81</span><span class="token punctuation">]</span>
<span class="token comment"># 简化</span>
<span class="token operator">>></span><span class="token operator">></span> <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">map</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h6 id="reduce-function-iterable-函数"><a href="#reduce-function-iterable-函数" class="headerlink" title="reduce(function, iterable)函数"></a>reduce(function, iterable)函数</h6><p><code>reduce</code>把一个函数作用在一个序列<code>[x1, x2, x3, ...]</code>上，将结果继续和序列的下一个元素做累积计算</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># 把序列变成整数</span>
<span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">from</span> functools <span class="token keyword">import</span> <span class="token builtin">reduce</span>
<span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">def</span> <span class="token function">fn</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     <span class="token keyword">return</span> x <span class="token operator">*</span> <span class="token number">10</span> <span class="token operator">+</span> y
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token operator">>></span><span class="token operator">></span> <span class="token builtin">reduce</span><span class="token punctuation">(</span>fn<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token number">13579</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><code>str</code>转换成正整数</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> functools <span class="token keyword">import</span> <span class="token builtin">reduce</span>

DIGITS <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">'0'</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">'1'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'2'</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'3'</span><span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">'4'</span><span class="token punctuation">:</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token string">'5'</span><span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token string">'6'</span><span class="token punctuation">:</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token string">'7'</span><span class="token punctuation">:</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token string">'8'</span><span class="token punctuation">:</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token string">'9'</span><span class="token punctuation">:</span> <span class="token number">9</span><span class="token punctuation">&#125;</span>

<span class="token keyword">def</span> <span class="token function">str2int</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">fn</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> x <span class="token operator">*</span> <span class="token number">10</span> <span class="token operator">+</span> y
    <span class="token keyword">def</span> <span class="token function">char2num</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> DIGITS<span class="token punctuation">[</span>s<span class="token punctuation">]</span>
    <span class="token keyword">return</span> <span class="token builtin">reduce</span><span class="token punctuation">(</span>fn<span class="token punctuation">,</span> <span class="token builtin">map</span><span class="token punctuation">(</span>char2num<span class="token punctuation">,</span> s<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># lambda函数进一步简化</span>
<span class="token keyword">from</span> functools <span class="token keyword">import</span> <span class="token builtin">reduce</span>

DIGITS <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">'0'</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">'1'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'2'</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'3'</span><span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">'4'</span><span class="token punctuation">:</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token string">'5'</span><span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token string">'6'</span><span class="token punctuation">:</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token string">'7'</span><span class="token punctuation">:</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token string">'8'</span><span class="token punctuation">:</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token string">'9'</span><span class="token punctuation">:</span> <span class="token number">9</span><span class="token punctuation">&#125;</span>

<span class="token keyword">def</span> <span class="token function">char2num</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> DIGITS<span class="token punctuation">[</span>s<span class="token punctuation">]</span>

<span class="token keyword">def</span> <span class="token function">str2int</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token builtin">reduce</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">,</span> y<span class="token punctuation">:</span> x <span class="token operator">*</span> <span class="token number">10</span> <span class="token operator">+</span> y<span class="token punctuation">,</span> <span class="token builtin">map</span><span class="token punctuation">(</span>char2num<span class="token punctuation">,</span> s<span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h6 id="filter-function-iterable-函数"><a href="#filter-function-iterable-函数" class="headerlink" title="filter(function, iterable)函数"></a>filter(function, iterable)函数</h6><p>用<code>filter</code>求素数</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">_odd_iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    n <span class="token operator">=</span> <span class="token number">1</span>
    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
        n <span class="token operator">=</span> n <span class="token operator">+</span> <span class="token number">2</span>
        <span class="token keyword">yield</span> n
<span class="token keyword">def</span> <span class="token function">_not_divisible</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token keyword">lambda</span> x<span class="token punctuation">:</span> x <span class="token operator">%</span> n <span class="token operator">></span> <span class="token number">0</span>
<span class="token keyword">def</span> <span class="token function">primes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">yield</span> <span class="token number">2</span>
    it <span class="token operator">=</span> _odd_iter<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 初始序列</span>
    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
        n <span class="token operator">=</span> <span class="token builtin">next</span><span class="token punctuation">(</span>it<span class="token punctuation">)</span> <span class="token comment"># 返回序列的第一个数</span>
        <span class="token keyword">yield</span> n
        it <span class="token operator">=</span> <span class="token builtin">filter</span><span class="token punctuation">(</span>_not_divisible<span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">,</span> it<span class="token punctuation">)</span> <span class="token comment"># 构造新序列</span>
        
<span class="token comment"># 打印1000以内的素数:</span>
<span class="token keyword">for</span> n <span class="token keyword">in</span> primes<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> n <span class="token operator">&lt;</span> <span class="token number">1000</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">break</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h6 id="sorted-函数"><a href="#sorted-函数" class="headerlink" title="sorted()函数"></a>sorted()函数</h6><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># 对list进行排序</span>
<span class="token operator">>></span><span class="token operator">></span> <span class="token builtin">sorted</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">36</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">21</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">21</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">36</span><span class="token punctuation">]</span>
<span class="token comment"># 接收一个key函数来实现自定义的排序</span>
<span class="token comment"># 按绝对值大小排序</span>
<span class="token operator">>></span><span class="token operator">></span> <span class="token builtin">sorted</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">36</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">21</span><span class="token punctuation">]</span><span class="token punctuation">,</span> key<span class="token operator">=</span><span class="token builtin">abs</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">12</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">21</span><span class="token punctuation">,</span> <span class="token number">36</span><span class="token punctuation">]</span>
<span class="token comment"># 忽略大小写排序</span>
<span class="token operator">>></span><span class="token operator">></span> <span class="token builtin">sorted</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'bob'</span><span class="token punctuation">,</span> <span class="token string">'about'</span><span class="token punctuation">,</span> <span class="token string">'Zoo'</span><span class="token punctuation">,</span> <span class="token string">'Credit'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> key<span class="token operator">=</span><span class="token builtin">str</span><span class="token punctuation">.</span>lower<span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token string">'about'</span><span class="token punctuation">,</span> <span class="token string">'bob'</span><span class="token punctuation">,</span> <span class="token string">'Credit'</span><span class="token punctuation">,</span> <span class="token string">'Zoo'</span><span class="token punctuation">]</span>
<span class="token comment"># 反向排序</span>
<span class="token operator">>></span><span class="token operator">></span> <span class="token builtin">sorted</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'bob'</span><span class="token punctuation">,</span> <span class="token string">'about'</span><span class="token punctuation">,</span> <span class="token string">'Zoo'</span><span class="token punctuation">,</span> <span class="token string">'Credit'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> key<span class="token operator">=</span><span class="token builtin">str</span><span class="token punctuation">.</span>lower<span class="token punctuation">,</span> reverse<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token string">'Zoo'</span><span class="token punctuation">,</span> <span class="token string">'Credit'</span><span class="token punctuation">,</span> <span class="token string">'bob'</span><span class="token punctuation">,</span> <span class="token string">'about'</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h5 id="返回函数"><a href="#返回函数" class="headerlink" title="返回函数"></a>返回函数</h5><p>函数作为返回值（闭包：参数和变量都保存在返回的函数中）</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">lazy_sum</span><span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        ax <span class="token operator">=</span> <span class="token number">0</span>
        <span class="token keyword">for</span> n <span class="token keyword">in</span> args<span class="token punctuation">:</span>
            ax <span class="token operator">=</span> ax <span class="token operator">+</span> n
        <span class="token keyword">return</span> ax
    <span class="token keyword">return</span> <span class="token builtin">sum</span>
f <span class="token operator">=</span> lazy_sum<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">)</span>
f<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 25， 返回计算求和的结果</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h6 id="闭包"><a href="#闭包" class="headerlink" title="闭包"></a>闭包</h6><p>当一个函数返回了一个函数后，其内部的局部变量还被新函数引用</p>
<p>注意：返回函数不要引用任何循环变量，或者后续会发生变化的变量。</p>
<p>解决方案：</p>
<p>如果一定要引用循环变量，方法是再创建一个函数，用该函数的参数绑定循环变量当前的值，无论该循环变量后续如何更改，已绑定到函数参数的值不变</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">f</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">def</span> <span class="token function">g</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> j<span class="token operator">*</span>j
        <span class="token keyword">return</span> g
    fs <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        fs<span class="token punctuation">.</span>append<span class="token punctuation">(</span>f<span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># f(i)立刻被执行，因此i的当前值被传入f()</span>
    <span class="token keyword">return</span> fs
<span class="token comment"># 结果</span>
<span class="token operator">>></span><span class="token operator">></span> f1<span class="token punctuation">,</span> f2<span class="token punctuation">,</span> f3 <span class="token operator">=</span> count<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span> f1<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token number">1</span>
<span class="token operator">>></span><span class="token operator">></span> f2<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token number">4</span>
<span class="token operator">>></span><span class="token operator">></span> f3<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token number">9</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h5 id="匿名函数（lambda）"><a href="#匿名函数（lambda）" class="headerlink" title="匿名函数（lambda）"></a>匿名函数（lambda）</h5><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">map</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> x <span class="token operator">*</span> x<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>关键字<code>lambda</code>表示匿名函数，冒号前面的<code>x</code>表示函数参数。</p>
<p>匿名函数有个限制，就是只能有一个表达式，不用写<code>return</code>，返回值就是该表达式的结果。</p>
<h5 id="装饰器（Decorator）"><a href="#装饰器（Decorator）" class="headerlink" title="装饰器（Decorator）"></a>装饰器（Decorator）</h5><p>函数对象有一个<code>__name__</code>属性，可以拿到初始函数的名字</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># 打印日志的装饰器</span>
<span class="token keyword">def</span> <span class="token function">log</span><span class="token punctuation">(</span>func<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">wrapper</span><span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kw<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'call %s():'</span> <span class="token operator">%</span> func<span class="token punctuation">.</span>__name__<span class="token punctuation">)</span>
        <span class="token keyword">return</span> func<span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kw<span class="token punctuation">)</span>
    <span class="token keyword">return</span> wrapper
<span class="token comment"># 使用@语法，将@log放到now()函数的定义处，相当于执行了语句：now = log(now)</span>
<span class="token decorator annotation punctuation">@log</span>
<span class="token keyword">def</span> <span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'2015-3-25'</span><span class="token punctuation">)</span>
now<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># 结果</span>
<span class="token comment"># call now():</span>
<span class="token comment"># 2015-3-25</span>

<span class="token comment"># 自定义log文本</span>
<span class="token keyword">def</span> <span class="token function">log</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">decorator</span><span class="token punctuation">(</span>func<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">def</span> <span class="token function">wrapper</span><span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kw<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'%s %s():'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>text<span class="token punctuation">,</span> func<span class="token punctuation">.</span>__name__<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> func<span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kw<span class="token punctuation">)</span>
         <span class="token keyword">return</span> wrapper
    <span class="token keyword">return</span> decorator
<span class="token comment"># 使用</span>
<span class="token decorator annotation punctuation">@log</span><span class="token punctuation">(</span><span class="token string">'execute'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'2015-3-25'</span><span class="token punctuation">)</span>
<span class="token comment"># 结果</span>
<span class="token comment"># execute now():</span>
<span class="token comment"># 2015-3-25</span>

<span class="token comment"># 上述代码bug：now.__name__变为'wrapper'，因此依赖函数签名的代码执行会出现错误</span>
<span class="token keyword">import</span> functools

<span class="token keyword">def</span> <span class="token function">log</span><span class="token punctuation">(</span>func<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token decorator annotation punctuation">@functools<span class="token punctuation">.</span>wraps</span><span class="token punctuation">(</span>func<span class="token punctuation">)</span> <span class="token comment"># 把原始函数的属性复制到wrapper</span>
    <span class="token keyword">def</span> <span class="token function">wrapper</span><span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kw<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'call %s():'</span> <span class="token operator">%</span> func<span class="token punctuation">.</span>__name__<span class="token punctuation">)</span>
        <span class="token keyword">return</span> func<span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kw<span class="token punctuation">)</span>
    <span class="token keyword">return</span> wrapper
<span class="token keyword">def</span> <span class="token function">log</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">decorator</span><span class="token punctuation">(</span>func<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token decorator annotation punctuation">@functools<span class="token punctuation">.</span>wraps</span><span class="token punctuation">(</span>func<span class="token punctuation">)</span>
        <span class="token keyword">def</span> <span class="token function">wrapper</span><span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kw<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'%s %s():'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>text<span class="token punctuation">,</span> func<span class="token punctuation">.</span>__name__<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> func<span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kw<span class="token punctuation">)</span>
        <span class="token keyword">return</span> wrapper
    <span class="token keyword">return</span> decorator<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>由于<code>log()</code>是一个decorator，返回一个函数，所以，原来的<code>now()</code>函数仍然存在，只是现在同名的<code>now</code>变量指向了新的函数，于是调用<code>now()</code>将执行新函数，即在<code>log()</code>函数中返回的<code>wrapper()</code>函数。</p>
<h5 id="偏函数（Partial-function）"><a href="#偏函数（Partial-function）" class="headerlink" title="偏函数（Partial function）"></a>偏函数（Partial function）</h5><p><code>functools.partial</code>就是帮助我们创建一个偏函数的，作用就是，把一个函数的某些参数给固定住（也就是设置默认值），返回一个新的函数，调用这个新函数会更简单。</p>
<p>创建偏函数时，可以接受函数对象、<code>*args</code>和<code>**kw</code>这三个参数</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># 不使用functools.partial，定义int2</span>
<span class="token keyword">def</span> <span class="token function">int2</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> base<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token builtin">int</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> base<span class="token punctuation">)</span>

<span class="token comment"># 使用functools.partial</span>
<span class="token keyword">import</span> functools
int2 <span class="token operator">=</span> functools<span class="token punctuation">.</span>partial<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">,</span> base <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token comment"># 固定了int()函数的关键字参数base，相当于kw=&#123;'base': 2&#125;</span>

max2 <span class="token operator">=</span> functools<span class="token punctuation">.</span>partial<span class="token punctuation">(</span><span class="token builtin">max</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token comment"># 会把10作为*args的一部分自动加到左边，可变参数</span>
max2<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span> <span class="token comment"># 相当于args = (10,5,6,7);max(*args)</span>
<span class="token comment"># 结果 10</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h5 id="模块"><a href="#模块" class="headerlink" title="模块"></a>模块</h5><p>模块名避免冲突，命名包名。每个包目录下都会有一个<code>__init__.py</code>的文件，这个文件是必须存在的，否则，Python就把这个目录当成普通目录，而不是一个包。<code>__init__.py</code>可以是空文件，也可以有Python代码，因为<code>__init__.py</code>本身就是一个模块，而它的模块名就是<code>mycompany</code>。</p>
<p>注意：不能和Python自带的模块名称冲突</p>
<p><code>hello.py</code>:</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment">#!/usr/bin/env python3</span>
<span class="token comment"># -*- coding: utf-8 -*-</span>

<span class="token string">' a test module '</span> <span class="token comment"># 表示模块的文档注释，任何模块代码的第一个字符串都被视为模块的文档注释；</span>

__author__ <span class="token operator">=</span> <span class="token string">'Michael Liao'</span> <span class="token comment"># 作者名</span>

<span class="token keyword">import</span> sys

<span class="token keyword">def</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># argv变量，用list存储了命令行的所有参数。argv至少有一个元素，因为第一个参数永远是该.py文件的名称</span>
    args <span class="token operator">=</span> sys<span class="token punctuation">.</span>argv 
    <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token operator">==</span><span class="token number">1</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Hello, world!'</span><span class="token punctuation">)</span>
    <span class="token keyword">elif</span> <span class="token builtin">len</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token operator">==</span><span class="token number">2</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Hello, %s!'</span> <span class="token operator">%</span> args<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Too many arguments!'</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__<span class="token operator">==</span><span class="token string">'__main__'</span><span class="token punctuation">:</span>
    test<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>当我们在命令行运行<code>hello</code>模块文件时，Python解释器把一个特殊变量<code>__name__</code>置为<code>__main__</code>，而如果在其他地方导入该<code>hello</code>模块时，<code>if</code>判断将失败，因此，这种<code>if</code>测试可以让一个模块通过命令行运行时执行一些额外的代码，最常见的就是运行测试。</p>
<p>公有变量(public)：<code>a</code>、<code>b</code></p>
<p>私有变量(private)：<code>_c</code>、<code>__d</code>（单下划线开头的变量，能够被直接引用，但是不建议直接使用，python没有机制阻止使用私有变量）</p>
<p>特殊变量：<code>__xxx__</code>，可以直接被引用，但是有特殊用途</p>
<h6 id="模块搜索路径"><a href="#模块搜索路径" class="headerlink" title="模块搜索路径"></a>模块搜索路径</h6><p>默认情况下，Python解释器会搜索当前目录、所有已安装的内置模块和第三方模块，搜索路径存放在<code>sys</code>模块的<code>path</code>变量中：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">import</span> sys
<span class="token operator">>></span><span class="token operator">></span> sys<span class="token punctuation">.</span>path
<span class="token punctuation">[</span><span class="token string">''</span><span class="token punctuation">,</span> <span class="token string">'/Library/Frameworks/Python.framework/Versions/3.6/lib/python36.zip'</span><span class="token punctuation">,</span> <span class="token string">'/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6'</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token string">'/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/site-packages'</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>如果我们要添加自己的搜索目录，有两种方法：</p>
<p>一是直接修改<code>sys.path</code>，添加要搜索的目录：</p>
<pre class="line-numbers language-none"><code class="language-none">&gt;&gt;&gt; import sys
&gt;&gt;&gt; sys.path.append(&#39;&#x2F;Users&#x2F;michael&#x2F;my_py_scripts&#39;)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>这种方法是在运行时修改，运行结束后失效。</p>
<p>第二种方法是设置环境变量<code>PYTHONPATH</code>，该环境变量的内容会被自动添加到模块搜索路径中。设置方式与设置Path环境变量类似。注意只需要添加你自己的搜索路径，Python自己本身的搜索路径不受影响。</p>
<h4 id="面向对象编程"><a href="#面向对象编程" class="headerlink" title="面向对象编程"></a>面向对象编程</h4><h5 id="类和实例"><a href="#类和实例" class="headerlink" title="类和实例"></a>类和实例</h5><p>创建类</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">ClassName</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token comment"># object表示从哪个类继承的，通常，如果没有合适的继承类，就使用object类，这是所有类最终都会继承的类</span>
    <span class="token keyword">pass</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>创建实例，通过<code>__init__</code>方法，在创建实例的时候，把属性绑上去</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>

    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">,</span> score<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>name <span class="token operator">=</span> name
        self<span class="token punctuation">.</span>score <span class="token operator">=</span> score
        
<span class="token comment"># 使用</span>
bart <span class="token operator">=</span> Student<span class="token punctuation">(</span><span class="token string">'Bart Simpson'</span><span class="token punctuation">,</span> <span class="token number">59</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><code>__init__</code>方法的第一个参数永远是<code>self</code>，表示创建的实例本身，因此，在<code>__init__</code>方法内部，就可以把各种属性绑定到<code>self</code>，因为<code>self</code>就指向创建的实例本身。</p>
<h5 id="访问限制"><a href="#访问限制" class="headerlink" title="访问限制"></a>访问限制</h5><p>两个下划线<code>__</code>开头定义的变量，就会编程私有变量，只有内部可以访问</p>
<p>以双下划线开头和双下划线结尾的是特殊变量，特殊变量是可以直接访问的。</p>
<p>要写getter和setter方法去控制对象属性的获取和设置。</p>
<h5 id="继承和多态"><a href="#继承和多态" class="headerlink" title="继承和多态"></a>继承和多态</h5><p>继承，使用<code>class className(extendClass)</code>，被继承的class称为基类、父类或超类。</p>
<p>动态语言的“鸭子类型”，它并不要求严格的继承体系。动态语言的鸭子类型特点决定了继承不像静态语言那样是必须的。</p>
<p>Python的“file-like object“就是一种鸭子类型。对真正的文件对象，它有一个<code>read()</code>方法，返回其内容。但是，许多对象，只要有<code>read()</code>方法，都被视为“file-like object“。许多函数接收的参数就是“file-like object“，你不一定要传入真正的文件对象，完全可以传入任何实现了<code>read()</code>方法的对象。</p>
<h6 id="多重继承（MixIn）"><a href="#多重继承（MixIn）" class="headerlink" title="多重继承（MixIn）"></a>多重继承（MixIn）</h6><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">Bat</span><span class="token punctuation">(</span>Mammal<span class="token punctuation">,</span> Flyable<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">pass</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<h5 id="获取对象信息"><a href="#获取对象信息" class="headerlink" title="获取对象信息"></a>获取对象信息</h5><h6 id="type"><a href="#type" class="headerlink" title="type()"></a>type()</h6><p>判断对象类型：<code>type()</code>，返回对应的对象类型</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> <span class="token builtin">type</span><span class="token punctuation">(</span><span class="token number">123</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token builtin">type</span><span class="token punctuation">(</span><span class="token number">456</span><span class="token punctuation">)</span>
<span class="token boolean">True</span>
<span class="token operator">>></span><span class="token operator">></span> <span class="token builtin">type</span><span class="token punctuation">(</span><span class="token number">123</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token builtin">int</span>
<span class="token boolean">True</span>
<span class="token operator">>></span><span class="token operator">></span> <span class="token builtin">type</span><span class="token punctuation">(</span><span class="token string">'abc'</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token builtin">type</span><span class="token punctuation">(</span><span class="token string">'123'</span><span class="token punctuation">)</span>
<span class="token boolean">True</span>
<span class="token operator">>></span><span class="token operator">></span> <span class="token builtin">type</span><span class="token punctuation">(</span><span class="token string">'abc'</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token builtin">str</span>
<span class="token boolean">True</span>
<span class="token operator">>></span><span class="token operator">></span> <span class="token builtin">type</span><span class="token punctuation">(</span><span class="token string">'abc'</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token builtin">type</span><span class="token punctuation">(</span><span class="token number">123</span><span class="token punctuation">)</span>
<span class="token boolean">False</span>
<span class="token comment"># 判断一个对象是否是函数</span>
<span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">import</span> types
<span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">def</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     <span class="token keyword">pass</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token operator">>></span><span class="token operator">></span> <span class="token builtin">type</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span><span class="token operator">==</span>types<span class="token punctuation">.</span>FunctionType
<span class="token boolean">True</span>
<span class="token operator">>></span><span class="token operator">></span> <span class="token builtin">type</span><span class="token punctuation">(</span><span class="token builtin">abs</span><span class="token punctuation">)</span><span class="token operator">==</span>types<span class="token punctuation">.</span>BuiltinFunctionType
<span class="token boolean">True</span>
<span class="token operator">>></span><span class="token operator">></span> <span class="token builtin">type</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> x<span class="token punctuation">)</span><span class="token operator">==</span>types<span class="token punctuation">.</span>LambdaType
<span class="token boolean">True</span>
<span class="token operator">>></span><span class="token operator">></span> <span class="token builtin">type</span><span class="token punctuation">(</span><span class="token punctuation">(</span>x <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">==</span>types<span class="token punctuation">.</span>GeneratorType
<span class="token boolean">True</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h6 id="isinstance"><a href="#isinstance" class="headerlink" title="isinstance()"></a>isinstance()</h6><p>判断class类型，继承关系，也可以判断到父类和超类。</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>h<span class="token punctuation">,</span> Dog<span class="token punctuation">)</span>
<span class="token boolean">True</span>
<span class="token operator">>></span><span class="token operator">></span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>h<span class="token punctuation">,</span> Animal<span class="token punctuation">)</span> <span class="token comment"># Dog类继承与=于Animal类</span>
<span class="token boolean">True</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>常用判断多个类型</p>
<h6 id="dir"><a href="#dir" class="headerlink" title="dir()"></a>dir()</h6><p>获取一个对象的所有属性和方法，返回一个包含字符串的list</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> <span class="token builtin">dir</span><span class="token punctuation">(</span><span class="token string">'ABC'</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token string">'__add__'</span><span class="token punctuation">,</span> <span class="token string">'__class__'</span><span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token string">'__subclasshook__'</span><span class="token punctuation">,</span> <span class="token string">'capitalize'</span><span class="token punctuation">,</span> <span class="token string">'casefold'</span><span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token string">'zfill'</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>类似<code>__xxx__</code>的属性和方法在Python中都是有特殊用途的，比如<code>__len__</code>方法返回长度。在Python中，如果你调用<code>len()</code>函数试图获取一个对象的长度，实际上，在<code>len()</code>函数内部，它自动去调用该对象的<code>__len__()</code>方法，所以，下面的代码是等价的：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> <span class="token builtin">len</span><span class="token punctuation">(</span><span class="token string">'ABC'</span><span class="token punctuation">)</span>
<span class="token number">3</span>
<span class="token operator">>></span><span class="token operator">></span> <span class="token string">'ABC'</span><span class="token punctuation">.</span>__len__<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token number">3</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>自定义的类，如果想使用<code>len()</code>方法，需要自己写一个<code>__len__()</code>方法</p>
<p>配合<code>getattr()</code>、<code>setattr()</code>以及<code>hasattr()</code>，我们可以直接操作一个对象的状态：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">class</span> <span class="token class-name">MyObject</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>         self<span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token number">9</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     <span class="token keyword">def</span> <span class="token function">power</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>         <span class="token keyword">return</span> self<span class="token punctuation">.</span>x <span class="token operator">*</span> self<span class="token punctuation">.</span>x
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token operator">>></span><span class="token operator">></span> obj <span class="token operator">=</span> MyObject<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>测试该对象的属性：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> <span class="token builtin">hasattr</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token string">'x'</span><span class="token punctuation">)</span> <span class="token comment"># 有属性'x'吗？</span>
<span class="token boolean">True</span>
<span class="token operator">>></span><span class="token operator">></span> obj<span class="token punctuation">.</span>x
<span class="token number">9</span>
<span class="token operator">>></span><span class="token operator">></span> <span class="token builtin">hasattr</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token string">'y'</span><span class="token punctuation">)</span> <span class="token comment"># 有属性'y'吗？</span>
<span class="token boolean">False</span>
<span class="token operator">>></span><span class="token operator">></span> <span class="token builtin">setattr</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token string">'y'</span><span class="token punctuation">,</span> <span class="token number">19</span><span class="token punctuation">)</span> <span class="token comment"># 设置一个属性'y'</span>
<span class="token operator">>></span><span class="token operator">></span> <span class="token builtin">hasattr</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token string">'y'</span><span class="token punctuation">)</span> <span class="token comment"># 有属性'y'吗？</span>
<span class="token boolean">True</span>
<span class="token operator">>></span><span class="token operator">></span> <span class="token builtin">getattr</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token string">'y'</span><span class="token punctuation">)</span> <span class="token comment"># 获取属性'y'</span>
<span class="token number">19</span>
<span class="token operator">>></span><span class="token operator">></span> obj<span class="token punctuation">.</span>y <span class="token comment"># 获取属性'y'</span>
<span class="token number">19</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>获取不存在的属性，会抛出<code>AttributeError</code>的错误</p>
<p>获取对象的方法：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> <span class="token builtin">hasattr</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token string">'power'</span><span class="token punctuation">)</span> <span class="token comment"># 有属性'power'吗？</span>
<span class="token boolean">True</span>
<span class="token operator">>></span><span class="token operator">></span> <span class="token builtin">getattr</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token string">'power'</span><span class="token punctuation">)</span> <span class="token comment"># 获取属性'power'</span>
<span class="token operator">&lt;</span>bound method MyObject<span class="token punctuation">.</span>power of <span class="token operator">&lt;</span>__main__<span class="token punctuation">.</span>MyObject <span class="token builtin">object</span> at <span class="token number">0x10077a6a0</span><span class="token operator">>></span>
<span class="token operator">>></span><span class="token operator">></span> fn <span class="token operator">=</span> <span class="token builtin">getattr</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token string">'power'</span><span class="token punctuation">)</span> <span class="token comment"># 获取属性'power'并赋值到变量fn</span>
<span class="token operator">>></span><span class="token operator">></span> fn <span class="token comment"># fn指向obj.power</span>
<span class="token operator">&lt;</span>bound method MyObject<span class="token punctuation">.</span>power of <span class="token operator">&lt;</span>__main__<span class="token punctuation">.</span>MyObject <span class="token builtin">object</span> at <span class="token number">0x10077a6a0</span><span class="token operator">>></span>
<span class="token operator">>></span><span class="token operator">></span> fn<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 调用fn()与调用obj.power()是一样的</span>
<span class="token number">81</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h5 id="实例属性和类属性"><a href="#实例属性和类属性" class="headerlink" title="实例属性和类属性"></a>实例属性和类属性</h5><p>由于Python是动态语言，根据类创建的实例可以任意绑定属性。</p>
<h5 id="使用-slots"><a href="#使用-slots" class="headerlink" title="使用__slots__"></a>使用<code>__slots__</code></h5><p>限制class实例能添加的属性</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># 定义</span>
<span class="token keyword">class</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    __slots__ <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">,</span> <span class="token string">'age'</span><span class="token punctuation">)</span> <span class="token comment"># 用tuple定义允许绑定的属性名称</span>
    
<span class="token comment"># 使用</span>
<span class="token operator">>></span><span class="token operator">></span> s <span class="token operator">=</span> Student<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 创建新的实例</span>
<span class="token operator">>></span><span class="token operator">></span> s<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'Michael'</span> <span class="token comment"># 绑定属性'name'</span>
<span class="token operator">>></span><span class="token operator">></span> s<span class="token punctuation">.</span>age <span class="token operator">=</span> <span class="token number">25</span> <span class="token comment"># 绑定属性'age'</span>
<span class="token operator">>></span><span class="token operator">></span> s<span class="token punctuation">.</span>score <span class="token operator">=</span> <span class="token number">99</span> <span class="token comment"># 绑定属性'score'</span>
Traceback <span class="token punctuation">(</span>most recent call last<span class="token punctuation">)</span><span class="token punctuation">:</span>
  File <span class="token string">"&lt;stdin>"</span><span class="token punctuation">,</span> line <span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword">in</span> <span class="token operator">&lt;</span>module<span class="token operator">></span>
AttributeError<span class="token punctuation">:</span> <span class="token string">'Student'</span> <span class="token builtin">object</span> has no attribute <span class="token string">'score'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>注意： <code>__slots__</code>定义的属性仅对当前类实例起作用，对继承的子类是不起作用的，除非在子类中也定义<code>__slots__</code>，这样，子类实例允许定义的属性就是自身的<code>__slots__</code>加上父类的<code>__slots__</code>。</p>
<h5 id="property"><a href="#property" class="headerlink" title="@property"></a>@property</h5><p>把一个方法变成属性调用。</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># 定义</span>
<span class="token keyword">class</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>

    <span class="token decorator annotation punctuation">@property</span>
    <span class="token keyword">def</span> <span class="token function">score</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>_score

    <span class="token decorator annotation punctuation">@score<span class="token punctuation">.</span>setter</span>
    <span class="token keyword">def</span> <span class="token function">score</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span><span class="token string">'score must be an integer!'</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> value <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token keyword">or</span> value <span class="token operator">></span> <span class="token number">100</span><span class="token punctuation">:</span>
            <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span><span class="token string">'score must between 0 ~ 100!'</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>_score <span class="token operator">=</span> value
        
<span class="token comment"># 使用</span>
<span class="token operator">>></span><span class="token operator">></span> s <span class="token operator">=</span> Student<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span> s<span class="token punctuation">.</span>score <span class="token operator">=</span> <span class="token number">60</span> <span class="token comment"># OK，实际转化为s.set_score(60)</span>
<span class="token operator">>></span><span class="token operator">></span> s<span class="token punctuation">.</span>score <span class="token comment"># OK，实际转化为s.get_score()</span>
<span class="token number">60</span>
<span class="token operator">>></span><span class="token operator">></span> s<span class="token punctuation">.</span>score <span class="token operator">=</span> <span class="token number">9999</span>
Traceback <span class="token punctuation">(</span>most recent call last<span class="token punctuation">)</span><span class="token punctuation">:</span>
  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
ValueError<span class="token punctuation">:</span> score must between <span class="token number">0</span> <span class="token operator">~</span> <span class="token number">100</span>!<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>把一个getter方法变成属性，只需要加上<code>@property</code>就可以了，此时，<code>@property</code>本身又创建了另一个装饰器<code>@score.setter</code>，负责把一个setter方法变成属性赋值。</p>
<h5 id="定制类"><a href="#定制类" class="headerlink" title="定制类"></a>定制类</h5><h6 id="str"><a href="#str" class="headerlink" title="__str__()"></a><code>__str__()</code></h6><p>返回用户看到的字符串</p>
<h6 id="repr"><a href="#repr" class="headerlink" title="__repr__()"></a><code>__repr__()</code></h6><p>返回开发者看到的字符串，为调试服务的</p>
<h6 id="iter"><a href="#iter" class="headerlink" title="__iter__()"></a><code>__iter__()</code></h6><p>如果一个类想被用于<code>for ... in</code>循环，就必须实现一个<code>__iter__()</code>方法，该方法返回一个迭代对象，然后，Python的for循环就会不断调用该迭代对象的<code>__next__()</code>方法拿到循环的下一个值，直到遇到<code>StopIteration</code>错误时退出循环。</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">Fib</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>a<span class="token punctuation">,</span> self<span class="token punctuation">.</span>b <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span> <span class="token comment"># 初始化两个计数器a，b</span>

    <span class="token keyword">def</span> <span class="token function">__iter__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self <span class="token comment"># 实例本身就是迭代对象，故返回自己</span>

    <span class="token keyword">def</span> <span class="token function">__next__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>a<span class="token punctuation">,</span> self<span class="token punctuation">.</span>b <span class="token operator">=</span> self<span class="token punctuation">.</span>b<span class="token punctuation">,</span> self<span class="token punctuation">.</span>a <span class="token operator">+</span> self<span class="token punctuation">.</span>b <span class="token comment"># 计算下一个值</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>a <span class="token operator">></span> <span class="token number">100000</span><span class="token punctuation">:</span> <span class="token comment"># 退出循环的条件</span>
            <span class="token keyword">raise</span> StopIteration<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>a <span class="token comment"># 返回下一个值</span>
    
<span class="token comment"># 使用</span>
<span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">for</span> n <span class="token keyword">in</span> Fib<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     <span class="token keyword">print</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token number">1</span>
<span class="token number">1</span>
<span class="token number">2</span>
<span class="token number">3</span>
<span class="token number">5</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token number">46368</span>
<span class="token number">75025</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h6 id="getitem"><a href="#getitem" class="headerlink" title="__getitem__()"></a><code>__getitem__()</code></h6><p>可以像<code>list</code>那样按照下标取出元素</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">Fib</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__getitem__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">:</span>
        a<span class="token punctuation">,</span> b <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span>
        <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">:</span>
            a<span class="token punctuation">,</span> b <span class="token operator">=</span> b<span class="token punctuation">,</span> a <span class="token operator">+</span> b
        <span class="token keyword">return</span> a
    
<span class="token comment"># 使用</span>
<span class="token operator">>></span><span class="token operator">></span> f <span class="token operator">=</span> Fib<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span> f<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
<span class="token number">1</span>
<span class="token operator">>></span><span class="token operator">></span> f<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
<span class="token number">1</span>
<span class="token operator">>></span><span class="token operator">></span> f<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>
<span class="token number">2</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>切片功能需要做参数判断</p>
<pre class="line-numbers language-none"><code class="language-none"><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><code>__setitem__()</code>方法，把对象视作<code>list</code>或<code>dict</code>来对集合赋值,<code>__delitem__()</code>方法，用于删除某个元素。如果要使对象用起来像<code>Iterator</code>需要自定义多个<code>Iterator</code>的方法。</p>
<h6 id="getattr"><a href="#getattr" class="headerlink" title="__getattr__()"></a><code>__getattr__()</code></h6><p>动态返回一个属性，当调用的不存在的属性时，Python解释器会试图调用<code>__getattr__(self, &#39;attributeName&#39;)</code>来尝试获得属性。如果查找的属性不存在并且在<code>__getattr__</code>中没有设置，则会默认返回<code>None</code></p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>

    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'Michael'</span>

    <span class="token keyword">def</span> <span class="token function">__getattr__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> attr<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> attr<span class="token operator">==</span><span class="token string">'score'</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token number">99</span>
            
<span class="token comment"># 使用</span>
<span class="token operator">>></span><span class="token operator">></span> s <span class="token operator">=</span> Student<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span> s<span class="token punctuation">.</span>name
<span class="token string">'Michael'</span>
<span class="token operator">>></span><span class="token operator">></span> s<span class="token punctuation">.</span>score
<span class="token number">99</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>要让class只响应特定的几个属性，我们就要按照约定，抛出<code>AttributeError</code>的错误:</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>

    <span class="token keyword">def</span> <span class="token function">__getattr__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> attr<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> attr<span class="token operator">==</span><span class="token string">'age'</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token keyword">lambda</span><span class="token punctuation">:</span> <span class="token number">25</span>
        <span class="token keyword">raise</span> AttributeError<span class="token punctuation">(</span><span class="token string">'\'Student\' object has no attribute \'%s\''</span> <span class="token operator">%</span> attr<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>这实际上可以把一个类的所有属性和方法调用全部动态化处理了，不需要任何特殊手段。</p>
<p>使用场景：例如动态设置url调用SDK的API</p>
<h6 id="call"><a href="#call" class="headerlink" title="__call__()"></a><code>__call__()</code></h6><p>直接对实例进行调用。判断一个对象是否能被调用，能被调用的对象就是一个<code>Callable</code>对象。</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>name <span class="token operator">=</span> name

    <span class="token keyword">def</span> <span class="token function">__call__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'My name is %s.'</span> <span class="token operator">%</span> self<span class="token punctuation">.</span>name<span class="token punctuation">)</span>
        
<span class="token comment"># 使用</span>
<span class="token operator">>></span><span class="token operator">></span> s <span class="token operator">=</span> Student<span class="token punctuation">(</span><span class="token string">'Michael'</span><span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span> s<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># self参数不要传入</span>
My name <span class="token keyword">is</span> Michael<span class="token punctuation">.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h5 id="枚举类"><a href="#枚举类" class="headerlink" title="枚举类"></a>枚举类</h5><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> enum <span class="token keyword">import</span> Enum

Month <span class="token operator">=</span> Enum<span class="token punctuation">(</span><span class="token string">'Month'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">'Jan'</span><span class="token punctuation">,</span> <span class="token string">'Feb'</span><span class="token punctuation">,</span> <span class="token string">'Mar'</span><span class="token punctuation">,</span> <span class="token string">'Apr'</span><span class="token punctuation">,</span> <span class="token string">'May'</span><span class="token punctuation">,</span> <span class="token string">'Jun'</span><span class="token punctuation">,</span> <span class="token string">'Jul'</span><span class="token punctuation">,</span> <span class="token string">'Aug'</span><span class="token punctuation">,</span> <span class="token string">'Sep'</span><span class="token punctuation">,</span> <span class="token string">'Oct'</span><span class="token punctuation">,</span> <span class="token string">'Nov'</span><span class="token punctuation">,</span> <span class="token string">'Dec'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># 使用</span>
<span class="token keyword">for</span> name<span class="token punctuation">,</span> member <span class="token keyword">in</span> Month<span class="token punctuation">.</span>__members__<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># value属性则是自动赋给成员的int常量，默认从1开始计数</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> <span class="token string">'=>'</span><span class="token punctuation">,</span> member<span class="token punctuation">,</span> <span class="token string">','</span><span class="token punctuation">,</span> member<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>如果需要更精确地控制枚举类型，可以从<code>Enum</code>派生出自定义类：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> enum <span class="token keyword">import</span> Enum<span class="token punctuation">,</span> unique

<span class="token decorator annotation punctuation">@unique</span> <span class="token comment"># 检查有没有重复值</span>
<span class="token keyword">class</span> <span class="token class-name">Weekday</span><span class="token punctuation">(</span>Enum<span class="token punctuation">)</span><span class="token punctuation">:</span>
    Sun <span class="token operator">=</span> <span class="token number">0</span> <span class="token comment"># Sun的value被设定为0</span>
    Mon <span class="token operator">=</span> <span class="token number">1</span>
    Tue <span class="token operator">=</span> <span class="token number">2</span>
    Wed <span class="token operator">=</span> <span class="token number">3</span>
    Thu <span class="token operator">=</span> <span class="token number">4</span>
    Fri <span class="token operator">=</span> <span class="token number">5</span>
    Sat <span class="token operator">=</span> <span class="token number">6</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h5 id="使用元类"><a href="#使用元类" class="headerlink" title="使用元类"></a>使用元类</h5><h6 id="type-1"><a href="#type-1" class="headerlink" title="type()"></a>type()</h6><p>可以查看一个类型或变量的类型。一个<code>class</code>的类型是<code>type</code>，一个实例的类型就是其相对应的<code>class</code></p>
<p>动态语言中，函数和类的定义是运行时动态创建的。python中创建<code>class</code>的方法就是使用<code>type()</code>函数。</p>
<p><code>type()</code>函数既可以返回一个对象的类型，又可以创建出新的类型。</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">def</span> <span class="token function">fn</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'world'</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token comment"># 先定义函数</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Hello, %s.'</span> <span class="token operator">%</span> name<span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token operator">>></span><span class="token operator">></span> Hello <span class="token operator">=</span> <span class="token builtin">type</span><span class="token punctuation">(</span><span class="token string">'Hello'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>hello<span class="token operator">=</span>fn<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># 创建Hello class</span>
<span class="token operator">>></span><span class="token operator">></span> h <span class="token operator">=</span> Hello<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span> h<span class="token punctuation">.</span>hello<span class="token punctuation">(</span><span class="token punctuation">)</span>
Hello<span class="token punctuation">,</span> world<span class="token punctuation">.</span>
<span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">(</span>Hello<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'type'</span><span class="token operator">></span>
<span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">(</span>h<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'__main__.Hello'</span><span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>要创建一个class对象，<code>type()</code>函数依次传入3个参数：</p>
<ol>
<li>class的名称；</li>
<li>继承的父类集合，注意Python支持多重继承，如果只有一个父类，别忘了tuple的单元素写法；</li>
<li>class的方法名称与函数绑定，这里我们把函数<code>fn</code>绑定到方法名<code>hello</code>上</li>
</ol>
<h6 id="元类（metaclass）"><a href="#元类（metaclass）" class="headerlink" title="元类（metaclass）"></a>元类（<code>metaclass</code>）</h6><p>控制类的创建行为。先定义<code>metaclass</code>，就可以创建类，最后创建实例。</p>
<p><code>metaclass</code>允许你创建类或者修改类。换句话说，你可以把类看成是<code>metaclass</code>创建出来的“实例”。</p>
<p>很少用到。</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># 给自定义的MyList增加一个add方法</span>
<span class="token comment"># metaclass是类的模板，所以必须从`type`类型派生：</span>
<span class="token keyword">class</span> <span class="token class-name">ListMetaclass</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__new__</span><span class="token punctuation">(</span>cls<span class="token punctuation">,</span> name<span class="token punctuation">,</span> bases<span class="token punctuation">,</span> attrs<span class="token punctuation">)</span><span class="token punctuation">:</span>
        attrs<span class="token punctuation">[</span><span class="token string">'add'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">lambda</span> self<span class="token punctuation">,</span> value<span class="token punctuation">:</span> self<span class="token punctuation">.</span>append<span class="token punctuation">(</span>value<span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token builtin">type</span><span class="token punctuation">.</span>__new__<span class="token punctuation">(</span>cls<span class="token punctuation">,</span> name<span class="token punctuation">,</span> bases<span class="token punctuation">,</span> attrs<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>有了<code>ListMetaclass</code>，我们在定义类的时候还要指示使用<code>ListMetaclass</code>来定制类，传入关键字参数<code>metaclass</code>：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">MyList</span><span class="token punctuation">(</span><span class="token builtin">list</span><span class="token punctuation">,</span> metaclass<span class="token operator">=</span>ListMetaclass<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">pass</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>当我们传入关键字参数<code>metaclass</code>时，魔术就生效了，它指示Python解释器在创建<code>MyList</code>时，要通过<code>ListMetaclass.__new__()</code>来创建，在此，我们可以修改类的定义，比如，加上新的方法，然后，返回修改后的定义。</p>
<p><code>__new__()</code>方法接收到的参数依次是：</p>
<ol>
<li>当前准备创建的类的对象；</li>
<li>类的名字；</li>
<li>类继承的父类集合；</li>
<li>类的方法集合。</li>
</ol>
<p>测试一下<code>MyList</code>是否可以调用<code>add()</code>方法：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> L <span class="token operator">=</span> MyList<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span> L<span class="token punctuation">.</span>add<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token operator">>></span> L
<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p><code>ORM</code>（对象-关系映射）：把关系数据库的一行映射为一个对象，也就是一个类对应一个表。</p>
<p>要编写一个<code>ORM</code>框架，所有的类都只能动态定义，因为只有使用者才能根据表的结构定义出对应的类来。</p>
<h4 id="错误、调试和测试"><a href="#错误、调试和测试" class="headerlink" title="错误、调试和测试"></a>错误、调试和测试</h4><h5 id="错误处理"><a href="#错误处理" class="headerlink" title="错误处理"></a>错误处理</h5><p><code>try...except...finally...</code></p>
<p><code>finally</code>不管成功还是异常都会执行。</p>
<p>在<code>except</code>后添加<code>else</code>代码块，当没有错误发生时。会执行<code>else</code>的内容</p>
<p>所有的错误类型都继承自<code>BaseException</code></p>
<h6 id="记录错误（logging）"><a href="#记录错误（logging）" class="headerlink" title="记录错误（logging）"></a>记录错误（logging）</h6><p>Python内置的<code>logging</code>模块可以非常容易地记录错误信息：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># err_logging.py</span>

<span class="token keyword">import</span> logging

<span class="token keyword">def</span> <span class="token function">foo</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token number">10</span> <span class="token operator">/</span> <span class="token builtin">int</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">bar</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> foo<span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2</span>

<span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        bar<span class="token punctuation">(</span><span class="token string">'0'</span><span class="token punctuation">)</span>
    <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
        logging<span class="token punctuation">.</span>exception<span class="token punctuation">(</span>e<span class="token punctuation">)</span>

main<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'END'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>同样是出错，但程序打印完错误信息后会继续执行，并正常退出：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># 使用</span>
$ python3 err_logging<span class="token punctuation">.</span>py
ERROR<span class="token punctuation">:</span>root<span class="token punctuation">:</span>division by zero
Traceback <span class="token punctuation">(</span>most recent call last<span class="token punctuation">)</span><span class="token punctuation">:</span>
  File <span class="token string">"err_logging.py"</span><span class="token punctuation">,</span> line <span class="token number">13</span><span class="token punctuation">,</span> <span class="token keyword">in</span> main
    bar<span class="token punctuation">(</span><span class="token string">'0'</span><span class="token punctuation">)</span>
  File <span class="token string">"err_logging.py"</span><span class="token punctuation">,</span> line <span class="token number">9</span><span class="token punctuation">,</span> <span class="token keyword">in</span> bar
    <span class="token keyword">return</span> foo<span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2</span>
  File <span class="token string">"err_logging.py"</span><span class="token punctuation">,</span> line <span class="token number">6</span><span class="token punctuation">,</span> <span class="token keyword">in</span> foo
    <span class="token keyword">return</span> <span class="token number">10</span> <span class="token operator">/</span> <span class="token builtin">int</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span>
ZeroDivisionError<span class="token punctuation">:</span> division by zero
END<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h6 id="抛出错误（raise）"><a href="#抛出错误（raise）" class="headerlink" title="抛出错误（raise）"></a>抛出错误（raise）</h6><p>使用<code>raise</code>抛出错误</p>
<p>python内置的错误类型如：<code>ValueError</code>,<code>TypeError</code></p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># err_reraise.py</span>

<span class="token keyword">def</span> <span class="token function">foo</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">:</span>
    n <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span>
    <span class="token keyword">if</span> n<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">:</span>
        <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span><span class="token string">'invalid value: %s'</span> <span class="token operator">%</span> s<span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token number">10</span> <span class="token operator">/</span> n

<span class="token keyword">def</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        foo<span class="token punctuation">(</span><span class="token string">'0'</span><span class="token punctuation">)</span>
    <span class="token keyword">except</span> ValueError <span class="token keyword">as</span> e<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'ValueError!'</span><span class="token punctuation">)</span>
        <span class="token keyword">raise</span>

bar<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><code>raise</code>语句如果不带参数，就会把当前错误原样抛出。</p>
<h5 id="调试"><a href="#调试" class="headerlink" title="调试"></a>调试</h5><h6 id="打印（print-）"><a href="#打印（print-）" class="headerlink" title="打印（print()）"></a>打印（<code>print()</code>）</h6><h6 id="断言（assert）"><a href="#断言（assert）" class="headerlink" title="断言（assert）"></a>断言（<code>assert</code>）</h6><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">foo</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">:</span>
    n <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span>
    <span class="token keyword">assert</span> n <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">'n is zero!'</span> <span class="token comment"># 'n != 0'应为true，断言失败会抛出AssertionError</span>
    <span class="token keyword">return</span> <span class="token number">10</span> <span class="token operator">/</span> n

<span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    foo<span class="token punctuation">(</span><span class="token string">'0'</span><span class="token punctuation">)</span>
    
<span class="token comment"># 使用</span>
$ python err<span class="token punctuation">.</span>py
Traceback <span class="token punctuation">(</span>most recent call last<span class="token punctuation">)</span><span class="token punctuation">:</span>
  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
AssertionError<span class="token punctuation">:</span> n <span class="token keyword">is</span> zero!<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>启动Python解释器时可以用<code>-O</code>（大写的’O’）参数来关闭<code>assert</code>，关闭后，你可以把所有的<code>assert</code>语句当成<code>pass</code>来看。</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">$ python <span class="token operator">-</span>O err<span class="token punctuation">.</span>py
Traceback <span class="token punctuation">(</span>most recent call last<span class="token punctuation">)</span><span class="token punctuation">:</span>
  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
ZeroDivisionError<span class="token punctuation">:</span> division by zero<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<h6 id="logging"><a href="#logging" class="headerlink" title="logging"></a>logging</h6><p><code>logging.info()</code>就可以输出一段文本。需要进行配置。</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> logging
logging<span class="token punctuation">.</span>basicConfig<span class="token punctuation">(</span>level<span class="token operator">=</span>logging<span class="token punctuation">.</span>INFO<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>指定记录信息的级别，有<code>debug</code>，<code>info</code>，<code>warning</code>，<code>error</code>等几个级别，当我们指定<code>level=INFO</code>时，<code>logging.debug</code>就不起作用了。</p>
<h6 id="pdb"><a href="#pdb" class="headerlink" title="pdb"></a>pdb</h6><p>让程序以单步方式运行，可以随时查看运行状态。</p>
<p>启动python代码文件，<code>python -m pdb err.py</code>。</p>
<p>输入命令<code>l</code>来查看代码，输入命令<code>n</code>可以单步执行代码，任何时候都可以输入命令<code>p 变量名</code>来查看变量，输入命令<code>q</code>结束调试，退出程序。</p>
<p><code>pdb.set_trace()</code>， 不需要单步执行。</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># err.py</span>
<span class="token keyword">import</span> pdb

s <span class="token operator">=</span> <span class="token string">'0'</span>
n <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span>
pdb<span class="token punctuation">.</span>set_trace<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 运行到这里会自动暂停，设置断点</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token number">10</span> <span class="token operator">/</span> n<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>程序会自动在<code>pdb.set_trace()</code>暂停并进入<code>pdb</code>调试环境，可以用命令<code>p</code>查看变量，或者用命令<code>c</code>继续运行：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">$ python err<span class="token punctuation">.</span>py 
<span class="token operator">></span> <span class="token operator">/</span>Users<span class="token operator">/</span>michael<span class="token operator">/</span>Github<span class="token operator">/</span>learn<span class="token operator">-</span>python3<span class="token operator">/</span>samples<span class="token operator">/</span>debug<span class="token operator">/</span>err<span class="token punctuation">.</span>py<span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token operator">&lt;</span>module<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token operator">-</span><span class="token operator">></span> <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token number">10</span> <span class="token operator">/</span> n<span class="token punctuation">)</span>
<span class="token punctuation">(</span>Pdb<span class="token punctuation">)</span> p n
<span class="token number">0</span>
<span class="token punctuation">(</span>Pdb<span class="token punctuation">)</span> c
Traceback <span class="token punctuation">(</span>most recent call last<span class="token punctuation">)</span><span class="token punctuation">:</span>
  File <span class="token string">"err.py"</span><span class="token punctuation">,</span> line <span class="token number">7</span><span class="token punctuation">,</span> <span class="token keyword">in</span> <span class="token operator">&lt;</span>module<span class="token operator">></span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token number">10</span> <span class="token operator">/</span> n<span class="token punctuation">)</span>
ZeroDivisionError<span class="token punctuation">:</span> division by zero<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h5 id="单元测试"><a href="#单元测试" class="headerlink" title="单元测试"></a>单元测试</h5><p>引入Python自带的<code>unittest</code>模块</p>
<p>测试类配合断言使用：</p>
<p>源文件：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">Dict</span><span class="token punctuation">(</span><span class="token builtin">dict</span><span class="token punctuation">)</span><span class="token punctuation">:</span>

    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token operator">**</span>kw<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token operator">**</span>kw<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">__getattr__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> self<span class="token punctuation">[</span>key<span class="token punctuation">]</span>
        <span class="token keyword">except</span> KeyError<span class="token punctuation">:</span>
            <span class="token keyword">raise</span> AttributeError<span class="token punctuation">(</span><span class="token string">r"'Dict' object has no attribute '%s'"</span> <span class="token operator">%</span> key<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">__setattr__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> value<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>相对应的测试类：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> unittest

<span class="token keyword">from</span> mydict <span class="token keyword">import</span> Dict
<span class="token comment"># 以test开头的方法就是测试方法，不以test开头的方法不被认为是测试方法，测试的时候不会被执行。</span>
<span class="token keyword">class</span> <span class="token class-name">TestDict</span><span class="token punctuation">(</span>unittest<span class="token punctuation">.</span>TestCase<span class="token punctuation">)</span><span class="token punctuation">:</span>

    <span class="token keyword">def</span> <span class="token function">test_init</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        d <span class="token operator">=</span> Dict<span class="token punctuation">(</span>a<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> b<span class="token operator">=</span><span class="token string">'test'</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>assertEqual<span class="token punctuation">(</span>d<span class="token punctuation">.</span>a<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>assertEqual<span class="token punctuation">(</span>d<span class="token punctuation">.</span>b<span class="token punctuation">,</span> <span class="token string">'test'</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>assertTrue<span class="token punctuation">(</span><span class="token builtin">isinstance</span><span class="token punctuation">(</span>d<span class="token punctuation">,</span> <span class="token builtin">dict</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">test_key</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        d <span class="token operator">=</span> Dict<span class="token punctuation">(</span><span class="token punctuation">)</span>
        d<span class="token punctuation">[</span><span class="token string">'key'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'value'</span>
        self<span class="token punctuation">.</span>assertEqual<span class="token punctuation">(</span>d<span class="token punctuation">.</span>key<span class="token punctuation">,</span> <span class="token string">'value'</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">test_attr</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        d <span class="token operator">=</span> Dict<span class="token punctuation">(</span><span class="token punctuation">)</span>
        d<span class="token punctuation">.</span>key <span class="token operator">=</span> <span class="token string">'value'</span>
        self<span class="token punctuation">.</span>assertTrue<span class="token punctuation">(</span><span class="token string">'key'</span> <span class="token keyword">in</span> d<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>assertEqual<span class="token punctuation">(</span>d<span class="token punctuation">[</span><span class="token string">'key'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'value'</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">test_keyerror</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        d <span class="token operator">=</span> Dict<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">with</span> self<span class="token punctuation">.</span>assertRaises<span class="token punctuation">(</span>KeyError<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token comment"># 访问不存在的key时，断言会抛出KeyError</span>
            value <span class="token operator">=</span> d<span class="token punctuation">[</span><span class="token string">'empty'</span><span class="token punctuation">]</span>

    <span class="token keyword">def</span> <span class="token function">test_attrerror</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        d <span class="token operator">=</span> Dict<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">with</span> self<span class="token punctuation">.</span>assertRaises<span class="token punctuation">(</span>AttributeError<span class="token punctuation">)</span><span class="token punctuation">:</span> 
            <span class="token comment"># 访问不存在的key时，我们期待抛出AttributeError</span>
            value <span class="token operator">=</span> d<span class="token punctuation">.</span>empty<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h6 id="setUp与tearDown"><a href="#setUp与tearDown" class="headerlink" title="setUp与tearDown"></a><code>setUp</code>与<code>tearDown</code></h6><p><code>setUp()</code>：调用一个测试方法前执行</p>
<p><code>tearDown()</code>：调用一个测试方法后执行</p>
<h3 id="安装第三方库"><a href="#安装第三方库" class="headerlink" title="安装第三方库"></a>安装第三方库</h3><p>安装pip库管理后，使用<code>pip install xxx </code></p>
<p>安装常用模块，可以直接使用<a href="https://www.anaconda.com/">Anaconda</a>，这是一个基于Python的数据处理和科学计算平台，它已经内置了许多非常有用的第三方库（<a href="https://pan.baidu.com/s/1kU5OCOB#list/path=%2Fpub%2Fpython">国内镜像</a>）。下载后直接安装</p>
<h3 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h3>]]></content>
      <categories>
        <category>后端</category>
      </categories>
      <tags>
        <tag>后端</tag>
        <tag>python</tag>
      </tags>
  </entry>
  <entry>
    <title>node-文件操作</title>
    <url>/posts/64893/</url>
    <content><![CDATA[<h4 id="检查目录是否存在，创建目录"><a href="#检查目录是否存在，创建目录" class="headerlink" title="检查目录是否存在，创建目录"></a>检查目录是否存在，创建目录</h4><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// node -v v12.*</span>
<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 查找目录 并判断是否存在目标文件夹</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">findDir</span><span class="token punctuation">(</span>dirPath <span class="token operator">=</span> <span class="token string">'.'</span><span class="token punctuation">,</span> dirName<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">const</span> files <span class="token operator">=</span> <span class="token keyword">await</span> fs<span class="token punctuation">.</span>promises<span class="token punctuation">.</span><span class="token function">readdir</span><span class="token punctuation">(</span>dirPath<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>
      <span class="token literal-property property">encoding</span><span class="token operator">:</span> <span class="token string">'utf8'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">withFileTypes</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      files<span class="token punctuation">.</span>length <span class="token operator">></span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span>
      files<span class="token punctuation">.</span><span class="token function">findIndex</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=></span> item<span class="token punctuation">.</span>name <span class="token operator">===</span> dirName <span class="token operator">&amp;&amp;</span> item<span class="token punctuation">.</span><span class="token function">isDirectory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token operator">-</span><span class="token number">1</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">throw</span> err
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 创建目录</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">createDir</span><span class="token punctuation">(</span><span class="token parameter">dirPath</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">await</span> fs<span class="token punctuation">.</span>promises<span class="token punctuation">.</span><span class="token function">mkdir</span><span class="token punctuation">(</span>dirPath<span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">throw</span> err
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 检查是否存在目录 不存在则创建</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">findOrCreateDir</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">await</span> <span class="token function">findDir</span><span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">,</span> dir<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>res<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token function">createDir</span><span class="token punctuation">(</span>dir<span class="token punctuation">)</span>
      <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
      <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
      console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 检查是否存在目录 存在则清空</span>
<span class="token keyword">function</span> <span class="token function">delDir</span><span class="token punctuation">(</span><span class="token parameter">path</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">let</span> files <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token comment">// if (fs.existsSync(path)) &#123;</span>
    files <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readdirSync</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>
      <span class="token literal-property property">withFileTypes</span><span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
    files<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">file</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">let</span> curPath <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>path<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>file<span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>file<span class="token punctuation">.</span><span class="token function">isDirectory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token function">delDir</span><span class="token punctuation">(</span>curPath<span class="token punctuation">)</span> <span class="token comment">//递归删除文件夹</span>
      <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
        fs<span class="token punctuation">.</span><span class="token function">unlinkSync</span><span class="token punctuation">(</span>curPath<span class="token punctuation">)</span> <span class="token comment">//删除文件</span>
      <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
    fs<span class="token punctuation">.</span><span class="token function">rmdirSync</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span>
  <span class="token comment">// &#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">// 方法2</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">findOrCreateDir</span><span class="token punctuation">(</span><span class="token parameter">path</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>fs<span class="token punctuation">.</span><span class="token function">existsSync</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token function">delDir</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">await</span> <span class="token function">createDir</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h4 id="循环删除空文件夹"><a href="#循环删除空文件夹" class="headerlink" title="循环删除空文件夹"></a>循环删除空文件夹</h4><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// node -v v14.*</span>
<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token keyword">const</span> originPath <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'./source/_posts'</span><span class="token punctuation">)</span>

<span class="token keyword">function</span> <span class="token function">resolveOriginPath</span><span class="token punctuation">(</span><span class="token parameter">url</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>originPath<span class="token punctuation">,</span> url<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">function</span> <span class="token function">rmEmptyDir</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// 同步读取目录 过滤非文件夹目录及非空文件夹</span>
    <span class="token keyword">const</span> files <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readdirSync</span><span class="token punctuation">(</span>originPath<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">withFileTypes</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">file</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
                        <span class="token keyword">if</span> <span class="token punctuation">(</span>file<span class="token punctuation">.</span><span class="token function">isDirectory</span><span class="token punctuation">(</span><span class="token function">resolveOriginPath</span><span class="token punctuation">(</span>file<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                            <span class="token keyword">return</span> fs<span class="token punctuation">.</span><span class="token function">readdirSync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">0</span>
                        <span class="token punctuation">&#125;</span>
                        <span class="token keyword">return</span> <span class="token boolean">false</span>
                    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>files<span class="token punctuation">)</span>
    
    <span class="token keyword">function</span> <span class="token function">rmDir</span><span class="token punctuation">(</span><span class="token parameter">url</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        fs<span class="token punctuation">.</span><span class="token function">rmdir</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token parameter">err</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
            err <span class="token operator">&amp;&amp;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'rm err: '</span><span class="token punctuation">,</span> url<span class="token punctuation">,</span> err<span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
    files<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=></span> <span class="token function">rmDir</span><span class="token punctuation">(</span><span class="token function">resolveOriginPath</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

]]></content>
      <categories>
        <category>前端</category>
        <category>node</category>
      </categories>
      <tags>
        <tag>前端</tag>
        <tag>工具</tag>
        <tag>node</tag>
      </tags>
  </entry>
  <entry>
    <title>python学习-2</title>
    <url>/posts/57859/</url>
    <content><![CDATA[<h3 id="环境搭建"><a href="#环境搭建" class="headerlink" title="环境搭建"></a>环境搭建</h3><h4 id="windows"><a href="#windows" class="headerlink" title="windows"></a>windows</h4><ol>
<li><p>安装python和pip</p>
<p>需要配置<strong>环境变量</strong></p>
<pre class="line-numbers language-none"><code class="language-none"># python默认路径
# pip 文件路径
C:\Users\ice_w\AppData\Local\Programs\Python\Python37\Scripts\
# python解释器路径
C:\Users\ice_w\AppData\Local\Programs\Python\Python37\<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>如果需要卸载相对应的版本python 需要运行对应版本的exe安装包进行<strong>uninstall</strong></p>
<pre class="line-numbers language-none"><code class="language-none">&#x2F;&#x2F; 检测pip是否安装成功
pip list
&#x2F;&#x2F; 查看版本
pip -V &#x2F; pip --version
python -V &#x2F; python --version
&#x2F;&#x2F; 直接运行python
python

&#x2F;&#x2F; 临时指定pip库路径
pip install -i https:&#x2F;&#x2F;pypi.tuna.tsinghua.edu.cn&#x2F;simple some-package
&#x2F;&#x2F; 配置源地址
pip config set global.index-url https:&#x2F;&#x2F;pypi.tuna.tsinghua.edu.cn&#x2F;simple

&#x2F;&#x2F; pip 升级版本
python -m pip install --upgrade pip

&#x2F;&#x2F; 查看安装包
pip list
pip list -o &#x2F;&#x2F; 列出安装包中哪些已有更新

&#x2F;&#x2F; 查看全局包安装路径
python -m site
&#x2F;&#x2F; USER_BASE python.exe启动程序路径 &#39;...\Scripts&#39;
&#x2F;&#x2F; USER_SITE 依赖安装包基础路径 &#39;...\Lib\site-packages&#39; 

&#x2F;&#x2F; 查看配置文件地址
python -m site -help
&#x2F;&#x2F; 在配置中修改文件中USER_BASE、USER_SITE地址

&#x2F;&#x2F; 查看python安装路径
python
&gt;&gt;&gt; import sys
&gt;&gt;&gt; sys.path<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
<li><p>搭建虚拟环境</p>
<pre class="line-numbers language-none"><code class="language-none">&#x2F;&#x2F; 如果有多个版本 -2&#x2F;-3 是区分python版本
py -3 -m venv venv &#x2F;&#x2F; python -m venv venv

&#x2F;&#x2F; 如果不能直接创建虚拟环境 需要全局安装virtualenv依赖之后 再创建虚拟环境
pip install virtualenv

&#x2F;&#x2F; 激活环境后安装依赖库
cd venv&#x2F;scripts
activate &#x2F;&#x2F; 激活

&#x2F;&#x2F; 退出环境
exit()<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
<li><p>安装依赖库</p>
<pre class="line-numbers language-none"><code class="language-none">pip install xxxx(库名)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li>
<li></li>
</ol>
<h5 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h5><p><a href="https://docs.python.org/zh-cn/3/using/windows.html">在Windows上使用 Python</a></p>
<h4 id="教程"><a href="#教程" class="headerlink" title="教程"></a>教程</h4><p><a href="http://code.py40.com/2540.html">python在线</a></p>
]]></content>
      <categories>
        <category>后端</category>
      </categories>
      <tags>
        <tag>后端</tag>
        <tag>python</tag>
      </tags>
  </entry>
  <entry>
    <title>react系列-HOOKS-UseEffect</title>
    <url>/posts/97c65c57/</url>
    <content><![CDATA[<h3 id="UseEffect"><a href="#UseEffect" class="headerlink" title="UseEffect"></a>UseEffect</h3><p>useEffect 是进行批量顺序执行的。</p>
<p>如果两个连着的 useEffect 则是会顺序执行。</p>
<p>test demo：</p>
<pre class="line-numbers language-react" data-language="react"><code class="language-react">const &#123; useEffect, useState &#125; &#x3D; React;
const TestComponent &#x3D; (&#123;
  parentConfig
&#125;) &#x3D;&gt; &#123;
  const [ isShow, setIsShow ] &#x3D; useState(false);
  const [ config, setConfig ] &#x3D; useState(&#123;&#125;);
  useEffect(() &#x3D;&gt; &#123;
    setConfig(parentConfig)
    setIsShow(false)
    console.log(&#39;first: &#39;, isShow, parentConfig)
  &#125;, [parentConfig])
  useEffect(() &#x3D;&gt; &#123;
    setIsShow(Object.keys(config).length &gt; 0)
    console.log(&#39;second: &#39;, isShow)
  &#125;, [config])
  useEffect(() &#x3D;&gt; &#123;
    console.log(&#39;update isShow: &#39;, isShow, &#39;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#39;)
  &#125;, [isShow])
  console.log(&#39;render TestComponent&#39;);
  return (
    isShow &amp;&amp; &lt;div&gt;test&lt;&#x2F;div&gt;
  )
&#125;

function App() &#123;
  const [ parentConfig, setParentConfig ] &#x3D; useState(&#123;a: 1&#125;);
  console.log(&#39;render App&#39;)
  return (
    &lt;div className&#x3D;&quot;App&quot;&gt;
      &lt;button onClick&#x3D;&#123;() &#x3D;&gt; setParentConfig(Object.keys(parentConfig).length &gt; 0 ? &#123;&#125; : &#123;a: 1&#125;)&#125;&gt;
        switch parentConfig
      &lt;&#x2F;button&gt;
      &lt;TestComponent parentConfig&#x3D;&#123;parentConfig&#125; &#x2F;&gt;
    &lt;&#x2F;div&gt;
  );
&#125;

ReactDOM.render(
  &lt;App &#x2F;&gt;,
  document.getElementById(&#39;root&#39;)
);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>初始渲染的日志顺序：</p>
<img src="/Users/wangwei/project/blogUpdate/blog/source/_posts/react系列-HOOKS/WX20211213-230845@2x.png" alt="WX20211213-230845@2x" style="zoom:50%;" />

]]></content>
      <categories>
        <category>前端</category>
        <category>react</category>
      </categories>
      <tags>
        <tag>前端</tag>
        <tag>react</tag>
        <tag>HOOKS</tag>
      </tags>
  </entry>
  <entry>
    <title>react系列-React.memo</title>
    <url>/posts/b5a9a427/</url>
    <content><![CDATA[<h3 id="组件渲染"><a href="#组件渲染" class="headerlink" title="组件渲染"></a>组件渲染</h3><h4 id="什么时候会触发组件渲染"><a href="#什么时候会触发组件渲染" class="headerlink" title="什么时候会触发组件渲染"></a>什么时候会触发组件渲染</h4><p>当传入组件的 props 和组件内部 state 更新时会触发组件渲染。</p>
<p>当父组件发生渲染就会触发子组件的渲染，如果是 class 组件则可以使用 React.PureComponent 进行优化，如果是函数组件则可以使用 React.memo 进行优化，减少渲染次数。</p>
<h5 id="值得阅读的文章"><a href="#值得阅读的文章" class="headerlink" title="值得阅读的文章"></a>值得阅读的文章</h5><p><a href="https://segmentfault.com/q/1010000040771487">React父组件刷新导致子组件重新渲染问题</a></p>
<p><a href="https://segmentfault.com/a/1190000039255043">深入了解React中state和props的更新</a></p>
<p><a href="https://segmentfault.com/a/1190000039716570">避免React生命周期的那些坑坑洼洼</a></p>
<h3 id="React-memo"><a href="#React-memo" class="headerlink" title="React.memo"></a><a href="https://zh-hans.reactjs.org/docs/react-api.html#reactmemo">React.memo</a></h3><p>参考链接：<a href="https://1349279985.github.io/%E4%BC%98%E5%8C%96React-memo%E6%B8%B2%E6%9F%93%E5%88%A4%E5%88%AB%E6%9C%BA%E5%88%B6%E5%8F%8A%E5%AE%9E%E6%88%98/">优化React.memo渲染判别机制及实战</a></p>
<h4 id="与普通的-FC-进行比较"><a href="#与普通的-FC-进行比较" class="headerlink" title="与普通的 FC 进行比较"></a>与普通的 FC 进行比较</h4><p>普通的 FC 和被 React.memo 包裹后的 FC 渲染次数对比：</p>
<pre class="line-numbers language-react" data-language="react"><code class="language-react">function TestComponent(props) &#123;
  console.log(&#39;我重新渲染了&#39;);
  return &lt;div&gt;函数组件：1&lt;&#x2F;div&gt;;
&#125;

const MyComponent &#x3D; React.memo(function MyComponent(props) &#123;
  console.log(&#39;memo: 我重新渲染了&#39;);
  return &lt;div&gt;memo函数组件：2&lt;&#x2F;div&gt;;
&#125;);
console.log(MyComponent);
class LifeCycle extends React.PureComponent &#123;
  constructor(props) &#123;
    super(props);
    this.state &#x3D; &#123;
      text: &#39;这个子组件文本&#39;,
      message: &#39;这个是子组件消息&#39;
    &#125;;
  &#125;
  changeText &#x3D; () &#x3D;&gt; &#123;
    this.setState(&#123;
      text: &#39;修改后的子组件文本&#39;
    &#125;);
  &#125;;
  changeMessage &#x3D; () &#x3D;&gt; &#123;
    this.setState(&#123;
      message: &#39;修改后的子组件消息&#39;
    &#125;);
  &#125;;
  render() &#123;
    console.log(&#39;render LifeCycle class component&#39;);
    return (
      &lt;div&gt;
        &lt;button onClick&#x3D;&#123;this.changeText&#125;&gt;
          修改子组件文本内容
        &lt;&#x2F;button&gt;
        &lt;button onClick&#x3D;&#123;this.changeMessage&#125;&gt;
          修改子组件消息
        &lt;&#x2F;button&gt;
        &lt;div&gt;&#123;this.state.text&#125;&lt;&#x2F;div&gt;
        &lt;div&gt;&#123;this.state.message&#125;&lt;&#x2F;div&gt;
        &lt;div className&#x3D;&#39;textContent&#39;&gt;
          &lt;TestComponent &#x2F;&gt;
          &lt;MyComponent &#x2F;&gt;
        &lt;&#x2F;div&gt;
      &lt;&#x2F;div&gt;
    );
  &#125;
&#125;

class LifeCycelContainer extends React.Component &#123;
  constructor(props) &#123;
    super(props);
    this.state &#x3D; &#123;
      text: &#39;父组件文本&#39;,
      message: &#39;父组件消息&#39;
    &#125;;
  &#125;
  changeText &#x3D; () &#x3D;&gt; &#123;
    this.setState(&#123;
      text: &#39;修改后的父组件文本&#39;
    &#125;);
  &#125;;
  changeMessage &#x3D; () &#x3D;&gt; &#123;
    this.setState(&#123;
      message: &#39;修改后的父组件消息&#39;
    &#125;);
  &#125;;
  render() &#123;
    return (
      &lt;div&gt;
        &lt;button onClick&#x3D;&#123;this.changeText&#125;&gt;
          修改父组件文本
        &lt;&#x2F;button&gt;
        &lt;button onClick&#x3D;&#123;this.changeMessage&#125;&gt;
          修改父组件消息
        &lt;&#x2F;button&gt;
        &lt;div&gt;&#123;this.state.text&#125;&lt;&#x2F;div&gt;
        &lt;div&gt;&#123;this.state.message&#125;&lt;&#x2F;div&gt;
        &lt;LifeCycle &#x2F;&gt;
      &lt;&#x2F;div&gt;
    );
  &#125;
&#125;

ReactDOM.render(&lt;LifeCycelContainer &#x2F;&gt;, document.getElementById(&#39;root&#39;));<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h4 id="复杂的-props-数据结构"><a href="#复杂的-props-数据结构" class="headerlink" title="复杂的 props 数据结构"></a>复杂的 props 数据结构</h4><p>如果 props 数据结构过于复杂，React.memo 只进行浅层比较，也会触发多次渲染的问题。</p>
<pre class="line-numbers language-react" data-language="react"><code class="language-react">function TestComponent(props) &#123;
  console.log(&#39;我重新渲染了&#39;);
  return &lt;div&gt;函数组件：1&lt;&#x2F;div&gt;;
&#125;

const MyComponent &#x3D; React.memo(function MyComponent(props) &#123;
  console.log(&#39;memo: 我重新渲染了&#39;, props.prop);
  return &lt;div&gt;memo函数组件：2&lt;&#x2F;div&gt;;
&#125;);

class LifeCycle extends React.PureComponent &#123;
  constructor(props) &#123;
    super(props);
    this.state &#x3D; &#123;
      text: &#39;这个子组件文本&#39;,
      message: &#39;这个是子组件消息&#39;,
      count: 1,
    &#125;;
  &#125;
  changeText &#x3D; () &#x3D;&gt; &#123;
    this.setState(&#123;
      text: &#39;修改后的子组件文本&#39;
    &#125;);
  &#125;;
  changeMessage &#x3D; () &#x3D;&gt; &#123;
    this.setState(&#123;
      message: &#39;修改后的子组件消息&#39;
    &#125;);
  &#125;;
  addCount &#x3D; () &#x3D;&gt; &#123;
     this.setState(&#123;
       count: this.state.count + 1
     &#125;)
  &#125;;
  
  getMonthlyDisableDate &#x3D; (date) &#x3D;&gt; &#123;
    return true;
  &#125;;
  
  getChildProps &#x3D; () &#x3D;&gt; &#123;
    return [
      &#123;
        fieldName: &#39;reportId&#39;,
        type: &#39;select&#39;,
        label: &#39;月报名称&#39;,
        clearable: false,
        value: [],
      &#125;,
      &#123;
        fieldName: &#39;reportId2&#39;,
        type: &#39;select2&#39;,
        label: &#39;月报名称2&#39;,
        clearable: false,
        value: [],
        disable: this.getMonthlyDisableDate,
      &#125;,
      &#123;
        fieldName: &#39;reportId2&#39;,
        type: &#39;select2&#39;,
        label: &#39;月报名称2&#39;,
        clearable: false,
        value: [],
        noResultText: () &#x3D;&gt; (
          &lt;div&gt;
            暂无数据，去添加
          &lt;&#x2F;div&gt;
        ),
      &#125;
    ];
  &#125;
  
  render() &#123;
    console.log(&#39;render LifeCycle class component&#39;);
    return (
      &lt;div&gt;
        &lt;button onClick&#x3D;&#123;this.changeText&#125;&gt;
          修改子组件文本内容
        &lt;&#x2F;button&gt;
        &lt;button onClick&#x3D;&#123;this.changeMessage&#125;&gt;
          修改子组件消息
        &lt;&#x2F;button&gt;
        &lt;button onClick&#x3D;&#123;this.addCount&#125;&gt;
          +1
        &lt;&#x2F;button&gt;
        &lt;div&gt;&#123;this.state.text&#125;&lt;&#x2F;div&gt;
        &lt;div&gt;&#123;this.state.message&#125;&lt;&#x2F;div&gt;
        &lt;div&gt;count: &#123;this.state.count&#125;&lt;&#x2F;div&gt;
        &lt;div className&#x3D;&#39;textContent&#39;&gt;
          &lt;TestComponent &#x2F;&gt;
          &lt;MyComponent prop&#x3D;&#123;this.getChildProps()&#125; &#x2F;&gt;
        &lt;&#x2F;div&gt;
      &lt;&#x2F;div&gt;
    );
  &#125;
&#125;

class LifeCycelContainer extends React.Component &#123;
  constructor(props) &#123;
    super(props);
    this.state &#x3D; &#123;
      text: &#39;父组件文本&#39;,
      message: &#39;父组件消息&#39;
    &#125;;
  &#125;
  changeText &#x3D; () &#x3D;&gt; &#123;
    this.setState(&#123;
      text: &#39;修改后的父组件文本&#39;
    &#125;);
  &#125;;
  changeMessage &#x3D; () &#x3D;&gt; &#123;
    this.setState(&#123;
      message: &#39;修改后的父组件消息&#39;
    &#125;);
  &#125;;
  render() &#123;
    return (
      &lt;div&gt;
        &lt;button onClick&#x3D;&#123;this.changeText&#125;&gt;
          修改父组件文本
        &lt;&#x2F;button&gt;
        &lt;button onClick&#x3D;&#123;this.changeMessage&#125;&gt;
          修改父组件消息
        &lt;&#x2F;button&gt;
        &lt;div&gt;&#123;this.state.text&#125;&lt;&#x2F;div&gt;
        &lt;div&gt;&#123;this.state.message&#125;&lt;&#x2F;div&gt;
        &lt;LifeCycle &#x2F;&gt;
      &lt;&#x2F;div&gt;
    );
  &#125;
&#125;

ReactDOM.render(&lt;LifeCycelContainer &#x2F;&gt;, document.getElementById(&#39;root&#39;));<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>React.memo 会对每次传入的 props 做浅层比较。比较算法 <a href="https://github.com/facebook/react/blob/main/packages/shared/shallowEqual.js">shallowEqual</a> ：</p>
<img src="./shallowEqual.png" alt="shallowEqual" style="zoom:50%;" />

<p>对基础数据格式、只有一层的数组或对象可以进行比较，如果包含函数或其他复杂的数据类型，则返回结果则为 false。</p>
<blockquote>
<p> 参考链接：<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object/is">Object.is() - MDN</a></p>
</blockquote>
<h4 id="自定义设置比较函数"><a href="#自定义设置比较函数" class="headerlink" title="自定义设置比较函数"></a>自定义设置比较函数</h4><p>React.memo 有第二个参数，可以自定义深层比较函数。</p>
<p>使用自定义的对比函数，改写上面的 demo：</p>
<pre class="line-numbers language-react" data-language="react"><code class="language-react">function deepCompareObject(prevValue, nextValue) &#123;
  if (Object.is(prevValue, nextValue)) &#123;
    return true;
  &#125;
  if (typeof prevValue !&#x3D;&#x3D; typeof nextValue) &#123;
    return false;
  &#125;
  if ([&#39;string&#39;, &#39;number&#39;, &#39;boolean&#39;, &#39;undefined&#39;].includes(typeof prevValue)) &#123;
    return false;
  &#125;
  if (prevValue &#x3D;&#x3D;&#x3D; null || nextValue &#x3D;&#x3D;&#x3D; null) &#123;
    return false;
  &#125;
  if (typeof prevValue &#x3D;&#x3D;&#x3D; &#39;function&#39; &amp;&amp; typeof nextValue &#x3D;&#x3D;&#x3D; &#39;function&#39;) &#123;
    return prevValue.toString() &#x3D;&#x3D;&#x3D; nextValue.toString();
  &#125;
  &#x2F;&#x2F; object &amp; array
  if (typeof prevValue &#x3D;&#x3D;&#x3D; &#39;object&#39;) &#123;
    const prevValueKeys &#x3D; Object.keys(prevValue);
    const nextValueKeys &#x3D; Object.keys(nextValue);
    if (prevValueKeys.length !&#x3D;&#x3D; nextValueKeys.length) &#123;
      return false;
    &#125;
    for (let i &#x3D; 0; i &lt; prevValueKeys.length; i++) &#123;
      if (!Object.prototype.hasOwnProperty.call(nextValue, prevValueKeys[i])) &#123;
        return false;
      &#125;
      const result &#x3D; deepCompareObject(prevValue[prevValueKeys[i]], nextValue[prevValueKeys[i]]);
      if (!result) &#123;
        return false;
      &#125;
    &#125;
    return true;
  &#125;
  return false;
&#125;

function TestComponent(props) &#123;
  console.log(&#39;我重新渲染了&#39;);
  return &lt;div&gt;函数组件：1&lt;&#x2F;div&gt;;
&#125;

const MyComponent &#x3D; React.memo(function MyComponent(props) &#123;
  console.log(&#39;memo: 我重新渲染了&#39;);
  return &lt;div&gt;memo函数组件：2&lt;&#x2F;div&gt;;
&#125;, deepCompareObject);

class LifeCycle extends React.PureComponent &#123;
  constructor(props) &#123;
    super(props);
    this.state &#x3D; &#123;
      text: &#39;这个子组件文本&#39;,
      message: &#39;这个是子组件消息&#39;,
      count: 1,
    &#125;;
  &#125;
  changeText &#x3D; () &#x3D;&gt; &#123;
    this.setState(&#123;
      text: &#39;修改后的子组件文本&#39;
    &#125;);
  &#125;;
  changeMessage &#x3D; () &#x3D;&gt; &#123;
    this.setState(&#123;
      message: &#39;修改后的子组件消息&#39;
    &#125;);
  &#125;;
  addCount &#x3D; () &#x3D;&gt; &#123;
     this.setState(&#123;
       count: this.state.count + 1
     &#125;)
  &#125;;
  
  getMonthlyDisableDate &#x3D; (date) &#x3D;&gt; &#123;
    return true;
  &#125;;
  
  getChildProps &#x3D; () &#x3D;&gt; &#123;
    return [
      &#123;
        fieldName: &#39;reportId&#39;,
        type: &#39;select&#39;,
        label: &#39;月报名称&#39;,
        clearable: false,
        value: [],
      &#125;,
      &#123;
        fieldName: &#39;reportId2&#39;,
        type: &#39;select2&#39;,
        label: &#39;月报名称2&#39;,
        clearable: false,
        value: [],
        disable: this.getMonthlyDisableDate,
      &#125;,
      &#123;
        fieldName: &#39;reportId2&#39;,
        type: &#39;select2&#39;,
        label: &#39;月报名称2&#39;,
        clearable: false,
        value: [],
        noResultText: () &#x3D;&gt; (
          &lt;div&gt;
            暂无数据，去添加
          &lt;&#x2F;div&gt;
        ),
      &#125;
    ];
  &#125;
  
  render() &#123;
    console.log(&#39;render LifeCycle class component&#39;);
    return (
      &lt;div&gt;
        &lt;button onClick&#x3D;&#123;this.changeText&#125;&gt;
          修改子组件文本内容
        &lt;&#x2F;button&gt;
        &lt;button onClick&#x3D;&#123;this.changeMessage&#125;&gt;
          修改子组件消息
        &lt;&#x2F;button&gt;
        &lt;button onClick&#x3D;&#123;this.addCount&#125;&gt;
          +1
        &lt;&#x2F;button&gt;
        &lt;div&gt;&#123;this.state.text&#125;&lt;&#x2F;div&gt;
        &lt;div&gt;&#123;this.state.message&#125;&lt;&#x2F;div&gt;
        &lt;div&gt;count: &#123;this.state.count&#125;&lt;&#x2F;div&gt;
        &lt;div className&#x3D;&#39;textContent&#39;&gt;
          &lt;TestComponent &#x2F;&gt;
          &lt;MyComponent value&#x3D;&#123;this.getChildProps()&#125; &#x2F;&gt;
        &lt;&#x2F;div&gt;
      &lt;&#x2F;div&gt;
    );
  &#125;
&#125;

class LifeCycelContainer extends React.Component &#123;
  constructor(props) &#123;
    super(props);
    this.state &#x3D; &#123;
      text: &#39;父组件文本&#39;,
      message: &#39;父组件消息&#39;
    &#125;;
  &#125;
  changeText &#x3D; () &#x3D;&gt; &#123;
    this.setState(&#123;
      text: &#39;修改后的父组件文本&#39;
    &#125;);
  &#125;;
  changeMessage &#x3D; () &#x3D;&gt; &#123;
    this.setState(&#123;
      message: &#39;修改后的父组件消息&#39;
    &#125;);
  &#125;;
  render() &#123;
    return (
      &lt;div&gt;
        &lt;button onClick&#x3D;&#123;this.changeText&#125;&gt;
          修改父组件文本
        &lt;&#x2F;button&gt;
        &lt;button onClick&#x3D;&#123;this.changeMessage&#125;&gt;
          修改父组件消息
        &lt;&#x2F;button&gt;
        &lt;div&gt;&#123;this.state.text&#125;&lt;&#x2F;div&gt;
        &lt;div&gt;&#123;this.state.message&#125;&lt;&#x2F;div&gt;
        &lt;LifeCycle &#x2F;&gt;
      &lt;&#x2F;div&gt;
    );
  &#125;
&#125;

ReactDOM.render(&lt;LifeCycelContainer &#x2F;&gt;, document.getElementById(&#39;root&#39;));<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>





]]></content>
      <categories>
        <category>前端</category>
        <category>react</category>
      </categories>
      <tags>
        <tag>前端</tag>
        <tag>react</tag>
        <tag>react-router</tag>
      </tags>
  </entry>
  <entry>
    <title>react-formily踩坑实记</title>
    <url>/posts/5888f532/</url>
    <content><![CDATA[<blockquote>
<p>本文使用的是 formily 2.* 版本</p>
</blockquote>
<h3 id="理论"><a href="#理论" class="headerlink" title="理论"></a>理论</h3><h4 id="官方文档"><a href="#官方文档" class="headerlink" title="官方文档"></a>官方文档</h4><p>formily 主站：<a href="https://formilyjs.org/zh-CN">https://formilyjs.org/zh-CN</a></p>
<p>formily 核心库 core：<a href="https://core.formilyjs.org/zh-CN">https://core.formilyjs.org/zh-CN</a></p>
<p>formily 响应式状态管理方案 reactive：<a href="https://reactive.formilyjs.org/zh-CN">https://reactive.formilyjs.org/zh-CN</a></p>
<p>formily 组件库 react：<a href="https://react.formilyjs.org/zh-CN">https://react.formilyjs.org/zh-CN</a></p>
<blockquote>
<p>本文主要基于 react 进行 formily 相关实战。</p>
<p>formily 也有 vue 相关组件库，具体请看 <a href="https://vue.formilyjs.org/">https://vue.formilyjs.org/</a></p>
</blockquote>
<h4 id="工作相关的参考文章"><a href="#工作相关的参考文章" class="headerlink" title="工作相关的参考文章"></a>工作相关的参考文章</h4><blockquote>
<p>在查找一些解决方案时发现了宝藏同事总结的使用方法，遂记录一下</p>
</blockquote>
<ol>
<li><a href="https://blog.syzh.fun/posts/hxd/formily-2-check/">formily 2.0之表单校验</a></li>
<li><a href="https://blog.syzh.fun/posts/hxd/formily-sugar/">formily2.0 + sugar 实战总结</a></li>
</ol>
<h4 id="其他文章"><a href="#其他文章" class="headerlink" title="其他文章"></a>其他文章</h4><blockquote>
<p>官方提供了非常详细的一些业务场景的例子，可以在官方的 codesandbox 例子中进行实验</p>
</blockquote>
<h4 id="关键组件"><a href="#关键组件" class="headerlink" title="关键组件"></a>关键组件</h4><p><a href="https://react.formilyjs.org/zh-CN/api/components/form-provider">FormProvider</a>：入口组件，用于下发表单上下文给字段组件，负责整个表单状态的通讯，它相当于是一个通讯枢纽。挂载 Form 实例的组件。</p>
<p><a href="https://react.formilyjs.org/zh-CN/api/components/schema-field">SchemaField</a>：SchemaField 组件是专门用于解析<a href="https://react.formilyjs.org/api/shared/schema">JSON-Schema</a>动态渲染表单的组件。 在使用 SchemaField 组件的时候，需要通过 createSchemaField 工厂函数创建一个 SchemaField 组件。</p>
<p><a href="https://formilyjs.org/zh-CN/guide/quick-start#%E5%85%B7%E4%BD%93%E7%94%A8%E4%BE%8B">来自官网的简单 JSX 示例</a>：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> createForm <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'@formily/core'</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> FormProvider<span class="token punctuation">,</span> FormConsumer<span class="token punctuation">,</span> Field <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'@formily/react'</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span>
  FormItem<span class="token punctuation">,</span>
  FormLayout<span class="token punctuation">,</span>
  Input<span class="token punctuation">,</span>
  FormButtonGroup<span class="token punctuation">,</span>
  Submit<span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'@formily/antd'</span>

<span class="token keyword">const</span> form <span class="token operator">=</span> <span class="token function">createForm</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>FormProvider form<span class="token operator">=</span><span class="token punctuation">&#123;</span>form<span class="token punctuation">&#125;</span><span class="token operator">></span>
      <span class="token operator">&lt;</span>FormLayout layout<span class="token operator">=</span><span class="token string">"vertical"</span><span class="token operator">></span>
        <span class="token operator">&lt;</span>Field
          name<span class="token operator">=</span><span class="token string">"input"</span>
          title<span class="token operator">=</span><span class="token string">"输入框"</span>
          required
          initialValue<span class="token operator">=</span><span class="token string">"Hello world"</span>
          decorator<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">[</span>FormItem<span class="token punctuation">]</span><span class="token punctuation">&#125;</span>
          component<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">[</span>Input<span class="token punctuation">]</span><span class="token punctuation">&#125;</span>
        <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>FormLayout<span class="token operator">></span>
      <span class="token operator">&lt;</span>FormConsumer<span class="token operator">></span>
        <span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span>
          <span class="token operator">&lt;</span>div
            style<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span>
              <span class="token literal-property property">marginBottom</span><span class="token operator">:</span> <span class="token number">20</span><span class="token punctuation">,</span>
              <span class="token literal-property property">padding</span><span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
              <span class="token literal-property property">border</span><span class="token operator">:</span> <span class="token string">'1px dashed #666'</span><span class="token punctuation">,</span>
            <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>
          <span class="token operator">></span>
            实时响应：<span class="token punctuation">&#123;</span>form<span class="token punctuation">.</span>values<span class="token punctuation">.</span>input<span class="token punctuation">&#125;</span>
          <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
        <span class="token punctuation">)</span><span class="token punctuation">&#125;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>FormConsumer<span class="token operator">></span>
      <span class="token operator">&lt;</span>FormButtonGroup<span class="token operator">></span>
        <span class="token operator">&lt;</span>Submit onSubmit<span class="token operator">=</span><span class="token punctuation">&#123;</span>console<span class="token punctuation">.</span>log<span class="token punctuation">&#125;</span><span class="token operator">></span>提交<span class="token operator">&lt;</span><span class="token operator">/</span>Submit<span class="token operator">></span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>FormButtonGroup<span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>FormProvider<span class="token operator">></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>从以上例子中，我们可以学到很多东西：</p>
<ul>
<li><a href="https://core.formilyjs.org/zh-CN/api/entry/create-form">createForm</a> 用来创建表单核心领域模型，它是作为 <a href="https://core.formilyjs.org/guide/mvvm">MVVM</a> 设计模式的标准 ViewModel</li>
<li><a href="https://react.formilyjs.org/zh-CN/api/components/form-provider">FormProvider</a> 组件是作为视图层桥接表单模型的入口，它只有一个参数，就是接收 createForm 创建出来的 Form 实例，并将 Form 实例以上下文形式传递到子组件中</li>
<li><a href="https://antd.formilyjs.org/zh-CN/components/form-layout">FormLayout</a> 组件是用来批量控制 <a href="https://antd.formilyjs.org/zh-CN/components/form-item">FormItem</a> 样式的组件，这里我们指定布局为上下布局，也就是标签在上，组件在下</li>
<li><a href="https://react.formilyjs.org/zh-CN/api/components/field">Field</a> 组件是用来承接普通字段的组件<ul>
<li>name 属性，标识字段在表单最终提交数据中的路径</li>
<li>title 属性，标识字段的标题<ul>
<li>如果 decorator 指定为 FormItem，那么在 FormItem 组件中会默认以接收 title 属性作为标签</li>
<li>如果指定为某个自定义组件，那么 title 的消费方则由自定义组件来承接</li>
<li>如果不指定 decorator，那么 title 则不会显示在 UI 上</li>
</ul>
</li>
<li>required 属性，必填校验的极简写法，标识该字段必填<ul>
<li>如果 decorator 指定为 FormItem，那么会自动出现星号提示，同时校验失败也会有对应的状态反馈，这些都是 FormItem 内部做的默认处理</li>
<li>如果 decorator 指定为自定义组件，那么对应的 UI 样式则需要自定义组件实现方自己实现</li>
<li>如果不指定 decorator，那么 required 只是会阻塞提交，校验失败不会有任何 UI 反馈。</li>
</ul>
</li>
<li>initialValue 属性，代表字段的默认值</li>
<li>decorator 属性，代表字段的 UI 装饰器，通常我们都会指定为 FormItem<ul>
<li>注意 decorator 属性传递的是数组形式，第一个参数代表指定组件类型，第二个参数代表指定组件属性</li>
</ul>
</li>
<li>component 属性，代表字段的输入控件，可以是 Input，也可以是 Select，等等<ul>
<li>注意 component 属性传递的是数组形式，第一个参数代表指定组件类型，第二个参数代表指定组件属性</li>
</ul>
</li>
</ul>
</li>
<li><a href="https://react.formilyjs.org/zh-CN/api/components/form-consumer">FormConsumer</a> 组件是作为响应式模型的响应器而存在，它核心是一个 render props 模式，在作为 children 的回调函数中，会自动收集所有依赖，如果依赖发生变化，则会重新渲染，借助 FormConsumer 我们可以很方便的实现各种计算汇总的需求</li>
<li><a href="https://antd.formilyjs.org/zh-CN/components/form-button-group">FormButtonGroup</a> 组件作为表单按钮组容器而存在，主要负责按钮的布局</li>
<li><a href="https://antd.formilyjs.org/zh-CN/components/submit">Submit</a> 组件作为表单提交的动作触发器而存在，其实我们也可以直接使用 form.submit 方法进行提交，但是使用 Submit 的好处是不需要每次都在 Button 组件上写 onClick 事件处理器，同时它还处理了 Form 的 loading 状态，如果 onSubmit 方法返回一个 Promise，且 Promise 正在 pending 状态，那么按钮会自动进入 loading 状态</li>
</ul>
<h3 id="实战"><a href="#实战" class="headerlink" title="实战"></a>实战</h3><blockquote>
<p>项目中主要使用 JSON Schema 的方式去创建表单</p>
</blockquote>
<p>表单字段内容设置参考链接：</p>
<p>schema：<a href="https://react.formilyjs.org/zh-CN/api/shared/schema">https://react.formilyjs.org/zh-CN/api/shared/schema</a></p>
<p>schemaField：<a href="https://react.formilyjs.org/zh-CN/api/components/schema-field">https://react.formilyjs.org/zh-CN/api/components/schema-field</a></p>
<p>IFieldFactoryProps：<a href="https://core.formilyjs.org/api/models/form#ifieldfactoryprops">https://core.formilyjs.org/api/models/form#ifieldfactoryprops</a></p>
<h4 id="select-组件使用异步-options-数据"><a href="#select-组件使用异步-options-数据" class="headerlink" title="select 组件使用异步 options 数据"></a>select 组件使用异步 options 数据</h4><h5 id="使用-onFieldInit-进行设置"><a href="#使用-onFieldInit-进行设置" class="headerlink" title="使用 onFieldInit 进行设置"></a>使用 onFieldInit 进行设置</h5><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">private</span> baseInfoForm <span class="token operator">=</span> <span class="token generic-function"><span class="token function">createForm</span><span class="token generic class-name"><span class="token operator">&lt;</span>BaseInfoDetail<span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
  initialValues<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token operator">...</span><span class="token constant">DEFAULT_BASE_INFO</span><span class="token punctuation">,</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token function">effects</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token function">onFieldInit</span><span class="token punctuation">(</span><span class="token string">'absId'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>field<span class="token operator">:</span> IFieldState<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
      <span class="token function">fetchHolidayTypeList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        field<span class="token punctuation">.</span>dataSource <span class="token operator">=</span>
          res<span class="token operator">?.</span>data<span class="token operator">?.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>holidayType<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
          id<span class="token operator">:</span> holidayType<span class="token punctuation">.</span>id<span class="token punctuation">,</span>
          name<span class="token operator">:</span> holidayType<span class="token punctuation">.</span>name<span class="token punctuation">,</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h5 id="使用-onFormInit-进行设置"><a href="#使用-onFormInit-进行设置" class="headerlink" title="使用 onFormInit 进行设置"></a>使用 onFormInit 进行设置</h5><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">private</span> baseInfoForm <span class="token operator">=</span> <span class="token generic-function"><span class="token function">createForm</span><span class="token generic class-name"><span class="token operator">&lt;</span>BaseInfoDetail<span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
  initialValues<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token operator">...</span><span class="token constant">DEFAULT_BASE_INFO</span><span class="token punctuation">,</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token function">effects</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token function">onFormInit</span><span class="token punctuation">(</span><span class="token punctuation">(</span>form<span class="token operator">:</span> Form<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
      <span class="token function">fetchHolidayTypeList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        form<span class="token punctuation">.</span><span class="token function">setFieldState</span><span class="token punctuation">(</span><span class="token string">'absId'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>fieldState<span class="token operator">:</span> IGeneralFieldState<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
          fieldState<span class="token punctuation">.</span>dataSource <span class="token operator">=</span>
            res<span class="token operator">?.</span>data<span class="token operator">?.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>holidayType<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
              id<span class="token operator">:</span> holidayType<span class="token punctuation">.</span>id<span class="token punctuation">,</span>
              name<span class="token operator">:</span> holidayType<span class="token punctuation">.</span>name<span class="token punctuation">,</span>
            <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h5 id="在-componentDidMount-中设置"><a href="#在-componentDidMount-中设置" class="headerlink" title="在 componentDidMount 中设置"></a>在 componentDidMount 中设置</h5><h4 id="表单数据联动"><a href="#表单数据联动" class="headerlink" title="表单数据联动"></a>表单数据联动</h4><p>参考文档：<a href="https://formilyjs.org/zh-CN/guide/advanced/linkages">https://formilyjs.org/zh-CN/guide/advanced/linkages</a></p>
<p><a href="https://react.formilyjs.org/zh-CN/api/shared/schema#schemareactions">https://react.formilyjs.org/zh-CN/api/shared/schema#schemareactions</a></p>
<p>schema 属性值：<a href="https://react.formilyjs.org/zh-CN/api/shared/schema#%E5%B1%9E%E6%80%A7">https://react.formilyjs.org/zh-CN/api/shared/schema#%E5%B1%9E%E6%80%A7</a></p>
<p>IGeneralFieldState：<a href="https://core.formilyjs.org/zh-CN/api/models/field#ifieldstate">https://core.formilyjs.org/zh-CN/api/models/field#ifieldstate</a></p>
<h5 id="SchemaReaction-类型"><a href="#SchemaReaction-类型" class="headerlink" title="SchemaReaction 类型"></a>SchemaReaction 类型</h5><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> IGeneralFieldState <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'@formily/core'</span>

<span class="token keyword">type</span> <span class="token class-name">SchemaReaction<span class="token operator">&lt;</span>Field <span class="token operator">=</span> <span class="token builtin">any</span><span class="token operator">></span></span> <span class="token operator">=</span>
  <span class="token operator">|</span> <span class="token punctuation">&#123;</span>
      dependencies<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">|</span> Record<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token builtin">string</span><span class="token operator">></span> <span class="token comment">// 依赖的字段路径列表，只能以点路径描述依赖，支持相对路径，如果是数组格式，那么读的时候也是数组格式，如果是对象格式，读的时候也是对象格式，只是对象格式相当于是一个alias</span>
      when<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">|</span> <span class="token builtin">boolean</span> <span class="token comment">// 联动条件</span>
      target<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span> <span class="token comment">// 要操作的字段路径，支持FormPathPattern路径语法，注意：不支持相对路径！！</span>
      effects<span class="token operator">?</span><span class="token operator">:</span> SchemaReactionEffect<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token comment">// 主动模式下的独立生命周期钩子</span>
      fulfill<span class="token operator">?</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// 满足条件</span>
        state<span class="token operator">?</span><span class="token operator">:</span> IGeneralFieldState <span class="token comment">// 更新状态</span>
        schema<span class="token operator">?</span><span class="token operator">:</span> ISchema <span class="token comment">// 更新Schema</span>
        run<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span> <span class="token comment">// 执行语句</span>
      <span class="token punctuation">&#125;</span>
      otherwise<span class="token operator">?</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// 不满足条件</span>
        state<span class="token operator">?</span><span class="token operator">:</span> IGeneralFieldState <span class="token comment">// 更新状态</span>
        schema<span class="token operator">?</span><span class="token operator">:</span> ISchema <span class="token comment">// 更新Schema</span>
        run<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span> <span class="token comment">// 执行语句</span>
      <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
  <span class="token operator">|</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>field<span class="token operator">:</span> Field<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token comment">// 可以复杂联动</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>从类型上看有两种方式可以设置 schemaReaction 可以使用显示配置的方式或者函数控制 field 属性进行。</p>
<p>常用的方式为使用配置条件对象，如果有更加复杂的联动规则，推荐使用函数的方式进行联动设置。</p>
<p>进行联动配置时，可以配置 state、schema 和执行语句。</p>
<p>配置 state 时需要查看状态类型 IGeneralFieldState 中相对应的属性，schema 是需要查看 ISchema 中相对应的属性。</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">"react"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> createForm <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">"@formily/core"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> createSchemaField <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">"@formily/react"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> Form<span class="token punctuation">,</span> FormItem<span class="token punctuation">,</span> Input <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">"@formily/antd"</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> SchemaField <span class="token operator">=</span> <span class="token function">createSchemaField</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
  <span class="token literal-property property">components</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    Input<span class="token punctuation">,</span>
    FormItem
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">scope</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token function">requiredReactions</span><span class="token punctuation">(</span><span class="token parameter">field</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">const</span> requiredField <span class="token operator">=</span> field<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string">"required_1"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">take</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"requiredField: "</span><span class="token punctuation">,</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> requiredField<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>requiredField<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
      <span class="token punctuation">&#125;</span>
      field<span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
        <span class="token literal-property property">value</span><span class="token operator">:</span> requiredField<span class="token punctuation">.</span>value
      <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> requireSchema <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">"object"</span><span class="token punctuation">,</span>
  <span class="token literal-property property">properties</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token literal-property property">required_1</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
      <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">"required_1"</span><span class="token punctuation">,</span>
      <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">"必填"</span><span class="token punctuation">,</span>
      <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">"string"</span><span class="token punctuation">,</span>
      <span class="token literal-property property">required</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token string-property property">"x-decorator"</span><span class="token operator">:</span> <span class="token string">"FormItem"</span><span class="token punctuation">,</span>
      <span class="token string-property property">"x-component"</span><span class="token operator">:</span> <span class="token string">"Input"</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">required_2</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
      <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">"required_2"</span><span class="token punctuation">,</span>
      <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">"必填"</span><span class="token punctuation">,</span>
      <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">"string"</span><span class="token punctuation">,</span>
      <span class="token string-property property">"x-validator"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        <span class="token literal-property property">required</span><span class="token operator">:</span> <span class="token boolean">true</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
      <span class="token string-property property">"x-decorator"</span><span class="token operator">:</span> <span class="token string">"FormItem"</span><span class="token punctuation">,</span>
      <span class="token string-property property">"x-component"</span><span class="token operator">:</span> <span class="token string">"Input"</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">required_3</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
      <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">"required_3"</span><span class="token punctuation">,</span>
      <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">"必填"</span><span class="token punctuation">,</span>
      <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">"string"</span><span class="token punctuation">,</span>
      <span class="token string-property property">"x-validator"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">&#123;</span>
          <span class="token literal-property property">required</span><span class="token operator">:</span> <span class="token boolean">true</span>
        <span class="token punctuation">&#125;</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token string-property property">"x-decorator"</span><span class="token operator">:</span> <span class="token string">"FormItem"</span><span class="token punctuation">,</span>
      <span class="token string-property property">"x-component"</span><span class="token operator">:</span> <span class="token string">"Input"</span><span class="token punctuation">,</span>
      <span class="token string-property property">"x-reactions"</span><span class="token operator">:</span> <span class="token string">"&#123;&#123;requiredReactions&#125;&#125;"</span>
      <span class="token comment">// "x-reactions": &#123;</span>
      <span class="token comment">//   dependencies: ["required_1"],</span>
      <span class="token comment">//   fulfill: &#123;</span>
      <span class="token comment">//     state: &#123;</span>
      <span class="token comment">//       value: "&#123;&#123;$deps[0]&#125;&#125;"</span>
      <span class="token comment">//     &#125;</span>
      <span class="token comment">//   &#125;</span>
      <span class="token comment">// &#125;</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">FormPart</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">&#123;</span>
  form <span class="token operator">=</span> <span class="token function">createForm</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
    <span class="token literal-property property">initialValues</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
      <span class="token literal-property property">required_1</span><span class="token operator">:</span> <span class="token number">1</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span><span class="token operator">></span>
        <span class="token operator">&lt;</span>Form form<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token keyword">this</span><span class="token punctuation">.</span>form<span class="token punctuation">&#125;</span> labelCol<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token number">6</span><span class="token punctuation">&#125;</span> wrapperCol<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token number">10</span><span class="token punctuation">&#125;</span><span class="token operator">></span>
          <span class="token operator">&lt;</span>SchemaField schema<span class="token operator">=</span><span class="token punctuation">&#123;</span>requireSchema<span class="token punctuation">&#125;</span> <span class="token operator">/</span><span class="token operator">></span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>Form<span class="token operator">></span>
        <span class="token operator">&lt;</span>div onClick<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>form<span class="token punctuation">.</span>values<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token operator">></span> 点击 <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
      <span class="token operator">&lt;</span><span class="token operator">/</span><span class="token operator">></span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>参考链接：<a href="https://codesandbox.io/s/formily-reaction-cnuttc">https://codesandbox.io/s/formily-reaction-cnuttc</a></p>
</blockquote>
<h6 id="Reaction-联动触发的时机"><a href="#Reaction-联动触发的时机" class="headerlink" title="Reaction 联动触发的时机"></a>Reaction 联动触发的时机</h6><p>使用联动需要注意触发时机。</p>
<ul>
<li>表单初始化时</li>
<li>依赖值初始化时</li>
<li>依赖值改变时</li>
</ul>
<p>Reaction 函数主要设置到被联动的字段配置上，虽然也可以设置到被依赖字段配置上，但是需要注意被依赖字段是否有其他依赖值，容易引发一系列意想不到的联动。</p>
<h5 id="使用-Effect-进行联动"><a href="#使用-Effect-进行联动" class="headerlink" title="使用 Effect 进行联动"></a>使用 Effect 进行联动</h5><p>effect 主要是监听被依赖字段值的改变（onFieldValueChange）。</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> createForm<span class="token punctuation">,</span> onFieldValueChange <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'@formily/core'</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> createSchemaField<span class="token punctuation">,</span> FormConsumer <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'@formily/react'</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> Form<span class="token punctuation">,</span> FormItem<span class="token punctuation">,</span> Input<span class="token punctuation">,</span> Select <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'@formily/antd'</span>

<span class="token keyword">const</span> form <span class="token operator">=</span> <span class="token function">createForm</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
  <span class="token function">effects</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// 字段值改变时触发</span>
    <span class="token function">onFieldValueChange</span><span class="token punctuation">(</span><span class="token string">'select'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">field</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'effects'</span><span class="token punctuation">,</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      form<span class="token punctuation">.</span><span class="token function">setFieldState</span><span class="token punctuation">(</span><span class="token string">'input'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">state</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// 对于初始联动，如果字段找不到，setFieldState会将更新推入更新队列，直到字段出现再执行操作</span>
        state<span class="token punctuation">.</span>display <span class="token operator">=</span> field<span class="token punctuation">.</span>value
      <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> SchemaField <span class="token operator">=</span> <span class="token function">createSchemaField</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
  <span class="token literal-property property">components</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    FormItem<span class="token punctuation">,</span>
    Input<span class="token punctuation">,</span>
    Select<span class="token punctuation">,</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span>
  <span class="token operator">&lt;</span>Form form<span class="token operator">=</span><span class="token punctuation">&#123;</span>form<span class="token punctuation">&#125;</span><span class="token operator">></span>
    <span class="token operator">&lt;</span>SchemaField<span class="token operator">></span>
      <span class="token operator">&lt;</span>SchemaField<span class="token punctuation">.</span>String
        name<span class="token operator">=</span><span class="token string">"select"</span>
        title<span class="token operator">=</span><span class="token string">"控制者"</span>
        <span class="token keyword">default</span><span class="token operator">=</span><span class="token string">"visible"</span>
        <span class="token keyword">enum</span><span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">[</span>
          <span class="token punctuation">&#123;</span> <span class="token literal-property property">label</span><span class="token operator">:</span> <span class="token string">'显示'</span><span class="token punctuation">,</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">'visible'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
          <span class="token punctuation">&#123;</span> <span class="token literal-property property">label</span><span class="token operator">:</span> <span class="token string">'隐藏'</span><span class="token punctuation">,</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">'none'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
          <span class="token punctuation">&#123;</span> <span class="token literal-property property">label</span><span class="token operator">:</span> <span class="token string">'隐藏-保留值'</span><span class="token punctuation">,</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">'hidden'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">&#125;</span>
        x<span class="token operator">-</span>component<span class="token operator">=</span><span class="token string">"Select"</span>
        x<span class="token operator">-</span>decorator<span class="token operator">=</span><span class="token string">"FormItem"</span>
      <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&lt;</span>SchemaField<span class="token punctuation">.</span>String
        name<span class="token operator">=</span><span class="token string">"input"</span>
        title<span class="token operator">=</span><span class="token string">"受控者"</span>
        x<span class="token operator">-</span>component<span class="token operator">=</span><span class="token string">"Input"</span>
        x<span class="token operator">-</span>decorator<span class="token operator">=</span><span class="token string">"FormItem"</span>
      <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>SchemaField<span class="token operator">></span>
    <span class="token operator">&lt;</span>FormConsumer<span class="token operator">></span>
      <span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span>
        <span class="token operator">&lt;</span>code<span class="token operator">></span>
          <span class="token operator">&lt;</span>pre<span class="token operator">></span><span class="token punctuation">&#123;</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>form<span class="token punctuation">.</span>values<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>pre<span class="token operator">></span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>code<span class="token operator">></span>
      <span class="token punctuation">)</span><span class="token punctuation">&#125;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>FormConsumer<span class="token operator">></span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>Form<span class="token operator">></span>
<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h6 id="使用-addEffects-的方式添加-effect"><a href="#使用-addEffects-的方式添加-effect" class="headerlink" title="使用 addEffects 的方式添加 effect"></a>使用 addEffects 的方式添加 effect</h6><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> form <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>form<span class="token punctuation">;</span>
form<span class="token punctuation">.</span><span class="token function">addEffects</span><span class="token punctuation">(</span><span class="token string">'handleReaction'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token function">onFieldValueChange</span><span class="token punctuation">(</span><span class="token string">'require_1'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">field</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// do something</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h4 id="异步数据校验"><a href="#异步数据校验" class="headerlink" title="异步数据校验"></a>异步数据校验</h4><p>官方示例：<a href="https://formilyjs.org/zh-CN/guide/advanced/validate#%E5%BC%82%E6%AD%A5%E6%A0%A1%E9%AA%8C">https://formilyjs.org/zh-CN/guide/advanced/validate#%E5%BC%82%E6%AD%A5%E6%A0%A1%E9%AA%8C</a></p>
<p>按照校验时机分为：<code>onInput</code> 、 <code>onBlur</code>、<code>onFocus</code>。</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> createForm <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'@formily/core'</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> createSchemaField <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'@formily/react'</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> Form<span class="token punctuation">,</span> FormItem<span class="token punctuation">,</span> Input <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'@formily/antd'</span>

<span class="token keyword">const</span> form <span class="token operator">=</span> <span class="token function">createForm</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> SchemaField <span class="token operator">=</span> <span class="token function">createSchemaField</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
  <span class="token literal-property property">components</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    Input<span class="token punctuation">,</span>
    FormItem<span class="token punctuation">,</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> schema <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'object'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">properties</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token literal-property property">async_validate</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
      <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">'异步校验'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">required</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token string-property property">'x-validator'</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&#123;&#123;(value) => &#123;
        return new Promise((resolve) => &#123;
          setTimeout(() => &#123;
            if (!value) &#123;
              resolve('')
            &#125;
            if (value === '123') &#123;
              resolve('')
            &#125; else &#123;
              resolve('错误❎')
            &#125;
          &#125;, 1000)
        &#125;)
      &#125;&#125;&#125;</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
      <span class="token string-property property">'x-component'</span><span class="token operator">:</span> <span class="token string">'Input'</span><span class="token punctuation">,</span>
      <span class="token string-property property">'x-decorator'</span><span class="token operator">:</span> <span class="token string">'FormItem'</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">async_validate_2</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
      <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">'异步校验(onBlur触发)'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">required</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token string-property property">'x-validator'</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        <span class="token literal-property property">triggerType</span><span class="token operator">:</span> <span class="token string">'onBlur'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">validator</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&#123;&#123;(value) => &#123;
        return new Promise((resolve) => &#123;
          setTimeout(() => &#123;
            if (!value) &#123;
              resolve('')
            &#125;
            if (value === '123') &#123;
              resolve('')
            &#125; else &#123;
              resolve('错误❎')
            &#125;
          &#125;, 1000)
        &#125;)
      &#125;&#125;&#125;</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
      <span class="token string-property property">'x-component'</span><span class="token operator">:</span> <span class="token string">'Input'</span><span class="token punctuation">,</span>
      <span class="token string-property property">'x-decorator'</span><span class="token operator">:</span> <span class="token string">'FormItem'</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span>
  <span class="token operator">&lt;</span>Form form<span class="token operator">=</span><span class="token punctuation">&#123;</span>form<span class="token punctuation">&#125;</span> labelCol<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token number">6</span><span class="token punctuation">&#125;</span> wrapperCol<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token number">10</span><span class="token punctuation">&#125;</span><span class="token operator">></span>
    <span class="token operator">&lt;</span>SchemaField schema<span class="token operator">=</span><span class="token punctuation">&#123;</span>schema<span class="token punctuation">&#125;</span> <span class="token operator">/</span><span class="token operator">></span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>Form<span class="token operator">></span>
<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h5 id="使用-debounce-对数据请求接口进行包裹"><a href="#使用-debounce-对数据请求接口进行包裹" class="headerlink" title="使用 debounce 对数据请求接口进行包裹"></a>使用 debounce 对数据请求接口进行包裹</h5><p>目的：主要减少 <code>onInput</code> 时请求接口进行数据校验的频率。</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> createForm <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'@formily/core'</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> createSchemaField <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'@formily/react'</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> Form<span class="token punctuation">,</span> FormItem<span class="token punctuation">,</span> Input <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'@formily/antd'</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> debounce <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'lodash'</span>

<span class="token keyword">const</span> form <span class="token operator">=</span> <span class="token function">createForm</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> SchemaField <span class="token operator">=</span> <span class="token function">createSchemaField</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
  <span class="token literal-property property">components</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    Input<span class="token punctuation">,</span>
    FormItem<span class="token punctuation">,</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> debounceValidator <span class="token operator">=</span> <span class="token function">debounce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>value<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span>
      <span class="token punctuation">&#125;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>value <span class="token operator">===</span> <span class="token string">'123'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span>
      <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'错误❎'</span><span class="token punctuation">)</span>
      <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> schema <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'object'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">properties</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token literal-property property">async_validate</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
      <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">'异步校验'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">required</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token string-property property">'x-validator'</span><span class="token operator">:</span> debounceValidator<span class="token punctuation">,</span>
      <span class="token string-property property">'x-component'</span><span class="token operator">:</span> <span class="token string">'Input'</span><span class="token punctuation">,</span>
      <span class="token string-property property">'x-decorator'</span><span class="token operator">:</span> <span class="token string">'FormItem'</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span>
  <span class="token operator">&lt;</span>Form form<span class="token operator">=</span><span class="token punctuation">&#123;</span>form<span class="token punctuation">&#125;</span> labelCol<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token number">6</span><span class="token punctuation">&#125;</span> wrapperCol<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token number">10</span><span class="token punctuation">&#125;</span><span class="token operator">></span>
    <span class="token operator">&lt;</span>SchemaField schema<span class="token operator">=</span><span class="token punctuation">&#123;</span>schema<span class="token punctuation">&#125;</span> <span class="token operator">/</span><span class="token operator">></span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>Form<span class="token operator">></span>
<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h6 id="模拟异步请求"><a href="#模拟异步请求" class="headerlink" title="模拟异步请求"></a>模拟异步请求</h6><p>请求内容就是被层层包裹，中间进行数据逻辑处理。</p>
<p><strong>试图优化，但是不起效果，以下这段代码有一个延迟返回校验结果的 bug</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">"react"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> createForm <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">"@formily/core"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> createSchemaField <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">"@formily/react"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> Form<span class="token punctuation">,</span> FormItem<span class="token punctuation">,</span> Input <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">"@formily/antd"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> debounce <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">"lodash"</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> form <span class="token operator">=</span> <span class="token function">createForm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> SchemaField <span class="token operator">=</span> <span class="token function">createSchemaField</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
  <span class="token literal-property property">components</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    Input<span class="token punctuation">,</span>
    FormItem
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">mockRequest</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>value<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">&#125;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>value <span class="token operator">===</span> <span class="token string">"123"</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
        <span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">"错误❎"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> debounceValidator <span class="token operator">=</span> <span class="token function">debounce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token comment">// 如果不进行 return 则不起效果</span>
  <span class="token keyword">return</span> <span class="token function">mockRequest</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    	<span class="token keyword">return</span> <span class="token string">""</span><span class="token punctuation">;</span>
      <span class="token comment">// return Promise.resolve("");</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
    	<span class="token keyword">return</span> err<span class="token punctuation">;</span>
      <span class="token comment">// return Promise.resolve(err);</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> schema <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">"object"</span><span class="token punctuation">,</span>
  <span class="token literal-property property">properties</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token literal-property property">async_validate</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
      <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">"异步校验"</span><span class="token punctuation">,</span>
      <span class="token literal-property property">required</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token string-property property">"x-validator"</span><span class="token operator">:</span> debounceValidator<span class="token punctuation">,</span>
      <span class="token string-property property">"x-component"</span><span class="token operator">:</span> <span class="token string">"Input"</span><span class="token punctuation">,</span>
      <span class="token string-property property">"x-decorator"</span><span class="token operator">:</span> <span class="token string">"FormItem"</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span>
  <span class="token operator">&lt;</span>Form form<span class="token operator">=</span><span class="token punctuation">&#123;</span>form<span class="token punctuation">&#125;</span> labelCol<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token number">6</span><span class="token punctuation">&#125;</span> wrapperCol<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token number">10</span><span class="token punctuation">&#125;</span><span class="token operator">></span>
    <span class="token operator">&lt;</span>SchemaField schema<span class="token operator">=</span><span class="token punctuation">&#123;</span>schema<span class="token punctuation">&#125;</span> <span class="token operator">/</span><span class="token operator">></span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>Form<span class="token operator">></span>
<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h6 id="最终方案"><a href="#最终方案" class="headerlink" title="最终方案"></a>最终方案</h6><p>能够实时显示接口请求的异步校验结果</p>
<p>参考链接：<a href="https://antd.formilyjs.org/zh-CN/components/select#markup-schema-%E5%BC%82%E6%AD%A5%E6%90%9C%E7%B4%A2%E6%A1%88%E4%BE%8B">https://antd.formilyjs.org/zh-CN/components/select#markup-schema-%E5%BC%82%E6%AD%A5%E6%90%9C%E7%B4%A2%E6%A1%88%E4%BE%8B</a></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">"react"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> createForm <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">"@formily/core"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> createSchemaField <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">"@formily/react"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> Form<span class="token punctuation">,</span> FormItem<span class="token punctuation">,</span> Input <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">"@formily/antd"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> debounce <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">"lodash"</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> form <span class="token operator">=</span> <span class="token function">createForm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> SchemaField <span class="token operator">=</span> <span class="token function">createSchemaField</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
  <span class="token literal-property property">components</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    Input<span class="token punctuation">,</span>
    FormItem
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">requestMock</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>value<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">&#125;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>value <span class="token operator">===</span> <span class="token string">"123"</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
        <span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">"错误❎"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> debounceValidator <span class="token operator">=</span> <span class="token function">debounce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">value<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token function">requestMock</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"success"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">callback</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">callback</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> schema <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">"object"</span><span class="token punctuation">,</span>
  <span class="token literal-property property">properties</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token literal-property property">async_validate</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
      <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">"异步校验"</span><span class="token punctuation">,</span>
      <span class="token literal-property property">required</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token string-property property">"x-validator"</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
          <span class="token function">debounceValidator</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> resolve<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
      <span class="token string-property property">"x-component"</span><span class="token operator">:</span> <span class="token string">"Input"</span><span class="token punctuation">,</span>
      <span class="token string-property property">"x-decorator"</span><span class="token operator">:</span> <span class="token string">"FormItem"</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span>
  <span class="token operator">&lt;</span>Form form<span class="token operator">=</span><span class="token punctuation">&#123;</span>form<span class="token punctuation">&#125;</span> labelCol<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token number">6</span><span class="token punctuation">&#125;</span> wrapperCol<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token number">10</span><span class="token punctuation">&#125;</span><span class="token operator">></span>
    <span class="token operator">&lt;</span>SchemaField schema<span class="token operator">=</span><span class="token punctuation">&#123;</span>schema<span class="token punctuation">&#125;</span> <span class="token operator">/</span><span class="token operator">></span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>Form<span class="token operator">></span>
<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h6 id="formily-校验的核心代码"><a href="#formily-校验的核心代码" class="headerlink" title="formily 校验的核心代码"></a>formily 校验的核心代码</h6><p>源码链接：<a href="https://github1s.com/alibaba/formily/blob/HEAD/packages/validator/src/parser.ts">https://github1s.com/alibaba/formily/blob/HEAD/packages/validator/src/parser.ts</a></p>
<h4 id="表单-EFFECT-HOOK-使用"><a href="#表单-EFFECT-HOOK-使用" class="headerlink" title="表单 EFFECT HOOK 使用"></a>表单 EFFECT HOOK 使用</h4><p>踩坑 issue：<a href="https://github.com/alibaba/formily/issues/1602">表单切换显隐（组件卸载并重新挂载）后，所有 effects 失效</a></p>
<p>最后的解决方案是在需要使用 formily hook 的组件中手动 addEffects 添加 formily hook。</p>
<blockquote>
<p>踩坑的主要原因是，公司自研的组件库 tabs 组件切换 tab 时是通过组件的卸载来进行切换的，卸载了的 formily 校验就会完全失效永远走的是 success。突然想到跟我最开始的时候触发的一个坑一样的，卸载掉的组件触发校验就是永远都是 success。</p>
</blockquote>
<p>参考链接：</p>
<p>Form Effect Hooks：<a href="https://core.formilyjs.org/zh-CN/api/entry/form-effect-hooks">https://core.formilyjs.org/zh-CN/api/entry/form-effect-hooks</a><br>Field Effect Hooks：<a href="https://core.formilyjs.org/zh-CN/api/entry/field-effect-hooks">https://core.formilyjs.org/zh-CN/api/entry/field-effect-hooks</a></p>
<h5 id="常用的-effect-hooks"><a href="#常用的-effect-hooks" class="headerlink" title="常用的 effect hooks"></a>常用的 effect hooks</h5><p><strong>onFieldValueChange</strong>：用于监听某个字段值变化的副作用钩子。这个钩子会在 form 设置初始化值和 form.setValues 时触发。</p>
<p><strong>onFieldInputValueChange</strong>：用于监听某个字段 onInput 触发的副作用钩子。仅仅想在用户触发了 input 事件后响应值的变化，也可以监听到选项框切换选项，check box 触发勾选等情况。</p>
<p><strong>onFieldReact</strong>：用于实现字段响应式逻辑的副作用钩子，它的核心原理就是字段初始化的时候会执行回调函数，同时自动追踪依赖，依赖数据发生变化时回调函数会重复执行。内部会自动收集依赖。<em>用户操作手动改变赋值时不会触发，使用 api setValue 时会触发。</em></p>
<blockquote>
<p>不知道会不会有升级 formily 的坑。<br>⚠️：这个 hooks 会追踪依赖，依赖改变就会触发 onFieldReact hooks</p>
</blockquote>
<p><strong>onFormValidateStart</strong>：用于监听表单校验开始的副作用钩子。</p>
<p><strong>onFormReact</strong>: 用于实现表单响应式逻辑的副作用钩子，它的核心原理就是表单初始化的时候会执行回调函数，同时自动追踪依赖，依赖数据发生变化时回调函数会重复执行。内部会自动收集依赖，内部依赖值改变就会触发 hooks。</p>
<blockquote>
<p>如果 onFormReact 内部监听的数据没有 field 组件去承接，会在页面隐藏或者组件销毁时崩溃。<br>原因：onFormReact 中做了额外的 onFieldInit 收集 dispose 函数，并在销毁时进行触发，如果没有 field 组件去承接则就没有 dispose 函数，dispose 函数运行没有做判空处理。</p>
</blockquote>
<h3 id="踩坑"><a href="#踩坑" class="headerlink" title="踩坑"></a>踩坑</h3><p>初始使用的时候，对定义不是很清晰，所以踩了很多不必要的坑。</p>
<ul>
<li><p>一个 form 实例对应一个 FormProvider 组件</p>
<ul>
<li>如果使用多个  FormProvider 组件对应一个 form 实例，则会触发意想不到的 bug。</li>
<li>需要注意 form 显隐控制导致的 validate 失效问题。</li>
</ul>
</li>
<li><p>FormProvider 组件中可以使用多个 SchemaField 组件</p>
</li>
<li><p>field 属性值部分需要注意的地方</p>
<p>使用 visible 属性设置隐藏（none）的时候，字段隐藏则会为 undefined，在获取 form.values 时会过滤掉。 </p>
<p>hidden 属性设置隐藏（hidden）的时候，字段隐藏，但是在获取 form.values 时仍然保留字段值。</p>
<blockquote>
<p><strong>active</strong></p>
<p>触发 onFocus 为 true，触发 onBlur 为 false</p>
<p><strong>visited</strong></p>
<p>触发过 onFocus 则永远为 true</p>
<p><strong>inputValue</strong></p>
<p>触发 onInput 收集到的值</p>
<p><strong>inputValues</strong></p>
<p>触发 onInput 收集到的多参值</p>
<p><strong>hidden</strong></p>
<p>为 true 时， display 为 hidden；为 false 时 display 为 visible</p>
<p><strong>visible</strong></p>
<p>为 true 时， display 为 visible；为 false 时 display 为 none</p>
<p>参考链接：<a href="https://core.formilyjs.org/zh-CN/api/models/field#%E8%AF%A6%E7%BB%86%E8%A7%A3%E9%87%8A">https://core.formilyjs.org/zh-CN/api/models/field#%E8%AF%A6%E7%BB%86%E8%A7%A3%E9%87%8A</a></p>
</blockquote>
</li>
</ul>
]]></content>
      <categories>
        <category>前端</category>
        <category>react</category>
      </categories>
      <tags>
        <tag>前端</tag>
        <tag>react</tag>
        <tag>formily</tag>
      </tags>
  </entry>
  <entry>
    <title>react系列-formily踩坑实记2</title>
    <url>/posts/f504f813/</url>
    <content><![CDATA[<blockquote>
<p>本文使用的是 formily 2.* 版本</p>
<p>碎碎念：<br>使用 formily 已经半年了，期间使用 formily 表单写了几个大需求，目前状态处于能够快速定位 formily 相关问题的阶段。但是没有完整的读过源码和梳理 formily 处理方式，所以还是不够深入，仅处于会用状态。<br>突然发现我好像没有从头到尾好好看过 formily 官方文档，都是在看示例，初期看文档可能没有太深的感受，现在再去看一遍觉得受益匪浅。</p>
</blockquote>
<p>本文主要是针对使用 formily 开发过程中遇到的问题做一个踩坑复盘，顺便解答一下最开始上手使用 formily 的时候可能会产生的疑问：</p>
<p>疑问点：</p>
<ul>
<li>什么是 formily？formily 能解决哪些问题？</li>
<li>使用 class component 还是使用 function component 写表单</li>
<li>使用 JSON Schema 还是 JSX 的方式写表单</li>
<li>使用 formily Field 管理表单字段数据状态</li>
</ul>
<p>踩坑复盘：</p>
<ul>
<li>@formliy/reactive-react 中的 observer </li>
<li>Field display 的 visible、hidden、none 区别</li>
<li>setValues 过后触发了预期外的 Field 响应</li>
<li>setValues 后表单并没有显示预期的数据</li>
<li>field validator 无法清空 setSelfErrors 设置的 error</li>
<li>联动使用 Field reaction 还是 effect hooks</li>
</ul>
<h1 id="什么是-formily？formily-能解决哪些问题？"><a href="#什么是-formily？formily-能解决哪些问题？" class="headerlink" title="什么是 formily？formily 能解决哪些问题？"></a>什么是 formily？formily 能解决哪些问题？</h1><h2 id="什么是-formily"><a href="#什么是-formily" class="headerlink" title="什么是 formily"></a>什么是 formily</h2><p>一个抽象了表单领域模型的 MVVM 表单解决方案</p>
<h2 id="Formily-解决的问题"><a href="#Formily-解决的问题" class="headerlink" title="Formily 解决的问题"></a>Formily 解决的问题</h2><ul>
<li>表单性能优化</li>
<li>字段关联逻辑，联动逻辑实现高效</li>
<li>表单状态管理</li>
<li>表单数据管理</li>
<li>动态渲染</li>
<li>表单场景化复用</li>
</ul>
<h3 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h3><ul>
<li><p>精确渲染（reactive 方案 - 面向DDD的响应式状态管理方案）</p>
<blockquote>
<p>将视图模型抽象出来，然后在 DSL 模板层消费，DSL 借助某种依赖收集机制，然后在视图模型中统一调度，保证每次输入都是精确渲染的，这就是工业级的 GUI 形态。</p>
</blockquote>
<p>实现了一个类 <a href="https://github.com/mobxjs/mobx">Mobx</a> 的库 <a href="https://reactive.formilyjs.org/zh-CN">@formily/reactive</a>，核心的能力为依赖追踪机制和响应式模型的抽象能力。</p>
</li>
</ul>
<ul>
<li><p>领域模型（Field 模型）</p>
</li>
<li><p>路径系统</p>
</li>
<li><p>生命周期</p>
</li>
<li><p>协议驱动</p>
<p><a href="https://json-schema.org/">JSON-schema</a> 数据协议</p>
<blockquote>
<p>在 JSON Schema 中，引入 void，代表一个虚数据节点，表示该节点并不占用实际数据结构。<br>推荐使用 schema 的重要原因之一：Schema 模式的核心优势，借助协议，可以做场景化抽象。纯 JSX 模式，受限于 JSX 的不可解析性。</p>
</blockquote>
</li>
<li><p>分层架构<br><img src="/./formily-%E5%88%86%E5%B1%82%E6%9E%B6%E6%9E%84.svg" alt="formily-分层架构"></p>
<blockquote>
<p>这张图主要将 Formily 分为了内核层，UI 桥接层，扩展组件层，和配置应用层。</p>
<p>内核层是 UI 无关的，它保证了用户管理的逻辑和状态是不耦合任何一个框架，这样有几个好处：</p>
<p>逻辑与 UI 框架解耦，未来做框架级别的迁移，业务代码无需大范围重构<br>学习成本统一，如果用户使用了@formily/react，以后业务迁移@formily/vue，用户不需要重新学习<br>JSON Schema 独立存在，给 UI 桥接层消费，保证了协议驱动在不同 UI 框架下的绝对一致性，不需要重复实现协议解析逻辑。</p>
<p>扩展组件层，提供一系列表单场景化组件，保证用户开箱即用。无需花大量时间做二次开发。</p>
</blockquote>
</li>
</ul>
<h3 id="Formily-的核心库"><a href="#Formily-的核心库" class="headerlink" title="Formily 的核心库"></a>Formily 的核心库</h3><p>我们常用到 formily 的三个核心库，其中各个库的作用为：</p>
<ul>
<li><p><a href="https://reactive.formilyjs.org/zh-CN">@formliy/reactive</a>： 面向DDD的响应式状态管理方案。</p>
</li>
<li><p><a href="https://react.formilyjs.org/zh-CN">@formily/react</a>：@formily/react 的核心定位是将 ViewModel(<a href="https://core.formilyjs.org/">@formily/core</a>)与组件实现一个状态绑定关系，桥接了数据和 UI，把很多脏逻辑优雅的解耦，变得可维护。</p>
</li>
<li><p><a href="https://core.formilyjs.org/zh-CN/guide">@formily/core</a>：formily 核心库，将领域模型从 UI 框架中抽离出来，与逻辑的耦合关系中释放出来，提升代码可维护性。</p>
</li>
</ul>
<h1 id="使用-class-component-还是使用-function-component-写表单"><a href="#使用-class-component-还是使用-function-component-写表单" class="headerlink" title="使用 class component 还是使用 function component 写表单"></a>使用 class component 还是使用 function component 写表单</h1><p>因为我们主要实践是使用 jsx 的方式写的，所以特别特别建议使用 function component 的方式去写 formily 表单。</p>
<p>主要理由有：</p>
<ul>
<li>@formliy/reactive 中的 api observer 只支持 function component</li>
<li>@formily/react 中有很多方便的 hooks 和 api</li>
</ul>
<blockquote>
<p>在上面👆已经讨论过了 formily 核心库之间的关系</p>
<p>function component 的最佳实践（简单的数据结构，官方例子完全够用 😛）：<a href="https://formilyjs.org/zh-CN/guide/scenes/edit-detail">https://formilyjs.org/zh-CN/guide/scenes/edit-detail</a></p>
</blockquote>
<h1 id="使用-JSON-Schema-还是-JSX-的方式写表单"><a href="#使用-JSON-Schema-还是-JSX-的方式写表单" class="headerlink" title="使用 JSON Schema 还是 JSX 的方式写表单"></a>使用 JSON Schema 还是 JSX 的方式写表单</h1><p>可以先看一下 <a href="https://react.formilyjs.org/zh-CN/guide/architecture">@formily/react 的架构图</a>：</p>
<p><img src="/./@formily-react%E7%9A%84%E6%9E%B6%E6%9E%84%E5%9B%BE.png" alt="formily-react-架构图"></p>
<blockquote>
<p>可以从架构图中可以得出渲染时 Markup Schema 会转换为 JSON Schema 再转换为 JSX 的方式进行渲染，所以 JSX 是最终的运行时状态。<br>纯 JSX 方式是性能最好的，因为没有表达式编译。（来自于 formily 作者的答疑解惑）</p>
</blockquote>
<p>使用 JSON Schema 方式写表单的好处：</p>
<ul>
<li><p>易于平台移植，比如说可以从 React 迁移到 Vue 或其他平台。</p>
</li>
<li><p>没有特殊限制，使用纯数据格式，在 JS / TS 文件中写也能友好支持。<br>使用 JSX 方式写表单的好处：</p>
</li>
<li><p>编码时有良好的编码提示，易于查找问题，便于维护。</p>
</li>
<li><p>符合组件编码和代码组织习惯。</p>
</li>
<li><p>易于组件拆分，样式和字段组合更加灵活，更便于复杂的样式和数据结构组织</p>
</li>
</ul>
<p>对于复杂的数据结构，JSON Schema 需要结合 JSX（<a href="https://react.formilyjs.org/zh-CN/api/components/recursion-field">使用 RecursionField 组件</a>） 的方式组织组件结构，JSX 在这方面就更加灵活。如果只是前端使用到表单结构更加推荐使用 JSX 的方式组织表单组件。</p>
<blockquote>
<p>JSON Schema 结合 RecursionField 组件的方式 demo 参考地址：<a href="https://formilyjs.org/zh-CN/guide/advanced/controlled#schema-%E7%89%87%E6%AE%B5%E8%81%94%E5%8A%A8%E8%87%AA%E5%AE%9A%E4%B9%89%E7%BB%84%E4%BB%B6">Schema 片段联动(自定义组件)</a><br>更多阅读：<a href="https://react.formilyjs.org/zh-CN/guide/concept#%E4%B8%89%E7%A7%8D%E5%BC%80%E5%8F%91%E6%A8%A1%E5%BC%8F">三种开发模式</a></p>
</blockquote>
<h1 id="使用-formily-Field-管理表单字段数据状态"><a href="#使用-formily-Field-管理表单字段数据状态" class="headerlink" title="使用 formily Field 管理表单字段数据状态"></a>使用 formily Field 管理表单字段数据状态</h1><blockquote>
<p>demo 参考链接：<a href="https://formilyjs.org/zh-CN/guide/scenes/edit-detail#%E7%BA%AF-jsx-%E6%A1%88%E4%BE%8B">编辑详情</a><br>自定义组件参考：<a href="https://formilyjs.org/zh-CN/guide/advanced/custom#%E5%AE%9E%E7%8E%B0%E8%87%AA%E5%AE%9A%E4%B9%89%E7%BB%84%E4%BB%B6">实现自定义组件</a><br>在 formily 中使用自定义组件</p>
</blockquote>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 组件库组件：formily 连接 input 组件能力，使用 input 组件管理 Field 状态</span>
<span class="token keyword">const</span> FormInput <span class="token operator">=</span> <span class="token function">connect</span><span class="token punctuation">(</span>
  Input<span class="token punctuation">,</span>
  <span class="token function">mapProps</span><span class="token punctuation">(</span><span class="token punctuation">(</span>props<span class="token punctuation">,</span> field<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>
      <span class="token operator">...</span>props<span class="token punctuation">,</span>
      suffix<span class="token operator">:</span> <span class="token punctuation">(</span>
        <span class="token operator">&lt;</span>span<span class="token operator">></span>
          <span class="token punctuation">&#123;</span>field<span class="token operator">?.</span><span class="token punctuation">[</span><span class="token string">'loading'</span><span class="token punctuation">]</span> <span class="token operator">||</span> field<span class="token operator">?.</span><span class="token punctuation">[</span><span class="token string">'validating'</span><span class="token punctuation">]</span> <span class="token operator">?</span> <span class="token punctuation">(</span>
            <span class="token operator">&lt;</span>LoadingOutlined <span class="token operator">/</span><span class="token operator">></span>
          <span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token punctuation">(</span>
            props<span class="token punctuation">.</span>suffix
          <span class="token punctuation">)</span><span class="token punctuation">&#125;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">></span>
      <span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">mapReadPretty</span><span class="token punctuation">(</span>PreviewText<span class="token punctuation">.</span>Input<span class="token punctuation">)</span>
<span class="token punctuation">)</span>

<span class="token comment">// 业务组件</span>
<span class="token keyword">const</span> DateSelect <span class="token operator">=</span> <span class="token function">observer</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> parentField <span class="token operator">=</span> <span class="token function">useField</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token punctuation">&#123;</span><span class="token comment">/* 业务组件中使用组件库组件管理 Field 状态 */</span><span class="token punctuation">&#125;</span>
    <span class="token operator">&lt;</span>Field 
      name<span class="token operator">=</span><span class="token string">"date"</span> 
      basePath<span class="token operator">=</span><span class="token punctuation">&#123;</span>parentField<span class="token punctuation">.</span>address<span class="token punctuation">&#125;</span> 
      component<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">[</span>DatePicker<span class="token punctuation">]</span><span class="token punctuation">&#125;</span>
    <span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 业务组件</span>
<span class="token keyword">const</span> <span class="token function-variable function">NameInput</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token comment">// "叶子"数据用 Field 组件管理</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span><span class="token operator">></span>
      <span class="token operator">&lt;</span>Field
        name<span class="token operator">=</span><span class="token string">"firstName"</span>
        component<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">[</span>FormInput<span class="token punctuation">]</span><span class="token punctuation">&#125;</span>
        required
      <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&lt;</span>Field
        name<span class="token operator">=</span><span class="token string">"lastName"</span>
        component<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">[</span>FormInput<span class="token punctuation">]</span><span class="token punctuation">&#125;</span>
        required
      <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 业务组件</span>
<span class="token comment">// 这种组件中的数据值脱离了 formily Field 的状态管理，需要手动进行状态管理</span>
<span class="token keyword">const</span> <span class="token function-variable function">ConditionSelect</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
  value<span class="token punctuation">,</span>
  onChange
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token comment">// 手动设置 Field 数据值</span>
  <span class="token function-variable function">onItemChange</span> <span class="token operator">=</span> <span class="token punctuation">(</span>itemValue<span class="token punctuation">,</span> itemIndex<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// 可以做其他的复杂的数据处理，这里只是一个简单的演示</span>
    <span class="token keyword">const</span> newValule <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">...</span>value<span class="token punctuation">]</span><span class="token punctuation">;</span>
    newValue<span class="token punctuation">[</span>itemIndex<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
      <span class="token operator">...</span>newValue<span class="token punctuation">[</span>itemIndex<span class="token punctuation">]</span><span class="token punctuation">,</span>
      value<span class="token operator">:</span> itemValue<span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span>
    <span class="token function">onChange</span><span class="token punctuation">(</span>newValue<span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div<span class="token operator">></span>
      <span class="token operator">&lt;</span>div<span class="token operator">></span>复杂的样式 <span class="token operator">&amp;</span> 数据逻辑<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
      <span class="token punctuation">&#123;</span>value<span class="token operator">?.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>item<span class="token punctuation">,</span> index<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
          <span class="token keyword">return</span> <span class="token punctuation">(</span>
            <span class="token operator">&lt;</span>Input key<span class="token operator">=</span><span class="token punctuation">&#123;</span>item<span class="token punctuation">.</span>id<span class="token punctuation">&#125;</span> value<span class="token operator">=</span><span class="token punctuation">&#123;</span>item<span class="token punctuation">.</span>value<span class="token punctuation">&#125;</span> onChange<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">onItemChange</span><span class="token punctuation">(</span>e<span class="token punctuation">,</span> index<span class="token punctuation">)</span><span class="token punctuation">&#125;</span> <span class="token operator">/</span><span class="token operator">></span>
          <span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span> 
      <span class="token punctuation">&#125;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">const</span> <span class="token function-variable function">DemoForm</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token comment">// ...</span>
    <span class="token operator">&lt;</span>FormProvider form<span class="token operator">=</span><span class="token punctuation">&#123;</span>form<span class="token punctuation">&#125;</span><span class="token operator">></span>
      <span class="token punctuation">&#123;</span><span class="token comment">/* 这种方式为使用组件库组件连接 formily Field */</span><span class="token punctuation">&#125;</span>
      <span class="token operator">&lt;</span>Field
        name<span class="token operator">=</span><span class="token string">"username"</span>
        title<span class="token operator">=</span><span class="token string">"用户名"</span>
        required
        decorator<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">[</span>FormItem<span class="token punctuation">]</span><span class="token punctuation">&#125;</span>
        component<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">[</span>FormInput<span class="token punctuation">]</span><span class="token punctuation">&#125;</span>
      <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&lt;</span>ObjectField
        name<span class="token operator">=</span><span class="token string">"name"</span>
        title<span class="token operator">=</span><span class="token string">"姓名"</span>
        decorator<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">[</span>FormItem<span class="token punctuation">]</span><span class="token punctuation">&#125;</span>
        component<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">[</span>NameInput<span class="token punctuation">]</span><span class="token punctuation">&#125;</span>
      <span class="token operator">/</span><span class="token operator">></span>
      <span class="token punctuation">&#123;</span><span class="token comment">/* 具体写法可以参考 sugar-design 的 RadioGroup */</span><span class="token punctuation">&#125;</span>
      <span class="token operator">&lt;</span>Field
        name<span class="token operator">=</span><span class="token string">"birthday"</span>
        title<span class="token operator">=</span><span class="token string">"生日"</span>
        required
        decorator<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">[</span>FormItem<span class="token punctuation">]</span><span class="token punctuation">&#125;</span>
        component<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">[</span>FormRadioGroup<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>
          options<span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">&#123;</span>
              label<span class="token operator">:</span> <span class="token operator">&lt;</span>DateSelect <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">,</span>
              value<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
            <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
            <span class="token punctuation">&#123;</span>
              label<span class="token operator">:</span> <span class="token string">'保密'</span><span class="token punctuation">,</span>
              value<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
            <span class="token punctuation">&#125;</span>
          <span class="token punctuation">]</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span>
      <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&lt;</span>Field
        name<span class="token operator">=</span><span class="token string">"conditionSelect"</span>
        title<span class="token operator">=</span><span class="token string">"条件选择"</span>
        required
        decorator<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">[</span>FormItem<span class="token punctuation">]</span><span class="token punctuation">&#125;</span>
        component<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">[</span>ConditionSelect<span class="token punctuation">]</span><span class="token punctuation">&#125;</span>
      <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>FormProvider<span class="token operator">></span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>以上片段只是组织表单方式的一种，还有其他很多种方式大家可以参考官方文档</p>
</blockquote>
<p>“叶子”字段值不使用 Field 管理状态的好处：</p>
<ul>
<li><p>简单，“叶子”字段值可以在数据 onChange 时做很多复杂的工作</p>
</li>
<li><p>用不明白 formily 的状态管理时，可以使用自定义业务组件去控制数据状态</p>
</li>
<li><p>自定义业务组件可以实现很复杂的样式和复杂的数据结构<br>“叶子”字段值使用 Field 管理状态的好处：</p>
</li>
<li><p>可以使用 form.query 获取到字段的 Field 实例</p>
</li>
<li><p>可以使用 field effect hooks 进行字段监听</p>
</li>
</ul>
<h2 id="formily-Field-数据颗粒度"><a href="#formily-Field-数据颗粒度" class="headerlink" title="formily Field 数据颗粒度"></a>formily Field 数据颗粒度</h2><p>如果是复杂的数据结构且需要监听到”叶子”字段的数据变动，就需要使用 formily Field 管理数据。</p>
<blockquote>
<p>这种情况需要灵活运用 VoidField、ArrayField、ObjectField 组件对 Field 组件的包裹，也需要注意 field path 的设置，Field 组件也能包裹 Field 组件但是需要指定 field 的 basePath，不然 formily 无法找到被包裹的 Field 的正确路径。<br>其中，引入 void，代表一个虚数据节点，表示该节点并不占用实际数据结构。</p>
</blockquote>
<p>如果是复杂的数据结构且不监听内部”叶子”字段，就可以不使用 Field 管理“叶子”字段值。</p>
<blockquote>
<p>在线 demo：<a href="https://codesandbox.io/s/field-manage-data-9zmu5f?file=/App.tsx">https://codesandbox.io/s/field-manage-data-9zmu5f?file=/App.tsx</a></p>
</blockquote>
<h1 id="Field-display-的-visible、hidden、none-区别"><a href="#Field-display-的-visible、hidden、none-区别" class="headerlink" title="Field display 的 visible、hidden、none 区别"></a>Field display 的 visible、hidden、none 区别</h1><h2 id="显隐规则"><a href="#显隐规则" class="headerlink" title="显隐规则"></a><a href="https://core.formilyjs.org/zh-CN/guide/field#%E6%98%BE%E9%9A%90%E8%A7%84%E5%88%99">显隐规则</a></h2><p><img src="/./%E6%98%BE%E9%9A%90%E5%B1%9E%E6%80%A7%E7%9A%84%E5%86%99%E8%A7%84%E5%88%99.png" alt="显隐属性的写规则"></p>
<p><strong>显隐属性的读规则</strong></p>
<p><strong>继承逻辑：</strong></p>
<p>如果父节点主动设置了 display 属性，子节点没有主动设置 display 属性，那么子节点会继承父节点的 display。</p>
<p>主动设置 display ：</p>
<ul>
<li>给字段配置了初始化属性 display/visible/hidden</li>
<li>如果初始化时没有配置，但是在后期又给字段设置了 display/visible/hidden<br>如果希望子节点从不继承变为继承，可以把 display 设置为 null。</li>
</ul>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 设置 父节点 ArrayField display 为 hidden</span>
form<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string">"test4"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">take</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?.</span><span class="token function">setDisplay</span><span class="token punctuation">(</span><span class="token string">"hidden"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 子节点默认的继承父节点 display</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>form<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string">"test4.0"</span><span class="token punctuation">)</span><span class="token operator">?.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'display'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 'hidden'</span>

<span class="token comment">// 设置 第一个子节点 Field display 为 none (不继承父节点的 display)</span>
form<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string">"test4.0"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">take</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?.</span><span class="token function">setDisplay</span><span class="token punctuation">(</span><span class="token string">"none"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>form<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string">"test4.0"</span><span class="token punctuation">)</span><span class="token operator">?.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'display'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 'none'</span>

<span class="token comment">// 子节点从不继承变为继承父节点的 display</span>
form<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string">"test4.0"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">take</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?.</span><span class="token function">setDisplay</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 和 setDisplay('visible') 效果一样</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>form<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string">"test4.0"</span><span class="token punctuation">)</span><span class="token operator">?.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'display'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 'hidden'</span>

<span class="token comment">// 设置 父节点 ArrayField display 为 none</span>
form<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string">"test4"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">take</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?.</span><span class="token function">setDisplay</span><span class="token punctuation">(</span><span class="token string">"none"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 查询 父节点 display</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>form<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string">"test4"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"display"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 'none'</span>
<span class="token comment">// 查询 父节点 value</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>form<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string">"test4"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// undefined</span>
<span class="token comment">// 查询 第一个子节点 Field display</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>form<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string">"test4.0"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"display"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 'undefined'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="设置-field-display-的方式有："><a href="#设置-field-display-的方式有：" class="headerlink" title="设置 field display 的方式有："></a>设置 field display 的方式有：</h2><ul>
<li><a href="https://core.formilyjs.org/zh-CN/api/models/field#setdisplay">field.setDisplay(‘none/visible/hidden’)</a></li>
<li>field.display = ‘none/visible/hidden’</li>
<li>field.setState((state) =&gt; state.diaplay = ‘none/visible/hidden’)</li>
<li>field.visible = true/false</li>
<li>field.setState((state) =&gt; state.visible = true/false)</li>
<li>field.hidden = true/false</li>
<li>field.setState((state) =&gt; state.hidden = true/false)<blockquote>
<p>其中设置 visible 为 false 时 display 为 none ：<br><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAXAAAADECAYAAACGNXroAAAgAElEQVR4AazBCdS2d0Ef6Ov3JSgOIewIKCTa4fvSqaiAxAoYREGrESkSK4TFFkJBgVGROBJEEWWYGapwSgguM4ILOEfBKtOxoOcoso0QEjaDQMKeRIVAixI2yfOb+77/77N8b54vSc/hutLVqhJKQ9x0RcyqIk6giP1aEkpD3HRFzKoiTqCI/VoSSkPcdEXMqiJOoIj9WhJKQ9x0RcyqIk6giP1aEkpD3HRFzKoiTqCI/VoSSkPcdEXMqiJOoIj9WhJKQ9x0RcyqIk6giP1aEkpD3HRFzKoiTqCI/VoSSkPcdEXMqiJOoIj9WhJKQ9x0RcyqIk6giP1aEkpD3HRFzKoiTqCI/VoSSkPcdEU6cUgRJ1BbsUcRSkPs0RKT2KeIE6it2KMIpSH2aIlJ7FPECdRW7FGE0hB7tMQk9iniBGor9ihCaYg9WmIS+xRxArUVexShNMQeLTGJfYo4gdqKPYpQGmKPlpjEPkWcQG3FHkUoDbFHS0xinyJOoLZijyKUhtijJSaxTxEnUFuxRxFKQ+zREpPYp4gTqK3YowilIfZoiUnsU8QJ1FbsUYTSEHu0xCT2KeIEaiscsVGLEpPaLyU0FnVIYxGiNmorQdSuWpSY1H4pobGoQxqLELVRWwmidtWixKT2SwmNRR3SWISojdpKELWrFiUmtV9KaCzqkMYiRG3UVoKoXbUoMan9UkJjUYc0FiFqo7YSRO2qRYlJ7ZcSGos6pLEIURu1lSBqVy1KTGq/lNBY1CGNRYjaqK0EUbtqUWJS+6WExqIOaSxC1EZtJYjaVYsSk9ovJTQWdUhjEaI2aitB1K5alJjUfimhsahDGosQtVFbCaJ21aLEpPZLCY1FHdJYhKiN2koQtasWJSa1X0poLNKJHUUUsU8Ru4rYKmJWxKQIirhBRRSxTxG7itgqYlbEpAiKuEFFFLFPEbuK2CpiVsSkCIq4QUUUsU8Ru4rYKmJWxKQIirhBRRSxTxG7itgqYlbEpAiKuEFFFLFPEbuK2CpiVsSkCIq4QUUUsU8Ru4rYKmJWxKQIirhBRRSxTxG7itgqYlbEpAiKuEFFFLFPEbuK2CpiVsSkCIq4QUUUsU8Ru4rYKmJWxKQIirhBRRSxTxG7itgqYlbEpAiKuEFFFLFPEVtHKDWUmEXtqqHisFirWahJxYEYUkN98Ytf8MQnPtFv/dbLKG9+85s98d8/0d/8zXsQtauGisNirWahJhV85KMfcfb3n+3ss8/2/d//fd73vvehqKHU4n3vfb//8PznO/eR53r6+eebvfNd7/Rnf/anhorh8ssv95rXvMYXv/hP1moWalJxIDz//3i+7//+73P22Wd79rN/HjWUGkpw4Ysu9B9f9CJbNVRsveY1r/G4xz3e2h/98R970pOe5JpPXIN6xs/8jOf/h+cTQ2ooaig1lJhF7aqh4rBYq1moScWBGFJDUUOpocQsalcNFYfFWs1CTSoOxJAaihpKDSVmUbtqqDgs1moWalJxIIbUUNRQaigxi9pVQ8VhsVazUJOKAzGkhqKGUkOJWdSuGioOi7WahZpUHIghNRQ1lBpKzKJ21VBxWKzVLNSk4kAMqaGoodRQYha1q4aKw2KtZqEmFQdiSA1FDaWGErOoXTVUHO8I0RhiI2ooYoi1toaqISalMQk1qa0YYrXida97nfe//3INH//4x73uL1/n0//t02ZRQxFDrLU1VA0xKY1JKHe8w+094xkX+JEf+RGXf+ADPvu5zyOIIRqLp/3UT3rHO97hof/6Yf7V93y32aWXXOIpT3mqv/3bv0OsvehFL/Kc5zzHV9zsZDXEpDQmoSY1e8gPPMTPXHCBW9/6Nj72sSsRQzSGWFzxgQ/6wBWXG4oYYq2tT3ziE978pjeq4aMf+ai/+PPX+dwXvoB4/V++3tsvvcRWDEEM0RhiI2ooYoi1Zz3rWR772MeiaohJaUxCTWorhiCGaAyxETUUMcRaW0PVEJPSmISa1FYMQQzRGGIjaihiiLW2hqohJqUxCTWprRiCGKIxxEbUUMQQa20NVUNMSmMSalJbMQQxRGOIjaihiCHW2hqqhpiUxiTUpLZiCGKIxhAbUUMRQ6y1NVQNMSmNSahJbcUQxBCNITaihiKGWGtrqBpiUhqTUJPaiiGIIRpDbEQNRQyx1tbsZJPYJ2YVQUtCS0ISi0ZiK8SBUBEHipgUNQtiEofErCJoSWhJSGLRSGyFOBBu/lW3cP/738+HPvQhVhxRFLEWXP23V7viiiv8zu/8jjPPPNPa/b792/nf/ndvfevFHvrQh2jp6jpvfOMbPfShD8URsSPEgVARnHHGGZRX/9Ef++SnPmlXHO+FL3yBtYqgJaElIYlFj4i1Eo6oRVg1NoqYFLEW+8SsImhJaElYrVauu+46GomtEAdCRRwoYlLEWuwTs4qgJaElIYlFI7EV4kCoiANFTIpYi31iVhG0JLQkJLFoJLZCHAgVcaCISRFrsU/MKoKWhJaEJBaNxFaIA6EiDhQxKWIt9olZRdCS0JKQxKKR2ApxIFTEgSImRazFPjGrCFoSWhKSWDQSWyEOhIo4UMSkiLXYJ2YVQUtCS0ISi0ZiK8SBUBEHipgUsRb7xKwiaEloSUhidqRmtWgdFkNikdhRYlGTUseLrcakCEJYCSpF67C/+PM/95SnPsU/P+Oo+973vn76/Kfbqs9/4fOe97znOesBD3Cve97LE5/0RFdffbW1OJBoqCLW3vu+93v4OQ/3uH/772g961nP8vAfOsdP/uRPmN39n/2P7nTnO3nLX73ZLOGy97zHtZ+91gMecBbhc5/7nGdccIEHnPUAR48dc/bZZ/v1X/s1q9VKbDVUEWs1q9lFL36xRz7yXI8895Fe8MIXmMWQ8JGPfMS/+7c/4tixYx557iN98IMf0NSsJqWoAyW2GpO66CW/6uHn/JCLXnKRmtWidVgMicULX/gC55xzjv/ymv/ibW+72Dk/dI5zzjnHRS95CaWGn/jxH/fbv/07Lnrxiz3oQQ9yr3vf26//n7+BevX/85/9+yc+yaxm9aNPepI/fNWrrH3hC5/3vOc9z3c84AHude97+bEffaKrr75aYkeJRU1KHS+2GpMi1mpWi9ZhMSQWiR0lFjUpdbzYakyKWKtZLVqHxZBYJHaUWNSk1PFiqzEpYq1mtWgdFkNikdhRYlGTUseLrcakiLWa1aJ1WAyJRWJHiUVNSh0vthqTItZqVovWYTEkFokdJRY1KXW82GpMilirWS1ah8WQWCR21Mkxi1kTMbQkFClij6CImIQ4kYoglJNPPsmjH/Uo3/RN34w47fTTPeoxj3GnO93JrOXv/u5vPelHf8zDH/YwL/2tl/nMP17rta99ra348R//n1188duc94Tz3OmOX+3/+s2XOv+nz/fy3325XelKzEIRk7rLne/kqU95qo997GN+8Zd+ybnnnuv0007zVf/DLSwSD/6uB/uT1/yJtpJ4y1veQjnzzH+J+uxnP+vqq6/ytKf9pDvc4au9411v98sv+BU5csQTnvAEQ0UQ6kBFELP7P+Asdz961K//2q+54vIPmBUp1/U6j3/84332s5/17J9/tkvffqlXvOL/Rs2Cb/zGe3jMox7jlFueYvbDj/hht7rVrQwVQVz50Y/563e/yz8/dncxi1kTMbQkFCli8d3f/d3uec97+u3f/m1XXXW1pzzlyYg73+XOhBj+5n3v9fo3vMHNb35zj3rUo9zutrfxsSuvQnz87/7e2y5+KyqCeOe73uUe3/xN1p761B/3trdd7PHnPcGd7nhHv/my33T++ed7+ctfbisoIiYhTqQiCEVMKoKYNRFDS0KRIvYIiohJiBOpCEIRk4ogZk3E0JJQpIg9giJiEuJEKoJQxKQiiFkTMbQkFClij6CImIQ4kYogFDGpCGLWRAwtCUWK2CMoIiYhTqQiCEVMKoKYNRFDS0KRIvYIiohJiBOpCEIRk4ogZk3E0JJQpIg9QvdadbbqTbPqbNW1VSerXs+qW6vekFVnb3rTm3v06NFecukl3eed73xnjx091le+6lVtV51ddtllvfvRo/3Ihz7cXR/84Ad796NH+/Z3vL2zVY/33ve9t0ePHu17Lrus7aqzVYe/fP1f9u5Hj/b9739/Z4997GN73nnndW3V2aprq7aPffRj+rjHPa67Vm2ffv7T+7jHPa6rntiTn/xjffKTn9xVt974pjf16N2P9rWvfW3XHvKQh/TY0WNddbbq2qqTVa9n1eHCCy/sv37Yw3rhhRd2v1Vnq57YBRdc0HPPPbezVWerrq3afs+Dv7tHjx7tp//h011bdfiN3/iNfvM979ld33bfb+tLLrqos3e+8x09evRoX/nKV3Xtsssu69G7H+2HP/zhHrbqbNW1VSerXs+qW6vekFVnq940q85WXVt1sur1rLq16g1ZdbbqTbPqbNW1VSerXs+qW6vekFVnq940q85WXVt1sur1rLq16g1ZdbbqTbPqbNW1VSerXs+qW6vekFVnq940q85WXVt1sur1rLq16g1ZdbbqjTtSs9qoSVCxTx0Ws6BmUWKjhtiKWdWsNmoS1H3uc2+3u93tnff48zz96U/3yle+yuc//zlrV1xxuaYueMYFjh07w7FjR/3gDz5M1Bve9CZrNYsgtYhZ1awUoQ2CiuHM+5wpuPjit/n85z/nr97yVx74wO+0Frz85a9w9tnf54wzjjnj2FF/9da3+vSnP21WQ5BaxKxqVhsljqBi66orryTxL/7F/2TtPvf5Fk3FLKhZlNioIYYnP/nJ/tMf/qEnP/nH1Kw2ahJU7FNDrMUsqFlUE9/6rd/q1FueqobYilnVrKxoUD5wxQdRz3zmMxw7doZjx4552MMeRuKNb3yDw2IW1CxKbNQQWzGrmtVGTYKKfeqwmAU1ixIbNcRWzKpmtVGToGKfOixmQc2ixEYNsRWzqllt1CSo2KcOi1lQsyixUUNsxaxqVhs1CSr2qcNiFtQsSmzUEFsxq5rVRk2Cin3qsJgFNYsSGzXEVsyqZrVRk6Bin9p1csxiIxYVsVYVMQtFHCgNoY3EJIYi4kARkyKImMVGLCpudrOv8Kd/+lp/9Ef/yev+8vWe+cxn+pVf+WWv+4vX+Yqv/Apf+OI/Sev3f/8P3Oo2t9YVMcnKbW57WxQRs1JqVgQRs5i1SM0qYrj5zb/Sdzzwgd74xjc6/fTTWHG/+93XUG9+0//nOb/4i857/BP84nOe6/Z3uK1f+IXn+K//9VNmcaDUJDVEzGIjVFVs1Zeu+5LZV37lzSnCV978q6SlCG0kJjEUEQeKmBRBxCw2YlERa1URs1CTGkpDaCMxCeoe9/gGszhQBKkhYhaf/8LnKcIXvvgFFX/w+3/gVre6FaqII25zm1tTxIHSENpITGIoIg4UMSmCiFlsxKIi1qoiZqGIA6UhtJGYxFBEHChiUgQRs9iIRUWsVUXMQhEHSkNoIzGJoYg4UMSkCCJmsRGLiliripiFIg6UhtBGYhJDEXGgiEkRRMxiIxYVsVYVMQtFHCgNoY3EJIYi4kARkyKImMVGLCpirSpiFoo4UBpCG4lJDEXEgSImRRAxi41YVMRaVcQsFLE4uYjrSxEHIoYisVGRUCRFFDGLoQixKGJWFXF9KcIpp5zi0Y9+jEc/+jHe8IY3ePx553nrxW91//vf39edfrqVWK2+5G53u5sooohddetb35rw8Y9/QhGzqoghsZEiDsR3PfCBnvVzP+dup93V6V93utNOO82s4k/+5P9129ve1vnn/ySO+OI/fcnb3/52p59+uqEI4fa3v713vuudhqqI6ztSO+Jr7nwX1Hv+5j3O+vazzN5x6duthFAkRRQxi6EIsXjlq17l0kve7t73vqcffPg54vpSxIGIoUi42c1u5tP/7dMqEoqkiBqSI4YixOIOd7ija6/9rM985h/d4pRb+vCHPuzaa68lFqeffroj5brrrnPaaafZVcf7tV//DX939dW+80EP8u33vx+iiFkMRYhFEbOqiOtLEQcihiKxUZFQJEUUMYuhCLEoYlYVcX0p4kDEUCQ2KhKKpIgiZjEUIRZFzKoiri9FHIgYisRGRUKRFFHELIYixKKIWVXE9aWIAxFDkdioSCiSIoqYxVCEWBQxq4q4vhRxIGIoEhsVCUVSRBGzGIoQiyJmVRHXlyIORAxFYuOIRc1qUkNMSmtRi1grJYaYxSy2WpOoWktjiKFmNakhXHLJ27z8d3/XlVde6eN//3EXX3yxiLvc5S6o+3zLfZxxxhme+bPP8p9f/WrXXPNJ7373u/2vz32ua665xqw1iVvf5tbuda97ednLftPFb3mr97/vfYihIlo0FjEprdl973s/s5f+5ss8+MEPQinBv/y2b/OpT37S61//RpdffrlfePbPu/baa81ak6ianXXWWT7yoQ/7vVe8wmWXvcenPvUp1HVfus5VV1/t6qv+1uc+/znXfu6zrr76KldfdZUvfelLzjzzW93iFrfwkot+1Tve8XYve9lLXXLJJZKYxSxmsdWaRNXapW+71B++6pUuvfRSQ81qUkNMSmtRixjuetevdfnll3v1q1/tQx/6kE9ecw1iFlutSVSt3fObvlnUS1/6Mn/915d54Qt+GdGGcp8z7+PoGcf87M8+06v/+I9dc8013v2ud3vuc5/rk9d80lDKn/3Zn3nF7/2eK97/fsQstlqTqFpLY4ihZjWpISaltahFrJUSQ8xiFlutSVStpTHEULOa1BCT0lrUItZKiSFmMYut1iSq1tIYYqhZTWqISWktahFrpcQQs5jFVmsSVWtpDDHUrCY1xKS0FrWItVJiiFnMYqs1iaq1NIYYalaTGmJSWotaxFopMcQsZrHVmkTVWhpDDDWrSQ0xKa1FLWKtlJNjKyapihQJMcSkKmLSEJMiFkWKWEssIvaJrZikKlK++KUv+eUX/Irn/NIvUr7u9NP83M//nK//+q+nnHTySS668ELP/NlnefpPn8+KpL7hHt/o5JNPMkssIi644AIvecmvesxjHuMWp9zSpZdeIoaqmGSlSJEQi6+969f6utNP88EPf8RZ334WDTGpBz3owb7nX32PJ5z3BEl90zff0/d+7/f66Ec/KrGImH3Lt9zHTz3tp7zowhf75Cev8fPPfrZzH/kIV3zgCj/wAz+AqjhSHvid32n26le/2rGjx7z4whf5sac81SN++BFavuOB3+Hit77VRpEi1hKLiLWECiK2YpKqSJEQQ0yqIvihc/6N9773fX76/KfjiB9+xL/xnGc/hxQxVGIRsXa3u53mMY/9ERdeeKEXXXihcx/5CLe93W0dCVJHcpKLXnyRZz7rmc7/X37aonzjPb7BSSefZNEQPvHxv0fc8U5fTZEi1hKLiH1iKyapihQJMcSkKmLSEJMiFkWKWEssIvaJrZikKlIkxBCTqohJQ0yKWBQpYi2xiNgntmKSqkiREENMqiImDTEpYlGkiLXEImKf2IpJqiJFQgwxqYqYNMSkiEWRItYSi4h9YismqYoUCTHEpCpi0hCTIhZFilhLLCL2ia2YpCpSJMQQk6qISUNIV63YUcSiSBE1xFoRsyIoYp8iihiKmBSxo4hFWfU6f//3H1fc+c53FmtFzIprP/MZH//EJ9z+drdz6qmnOl4RRQxFTIrYUcSiSBE1xFoRsyL49D/8gy/90z+53e1u53hFFDEUMSliRxGLIkXUsLruOldeeaWv/Zq7OOnkm5kVQRH7FFHEUMSkiB1FLIoUUUOsFTErgiL2KaKIofjMP/wjrVve6lRbRSzKZ679R9d84hq3ud3tnHrqqWKtPnblVR78Xd/la+56V3/62tc6ctJJYp8iihiKmBSxo4hFkSJqiLUiZkVQxD5FFDEUMSliRxGLIkXUEGtFzIqgiH2KKGIoYlLEjiIWRYqoIdaKmBVBEfsUUcRQxKSIHUUsihRRQ6wVMSuCIvYpooihiEkRO4pYFCmihlgrYlYERexTRBFDEZMidhSxKFJEDbFWxMlCEZMisRGTUBJbRWItRSqCIhShiFASG2lJCEVMisRGOJKT3PlOdya2isRayimn3MIpp5yCWhShiFASG2lJCEVMisRGTEJJbBWJtRSpW516KmpRhCJCSWykJSEUMSkSGzEJJbE46aSTnHa304iNFKkIilCEIkJJbKQlIRQxKRIbMQklsVUk1lKkIihCEYoIJbGR1i1PvaVZEZMisRFOOeWWTrnFLYmtInHpJZconvYTT3PSSUcMRShCEaEkNtKSEIqYFImNmISS2CoSaylSERShCEWEkthIS0IoYlIkNmISSmKrSKylSEVQhCIUEUpiIy0JoYhJkdiISSiJrSKxliIVQRGKUEQoiY20JIQiJkViIyahJLaKxFqKVARFKEIRoSQ20pIQipgUiY2YhJLYKhJrKVIRFKEIRYSS2EhLQihiUiQ2YhJKYqtIzNIZYr8iZkXsU6SIHUUsWhKHFUER+xUxK2KfIkXsKGLRkjisCIrYr4hZEfsUKWJHEYuWxGFFUMR+RcyK2KdIETuKWLQkDiuCIvYrYlbEPkWK2FHEoiVxWBEUsV8RsyJ2fexjH3PlVVc688xvdVKOEDuKWLQkDiuCIvYrYlbEPkWK2FHEoiVxWBEUsV8RsyL2KVLEjiIWLYnDiqCI/YqYFbFPkSJ2FLFoSRxWBEXsV8SsiH2KFLGjiEVL4rAiKGK/ImZF7FOkiB1FLFoShxVBEfsVMSvisHTVij2K2FXEjShNRexVxFYRexSxq4gbUZqK2KuIrSL2KGJXETeiNBWxVxFbRexRxK4ibkRpKmKvIraK2KOIXUXciNJUxF5FbBWxRxG7irgRpamIvYrYKmKPInYVcSNKUxF7FbFVxB5F7CriRpSmIvYqYquIPYrYVcSNKE1F7FXEVhF7FLGriBtRmorYq4itIvYoYlcRN6I0FbFXEVtF7FHEriKOd0Ts11irWcWOGmpSVA0RdUipSQytRezXWKtZxY4aalJUDRF1SKlJDK1F7NdYq1nFjhpqUlQNEXVIqUkMrUXs11irWcWOGmpSVA0RdUipSQytRezXWKtZxY4aalJUDRF1SKlJDK1F7NdYq1nFjhpqUlQNEXVIqUkMrUXs11irWcWOGmpSVA0RdUipSQytRezXWKtZxY4aalJUDRF1SKlJDK1F7NdYq1nFjhpqUlQNEXVIqUkMrUXs11irWcWOGmpSVA0RdUipSQytRezXWKtZxY4aalJUDRF1SKlJDK1F7NdYq1nFjlqkXZVYFPHlUQRFHKeItSIWRXx5FEERxylirYhFEV8eRVDEcYpYK2JRxJdHERRxnCLWilgU8eVRBEUcp4i1IhZFfHkUQRHHKWKtiEURXx5FUMRxilgrYlHEl0cRFHGcItaKWBTx5VEERRyniLUiFkV8eRRBEccpYq2IRRFfHkVQxHGKWCtiUcR/lyOEGuJ4NamNOlBrNdRWTWKIQyp2hRrieDWpjTpQazXUVk1iiEMqdoUa4ng1qY06UGs11FZNYohDKnaFGuJ4NamNOlBrNdRWTWKIQyp2hRrieDWpjTpQazXUVk1iiEMqdoUa4ng1qY06UGs11FZNYohDKnaFGuJ4NamNOlBrNdRWTWKIQyp2hRrieDWpjTpQazXUVk1iiEMqdoUa4ng1qY06UGs11FZNYohDKnaFGuJ4NamNOlBrNdRWTWKIQyp2hRrieDWpjTpQazXUVk1iiEMqdoUa4ng1qY06UGtHahJqq4bGJDbiQAwVQ9RarFVro2axqyahtmpoTGIjDsRQMUStxVq1NmoWu2oSaquGxiQ24kAMFUPUWqxVa6NmsasmobZqaExiIw7EUDFErcVatTZqFrtqEmqrhsYkNuJADBVD1FqsVWujZrGrJqG2amhMYiMOxFAxRK3FWrU2aha7ahJqq4bGJDbiQAwVQ9RarFVro2axqyahtmpoTGIjDsRQMUStxVq1NmoWu2oSaquGxiQ24kAMFUPUWqxVa6NmsasmobZqaExiIw7EUDFErcVatTZqFrtqEmqrhsYkNuJADBVD1FqsVev/Zw/Ow34vCDph35+TIiq4AY3NOCEuB9cKzCV1dKa6cktzOS4pjU6Ob9ahxXIrNfG9rhktRdGU1BqtrpZ5e92yZtwmBRf0bZEcNUNBBbcSUUMQAvl93u/yfH/P7zk8B87gv973Wo1iUw1CbatZYxBrsSVmlQ4UMSjiuipiUBpiUYQiRcyKUMSgiOuqiEFpiEURihQxK0IRgyKuqyIGpSEWRShSxKwIRQyKuK6KGJSGWBShSBGzIhQxKOK6KmJQGmJRhCJFzIpQxKCI66qIQWmIRRGKFDErQhGDIq6rIgalIRZFKFLErAhFDIq4rooYlIZYFKFIEbMiFDEo4roqYlAaYlGEIkXMilDEoIjrqohBaYhFEYoUMStCEYMirqsiBqUhFkUoUsSsCEUMivg/sceWGsWotVajWqtZDaq2xaiE2BSTGEQtYlGjGLXWalRrNatB1bYYlRCbYhKDqEUsahSj1lqNaq1mNajaFqMSYlNMYhC1iEWNYtRaq1Gt1awGVdtiVEJsikkMohaxqFGMWms1qrWa1aBqW4xKiE0xiUHUIhY1ilFrrUa1VrMaVG2LUQmxKSYxiFrEokYxaq3VqNZqVoOqbTEqITbFJAZRi1jUKEattRrVWs1qULUtRiXEppjEIGoRixrFqLVWo1qrWQ2qtsWohNgUkxhELWJRoxi11mpUazWrQdW2GJUQm2ISg6hFLGoUo9ZajWqtZjWo2hajEmJTTGIQtYhFjWLUWqtRrdWsBrXHKMSG1CJGsZaapIjYUrPGrBZVm9LaIcSG1CJGsZaapIjYUrPGrBZVm9LaIcSG1CJGsZaapIjYUrPGrBZVm9LaIcSG1CJGsZaapIjYUrPGrBZVm9LaIcSG1CJGsZaapIjYUrPGrBZVmxYosEoAACAASURBVNLaIcSG1CJGsZaapIjYUrPGrBZVm9LaIcSG1CJGsZaapIjYUrPGrBZVm9LaIcSG1CJGsZaapIjYUrPGrBZVm9LaIcSG1CJGsZaapIjYUrPGrBZVm9LaIcSG1CJGsZaapIjYUrPGrBZVm9LaIcSG1CJGsZaapIjYUrPGrBZVm9LaIcSG1CJGsZaapIh0YFDE7orYUMRaETsVKWKHIrjiyiucvP9k9733ffzHJz3RBz7wQX/wB7/nl37xF93xTneyqYgNRawVsVORcv4F59v/c/tVUae+9GXucPzxRm0lMSo+ec453vpnb/Xhsz/s3/7bW/nN33yx0YfPPtuF//RPahCsyB7uf/9/7/DDD1fETkWK2KGIWVtJjIrYXRG8+Ddf7Iz3nsGKe9zz7p7//FOMitjpFb/1W1J+/hd+3qYiZm299CWnynft8bRf/mXBb7zoN3z9n7/uhS98oQu/fKHnPu+5HvyQh/iJhz3MWhFrRexUpIgdipi19f73vs//fMfbnHfeZzzkwQ/yxCc+0YGK2FAu+Nz5fvZnfw5R9bKXvtTxxx9vUaSIHYqYtZXEqIjdFbGhiLUidipSxA5FzNpKYlTE7orYUMRaETsVKWKHImZtJTEqYndFbChirYidihSxQxGztpIYFbG7IjYUsVbETkWK2KGIWVtJjIrYXREbilgrYqciRexQxKytJEZF7K6IDUVMrmdSETsUMYlFEQ1RGkJsaEnEIDYUEbPVVVc588wzHfPdx6AuvPCfnHnGmZ70pCeZFDGJRRENURpCbGhJxCAc893f7dm/9mxf/MIXPO95v+5fLrvcrJKYVcSv/PKvuNnNburhD/8JR93iaIs/+aM/9ud//udWViKKqPe99/0OP/xwsaElEYPYUEQsKolZRexQxCRmD33Yj/uhe/+Q03/7t11wwQUUITa0JD593nm0thURi0rivM9+2vW+67vE7CMf+Ttf+OIXKZdddpkzzjjDXe5yF7MiGqI0hNjQkohBbCgiFnXRRRf5zz/zFI98xCM87rGPcbvb3s5aEZNYFNFw9DFH+9Vn/6ov/eMXPfd5z3PZZZebtCRiEBuKiEUlMauIHYqYxKKIhigNITa0JGIQG4qIRSUxq4gdipjEooiGKA0hNrQkYhAbiohFJTGriB2KmMSiiIYoDSE2tCRiEBuKiEUlMauIHYqYxKKIhigNITa0JGIQG4qIRSUxq4gdipjEooiGKA0hNrQkYhAbiohFJTGriB2KmMSiiIYojetRRM1i1hBFzIoYxSgENSiJSWJTW0kQ1CzYIzUoolgpqVFDFDErYhSjENSgJCaJTTc8/HD3vc99feYzn0U1K7NQpIgvfPGLPnnup/zhH/6Be9z9nmpUxItf8mIvfslveslLTvU7v/s7PvkP51irQUlMEpvaSoKgZkEoUkTNYtYQRczqDne4o9Gf/dmf+dpXv0pQg5KYJEannXaaUVtJENQsCDUo9qhZY9KQ1CwoYhSjENSgJCaJTW0lQVCzID501gdRz3/+C9zg8BvY1BBFzIoYBTe64Y3d99/d12c+/RlWRU0Sm9pKgqBmQShSRM1i1hBFzIoYxSgENSiJSWJTW0kQ1CwIRYqoWcwaoohZEaMYhaAGJTFJbGorCYKaBaFIETWLWUMUMStiFKMQ1KAkJolNbSVBULMgFCmiZjFriCJmRYxiFIIalMQksamtJAhqFoQiRdQsZg1RxKyIUYxCUIOSmCQ2tZUEQc2CUKSImsWsIYqYFTGKUQh7iFEQ22IUo6JiUtS2ILEoalsENarQUINqDGIUBKlJjOI9736P/SefbO/xd3Dve9/b03/lGdTa5Vdc7oUvepH73//+TjzxRD/z1Kf6whe/YBFBUbWHVahZOOeTn/TofY/20//pPwl+/bnPs2/foz3tab+EGBUVk1WobeGcT37Svn37vPWtb/WoffuccOIJTn/Vq3zzm5eJ+JP//see+MQnumqFhnL55Zd77OMe68//4i+MzvvUp/zsU5/qbiee4Pjj7+DRj97n3e8+w6iomBRllZoEicWrTj/d437ycR7/kz/pZS87TQQ1qnjvme/zkAc/xIknnugZz3yGyy/7F0EQpAYR1B4RVRWTopz+26fbt2+f0199OolFUdsiqFGFxlve/Bb79u3zX1/0QsRPnXSSR+/b5/Wve53Fa17zag95yEPd4fg7uN/97+/XnvNcF198MUVt24PEoqjZOed80nOf81z3vs8POfHEE/3Uf3ySL33xH6lJ1R//yX/3Ew/7CXc8/niP3rfP3/7NXxvFKEZFxaSobUFiUdS2CGpUoaFmMYhRENtiFKOiYlLUtiCxKGpbBDWq0FCzGMQoiG0xilFRMSlqW5BYFLUtghpVaKhZDGIUxLYYxaiomBS1LUgsitoWQY0qNNQsBjEKYluMYlRUTIraFiQWRW2LoEYVGmoWgxgFsS1GMSoqJkWt7TGqSe1UowpSsyC2lapFVIyqBjGIUZQgXO963+Wkk57gnve4J+XWt761J/zUT7nlLb/H4otf/JKn/uzPuMmRR/r91/+eF7zgBaTE2i/+/C/60zf8qcc99rGe85zn+PznL/DMZz4TVYMYxChZEcSgqO+55ffYv3+/k046SROPf/wTnHzyfk94/BPUqILULCW2lW9e9k0f++hHnXLKKR70oAd48pOf7BWveLkz33sm4c53vqsPfehD/vZv/oogvO997/V3f3e2u97lrpTPff7zbnaLW3jRi37Da17zarc57jae+tSnOvvsDwtSsyAGMSlVi/vd776e/OQnu/LKK5x73rnEIEYXnP9ZT/m/nuKGNzrcc5/7HBdccL4PfOAD2hoVP/ZjP+ZRj3qk0RFHHOEJJz3e9931rlKzIHz+85/30Y9+1Bc/9wVVi6gYVQ1iEKMo4YQTf8DJJ+/3oz/6I5T9+/c7+eST3fd+97P42Ec/5jGPeYzXvf6/eerP/Iwz3v0eT3va0whiLSuaWkQFXV3l6c94unM+eY7/8l9e6BWveIU73fF4l1x6CTGo17/+dV5wyilOPPFEp7385W5x9NGe8ISTXHLJJUY1qiA1C2JbqVpExahqEIMYRQliUNSkJrVTjSpIzYLYVqoWUTGqGsQgRlGCGBQ1qUntVKMKUrMgtpWqRVSMqgYxiFGUIAZFTWpSO9WogtQsiG2lahEVo6pBDGIUJYhBUZOa1E41qiA1C2JbqVpExahqEIMYRQliUNSkJrVTjSpIzYLYtuq3Z9UNq7arblh1tOpg1V2tenBnnXVW9+7d2w//7d92N//7Ix/p7ffu7Rvf+MZOVu3HP/b33bt3bz/72c+2XXW0avvp8z7d4/fu7dlnn91Nq87OOecfunfv3n784x/vwbz4xS/u3r17u2nV9uyzz+7evXv7+v/2unbVyYMf8uCecsrzO7pqteqP/PCP9JTnP7+LX/yFX+ij9u3rqrv75qWXdu/xe/va1762B3r605/en/7pn+5o1Q2rtqtO9p+8v/v3/1xHqw5W7Ste/vLu3bu3F154YUf/fPHFvf3evf2Fn//5/p965Stf2Uc+4hH9rVe+smurtqtuWHW06mDVq/nDP/qj3n7v3h6KV73qVd27d2+vuuqqbjrv05/u3r17e/bZZ7ertqtOLv3mpd279/Z99atf3VUHq+7wrSuv7N7jj+8zn/WsLi6//PKecMIJffOb39xDteqGVdtVN6w6WnWw6q5W/fasumHVdtUNq45WHay6q1W/PatuWLVddcOqo1UHq+5q1W/PqhtWbVfdsOpo1cGqu1r127PqhlXbVTesOlp1sOquVv32XC8tCaUhDl0Ro6pIHCBGKWJXaUkoDbHtbne7m6OOOsqT//NT/PAP/wf3ute9/PhDf9zhNzjc6JPnfkrErz772Z79a78qtfb+973fscc+wSjFHlpqp7QkuqKuXWOtiEGr4W53/0Ficuc73tn5519gtEc8ct8j/e5rf9evPec5Lr/8cm97+9s9/9d/XVoSl33zMi97+Wne8fa3+8d//CfU6OJvfMPBFDGqisS2GsQoRTj//Av8q1ve0tFHH210kyOPdNyxx6pBaYhDs3//fj+3f78YVUXiADFKEVeTVlqT0hCzs846y6te9Sqf+MQnXHrpN1Gjyy6/zI1vdGOjIkKrQazd6IY38qAHPdjLXvpSf/PXf+Pu97y7R/zEIxzz3ccYfe4LX5DWW970Jm9585spDcH/+l9/6eEPf7hrU8SoKhIHiFGK2FVaEkpDHLoiRlWROECMUsSu0pJQGuLQFTGqisQBYpQidpWWhNIQh66IUVUkDhCjFLGrtCSUhjh0RYyqInGAGKWIXaUloTTEoSuuJzEJMSviIGotsSViUYTSEIPYqSUGITEJMSuCww47zDvf+U5vectbnHnGmZ7znOd46akvdcYZZzjssMNcecUVRm94wxvc5KY3NSvi5je7uSIGMQsxaIlBSExCEBSxi5IVapKYJJFy5BFHoIg9e+JbV11lEh70oAd5+Wkv98EPftA/f/3rqB97wANIjF77O6/1+7/3e/7vF7zAXb7v+xxx4xt7xCMeoauVHYqiEYuIRRFKYxaTK791pRsefjgtMYgbH3GEGISYFXEQtZbYErEoQmmIQezUEmqQmISYfeWirzj55JPd6173ctpppzn22GO99a1v9cpXvtJVV15FTRKTJFJbilBecuqpHvjAB3n3u//Sqaee6tSXnOotb36zO97xjq684l8Up7zgBe5z73urWXCDGx7uoGotsSViUYTSEIPYqSUGITEJMSviIGotsSViUYTSEIPYqSUGITEJMSviIGotsSViUYTSEIPYqSUGITEJMSviIGotsSViUYTSEIPYqSUGITEJMSviIGotsSViUYTSEIPYqSUGITEJMSviIGot4XrWilASFHF1KaIIitjQEIQoYlLELDEqYlGEkqAIRxxxhJNOOslJJ53kfe97n6c85cn+6q//yn3ue1/H3fo4Vd+66irHHnusSRFbihjd7CY3U3z5y18mMSpiUREtMShip5A9JRRBUaOoQUOQSGpx3LHHuctd7+ptb3ubi776Nfe///0ddfTRFm960xs96pGP8tjHPo7wsY9+zKWXXupqUkcfc7SPfPQjRkVsaAhCUmvl39zqVt7+9re75NJvOuKIG7vs8st9/OMf929udSsUoSQo4upSxBve+AZn/+2HnXC3u9n3qEdZawhCFDEpYpYY1aYilLM+cJZLL7nUs571LMcee6zRxz/+caPsKaEIbnqzmyq+/OULTRqCcL3v2uOBD3yABz7wAZ79rGe7171/yNvf+U53vNOdfO/3fq/iG9/4hu899lgUoQiKmLzrXe/ygQ98wO1vf3tPeMLjEUVQxIaGIEQRkyJmiVERiyKUBEVcXYoogiI2NAQhipgUMUuMilgUoSQo4upSRBEUsaEhCFHEpIhZYlTEogglQRFXlyKKoIgNDUGIIiZFzBKjIhZFKAmKuLoUUQRFbGgIQhQxKWKWGBWxKEJJUMTVpYgiuJ61GDVESeymIohZFLGWIkb96kXyta+wKkERa3F1RRTx9x/7e+d+9tPu8YN3d/3Dru+8d/wPx62udOy3LpNzP+EHb36kH731v/aaZ/ySxzz2sU74/hNc+JUve/d73uOxj3mMm9385mJQbh4eeofbecfpL3fLS77uJkce6dbH3drisAs+67j+i+t//tPcwCAWnzr3XF/76tdc9rGzHbe60l/9yR8Y/cD3f7/DDru+G3z+M27Tf3H988/jqssQx1z8FS75Bud+giI86T73dPpvn270rGc8U879hMWjfuAuzv7AGc571/90ySUX+8M//CO37ZVu/rUvc+4nLIoH3O57nfG6T/mL017i+Dvsdcwx3+1mN72pb111la9edJHRzb7yJavGl886k3KLo4/y8Dsd7z29wu88+5c97KEP9dY//x9u2yvd8htf49x/MCqiiN0Uwefe8y4ffuc7HXPxRXz/nWwrYlTEoAiKWLvJhV9y217JuZ+wKO519E3dJlc46w9e5/r/4d876/3vd/673+E2Bud9iiNuLGa3UD9+x9t5x+mnueUlX3PkkUc47rjjXPyNi735TX/mfvf7d4466ih//9H/7barK9z5sD2c+wk3wNMe+iDveNVpjvr6he5zn/u68oorfPBDH3L7293WCSecYPGFM//S//en/4/e4x56zxMFMYsithUxKmJQBEWsxYYbH8m/+te6Z48oid1UBDGLItZSxKgiBkVQxFpsilFDlMRuKoKYRRFrKWJUEYMiKGItNsWoIUpiNxVBzKKItRQxqohBERSxFpti1BAlsZuKIGZRxFqKGFXEoAiKWItNMWqIkthNRRCztKtqCIqYFLEogiIOpojB//t7vPZUPn2O7/iO7zhENz+KRz+J/b+mRxwpFkVQxMEUMShSxE5FULOgNARFTIpYFEERB1PEoEgROxVBzYLSEBQxKWJRBEUcTBGDIkXsVAQ1C0pDUMSkiEURFHEwRQyKFLFTEdQsKA1BEZMiFkVQxKZ0hDhQERRxoLaSoCpiyzOfwht/33d8x3dcR3vvzB+/i5sfjSIO1FYSVEVsKQ0xKFLENSniQEVQxIHaSoKqiC2lIQZFirgmRRyoCIo4UFtJUBWxpTTEoEgR16SIAxVBEQdqKwmqIraUhhgUKeKaFHGgIijiQG0lkQ5cgyJoSWhJbCti9kev5ddPtnajG+stbyWuuyIogiIOXRHXXREUQRGHrojrrgiKoIhDV8R1VwRFUMShK+K6K4IiKOLQFXHdXfmtK11wwefc5CY3cczRRyvi0BVxCP75q1x0obUffSiveaMiaEloSWwr4qCK2FLEoIhDUQQtCS2JbUUcVBFbihgUcSiKoCWhJbGtiIMqYksRgyIORRG0JLQkthVxUEVsKWJQxKEogpaElsRaVm2jCC2JQ1fEqMh9b8OXPm/ysJ/kv/42N7yRRRFFLIooQkvi0BUxKlIaYndFFLEooggtiUNXxKhIaYjdFVHEoogitCQOXRGjIqUhdldEEYsiitCSOHRFjIqUhthdEUUsiihCS+LQFTEqUhpid0UUsSiiCC2JTRdffLGPffxj7nKnO7vJTW9qpyJGRUpD7K6IIhZFFOGPX8vzTrb2trPZe2cHV8SoSGmI3RVRxKKIIrQkDl0RoyKlIXZXRBGLIorQkjh0RYyKlIbYXRFFLIooQkvi0BUxKlIaYndFFLEooggtiUNX6cCWImYtCUWKOIginH8eP3xHk5sfxQc+ww0Ot62ISRGDIhZFzFoSihRxEEVcuyImRQyKWBQxa0koUsRBFHHtipgUMShiUcSsJaFIEQdRxLUrYlLEoIhFEbOWhCJFHEQR166ISRGDIhZFzFoSihRxEEVcuyImRQyKWBQxa0koUsRBFHHtipgUMShiUWT/43j7m0xOebn+1M9KEQdRxLUrYlLEoIhFEbOWhCJFHEQR166ISRGDIhZFzFoSihRxEEVcuyImRQyKWBQxa0koUsRBFHHtipgUMShiUcSsJaFIEbvaY0MsKqGIQVyDqMFFX7borW/HYYfbKWpLqFFsikUlFDGIaxA1qkUN6gBRW0KNYlMsKqGIQVyDqFEtalAHiNoSahSbYlEJRQziGkSNalGDOkDUllCj2BSLSihiENcgalSLGtQBoraEGsWmWFRCEYO4BlGjWtSgDhC1JdQoNsWiEooYxDWIGtWiBnWAqC2hRrEpBsffxaIXfVkM4hpEjWpRgzpA1JZQo9gUi0ooYhDXIGpUixrUAaK2hBrFplhUQhGDuAZRo1rUoA4QtSXUKDbFohKKGMQ1iBrVogZ1gKgtoUaxKRaVUMQgDmpPjWqtBkHFbupAMVjVIgmxVrPYFqOqUa3VIKjYTR0oRkGNosRazWJbjKpGtVaDoGI3daAYBTWKEms1i20xqhrVWg2Cit3UgWIU1ChKrNUstsWoalRrNQgqdlMHilFQoyixVrPYFqOqUa3VIKjYTR0oRkGNosRazWJbjKpGtVaDoGI3daAYBTWKEms1i20xqhrVWmKR1crV1YFiFNQoSqzVLLbFqGpUazUIKnZTB4pRUKMosVaz2BajqlGt1SCo2E0dKEZBjaLEWs1iW4yqRrVWg6BiN3WgGAU1ihJrNYttMaoa1VoNgord1KY9MYq1mFRsq1qE2lDqIGoUW2pLzSJGsRaTim1Vi1AbSk3amMWsRrGlttQsYhRrManYVrUItaHUpI1ZzGoUW2pLzSJGsRaTim1Vi1AbSk3amMWsRrGlttQsYhRrManYVrUItaHUpI1ZzGoUW2pLzSJGsRaTim1Vi1AbSk3amMWsRrGlttQsYhRrManYVrUItaHUpI1ZzGoUW2pLzSJGcc2qFqE2lJq0MYtZjWJLbalZxCjWYlKxrWoRakOpSRuzmNUottSWmkWMYi0mFduqFqE2lJq0MYtZjWJLbalZxCjWYlKxrWoRakOpSRuzmNUottSWmkWMYi0mFduqFqHW9tTuUhsiZjWItQqhttUiZjWJSS2qdpfaEDGrQaxVCEVSo1rErCYxqUXV7lIbImY1iLUKoUhqVIuY1SQmtajaXWpDxKwGsVYhFEmNahGzmsSkFlW7S22ImNUg1iqEIqlRLWJWk5jUomp3qQ0RsxrEWoVQJDWqRcxqEpNaVO0utSFiVoNYqxCKpEa1iFlNYlKLqkMRMatBrFUIRVKjWsSsJjGpRdXuUhsiZjWItQqhSGpUi5jVJCa1qNpdakPErAaxViEUSY1qEbOaxKQWVbtLbYiY1SDWKoQiqVEtYlaTmNSianepDRGzGsTaHpMa1aBmMSitSU1iUUrMYltsaw2iapHGLGY1qkHNYlBak5rEopSYxShGsa01iKpFGrOY1agGNYtBaU1qEotSYhajGMW21iCqFmnMYlajGtQsBqU1qUksSolZjGIU21qDqFqkMYtZjWpQsxiU1qQmsSglZjGKUWxrDaJqkcYsZjWqQc1iUFqTmsSilJjFKEaxrTWIqkUas5jVqAY1i0FpTWoSi1JiFqMYxbbWIKoWacxiVqPaRWtSk1iUErMYxSi2tQZRtUhjFrMa1aBmMSitSU1iUUrMYhSj2NYaRNUijVnMalSDmsWgtCY1iUUpMYtRjGJbaxBVizRmMatRDWoWg9Ka1CQWpcQsRjGKba1BVC3SmMWsRjWoWQxKa1KTWJSyJ7bFIFWDGoTEJAZVWxpiUNckMYnYTWyLQaoGNQiJSQyqtjTEoNZqUJsSk4jdxLYYpGpQg5CYxKBqS0MMaq0GtSkxidhNbItBqgY1CIlJDKq2NMSg1mpQmxKTiN3EthikalCDkJjEoGpLQwxqrQa1KTGJ2E1si/+fPXiP2vUuyAN93RtSQECsoUpsK4h1bzpCC7hEoZ6mCWAL2gERCSbiAGZHp6trRnCKh1EQx9aKeGidEawQrKCrAlPEtmIrJHLGEmgJQXB1aSAmnCGdgoEk7z3P8/ze0/d9bw6D/3pdk1RNahISi5hUrTXEpLZqUvsSi4hDYicmqZrUJCQWMalaa4hJbdWk9iUWEYfETszqiMQiJlVrDTGprZrUvsQi4pDYiUmqJjUJiUVMqtYaYlJbNal9iUXEIbETk1RNahISi5hUrTXEpLZqUvsSi4hDYicmqZrUJCQWMalaa4hJbdWk9iUWEYfETkxSNalJSCxiUrXWEE6pSeyLSVCTmhUVsZYaom5PzWot1FpNYl9MgprUrKiItdQQNTQmcVLNai3UWk1iX0yCmtSsqIi11BA1NCZxUs1qLdRaTWJfTIKa1KyoiLXUEDU0JnFSzWot1FpNYl9MgprUrKiItdQQNTQmcVLNai3UWk1iX0yCmtSsqIi11BA1NCZxUs1qLdRaTWJfTIKa1KyoiLXUEDU0JnFSzWot1FpN4qCa1KyoiLXUEDU0JnFSzWot1FpNYl9MgprUrKiItdQQNTQmcVLNai3UWk1iX0yCmtSsqIi11BA1NCZxUs1qLdRaTWJfTIKa1KyoiLXUEDU0JnFSzWot1FpNYl9MgprUrKiItdTslFBrNYmtmIQSxFpNYiM1qSNqUbNQYuemz3zG2bNnveRXX6J405ve5OwlZ1199XtsxSSUIHjKU77ba37nNYiNlGuu+RPf/ZSnuOaaP7GoRc1CiZ20FqHWahJbMYnf+fev8S2PeazHPuYxvvVb/wE1iY3UpGJWi1rULJTYSWsRile96lXOXnLWRz76MbNnPetZfvp5P41QglirSWykJhWzWtSiZqG85+qrnT171pvf/GZpXXbZZc5eetZnb7rJoiaxFZNQglirSWykJhWzWtSiZqHETlqLUGs1ic9+9rPOnj3rJb/6EsSb3vhm33v2Uu+5+mqLmsRGalIxq0UtahZK7KS1CLVWk9iKSShBrNUkNlKTilktalGzUGInrUWotZrEVkxCCWKtJrGRmlTMalGLmoUSO2ktQq3VJLZiEkoQazWJjdSkYlaLWtQslNhJaxFqrSaxFZNQglirSWykJhWzWtSiZqHETlqLUGs1ia2YhBLEWk1iIzWpmNWiFjULJXbSWoRaq0lsxSSUINZqErNT9sUJNYlJbcURjUkckZrFpCWOWLVed/nl3vdH7zP78Ic/7IorLvfJG26wryYxqdlb3vIWH/vYR+1ruPHPPuMtb3mLz9z4GYvULCYtcVSijokTir/94L/lWT/4jz3iEQ/33ve+lziiQWOIRWoWk5Y4KlE717z/Gldccbkbb7zR7PW//3pXXnmlmsSktuKIBo0hFqlZTFrCJz/xSZdffrmPfOSjJP7wve91+RWXu+WWWyzihJrEpLbiiAaNIRapWUxa4qhEHROL1Wrlisuv8L73vU/x4Y98yOsuf60bbvikRRzRoDHEIjWLSUsclahj4oSaxKS24ogGjSEWqVlMWuKoRB0TJ9QkJrUVRzRoDLFIzWLSEkcl6pg4c733AQAAIABJREFUoSYxqa04okFjiEVqFpOWOCpRx8QJNYlJbcURDRpDLFKzmLTEUYk6Jk6oSUxqK45o0BhikZrFpCWOStQxcUJNYlJbsXVnJXFAEbERRZwURxURW4mtIiYRkxUxCS1RQxGxETWrOio484Az3vve91KqIrYSW0UsYlISBxQRnHfeec477zzXf/BDqONiEkNpKmIrsVXEIiYlsWiJmtWKEBtRxEkxiaE0FbGVWCQUqVlMVpxySBGxEUWcFJMYSlMRW4mtIhYxKYljolaEGOKUikNiEkNpKmIrsVXEIiYlcUARsRFFnBSTGEpTEVuJrSIWMSmJWxUbUcRJMYmhNBWxldgqYhGTkjigiNiIIk6KSQylqYitxFYRi5iUxAFFxEYUcVJMYihNRWwltopYxKQkDigiNqKIk2ISQ2kqYiuxVcQiJiVxQBGxEUUcdUoc1tioWcWeGmpS1EZQx5SaxCJdIcSwwimTWDTa+uVf/pe+4Ru/0SMe/nAv/KVfItSkFtdfd70LL3ySC5/8JE+68ELXXHONiNp53Wtf5x/+L//Q6TNnPOLvPMIzn/lMWrOr3n2VJzzhCV70ohe54JEXeOhDH+onnvtcn/3MTTZqVjGJoYbyZ3/2aT/0wz/oG77xG5058wCPfcxj/dILX2C1Wpm98hWvdOGTLvRnN95ILHrLLZ72tKf7l7/yLy2KUyaxaKhFzSq44vW/79ue8ATf973fZ1GTomqIqGNKlaBoEULt/MRP/ITn/8zP+Inn/p8e+tCHeupTn+Ztf/AHqBiuvvpq3/nk7/SAM2dccP4FXvjCF1j1FjV8+xO+3ct+49edPXuJhz70IX7kh3/EB97/ATWJxR+89a0uvPDJzjzgjEc/+tF+/WW/rmoWpaEWRa3EnhpqUlQNEXVMqUkMrUUc1tioWcWeGmpSVA0RdUypSQytRdyumlXsqaEmRdUQUceUmsTQWsRhjY2aVeypoSZF1RBRx5SaxNBaxGGNjZpV7KmhJkXVEFHHlJrE0FrEYY2NmlXsqaEmRdUQUceUmsTQWsRhjY2aVeypxSlqq3ZiK2ZxRAwxCWJfaqghxFDc6ZxzXHTRd/qar32Y2X3vfz8XPfki97nPfSzCq1/9as973k972Fd/tX/0j/6Rl/zqr1JiEot7fcG9PO2pT3PB+Y/yjiuv9KlPf8ostbj+ug+69Psudc/Pv6eXXHaZ5zznOWqSmP33T/9373rXu/zTf/ZTnviEJ3riE5/oX7301/yLX/wXNmIWixpiCH/26T/zp9de7/v/t//Viy97kcc+5jF+9nnP9yu/8iuUh3zVQ1z5jiu97rWvNSv+4O1v94Y3vN6DH/pgswf9rQe56MkXucc97mH2HU/6Do9+9KPNYhazT378E65617u8++qrLWISRExikRpqCOfd5z4uuugiX3rf+5J4+MO/1nde/J3OOecci/LHf/zHXvDLL3Ttn17rR37kR3zyk5/wQz/4g4jZDTfc4HGPe5wPffhDfvy5z/WQhz7E83/m+V720t8Qk3DVu97lOT/6bF/6pff1A8/8x/7d7/w7L3rxi8Twjne+00Xf9V3ucY+7+9mfe76v//qv92M//mxve8vbzO50zp1ddPFFvuZrvsbsy+53PxdfdLH73Oc+tmKISRAxiUVqqCHEUJPEUFu1E1sxiyNiiEkQMYlFaqghxFCTxFBbdVDM4ogYYhJETGKRGmoIMdQkMdRW7cRWzOKIGGISRExikRpqCDHUJDHUVu3EVsziiBhiEkRMYpEaaggx1CQx1FbtxFbM4ogYYhJETGKRGmoIMdQkMdRW7cRWzOKIGDpb9bBVJ6turbq26saqw+oP3tje/5z2/ud09YSv761b9YRVD3rSd1zYRz/qkd147e+9tqdPn+5Lf+1fdWPV4er3vKenT5/uu9/97q6688Y3valnTp/u29/+9g6r7nvLW97SM19xui94wQu78YxnfH8f8pCHdHVLJ6tu/Ot//a97+vTptqturDqsurNqe/HFF/epT31qNy6++OI+7alPbbvq7Id+6Id6/vnnd7Vatasetupk1a1V+7rXva6Pf9z/1EsuuaSzVYdVd1a9LauesOrW05761J4+/RW96aab2lX7e//xP/T06dP90Ic+1K7al77sZT1z+it61VVXdbZq+8QnPrF/9/zzu/EVZ073kksu6cZP/uRP9vzzz++w6tlLLuk3fMM39Oabb+5i1X7v935fn/WsZ/WIVSerbq26turGqsOqO6vellVPWPWwVSerbq26turGqsOqO6vellVPWHXnF36ivf857f3PaZ/3o21X3Vp1bdWNVYdVd1a9LauesOphq05W3Vp1bdWNVYdVd1a9LauesOphq05W3Vp1bdWNVYdVd1a9LauesOphq05W3Vp1bdWNVYdVd1a9LauesOphq05W3Vp1bdWNUzUJtVNDYxJbsRZDxRC1ERvV2qpZ7KtJqJ0a/vB9f+irvvphNh74oAearWxUDKdSsyA26qse+lXOPfdcT3/60z3jB37Ay1/+CjfeeKONoqd44IMeaONBf+tv+9SnPuUTN3wCsZHEEEPF8LKX/ZrHPOYxzpw54wFnTnvrW9/qhhs+qbX4ju/4Dr//xje67rrrffrTn/aKl7/cky98MgmhdmpoTGIrfNM3fZNXvPL/8YIXvAAVQ9RGbFRrq2axryahhuIbv+l/dOc731nDl3353zC79tprCX967bVW4szpM6jgq7/6q1177fvdcsstZml97dd+LarlzOnTPvCBD7ilRfyXd73Lhz74QV/5P3yl02ce4MzfPOM//t5/9MpXvtKshsYktmIthoohaiM2qrVVs9hXk1A7NTQmsRVrMVQMURuxUa2tmsW+moQ6qTGJrViLoWKI2oiNam3VLPbVJNRODY1JbMVaDBVD1EZsVGurZrGvJqF2amhMYivWYqgYojZio1pbNYt9NQm1U0NjEluxFkPFELURG9Xaqlnsq0monRoak9iKtRjqzjEpiUkRMcTtiZ3YV0QkJkWkSBFDRSiJSRExBHe9y11s3OUud0VFDLHRRq2Vhoi73OUvec3vvsa/+TevcsXlV/jhH/4hz3/+811+xeX+0jnnSMiKu93lbijirnf5S2Y3f/YmRwW1E7M3vfHNfvw5z/X07/kez33uc9373Ht79o8/xw2f/ITEpM4//3z3uNvnefWrf8t5532Jhm/5B48Vk5KYFBFD3J7YiSImpSEiMSkiRYoYKkJJTCr4gnt9vllwKqGsViuzz372M+5x97s7dedTiNnd7vZ5NG66+WZ3utOdaNzjnvdEJIjhlhV3PuXGG2/0uG97vEsvPYuwMomcqlkMcXtiJ4qYlIaIxKSIFCliqAglMSkihrg9sRNFTEpDRGJSRIoUMVSEkpjUvrg9sRNFTEpDRGJSRIoUMVSEkpgUEUPcntiJIialISIxKSJFihgqQklMioghbk/sRBGT0hCRmBSRIkUMFaEkJkXEELcndqKISWmISEyKSJEihopQEpMiYojbE3e2VkTMWhKLIopYFEGRqoiTYl8sYhJFzGKjiJi1JNzvfvfzzv/8n1HE1Ve/m4agSFXEEDQlxM497nFPF110kYsuusjrX/8GT3v607ztrW/zdV/3dVqLq97zbg956IPNrrrqPWb3/iv3VkQR5577hTQ++rGPuvcX3ptUxb/9d7/t3HPP9cxnPEPCzTfd7J3veIf73e9+hrjrXe/q25/47X7zN1/hvC85zyMveKS/cu8vslFEzFoSiyKKmL3jynf4zVe83F++1xf4gf/9mSpiiFlJxL5YxCSKmMVGEVGsVrFR5FRtfMl5f9WnPv1pf/xf/9iX/437q7jyyrc799xz3fUud0ElxL6Y5ZRJnD5zxoc++CH3/dL7WZSGGFoSiyKKWBRBkXrBC3/Z9ddd54ILLvB1X/d1KInYF4uYRBGz2CgiZi2JRRFFLIqgSFXEELOSiH2xiEkUMYuNIuK4IopYFEGRqoghZiUR+2IRkyhiFhtFxKwlsSiiiEURFKmKGGJWErEvFjGJImaxUUTMWhKLIopYFEGRqoghZiUR+2IRkyhiFhtFxKwlsSiiiEURFKmKGGJWErEvFjGJImaxUUTMWhKLIopYFEGROmUWYk9qI2axlVqkiNiIo2qjal9aR4TYk5p967d8i6ve9S4vetGLvfOd7/TzP//zpDSkiE98/OOuv+46H7r+g4QPf/AjrrvuOh//+MfM3v6f3u7XXvprPnDttT784Q/7g//0Vmn91S/5EhsNL3nxi73+9b/v1a9+td/+t7/l8Y9/nFOnTolZzB72sIeR+sV//oveddV/8YEPXCt4xMMf7uMf/ZjXv+H1/uh9/9WPPfvZPvWp/26javb4b3u8D1z7fm97y1s84du+zVaIPamNmMXG+z9wjVe+/BV++9++GhFrNTSG2qjal9YRIfZkZSNoY+OCR54v5Z/99E+56qp3e8lll3njG97g2x73eItGzWqjalbD//yUp3jTG9/on/zTf+Lqq6923fXX+a1XvcpLX/prFqmNmMVWapEi/sPv/q7f+PVf90fvfZ9FY6iNqn1pHRFiT2ojZrGVWqSIWKuhMdRG1b60jghxQCJmsZVapIhYq6Ex1EbVvrSOCLEntRGz2EotUkSs1dAYaqNqX1pHhNiT2ohZbKUWKSLWamgMtVG1L60jQuxJbcQstlKLFBFrNTSG2qjal9YRIfakNmIWW6lFiriztSKGiH1FbIQisVHkC77A1nUf0FUlIURsFEnM2kpiVsQQMXvShRd6xzvf6Z/+1E85hUc9+tEkYhaz5zznx/373/n3ooizl55FPOrRj/LPf/4X3HTzTX72Z37Wc3/8uaj73u/L/Nizn+3L7n9/bZ0qwpkH/E1Pf/r3CB74oAd55jOfaaMI7n73u/v5X/gFL/ylF/r133iZb/7mv+fnfu7n/N0LLvCob36U73n695g9+MEP9s1/7+/7wDXvN4uYnTl9xunTZ/zptdf6um/4em0lMStiiNhXxJBTp7SVxEaRGGJRkSJEbBRJzNpKYlYEp3LKqZyyr0hi9tf/+pd63vOe55k/8AyXX34F4lGPfrRLLj1rEZOQUxThlJhFFI/+5m/2f/zYj3rOs5/jJS++TMPnfd49PPMZ328Wsa+IjVAkZh/5yEet8EX3+WKLWFSkCBEbRRKztpKYFTFE7CtiIxSJjSIxxKIiRYjYKJKYtZXErIjJtdfYutcXmhWxEYrERpEYYlGRIkRsFEnM2kpiVsQQsa+IjVAkNorEEIuKFCFio0hi1lYSsyKGiH1FbIQisVEkhlhUpAgRG0USs7aSmBUxROwrYiMUiY0iMcSiIkWI2CiSmLWVxKyIIWJfERuhSMzSCUUcUcQxRRRRGmK45RYe9lf55Mctvu9ZfP9zSAxF7BQxFHFEEYtPfPwTbrn5Fvf+onMRRZSGOKolsW/VlQ998IOI8847z1DEW9/2Vt918cV+7/de616ffy+f+vSn3Oc+96GIY4ooojTE1v/73/6bz3z2s+5973s7qW688TP+ziP+jid/55M94xnfjxiKOKKIY4ooojTEUS2Jk4rYKWIo4ogijimiWK1udu37/9QXnvuX3fOen2+rJXFSETu1WtX1H7xe8MVffB93utOdbBVxTBFF1LUf+FMXPPJ8f+2v/XWvec3vutOdTtGSOKmInSKGIo4o4pgiiigNcVRL4qQidooYivDG1/LUx3LzzRaveAMPfpidIoooDXFUS+KkInaKGIo4oohjiiiiNMRRLYmTitgpYijiiCKOKaKI0hBHtSROKmKniKGII4o4pogiSkMc1ZI4qYidIoYijijimCKKKI20qxI1xFBEEUMRJ9SkJPz8c/mF59q6/xn9sq8Qt6+GGIr48yvi1n3ik59w5ZXv8IhHPNxd73o3MRTx51eT1sc+/jHXX3+9D3/4wx7+8Ef4vLvdzb4aYijiz6+I21dDDEX8+RVx+2qIoYjbdv0HP+jqd1/tgQ/8Sl/8xV/skCJuXw0xFPHnV8Tt6w0f5z+9SQx9yNfIy38fMRRxQk1K4pC2khhqiEWRImqIoYgihiJOqElJHNJWEkMNsShSRA0xFFHEUMQJNSmJQ9pKYqghFkWKqCGGIooYijihJiVxSFtJDDXEokgRNcRQRBFDEcelE7ejhpjUECfddJN+99+Xt1zhL/yFv/A5OveL+M0ruO+Xm9UQkxrioBpirUgRRWqIO6yGmNQQB9UQa0WKKFJD3GE1xKSGOKiGWCtSRJEa4g6rISY1xEE1xFqRIorUEHdYDTGpIRanzGpRR9WsgtQQxE6pWpxzjrz4t7n0B7jb5/kLf+Ev3HFNeOS38m/ezH2/XM0qSA1B7JSqjaiYVU1iErMoQUyKWtSijqpZBakhiJ1StREVs6pJTGIWJYhJUYta1FE1qyA1BLFTqjaiYlY1iUnMogQxKWpRizqqZhWkhiB2StVGVMyqJjGJWZQgJkUtalFH1ayC1BDEVlZt43NXxFoNwWdu5Kor+cTHtJUiTijic1fEWg2xVkSRIk4o4nNXxFoNsVZEkSJOKOJzV8RaDbFWRJEiTijic1fEWg2xVkSRIk4o4nNXxFoNsVZEkSJOKOJzV8RaDbFWRJEiTihicvd7cvorufcX+f+jiLUaYq2IIkWcUMTnroi1GmKtiCJFnFDE566ItRpirYgiRZxQxOeuiLUaYq2IIkWcUMTnLl2tKqE0xB1XxKwq4lYUcVhLQmmIO66IWVXErSjisJaE0hB3XBGzqohbUcRhLQmlIe64ImZVEbeiiMNaEkpD3HFFzKoibkURh7UklIa444qYVUXciiIOa0koDXHHFTGrirgVRRzWklAa4o4rYlYVcSuKOKwloTTEHVfErCriVhRxWEtCaYg7rohZVcStKOKwloTSEHdcEbOqiFtRxGEtCaUh7rginTimiFtRO3FAEUpDHNASkzikiFtRO3FAEUpDHNASkzikiFtRO3FAEUpDHNASkzikiFtRO3FAEUpDHNASkzikiFtRO3FAEUpDHNASkzikiFtRO3FAEUpDHNASkzikiFtRO3FAEUpDHNASkzikiFtRO3FAEUpDHNASkzikiFtRO3FAEUpDHNASkzikiFtRO3FAEUpDHNASkzikiFtRO3FAEUpDHNASkzikiFtRO+GUrVqUmNRhKaGxqGMaixC1VTsJovbVosSkDksJjUUd01iEqK3aSRC1rxYlJnVYSmgs6pjGIkRt1U6CqH21KDGpw1JCY1HHNBYhaqt2EkTtq0WJSR2WEhqLOqaxCFFbtZMgal8tSkzqsJTQWNQxjUWI2qqdBFH7alFiUoelhMaijmksQtRW7SSI2leLEpM6LCU0FnVMYxGitmonQdS+WpSY1GEpobGoYxqLELVVOwmi9tWixKQOSwmNRR3TWISordpJELWvFiUmdVhKaCzqmMYiRG3VToKofbUoManDUkJjkU7sKaKIQ4rYV8ROEbMiJkVQxG0qoohDithXxE4RsyImRVDEbSqiiEOK2FfEThGzIiZFUMRtKqKIQ4rYV8ROEbMiJkVQxG0qoohDithXxE4RsyImRVDEbSqiiEOK2FfEThGzIiZFUMRtKqKIQ4rYV8ROEbMiJkVQxG0qoohDithXxE4RsyImRVDEbSqiiEOK2FfEThGzIiZFUMRtKqKIQ4rYV8ROEbMiJkVQxG0qoohDithXxE4RsyImRVDEbSqiiEOK2DlFqaHELGpfDRXHxUbNQk0q1mJIDUUNpYYSs6h9NVQcFxs1CzWpWIshNRQ1lBpKzKL21VBxXGzULNSkYi2G1FDUUGooMYvaV0PFcbFRs1CTirUYUkNRQ6mhxCxqXw0Vx8VGzUJNKtZiSA1FDaWGErOofTVUHBcbNQs1qViLITUUNZQaSsyi9tVQcVxs1CzUpGIthtRQ1FBqKDGL2ldDxXGxUbNQk4q1GFJDUUOpocQsal8NFcfFRs1CTSrWYkgNRQ2lhhKzqH01VBwXGzULNalYiyE1FDWUGkrMovbVUHFcbNQs1KRiLYbUUNRQaigxi9pXQ8VRp4jGEFtRQxFDbLQ1VA0xKY1JqEntxBDEEI0htqKGIobYaGuoGmJSGpNQk9qJIYghGkNsRQ1FDLHR1lA1xKQ0JqEmtRNDEEM0htiKGooYYqOtoWqISWlMQk1qJ4YghmgMsRU1FDHERltD1RCT0piEmtRODEEM0RhiK2ooYoiNtoaqISalMQk1qZ0YghiiMcRW1FDEEBttDVVDTEpjEmpSOzEEMURjiK2ooYghNtoaqoaYlMYk1KR2YghiiMYQW1FDEUNstDVUDTEpjUmoSe3EEMQQjSG2ooYihthoa6gaYlIak1CT2okhiCEaQ2xFDUUMsdHWUDXEpDQmoSa1E0MQQzSG2Ioaihhio63ZKZM4JGYVs9aitUhi0Yg9IdZCxVat1Wc/+1lnz571qy95ieBNb36Ts2fPuvrqqw0xq5i1Fq1FEotG7AmxFiq2aq32xSExq5i1Fq1FEotG7AmxFiq2aq32Ba/6rd9y9uxZH/3oR81+8Fk/6Kd/+nkqZq1Fa5HEohF7QqyFio2r3321S8+e9eY3v8nssssuc+nZs26+6SYnxaxi1lq0FkksGj/zvOf52Z95vkWI4Zr3X+O7nvLdrrnmGotaq31xSMwqZq1Fa/GqV73KpZdeSiP2hBgufPKF/v5jHusxj3mMV7z8FdRa7YtD4uqr3+OSSy/15je/Wctll13mkkvOuvmmmySxaMSeEGuhYqvWal8cErOKWWvRWiSxaMSeEGuhYqvWal8cErOKWWvRWiSxaMSeEGuhYqvWal8cErOKWWvRWiSxaMSeEGuhYqvWal8cErOKWWvRWiSxaMSeEGuhYqvWal8cErOKWWvRWiQxO1WzWrSOiyGxSOwpsahJqaNipzEpYrWqy6+43B++749QH/nQh13+ute54YYb7IshsUjsKbGoSamjYrjgkY/0i//3/4UiNmpWP/ajP+q7Lr7YcTEkFok9JRY1KXVU7DQmRWzUrN7/J3/i8te9zo033mh2xet/35VXvl0MiUViT4lF/z/W4AXquoMgD/TzhjsE61S6yk2CrTm/2tr2R2eRZGrCLJB2SuUy/owSgs5QJRSFGbUKgi2pOnYErUoTguWmrZChIgGsokuUgIC2BtoKhAHlbm6EAAm3P3/Ifmfvs88+53xfPswqi+cxKnVQ7Hzqpk970xVvcsMnbjR53/vf5w+ueLPbbvuitdZhMUusJfaU8MEPftAHP/JhSu2cPHnSf/rjP3by5EmTxqiIySO+/REueeGlqLXWYTFLrCXWrrv+On/6p/+NWKtRqZ1nPOP/9Owf/3HXXnutT930aY1REYua1Fpr36c//SlvftMVbvjEDRLe9773ecubr/DF224zK7FWo1IHxU5jVMSiJrXWOixmibXEnhJrNSp1UOw0RkUsalJrrcNillhL7CmxVqNSB8VOY1TEoia11josZom1xJ4SazUqdVDsNEZFLGpSa63DYpZYS+wpsVajUgfFTmNUxKImtdY6LGaJtcSeunNMYtJEzFoSihRxhKCIGIX4UiqCUKNKK4oomli0JBQp4ghBETEKcbQvnrqFFqGIUUUQXxwGXxwGi5aEIkUcISgiRiG+lIogFDGqCKKJJhYdrBUp4ghBETEK8aVUTMJQk7SiIiZNxKwloUgRRwhqkiDEzrFjx7zvfe8zqwhCEb546hQdEJMmYtaSUKSIg2p0GoqIUYids88+yyIdxCQUMaoIYtJEzFprFQZbtS8oIkYhvpSKIBQxqghi0kTMWhKKFHGEoIgYhfhSKoJQxKgiiEkTMWtJKFLEEYIiYhTiS6kIQhGjiiAmTcSsJaFIEUcIiohRiC+lIghFjCqCmDQRs5aEIkUcISgiRiG+lIogFDGqCGLSRMxaEooUcYQ4zZ5YVEIRo/hLRE1qUaM6JGojNFQksYhRjSrhVa/6D5564YV+4Zd+wfGHPMQjHv4Il112mX2//KJ/6x896lGOHVt52Hnnec5znuOmm2+m1p785Cc7ceKEa6+93q+94hVOPP6EE48/4S1/+IeIX/iFX3TixAlveMNve8eVV3r8iRNOnPhOL3rRpYqgqVdedplHf8ejHTt2zIkTJ1x55ZVmUdx006c9/sQJV1xxhWc+61m+5fhDnHfeed761reanPjOx3vlZZe58KkXesi3PMSzn/McH/vYX9ipGNWoEooYxdZb3vIWJ06c8LSnPc0salKLGtUhUaMgFBVExSRGrVde9kqPecyjrY4d8/gTJ1z5zivte8tb3uJRj3qUhzzkuB/70R/zhZMnaS2uufZa53/3EzzhCU/whPOf4CMf+QiiZk/+J0/2nSdOuPa6673iFa904sQJJ06c8NY//EOz+uVffpF/9KhH+YZjx5z3P5/n2c95jptvvtlBgxf80r9x9jnnOO+8c/3av//3JjWqAypqIxQtl132/3r0ox/j2Dcc8/gTJ1z5J1eiElqinGZWR4ia1KJGdUjURqhJ7ItFJRQxir9E1KQWNapDojZCTWJfLCqhiFH8JaImtahRHRK1EWoS+2JRCUWM4i8RNalFjeqQqI1Qk9gXi0ooYhR/iahJLWpUh0RthJrEvlhUQhGj+JLuXEQRa0WCiri9IvbFJCgiSmJRBLFzlzvd2QUXPNHf+bvHUQ8+48EuuOAC973v/RDUjTfe4Ior3uwDf/4Bz/7xH/f7v/8HLrrouR74tQ/0bX//20ze9Z53+e7v+m5f//V/04c+/CEvvOQS1113rZe+9GUm3/d93++WU7f4kR/+EWefdZbHPPrRimOrFerbH/lIx4//Xf/uV/+9q6+92g/8wA9K4r73++ti9vKXvdzP/uzPOv/8J3raD/xTl7/2tZ74xAu84x1XOv300wW33vpFf/quP/UjP/LDHvCAB/iRH/1Rn/70p3xWlAU1AAAgAElEQVT84zco3vXud3vXu9/le7/nezzsvId5/vOf7253vYt/8dyLRH3z3/5mF1xwgdNPPx3xXd/1v/nqr/5qh33qU5/0rne/y33/+v0sYhIUESWxKIL73fe+nvTEC5xxxhmCs88+yz3ueS93ucudLF72sl/xvOf9rCec/91+4Aee5jWvea0nnv9E73jHO5x++uk+8pEP+/6nfL9v/tt/x0/8xE941av+g//6X/+bf/APHokivvqvfJX/45/8Ex/96Ec873nP99nPfc4kZt/3fd/n1KlTfviHf8hDzzrLYx79jxGr1Yoi8e53v8sTvvu7/M2/eaYPf+hDLr7kYtdfd72XvvTFCOLGGz/p9b/5ej/0f/2Qt7zlzX7qp3/K/e5/Pw9/+MNJLGoSsRO87OUv8//87PM98fzv9rSn/VOXv/ZyT3ziBd75zne41+n3dP/739cFFzzJGQ86w+Tsc85xz3vdw13uehf7YhIUESWxKILYiUlVRBFrRYKKuL0i9sUkKCJKYlEEsROTqogi1ooEFXF7ReyLSVBElMSiCGInJlURRawVCSri9orYF5OgiCiJRRHETkyqIopYKxJUxO0VsS8mQRFREosiiJ2YVEUUsVYkqIjbK2KrX8LQfUOH7hm6Z2iHrg1DDxl6wNCNoXdkaHvxxRd3tVr1ne98R4fOjh8/3qf/4NO7M7RD14ahveSSF3a1OrO3Dbe1Hbo499xv68X/5pLOhh727Gc/u084//wuhs5uvfXWrlZn9see+cwuTn7hZI8fP97XXH5526Ed2hs+8YmeeeaxPu5x/2t3hi5WqzP7lO9/SmdDf+ZnfqYPf/jD+6UM3Td06OxNb3pTH/fYx/UpT3lKZ0M7dG0YesjQA4ZuDD3Krbfe2tVq1Wc+85kdOjt58mSPH/97fc3lr+nkl37pl7o6c9Ubbrihk5tv+nRXZ6769Gc8o8PQA9773qu6Wq36nqve07WhG0Mn5557bi+5+OIeZei+oRe/8JKuVsd62223tUN76aWXdrVa9co/+c/t0LWzzjqnT3nKhd0ZOjl+/Hhf/OIXt0M3ht56661drVZ95jOf2cXJkyd7/PjxXn755R26b+jQPUP3DO3QtWHoIUMPGLox9I4M3Td06J6he4Z26Now9JChBwzdGHpHhu4bOnTP0D1DO3RtGHrI0AOGbgy9I0P3DR26Z+ieoR26Ngw9ZOgBQzeG3pGh+4YO3TN0z9AOXRuGHjL0gKEbQ+/I0H1Dh+4ZunXnIm4vRWxEzIrEVkVCkRRRxCRmRYi1IiZVEbeX2ohv/MZvErOHnnWWD3zwAxZve/sfufSSS7znve/1hc99VkWd5guf/4J73eteZkVITYqYVEXMElspwtVXX4N43eWXe+3llyti9gdv/H2PfexjJbR1WgaP+PaHK2ISsyLOOvssk2K1OuZXfuXlbuvgTjnNYSliI2J23sMe5mEPe5hFRUKRFFHEJGZFiLUiJlURs6uvudrk8ssv99rXXK4xCuoP3vj7HvfYx/nIRz/ivve7r/vc5z4mp3/VX/F1X3eGtpIiipjEWmst1oqY1BBH+uO3vd3FL7zEe9/7//nc5z4rZp//whecfq97mcWxb/wmQvHQh36Ld7/7KkVMYlZrsVZcffU1qNe89nKXX/5alKC88Y1v9NjHPJbYiJgVia2KhCIpoohJzIoQa0VMqiJuL0VsRMyKxFZFQpEUUcQkZkWItSImVRG3lyI2ImZFYqsioUiKKGISsyLEWhGTqojbSxEbEbMisVWRUCRFFDGJWRFirYhJVcTtpYiNiFmR2KpIKJIiipjErAixVsSkKuL2UsRGxKxIbN3ZWhFFiiBGpUgoQixKI7EWk5jETksSVRGTNMQoZkUUKYIYlQ7ufOc7U4S73fVubrnlJOrGT3zS05/+dGc99KF+6Rd/0RlnnOH1r3+9iy++2G233WbSkkTVIg0xillFtCiCGNWpW06aPPe5FznnfzoHwWByj7vfU8yCim/6xm8SOy1JVN373vc2SeO0WOuAOxVRpAhiVIqEIsSiNBJrMYlJ7LQkURUxSUOMYlbELbfcSuOin3yuc84+B6VI3OPu9zD54q23ufvd74bSSLjnvU53mklMYqc1Ok1VxCQNMWtQRJFy46du9ANP/0FnnfVQv/gL/9oZD36w17/u9S6+5GLDbYNZad31rnc1Ce5617u79dZbxU5rdJqqRRq3nrrF5KLnXuTvn3O2iiKNe9zr7sSoFAlFiEVpJNZiEpPYaUmiKmKShhjFrIgiRRCjUiQUIRalkViLSUxipyWJqohJGmIUsyKKFEGMSpFQhFiURmItJjGJnZYkqiImaYhRzIooUgQxKkVCEWJRGom1mMQkdlqSqIqYpCFGMSuiSBHEqBQJRYhFaSTWYhKT2GlJoipikoYYxayIIkUQo1IkFCEWpXHn2IlRqiJFQsxiVBUxaohREWtFilgk1iKOEjsxSlWkSDgt3v9n7/dN3/hNqHf+l3daff3X03jb29/mc5/9jGc+85nOOOMMylXvebd9ibW73uWubr75ZofF7E53ubObPv1pUhUpEl97xoMIn/nsZ5xxxoNUxKiIURFrJWpfYu00sa+CiCImMUpVpEiIWYzqnf/lv/qNX/91X/3V/4Mf/bEfRRFrRYpYJNYijhI7D/raB5LBzTd/xhkPOoM4pB7wwAf43d95g89+5nNOv/fpTp78gve85yoP/NoHUqSIRYJUxGF3uctd3XzzTRYxSr31rW/z+c9+zo8961ke/KAzTN5z1XtEVa01hD97//v8rb/1t03e+Y53+roHn2FfwgO/9gE+fv3H7Xvg1z4I8dnPfMaDzjgDMasKRULMYlQVMWqIUf3Zn33AK175a9J47kX/ArFIrEUcJXZilKpIkRCzGFVFjBpiVMRakSIWibWIo8ROjFIVKRJiFqOqiFFDjIpYK1LEIrEWcZTYiVGqIkVCzGJUFTFqiFERa0WKWCTWIo4SOzFKVaRIiFmMqiJGDTEqYq1IEYvEWsRRYidGqYoUCTGLUVXEqCGcpkaxL0ZBjWpSVMRGahY1a4zi9mpSG6E2ahT7YhQMaP3rn/t573r3u13ywktdf911/tGjHkXqW771W0X8x9/+LR/72Me8+KUv8QdvugIh9tSD/8bXecPv/I63/eFbffgjH/bZz3/OWo3iQQ96kA/8+Z973ete58Mf/pAbb/wE5e53u5snXfAkl77oRV76spe75uq/8MEPfdBLXvJvve3tb0fUrKHi9mpI1EZoKiI1in0xCmpUk6LiYx/9qFf/xm/4rd/6TbOoWWMUt1eT2gi1UaOY3P3ud/ekC57kl1/0Ii//lZe5+i+u9sEPfsBLXvxib3v721X8L//wHyr+1b/6v1111VV++qd+WlNKYxSf/OSnXHPtNa677nqTG66/3tXXXuPGT37SWij+xtf9Db/7hjd461vf5sMf+bDPf+5zJv/jt34r4bd/87d87GMf9dKXvMQfvOlNBhGzpCb/+ud/3p+++10uvfRSH/2Lj3nUP/4Ohz3yEY/wH3/7t/zeG9/oqve8x8lTJ93t7nfzPU/6Hi+69FIvf9nL/cU1V/vQBz/oxS9+sT96+9sJalSToiI2UrO49rprXfbKy7zislcibq8mtRFqo0axL0ZBjWpSVMRGahY1a4zi9mpSG6E2ahT7YhTUqCZFRWykZlGzxihurya1EWqjRrEvRkGNalJUxEZqFjVrjOL2alIboTZqFPtiFNSoJkVFbKRmUbPGKG6vJrURaqNGsS9GQY1qUlTERmqto6EbQ4829KChBw0dDZ0NXRu6NnRj6EHD0MXQjaEHXHzxxT1+/Hi/50nf22OrY12tVn32s5/TW0/d2sULXvCCHv97D+lqdWbPPvvsPu95P9vVatWbb7q5k6Gz91713p5//vldrVZdrVb9zde/vouh7U033dR/9iP/rKvVqqvVqv/8n//zLj7/uS/0oov+ZVerVVerY12dueq5557XK6+8smtDe8MNH+9qteqb33xF14auDZ2tzlz11a9+dRe/8epXd7Va9bbbbuvQjaFHG7r1ute9vqszVz333PO6NXQ0dDZ0beja0I2hBw1DF0M3hvbzn/98L7rooq5Wq65Wq65Wq577bef1yivf0cWL/+2Lu1od62q16iMf+ch+xz9+dJ/xjKd3NvQZz3hGV2eueuzYqmeuVl2tjnV15qpPf/rTuzUMfe9739vzzz+/Z65WXa1W/c3X/2YXL3jBC3r8+PGuVquefdY5fd7znt/VatWbb/5MO7QvetEv9/jx433yk5/c1ZnHulqd2Wc961k9deqWrg1dG9pef/31/cl/+ZNdrVZdrVZ9//vf3w5DP//5z/eiiy7qmatVV6tVV2eueu655/bKK6/sAUMPGnrA6177+q5WZ/bhD39426FrQ9eGbgw9aBi6GLox9GhDDxp60NDR0NnQtaFrQzeGHjQMXQzdGHq0oQcNPWjoaOhs6NrQtaEbQw8ahi6Gbgw92tCDhh40dDR0NnRt6NrQjaEHDUMXQzeGHm3oQUMPGjoaOhu6NnRt6MbQg4ahi6EbQ4829KChW+kEcbQiJkUcpUgRe4pYa0kcVgRF3N4ll1ziVf/hVd7y5re4/vrr3OOe9/RV9/4qh91y6pRPfPwG93/A/SUxK2KtJXFYERRxtCImderWW11z9TXuffrp/urXfI0kJkWK2FPEWkvisCIo4mhFTIo4SpEi9hSx1pI4rAiKOOjWU7e6+pqr3ev0e7nP19xHYhSLkydP+sQnPuEBD3wAIkXsKWKtJXFYERRxe6dOnfLxGz7uAfd/gMQojnLd9de7593v4av+ylfZKWKtJXFYEdxy6pRrr7nGvU8/3V/9mvtIbBUxKeIoz37Oc/zGr7/az/38z/mO7/gOsyLWWhKHFUERRytiUsRRihSxp4i1lsRhRVDE0YqYFHGUIkXsKWKtJXFYERRxtCImRRylSBF7ilhrSRxWBEUcrYhJEUcpUsSeItZaEocVQRFHK2JSxGHp0IojFLGviDtQmoo4UhE7RRyhLnnhC/36q37dFW++wqSIO1CaijhSETtFHKGIfUXcgdJUxJGK2CniCEXsK+IOlKYijlTEThFHKGJfEXegNBVxpCJ2ijhCEfuKuAOlqYgjFbFTxBGK2FfE7Z1zzjnufe97++03/LY75U6aijhSETtFHKGIfUXcgdJUxJGK2CniCEXsK+IOlKYijlTEThFHKGJfEXegNBVxpCJ2ijhCEfuKuAOlqYgjFbFTxBGK2FfEQXcWR2uItSIqYqsIitSkIogoYk9pSMxaEuJojXve457u89f+miIqYqsIitSkIogoYk9pSMxaEuJoDbFWREVsFUGRmlQEEUXsKQ2JWUtCHK0h1oqoiK0iKFKTiiCiiD2lITFrSYijNcRaERWxVQRFalIRRBSxpzQkZi0JcbSGWCuiIraKoEhNKoKIIvaUhsSsJSGO1hBrRVTEVhGG2wY///M/5/4PuL/TTrsTJaKIPaUhMWtJiKM1xFoRFbFVBEVqUhFEFLGnNCRmLQlxtIZYK6IitoqgSE0qgogi9pSGxKwlIY7WEGtFVMRWERSpSUUQUcSe0pCYtSTE0RpirYiK2CqCIjWpCCKK2FMaErOWhDhaQ6wVURFbRUg7lFgr4iujCIo4oIhFEWtFfGUUQREHFLEoYq2Ir4wiKOKAIhZFrBXxlVEERRxQxKKItSK+MoqgiAOKWBSxVsRXRhEUcUARiyLWivjKKIIiDihiUcRaEV8ZRVDEAUUsilgr4iujCIo4oIhFEWtFfGUUQREHFLEoYq2Ir4wiKOKAIhZFrBXx3+U0Qs3ioBrVVm3Uoma1U6OYxSEV+0LN4qAa1VZt1KJmtVOjmMUhFftCzeKgGtVWbdSiZrVTo5jFIRX7Qs3ioBrVVm3Uoma1U6OYxSEV+0LN4qAa1VZt1KJmtVOjmMUhFftCzeKgGtVWbdSiZrVTo5jFIRX7Qs3ioBrVVm3Uoma1U6OYxSEV+0LN4qAa1VZt1KJmtVOjmMUhFftCzeKgGtVWbdSiZrVTo5jFIRX7Qs3ioBrVVm3Uoma1U6OYxSEV+0LN4qAa1VZt1KJmtVOjmMUhFftCzeKgGtVWbdTitBqF2qlZYxRbsRGzilnUIhbV2qpJ7KtRqJ2aNUaxFRsxq5hFLWJRra2axL4ahdqpWWMUW7ERs4pZ1CIW1dqqSeyrUaidmjVGsRUbMauYRS1iUa2tmsS+GoXaqVljFFuxEbOKWdQiFtXaqknsq1GonZo1RrEVGzGrmEUtYlGtrZrEvhqF2qlZYxRbsRGzilnUIhbV2qpJ7KtRqJ2aNUaxFRsxq5hFLWJRra2axL4ahdqpWWMUW7ERs4pZ1CIW1dqqSeyrUaidmjVGsRUbMauYRS1iUa2tmsS+GoXaqVljFFuxEbOKWdQiFtXaqknsq1GonZo1RrEVGzGrdKSIURFfriJGpSEWRShSxKwIRYyK+HIVMSoNsShCkSJmRShiVMSXq4hRaYhFEYoUMStCEaMivlxFjEpDLIpQpIhZEYoYFfHlKmJUGmJRhCJFzIpQxKiIL1cRo9IQiyIUKWJWhCJGRXy5ihiVhlgUoUgRsyIUMSriy1XEqDTEoghFipgVoYhREV+uIkalIRZFKFLErAhFjIr4chUxKg2xKEKRImZFKGJUxJeriFFpiEURihQxK0IRoyL+e5xmoyYxaW3VpLZqVqOqnZiUEPtiLUZRi1jUJCatrZrUVs1qVLUTkxJiX6zFKGoRi5rEpLVVk9qqWY2qdmJSQuyLtRhFLWJRk5i0tmpSWzWrUdVOTEqIfbEWo6hFLGoSk9ZWTWqrZjWq2olJCbEv1mIUtYhFTWLS2qpJbdWsRlU7MSkh9sVajKIWsahJTFpbNamtmtWoaicmJcS+WItR1CIWNYlJa6smtVWzGlXtxKSE2BdrMYpaxKImMWlt1aS2alajqp2YlBD7Yi1GUYtY1CQmra2a1FbNalS1E5MSYl+sxShqEYuaxKS1VZPaqlmNqnZiUkLsi7UYRS1iUZOYtLZqUls1q1GdZhJiT2oRk9hKraWI2KhZY1aLqn1pHRBiT2oRk9hKraWI2KhZY1aLqn1pHRBiT2oRk9hKraWI2KhZY1aLqn1pHRBiT2oRk9hKraWI2KhZY1aLqn1pHRBiT2oRk9hKraWI2KhZY1aLqn1pHRBiT2oRk9hKraWI2KhZY1aLqn1pHRBiT2oRk9hKraWI2KhZY1aLqn1pHRBiT2oRk9hKraWI2KhZY1aLqn1pHRBiT2oRk9hKraWI2KhZY1aLqn1pHRBiT2oRk9hKraWI2KhZY1aLqn1pHRBiT2oRk9hKraWI2KhZY1aLqn1pHRBiT2oRk9hKraWIdGRUxNGK2FPEVhEHFSnigCJmbSUxKeJoRewpYquIg4oUcUARs7aSmBRxtCL2FLFVxEFFijigiFlbSUyKOFoRe4rYKuKgIkUcUMSsrSQmRRytiD1FbBVxUJEiDihi1lYSkyKOVsSeIraKOKhIEQcUMWsriUkRRytiTxFbRRxUpIgDipi1lcSkiKMVsaeIrSIOKlLEAUXM2kpiUsTRithTxFYRBxUp4oAiZm0lMSniaEXsKWKriIOKFHFAEbO2kpgUcbQi9hSxVcRBRYo4oIhZW0lMijhaEXuKWDvNWsUhtRWLmjRGpdZiT2sSo9hTk1hUErOKQ2orFjVpjEqtxZ7WJEaxpyaxqCRmFYfUVixq0hiVWos9rUmMYk9NYlFJzCoOqa1Y1KQxKrUWe1qTGMWemsSikphVHFJbsahJY1RqLfa0JjGKPTWJRSUxqziktmJRk8ao1FrsaU1iFHtqEotKYlZxSG3FoiaNUam12NOaxCj21CQWlcSs4pDaikVNGqNSa7GnNYlR7KlJLCqJWcUhtRWLmjRGpdZiT2sSo9hTk1hUErOKQ2orFjVpjEqtxZ7WJEaxpyaxqCRmFYfUVixq0hiVWos9rUmMYk9NYlFJzCoOqa1Y1KQxKuU0iihqpzGqnSImMQlB0dpK7GtrFhQ1OXXqi576lAv96r/7FcTb3v52T7nwQle99yqTxqh2ipjEJARFayuxr61ZUNQs1KiIonYao9op4sKnXuiNv/d7CEHR2krsa2sWFDULNSqiqJ2G//17v8fv/u7vmtx66hYXXvhUv/qrvyr4o7f/kQuf+lRXvecqWluJfW3NgqJmoUZFFLXTGNVOEZOYhKBobSX2tTULipqFGhVR1E5jVDtFTGISgqK1ldjX1iwoahZqVERRO41R7RQxiUkIitZWYl9bs6CoWahREUXtNEa1U8QkJiEoWluJfW3NgqJmoUZFFLXTGNVOEZOYhKBobSX2tTULipqFGhVR1E5jVDtFTGISgqK1ldjX1iwoahZqVERRO41R7RQxiUkIitZWYl9bs6CoWahREUXtNEa1U8QkJiGcRkyC2IlJTIqKtaJ2gsSiqJ0IalKhoQzDbd705iu8//1/ZnLDxz/uzVdc4eZPf9okJjEpKtaK2gkSi6J2IqhJhYaaxSgmQezEJCZFxeRP/tOVbvj4DbaCxKKonQhqUqGhZjGKSRA7wR/98X924yduVHxxqCuuuML73/dnlOtuuN4VV7zJTZ+5icSiqJ0IalKhoWYxikkQs2uuvtY3fMMxf/In7zApKtaK2gkSi6J2IqhJhYaaxSgmQezEJCZFxVpRO0FiUdROBDWp0FCzGMUkiJ2YxKSoWCtqJ0gsitqJoCYVGmoWo5gEsROTmBQVa0XtBIlFUTsR1KRCQ81iFJMgdmISk6Jiraj/nz24j97+LujD/nrfuW1BEYpQSJCRG50kgAoJIg52DGdVp2ZgCYGI4Nw5Comtmw9AR1CGa3uETWx3qlZZN6xOfKjKrN12tNsOkeeHSkIQapAhCAQIBL1TIeEh93uf7/d7fa/r+t2/607yx+Y5PcfXaydIrIraiaAmFRpqEUNMgtiJSUyKillRO0FiVdROBDWp0FCLGGISxE5MYlJUzIraCRKronYiqEmFhlrEEJMgdmISk6JiVtTWSZMiFLFTREUogjiqNBUxiSKoisQQkyiJRVGKmjVBrIqoCEUQR5WmIiZRBFWRGGISJbGoRShCETtFVIQivOP6P3BEaSpiEkVQFYkhJlESi1qEIhSx01adEaQWKUFjdoaqiEkUQVUkhphESSxqEYpQBHWGcuedd6IiFEEcVZqKmEQRVEViiEmUxKIWoQhF7BRREYogjipNRUyiCKoiMcQkSmJRi1CEInaKqAhFEEeVpiImUQRVkRhiEiWxqEUoQhE7RVSEIoijSlMRkyiCqkgMMYmSWNQiFKGInSIqQhHEUaWpiEkUQVUkhphESSxqEYpQxE4RFaEI4qjSVMQkiqAqEkNMoiQWtQhFKGKniIpQBHFUaSpiEkVQFYkhJlESi1qEIhSxU0RFKII44kQNMYujYhKzOKghYlY0FhE1qaGGWEXICTWEhLRqJ3jLW97qGVde6frrr/fc5z7XRRdd5IorrvDRj37U5PbP3uHlL3u5yy67zOMuudQ1V/8dN998MyJq8luveY3Lv/1yT3rik/zMz/yMH/zBH/Kbv/lbiJve+8e+8zuf6aMfvVksfvZnf9Y/+Ad/X0xics0113jWs57lWc96lt/7vd+zaog4ffq0Zzz9Ste99nVe9KIXufTSx3nyZd/oDW94g+KO2+/wspe93GWXXebSSx/nmmu+380f/ZgaYqj/6Z/9M5dddpknPvGJXvnzPy8nDDGLI4KgIWJWNK655hpXXvkMr3vd75vUUEPsBFFDzD78oQ+58sorPe95zzP5sR/7UVde+QzPuPJKn/zkJ61Onz7tyiuv9PvXXee/vvZFHnfp41x22WXe+Po30Ljqqqu89rrrRE1ee911rnrmVXqmVm9729s967ue7REXXeRbv/Vb/Nqv/SqtfTGJWRzUEDErGouImtRQQ+wEUUPM4qiYxCwOaoiYFY1FRE1qqCF2gqghZnFUTGIWBzVEzIrGIqImNdQQO0HUELM4KiYxi4MaImZFYxFRkxpqiJ0gaohZHBWTmMVBDRGzorGIqEkNNcROEDXELI6KSczioIaIWdFYRNSkhhpiJ4gaYhZHxSRmcdDJtCSUhrjniphUReIsMUkRR5x38qTvfvazfe3Xfq3JhQ875dnPeY7zzz/fvtOnT7vxXX/oe7/vez3+8Y/3Ey9/mXe980a33Xab8y+4wA/94A95+9ve6nuf91znP+jBXvWqV3nhC1/o1a9+NeJtb32rF7/oWt/wxG/w7Gc/28//j6/08Y99zFd+5VeY3P7pv3D9De90x+2fVQQf+tCHffSjN9v3nc/6Tp///Of93f/yB1x++eUmRUzqc1/4vBv/8F1+5Pk/7KEPfagXPP8F/vz0n/vELbdI+cEf+kFvf9vbfd9zv8+DH/xgr3rVq/y9F7zAL//yL5P4nX/5r/zkK17hqU95isc97uv89E//E0otTn7RSc95znM85rGPMTl16pTves6zXXD+BaiKxOzGG2906623Ov3np01SxEFpSShf9oAH+IEf+AGf/OStfvRHX+zpT3+6Rz7ykYj73Pc+Vp///Oe9613v8kM/8sP+g4c+zAue/3x/dttpH//ELYQbbrjBrZ+4FTH5s1s/5YZ33uBM6zzccMMNvvu7v9tl3/iN/od/9I+84/rrvfS/+XGnHv4VvuEJT3BPFTGpisRZYpIiDkpLQmmIe66ISVUkzhKTFHFQWhJKQ9xzRUyqInGWmKSIg9KSUBrinitiUhWJs8QkRRyUloTSEPdcEZOqSJwlJinioLQklIa454qYVEXiLDFJEQelJaE0xD1XnJSYhVgUcQ61ldiIWBWhNMQQR7VOnjzPj73kJVaPveSxHnvJY02K2Fff9azv8oIXvoDy9L99hcm7brzRdddd5+Uv+wlPu+IKk0c+6kjnbTgAACAASURBVGJP+9tX+OAHPuBhp075tV//dV9yny/xC7/wC07khEc9+lGueuYzUbNEDCEWVWd78pOfbJIzKEpiI1KzU6cu9JrX/K+UhuDGG2903e9f52U/8TJXXHEFrUc+8mJPe9oVPvinf+rCCy/0q7/2qx5+6pRXvOIVivPPf7BrrrlGLE6ed9JLXvISivLYxzzWYx/7WKtY1dd8zdf4xC23+NL73tcsjmqJISRm4Uu++Is9+clP9uGPfNjk0ksv9YQnPMERRUnj4ace7jWveY2jalFFDEGIxc/903/q/PMf7Od+/uedd955vv3yy918883+5W//tm94whMUcQ61ldiIWBWhNMQQR7XEEBKzEIsizqG2EhsRqyKUhhjiqJYYQmIWYlHEOdRWYiNiVYTSEEMc1RJDSMxCLIo4h9pKbESsilAaYoijWmIIiVmIRRHnUFuJjYhVEUpDDHFUSwwhMQuxKOIcaiuxEbEqQmmIIY5qiSEkZiEWRZxDbSWctFWEkqCI41JEERSxpyEIUcSsiEViUsSqCCVBEVuXPfkysxRRvO9971P1omuv9aJrX4zScCLe8MY3evapC33gAx9wySWXOOGEycUXX0xOSKIozpjUrBZ1UE6U0BAUMYnJN/2tbzELUcT73vc+zvCia6917bXXIpIqXv+GN7jwwgvddNMf+fZvu5yS8OhHP9pBKaIIitjTeOUrX2lRW0UsEpMiVkWoIdRhKeFM6pu/6ZsUsachIRFFzM5Qi3f94bt96lOf9MhHPUpQRMUJL/uJl0lQxHEpogiK2NMQhChiVsQiMSliVYSSoIjjUkQRFLGnIQhRxKyIRWJSxKoIJUERx6WIIihiT0MQoohZEYvEpIhVEUqCIo5LEUVQxJ6GIEQRsyIWiUkRqyKUBEUclyKKoIg9DUGIImZFLBKTIlZFKAmKOC5FFEERexqCEEXMilgkJkWsilASFHFciiiCk7Zi0hAlcUhFEIsoYitFTCpiKIIitmJfTBqiJPZddPFFJhVB8NnPfU7Ub/zGb7rf/e5LQ4q4//3vr+LTn/60h1zwEILyRV/0RSglOIGYxKThs3fczgkHnWkIsYgiOGPyqEdfbFURfO6zn+MEv/nrv+F+f+N+lIQz4gH3v79F/LV7/XUNUfe6971E1FEVQSyiiK0UMamIoQiK2Ip9MWmIcoI0zlYhJDzyUY8SRWyltKiK4LN3fJYTqNkdt9/uiqdd4XnXfL8TqiiSaIiSOKQiiEUUsZUiJhUxFEERW7EvJg1REodUBLGIIrZSxKQihiIoYiv2xaQhSuKQiiAWUcRWiphUxFAERWzFvpg0REkcUhHEIorYShGTihiKoIit2BeThiiJQyqCWEQRWyliUhFDERSxFfti0hAlcUhFEIsoYitFTCpiKIIitmJfTBqiJA6pCGJxktIQlMQQRayKoCKOilURoUhFzGKRIqhFUBqCkhiiiCGGUkNFrE6dOoW48847XXjhKUUMRWrysAsf5h3Xv8Ms9f73vx9VNXnAAx9A+chHPuLhpx5O6u1ve7uv/KqvslMEFUPtiUUUEYpUxOTUw09R7jzzBRdeeCFqEZRy6tQpN97wTjGJd7/7PYrEUAQVcVSsioif/O9/0p/9+ac84xnPdMkllxCLFEEtgtIQlIST553U8u8+/RcWRVARitqIVRFx/oPP96EPfUgsrr/hekpSk4sufoSPffxjTl34MJSGoDaieN8fv8+rf+WXBS996Y+jIo6KVRGhSEXMYpEiqEVQGoKSGKKIVRFUxFGxKiIUqYhZLFIEtQhKQ1ASQxSxKoKKOCpWRYQiFTGLRYqgFkFpCEpiiCJWRVARR8WqiFCkImaxSBHUIigNQUkMUcSqCCriqFgVEYpUxCwWKYJaBKUhKIkhilgVQUUcFasiQpGKmMUiRVCLoDQEJTFEEasiqIh9J4mGGGIriqCIRazaSoKqCGIoDRGKj32Imz/MFz7vXIo4Koq4/03v8vje4bw/eBNf/MVWbT2+Zzz9oQ/0qz/yd3zmKU/16K/+ap/65K3e8KY3eep3PMXf+NL7+c8f8TCvvO5f++0XP9/jHnep/+03fsvje4cv//Cf8NbXeSj+1n3/mrf/zE956Efe7w/e8Q4P/+RHXPyg+/LW16Fuv+MOn/6Lz4j6+t7u3n/4b3zif7+3EznhAQ/4MhUnT5/29b3Dff/oRr33CTEUqce3rnjo3/RrP/J3feYp3+HRX/1on7r1U974xjd4ylOf6n73u5/v+9qL/MqvvNr/8dIX+apHPML/+Suv9vh+xoPe/2956+udra0kqIoghvIn/+KX3HbbbT7zgPvyudsQd6WInQfceaev7+3e8XP/2MM+9ifuc58v9aAHPch5J06YnLzttK87c7v73XQj946KIIbyXV/1MDf91q967wPv6xOfuMXNv/3rHq/6ttdz4jw//MSv809++qf98n91tf/4SU/yJfe5j5v+6I/cfvtnfPM3f4tJ1O03vsv7Xv0qs2/9T+xrKwmqIoihNMRQpIi70vNOyvkP4aGnrKIIiljEqq0kqIoghtIQoUgRi1jETjTEEFtRBEUsYtVWElRFEENpiFCkiEUsYicaYoitKIIiFrFqKwmqIoihNEQoUsQiFrETDTHEVhRBEYtYtZUEVRHEUBoiFCliEYvYiYYYYiuKoIhFrNpKgqoIYigNEYoUsYhF7ERDDLEVRVDEIlZtJZEO7kIRtCS0JHaKOO6N/zf/3Yt59/X+yl/598JXXMTz/z7f+jSrImhJaEnsFHFORWwUMRRxTxRBS0JLYqeIcypio4ihiHuiCFoSWhI7RZxTERtFDEXcE0XQktCS2CninIrYKGIo4p4ogpaElsROEedUxEYRQxH3RBG0JLQktnKmbRShJXHPFTEpUhryL17Fi7+f1l/5K//eeeE/5Jq/5+4VMSlSGuKwIopYFVGElsQ9V8SkSGmIw4ooYlVEEVoS91wRkyKlIQ4roohVEUVoSdxzRUyKlIY4rIgiVkUUoSVxzxUxKVIa4rAiilgVUYSWxD1X6WCjiEVLQpEizqGIrfffxLddwhe+YHave/Oox3DeSXeniEURFPH/rXe+850e+MC/6cu//CH2FbEogiL+chSxKIIi/nIUsSiCIv5yFLEobrjhBuedd9LXfPVXS/z/58ydvPfd/LvbrPrr18nXPVGRIs6hiLtXxKyIoYhVEYuWhCJFnEMRd6+IWRFDEasiFi0JRYo4hyLuXhGzIoYiVkUsWhKKFHEORdy9ImZFDEWsili0JBQp4hyKuHtFzIoYilgVsWhJKFLEQSftiVUlUcQQdyGKKMI//2m+8AWzi7+WV/0OD36ISRGLIo6KVUUUcfeKKGJSpIgjiuC/veIK/+m3faurn/s8+2JVEUXcvSKKmBQp4ogiFkUcFauKKOLuFVHEpEgRRxSxKOKoWFVEEXeviCImRYo4oohFEUfFqnqmbn/LW335lz9ELrzQXSmiiEmRIo4oYlHEnj//FN//DN72epP8z/9Yv+6JYoi7EEUUMSlSxJ4oYghFxL5YVRJFDHEXoogiJkWK2BNFDKGI2BerSqKIIe5CFFHEpEgRe6KIIRQR+2JVSRQxxF2IIoqYFCliTxQxhCJiX6wqiSKGuAtRRBGTIkXsiSKGUETsi1UlUcQQ55QzbaOIWRFDEccVcVj5tkt577vNfuX/4gnfqIhDqiKKmBUxFHFcEYcVQRGrIg6piihiVsRQxHFFHFYERayKOKQqoohZEUMRxxVxWBEUsSrikKqIImZFDEUcV8RhRVDEqohDqiKKmBUxFHFcEYcVQRGrIg6piijC+2/im7/G7MseyNtvdlwRhxVBEasiDqmKKGJWxFDEcUUcVgRFrIo4pCqiiFkRQxHHFXFYERSxKuKQqogiZkUMRRxXxGFFUMSqiEOqIoqYFTEUcVwRhxVBEasiDqmKKGJWxFDEcUWsTsQktmJWsVO1CrWn1KwNf3arrYf/hyaxURu1iJjEVswqdqpWofaUmrWxiEVNYqM2ahExia2YVexUrULtKTVrYxGLmsRGbdQiYhJbMavYqVqF2lNq1sYiFjWJjdqoRcQktmJWsVO1CrWn1KyNRSxqEhu1UYuISWzFrGKnahVqT6lZG4tY1CQ2aqMWEZOYPfwRVv3UJ+1UrULtKTVrYxGLmsRGbdQiYhJbMavYqVqF2lNq1sYiFjWJjdqoRcQktmJWsVO1CrWn1KyNRSxqEhu1UYuISWzFrGKnahVqT6lZG4tY1CQ2aqMWEZPYilnFTtUq1J5SszYWsahJbNRGLSImsRWzip2qVaitE3VYak/EoobYqhCKpLR2YlGzmNWq6rDUnohFDbFVIRRJTWoVi5rFrFZVh6X2RCxqiK0KoUhqUqtY1Cxmtao6LLUnYlFDbFUIRVKTWsWiZjGrVdVhqT0Rixpiq0IokprUKhY1i1mtqg5L7YlY1BBbFUKR1KRWsahZzGpVdVjsi1jUEFsVQpHUpFaxqFnMalV1WGpPxKKG2KoQiqQmtYpFzWJWq6rDUnsiFjXEVoVQJDWpVSxqFrNaVR2W2hOxqCG2KoQiqUmtYlGzmNWq6rDUnohFDbFVIRRJTWoVi5rFrFZVh6X2RCxqiK0TZjWpoRYxlNasZrEqJRYxibO1hqhapbGIRU1qqEUMpTWrWaxKiUVMYhI7rSGqVmksYlGTGmoRQ2nNaharUmIRk5jETmuIqlUai1jUpIZaxFBas5rFqpRYxCQmsdMaomqVxiIWNamhFjGU1qxmsSolFjGJSey0hqhapbGIRU1qqEUMpTWrWaxKiUVMYhI7rSGqVmksYlGTOltpzWoWq1JiEZOYxE5riKpVGotY1KSGWsRQWrOaxaqUWMQkJrHTGqJqlcYiFjWpoRYxlNasZrEqJRYxiUnstIaoWqWxiEVNaqhFDKU1q1msSolFTGISO60hqlZpLGJRkxpqEUNpzWoWq1JiEZOYxE5riKpVGotY1KSGWsRQWrOaxaqUE7ETQ6qGGkJiFkPVRkMMtVXHJGYRh8RODKkaagiJWQxVGw0x1FYNtS8xizgkdmJI1VBDSMxiqNpoiKG2aqh9iVnEIbETQ6qGGkJiFkPVRkMMtVVD7UvMIg6JnRhSNdQQErMYqjYaYqitGmpfYhZxSOzEkKqhhpCYxVC10RBDbdVQ+xKziENiJ84WErMYqjYaYqitGmpfYhZxSOzEkKqhhpCYxVC10RBDbdVQ+xKziENiJ4ZUDTWExCyGqo2GGGqrhtqXmEUcEjsxpGqoISRmMVRtNMRQWzXUvsQs4pDYiSFVQw0hMYuhaqMhhtqqofYlZhGHxE4MqRpqCIlZDFUbDeGEGmJfDEENNSkqYiO1iFo0zqEmtRFqo4bYF0NQQ02KithILaIWjSGOq0lthNqoIfbFENRQk6IiNlKLqEVjiONqUhuhNmqIfTEENdSkqIiN1CJq0RjiuJrURqiNGmJfDEENNSkqYiO1iFo0hjiuJrURaqOG2BdDUENNiorYSC2iFo0hjqtJbYTaqCEOqqEmRUVspBZRi8YQx9WkNkJt1BD7YghqqElRERupRdSiMcRxNamNUBs1xL4YghpqUlTERmoRtWgMcVxNaiPURg2xL4aghpoUFbGRWkQtGkMcV5PaCLVRQ+yLIaihJkVFbKQWUYvGEMfVpDZCbdQQ+2IIaqhJUREbqckJoTZqiK0YQglio4ZYpYaK42oSSuykNQu1UUNsxRBKEBs1xCo1VExqVrOahBI7ac1CbdQQWzGEEsRGDbFKDRWTmtWsJqHETlqzUBs1xFYMoQSxUUOsUkPFpGY1q0kosZPWLNRGDbEVQyhBbNQQq9RQMalZzWoSSuykNQu1UUNsxRBKEBs1xCo1VExqVrOahBI7ac1CbdRRMYQSxEYNsUoNFZOa1awmocROWrNQGzXEVgyhBLFRQ6xSQ8WkZjWrSSixk9Ys1EYNsRVDKEFs1BCr1FAxqVnNahJK7KQ1C7VRQ2zFEEoQGzXEKjVUTGpWs5qEEjtpzUJt1BBbMYQSxEYNsUoNFZOa1awmocROWrNQGzXEVgyhBLFRQ0xO2BfH1BBDbcURDRqHxNASRyXqLHFMDTHUVhzRoLGIWWoSQ0sclaizxDE1xFBbcUSDxiJmqUkMLXFUos4Sx9QQQ23FEQ0ai5ilJjG0xFGJOkscU0MMtRVHNGgsYpaaxNASRyXqLHFMDTHUVhzRoLGIWWoSQ0sclaizxDE1xFBbcUSDxiJmqUkMLXFUos4Sx9QQQ23FEQ0ai5ilJjG0xFGJOkscU0MMtRVHNGgsYpaaxNASRyXqLHFMDTHUVhzRoLGIWWoSQ0sclaizxDE1xFBbcUSDxiJmqUkMLXFUos4Sx9QQQ23F1gklDqlJrKIOiyHOLbFVs8997vOuufpqv/jPf1Hwpje/ydXPu9p73vMei/qdf/U7rrn6aouow4IP/ukHfc/3fI8PfuCDqoitxFb5nv/ie/ze7/1rMZQ46hWv+Ck/9VM/ZRKrqMNiiEWpIlaf+8LnXX311X7xF3+J8qY3v8nVV1/t377nPZQ4pCaxijoshliUqte/7g2uvfZaV111lV/8X37JVm3FUGLnd3/3d11++X/m8su/3VO/46liFXVYDLEoVcRWYqu2YihxSE1iFXVYDLEoVcRWYqu2YihxbrGKOiyGWJQqYiuxVVsxlDikJrGKOiyGWJQqYiuxVVsxlDikJrGKOiyGWJQqYiuxVVsxlDikJrGKOiyGWJQqYiuxVVsxlDikJrGKOiyGWJQqYiuxVVsxlDikJrGKOu6EOKyxqknFnlrUUFTdhVJDzHrnF1x33e977x+/1+SWj93iutdd5/Tp02aNWz5+i7e//d+oScWeWtRQd3z2dm9+y1vcccdnRdRZSg3hLW9+i1s/cYtZHPMn7/9/fPADH7SqScWeWtRQVC0iaqd31nWvvc5N772JcMvHb/H7r32t06dvIw5rrGpSsacWNRRVi1s/eavvfd73oa666pkuecwllBpi0ZrFEY95zGO8+NoXeeJ/9CQ3/dFNJjWp2FOLGoqqRUSdpdQQi9YsDmusalKxpxY1FFWLiDpLqSEWrVncrZpU7KlFDUXVIqLOUmqIRWsWhzVWNanYU4saiqpFRJ2l1BCL1iwOa6xqUrGnFjUUVYuIOkupIRatWRzWWNWkYk8taiiqFhF1llJDLFqzOKyxqknFnlrUUFQtIuospYZYtGZxWGNVk4o9NTtJEbMiFrEVkzgiFjHEJA4oghCLogmqqUlP4Iyd2KiYxBGxiCEuesTF3nvTTVYpgiIIsSiaWBQxK0KD2IpJHBGLGGISQ8xSBKUpIRZFExRFzIpYxFZM4ohYxBCTGMJb3vxmOcNLX/rj7vXX70XMYlEksShiVi644AIXXHCBj37sY1YxiSNiEUNMYohZiqAIQiyKJBZFzIpYxFZM4ohYxBCTGGKWIiiCEIsiiUURszoo/y9p8AK1213QB/r5HYKEiwoEFKoxwVVOVLAtV5G2izUL5BakqFE5GKxigYwiSAUvoDMwSKkgKNQLiMJ4K1MxDYPj8g4ISnWkXrhJQKYkSBCIBBVIDPD+Zu/9f/f7vd93vpNGeB6zOCSGmMQsJrFIERRBiKFIYihiUcQQOzGLQ2KIScxiEosUQRGEGIokhiIWRQyxE7M4JIaYxCwmsUgRFEGIoUhiKGJRxBA7MYtDYohJzGISixRBEYQYiiSGIhZFDLETszgkhpjELCaxSBEUQYihSGIoYlHEEDsxi0NicYJQQxxWk9qprVrVUGcQR1QcSENJQ4g9jahf/uVf9oAHPMADH/hAv3LppajVVVdd5dSpUx556pRTp0654oor1CQWVT/z0pe63/3u51/e975e/OKfcsK+eP3vvd6FFz7M3e9xd9/z1Ke67tprLWpSbb3iFa/w8K9+uAsuuMDXX/R1/vhNbzIrLr/8cl930UVe/epXu+iii9ztHnf3Ez/5Ez7+8Y8TUouYVewLNYT/9ZJLXHTR13n9619PTWqntmpVQ/GqV73KRRdd5Nn/8TmEiy++2Nd9/UVe/rKXmV137bWe9rTv97/c734uuOACF154oZe85Kf1UxuLOKxB7dTinZe/w9Of/nT3ve993e3ud/fN3/zNrnr/+62u/YfrPOc/Psf97nc/d7vH3V1yySWuuuoqQ8W+UEMcVpPaqa1a1VAHahJDHFGxL9QQh9WkdmqrVjXUgZrEEEdU7As1xGE1qZ3aqlUNdaAmMcQRFftCDXFYTWqntmpVQx2oSQxxRMW+UEMcVpPaqa1a1VAHahJDHFGxL9QQh9WkdmqrVjXUgZrEEEdU7As1xGE1qZ3aqtWJmoQ6UENjEjuxFUPFEHW6au3ULGY3Pessj7740e79FfchnHf+eS6++GKff4c7qKHhox+71s/93M+55JJLfNmXfZmnP+1pPvDBDxrq1re+tcc85jEe+FX39yd/8ic+/rGPiVW9+tW/6kd+5Efc61738h1PfKKf//lfUMTwniuu8NjHP9bZNz/bD/zAD7jiyiv9/h+80awxiZe//OWe8YxnuMc97+GFL3yh25xzjkd/08U++tG/F1x77bXe+tY3e8YznuEhD36wb/vWx3jRi17k9a//PS1nnXWWiy++2L3ucx/E+eef79EXX+yOd7ijmoQa/vzNb/bmt7zVRz7yEY1J7MRWDBVD1N3udjdPeMITfNX972/2hCd8hyd8xxP863/9r80+eu213ve+q3zXk5/s/3z5yz3swod5/gt+1M+8/GfVgRqaInbCZrPx3U/9Hu+8/J2e/ewf8p9e9CJf+qVf6uMf+3ur73riE73yla/0jd/4DZ7+tKf7q/e+11Of+lQ1i301CXWghsYkdmIrhoohahWrau3ULPbVJNTpGpPYia0YKoaoVayqtVOz2FeTUAdqaExiJ7ZiqBiiVrGq1k7NYl9NQh2ooTGJndiKoWKIWsWqWjs1i301CXWghsYkdmIrhoohahWrau3ULPbVJNSBGhqT2ImtGCqGqFWsqrVTs9hXk1AHamhMYie2Yiidbbq16Wdi08m9v7D94pu2X3zT9gNXddh0selk0wObLjbd2nTfS1/60l5w8mTf/Oa3dPY3f/Phnjx55/76r/96j/qLv/iL3vnkyb79bW9rN+2mw6lHPrIPfOBXdbFpX/Oa3+3Jkyf7i7/0i203feGLXtgL7nyyH/rg1W03/bu//dtecMHJfud3fmdnn/zEJ3ryzif7vd/7vV1dd911vdvd79bLLrussz/9kz/ryZMn+7Mve1kXm/YhD31on/nMZ3TYdLHpZNMDmy423dr08Y97XL/2a7+mr33ta/uPtenwi7/wi73zyZM9sOli08mmBzZ99Dc/uo/51sd02HT1yle+sidPnuxRH/vYx3ry5Mm++CUv7lGbtm/+8z/vyTuf7K9cemlXb3vbW3vy5Mm+53+8p+2mBzZdbLq16Wdi061Nu+m+TRebTjY9sOli02HzqfaLb9p+8U3bL75p/7E23dq0m+7bdLHpZNMDmy423dr0M7Hp1qbddN+mi00nmx7YdLHp1qafiU23Nu2m+zZdbDrZ9MCmi023Nv1MbLq1aTfdt+li08mmBzZdbLq16Wdi061Nu+m+TRebTjY9sOli061N/7HOslVEzFoSiyKKWBRBkaqIIc4kFjGJImaxKiJmLYnFRtzlLl9idtvb3sY5t72dK668kiJVEUPQlBDDOy6/3EMe8hCLcNe7/jM1qUlcccWV7nCHOzjn9ueYffbnfI4v+qI7Wb33fe+TE3XZZZe57LLLKE6ETf3O7/y2f/OIR5Ca3eue90RJ3PUud/Ge91xhiEVMoohZrIqIF7/kJVoSiyKKWBRBkaqIIWaVEPtiEX7pl17hl/7zL3n3X/6l1T+765crImatnSKKmN3i5rfwkIc+1At+5AXe9Md/7J73urev/Zqvcfvb317wrne/S8LTvv/7Pe37n4Za/f4f/L7zzv8mRcxiVUTMWhKLIopYFEGRqoghZiUR+2IRkyhiFqsi4qgiilgUQZGqiCFmJRH7YhGTKGIWqyJi1pJYFFHEogiKVEUMMSuJ2BeLmEQRs1gVEbOWxKKIIhZFUKQqYohZScS+WMQkipjFqoiYtSQWRRSxKIIiVRFDzEoi9sUiJlHELFZFxKwlsSiiiEURFKmKGGJWErEvFjGJImaxKiJmLYlFEUUsiqBInWUWYk+KmMUsdlKEFBFbRRyrKmKVlsROiD0pIrjVLW/hxImz7KT6qQ0pIoYUweaEoYjZzc6+mdXNzv4sacXwyU98ws1ufrY4cMtb3Vxi8Ynrr9fGM57xDPe9731RnMDGzW9+C0GQcqvP/mwawokT8alPfcqsKmKVlsROiD0pYhaz2EkRUkRsFUGjZrWqinjjG9/o/3jWM/27b/t3nv2sZznn9rfzzGc80zXXXCP2pBKLmMVO6gU/8nwPftADveY1r/WC5z/fjz7/+S77r5f50rt8meuv+4Tila/8ZZ/7ubemNEXc9ra3MUtLYifEnhQxi1nspAgpIraKoCEmRcyqIlZpSeyEOF7MYidFSBGxVQQNMSliVhWxSktiJ8SeFDGLWeykCCkitoqgISZFzKoiVmlJ7ITYkyJmMYudFCFFxFYRNMSkiFlVxCotiZ0Qe1LELGaxkyKkiNgqgoaYFDGrililJbETYk+KmMUsdlKEFBFbRdAQkyJmVRGrtCR2QuxJEbOYxU6KkCLOslXEELGviFUoEqsicbpaRKyKJGZtJTErYoiY1VDEVqItYlU0KFKzipTzzz/fW/78LVZve9vbSTS0de4XfKHf+M3f8Pcf/ZjPvtUt/cN113n7297ui8491+zcc89VfPTv/955551nUcTOBk1piUWFWkSsiiRmbSUxK4LnPfd5rvnINb7hG77ev/gXdzMrYhWKxKpIDLGoUISI2a/92v/jtrc9x1OeOjPsOgAAIABJREFU8hRJXH/99f7sT//Ueeefr4gh4pxzzjG7+uqrnXO724lVnDgRD37wQzz4wQ/xfd/3/e7zlffxm7/9m770Ll/m/Dudj/jkpzbO+6LziEOKJGYveclL/PX73+/+D3iAf/mv/pUYIvYVsQpFYlUkhlhUpAgRqyKJWVtJzIo4XhGrUCRWRWKIRUWKELEqkpi1lcSsiCFiXxGrUCRWRWKIRUWKELEqkpi1lcSsiCFiXxGrUCRWRWKIRUWKELEqkpi1lcSsiCFiXxGrUCRWRWKIRUWKELEqkpi1lcSsiCFiXxGrUCRWRWKIRUWKELEqkpi1lcSsiCFiXxGrUCRmJywqjqidWNWsMSm1iDOIPTWLVSUxVBxRO7EqpTEp5ZprPuz9V13lr//6A4IPfuADrrrqKtd8+MOEr374w735rW/2spf9rD/7sz/zn174IotWEg966INpPec/PNtfvP0vPOtZzzLrxuLss8/2zRc/2otf/BIve9nPet/73ufd/+P/89Kf+Wlv/IM3msXshJi0ZkFiT81iVUkMFcOrXnWZSy+91JVXvNcqVjVrTEotYk9rFpPYU1/5lfd1zd982Bve8Abvetc7PfOZz/TRj38MFYfd6573NvvxH/9xb33LW/zVlX+F+shHPuJHX/hjLn/nO3zkmo9405v+Xwnnnnue2b3ueU8XfMlJP/gDP+BXf/XVPnT11d7y1rd49rN/yNVXXy1W9du//dv+8//1Cu985+XiiNqJVc0ak1KL2NOaxST21CxWlcRQcWaxqlljUmoRe1qzmMSemsWqkhgqjqidWNWsMSm1iD2tWUxiT81iVUkMFUfUTqxq1piUWsSe1iwmsadmsaokhoojaidWNWtMSi1iT2sWk9hTs1hVEkPFEbUTq5o1JqUWsac1i0nsqVmsKomh4ojaiVXNGpNSzqKIGmJoiCKGImYxC0FNSuI4bSVBUEMQihRRQwwNUWeffbahCOFEghCe8b8/02/8xq+TEC655BIVD3rQA73oRS/yyG/8Rn/+p3/qh3/4edh40IMfREhuQvnyu97VU5/6vZ77vOf6lUsvdac7ne+CCy7gJkER3/2Up9hsPum5P/xcP/zc51LueIc7eP4LfpSiRTVIzJJoaCsJghqCUKSIGs76rJua9YRJEUMRs5iFoCYlsUgkJ6hFW0kQD3jA/T3wwV/lsY97LI27/fN/7iEPebArr3ivGmK4xa1u6UUv/DEv+emXesUrXuGhD3mwH/2xF2rrVZdd5iU/9VMqbnmLWzj1jY/0iEf8G7ObnHWWn/yJn/L0pz/NU77nqbqpE4m7fvmXO+usm6AI4uoPfgj1+Z9/RzXE0BBFDEXMYhaCmpTEIrGvrSQIaghCkSJqiH1FDEXMYhaCmpTEIrGvrSQIaghCkSJqiKEhihiKmMUsBDUpiUViX1tJENQQhCJF1BBDQxQxFDGLWQhqUhKLxL62kiCoIQhFiqghhoYoYihiFrMQ1KQkFol9bSVBUEMQihRRQwwNUcRQxCxmIahJSSwS+9pKgqCGIBQpooYYGqKIoYhZzEJIJ/4naohJDXGsfsW5cvUHLP7bFdz+jqSIIjXEjVZDTGqIY9UQW0Xqmms+4hOf/JTPu93tLOKQf7juOh+6+mpf+AVfQGJfDZ+4/npXve/9bnWrWzrn9ueIOKqG2CpSRJEa4karISY1xLFqiK0iRRQpf/d3f+8Tn7zeOeec48aoISa1+NCHP+TjH/24c7/oXCdywqqG4KMf/ZgPffCDzrn9bX3OZ3+uIrX4q/f9lfvf//7OPfdcv/Wbv+XETU44kxpiUkMcq4bYKlJEkRridC3/9GZ23n29WQ0xqSGOVUNsFSmiSA1xo9UQkxriWDXEVpEiitQQN1oNMakhjlVDbBUpokgNcaPVEJMa4lg1xFaRIorUEDdaDTGpIY5VQ2wVKaJIDXGj1RCTGmJxllkRijhQREUogjisNBUxiwNFYhKzKImhhlCEIg4UURGKIA4rTUXMogiqIjGJ29zmNqgDNYRys7PP9gVf+IX2FVERymd91mc5/07nOaQ0FTGLIqiKxCRmURJDDaEIRRwooiIUQRxWmoqYRRFURWISsyiJz/ncz0ZRhCIUcaCIilAEsbj9ObfnHJSqiFkUQd3yVrd0q1vdySpKYvbf//ubUE9+8pOdOHHCrIgDRVSEIojDSlMRsyiCqkhMYhYlMdQQilDEgSIqQhHEYaWpiFkUQVUkJjGLkhhqCEUo4kARFaEI4rDSVMQsiqAqEpOYRUkMNYQiFHGgiIpQBHFYaSpiFkVQFYlJzKIkhhpCEYo4UERFKII4rDQVMYsiqIrEJGZREkMNoQhFHCiiIhRBHFaaiphFEVRFYhKzKImhhlCEIg4UURGKIA7Jpm18+orYKu5zLld/wOK/vYfP+yeKFHGaIj59RWzVEFtFFCniNEV8+orYqiG2iihSxGmK+PQVsVVDbBVRpIjTFPHpK2KrhtgqokgRO+9973v91fve5973/go3ORGfriK2aoitIooUcZoitlr+6c3svPt6/zNFbNUQW0UUKeI0RXz6itiqIbaKKFLEaYr49BWxVUNsFVGkiNMU8ekrYquG2CqiSBGnKeLTV8RWDbFVRJEiTlPEp++stCSUhrjxiphVReKImKWIY6UloTTEjVfErCoSR8QsRRwrLQmlIW68ImZVkTgiZiniWGlJKA1x4xUxq4rEETFLEcdKS0JpiBuviFlVJI6IWYo45Nxzz3XuuefSWpSGuPGKmFVF4oiYpYhjpSWhFHHjFTGrisQRMUsRx0pLQmmIG6+IWVUkjohZijhWWhJKQ9x4RcyqInFEzFLEsdKSUBrixitiVhWJI2KWIo6VloTSEDdeEbOqSBwRsxRxrLQklIa48YoTEosQQ92AoiixijhdbcVhLWqRWIQY6gYURYlVxKoWpbbisBa1SCxCDHUDiqLEKmJVi1JbcViLWiQWIYa6AUVRYhWxqkWprTisRS0SixBD3YCiKLGKWNWi1FYc1qIWiUWIoW5AUZRYRaxqUWorDmtRi8QixI1QFCVWEatalNqKw1rUIrEIMdQNKIoSq4hVLUptxWEtapFYhBjqBhRFiVXEqhaltuKwFrVILEIMdQOKosQqYlWLUltxWItaJBYhhroBRVFiFbGqRamtOKxFLRKLEEPdgKIowQk7tSgxqeOlhMaizixqpw4kiNpXixKTOl5KaCzqiMYiRO3UgQRR+2pRYlLHSwmNRR3RWISonTqQIGpfLUpM6ngpobGoIxqLELVTBxJE7atFiUkdLyU0FnVEYxGidupAgqh9tSgxqeOlhMaijmgsQtROHUgQta9ulJTQWNQRjUWI2qkDCaL21aLEpI6XEhqLOqKxCFE7dSBB1L5alJjU8VJCY1FHNBYhaqcOJIjaV4sSkzpeSmgs6ojGIkTt1IEEUftqUWJSx0sJjUUd0ViEqJ06kCBqXy1KTOp4KaGxOGEnZo1JiWNVzGKIOpOKRRHUIbEvZo1JiWNVzGKIOiS1qlgUQR0S+2LWmJQ4VsUshqhDUquKRRHUIbEvZo1JiWNVzGKIOiS1qlgUQR0S+2LWmJQ4VsUshqhDUquKRRHUIbEvZo1JiWNVzGKIOiS1qlgUQR0S++LGqJjFEHVIalWxKII6JPbFrDEpcayKWQxRh6RWFYsiqENiX8wakxLHqpjFEHVIalWxKII6JPbFrDEpcayKWQxRh6RWFYsiqENiX8wakxLHqpjFEHVIalWxKII6JPbFrDEpcayKWQwnKDWUmEXtq6HiqFjVYbEVQ2ooaig1lJhF7auh4qhY1SzUpGIrhtRQ1FBqKDGL2ldDxVGxqlmoScVWDKmhqKHUUGIWta+GiqNiVbNQk4qtGFJDUUOpocQsal8NFUfFqmahJhVbMaSGooZSQ4lZ1L4aKo6KVc1CTSq2YkgNRQ2lhjqDGiqOilXNQk0qtmJIDUUNpYYSs6h9NVQcFauahZpUbMWQGooaSg0lZlH7aqg4KlY1CzWp2IohNRQ1lBpKzKL21VBxVKxqFmpSsRVDaihqKDWUmEXtq6HiqFjVLNSkYiuG1FDUUGooMYvaV0PFYSeIxhA7UUMRQ6zaGqqGOKImdSCGIIZoDLETNRQxxKqtoWqISWlMQk3qQAxBDNEYYidqKGKIVVtD1RCT0piEmtSBGIIYojHETtRQxBCrtoaqISalMQk1qQMxBDFEY4idqKGIIVZtDVVDTEpjEmpSB2IIYojGEDtRQxFDrNoaqoaYlMYk1KQOxBDEEI0hjlHEEKu2hqohJqUxCTWpAzEEMURjiJ2ooYghVm0NVUNMSmMSalIHYghiiMYQO1FDEUOs2hqqhpiUxiTUpA7EEMQQjSF2ooYihli1NVQNMSmNSahJHYghiCEaQ+xEDUUMsWprqBpiUhqTUJM6EEMQQzSG2Ikaihhi1dbshEkcJ2YVs9aitUhi0YgzCBU7tVX74jgxq5i1Fq1FEotG7AmxFSp2aqv2xXFiVjFrLVqLJBaN2BNiK1Ts1Fbti+PErGLWWrQWSSwasSfEVqjYqa3aF8eJWcWstWgtklg0Yk+IrVCxU1u1L44Ts4pZa9FaJLFoxJ4QW6Fip7ZqX5xZxay1aC2SWDRiT4itULFTW7UvjhOzillr0VoksWjEnhBboWKntmpfHCdmFbPWorVIYtGIPSG2QsVObdW+OE7MKmatRWuRxKIRe0JshYqd2qp9cZyYVcxai9YiiUUj9oTYChU7tVX74jgxq5i1Fq1FErMTNatF66gYEovEnhKLmpQ6LA40JkWsalaL1lExJBaJPSUWNSl1WBxoTIpY1awWraNiSCwSe0osalLqsDjQmBSxqlktWkfFkFgk9pRY1KTUYXGgMSliVbNatI6KIbFI7CmxqEmpw+JAY1LEqma1aB0VQ2KR2FNiUZNSh8WBxqSIVc1q0ToqhsQisafEoialDosDjUkRq5rVonVUDIlFYk+JRU1KHRYHGpMiVjWrReuoGBKLxJ4Si5qUOiwONCZFrGpWi9ZRMSQWiT0lFjUpdVgcaEyKWNWsFq2jYkgsEntKLGpS6rA40JgUsapZLVpHxZBYJPbUiZjFrIlVa1GTOoOgZjEJcSYVs1Cuv/56j3/84/z8z/0c4o1vfKPHXXKJt7/97WatRU3qDIKaXXnlFb7lW/6tK99zpeNVzEJtVcxi9lu/+zse//jHm7UWxQ8964f85E/9pNMFNXvUo0552MMu9LALH+bS/3qp01XMQm1VzOL/fvWrPe6SS1x99dVm3/u93+d5z3uemtQZBDWLSYgzqZiFcvnll3ve857rUadOeepTvsesiVVrUZM65NSpUy688EIXXvjVLr30V8xiEuJMKmahtipmMWti1VrUpM4gqFlMQpxJxSzUVsUsZk0cVZM6g6BmMQlxJhWzUFsVs5g1sWotalJnENQsJiHOpGIWaqtiFrMmVq1FTeoMgprFJMSZVMxCbVXMYtbEqrWoSZ1BULOYhDiTilmorYpZzJpYtRY1qTMIahaTEGdSMQu1VTGLWROr1qImdQZxlj2xqiSKmMQNiCKKOLMoYhI+1Y3Xve733P72n2f2wQ9+0O+97nW+9d9+CyqJIiZxA6K47tpr/eEf/qHr/uFaRYrYE0VMQhGx728+dLU3/fEfo5Iogne9+13u+PF/4nhRPOmJT/SpT37Kdz7xiT784WsoYk8UMQlFxOqKK97j9173Otddex3qDW94vS867zwxiRsQRRQxK1LEnihiEp787/+929z61h7xiK9xzjnnmMWqkihiEoc86UlP8slPftITn/idPnLN3yqiiFmRIvZEEZNQROyLVSVRxCRuQBRRxKxIEXuiiEkoIvbFYUVM4gZEEUXMihSxJ4qYhCJiX6wqiSImcQOiiCJmRYrYE0VMQhGxL1aVRBGTuAFRRBGzIkXsiSImoYjYF6tKoohJ3IAooohZkSL2RBGTUETsi1UlUcQkbkAUUcSsSBF7oohJKCL2xaqSKGISZ3RWEUUsigQVcboi9sUsqOMUQRxITWpTk1LEVlARpytiX3DBBV/iHZe/A0FJrIogDsSsKqKIU6dOOfXIU4aKWJRYFbEvuM99vhKVECV2iiAOxKwqohSxFdSJOEYR+2IWFBElsSqCGK666irv/su/9Au/8PPude+vELVTJKiI09V97nMfQzQVs6CIKIlVEcSBmFVFFLEoElTE6YrYF7OgiCiJVRHEgZhVRRRxVByniH0xC4qIklgVQRyIWVVEEYsiQUWcroh9MQuKiJJYFUEciFlVRBGLIkFFnK6IfTELioiSWBVBHIhZVUQRiyJBRZyuiH0xC4qIklgVQRyIWVVEEYsiQUWcroh9MQuKiJJYFUEciFlVRBGLIkFFnK6I1YmYxU4sKg5UrULtKbVo47CaxVZt1RBRhNAiFtde9w8uuugiv/Zrv4aq4b/8l1/2TY/6JpvNxuyv33+VU4885dSjHuWRj/wmV7znSsRQs9e+9jWe8IQnuODkBe573/t6ylO/2xDB6177OqdOnfLIU6c85tseY1ZxoD7yd3/rSU/6Lhdc8CUe/tUP90d/9EeGUos22iCGmgXXXXed5/yH57jf/e7n7ve4m0suucRVV71fzGLWIhYVra2q4fWvf4OLvu4i3/7t324otWhjiKFmMVz+jne66KKLfOtjvsXsB3/wf/P1F13ku77ryVa/+5rfderUKXe7+z3c/e5399jHPta73/2XahVqJy216P/PHrxH/V4QdKJ+PhsMTc1uo6goSMPe1llOYh41mgmt42UEbLwUoqDlpKBSNqUzik2hXcy8VZZZ2vJS2ZpSz3g9mnlP85LapKhZsxLRDSIKNqBo+v2c7+V3ed+9X4Qm/5m1ep7G5IorrvD0pz/dPe95DwcOHPBDP3Qf73znO6iVes973uOMMx7ktgcOuOc97+WP/uiPtCVmFVtVa6F2KDVrYxGLmsRKrdQiYhJfW9VaqB1KzdpYxKImsVIrtYiYxEbMKraq1kLtUGrWxiIWNYmVWqlFxCQ2YlaxVbUWaodSszYWsahJrNRKLSImsRGziq2qtVA7lJq1sYhFTWKlVmoRMYmNmFVsVa2F2qHUrI1FLGoSK7VSi4hJbMSsYqtqLdTGvtpbaoeIRY1io0IoktotFjWLWXHkkddz5pkPdqe73NnkuOOOc9ZZZzr66KNNbnDU9X3bt32b//bf/hgRixe9+MVuecwt7du3z+TGN/lm//E/PswP/uAP+qsP/KWrvnilWouLL77YI885x41vfGMvfNELPelJT9ZaqeJfn7Dfwx72MLe5zXHe8Y53mKR2iDf/2Rtdfvnn/PJTfpnwkIc8xKWXXqpCKJKiKhaxqMc85jH+5KV/4vTTH+i8857ooos+6XGPe6xa3O52t3PWWWe60Y1uZHLGj5zunve8p0XE4nOXX+6DH/qgCy64wKRCKJKa1FosanLzWxzt3HPP9eAHn4l40IPO8Ohzz/XgB59p7aMf/ag73elOfuNZv+YXfuEX/MM//C8//MM/4uovfMGkRrExCKFIavKbv/XbXvKSl/iJn/hJL37xi93ntNNcfvkVxOwDf/VXzjrrIW50oxt65q89y7/7d9/v/PPP9573vsdaaoeIRY1io0IokprUWixqFrNaq7ouIhY1io0KoUhqUmuxqFnMaq1qb6kdIhY1io0KoUhqUmuxqFnMaq1qb6kdIhY1io0KoUhqUmuxqFnMaq1qb6kdIhY1io0KoUhqUmuxqFnMaq1qb6kdIhY1io0KoUhqUmuxqFnMaq1qb6kdIhY1iq2hk6GToaOhOwztMHQ29BBDO/RwdzqmPf567fHXaz99sMPQ2dChG0M3hk6GToaOhm68+tWv6v4TTujFF1/cDu3f/M3fdP/+A33b297admiHbnz0Ix/p/v37e8EFF3Snd7zjnd2//0D/8n1/2Y2hG0MnQye//wd/0P0nHOjW0A5DH/KQh3T/Cft79dVXd/Lxj/999+8/ob/3/N/roU488cQ+73nP69owtP/jf/x1T9h/Ql/2spd1NrQfvuCC7t9/Qv/+4x9vO3QydDR0h6Edhs6Gzt785rf0vvf9D33EIx7eDr1Ww9DZ0KFrH/3IR3tg//5ecMEFHToZOhk6GrrD0Pe8+93dv39/3/++93e3oSfe/sQ+7/nP76Ee+MAH9sd+7Mc6GYbOhg5de8TDH96Tv//7+5WvfKVDJ0Mf9chH9b88/vHt0B2Gdhg6G3qIoR16rYahs6FDN4ZuDJ0MnQzD0B5/vfb467XHX6/t0A5DZ0MPMbRDr9UwdDZ06MbQjaGToZOho6E7DO0wdDb0EEM79FoNQ2dDh24M3Rg6GToZOhq6w9AOQ2dDDzG0Q6/VMHQ2dOjG0I2hk6GToaOhOwztMHQ29BBDO/RaDUNnQ4duDN0YOhk6GToausPQDkNnQw8xtEOv1TB0NnToxtCNoZOhk6GjoTsM7TB0NvQQQzu0R8ZWjFIVKRJiEaOqiFFDjIqY1WESs4i9xFaMUhUpd73b3dgXb/izNzjrzLP86etf5xtv+I1O+t6TaIhREQ1K1E53vOP3+LZv/1aP+PGHu9sP/IC73OV7nXbKKY66wfVNYitGGRQpEoJw+xNv76ijvkFx7K2PdcNvvJFPXPQJFDErUTsl/N3f/a194glPeIInPOE8OpB9iD//8z933LEPMolRqiJFQixiVCff9WR3vevJFDEqYlakiLXELGItqJjEVnDhJz7uGc98lve9570uu/yzZuHKq65EVcSoIehgo0jd5z73cf7557vf/e7npJNOcu9T7u27vvO7rH3wgx/02c9d7ru+67sUURXBrzzll1WkSIhFjKoiRg0xKmJWpIi1xCxiL7EVhwqxiFFVxKghRkXMihSxlphF7CW2YpSqSJEQixhVRYwaYlTErEgRa4lZxF5iK0apihQJsYhRVcSoIUZFzIoUsZaYRewltmKUqkiREIsYVUWMGmJUxKxIEWuJWcReYitGqYoUCbGIUVXEqCFGRcyKFLGWmEXsJbZilKpIkRCLGFVFjBrCkYrETjEKihRRk4iVFEEUQUPspYgiRqGIUZHYKUbhhje4oR+6z3288r+/woMffKY/funL/PAD7u+II49EEUSNSkPFTt/wDd/gDa9/vZe/4hXe+pa3+tknnueZz3qGN7/lLY663jdQJCaxiFFQpFKOuv71VcQocYMbHOWrX/0qoggaKoid/vHLXzIk/uSP/9i3fNNNNDTsa3zLN38zYqcYBUWKqEnESoogiqAh4nBFFEH30VSEIjFrPf7xj/e5z13uif/1iW574Dt94qILnXP2Ob7y1a+qiJXUJIkiaIg444wz3PY7b+v/e+3rvPzlL/f85/2un3/ykz3w9AcKrv7yl9z3/vf1qLMfqR1INBwhJjEKihRRk4iVFEEUQUPE4YooYhSKGBWJPRUpoiYRKymCKIKGiMMVUcQoFDEqEjvFKChSRE0iVlIEUQQNEYcroohRKGJUJHaKUVCkiJpErKQIoggaIg5XRBGjUMSoSOwUo6BIETWJWEkRRBE0RByuiCJGoYhRkdgpRkGRImoSsZIiiCJoiDhcEUWMQhGjIrFTjIIiRdQkYiVF7BNqpUaxEaNQglipUaylRhWHq0kosZXWLNRKjWIjnHrqaf76rz/kNa96tU9fcol73/sUahRrqVHFpGY1K254oxs760Fnev7znud5z3++z172We9917vNQi1ao9iIUbTxnne92/DVr5pc+ulLXfbZy9385jc3SY0qOOaYW/r0py+hZsWxx91Ghhq++lW3Pu5Yxx57rONudWu3PvbWbnyTb1IrNYqNGIUSBB/4wAec94TzPO1pz7CWGlVMalazmoQSKyVDVQm1+OQnP+X97/+As88+273vfYrjv+N4H//4hdqIiJUaxTHHHOOSSz4tNaqY1OTE7z7Reec9wdve/nYn3uGO/vvL/l+xOLD/gEsvvsStj721Y487zq2PPdZxtz7WrW51a8Ta3/7d3zr//Cd50vlPFsRKjWItNaqY1KxmNQklttKahVqp3WIUShArNYq11KhiUrOa1SSU2EprFmqlRrERo1CCWKlRrKVGFZOa1awmocRWWrNQKzWKjRiFEsRKjWItNaqY1KxmNQklttKahVqpUWzEKJQgVmoUa6lRxaRmNatJKLGV1izUSo1iI0ahBLFSo1hLjSomNatZTUKJrbRmoVZqFBsxCiWIlRrFZJ+d4jA1ilFtxC4NGnuJUUvslqhDxGG+96ST3PBG3+ixj/sZRx99M9/93bcnNj53+ed86uKDLrn40yaXXvoZBw8e9LnLP2vy/ve9zx/+wR/45Kc+6dJPX+q9732v4ha3vKVaXHzwYgcPHnTFFZcjDh486OKDB1111VVqlKrBU5/6Kz784Y946lN/BXWve93LpEFjco+738NrXvMaf/bGN7jggg/70tVX+7/veEcHbnvAf/3Zn/XKV77SZy67zAc/9CG/+Eu/5LLPXmYjDlOjGNXkE5+4yMtf/jKvfvWrrDVoLGKWmsSoJXYIidrtlre8hWNudStvetObfOLCC73qVa/yO7/7O6QYbMTs7ne/u9e89jXe8MY/c8GHPuzqq69GPPvZz/aX73uvK664wkc/8hEXfvzvHXvcsdZ+9Ed/zDve+U6//JSn+PBHPuzgpw56xStf4SUv+UM7XXLJJV7yRy/xkj/6Q9RG7NKgsYhZahKjltgtUYeIw9QoRrURuzRoLGKWmsSoJXZL1CHiMDWKUW3ELg0ai5ilJjFqid0SdYg4TI1iVBuxS4PGImapSYxaYrdEHSIOU6MY1Ubs0qCxiFlqEqOW2C1Rh4jD1ChGtRG7NGgsYpaaxKgldkvUIeIwNYpRbcTGkUpiD0XEWhRxuBjFNUtsFDGLUUnsoYjrHXmk+9///n7/xb/vh3/kdIldnnT+k7zuda+zdvYI4F7XAAAgAElEQVQjztZ99e/v8e/9+m/8un/8x3/0jGc905N/4RcQxx17rPPP/3nHH3+8WTnt1FNc+YWrGBDudrcfwODnfv7nPfhBD3bEEUc48fZ38LrX/6kXvejFJuc/6XzHH3+8SYxi9iM/crrPXXG5cx/9E6pe/epXO+GEEzznOc/xxCf+rMc99nHsQ7nd7W7nyH1Hir0UEWtRJNQoNmIUi9JUxEZio0hNYlQSs+zb57/85//sV3/1ae5+j7uT+Kmf/Cm/9uu/5oh9Ryhi6/TTT3fFFVc499GPNnn1a17thO84wQcv+KDf+s3fUjX5wf/nB/30T/+0WbnnPe/h537u5zz5yU/2ohe8UMI33uiGfuY//YytuvyKy+2zzzG3OgZRxOFiFIvSVMRGYqOIWYxK4hrFWhRxuBjFojQVsZHYKGIWo5LYQxGxFkUcLkaxKE1FbCQ2ipjFqCT2UESsRRGHi1EsSlMRG4mNImYxKok9FBFrUcThYhSL0lTERmKjiFmMSmIPRcRaFHG4GMWiNBWxkdgoYhajkthDEbEWReyWjuyliFkRRWwUQZGaVOTOt+KyT5v9xYXc9OZmpSFWWhLXqIhZEUVsFEGRmlSkCEUsOtQll1yi4RY3v7lZS+IaFTErojrUJz71STf7Vzd1/aOuT1CkJhUpQhE7lIarrrzSZz7zGd/+rd/qxje5iWtUxKyIIjaKoEhNKlKEInYoDbHSkthT66KLPukWt7yFI444QhFFbBRBkZpUpAj/cOX/8tnPXOYWt7iFo446itIQK62hXHzxQUnc7GY3c8QRR9goT/zZJ3rpS1/maU9/mvucdipiowiK1KQiRShih9IQKy2JXVr+9VE2/ueXTYooYqMIitSkIkUoYofSECstiWtUxKyIIjaKoEhNKlKEInYoDbHSkrhGRcyKKGKjCIrUpCJFKGKH0hArLYlrVMSsiCI2iqBITSpShCJ2KA2x0pK4RkXMiihiowiK1KQiRShih9IQKy2Ja1TErIgiNoqQdigxK+Kf58634rJPm/3FhfyrmxO7FLFWxKyIr48iKGKXItaKmBXx9VEERexSxFoRsyK+PoqgiF2KWCtiVsTXRxEUsUsRa0XMitg46aST3PjGN/ba177WEUcc4Z+kCIrYpYi1ImZDOeEoG//zy/63FUERuxSxVsSsiK+PIihilyLWipgV8fVRBEXsUsRaEbMivj6KoIhdilgrYlbE10cRFLFLEWtFzIr4JzmSUASxW5EiZkWMipgUQRF7iENUxFYogtitSBGzIkZFTIqgiEWRWMQhKmIrFEHsVqSIWRGjIiZFUMSiSCziEBWxFYogditSxKyIURGTIihiUSQWcYiK2ApFELsVKWJWxKiISREUsSgSizhERWyFIoiNYRg84+nPdMtbHu2II44wK2JUxKQIilgUiUUcoiK2QhHEbkWKmBUxKmJSBEUsisQiDlERW6EIYrciRcyKGBUxKYIiFkViEYeoiK1QBLFbkSJmRYyKmBRBEYsisYhDVMRWKILYrUgRsyJGRUyKoIhFkVjEISpiKxRB7FakiFkRoyImRVDEokgs4hAVsRWKIHYrUsSsiFERk301CrVVi8YoNmIlFhWLqNn1b2Dji1dpbdQkdqpRqK1aNEaxESuxqFhErcVatTZqEjvVKNRWLRqj2IiVWFQsotZirVobNYmdahRqqxaNUWzESiwqFlFrsVatjZrETjUKtVWLxig2YiUWFYuotVir1kZNYqcahdoq9u3b5y4n3cWtjz3ORqzEomIRtRZr1dqoSexUo1CjL37BxlHX1xjFRqzEomIRtRZr1dqoSexUo1BbtWiMYiNWYlGxiFqLtWpt1CR2qlGorVo0RrERK7GoWEStxVq1NmoSO9Uo1FYtGqPYiJVYVCyi1mKtWhs1iZ1qFGqrFo1RbMRKLCoWUWuxVq2NmsRONQq1VYvGKDZiJRa1L0YlJjWJRVyb2Ioa3eYEGy99scSoJqlRbVWMSkxqEou4NrEVtVJqEolRTVKj2qoYlZjUJBZxbWIraqXUJBKjmqRGtVUxKjGpSSzi2sRW1EqpSSRGNUmNaqtiVGJSk1jEtYmtqJVSk0iMapIa1VbFqMSkJrGIaxNbUSulJpEY1SQ1qq2KUYnRS19o4zb7xbWJraiVUpNIjGqSGtVWxajEpCaxiGsTW1ErpSaRGNUkNaqtilGJSU1iEdcmtqJWSk0iMapJalRbFaMSk5rEIq5NbEWtlJpEYlST1Ki2KkYlJjWJRVyb2IpaKTWJxKgmqVFtVYxKTGoSi7g2caSVImLSkpgVUcSsCIpURSxidNrpvP0NZs/5FT77Ge56L4480loRO5SGWLQkZkUUMSuCIlURi5gUEdesiB1KQyxaErMiipgVQZGqiEVMiohrVsQOpSEWLYlZEUXMiqBIVcQiJkXENStih9IQi5bErIgiZkVQpCpiEZMi4poVsUNpiEVLYlZEEbMiKFIVsYhJEXHNitjhK1/V975dXvSbNk473aSIImZFUKQqYhGTkoidYhajKGISa0XEpCUxK6KIWREUqYpYxKQkYqeYxSiKmMRaETFpScyKKGJWBEWqIhYxKYnYKWYxiiImsVZETFoSsyKKmBVBkaqIRUxKInaKWYyiiEmsFRGTlsSsiCJmRVCkKmIRk5KInWIWoyhiEmtFxKQlMSuiiFkRFKl05BBVEXsrgiI2iuArX+XMu/PeP/cv/sX/iXrg/5KXv5Pr38DhiqCIjSIoYlTEpCpioyVxTaoi9lYERWwUQRGjIiZVERstiWtSFbG3IihiowiKGBUxqYrYaElck6qIvRVBERtFUMSoiElVxEZL4ppUReytCIrYKIIiRkVMqiI2WhLXpCpib0VQxD4rtRWxU+0UahRrNYrFkUfwuy/Xk+/pX/yL/+Pc4S7ywtdy/RtYq51CjWKtRrGIWYWaRazVKDFpa622InaqnUKNYq1GsYhZhZpFrNUoMWlrrbYidqqdQo1irUaxiFmFmkWs1SgxaWuttiJ2qp1CjWKtRrGIWYWaRazVKDFpa622InaqnUKNYq1GsYhZhZpFrNUoMWlrrbYidqqdQo1iko4oYpciDlFEEaUhdmtJzN75Zv7slRy8iK/8o3+SIvZUxKiI3Yr45ytiT0WMititiH++IvZUxKiI3Yr45ytiT0WMititiH++IvZUxKiI3Yr4pzniSG52C+56L+52bxKKOEQRRZSG2K0lcbgitopYFLFLEYcooojSELu1JA5XxFYRiyJ2KeIQRRRRGmK3lsThitgqYlHELkUcoogiSkPs1pI4XBFbRSyK2KWIQxRRRGmI3VoShytiq4hFEbsUcYgiiiiNtEOJWsSiiCIWRRymRiWxl7aSWNQiZkWKqEUsiihiUcRhalQSe2kriUUtYlakiFrEoogiFkUcpkYlsZe2kljUImZFiqhFLIooYlHEYWpUEntpK4lFLWJWpIhaxKKIIhZFHKZGJbGXtpJY1CJmRYqoRSyKKGJRxGFqVBJ7aSuJRS1iVqSIWsSiiCIWRRymRiWxl7aSWNQiZkWKqEUsiihiUcRhalQSe2kriUUtYlakiFrEoogiFkUcpkYlsZe2kljUImZFiqhFLIooYlHEYWpUEntpK4lFLWJWpIhaxKKIIhZFHKZGJbGXtpJY1CJmRYqoRSyKKGJRxKHSkWtRixjVIvZUi1gpUkSRWsR1VosY1SL2VItYKVJEkVrEdVaLGNUi9lSLWClSRJFaxHVWixjVIvZUi1gpUkSRWsR1VosY1SL2VItYKVJEkVrEdVaLGNUi9lSLWClSRJFaxHVWixjVIvZUi1gpUkSRWsR1VosY1SL2VItYKVJEkVrEdVaLGNUi9lSLWClSRJFaxHVWixjVIvZUi1gpUkSRWsR1VosY1SL2VItYKVJEkVrEdVaLGNUiZvtMala71aSC1CKIrVK1FhWTqlGMYhIlCF/+8pecffYjvOhFL6K8853v9IhzzvGRD3/YWk0qSM0e+qMP9ad/+nobperCCy/00Ic+1Ccu/LiYVI1iFJMoQYyKmtWsdqtJ/dIv/qLf/q3nmAWxVaoedMYZTjnlFKeeem8vf/nLUDWKUUyiBDEqalaz2u0hD32o17/+dYJ//NKXnX322V704hcR3vHOdzr77LN95IIPq1qLiknVKEYxiRLEqKhZzWrrS1/6kpe97OXOOedsDzz9dO9993vMgtgqVWtRT3/605x6yr3d+5RTnP+k8xGTKEGMiprVrHarSQWpRRBbpWotKiZVoxjFJEoQo6JmNavdalJBahHEVqlai4pJ1ShGMYkSxKioWc1qt5pUkFoEsVWq1qJiUjWKUUyiBDEqalaz2q0mFaQWQWyVqrWomFSNYhSTKEGMiprVrHarSQWpRRBbpWotKiZVoxjFJEoQo6JmNavdalJBahHEVqlai4pJ1ShGMYkSxKioWc1qt5pUkFoEsbGvRjGL3WISs9hTQ8SsaCwialKjGsVah3rLW9/mbz72McJnPnOpt775za74/OetxSRmMXvXu97lM5ddZq0h4uqrr/buv3iXq7/4ZYuImtSoRrEVRI1iFrvFJP7ub//WRRddZC8NET/5mMc47/FPcPGnPu3yz12OiJrUqEaxFUSNYha7vfvd73LZZZ81GTp4y1ve4mMf+5jJZy691Fvf8haX/8PnRcyKxiKiJjWqUWwFUaOYxdafv/3tznviE9zudv/GA08/3THHHGMvDRGzonHaqad5/BPO8y3ffBMXXXSRGtUotoKoUcxit5jELPbUEDErGouImtSoRrEVRI1iFrvFJGaxp4aIWdFYRNSkRjWKrSBqFLPYLSYxiz01RMyKxiKiJjWqUWwFUaOYxW4xiVnsqSFiVjQWETWpUY1iK4gaxSx2i0nMYk8NEbOisYioSY1qFFtB1ChmsVtMYhZ7aoiYFY1FRE1qVKPYCqJGMYvdYhKz2NORaUkoDXHdFTGpisQhYpIidinSSmvSgbp2jY0iJrX/wAEf/djf2C0mKWJPaUkoDXG4CvscpohJ3fkudxGj1FZMUsSe0pJQGmKHUiuxiI0BEVRF4hAxSRF7SktCaYjFW976Vne+0509+tGPdk2KmFRFYnbb297W5BWveIXLP/c5KWJPaUkoDXHdFTGpisQhYpIi9pSWhNIQ110Rk6pIHCImKWJPaUkoDXHdFTGpisQhYpIi9pSWhNIQ110Rk6pIHCImKWJPaUkoDXHdFTGpisQhYpIi9pSWhNIQ110Rk6pIHCImKWJPaUkoDXHdFfskZiEW9TUURYm1iLWalVqJ3VpUjRKzEAS10nre857n5JNPdtL3nuS5z32uDChKcPHFF3vQGQ/yoDPO8KAzznDhhR83K7V405vf5NyfONeBAwd830kneezP/Axq8sWrr/bE885z8l1PdtsDB5x6yime+zu/YxgGW/X5yz/vMY95jAP7D7jPaffx7ne9R6xFrNWs1Eq4+ktXe8pTnuKuJ5/sDiee6Jxzznbw4EESk6rnP+/57nryyb73pJM897nPNYmVWgwoGjEpItbqnHPO8YD7399b3/Y2s9itRc0SsxD80i/+ovs/4AFe85rX+NCHPuQBD3iABzzgAd79rnebfPELX3TeE85z1++/q9seOOCUU071u7/zuzoMFjUrRY1it9ab3vRG5557rgO3va3vO+kkj33cY8WiuPrqqz3lKU9x8sknu8Md7uCcs89x8FMHKYoSaxFrNSu1Eru1qFliFmJRX0NRlFiLWKtZqZXYrUXNErMQi/oaiqLEWsRazUqtxG4tapaYhVjU11AUJdYi1mpWaiV2a1GzxCzEor6GoiixFrFWs1IrsVuLmiVmIRb1NRRFibWItZqVWondWtQsMQuxqK+hKEpwpI0ilARFHC5FFEEROzQEIYqYFbFIXO961/PgM890++/+bpNjjzvWWWee5WY3O1qMyitf9SpPf/rTnXbaab7ne77Hs5/9bNlXQkPwTTe5iR972MN84hMX+dVffaqrrvyiWYi6+OJLPPKRj3S/+97PC174QlddeaXXvf5PEcVVX/iCiz71KT/1n37K0Tc92gc+8AHPeuYzHZF9Hv6Ih1t745ve6M53vrNfeeove8ELXuSsh57lHW9/u2+/6U3FDt1HQogiJo/5icd4z1++18N//Mfd9GZHe+ELfs9jH/c4L/nDPzR51ate6RlPf7pTTz3VHe74PX7zN55tpyOPPNKZZ57p9rf/N4Rjb3NrZ515ppsdfbRdGn/9wQ/67GWX+fznL7dRxCIxKWKtiFNPPc33/dt/6znP+W3D8FXnnnuuyfHfcbzJF6++yqcOfspjfvoxjr7pzbz/r/7KM575TNl3hIc//MdpCEJSG0XMDl7yaY961KP8h/vezwte+EJXXXml/58weI/a9S7IA33dmxBiVQSDIvGQGIcdZikKtIpaOrZVRAjpmmoooME/IJCIp1UVRg4tJ1FYAi4YnBlEsc4ArlEBtTJLUDEhGDXKMQTkYCcmIQIBgozIIc17z+95nvf0ffsN+7r+8A1/aFYSfuInftJf//VfufTSS93znvf0ile8wpOe/CSvetUrEUVQxJ6GIEQRsyIWiUkRG0UoCYo4VYoogiL2NAQhipgVsUhMitgoQklQxKlSRBEUsachCFHErIhFYlLERhFKgiJOlSKKoIg9DUGIImZFLBKTIjaKUBIUcaoUUQRF7GkIQhQxK2KRmBSxUYSSoIhTpYgiKGJPQxCiiFkRi8SkiI0ilARFnCpFFDH0mFUnq96RVY9b9ahVN1ZdW3Wx6mmtOll18uhHPboP/t7v7cab3vSm3vvkyb7yVa/szqqT9773vT158mSvu+7d3Vi1vfrqq3vy3if71re9tV31tFZtH/OYS/rYxz22Gz/8wz/ckydP9rOf/WxXba//u+t78oKT/bVf+7W2q+67//3v15e//OWdrLp45zve2ZMXnOxrfuc13XjPddf13icv6N9df30nj3rUo/rg7/3erjpZ9U1/+qZecPKC/l+vfGX3rXrcqket+oQnPKH//t//z33Tn17R2aqLVU9r1cmqP/4TP94n/sgTe9yqx636mMc8po997GO7WHXjp3/6SX3sYx/brrpYdXb1n13dC06e7F+/9W09btX2ne98R09ecLKv/Z3XduO691zXkydP9v+9/voetepRq26surbqYtXTWnWy6h1Z9bhVj1p1Y9W1VRerntaqk1XvyKrHrXrUqhurrq26WPW0Vp2sekdWPW7Vo1bdWHVt1cWqp7XqZNU7supxqx616saqa6suVj2tVSer3pFVj1v1qFU3Vl1bdbHqaa06WfWOrHrUGZSGoCSGKGKjCCriqNgoIhSpiFksUgS1CEpDUBJDFH/zvvd56MO+D0V80zd9oxhqTyyiSEKRivjn/+KfO/seZ7v0cZf67n/7bzzw27/Dwx9+obPOOgtBveqVr/bq33y1D37gbzlRKd943/vaqW+53/3c5S5nmpz7tef64n/2xW644QbERpGEGipi8sG//SDlqU/9WU956lNQk4ir3nKVH/q6c73vfe/z0O97mJjEN37jNykSQxFUxFGxUUS87P94GSliFosUQS2C0hCUxBAttVEEFfGqV73Kq1/9ah/84Adt3Pe+91VEKFJJCWKRIv75v3iALz/7yz3+0sf5t//23/j2B36Hh1/0cGfd5SwJf/vBv9Xys099ip992s/SIqg/e8tbnHfuuXZio4hQpCJmsUgR1CIoDUFJDFHERhFUxFGxUUQoUhGzWKQIahGUhqAkhihiowgq4qjYKCIUqYhZLFIEtQhKQ1ASQxSxUQQVcVRsFBGKVMQsFimCWgSlISiJIYrYKIKKOCo2ighFKmIWixRBLYLSEJTEEEVsFEFFHBUbRYQiFTGLRYqgFkFpCEpiiCI2iqAi9p1BNMQQW1EERSxio60kqIoghtIQoUgRi1jETjTEEFtR1Fl3uQtictZZZ4khtJUEVUFFdEVDhHLmne/sjW/8I7/7u69z5Zuv9LSnPd2LXvQiV1xxpTPPvLOrr/5zz3rOsz3h8Y/3nOc82z3u8RWe9axnu/XWj1sU8UVf9EWIWbjLXe7i9ttvR1UEQVc0QShSn//8bSa/9Tu/4653vZuojbvf/e4as7O+6EwbZ93lTJQWsYiNtpKgKoIYSkOEIkUsYhE70RBDbEVRFLGIP7/6as9+zrNd+rhLPec5z/EV9zjbM579bJ/8xK1iKA0RStROTM488y7e+MY/9ru/+zpXXnmlpz79aV70Sy9yxRVXOPPMM33u87eJ+u3f/m1f9mV3pSERdfe7392krSSoiiCG0hChSBGLWMRONMQQW1EERSxio60kqIoghtIQoUgRi1jETjTEEFtRBEUsYqOtJKiKIIbSEKFIEYtYxE40xBBbUQRFLGKjrSSoiiCG0hChSBGLWMRONMQQW1EERSxio60kqIoghtIQoUgRi1jETjTEEFtRBEUsYqOtJKiKIIbSEKFIEYtYxE40xBBbUQRFLGKjrSTOMMQhMakIWhJaEpKYNRI7IdZCRawVMRSxEYfEeed9vXe8610mLe++7jqroiQxayTEpIRYCxVf8iVf7JJLLnHJD13iLW+5yuMufZxrrvlLD3rQg/w/r3+9e5x9tp/+mZ8R3Hbbbd729rc5/7zzTComf371X7j99tudOHEnt9zyUZ/4xCfc6173opHY+pqv/Rq3fOTDZqHivPPONbn9ttudd+7XoYh95339ed75znfZeO973otoYtKS0JKQxKyR2Akv/MVf9Ilbb/WIRzzC/e5/f7FWxFDERpwqgqgIWhL+6x+83tlffraf+ZknSfjvn//v3vG2t/v6c88zC7G4x1fcwzuvfZetIob6ki/5YpdccolLLrnEVVdd5dLHX+qaa67xoAc9yLnnnivi9ttXvu7c8wQtCa1ZEpOXv+xXfejvP+TB3/09/uW/ehAh1kJFrBUxFLERh8SkImhJaElIYtZI7IRYCxWxVsRQxEYcEpOKoCWhJSGJWSOxE2ItVMRaEUMRG3FITCqCloSWhCRmjcROiLVQEWtFDEVsxCExqQhaEloSkpg1Ejsh1kJFrBUxFLERh8SkImhJaElIYtZI7IRYCxWxVsRQxEYcEpOKoCWhJSGJyYma1Kx1XCwSs8SeErMaSh0VO42hiI2a1Ky176KLHu7d77rWK379Fd71zrd7yYtf4kTsqU/c+gk333yzmz/8YcpHPvpRN998s1s/8QmTt731rV71qle56UM3+cgtH3XNX12DE84556tNHvgd3+ljH/+Yt7z5zT7w/vd75jOf5Z/+6dMasxjCiaw8//nP9zfvfY/nPe95hO/7vocQsxrK9zz4wf7g9a/3J3/8x6677jqf++xnfeu3fqsL7nMfT/tPT/f7v/97Pvaxj7v22nd77s8/1y0f+xjq3z38Ite+611e8Ypf9/Z3vMOLX/JiVGqWmCX2lJjVUIrXvu51Xvua17jxxhvFTmMoYqMmNWttxVCxSMz+5Xd+h49//OOuesubfeAD7/eMZz3Dpz/9aaug1M6/+lf/k7+7/nqvfvWrXfee9/j4rZ9AvfWtb/PKV73aTR+6yUc++lHX/NU1Us65171Mvu2B3+qC+1zg6U9/mv/6+7/vYx//mOvefa3nPve5Pv7xj9mpN/zRG/zmb/6mv/nA+yl1VOw0hiI2alKz1nGxSMwSe0rMaih1VOw0hiI2alKz1nGxSMwSe0rMaih1VOw0hiI2alKz1nGxSMwSe0rMaih1VOw0hiI2alKz1nGxSMwSe0rMaih1VOw0hiI2alKz1nGxSMwSe0rMaih1VOw0hiI2alKz1nGxSMwSe+qMmMSkiVi0JBQp4oCgiBhC3JGKIBQxVAQxaSIWLY9+9KO9/R3v9PxfeD4neMj3PkQRsYhnPeuZ/vAP30BIuPyyy0k95CEP8ZIXv8Rtt93mhS98oec8+1kqzjvvPM/4z//Z+ed/PerB3/PdHvq93+fSJzxBW/e/3/087KEPdf31N5gUd8qdfMv97+8Nb3iD3/iN3zB55jOe6fzzvwFFxBAe9R8e5R/+4ZOe+GM/SvmDP/gD9773vf3vv/xST33a0z3pSU+mCPe97ze58xlnIB71gz/obe94h+c//3kSHvzgh5glFHFAUEQMIbjzmXfWOKYiCEUMFUFMmohFGydOnFCkiNl3f8/3eMhDHuLxlz4ecb/7fbOHPvShbrjxBkLsfOu3/gs/9VM/5aUvfalPfPxjnvHMZ3n0ox/tts/f5kUvfIGfe/YzVZx37nn+8zOe4eu/4RtM7nTiTl760v/N05/+ND/zpCdLywnu+033dcYZZ9iJW275qMlXfdU9CXFHKoJQxFARxKSJWLQkFCnigKCIGELckYogFDFUBDFpIhYtCUWKOCAoIoYQd6QiCEUMFUFMmohFS0KRIg4IioghxB2pCEIRQ0UQkyZi0ZJQpIgDgiJiCHFHKoJQxFARxKSJWLQkFCnigKCIGELckYogFDFUBDFpIhYtCUWKOCDSwSmKKOL0iihiUqSII4pYFHFHiiiCWz95q9tu++++8iu+wiFFFDEpUsRstVr5yIc/ouGce93LpIidT/1/n3Lb529z9tlno4gidlarlZtuuslXfuVXOuuss2wUUcSkSBFHFJ/+9D+65aO3+PJ7nO3LvvSujrv1E7e67fbbfOVXfKUiTq+IIiZFijiiiEURd6SIIg771Kc+5bbbPu/ss++hiCImRYo4oojF7V356Ic/grjXvb7KUUUU//SP/+ijH7vF2V9+trve9a723XTTjb7nux/sq7/2a7zxDX/oTnc6w6RIEUcUsSjijhRRxOkVUcSkSBFHFLEo4o4UUcTpFVHEpEgRRxSxKOKOFFHE6RVRxKRIEUcUsSjijhRRxOkVUcSkSBFHFLEo4o4UUcTpFVHEpEgRRxSxKOKOFFHEF5ZV2yhiVsRQxKmKOMCyNFYAACAASURBVKwIitgo4pCqiCJmRQxFnKqIw4qgiI0iDqmKKGJWxFDEqYo4rAiK2CjikKqIImZFDEWcqojDiqCIjSIOqYooYlbEUMSpijisCIrYKOKQqogiZkUMRZyqiMnv/d7vefL/8mQveuEvufDCh6EIitgo4pCqiCJmRQxFnKqIw4qgiI0iDqmKKGJWxFDEqYo4rAiK2CjikKqIImZFDEWcqojDiqCIjSIOqYooYlbEUMSpijisCIrYKOKQqogiZkUMRZyqiMOKoIiNIg6piihiVsRQxKmK2EgHBxSxURWxVsRaaQgtiT1FbBUxFPGFFLFRFbFWxFppCC2JPUVsFTEU8YUUsVEVsVbEWmkILYk9RWwVMRTxhRSxURWxVsRaaQgtiT1FbBUxFPGFFLFRFbFWxFppCC2JPUVsFTEU8YUUsVEVsVaEG2680c033ejbvu3bnbjTCS2JPUVsFTEU8YUUsVEVsVbEWmkILYk9RWwVMRTxhRSxURWxVsRaaQgtiT1FbBUxFPGFFLFRFbFWxFppCC2JPUVsFTEU8YUUsVEVsVbEWmkILYk9RWwVMRTxhRSxURWxVsRaaQgtiT1FbBUxFPGFFLFRFbFWxCyrtnFAEacoYqcIiiiiiH1FbFRFUBVxQBGnKGKnCIooooh9RWxURVAVcUARpyhipwiKKKKIfUVsVEVQFXFAEacoYqcIiiiiiH1FbFRFUBVxQBGnKGKnCIooooh9RWxURVAVcUARpyhipwiKKKKIfUVsVEVQFXFAEacoYqcIiiiiiH1FbFRFUBVxQBGnKGKnCIooooh9RWxURVAVcUARpyhipwiKKKKIfUVsVEVQFXFAEacoYqcIiiiiiH1FbFRFUBVxQBGnKGKnCIooooh9RWxURVAVcUARpyhi54RZTWqoRQylNatZbJQSi5jEJHZaQ1RtpLGIRU1qqEUMpTWrWWyUEouYxCR2WkNUbaSxiEVNaqhFDKU1q1lslBKLmMQkdlpDVG2ksYhFTWqoRQylNatZbJQSi5jEJHZaQ1RtpLGIRU1qqEUMpTWrWWyUEouYxCR2WkNUbaSxiEVNaqhFDKU1q1lslBKLmMQkdlpDVG2ksYhFTWqoRQylNatZbJQSi5jEJHZaQ1RtpLGIRU1qqEUMpTWrWWyUEouYxCR2WkNUbaSxiEVNaqhFDKU1q1lslBKLmMQkdlpDVG2ksYhFTWqoRQylNatZbJQSi5jEJHZaQ1RtpLGIRU1qqEUMpTWrWWyUEouYxCR2WkNUbaSxiEVNaqhFDKU1q1lslHIidmJI1VBDSMxiqFpriKG2aqh9iVnEIbETQ6qGGkJiFkPVWkMMtVVD7UvMIg6JnRhSNdQQErMYqtYaYqitGmpfYhZxSOzEkKqhhpCYxVC11hBDbdVQ+xKziENiJ4ZUDTWExCyGqrWGGGqrhtqXmEUcEjsxpGqoISRmMVStNcRQWzXUvsQs4pDYiSFVQw0hMYuhaq0hhtqqofYlZhGHxE4MqRpqCIlZDFVrDTHUVg21LzGLOCR2YkjVUENIzGKoWmuIobZqqH2JWcQhsRNDqoYaQmIWQ9VaQwy1VUPtS8wiDomdGFI11BASsxiq1hpiqK0aal9iFnFI7MSQqqGGkJjFULXWEE6oIfbFENRQk6Ii1lKLqEVjiFPVpNZCrdUQ+2IIaqhJURFrqUXUojHEqWpSa6HWaoh9MQQ11KSoiLXUImrRGOJUNam1UGs1xL4YghpqUlTEWmoRtWgMcaqa1FqotRpiXwxBDTUpKmIttYhaNIY4VU1qLdRaDbEvhqCGmhQVsZZaRC0aQ5yqJrUWaq2G2BdDUENNiopYSy2iFo0hTlWTWgu1VkPsiyGooSZFRaylFlGLxhCnqkmthVqrIfbFENRQk6Ii1lKLqEVjiFPVpNZCrdUQ+2IIaqhJURFrqUXUojHEqWpSa6HWaoh9MQQ11KSoiLXUImrRGOJUNam1UGs1xL4YghpqUlTEWmpyQqi1GmIrhlCCWKshNlJDxaRmNatJKLGT1izUWg2xFUMoQazVEBupoWJSs5rVJJTYSWsWaq2G2IohlCDWaoiN1FAxqVnNahJK7KQ1C7VWQ2zFEEoQazXERmqomNSsZjUJJXbSmoVaqyG2YggliLUaYiM1VExqVrOahBI7ac1CrdUQWzGEEsRaDbGRGiomNatZTUKJnbRmodZqiK0YQglirYbYSA0Vk5rVrCahxE5as1BrNcRWDKEEsVZDbKSGiknNalaTUGInrVmotRpiK4ZQglirITZSQ8WkZjWrSSixk9Ys1FoNsRVDKEGs1RAbqaFiUrOa1SSU2ElrFmqthtiKIZQg1mqIjdRQMalZzWoSSuykNQu1VkNsxRBKEGs1xCSdIA4rYlLEIUWK2FPErCVxXBEUcVgRkyIOKVLEniJmLYnjiqCIw4qYFHFIkSL2FDFrSRxXBEUcVsSkiEOKFLGniFlL4rgiKOKwIiZFHFKkiD1FzFoSxxVBEYcVMSnikCJF7Cli1pI4rgiKOKyISRGHFCliTxGzlsRxRVDEYUVMijikSBF7ipi1JI4rgiIOK2JSxCFFithTxKwlcVwRFHFYEZMiDilSxJ4iZi2J44qgiMOKmBRxSJEi9hQxa0kcVwRFHFbEpIjj0lUrDihiXxGnUZqKOKiInSIOKGJfEadRmoo4qIidIg4oYl8Rp1GaijioiJ0iDihiXxGnUZqKOKiInSIOKGJfEadRmoo4qIidIg4oYl8Rp1GaijioiJ0iDihiXxGnUZqKOKiInSIOKGJfEadRmoo4qIidIg4oYl8Rp1GaijioiJ0iDihiXxGnUZqKOKiInSIOKGJfEadRmoo4qIidIg4oYl8RR50QhzU2alKxpxY1FFWLiDqm1BCL1iwOa2zUpGJPLWooqhYRdUypIRatWRzW2KhJxZ5a1FBULSLqmFJDLFqzOKyxUZOKPbWooahaRNQxpYZYtGZxWGOjJhV7alFDUbWIqGNKDbFozeKwxkZNKvbUooaiahFRx5QaYtGaxWGNjZpU7KlFDUXVIqKOKTXEojWLwxobNanYU4saiqpFRB1TaohFaxaHNTZqUrGnFjUUVYuIOqbUEIvWLA5rbNSkYk8taiiqFhF1TKkhFq1ZHNbYqEnFnlrUUFQtIuqYUkMsWrM4rLFRk4o9NTtBbdVObMUkjohFDEHEELPUohYhFsXnb7vNZZdd5r/8n//F5M/+/GqXPeEy73nPe8xiKyZxRCxiCCKGmKUWtQixqCGxqK2aveAFL/CiX3qRjeAjH/6I17zmNX71V3/VNddcQyxiCCKGmKUWNfvFF/yih194oQsvvNAznvlMEovaqp3YCm77/G0uu+wyv/Ebv2Fy9Z9f7bLLLvOe974HQcQQs9SiFiEWNSQWtVVbn/v857z2ta91+eWXe9QjH+mvrvkrR8QihiBiCC/4xV/08Idd6MILL/TMZzzLLMSihsSitmontmISR8QihiBiiFlqUYsQixoSi9qqndiKSRwRixiCiCFmqUUtQixqSCxqq3ZiKyZxRCxiCCKGmKUWtQixqCGxqK3aia2YxBGxiCGIGGKWWtQixKKGxKK2aie2YhJHxCKGIGKIWWpRixCLGhKL2qqd2IpJHBGLGIKIIWapRS1CLGpILGqrdmIrJnFEzE4QahFH1VBbtVYbtaidGmIRx1SwWq1cccUVPvC+D1Bu+cgtrrjyCp/6h3+wVUNt1Vpt1KJ2aohFHFOxL9QiZv/tv/2t66+/nhrqfe97n4c+7GF+7uee63Wve50ffswlXvDCF5rUonZqiEXMLrroIk99ylPc7W5f5kM33mgn1CKOqqEmt69WrvjTK7z//e9HfeSjH3XFFVf45Cc/aVI7NcQijqnYF2oRW1dddZWn/OxTffN9v8kjH/lIX/01X0Ot1UYtaufCf3eRpzz1Ke52t7u54aYbHFWxL9QijqqhtmqtNmpROzXEIo6p2BdqEUfVUFu1Vhu1qJ0aYhHHVOwLtYijaqitWquNWtRODbGIYyr2hVrEUTXUVq3VRi1qp4ZYxDEV+0It4qgaaqvWaqMWtVNDLOKYin2hFnFUDbVVa7VRi9qpIRZxTMW+UIs4qobaqrXaOFFDqJ1aNIbYirVYVCyiNmKjWls1iUkQUSFUTYpaNIbYirVYVCyiNmKjWls1iX01hNqpmDSGePGLX+xLv/RLXXnlFV7/+tf7kSf+qF/9lZe78cYbxCJqIzaqNbvPfe7jOx/0IOec89Vqp4ZQO7VoDLEVa3FCUElMojZio1pbNYl9NYTaKa688krf9u0P9MQf/THf//3f75xzziHWYlGxiNr4Hy+4jwc96EHOOede1FZNYl8NoXZq0RhiK9ZiUbGI2oiNam3VJPbVEGqnFo0htmItFhWLqI3YqNZWTWJfDaF2atEYYivWYlGxiNqIjWpt1ST21RBqpxaNIbZiLRYVi6iN2KjWVk1iXw2hdmrRGGIr1mJRsYjaiI1qbdUk9tUQaqcWjSG2Yi0WFYuojdio1lZNYl8NoXZq0RhiK9ZiUSdiKDGpSSzidGInaq3UJBJDTVJDTRqalaSUNKggFsFf/MVfuPgHLvb2t7/d4x//BBdccNL3f//3+/sP/z3is5/7rF/4+ef5ru/61+7/gAe4/PLL3fyhm9Uk/vaDH3D55Zd5wAMe4D4nL3DxxT/gTW96k0UFb77yzR5+4cM94AH39+QnPcnnP/dZk+DT//iP/uSP/8RFF13krne9q8kjHvEITf3xH/+Jyfve934XX/wIv/f7v+/iiy/2gPs/wEt/+Zd95jOflRhqkhpqp4LbPvd5P/joH/Rbv/V/m8Tij974Ro+4+GKfvPWTFrHRFCHWohaXX3a5H7j4YldddZXEUJPUUDsVQ4lJPffnfs5/eMTFXv/617vu3dd6xMUXu/gHLvaXf/mXJp/5zGc89alP9V3/+rtccMF9XPjwC73sZb9itapaK0USJ2KoSWqoyZv+9E1+7Md/1H3uc4F/+R3f6Uk//STUJPjsZz/reT//C/71d32XB9z/AS6//HI33/z3joqdqLVSk0gMNUkNtVMxlJjUJBZxOrETtVZqEomhJqmhdiqGEpOaxCJOJ3ai1kpNIjHUJDXUTsVQYlKTWMTpxE7UWqlJJIaapIbaqRhKTGoSizid2IlaKzWJxFCT1FA7FUOJSU1iEacTO1FrpSaRGGqSGmqnYigxqUks4nTihLWaxKS1VZPaqkUNVTsxKSH2xSyGKM640xku+aHHeOC3PdDk3PPPc8ljHuOeX/VVWluf/IdPefd17/K4xz3OiRPxCz//PN/8Ld/iU5/8FOonfuIn/fbv/JZHPvKRnv60p7nxphs8+clPEosbb7rJ3e/+5Z73vOd52a+8zPnn/w8u/5Ef8fa3vx1x/d/9nSc8/vHO+mdf5On/6T/5uxtucNVVV9v4yC0fkxN1/vnnm5VzzjmHFR/+8N8rPvOZf3Lttdd61jOf6fse+hCPe9xj/a8veYkrr3yzRcxiOKE2YnLnM8/0NV/3tX7l5S/XVmv2yle+0hd98Ze4292/zBlnnOGSS37IA7/tgSbnfd15Lrnkh9zznl9lIyZ17bXv8u5rr3Xrrf9gEbMYojZioybx8Isu8sQn/rh73/vezj//fE/8sR/z4z/xo84//3yTf/r0P/nQzTf7jz/5H/36r7/Cwx52oRe96IV+7dd+TUxKCFpqErP4/zuD+2BLD4I+wM/vbhIw2WxKNkAgwC7McBeQoEgQajtiGztGqiVUhSDiDFiZ8oegZNOaILJBUJigI9M0M4QW7EyBMCFBPqyB6QzFguUjBFATLUEJbFBINgJhQb7y/nre895zz7nJ2TXN88zE3/7t33nRv3+RU3fv8eY3/4FLL71UN8zEqOUlL3mJq99xtZ979gV+4+WXOHz4sIsuOkhNaqZqKUYlxKqYi5mohVioUYxa22pU22pSM1VLMSohVsVczEQtxEKNYtTaVqPaVpOaqVqKUQmxKuZiJmohFmoUo9a2GtW2mtRM1VKMSohVMRczUQuxUKMYtbbVqLbVpGaqlmJUQqyKuZiJWoiFGsWota1Gta0mNVO1FKMSYlXMxUzUQizUKEatbTWqbTWpmdI1hg49tqGToTsMnQzdMnRh6NAdhqHHM3TownXXXdfNzc1edtllnQydDP30pz/dzc3NXnvNNe3QuRv/4qZubm72lls+14WhQxe+8c1vdPPRj+4br7yyo9e//vXd3Nzs7bff1tHXvva1Pnrz0X3xi3+loxtuuKGbm5t9//vf38nQ0ROf+IO98MILO/rUJz/ZA4/e7Jve/OZ26NzTn/6TPXToUEdDhy4cvOhgn//85/fuPvrRj3Rzc7M33HBDhw49fPgL3dzc7Hvf+97uNHQydIehk6F94Qtf2Gc+8/x+4AMf6Gjo0B2GocczdOiLX/wrfdGLXtR7GjoZuvCLz3tef+n5L+jc0C1DDx482Be84AUdOnTVhz/84R7Y3OwnbvhE1/nUpz/VAwc2e80113Thxhtv7ObmZm+55XOdDN1h6GTolqELQ4fuMAw9nqFDj23oZOgOQydDtwxdGDp0h2Ho8QwdemxDJ0N3GDoZumXowtChOwxDj2fo0GMbOhm6w9DJ0C1DF4YO3WEYejxDhx7b0MnQHYZOhm4ZujB06A7D0OMZOvTYhk6G7jB0MnTL0IWhQ3cYhh7P0KHHNnQydHSCLUVMIlYVsRCKxEKRmMRcRYoQsVAkMWoriVERk4hVxdOe9jSTUCQ++9nPIv7jxRf79Yt/HTGJ//2hD9v3iP3+4Vv/4PW///v++LrrfOlLf6ciiTuPfl1bh7/wBWc+5Ex7z3ig0Z49ezxy/yMtnHjiiYrhrrtMQknixBNPNBrQ1DlPehIx97jvf7zP3/J5o4iFliRGbSUxetI5P+zhD3+4d7/rXZ74xCd6z3ve45RTTnHuuecqYiEUiYUiMQlveMMbFKm5iIUiiVFbSYyKmESsKmIh3vLf3+JtV73VzTd/FlH1hLMfby7mKtRcxEJxzjnnOP2MvX7pBb/kx88911Oe+lT/+qd+2vfd/35Gf/3Zvza6+OKLXXzxxYoNkw99+MP2PWI/iYUiMYm5ihQhYqFIYtRWEqMiJhGrilgIRWKhSExiriJFiFgokhi1lcSoiEnEqiIWQpFYKBKTmKtIESIWiiRGbSUxKmISsaqIhVAkForEJOYqUoSIhSKJUVtJjIqYRKwqYiEUiYUiMYm5ihQhYqFIYtRWEqMiJhGrilgIRWKhSExiriJFiFgokhi1lcSoiEnEqiIWQpEYnWCuInYoYi4WimiI0hBiRUsiZmJFEbFQSUwqYoci5lIec+AxKKIh6jvf/o6krr76aqft+SeihlYSD3jAAwhXvvGN3vzf/sClhw55whN+wO5Tdjv/mecb7rpLEt/53nfd/373E0unnHKyDuZOP/10KV/9ytdQxPeGuxw9etQZe88witGGU3fvpiWxa2PDMNxlqYgNMakkJrVrI57788/12te+xsGLLnLV297uZ3/mZ93//ve3VERDlIYQK1oSMRMrioiFSmJSEas62BYL9ad/+n9c+luv9MJf/ndeeelveeCDznDo0KW+8pWvmmtJxEyohSKCk046yfvf9z5/+Ifv8sE/+aCXvewSv/d7v+eD/+uDTjzpRN/5zrd14Op3XO20006jRAwZnP6AvRqiNIRY0ZKImVhRRCxUEpOK2KGIuVgooiFKQ4gVLYmYiRVFxEIlMamIHYqYi4UiGqI0hFjRkoiZWFFELFQSk4rYoYi5WCiiIUpDiBUtiZiJFUXEQiUxqYgdipiLhSIaojSEWNGSiJlYUUQsVBKTitihiLlYKKIhSkOIFS2JmIkVRcRCJTGpiB2KmIuFIhqiNDYooqilxkwtFTGKUQiK1rbEqrYmQVGTUDNFFLXUmKm5mBkQoxjF/kc+Ugfu+u737Nv3CI/Yt8/+/fvt27fPnj17jK55xzv8zDP/rQsueI7HPe6x7jz6Nd/45jewQXnYw85yyy1f8PWjRxXf+va33HjjTbphph70oAc5Zfcpbvjk9YjRX950k4jNAwcoWlSDxFxpaGsS1N4Hnu7WL96KUDNFFD/1b35aw6te9Sp/d9uXPPOZz7BUxChGISha2xKXXfY6l1xyiU9+8gZtTYKiJqFmiihqqRtELRXxR//jj5yxd6+DFx70Q0/6IWc++CE+ecMNqLnEwhln7HXr4cMmQVGj3btP9QvP/QVvvPJK/+WN/9WRO+7wkY991Gj//kfqBsNd37Nv3z779u/ziP0Pt3/ffnv2nCpGIVz5hisdesUrfOhDHzKXWNXWJChqEmqmiKKWGjO1VMQoRiEoWtsSq9qaBEVNQs0UUdRSY6aWihjFKARFa1tiVVuToKhJqJkiilpqzNRSEaMYhaBobUusamsSFDUJNVNEUUuNmVoqYhSjEBStbYlVbU2CoiahZoooaqkxU0tFjGIUgqK1LbGqrUlQ1CTUTBFFLTVmaqmIUYxC2CBGQSzFKEZFxVxRS0FioailCGpUoaEmMROjIJZiFBHFIOaKmnvyk89x4LEH/MbLX+7d7363I0eO+LM//3OvevWrHDlyxOjHnvZjPnb9x/zVX/2Vj3z0437n1a9hMFPCeef9pOA1v/3b/vKmm7zqlb+FiFGccMIJfu5Zz/LOd73bdddd5zP/92av+Z3XGMK55/5LgsRcKWomaERQo4of/edPc8vf3OKtb32rG2+60R1//xWj4IFnnOEnf+I81177To85cMBjH/f9RkXFXFFLQWKhuPad17j2mmscPvxFEdSoQkNNYiZGQSwFtWFUVIz+6VN+xB1H7vDBD/2Jm2++2aFXHvKNb37TQlGTH/3RH/P5Wz7vrW97ixtvvNEdf/9VGp+4/hPe8pa3uPWLt/rybbe7/vrrbeCshz7U6MlP/mGPOXDAy37jN73n3e9x+5Ej/uzP/8KrX/1qR26/g9r2/v/5fm+76iqf+cxnjIpaiqBGFRpqEjMxCmIpRjEqKuaKWgoSC0UtRVCjCg01iZkYBbEUoxgVFXNFLQWJhaKWIqhRhYaaxEyMgliKUYyKirmiloLEQlFLEdSoQkNNYiZGQSzFKEZFxVxRS0FioailCGpUoaEmMROjIJZiFKOiYq6opSCxUNRSBDWq0FCTmIlREEsxilFRMVfUthOMilDEUhEVoQhip9JUxCiKoCoSMzGKkpjUJBShiKWaSQUbYi627dq1yxWXX+GSl1/iP1x0kZpJnX32E5x4wi7F837xeW7+6896xjOeQerZz7rAl2/7Eoo6+/FnO3jwoMted5mrr73Wo/btc+DApogi6td+9Vd98fCtXvKSlxjt3bvXVW+7ysknn0ypikkUsRGqxEyMos558jleeuFLXX75f3LHHXc4dOhSz7ngOYTi/PPP98fXXeeCZ1+giIpQBLFTaSpiFHXSSSehqsRMjKIkJjUJRShiEpGNoCIU4cf/1bnOO+8nvPCXX0j5wR/4Qec9/TyHP3/YKIqgnnTOk7z0wpe6/PIr3HHkiEOHXuE5z/l53/3ed/zu777OK195KWL/vv1+8xWv8MhHPcpo164NV/znK1zyspc5eNGFCOXsJ5zthBN3EduOfPl2TZ354AcbRRFURWImRlESk5qEIhSxVERFKILYqTQVMYoiqIrETIyiJCY1CUUoYqmIilAEsVNpKmIURVAViZkYRUlMahKKUMRSERWhCGKn0lTEKIqgKhIzMYqSmNQkFKGIpSIqQhHETqWpiFEUQVUkZmIUJTGpSShCEUtFVIQiiJ1KUxGjKIKqSMzEKEpiUpNQhCKWiqgIRRA7ZGgb910RW2oSW4ooUsQ9FHHfFcHRo0cdue12p+89w57TTjUporjtS1+2Z8+pvu/kk60qgm9/+1tuv/2Is846SxLrfP3rX3fn1+700LMeKolREVtqEluKKFLEPRSx9KY3vclrX/taH//Yx+w57TT/mCK21CS2FFGkiHso4v/fnXfe6Xvf/a4H7N0rttQkthRRpIhtHQZfuu02bT30IQ9xLEePHnXk9tudvnevPXv2WPXFW2/1L8491yMe/nDve9/77NrYZS62FFGkiHso4r4rYktNYksRRYq4hyLuuyK21CS2FFGkiHso4r4rYktNYksRRYq4hyLuuyK21CS2FFGkiHso4r4rYktNYksRRYq4hyLuuxPSklAa4t4rYlQVibuJUYpYKy0JpSHuvSJGdcru3Xbv3m2nGKU8+MwHWyctifuddH9nPexh4thOPfVUp556qoUiRlWRuJsYpYi10pL43N98zseu/7jLL7/cs571bHtOO80/pohRVSTuJkYpYq20JJSGuHf27NmjiFFVJO4mRilih2xseMiZZ9KaKw2x0+7du+3evds6H//EJ0T82q/9qo1du9xTjFLEWmlJKA1x7xUxqorE3cQoRayVloTSEPdeEaOqSNxNjFLEWmlJKA1x7xUxqorE3cQoRayVloTSEPdeEaOqSNxNjFLEWmlJKA1x7xUxqorE3cQoRayVloTSEPdekc64myKOoZZijSKUhlijJWZinSKOoZZijSKUhlijJWZinSKOoZZijSKUhlijJWZi4YorrvD2t7/dP/uRH/Gyl7/cKSefbK1aijWKUBpijZaYiXWKOIZaijWKUBpijZaYiXWKOIbadvjWL7j11i966lOeIhsbJkUoDbFGS8zEOkUcQy3FGkUoDbFGS8zEOkUcQy3FGkUoDbFGS8zEOkUcQy3FGkUoDbFGS8zEOkUcQy3FGkUoDbFGS8zEOkUcQy3FGkUoDbFGS8zEOkUcQy2FdMZcEYqgiDWKKIIiVhSxpYi5InYoYqEIRVDEGkUUQRErithSxFwROxSxUIQiKGKNIoqgiBVFbClirogdilgoQhEUsUYRRVDEiiK2FDFXxA5FLBShCIpYo4giKGJFEVuKmCtiTVO/mgAAAU1JREFUhyIWilAERaxRRBEUsaKILUXMFbFDEQtFKIIi1iiiCIpYUcSWIuaK2KGIhSIUQRFrFFEERawoYksRc0XsUMRCEYqgiDWKKIIiVhSxpYi5InYoYqEIRVDEGkUUQRErithSxFwROxSxUIQiKGKNIoqgiBVFbClirogdilgoQhEUsUYRRZDOWFFEEesUsaqIpSJGRcwUQRHHVUQR6xSxqoilIkZFzBRBEcdVRBHrFLGqiKUiRkXMFEERx1VEEesUsaqIpSJGRcwUQRHHVUQR6xSxqoilIkZFzBRBEcdVRBHrFLGqiKUiRkXMFEERx1VEEesUsaqIpSJGRcwUQRHHVUQR6xSxqoilIkZFzBRBEcdVRBHrFLGqiKUiRkXMFEERx1VEEesUsaqIpSJGRcwUQRHHVUQR6xSxqoilIkZFzBRBEcdVRBHrFLH0/wAh19inuIJCEwAAAABJRU5ErkJggg==" alt="图片"></p>
</blockquote>
</li>
</ul>
<blockquote>
<p>设置 hidden 为 true 时， display 为 hidden：<br><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASEAAAClCAYAAAATS0thAAAgAElEQVR4AezBC1SUdeL44c8Mg6KgZmCOistk9c6q+RMoU1gTXCks0tKmaHTMlrQxl7ItWS/YitnGkpeyxUvhvZQtRcLLqpvpiEgmiiSBoeaKxIDDHUWnQfj+e/ec6T+Hoy14QW3f51GJn6BQKBQ3iRqFQqG4idzifsI1cDgcTJ48mcrKSvz9/cnMzOTtt9/mnnvuoUuXLlwvhYWFjB07lvXr17N+/XoefPBBfHx8uJ7y8/OZNWsWPj4+9OzZk9WrV7N06VKGDx+Om5sb14PD4WDy5MlUVlbi7+9PZmYmb7/9Nvfccw9dunTBVW1tLZmZmdTV1XHXXXfh6ttvv+WLL77g4MGDeHp64uPjg6t///vf7N27l927d2Oz2dBqtbRt2xanixcv8vXXX7N7926ysrLw8PCgS5cuqFQqLuebb74hJyeHu+66i7Zt2yIrKiriq6++4uTJk5w8eZKTJ09SVFTE3XffjczhcDB58mQqKyvx9/cnMzOTt99+m3vuuYcuXbqgUMg0XKPGxkYsFgs+Pj7IbDYbFouFF154geupS5cuzJgxA6vVyptvvsnFixe53qqrq7FYLERERCArKCjAYrHQ0NCAu7s710NjYyMWiwUfHx9kNpsNi8XCCy+8gFN1dTVr1qxhzZo11NXV8dhjj/H+++/j9I9//IPZs2fj6enJnXfeybx589DpdKxbtw4fHx9kU6ZM4YcffkCn05GXl4dsypQpTJ48GdlXX33Fyy+/TM+ePXFzc2P+/PlotVo+/fRTtFotrkpLS3n22WeRpaSkcP/99yM7ePAgM2fOxFXPnj0ZOnQossbGRiwWCz4+PshsNhsWi4UXXngBhcJJzW2iffv2DB48mAEDBvBrt3v3btasWcOLL76IVqulKZ1Ox4oVKzh8+DC7du0iKSmJ06dPs2rVKpwWLFhAVlYWmzZt4ttvvyU8PJxFixZRW1uLzN/fn3379rFr1y527tzJhg0bKC0t5eOPP6apt956C61Wy5V89913FBQUUFBQwK5du1AoWkLNDWa32zEYDGzbtg1Xn376KWPHjqWxsRHZsmXLiIiIQK/XExISQmxsLLW1tTTX8ePHiYyMxGq14rR48WLmzp2LkxCC5ORkRo4ciV6vx2AwcOjQIVoqPT0dg8HA5MmTuRGCgoLYu3cvf/zjH+nUqRNNDRo0iMGDB6NSqZANGTIET09PCgsLcbrvvvtwc3ND5u7uTmBgILJz584hu/POO7nrrrtw6t27N56enlRXV+PqX//6Fzk5Ofz5z39GobgRNFwjjUaDyWSif//+yHQ6HSaTCa1Wi8zDwwNvb28+/fRTIiIicFq7di19+/ZFrVYj+/bbb4mMjOTee+/l9OnTJCYmUlpayooVK2iOCxcukJOTw48//ohTUVERJSUlOK1atYqEhATGjBnD5MmTSU1NZezYsRw+fBgvLy+0Wi0mkwk/Pz9kQUFBtG/fHnd3d1xVVVWRm5uLVqulpTQaDSaTif79+yPT6XSYTCa0Wi1O3bp1oyVKSkqoq6vj/vvvx9W5c+coKSkhNzeXVatW0a9fP3r06IGrwsJCSktL2bp1K3V1dTz22GM41dbWEhcXx/Tp0+nUqRNX8sQTT3Dp0iUCAwOJjo6mR48eyDQaDSaTif79+yPT6XSYTCa0Wi0Kxc9EK9i6dauQJEmUlJQIWUFBgZAkSaSnp4srWbx4sZAkSTQ0NAhXp06dEpIkiSNHjghXR44cEZIkiVOnTgmnadOmieeff17I6uvrhSRJYtq0acLJbreLgIAAkZqaKlpiz549YtSoUeKll14SN9qIESPElClTxJU0NDSIqKgoERQUJGpqaoSrrVu3CkmShCRJIigoSJSUlIimhg0bJiRJEpIkiSVLlghXcXFx4rnnnhONjY1i3759QpIkkZubK5y2b98uZs6cKVavXi1effVVIUmSCAgIENXV1UKhaC4NrSA0NBTZF198wbhx49i5cyeenp4EBQXhlJmZyeLFizl27Bh1dXU4Xbx4EU9PT65VcXExstTUVFJTU3G1a9cunnrqKZorNDSU0NBQbgXz5s0jIyOD5ORkOnbsiKthw4ZhsVjIzs7mww8/xGQysX37dtzd3XH67LPPKCkpYfv27bz//vt07dqV0aNHc+TIEdavX09aWhoqlYrLGT58OMOHD0c2fvx4/vnPf/KnP/2JLVu2YDKZUCiaQ0Mr8PT05MknnyQtLQ2TycTGjRsxGAxoNBpkFRUVREdHM2jQIN5//338/PzYvHkziYmJNDQ0cLXsdjtODocDWVxcHMHBwbhq164dt6Ply5ezcuVKlixZQmBgIE15eHjQrVs3IiIi6NixIxMmTCArK4vg4GCc7rzzTu6880769u3LgQMH2LBhA6NHjyYtLQ3ZBx98gMxmsyGLj49n9OjRPP300zQ1dOhQZP/+979RKJpLQyt54oknmDhxIlu2bKG0tJTHH38cp/3791NXV8e0adPw8/NDlpeXx+XccccdyGw2G658fHyQFRcXc/fddyOE4ODBg9x3333IevbsiezcuXP4+flxLY4cOcKGDRvo3LkzMTEx3Az/+Mc/mDdvHvPmzWPYsGH8Nw0NDchsNhtX0tjYSGFhIbKgoCC8vLxw0mg05Obm0qNHD+68804u57vvvkPWpUsXWuqjjz7CarUSFhbG4MGDUfzv0NBKgoOD8fT0JCYmBq1WS//+/XF68MEHkW3bto0RI0awc+dO9uzZw+V07tyZwMBAVq1axR133EGnTp3Q6/X4+vri7e3N+vXrufPOO/nyyy+pqKjgvvvuQ+bh4cG4ceNYtmwZGo2G8PBwfvzxR7788kv69u1LcHAwzXXmzBlSUlLQarXExMRwI+zbtw8hBDU1NZw9e5b09HQ6dOhAQEAAe/bsYfbs2fzud7+jY8eOWCwWZB06dOCBBx7AZrPx3nvv8fjjj6PVajl27Bgffvgh3t7eDB8+HNny5ctp164d/v7+OBwOdu3aRV5eHrGxscjCw8MJDw/HKSMjg507d/L8889z//33I0tISCAwMBCdTsexY8dYvXo1smHDhtFS//rXv8jNzeU3v/kNgwcPRvG/Q0Mr0Wg0PP3006xdu5Znn30WlUqFU/fu3YmOjmb58uUsWrQIb29vJkyYwPLly1GpVDQ1c+ZMli5dyrhx4/D09CQ7OxvZ1KlTmT9/PqNGjaJfv36EhoZit9txeuONN2hoaCAhIYGEhARkWq2WhQsX0hIqlYobbcKECTiVlpYyceJE+vXrx8aNG/n222+R7d+/n/379+PUt29fNm3ahFqtJjs7m02bNuGk1WpJSEjAw8MDmRCCt956C1dPPvkkzz77LM11/PhxVq5ciZO3tzdLly7lvvvuo6XKysqQde3aFcX/FpX4CbcIh8NBWVkZ3bt3R6VScTXq6+uprKyka9euXInD4cBqteLl5YW3tzcqlYpfo9raWioqKvD09MTHxwe1Wo2rS5cuUVZWht1up1u3bnh4eNBSVVVVVFRU0KFDB+666y5UKhUt9cMPPzBs2DB69uzJzp07cXNzQ/G/QyV+QkudPAb/WA652XCuFhAoFFertraWkpISunXrRseOHblh2nuCvh8YxkPAQBS3BpX4CS2RtBDenQmNjSgUt63nJ8ObC0GtRnFzqWmJTR/D36ZDYyMKxW1t7RL4YC6Km08lfkJzOBww+G6oKOM//B+C12ZDl64oFLeF2hpIWgi7t/Ef7u6w9wR07Y7i5tHQXFkZUFHGf3TzhbU7wNMLheK28uDv4OnBcPQQ1NfD7n+CcQKKm0dNcxWd4mcPPwqeXigUtx21GsKf4mdFp1DcXGqaq76en7m7o1Dcttzb8DOHA8XNpUahUChuIjUKhUJxE6lRKBSKm0jNNXI4HJjNZtasWYMsMzMTs9lMfn4+v2T8+PHs3LmTpgoLCxk/fjyFhYVcbzt27CAiIoKIiAhGjhzJjZCWlobZbKa8vBzZ9OnTmTdvHtdTfn4+ZrOZr776Ctnq1asxm83U19fjFB8fz+LFi2mOL774ArPZzH+zY8cOoqKi+CXjx49n586dXC/5+fmYzWa++uorZKtXr8ZsNlNfX4/i10HNNWpsbMRisXD8+HFkNpsNi8VCTU0Nv+TAgQOUl5fTlN1u58CBA9jtdq63/v37M2PGDIKDgykoKOBGKCwsxGKxYLfbkaWnp5Odnc31VF1djcVioaysDFlBQQEWi4WGhgacTp48yenTp2mO8vJysrKy+G/KysrYv38/v+TAgQOUl5dzvVRXV2OxWCgrK0NWUFCAxWKhoaEBxa+DhluMXq+noKCAG6Fbt25069aN0tJSFP+f0WjEaDSiUNwMalqBEIKkpCRCQkIIDg5m2bJlNFVSUoLRaMRoNGI0GiksLKSp3bt3Ex0djV6vJzg4mKlTp+L07bffYjAYWLlyJWFhYQQGBjJ37lwcDgfNdfHiRWbOnElISAh6vZ6IiAg+/PBDGhsbkaWkpGA0GrHb7Tg1Njby4osvsnz5cloiPT0dg8HA5MmTuVHq6+t5++23CQwMJCoqiqysLFzt2bMHo9GI0WgkKiqKpgoLCxk/fjx6vR6j0cipU6dwJYQgKSmJkJAQgoODWbZsGU3Z7Xbi4+MJCQkhMDCQSZMmYbVacfr888958cUX+eyzzwgLCyM8PJyUlBQU/zvUXCONRoPJZGLgwIHIdDodJpMJrVaL05YtW5g/fz4DBgzglVdeYe3atTTVqVMnoqKiCAsLIzs7m7q6OlyVlJTw8ssv06FDB1avXs2cOXNwVVdXR25uLgkJCTz77LM8++yzfPLJJyQmJtJcFy5coLi4mD/96U+sWrWKiIgIFi5cyIoVK5AFBgaSnZ3N7t27cTp06BAZGRkEBAQg69evHyaTCS8vL2SRkZGEh4fTVFVVFbm5ueTl5dFSWq0Wk8mEn58fsqCgIEwmE+7u7rjavn07P/zwA7NmzaK6upoZM2bg6r777iMqKgqdTsf+/ftx1dDQwIsvvsiJEyeIi4vD19eX9evX42rLli3Mnz+fAQMG8Morr7B27VqamjJlChs2bCAyMpLY2FiKioqIiYnBqby8nIyMDNasWcOkSZPo3bs3M2fOxGazIdNqtZhMJvz8/JAFBQVhMplwd3dH8SshmmvtEiF6uQvRy12IN6NFSzz33HPi0UcfFU67d+8WkiSJTz75RDR17NgxIUmSyMvLE64yMzOFJEni8OHD4nIOHDggJEkSH374oXB64403REBAgGhsbBSuNmzYICRJEs0xbtw4ERUVJZzGjRsnoqKihNPMmTPFsGHDRGNjo2iJPXv2iFGjRomXXnpJ3AhRUVFCkiRRX18vZLt27RKSJImzZ8+Kpj755BMhSZJwtX//fiFJkti5c6dwGjFihJAkSTg999xz4tFHHxVOu3fvFpIkiU8++UTIvvnmGyFJkkhJSRFOeXl5QpIkcfr0aSFLSkoSkiSJo0ePCllFRYWQJEls375d3DDL3xOil7sQvdyFmPuGUNxcalpBQUEBDz74IE73338/LfXAAw/g7e3NhAkTmDp1Khs3bsRut9NUv379cPq///s/6urqqK6uprnWrVtHREQEer0evV7P119/TU1NDU6RkZFkZGRgtVq5cOECGzduxGg0olKpaInQ0FA2bdrEhx9+yI0SGhqKRqNB1qtXL2Q//PADzfHDDz8g69u3L04DBgzAVUFBAQ8++CBO999/P65OnjyJbMaMGej1evR6PaNGjUKWkZGBqz59+iC788478fb2prCwEMX/Bg2txMPDA6e2bdvSUm3atOFf//oXn3/+OXv37iU2NpaFCxdisVho06YNTh4eHji1adMGWX19Pc2RmZnJW2+9xcSJE5k7dy4+Pj7MmTOHqqoqnIYNG4anpydbtmyhW7duyEaOHMmtqGPHjjip1WpkjY2NNEdDQwOytm3b4uTh4UFTHh4eOLVt2xZXDocD2YYNG+jUqROuOnfujJOnpydubm64amxsRPG/QUMr0Ol0fPPNNzjl5+dzNby8vDCZTJhMJvbt28eECRM4ePAggwcPxikvL4+AgABk+fn5yHx8fHDl7e2NrLy8HB8fH5y2bduGt7c3b7zxBiqVivr6eo4cOYJOp8PJw8ODZ555hg0bNtC9e3ceeeQRunTpQksdOXKEDRs20LlzZ2JiYrjVdOvWDdmxY8d4+OGHkWVnZ+NKp9PxzTff4JSfn48rnU6HrKGhAT8/P24kh8PBO++8g2zChAn4+vqiuD2oaQUjRowgNzeXlStXkpOTw6JFi2iqsrISq9VKaWkpMpvNhtVqpbKyEtnhw4dZt24dP/zwAzabjaysLGTdu3fH1erVq9m3bx9btmxh69atjBo1CrVajauHHnoIWWJiIrm5uRQVFSELCgqioqKCffv2ceLECeLi4qirq6Op0aNHU1RUxNdff83TTz/N1Thz5gwpKSls3bqVm6WkpASr1UpVVRUyq9WK1Wqlrq6OgQMH4unpyZIlS8jJyWH16tVkZ2fjasSIEeTm5rJy5UpycnJYtGgRrgYMGIBer2fWrFls3ryZ8vJycnNz+etf/0p5eTnXU319PcnJySQnJ1NZWYni9qGhFRiNRnJyckhISEAWHh6OTKVS4TRnzhx27NiBk9lsRhYeHs4HH3xAfX09CxYs4K233kKm0+mYPXs2vXr1wtVvf/tbJkyYgKxfv35MnTqVpjw9PVm0aBEfffQRycnJPPbYY7z//vuEhYURHh7OxIkTkfn7+/PYY49x5swZXOn1evR6PT/88AMPP/wwV0OlUnEjqdVqVCoVTalUKpwiIiKoq6vDaejQocj+8pe/MHbsWBITE4mOjiYyMhJZaGgoWVlZOBmNRnJyckhISEAWHh6OTKVSIXNzc2PJkiXExsYSExODU79+/dBoNDh5eHjQlEqloiWqqqpw8vHxQXEbEc21dokQvdyF6OUuxJvR4mpUVlYKm80mrlZDQ4OwWq3CarWKpg4cOCAkSRJFRUWipqZGlJSUiKtVU1MjysvLxZVcvHhRBAQEiPnz54tfu0uXLonTp0+L+vp6cSWVlZXCZrOJX3Lu3Dlx6tQpUVNTI26EtLQ0IUmSmDVrlvivlr8nRC93IXq5CzH3DaG4uTS0os6dO3Mt1Go13bp147/p2LEjHTt25Gp17NiRy2loaGDfvn2kpqZSV1fHM888w6+dm5sbfn5+/JLOnTvz33h5eeHl5cWNcuDAAWSTJk1CcXtR8yvRpk0bvL29cXNz40a5ePEiM2fOpLi4mKVLl/Kb3/wGxa1h7NixbNy4kR49eqC4vWj4lQgICCAzM5MbycvLi8zMTBS3nr59+6K4PalpLk8vflZdiUJx26qq4GdeHVDcXGqaq/f/8bMv0uDYNygUt52zVvh0BT/r3R/FzaUSP6G5RgXD0UP8h0c7GDUWumhRKG4LtdXw+XqoruQ/unaHPd9BWw8UN49K/ITmKsiFZ0Kg7jwKxW1NrYaVW+DhR1DcXGpaQt8PPt0D+n4oFLetHn6wehs8/AiKm08lfkJLNTbC4UzIPQznagGBQnHLa+8F+vthUCi0aYPi1qASP0GhUChuEjXXyOFwYDabWbNmDbLMzEzMZjP5+fn8L0pLS8NsNlNeXo5s+vTpzJs3j+spPz8fs9nMV199hWz16tWYzWbq6+u5FvPnz2fhwoU0VVhYyPjx4yksLOR6+/zzz5k0aRK/xGg0EhERQUREBCkpKbRUfn4+ZrOZr776Ctnq1asxm83U19ejuPnUXKPGxkYsFgvHjx9HZrPZsFgs1NTUcCOEhYWxZMkSruQvf/kLzz//PDdLYWEhFosFu92OLD09nezsbK6n6upqLBYLZWVlyAoKCrBYLDQ0NHAtTp06xenTp2nKbrdz4MAB7HY7lxMWFsaSJUu4GqWlpRw9epRfMmXKFGbMmEFJSQlVVVW0VHV1NRaLhbKyMmQFBQVYLBYaGhpQ3HwabjP19fUIIbiShoYGGhoaUFw/er2egoICrqS+vh4hBDfKoEGDUPx6qWkFn332GWazmffee4/AwEDCwsJITk7G1bJly4iIiECv1xMSEkJsbCy1tbU4RUVFYTAYKC0tZd26dRgMBgwGA/v27UP23nvvYTAY2L59O4cOHcJgMGAwGFi6dClOQgiSk5MZOXIker0eg8HAoUOHcFVTU4PBYMBisTB9+nQCAwMJCQkhIyMDmcFgIDk5GbPZTGBgILGxsRQVFdFS6enpGAwGJk+ezI0ghCA5OZmRI0ei1+sxGAwcOnQIV+np6URERBAYGEhMTAx2ux1XJSUlGI1GjEYjRqORwsJCXEVFRWEwGCgtLWXdunUYDAYMBgP79u3DadmyZURERKDX6wkJCSE2Npba2lqaWrRoEcHBwYSEhPDxxx/TEkIIkpOTGTlyJHq9HoPBwKFDh1DcHjRcI41Gg8lkon///sh0Oh0mkwmtVotTWVkZFouF77//nhkzZvDll18SFxeHr68vDz/8MLJvv/2WyMhI7r33Xk6fPk1iYiKlpaWsWLEC2YQJE3A4HLz++usMGjSIkSNHIpMkCdmjjz5KQEAAa9eupbi4mOjoaGTdunXDadWqVSQkJDBmzBgmT55MamoqY8eO5fDhw3h5eSGrr68nNzeX119/HV9fX6ZOnUp1dTU2mw1Zbm4uubm5PP/884SGhjJv3jzatGnD7NmzkfXr1w+TyYSXlxeyyMhIOnXqRFNVVVXk5uai1WppKa1Wi8lkws/PD1lQUBDt27fH3d0dp1WrVpGQkMCYMWOYPHkyqampjB07lsOHD+Pl5UVhYSETJ06kX79+zJo1i08//ZScnBzCw8Nx6tSpE1FRUZw5c4Z3332Xuro6XE2YMAGHw8Hrr7/OoEGDGDlyJDJJknD69ttviYyM5N577+X06dMkJiZSWlrKihUrcKqoqGDLli289tprpKen8/bbb9OtWzfCwsJojlWrVpGQkMCYMWOYPHkyqampjB07lsOHD+Pl5YVWq8VkMuHn54csKCiI9u3b4+7ujuIWIFpBYmKikCRJZGdnC6eAgADxyiuviCtZvHixkCRJNDQ0CFdDhgwRiYmJ4kpmzpwpxowZI5qqr68XkiSJadOmCSe73S4CAgJEamqqcCorKxOSJIlRo0aJy5EkSbz00kvC6Z133hHDhg0TLbVnzx4xatQo8dJLL4nrrb6+XkiSJKZNmyac7Ha7CAgIEKmpqUK2aNEiIUmSKCsrE7KamhohSZJ45ZVXRFPHjh0TkiSJvLw8cTlDhgwRiYmJojkWL14sJEkSDQ0NQrZ06VIhSZLIysoSTkFBQeKll14STQUEBIikpCThqr6+XkiSJKZNmyac7Ha7CAgIEKmpqUJx69PQinr37o3ToEGD+P7773HKzMxk8eLFHDt2jLq6OpwuXryIp6cn16q4uBhZamoqqampuNq1axdPPfUUrsLCwriSQYMG4SRJEqtXr6axsRG1Wk1zhYaGEhoayo1QXFyMLDU1ldTUVFzt2rWLp556ijNnzqDVavHx8UHWsWNHdDod11tmZiaLFy/m2LFj1NXV4XTx4kU8PT1x6t27N04DBgwgLy+P5iguLkaWmppKamoqrnbt2sVTTz2F4tamoRVpNBqc2rRpw48//oisoqKC6OhoBg0axPvvv4+fnx+bN28mMTGRhoYGrgeHw4EsLi6O4OBgXLVr146m+vTpw5V06NABJ5VKhUwIwa3C4XAgi4uLIzg4GFft2rVDVl9fj4eHB648PT25nioqKoiOjmbQoEG8//77+Pn5sXnzZhITE2loaMCVu7s7Tm3btqW+vp7mcDgcyOLi4ggODsZVu3btUNz6NLSi48eP06dPH2RHjhzh3nvvRbZ//37q6uqYNm0afn5+yPLy8rgcd3d3amtruRJ3d3eqq6tpqmfPnsjOnTuHn58fN9uRI0fYsGEDnTt3JiYmhuupZ8+eyM6dO4efnx+X4+vry44dOzh//jxeXl7Y7Xby8vLw9fWlpdzd3amtraWp/fv3U1dXx7Rp0/Dz80OWl5fH5Zw4cYK+ffsiy87ORqfT0ZSvry9nz57FVc+ePZGdO3cOPz8/rsWJEydYt24dKpWK2bNno2gdalrRggUL+Pbbb1myZAmlpaVEREQge/DBB5Ft27aNoqIili9fzp49e7icu+++mx07dpCRkcHp06epq6vDVc+ePTl58iRpaWn8+9//pry8HJmHhwfjxo1j2bJlrFy5kuLiYk6dOkVSUhKZmZm0tjNnzpCSksLWrVu53jw8PBg3bhzLli1j5cqVFBcXc+rUKZKSksjMzEQ2fPhwZO+88w75+fnMnTuXpiorK7FarZSWliKz2WxYrVYqKytxdffdd7Njxw4yMjI4ffo0dXV1yB588EFk27Zto6ioiOXLl7Nnzx4uZ8GCBeTm5rJ06VKKiop44oknaOqRRx5h27Zt7Nq1i7y8POx2Ox4eHowbN45ly5axcuVKiouLOXXqFElJSWRmZtISpaWlJCcns379ehStSLSCxMREERAQIJ5//nkhSZKQJEnMnDlT1NfXC6cPPvhABAQECEmSRFBQkHj33XeFJEmitrZWuDp27JgYM2aMkCRJSJIktmzZIlzV1NSIqVOnCkmShCRJ4s033xROFy5cEHFxcUKSJCFJkpAkSQwZMkQcOnRIOJWVlQlJksTevXvF5UiSJDZu3CicUlJShCRJoqGhQbREWlqakCRJDBkyRNwIFy5cEHFxcUKSJCFJkpAkSQwZMkQcOnRIOCUlJQlJkoQkSeLRRx8VI0aMEK+++qpwevXVV4UkSUKSJCFJkpAkSUiSJF555RXh6tixY2LMmDFCkiQhSZLYsmWLcPrggw9EQECAkCRJBAUFiXfffVdIkiRqa2uFbNmyZSIgIEBERUUJSZKEJEli+vTpwuFwiKbOnj0r3nrrLSFJkpAkSRw/flzILgnKJjkAACAASURBVFy4IOLi4oQkSUKSJCFJkhgyZIg4dOiQaIm0tDQhSZIYNmyYULQelfgJN9jixYv57LPP2Lt3L2fPnqVdu3Z07NiRphwOB2VlZXTv3h2VSsWN4nA4sFqteHl54e3tjUql4tfK4XBgtVrx8vLC29sblUqFK7vdTnl5OT169EClUnEjOBwOysrK6N69OyqViis5e/Ys7dq1o2PHjlwNh8OB1WrFy8sLb29vVCoVLREbG8vGjRuZP38+I0aMQNE6VOIn3GCLFy/ms88+Y+/evSgUt6rg4GA6dOjAP//5T9zc3FC0Dg2toH379nTp0gWF4lbV2NjIggUL6N69O25ubihaj0r8BIVCobhJ1CgUCsVNpEahUChuIjUKhUJxE6lRKBSKm0iNQqFQ3ERqFAqF4iZSo1AoFDeRmmvkcDgwm82sWbMGWWZmJmazmfz8fG5lZrOZL774gtYwfvx4du7ciczhcGA2m1mzZg2yzMxMzGYz+fn5KBT/i9Rco8bGRiwWC8ePH0dms9mwWCzU1NRwK8vKyqKsrIzWcODAAcrLy5E1NjZisVg4fvw4MpvNhsVioaamhuvNarWi1+vJyspCobhVafgflZ2dza+dEAJZY2MjCsWtSk0rOXDgAAaDgSNHjjBx4kT0ej2jR4+mpKQEmd1uJz4+npCQEAIDA5k0aRJWqxVXmzZtIiIiguDgYBITE5kyZQobN25Edvz4cSIjI7FarTgtXryYuXPn4mrSpEkYjUaMRiM7d+6kqZqaGgwGAxaLhenTpxMYGEhISAgZGRnI7HY78fHxhISEEBgYyKRJk7BarTgJIUhKSiIkJITg4GCWLVvG1Zo0aRIGg4H09HRaoqioCIPBwEsvvYQsNjYWg8GAwWCgvLwcp5qaGgwGAxaLhenTpxMYGEhISAgZGRnIIiMj2bNnD04Wi4XIyEgaGxtxOnjwIEajEb1eT3h4OMnJyQghUCiaS8M10mg0mEwm+vfvj0yn02EymdBqtbiqqakhNzeXF198kQEDBhAfH8/Ro0epra2lW7duTJkyhaysLCZMmEDXrl1ZuXIlMTExrFu3DtnXX3/NjBkzGDRoEGPHjuXDDz+ktLSUe+65B9mFCxfIycnhxx9/xKmoqIiSkhJcPffcc9TX1xMdHU1ERARN1dfXk5uby+uvv46vry9Tp06luroam82GbMqUKWRlZTFhwgS6du3KypUriYmJYd26dci2bNnC/PnzGTFiBA888AB///vfcaXRaDCZTPTv3x+ZTqfDZDKh1Wpp6ujRo1RUVFBdXU1LeHt7Ex0dTXl5ObGxsTz99NP07t0bmZeXF0719fXk5uby+uuv4+vry9SpU6mursZmsyHLycmhoqICp8rKSnJychBCIMvJyWHcuHEMGTKE9957j+zsbOLi4ujVqxcDBw5EoWgODddIo9Hw5ptv4uTv74+/vz9XMmbMGKZOnYps9OjRyI4ePYrFYiE+Pp7Ro0cj6927N6NGjaKwsBA/Pz8+/fRTPD09WbVqFWq1mj59+hAZGUlLhYaG0hw6nY5Nmzbh6ujRo1gsFuLj4xk9ejSy3r17M2rUKAoLC/Hz8yM5ORmdTsf8+fORabVaJk2ahJNGo+HNN9/Eyd/fH39/fy6nX79+lJWV0bFjR1qiffv2hIaGUlxcjCwwMJCBAwdyJTqdjk2bNtFSS5cuRavVsmzZMtzc3Hj88cexWq18/vnnDBw4EIWiOTS0spCQEJo6efIkshkzZjBjxgxcZWRk4Ofnx+nTpwkICECtViP77W9/y40UFhZGUydPnkQ2Y8YMZsyYgauMjAz8/PwoKCjgsccew+n+++/nan344Ye0hrCwMK5Gbm4uFRUV9OnTh6bi4+NRKJpDQyvT6/U05XA4kG3YsIFOnTrhqnPnzsjq6uro3r07Tu7u7vw3drudq9WnTx+acjgcyDZs2ECnTp1w1blzZ5w8PDxwatu2Lbe6Pn360Bw//vgjrux2O6NHj2bSpEm4UqlUKBTNpeEWoNPpkDU0NODn58fl/OY3vyE7OxunU6dO4crHxwdZcXExd999N0IIDh48yH333cf1otPpkDU0NODn58fl6HQ6vvnmG5zy8/O5WvPmzaOqqopnnnmGgIAAWsrNzQ3Z+fPnuRparZaioiKcjhw5giu9Xs/Zs2fx8/Pjl5w4cYJ169ahUqmYPXs2CoUrNbeAAQMGoNfrmTVrFps3b6a8vJzc3Fz++te/Ul5ejuyxxx6joqKCpUuXcvz4cd577z1c+fr64u3tzfr168nPzycxMZGKigpc1dXVYbVasVqtyKqqqrBarZSUlNAcAwYMQK/XM2vWLDZv3kx5eTm5ubn89a9/pby8HNmIESPIzc1l5cqV5OTksGjRIq5WamoqKSkpFBUVcTV8fHyQ/eMf/yAnJ4fTp0/T0NBAcwUHB7Nt2zays7NJS0sjLS0NVy+88AL79+8nPj6e/Px8rFYraWlprFu3DlelpaUkJyezfv16FIqm1LQSlUqFTKVS0ZSbmxtLlizBx8eHmJgYfve732EwGDhy5AgajQbZyJEjGTVqFO+//z4jRoygpqYGT09PXE2dOpWcnBxGjRrF3r17CQ0NxVVaWhpDhw5l6NChyBITExk6dCgRERE0pVaracrNzY0lS5bg4+NDTEwMv/vd7zAYDBw5cgSNRoPMaDQyfPhwEhISiIyMpEuXLshUKhUt5e7uzrXQaDQsWrSIM2fOEBkZSXh4OGfPnqUptVrN5URGRtK+fXuMRiNz5sxhzJgxyFQqFbLw8HD+8pe/sHr1akaNGsXQoUOZM2cOTVVVVSHr2bMnCkVTKvETbiHnz5+nrKwMb29vOnbsSFPl5eVcvHiRnj17EhISwtNPP82rr76KU319PZWVlXTt2pUb6fz585SVleHt7U3Hjh1pqqqqikuXLtGlSxdud8XFxXTr1g21Ws3lNDY2UlJSgkqlomvXrri5ueEqNjaWjRs3Mn/+fEaMGIFC4UrDLcbLywsvLy+uxMfHh1/i7u5O165dudG8vLzw8vLiSjp37syvRY8ePfglarWaHj16cCV79uxBp9Px+OOPo1A0peE25u3tjYeHB4pbV2NjIwsWLKB79+64ubmhUDSlEj9BoVAobhINV6u0GHZtgcLvwfEjCsVtpU1b8LsHwkaAtgeKm0clfkJLCAEfvA1L/wb19SgUtzV3d3h5Orw6C1QqFK1PJX5CS8RPg+XvoVD8qrz4Gsx8F0XrU4mf0Fz5OTDiIX72fw/C4wZo64FCcVv50Q7/3AhHD/GzzV9D3wAUrUtDS2z6mJ8NDoOVW8DNDYXitvTiaxA1AvZ9wX9s+hj6BqBoXWpaoiCPn/3hVXBzQ6G4banV8IdX+dnxPBStT01LXKzjZx06oVDc9jp04mcX6lC0PjXXyOFwYDabWbNmDbLMzEzMZjP5+fk4bd68GbPZTHMUFhYyfvx4CgsL+W/Gjx/Pzp07uZL58+ezcOFCrheHw4HZbGbNmjXIMjMzMZvN5Ofno1Aoro6aa9TY2IjFYuH48ePIbDYbFouFmpoanGw2G1lZWTSH3W7nwIED2O12/psDBw5QXl7OlZw6dYrTp09zvTQ2NmKxWDh+/Dgym82GxWKhpqaGGyEsLIwlS5agUPyaabjF6PV6CgoKUEB9fT1CCBSKXzM1reizzz4jLCyM8PBwUlJScFVSUoLRaMRoNGI0GiksLMSVEIKkpCRCQkIIDg5m2bJlNJWenk5ERASBgYHExMRgt9txJYQgOTmZkSNHotfrMRgMHDp0CKeCggIMBgObN2/GYDAQGBjI4sWLuXDhAi01adIkDAYD6enptFRUVBQGg4HS0lLWrVuHwWDAYDCwb98+nGpqajAYDFgsFqZPn05gYCAhISFkZGQgi4+PJzExEafS0lIiIyP57rvvcLJarbz66qsEBgYSHBzMO++8g91uR6FoTWqukUajwWQyMXDgQGQ6nQ6TyYRWq8VVXV0da9asYdKkSfTu3ZuZM2dis9lw6tSpE1FRUYSFhZGdnU1dXR2utmzZwvz58xkwYACvvPIKa9euxVVhYSETJ06kXbt2zJo1izNnzrB//35crVq1iri4OB544AEWLVqEt7c3Y8eO5fz588guXrxIbm4ucXFxDB8+nKioKD744APS09ORaTQaTCYTAwcORKbT6TCZTGi1Wpo6evQoubm5VFdX01ITJkwgOjoaT09PBg0aRHR0NNHR0UiShFN9fT25ubm8/vrr5OfnM3XqVCIjI7HZbMhOnjxJYWEhTj/++CM5OTmcP38e2blz5zAYDHz//ffMmDGDF154gY0bN7JixQoUitak4RppNBrefPNNnPz9/fH39+dy/va3v9GvXz9+//vfs337drKzsxk+fDiy9u3b88gjj/Ddd99xOcnJyeh0OubPn49Mq9UyadIknNLS0pAtW7YMHx8fwsLCGDBgAE6XLl0iISGBUaNGMXv2bGRDhw4lKCiIXbt28dRTT+H0yiuv8Ic//AHZ9u3b+frrrxk+fDgajYY333wTJ39/f/z9/bmcfv36UVZWRseOHWmp4OBgZB06dOCee+4hNDSUK9HpdGzatImW2rBhAxUVFaxfvx6dToesXbt2LF++nJdffhm1Wo1C0Ro0tKI+ffogu/POO/H29qawsJDmKigo4LHHHsPp/vvvx9WZM2fQarX4+Pgg69ixIzqdDqfi4mJkqamppKam4mrXrl089dRTOD344IM49e3bl8LCQlrqww8/pDWEhYVxNY4fP44sPDycpo4fP85vf/tbFIrWoKGVeHp64ubmhqvGxkZawsPDA6e2bdviqr6+Hg8PD1x5enri5HA4kMXFxREcHIyrdu3a4crLywsntVpNQ0MDt6o+ffrQHA6HA1d2u52ePXuyYsUKmtJqtSgUrUXDbUKn0/HNN9/glJ+fjytfX1927NjB+fPn8fLywm63k5eXh6+vL7KePXsiO3fuHH5+ftxo8+bNo6qqimeeeYaAgACuhru7O7W1tVwNrVZLQUEBTkePHsXVvffeS3p6OnfddRft2rXjSk6cOMG6detQqVTMnj0bheJ6U3OLqKysxGq1Ulpaisxms2G1WqmsrEQ2YsQIcnNzWblyJTk5OSxatAhXw4cPR/bOO++Qn5/P3LlzceXh4cG4ceNYtmwZK1eupLi4mFOnTpGUlERmZibXW2pqKikpKRQVFXG17r77bnbs2EFGRganT5+mrq6O5howYAC5ubns2rWLzMxMPvroI1yNHj2auro6XnvtNTIyMigvLycjI4N33nkHV6WlpSQnJ7N+/XoUihtBQyvx8PCgKZVKhdOcOXPYsWMHTmazGVl4eDgffPABRqORnJwcEhISkIWHhyNTqVTI+vXrR0xMDPPmzSMlJQWdToder0elUuH0xhtv0NDQQEJCAgkJCci0Wi0LFy7kSlQqFVfD3d2da/XGG28wd+5cXnzxRWQLFizgiSeewJVareZyBg8ezNChQ/njH/+IbOLEiSQlJaFSqZB1796dtWvXEhsby4svvojTk08+iauqqipkPXv2RKG4EVTiJzSX4WE48jX/8dleeCCI1lZVVcWlS5fo0qULl2O32ykvL6dHjx6oVCoux+FwYLVa8fLywtvbG5VKxa+VzWbjjjvuoE2bNlxJeXk5dXV1dO3aFQ8PD1zFxsayceNG5s+fz4gRI/jVyT4AzwzhP/wfgpQMFK1Lw22mc+fO/BIPDw98fX35JW3atEGn0/G/4K677uK/8fHxwcfHh8vZs2cPOp2Oxx9/HIXiRtCgUFxBY2MjCxYsoHv37ri5uaFQ3AgaFIorUKvVBAUFoVDcSGoUCoXiJlKjUCgUN5EahUKhuInUKBQKxU2kRqFQKG4iNQqFQnETqVEoFIqbSM01cjgcmM1m1qxZgywzMxOz2Ux+fj5Xo7CwkPHjx1NYWMjV+uKLLzCbzTT19ttvs2TJEn6J0WgkIiKCiIgIUlJSaKm0tDTMZjPl5eXIpk+fzrx587hRCgoKmDdvHkajkZiYGFrCaDQSERFBREQEKSkpKBQ3g4Zr1NjYiMViwcfHB5nNZsNisfDCCy9wNex2OwcOHMBut3O1ysvLycrKoqkTJ07QvXt3fsmUKVO4dOkSr776KlVVVbRUYWEhFosFu92OLD09HT8/P26U119/nTvuuIOnnnoKb29vWmLKlClcunSJV199laqqKhSKm0HDLUav11NQUMC1MBqNGI1GrsagQYO4XVitVk6ePMnHH3/MQw89REsNGjQIheJmU3OD2e12DAYD27Ztw9Wnn37K2LFjaWxsRFZSUoLRaMRoNGI0GiksLKSp3bt3Ex0djV6vJzg4mKlTp+Jqz549GI1GjEYjUVFRXE5NTQ1TpkxBr9czcuRIvv76a1rCbrcTHx9PSEgIgYGBTJo0CavVSkulp6djMBiYPHkyLVVQUIDBYOAPf/gDsjfffBODwcBrr72G05dffonRaCQwMJDAwEAmTpzI999/T0tUV1czf/58wsPD0ev1jBw5kszMTFwdPHgQo9GIXq8nPDyc5ORkhBAoFM2l5hppNBpMJhMDBw5EptPpMJlMaLVaZB4eHnh7e/Ppp5/iau3atfTo0QO1Wo2sU6dOREVFERYWRnZ2NnV1dbgqKSnh5ZdfpkOHDqxevZo5c+bQ1H333UdUVBQ6nY79+/dzOV9++SVVVVXEx8cje/7557HZbDTXlClT2LBhA5GRkcTGxlJUVERMTAxO/fr1w2Qy4eXlhSwyMpLw8HCaqqqqIjc3l7y8PFqqW7duREdHYzKZkI0ZM4bo6GjGjh2L03fffcdDDz3E+++/z9y5c6mtreWZZ57hwoULNNfixYtZv349r7zyCmvXrmXkyJFUVVXhlJOTw7hx4/Dy8uK9997j4YcfJi4ujoMHD6JQNJtoiacHC9HLXYhe7kIcyhTNtXXrViFJkigpKRGygoICIUmSSE9PF00dO3ZMSJIk8vLyhKvMzEwhSZI4fPiw+G8++eQTIUmSaOr5558XkiQJu90uZKdPnxaSJIkVK1aIpgICAkRSUpJw9c033whJkkRKSopwysvLE5IkidOnT4uW2LNnjxg1apR46aWXxNX67rvvhCRJIi8vT/w3Bw8eFJIkiezsbNFUQECASEpKEk0999xz4g9/+IO4kpdeekkMGTJEXLp0STi9/PLLYvr06eK2cfgrIXq5C9HLXYjRvxOK1qehFYSGhiL74osvGDduHDt37sTT05OgoCCa64EHHsDb25sJEybw+9//nkGDBvHEE0/g4eFBS/j7+9O2bVtkv/nNb/D09OTMmTM0x8mTJ5HNmDGDGTNm4CojIwM/Pz+aKzQ0lNDQUG6UwsJCFi5cSFZWFhUVFTidP3+e5ho5ciRxcXGMHj2a4OBgHn/8cfr06YNTbm4uFRUV9OnTh6bi4+NRKJpDQyvw9PTkySefJC0tDZPJxMaNGzEYDGg0GpqrTZs2/Otf/+Lzzz9n7969xMbGsnDhQiwWC23atKG5PDw8cFKpVHh4eNDQ0EBzOBwOZBs2bKBTp0646ty5M7cKIQTTp0+nsrKS2NhYevfuzZkzZzCbzTQ0NNBcRqOR3/72t2zfvp1NmzaRlJTEnDlzeO6555DZ7XZGjx7NpEmTcKVSqVAomktDK3niiSeYOHEiW7ZsobS0lMcff5yW8vLywmQyYTKZ2LdvHxMmTODgwYMMHjyY5jpw4AANDQ24ublhs9moqKigW7duNOXr68vZs2dxpdPpkDU0NODn58e1OHLkCBs2bKBz587ExMRwPRUXF5OdnU18fDwRERHI0tPTuRJfX1/Onj3L5QQEBBAQEMC0adMwmUykpqby3HPPIdPr9Zw9exY/Pz9+yYkTJ1i3bh0qlYrZs2ejULhS00qCg4Px9PQkJiYGrVZL//79cVVZWYnVaqW0tBSZzWbDarVSWVmJ7PDhw6xbt44ffvgBm81GVlYWsu7du+NUUlKC1WqlqqoKmdVqxWq1UldXh6uEhATy8/P529/+hmz48OE09cgjj7Bt2zZ27dpFXl4edrudAQMGoNfrmTVrFps3b6a8vJzc3Fz++te/Ul5eTkucOXOGlJQUtm7dyvXWvXt3evbsye7duyksLGTLli189NFHXMkjjzzCtm3b2LVrF3l5edjtdmR///vfOXToENXV1Rw7dozCwkL8/PxweuGFF9i/fz/x8fHk5+djtVpJS0tj3bp1uCotLSU5OZn169ejUDSloZVoNBqefvpp1q5dy7PPPotKpcLVnDlz2LFjB05msxlZeHg4H3zwAfX19SxYsIC33noLmU6nY/bs2fTq1QuniIgI6urqcBo6dCiyv/zlL4wdOxY3Nzf8/f3ZuXMna9asQRYXF0evXr1oKjIykurqav74xz8i27p1K/fddx9LliwhNjaWmJgYnPr164dGo6ElVCoVN4parebPf/4z7777Lv+vPbiBifJOEDj8Y0CcBkTZoSisOBMuvmN2S6tgDyXeclFXKjjNaqYiu6OXsHxGDLFCLiNmBdRQq5KlH25R62IiNi2l9YsckhZHUQ40CIiwQUmDgKB8oyAjlPlf302mmRDbA61ot+/zrFq1CllycjI5OTmoVCrGi4yMpL+/n82bNyM7e/Ys8+fP58aNG3zwwQfYrVixgrfffhu7sLAw/vKXv5CZmUleXh4yNzc3tm3bhqO+vj5kfn5+KBTjOYnvMFHG/4DqSv7pswsQtJSpZLPZuHfvHjIfHx+elM1mo62tDW9vb9RqNU9icHCQrq4uNBoNHh4evIiEELS1teHr64uzszNP4sGDB3R3d+Pr68v06dN5HJvNRkdHB05OTsyePRtnZ2ccpaWl8fnnn7N//34MBgMvlGsV8Nbv+KeF/w6Fl1BMLRd+RlQqFT4+PjwtlUrFvHnzeBru7u64u7vzInNycsLPz4+nMWPGDGbMmMGPUalU/PrXv+aHnD9/Hp1OR3h4OArFeC4oFM+QzWbjwIED+Pr64uzsjEIxngsKxTOkUqlYunQpCsUPUaFQKBTPkYrJUL/E94aHUCh+9oaH+J76JRRTT8Vk+Ov53idHUCh+9j45wvf+TY9i6jmJ7zBRVf8L60P53n++AWvWw3Q1CsXPyiMrnP0MLMV871MLLA5BMbWcxHeYjP+Og8/zUCj+pRj/C/YeRjH1VEzW7g/hT3EoFP8y/hQHuw+ieD6cxHd4Eo118D9fwO1vYOQRCsXPiut00PrD6nWgD0DxHImn9OjRIxEXFyfy8vKE7PLlyyIuLk7U19eLH7Np0yZRXFwsxmtubhabNm0Szc3N4qe2a9cu8eGHH4ofs2HDBhEeHi7Cw8PF559/Ln4KmzZtEsXFxUL26NEjERcXJ/Ly8oTs8uXLIi4uTtTX14tnwWq1isLCQhEfHy/Wr18vKisrxUS9++67Ijw8XISHh4udO3cKheJZUPGUbDYbFouFmzdvIuvs7MRisTAwMMCPqaiooLu7m/GsVisVFRVYrVZ+ardu3aK1tZUfk5ycjNlspqOjg76+Pn4KFRUVdHd3I7PZbFgsFm7evImss7MTi8XCwMAAz0JZWRlms5mAgAAiIyOZO3cuE2UwGDCbzcyaNYvW1lYUimfBhReMXq+nsbGR52XJkiX8K7lw4QLBwcFs3ryZyVqwYAGyU6dO0dvbi0LxLKiYAkIIDh8+TGhoKCEhIXz00UeM19HRQVRUFFFRUURFRXH79m3GKy0tJSkpCb1eT0hICCkpKdgNDw+zfft2QkND0ev1REREkJubi81mw9HAwADJycno9XrefPNNKisrmQyr1UpWVhahoaEEBgaSkJBAe3s7dkIIDh8+TGhoKCEhIXz00Uc8qYSEBIxGIxcvXmSydu/ejdFopKioiBs3bmA0GjEajVRWViIbHh5m+/bthIaGotfriYiIIDc3F5vNxmSUlpaSlJSEXq8nJCSElJQUHFmtVrKysggNDSUwMJCEhATa29tRKOxceEouLi6YTCZee+01ZDqdDpPJxJw5c7A7c+YM+/fvx2AwEBQUxPvvv894M2fOJDo6mpaWFt59912GhoZw1NHRQWJiIuvWrSMvL4/BwUHOnTuH3cOHD7lz5w5bt27F29ubmpoasrOzUalUxMbGYvf1118THBxMVlYWeXl5bNq0ibKyMry9vZmI5ORkrl69SkxMDLNnz+bo0aOkpqaSn5+P7MyZM+zfvx+DwUBQUBDvv/8+jlxcXDCZTLz22mvIdDodJpOJOXPmMN7169fp6emhv7+fyTIYDCxbtoy//e1vjI2NkZSUhMzf3x/Zw4cPuXPnDlu3bsXb25uamhqys7NRqVTExsYyER0dHSQmJrJu3Try8vIYHBzk3LlzOEpOTubq1avExMQwe/Zsjh49SmpqKvn5+SgU/ySmwIYNG8SqVauEXWlpqZAkSRw/flyM949//ENIkiTq6+uFo/LyciFJkqiqqhITtXHjRhEdHS3sNm3aJCRJElarVciam5uFJEni448/FuMtWrRIHD58WDiqra0VkiSJwsJCYVdfXy8kSRLNzc1CtmHDBrFq1SphV1paKiRJEsePHxeTFRcXJ9auXSvOnz8vntSWLVtEYmKimIiNGzeK6OhoMV5KSoqIjo4W45WXlwtJkkRVVZV4nNraWiFJkigsLBR29fX1QpIk0dzcLBQKmQtToLGxkdWrV2P3yiuvMFlBQUFoNBpiYmJYvnw5S5YsYc2aNajVauzy8/M5ceIETU1N2AUEBOBo4cKFTJ8+Hdm8efNwc3OjpaWFiWhqakJmNpsxm804unTpElqtlsbGRlavXo3dK6+8wpPKzc3lWcrPz+fEiRM0NTVhFxAQwEQFBQWh0WiIiYlh+fLlLFmyhDVr1qBWq5E1NTUhM5vNmM1mHF26dAmtVotC4cIUUavV2E2fPp3JcnV1paSkhJMnT3LhwgXS0tLIzs7GYrHg6upKktt55AAACz9JREFUeXk5mZmZxMbGsmvXLry8vMjIyKCvrw9HarUaOycnJ9RqNWNjY0zEyMgIsoKCAmbOnIkjT09P7NRqNXbTp0/nRVReXk5mZiaxsbHs2rULLy8vMjIy6OvrY6JcXV0pKSnh5MmTXLhwgbS0NLKzs7FYLLi6ujIyMoKsoKCAmTNn4sjT0xOFQubCFNDpdNTW1mLX0NDAk3B3d8dkMmEymSgrKyMmJoYrV66wbNkyioqK0Gg0bNu2DScnJ0ZHR6murkan0+GooqKCsbExnJ2d6ezspKenBx8fH8abO3cu9+7dw5FOp0M2NjaGVqvlcXQ6HbW1tdg1NDTwpPbt20dfXx9vvfUWixYt4qdUVFSERqNh27ZtODk5MTo6SnV1NTqdjvG8vLy4fv06j+Pu7o7JZMJkMlFWVkZMTAxXrlxh2bJl6HQ6ZGNjY2i1Wn7MoUOHaG9vZ+XKlSxbtgzFL4eKKWAwGKirq+Po0aPU1NSQk5PDeL29vbS3t3P37l1knZ2dtLe309vbi6yqqor8/Hza2tro7Ozk6tWryHx9fZEtXbqUnp4eysrKuHXrFunp6QwNDfE4e/fupaGhgXfeeQfZG2+8wXi///3vKSoq4quvvqK+vh6r1crrr7+OXq9nx44dnD59mu7uburq6tizZw/d3d3IDAYDdXV1HD16lJqaGnJycnhSX375JYWFhbS2tvJTW7p0KT09PZSVlXHr1i3S09MZGhricX73u9/R3NzMiRMnqK+vp7e3F1lVVRX5+fm0tbXR2dnJ1atXkfn6+iJ7/fXX0ev17Nixg9OnT9Pd3U1dXR179uyhu7sbRyUlJXzyySfcvHkTxS+LC1MgKiqKmpoa9u7diywsLAyZk5MTdhkZGRQXF2MXHx+PLCwsjPfee4/R0VEOHDhAZmYmMp1Ox86dO/H390e2cuVKwsLCiI2NRbZw4UJWr15NS0sLds7OzixcuJBz585x7NgxZOnp6fj7+zNeZGQk/f39bN68GdnZs2eZP38+Bw8eJC0tjdTUVOwCAgJwcXFBFhUVRU1NDXv37kUWFhaGzMnJicmaNm0aT8vJyQmVSsV4K1euJCwsjNjYWGQLFy5k9erVtLS0MN7ixYt5++23+eCDD+jp6SE9PZ2oqChGR0c5cOAAmZmZyHQ6HTt37sTf3x+Zs7MzBw8eJC0tjdTUVOwCAgJwcXHBUVdXF7LZs2ej+GVxEt9hivT19fHtt9/y8ssv8yRsNhv37t1D5uPjw+Pcv3+f0dFRNBoNP8Rms9HW1oa3tzdqtZonMTg4SFdXFxqNBg8PD8br6+vj22+/5eWXX+ZFdv/+fUZHR9FoNDwJm83GvXv3kPn4+PBDBgcH6erqQqPR4OHhgaO2tjZWrFiBn58f586dw9nZGcUvhwtTyNPTk6ehUqnw8fHhx3h4ePD/UalUzJs3j6fh7u6Ou7s7P8TT05OfAw8PD56GSqXCx8eH/4+7uzvu7u48TlVVFbKtW7fi7OyM4pfFSXwHheI5am1tpa2tjeDgYFQqFYpfFifxHRQKheI5UaFQKBTPkQqFQqF4jlQoFArFc6RCoVAoniMVCoVC8RypUCgUiudIhUKhUDxHKp7SyMgI8fHxHDt2DFl5eTnx8fE0NDTwvO3fv5/s7Gwc3b17l8LCQo4cOcKVK1eYrH379hEREUFERATp6elM1sjICPHx8Rw7dgxZeXk58fHxNDQ08Cw8evSIL774goSEBCIjI7ly5QoTtW/fPiIiIoiIiCA9PR2F4llQ8ZRsNhsWi4WbN28i6+zsxGKxMDAwwPP2zTff0NzcjF1jYyPh4eHs2bOHL7/8ko0bN3LgwAEmw2AwYDabmTVrFq2trUyWzWbDYrFw8+ZNZJ2dnVgsFgYGBngWysrKMJvNBAQEEBkZydy5c5kog8GA2Wxm1qxZtLa2olA8Cy78guTk5DBjxgzOnDmDh4cHOTk5HDx4kPXr1+Pn58dELFiwANmpU6fo7e3lRXfhwgWCg4PZvHkzk7VgwQJkp06dore3F4XiWVAxRSoqKjAajVRXVxMbG4ter2fdunV0dHQgs1qtZGVlERoaSmBgIAkJCbS3t2N369YtEhISCAwMRK/XYzQaKS0txdHFixeJiIggMDCQ1NRUrFYrdoODg3z99dcYDAY8PDyQvfXWW8i++uorZI2NjRiNRk6fPo3RaCQwMJAPP/yQhw8fMhEjIyNERUXx2Wef4aikpASj0Uh/fz+TkZCQgNFo5OLFi0zW7t27MRqNFBUVcePGDYxGI0ajkcrKSmTDw8Ns376d0NBQ9Ho9ERER5ObmYrPZmIzS0lKSkpLQ6/WEhISQkpKCI6vVSlZWFqGhoQQGBpKQkEB7ezsKhZ2Kp+Ti4oLJZCI4OBiZTqfDZDIxZ84cHA0MDFBXV8ef//xnVCoVWVlZvPrqq9y/fx9ZcnIyBQUFREZGkpaWRmtrK6mpqdi1tbXh6enJO++8Q25uLv7+/iQmJlJdXY3s9u3bxMbG8tJLL7Fjxw5aWlq4fPkydl1dXcj8/f2x8/X1RXb37l1kw8PD1NXVkZ6ezhtvvEF0dDTvvfceFy9eZCJcXV3x8/Pj0KFDCCGwO378OG5ubsyaNQsXFxdMJhPBwcHIdDodJpOJOXPmMN7169epq6ujv7+fyTIYDCQlJTF//nz8/f1JSkoiKSkJf39/ZA8fPuTOnTts3bqVv//970RERJCdnc3HH3/MRHV0dJCYmMiMGTPIy8sjIyOD8ZKTkykoKCAyMpK0tDRaW1tJTU1FofiemCLFxcVCkiSxb98+MV5tba2QJEkUFhYKu/r6eiFJkmhubhaPMzQ0JCRJEocOHRKynJwcIUmS6OrqErKBgQEhSZLYsmWLkF27dk1IkiRKSkqEo0WLFolt27YJWXV1tZAkSRw9elTYhYeHi/T0dDFeSkqKiI6OFuNVVlYKSZLEtWvXhKylpUVIkiTOnj0rJisuLk6sXbtWnD9/XjypLVu2iMTERDERGzduFNHR0WK8lJQUER0dLcYrLy8XkiSJqqoq8Ti1tbVCkiRRWFgo7Orr64UkSaK5uVkoFDIXplhoaCjjNTU1ITObzZjNZhxdunQJrVbL8PAwf/3rXykuLubu3bvYPXjwAFlLSwtz5szBy8sLmYeHBzqdDrtp06YhGxsbY7xp06bhaPHixdj99re/5fbt20zU4sWL8fPz49SpUyxatIgzZ87g5ubGihUrmKzc3Fyepfz8fE6cOEFTUxN2AQEBTFRQUBAajYaYmBiWL1/OkiVLWLNmDWq1GllTUxMys9mM2WzG0aVLl9BqtSgULkwxvV7PeCMjI8gKCgqYOXMmjjw9PZEdOnSIvLw8MjIyePXVV3Fzc2Pt2rXYbDZko6OjqNVqHLm5uWH3q1/9Cll/fz92Y2NjDA0N4eXlhSN3d3fsVCoVY2NjTJRKpeKPf/wje/fuJTU1lU8//RSj0YhareZFUl5eTmZmJrGxsezatQsvLy8yMjLo6+tjolxdXSkpKeHkyZNcuHCBtLQ0srOzsVgsuLq6MjIygqygoICZM2fiyNPTE4VCpuIFoNPpkI2NjaHVatFqtWi1WrRaLR4eHsi++OIL1q1bx4YNG/jNb37DgwcPGBoawm7u3Lk0NzczODiIzGq1Ul9fj523tzdubm5cu3YNu4aGBmSSJDFZXl5etLW18Thvvvkmst27d3P37l3+8Ic/8CT27dvH9u3bqa6u5qdWVFSERqNh27ZtBAYG4uPjQ3V1NY/j5eVFW1sbj+Pu7o7JZOLw4cMcOXKEnp4erly5gkyn0yEbGxtDq9Wi1WrRarVotVo8PDxwdOjQIdLT07l06RKKX5b/A//MNygYl/xAAAAAAElFTkSuQmCC" alt="图片"></p>
</blockquote>
<h2 id="获取-field-display-的方法有："><a href="#获取-field-display-的方法有：" class="headerlink" title="获取 field display 的方法有："></a>获取 field display 的方法有：</h2><ul>
<li>field.display</li>
<li>field.getState().display</li>
<li>form.query(‘xxxx’).get(‘display’)</li>
</ul>
<h2 id="⚠️-注意："><a href="#⚠️-注意：" class="headerlink" title="⚠️ 注意："></a>⚠️ 注意：</h2><ul>
<li>field display 状态为 none 时，form.values 中就不会包含该字段。</li>
<li>父级字段 display 状态为 none，子元素字段会被销毁，无法查到子元素字段，但是父级字段仍然可以被 (Field / Form).query 查到，此时父级字段 value 为 undefined。</li>
<li>field display 状态为 hidden 时，是可以修改数据状态的。</li>
<li>父级字段 display 状态为 hidden，子元素字段仍会保留，可以查到子元素字段。</li>
<li>field display 状态不为 visible 时，form.validate 是不会校验隐藏中的字段。</li>
<li>field 一旦挂载到 form 上如果不是通过设置 field display 状态控制显隐，form.submit 或 form.validate 时会校验该字段。<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token operator">&lt;</span>FormProvider<span class="token operator">></span>
  <span class="token comment">// 这种情况就不是通过 field display 状态控制显隐，field 一旦挂载到 form 上就会在 form.submit 或 form.validate 时触发 field 校验</span>
  <span class="token punctuation">&#123;</span>show <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>Field
      name<span class="token operator">=</span><span class="token string">"test"</span>
      required
      component<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">[</span>Input<span class="token punctuation">]</span><span class="token punctuation">&#125;</span>
    <span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">&#125;</span>
  <span class="token comment">// 这种情况下，field 隐藏时 form 进行校验时不会触发 field validate</span>
  <span class="token operator">&lt;</span>Field
    name<span class="token operator">=</span><span class="token string">"hiddenTest"</span>
    required
    component<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">[</span>Input<span class="token punctuation">]</span><span class="token punctuation">&#125;</span>
    reactions<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">[</span>
      <span class="token punctuation">(</span>field<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        field<span class="token punctuation">.</span>hidden <span class="token operator">=</span> <span class="token function">String</span><span class="token punctuation">(</span>field<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">"345"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">&#125;</span>
    <span class="token punctuation">]</span><span class="token punctuation">&#125;</span>
  <span class="token operator">/</span><span class="token operator">></span>
  <span class="token comment">// ...</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>FormProvider<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ul>
<blockquote>
<p>更多可以阅读源码：<a href="https://github.com/alibaba/formily/blob/formily_next/packages/core/src/shared/internals.ts#L949">https://github.com/alibaba/formily/blob/formily_next/packages/core/src/shared/internals.ts#L949</a></p>
</blockquote>
<h1 id="setValues-过后触发了预期外的-Field-响应"><a href="#setValues-过后触发了预期外的-Field-响应" class="headerlink" title="setValues 过后触发了预期外的 Field 响应"></a>setValues 过后触发了预期外的 Field 响应</h1><p>有很多时候我们需要使用到 setValues，但是可能会因为忽略 setValues 的<strong>合并策略</strong>而导致意想不到的问题：明明只想 setValues test 的值，但是 setValues 后怎么触发了 test2 的 reaction 响应？</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token operator">&lt;</span>FormProvider form<span class="token operator">=</span><span class="token punctuation">&#123;</span>form<span class="token punctuation">&#125;</span><span class="token operator">></span>
  <span class="token operator">&lt;</span>Field
    name<span class="token operator">=</span><span class="token string">"test"</span>
    title<span class="token operator">=</span><span class="token string">"test"</span>
    required
    decorator<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">[</span>FormItem<span class="token punctuation">]</span><span class="token punctuation">&#125;</span>
    component<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">[</span>Input<span class="token punctuation">]</span><span class="token punctuation">&#125;</span>
  <span class="token operator">/</span><span class="token operator">></span>
  <span class="token operator">&lt;</span>Field
    name<span class="token operator">=</span><span class="token string">"test2"</span>
    title<span class="token operator">=</span><span class="token string">"test2"</span>
    required
    decorator<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">[</span>FormItem<span class="token punctuation">]</span><span class="token punctuation">&#125;</span>
    component<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">[</span>Input<span class="token punctuation">]</span><span class="token punctuation">&#125;</span>
    reactions<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">[</span>
      <span class="token punctuation">(</span>field<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"test2 reactions"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> hidden <span class="token operator">=</span> <span class="token function">String</span><span class="token punctuation">(</span>field<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">"345"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        field<span class="token punctuation">.</span>hidden <span class="token operator">=</span> hidden<span class="token punctuation">;</span>
      <span class="token punctuation">&#125;</span>
    <span class="token punctuation">]</span><span class="token punctuation">&#125;</span>
  <span class="token operator">/</span><span class="token operator">></span>
  <span class="token operator">&lt;</span>Button
    type<span class="token operator">=</span><span class="token string">"primary"</span>
    onClick<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
      <span class="token comment">// 这种方式会导致 test2 的 reactions 响应</span>
      form<span class="token punctuation">.</span><span class="token function">setValues</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
        test<span class="token operator">:</span> <span class="token number">123</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>
  <span class="token operator">></span>
    setValue
  <span class="token operator">&lt;</span><span class="token operator">/</span>Button<span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>FormProvider<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>以上仅 demo 讲解，设置单个字段值可以使用 form.setValuesIn()</p>
</blockquote>
<h2 id="setValues-的合并策略："><a href="#setValues-的合并策略：" class="headerlink" title="setValues 的合并策略："></a>setValues 的合并策略：</h2><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">interface</span> <span class="token class-name">setValues</span> <span class="token punctuation">&#123;</span>
  <span class="token punctuation">(</span>values<span class="token operator">:</span> object<span class="token punctuation">,</span> strategy<span class="token operator">:</span> IFormMergeStrategy <span class="token operator">=</span> <span class="token string">'merge'</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">type</span> <span class="token class-name">IFormMergeStrategy</span> <span class="token operator">=</span> <span class="token string">'overwrite'</span> <span class="token operator">|</span> <span class="token string">'merge'</span> <span class="token operator">|</span> <span class="token string">'deepMerge'</span> <span class="token operator">|</span> <span class="token string">'shallowMerge'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>从上面的代码中可以看出，setValues 的默认合并策略是 merge，所以大部分时候我们使用 setValues 时，不用特意设置合并策略。<br>然而在某些特殊场景下，merge 合并策略并不适用：</p>
<ul>
<li>form 重新 setValues 想要覆盖 form 旧的 value，然而旧的 value 的数据结构和新的 value 数据结构不完全一致，此时的合并策略应该是 overwrite</li>
<li>需要批量设置某些浅层字段值但是不想触发其他字段的响应，合并策略可以使用 shallowMerge</li>
<li>复杂的数据结构中需要修改某个层级较深的节点值需要使用 setValuesIn 的方式进行赋值<h2 id="不同的合并策略对应了不同的数据处理方式："><a href="#不同的合并策略对应了不同的数据处理方式：" class="headerlink" title="不同的合并策略对应了不同的数据处理方式："></a>不同的合并策略对应了不同的数据处理方式：</h2></li>
</ul>
<blockquote>
<p>源码：<a href="https://github.com/alibaba/formily/blob/HEAD/packages/core/src/models/Form.ts#L382-L393">https://github.com/alibaba/formily/blob/HEAD/packages/core/src/models/Form.ts#L382-L393</a></p>
</blockquote>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript">setValues <span class="token operator">=</span> <span class="token punctuation">(</span>values<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">,</span> strategy<span class="token operator">:</span> IFormMergeStrategy <span class="token operator">=</span> <span class="token string">'merge'</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isPlainObj</span><span class="token punctuation">(</span>values<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>strategy <span class="token operator">===</span> <span class="token string">'merge'</span> <span class="token operator">||</span> strategy <span class="token operator">===</span> <span class="token string">'deepMerge'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>values <span class="token operator">=</span> <span class="token function">merge</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>values<span class="token punctuation">,</span> values<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>
      <span class="token function-variable function">arrayMerge</span><span class="token operator">:</span> <span class="token punctuation">(</span>target<span class="token punctuation">,</span> source<span class="token punctuation">)</span> <span class="token operator">=></span> source<span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>strategy <span class="token operator">===</span> <span class="token string">'shallowMerge'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>values <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>values<span class="token punctuation">,</span> values<span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>values <span class="token operator">=</span> values <span class="token keyword">as</span> <span class="token builtin">any</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>从源码可以看出，merge 和 deepMerge 都是用的同一种方式即深度合并赋值。</p>
<blockquote>
<p>merge 策略源码：<a href="https://github.com/alibaba/formily/blob/HEAD/packages/shared/src/merge.ts#L132-L152">https://github.com/alibaba/formily/blob/HEAD/packages/shared/src/merge.ts#L132-L152</a></p>
</blockquote>
<h1 id="你可能忽略的路径系统"><a href="#你可能忽略的路径系统" class="headerlink" title="你可能忽略的路径系统"></a>你可能忽略的路径系统</h1><h2 id="formily-中有非常重要的路径系统"><a href="#formily-中有非常重要的路径系统" class="headerlink" title="formily 中有非常重要的路径系统"></a>formily 中有非常重要的路径系统</h2><ul>
<li>可以用来从字段集中查找任意一个字段，同时支持按照规则批量查找</li>
<li>可以用来表达字段间关系的模型，借助路径系统，我们可以实现查找某个字段父节点，能查找父节点，也就能实现树级别的数据继承能力，同样，我们也能查找某个字段的相邻节点</li>
<li>可以用来实现字段数据的读写，带解构的数据读写</li>
<li>路径系统拥有很多 api，可以自由拼接路径<h2 id="路径模型"><a href="#路径模型" class="headerlink" title="路径模型"></a>路径模型</h2></li>
</ul>
<blockquote>
<p>参考链接：<a href="https://core.formilyjs.org/zh-CN/guide/field#%E8%B7%AF%E5%BE%84%E8%A7%84%E5%88%99">formily 路径规则</a><br>路径系统 api：<a href="https://core.formilyjs.org/zh-CN/api/entry/form-path">https://core.formilyjs.org/zh-CN/api/entry/form-path</a></p>
</blockquote>
<p><img src="/./%E8%B7%AF%E5%BE%84%E6%A8%A1%E5%9E%8B.png" alt="formily路径模型"></p>
<p>表单结构本身就是一个树结构，每个字段都有自己的绝对路径和相对路径。其中 field address 永远是代表节点的绝对路径，path 是会跳过 VoidField 的节点路径，但是如果是 VoidField 的 Path，是会保留它自身的路径位置。</p>
<p>利用路径模型和规则可以精确的找到或操作 formily 字段值，实现更加精细化地操作，增加了 formily 表单操作的灵活性。</p>
<h2 id="路径系统可以解决的问题："><a href="#路径系统可以解决的问题：" class="headerlink" title="路径系统可以解决的问题："></a>路径系统可以解决的问题：</h2><p><strong>Q：****数据结构和组件结构存在差异</strong></p>
<p>通常在数据结构比较复杂的表单中，容易遇到这样的问题：两个字段是兄弟关系，但是在组件结构中是嵌套关系，例如：</p>
<p>当 hasBirthday 的值不是【保密】时需要设置 birthday 数据，hasBirthday 和 birthday 数据又是平级关系</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 数据格式：&#123; hasBirthday: boolean; birthday: Date | null; &#125;</span>

<span class="token keyword">const</span> DateSelect <span class="token operator">=</span> <span class="token function">observer</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> parentField <span class="token operator">=</span> <span class="token function">useField</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>Field 
      name<span class="token operator">=</span><span class="token string">"birthday"</span> 
      <span class="token comment">// 指向 parent 路径</span>
      basePath<span class="token operator">=</span><span class="token punctuation">&#123;</span>parentField<span class="token punctuation">.</span>address<span class="token punctuation">&#125;</span> 
      component<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">[</span>DatePicker<span class="token punctuation">]</span><span class="token punctuation">&#125;</span>
    <span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">DemoForm</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token comment">// ...</span>
    <span class="token operator">&lt;</span>FormProvider form<span class="token operator">=</span><span class="token punctuation">&#123;</span>form<span class="token punctuation">&#125;</span><span class="token operator">></span>
      <span class="token punctuation">&#123;</span><span class="token comment">/* 具体写法可以参考 sugar-design 的 RadioGroup */</span><span class="token punctuation">&#125;</span>
      <span class="token operator">&lt;</span>Field
        name<span class="token operator">=</span><span class="token string">"hasBirthday"</span>
        title<span class="token operator">=</span><span class="token string">"生日"</span>
        required
        decorator<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">[</span>FormItem<span class="token punctuation">]</span><span class="token punctuation">&#125;</span>
        component<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">[</span>FormRadioGroup<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>
          options<span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">&#123;</span>
              label<span class="token operator">:</span> <span class="token operator">&lt;</span>DateSelect <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">,</span>
              value<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
            <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
            <span class="token punctuation">&#123;</span>
              label<span class="token operator">:</span> <span class="token string">'保密'</span><span class="token punctuation">,</span>
              value<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
            <span class="token punctuation">&#125;</span>
          <span class="token punctuation">]</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span>
      <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>FormProvider<span class="token operator">></span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>在这种情况下 Field basePath 是非常好用的。当不够明确数据结构时，可以使用 basePath 明确指出 parent 字段路径。</p>
<p><strong>Q：setValues 后表单并没有显示预期的数据</strong></p>
<p>当我们遇到 Field 组件没有渲染出 Field value 时，不妨查看一下 Field 组件的绝对路径指向是否正确。</p>
<blockquote>
<p>使用 FormStep 组件时需要注意 basePath 的使用。</p>
</blockquote>
<h1 id="field-validator-无法清空-setSelfErrors-设置的-error"><a href="#field-validator-无法清空-setSelfErrors-设置的-error" class="headerlink" title="field validator 无法清空 setSelfErrors 设置的 error"></a>field validator 无法清空 setSelfErrors 设置的 error</h1><p>有的时候我们使用 setSelfErrors 手动设置了字段的 errors，但是在字段触发 field validator 时并没有清空我们手动设置的 errors，还得再次手动清空 setSelfErrors([])。</p>
<p>简单的 demo：</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token operator">&lt;</span>FormProvider form<span class="token operator">=</span><span class="token punctuation">&#123;</span>form<span class="token punctuation">&#125;</span><span class="token operator">></span>
  <span class="token operator">&lt;</span>Field
    name<span class="token operator">=</span><span class="token string">"test2"</span>
    title<span class="token operator">=</span><span class="token string">"test2"</span>
    required
    decorator<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">[</span>FormItem<span class="token punctuation">]</span><span class="token punctuation">&#125;</span>
    component<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">[</span>Input<span class="token punctuation">]</span><span class="token punctuation">&#125;</span>
    reactions<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">[</span>
      <span class="token punctuation">(</span>field<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">String</span><span class="token punctuation">(</span>field<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">"345"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
          <span class="token comment">// 这种 👇 方式设置 errors 需要手动清空</span>
          <span class="token punctuation">(</span>field<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string">"test3"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">take</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> FieldType<span class="token punctuation">)</span><span class="token operator">?.</span><span class="token function">setSelfErrors</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
            <span class="token string">"test2 set test3 selfErrors"</span>
          <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token comment">// field validator 可以清空这种 👇 方式设置的 error</span>
          <span class="token punctuation">(</span>field<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string">"test3"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">take</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> FieldType<span class="token punctuation">)</span><span class="token operator">?.</span><span class="token function">setFeedback</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
            type<span class="token operator">:</span> <span class="token string">"error"</span><span class="token punctuation">,</span>
            triggerType<span class="token operator">:</span> <span class="token string">"onInput"</span><span class="token punctuation">,</span>
            messages<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"test2 set test3 selfErrors"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            code<span class="token operator">:</span> <span class="token string">"ValidateError"</span>
          <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
      <span class="token punctuation">&#125;</span>
    <span class="token punctuation">]</span><span class="token punctuation">&#125;</span>
  <span class="token operator">/</span><span class="token operator">></span>
  <span class="token operator">&lt;</span>Field
    name<span class="token operator">=</span><span class="token string">"test3"</span>
    title<span class="token operator">=</span><span class="token string">"test3"</span>
    required
    decorator<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">[</span>FormItem<span class="token punctuation">]</span><span class="token punctuation">&#125;</span>
    component<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">[</span>Input<span class="token punctuation">]</span><span class="token punctuation">&#125;</span>
    validator<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">[</span>
      <span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// 清空不了 setSelfErrors 设置的 error messages</span>
        <span class="token keyword">return</span> <span class="token function">String</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">"345"</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token string">"value includes 354"</span> <span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">;</span>
      <span class="token punctuation">&#125;</span>
    <span class="token punctuation">]</span><span class="token punctuation">&#125;</span>
  <span class="token operator">/</span><span class="token operator">></span>
  <span class="token operator">&lt;</span>Button
    type<span class="token operator">=</span><span class="token string">"primary"</span>
    onClick<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
      form<span class="token punctuation">.</span><span class="token function">submit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>
  <span class="token operator">></span>
    submit
  <span class="token operator">&lt;</span><span class="token operator">/</span>Button<span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>FormProvider<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>需要先看一下 setSelfErrors 相关的源码：</strong></p>
<blockquote>
<p>源码链接：<a href="https://github.com/alibaba/formily/blob/formily_next/packages/core/src/models/Field.ts#L396-L402">https://github.com/alibaba/formily/blob/formily_next/packages/core/src/models/Field.ts#L396-L402</a></p>
</blockquote>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">set</span> <span class="token function">selfErrors</span><span class="token punctuation">(</span>messages<span class="token operator">:</span> FeedbackMessage<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setFeedback</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
    type<span class="token operator">:</span> <span class="token string">'error'</span><span class="token punctuation">,</span>
    code<span class="token operator">:</span> <span class="token string">'EffectError'</span><span class="token punctuation">,</span>
    messages<span class="token punctuation">,</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">get</span> <span class="token function">selfErrors</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token function">queryFeedbackMessages</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>
    type<span class="token operator">:</span> <span class="token string">'error'</span><span class="token punctuation">,</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token function-variable function">setFeedback</span> <span class="token operator">=</span> <span class="token punctuation">(</span>feedback<span class="token operator">?</span><span class="token operator">:</span> IFieldFeedback<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token comment">// 如果存在原来的 feedback 则更新 feedback，否则就添加进去</span>
  <span class="token comment">// 如果新的 feedback messages 的 length 无效则删除这个 feedback</span>
  <span class="token function">updateFeedback</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> feedback<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>Field validator 结果转换为 feedbacks 的核心逻辑：</strong></p>
<blockquote>
<p>源码链接：<a href="https://github.com/alibaba/formily/blob/formily_next/packages/core/src/shared/internals.ts#L303-L324">https://github.com/alibaba/formily/blob/formily_next/packages/core/src/shared/internals.ts#L303-L324</a></p>
</blockquote>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">export</span> <span class="token keyword">const</span> validateToFeedbacks <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span>
  field<span class="token operator">:</span> Field<span class="token punctuation">,</span>
  triggerType<span class="token operator">:</span> ValidatorTriggerType <span class="token operator">=</span> <span class="token string">'onInput'</span>
<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> results <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">validate</span><span class="token punctuation">(</span>field<span class="token punctuation">.</span>value<span class="token punctuation">,</span> field<span class="token punctuation">.</span>validator<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>
    triggerType<span class="token punctuation">,</span>
    validateFirst<span class="token operator">:</span> field<span class="token punctuation">.</span>props<span class="token punctuation">.</span>validateFirst <span class="token operator">||</span> field<span class="token punctuation">.</span>form<span class="token punctuation">.</span>props<span class="token punctuation">.</span>validateFirst<span class="token punctuation">,</span>
    context<span class="token operator">:</span> <span class="token punctuation">&#123;</span> field<span class="token punctuation">,</span> form<span class="token operator">:</span> field<span class="token punctuation">.</span>form <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>

  <span class="token function">batch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token function">each</span><span class="token punctuation">(</span>results<span class="token punctuation">,</span> <span class="token punctuation">(</span>messages<span class="token punctuation">,</span> type<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
      field<span class="token punctuation">.</span><span class="token function">setFeedback</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
        triggerType<span class="token punctuation">,</span>
        type<span class="token punctuation">,</span>
        code<span class="token operator">:</span> <span class="token function">pascalCase</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">validate-</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span><span class="token keyword">type</span><span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        messages<span class="token operator">:</span> messages<span class="token punctuation">,</span>
      <span class="token punctuation">&#125;</span> <span class="token keyword">as</span> <span class="token builtin">any</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> results
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>patternType 不为 editable 或 visible 状态的不会进行 Field 校验<br>从源码中得出结论：</p>
</blockquote>
<p><img src="/./%E6%A0%A1%E9%AA%8C%E8%A7%84%E5%88%99.png" alt="校验规则"></p>
<p><strong>formily 这样设计的原因是：</strong></p>
<p>为了防止用户修改校验结果污染本身校验器的校验结果，做严格分离，容易恢复现场。</p>
<blockquote>
<p>更多阅读：<a href="https://core.formilyjs.org/zh-CN/guide/field#%E6%A0%A1%E9%AA%8C%E8%A7%84%E5%88%99">formily 校验规则</a></p>
</blockquote>
<h2 id="使用-setSelfErrors-还是使用-setFeedback"><a href="#使用-setSelfErrors-还是使用-setFeedback" class="headerlink" title="使用 setSelfErrors 还是使用 setFeedback"></a>使用 setSelfErrors 还是使用 setFeedback</h2><ul>
<li>如果 Field 需要展示 error message，并且定义了 Field validator，建议使用 setFeedback 的方式</li>
<li>如果 Field 不需要展示 error message，但是定义了 Field validator，建议使用 setFeedback 的方式</li>
<li>如果需要清空 ValidateError message 可以手动调用 field.validate() 动态清空</li>
<li>如果 Field 不展示 error message，没有定义 Field validator，需要手动维护 Field error 状态时，可以使用 setSelfErrors 的方式，这种方式会更方便（不用写 code、type 等参数）</li>
<li>如果想要和 Field 本身校验结果隔离，就需要使用 setSelfErrors 的方式</li>
</ul>
<h2 id="⚠️-注意"><a href="#⚠️-注意" class="headerlink" title="⚠️ 注意"></a>⚠️ 注意</h2><ul>
<li>field.selfErrors 获取的 error message 包含了 setSelfErrors 和 setFeedback 方式设置的 type 为 error 的 message</li>
<li>setFeedback api 是更新 code、type、triggerType 完全一致的 feedback 数据</li>
</ul>
<h2 id="Field-validator-最佳实践"><a href="#Field-validator-最佳实践" class="headerlink" title="Field validator 最佳实践"></a>Field validator 最佳实践</h2><ul>
<li>将 Field 校验逻辑统一写到 Field validator 中会更好维护，在需要更新字段校验状态时，可以手动调用 field.validate 方法</li>
<li>ObjectField 和 ArrayField 的子元素数量改变才会自动触发 ObjectField/ArrayField validator</li>
</ul>
<h1 id="联动使用-Field-reaction-还是-effect-hooks"><a href="#联动使用-Field-reaction-还是-effect-hooks" class="headerlink" title="联动使用 Field reaction 还是 effect hooks"></a>联动使用 Field reaction 还是 effect hooks</h1><blockquote>
<p>参考链接：<a href="https://formilyjs.org/zh-CN/guide/advanced/linkages">实现联动逻辑</a><br>我们会遇到很多字段联动的表单需求，如 a 字段的修改需要联动 b 字段的修改，a 字段设置了特定的值后需要隐藏 c 字段等复杂的联动交互逻辑可能是表单中最复杂的部分了。一对一、一对多、链式、循环、异步、主动模式、被动模式等多种联动方式，稍不注意就会陷入了深坑当中。</p>
</blockquote>
<p>demo示例：</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">const</span> LeaveConfig<span class="token operator">:</span> React<span class="token punctuation">.</span><span class="token constant">FC</span> <span class="token operator">=</span> <span class="token function">observer</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token function">useFormEffects</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// askForLeaveUnit.minUnit 修改会联动修改 minDuration 的值并进行校验</span>
    <span class="token function">onFieldValueChange</span><span class="token punctuation">(</span><span class="token string">'askForLeaveUnit.minUnit'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>field<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">const</span> minUnit <span class="token operator">=</span> field<span class="token punctuation">.</span>value<span class="token punctuation">;</span>
      <span class="token keyword">const</span> minDurationField <span class="token operator">=</span> field<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string">'minDuration'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">take</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> FieldType<span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>minDurationField<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">const</span> minDuration <span class="token operator">=</span> minDurationField<span class="token punctuation">.</span>value<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>minDuration <span class="token operator">&lt;</span> minUnit<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
          minDurationField<span class="token punctuation">.</span><span class="token function">setValue</span><span class="token punctuation">(</span>minUnit<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        minDurationField<span class="token punctuation">.</span><span class="token function">validate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span><span class="token operator">></span>
      <span class="token comment">//...</span>
      <span class="token operator">&lt;</span>Field
        name<span class="token operator">=</span><span class="token string">"minUnit"</span>
        component<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">[</span>
          FormSelect<span class="token punctuation">,</span>
          <span class="token punctuation">&#123;</span>
            size<span class="token operator">:</span> <span class="token string">'md'</span><span class="token punctuation">,</span>
            className<span class="token operator">:</span> styles<span class="token punctuation">.</span>formSmallSelect<span class="token punctuation">,</span>
          <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">&#125;</span>
        reactions<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">[</span>
          <span class="token punctuation">(</span>field<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
            <span class="token comment">// 监听 leaveUnit 的值修改动态设置 minUnit 的选项值和选中值</span>
            <span class="token keyword">const</span> leaveUnit<span class="token operator">:</span> LeaveUnitItem <span class="token operator">=</span> field<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string">'.leaveUnit'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>leaveUnit<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
              <span class="token keyword">return</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
            <span class="token keyword">const</span> newOptions <span class="token operator">=</span> <span class="token function">getScopeOptions</span><span class="token punctuation">(</span>leaveUnit<span class="token punctuation">)</span><span class="token punctuation">;</span>
            field<span class="token punctuation">.</span><span class="token function">setComponentProps</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
              options<span class="token operator">:</span> newOptions<span class="token punctuation">,</span>
            <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            field<span class="token punctuation">.</span><span class="token function">setValue</span><span class="token punctuation">(</span>
              Math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>
                Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span>field<span class="token punctuation">.</span>value<span class="token punctuation">,</span> newOptions<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">,</span>
                newOptions<span class="token punctuation">[</span>newOptions<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>value
              <span class="token punctuation">)</span>
            <span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">&#125;</span>
      <span class="token operator">/</span><span class="token operator">></span>
      <span class="token comment">//...</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="主动模式"><a href="#主动模式" class="headerlink" title="主动模式"></a>主动模式</h2><p>主动模式便于实现一对多联动。当前字段值修改影响其他字段。</p>
<p>主动模式联动核心基于：</p>
<ul>
<li><a href="https://core.formilyjs.org/zh-CN/api/entry/form-effect-hooks">FormEffectHooks</a></li>
<li><a href="https://core.formilyjs.org/zh-CN/api/entry/field-effect-hooks">FieldEffectHooks</a></li>
<li><a href="https://core.formilyjs.org/zh-CN/api/models/form#setformstate">setFormState</a></li>
<li><a href="https://core.formilyjs.org/zh-CN/api/models/form#setfieldstate">setFieldState</a></li>
</ul>
<p>常用的 fieldEffectHooks 有：</p>
<ul>
<li>onFieldValidateStart：监听某个字段校验触发开始的副作用钩子</li>
</ul>
<p>其中，value change effect hooks：</p>
<ul>
<li><a href="https://core.formilyjs.org/zh-CN/api/entry/field-effect-hooks#onfieldchange">onFieldChange</a>：用于监听某个字段的属性变化的副作用钩子，如监听字段的显隐变化</li>
<li><a href="https://core.formilyjs.org/zh-CN/api/entry/field-effect-hooks#onfieldvaluechange">onFieldValueChange</a>：用于监听某个字段值变化的副作用钩子</li>
<li><a href="https://core.formilyjs.org/zh-CN/api/entry/field-effect-hooks#onfieldinitialvaluechange">onFieldInitialValueChange</a>：用于监听某个字段默认值变化的副作用钩子</li>
<li><a href="https://core.formilyjs.org/zh-CN/api/entry/field-effect-hooks#onfieldinputvaluechange">onFieldInputValueChange</a>：用于监听某个字段 onInput 触发的副作用钩子<br>以上的 4 个 value change effect hooks 中最常用的为 onFieldValueChange 和 onFieldInputValueChange。</li>
</ul>
<h3 id="onFieldValueChange-和-onFieldInputValueChange-区别的常见场景："><a href="#onFieldValueChange-和-onFieldInputValueChange-区别的常见场景：" class="headerlink" title="onFieldValueChange 和 onFieldInputValueChange 区别的常见场景："></a>onFieldValueChange 和 onFieldInputValueChange 区别的常见场景：</h3><ul>
<li>form.setValues 或 form.setValuesIn 时会触发 onFieldValueChange 而不会触发 onFieldInputValueChange</li>
<li>field value onInput 会触发 onFieldValueChange 和 onFieldInputValueChange<br>有的时候数据联动复杂，就需要考虑使用哪一个 effect hooks 是符合预期的，避免在获取后端数据 setValues 时出发了 effect hooks 导致原数据改变。</li>
</ul>
<h2 id="被动模式"><a href="#被动模式" class="headerlink" title="被动模式"></a>被动模式</h2><p>被动模式便于实现多对一联动。其他字段修改影响当前字段。</p>
<p>被动模式的核心是基于：</p>
<ul>
<li><a href="https://core.formilyjs.org/zh-CN/api/entry/field-effect-hooks#onfieldreact">onFieldReact</a> 实现全局响应式逻辑</li>
<li><a href="https://core.formilyjs.org/zh-CN/api/models/field#fieldreaction">FieldReaction</a> 实现局部响应式逻辑<blockquote>
<p>json schema 中的联动更多可以参考 <a href="https://react.formilyjs.org/zh-CN/api/shared/schema#schemareactions">SchemaReactions</a><br>SchemaReactions 实现 Schema 协议中的结构化逻辑描述(内部是基于 FieldReaction 来实现的)<br>一般情况下设置 field reaction 就能实现大部分功能。其中 field reaction 和 onFieldReact 内部都会自动收集依赖。最常见的问题有：</p>
</blockquote>
</li>
</ul>
<p><strong>Q：为什么触发了 field 自身值改变调用了自身的 reaction？</strong></p>
<pre><code>* 最大的可能性是 field reaction 中使用了自身值，reaction 收集了自身值的依赖。
</code></pre>
<p><strong>Q：reaction 中设置了需要监听某个 field value 的逻辑，但是并没有响应？</strong></p>
<blockquote>
<p>在创建 Field 实例时会建立 onFieldValueChange、onFieldInitialValueChange 等事件监听的连接，而 ObjectField 只会监听到对象属性的数量增减，ArrayField 只会监听到数组元素数量的改变</p>
</blockquote>
<pre><code>* 使用 ArrayField、ObjectField、VoidField 组件挂载字段值，但是这些组件在创建实例时没有设置子元素的 value change 监听，所以是无法监听到详细的字段值改变。
* 没有使用 Field 组件挂载字段值，无法收集到 Field 依赖，所以监听不到 value change。
* 监听的 Field 初始化时机有问题，reaction 初始化时，Field 还没有挂载，收集不到依赖。
* 监听的 Field path 错误，没有指向正确的 Field。
</code></pre>
<p><strong>Q：组件显示隐藏后再显示 effect hooks 失效了</strong></p>
<blockquote>
<p>参考 formily issue：<a href="https://github.com/alibaba/formily/issues/1602">https://github.com/alibaba/formily/issues/1602</a></p>
</blockquote>
<pre><code>* formily 内部自动做了隐藏时 form dispose，为了避免内存泄漏的问题。
* createForm 中的 effects 可以使用 [addEffects api](https://core.formilyjs.org/zh-CN/api/models/form#addeffects) 或者 [useFormEffects hooks](https://react.formilyjs.org/zh-CN/api/hooks/use-form-effects) 方式替代。
* ⚠️ onFormReact 会在卸载的时候，收集的 Field 依赖项会分别执行 dispose 函数。
</code></pre>
<p><strong>Q：被动模式容易进入死循环</strong></p>
<pre><code>* 多个值相互监听修改 value 可能会触发死循环，要注意循环判断。
</code></pre>
<p>主动模式 &amp; 被动模式 demo：<a href="https://codesandbox.io/s/formily-reaction-demo-68zgri?file=/App.tsx">https://codesandbox.io/s/formily-reaction-demo-68zgri?file=/App.tsx</a></p>
<h2 id="Reaction-机制"><a href="#Reaction-机制" class="headerlink" title="Reaction 机制"></a>Reaction 机制</h2><blockquote>
<p>参考链接：<a href="https://reactive.formilyjs.org/zh-CN/guide/concept#reaction">https://reactive.formilyjs.org/zh-CN/guide/concept#reaction</a><br>先从 reaction 的机制来看，reaction 在响应式编程模型中，它就相当于是可订阅对象的订阅者，它接收一个 tracker 函数，这个函数在执行的时候，如果函数内部有对 observable 对象中的某个属性进行读操作(依赖收集)，那当前 reaction 就会与该属性进行一个绑定(依赖追踪)，知道该属性在其他地方发生了写操作，就会触发 tracker 函数重复执行，用一张图表示：</p>
</blockquote>
<p><img src="/./reaction%E6%9C%BA%E5%88%B6.png" alt="reaction机制"></p>
<p>可以看到从订阅到派发订阅，其实是一个封闭的循环状态机，每次 tracker 函数执行的时候都会重新收集依赖，依赖变化时又会重新触发 tracker 执行。</p>
<blockquote>
<p>所以，如果一旦我们不想再订阅 reaction 了，一定要手动 dispose，否则会内存泄漏。<br>field reaction 和 effect hooks 中 formily 底层做了 dispose 的处理，所以一般使用时可以不用手动 dispose。</p>
</blockquote>
<h2 id="最佳实践"><a href="#最佳实践" class="headerlink" title="最佳实践"></a>最佳实践</h2><blockquote>
<p>🥲 含泪总结的最佳实践（可能会有偏差，欢迎补充和讨论</p>
</blockquote>
<ul>
<li>表单字段的 reaction 太多了，可以全部抽到一个 reaction 的文件中，统一管理，记得注释。</li>
<li>effect hooks 最好写到字段值定义的地方，就近原则。</li>
<li>一般情况下字段联动逻辑是主动模式和被动模式搭配使用，但是如果逻辑不清晰容易进入死循环，所以清晰的联动逻辑是很重要的。</li>
<li>form effect hooks 会有显隐问题，所以需要使用 useMemo 控制创建 form 实例。</li>
</ul>
<p>有时 Form 上挂载的组件变动过大，如某些情况下需要挂载 FormStep 组件，另外的情况又不需要挂载 FormStep 组件，如果一直使用同一个 form 实例就会出现问题，所以需要控制 useMemo 创建 form 实例的时机。<br>（不用 useMemo 可不可以？不可以，重复渲染会导致重复创建 form 从而引发更多的问题）</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// ⚠️ 注意：使用 formStep 实例要和 form 实例保持一致</span>
<span class="token keyword">const</span> formStep <span class="token operator">=</span> <span class="token function">useMemo</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> FormStep<span class="token punctuation">.</span><span class="token function">createFormStep</span><span class="token punctuation">(</span>FormStepIndex<span class="token punctuation">.</span><span class="token constant">RULE_CONFIG</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// eslint-disable-next-line react-hooks/exhaustive-deps</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>holidayTypeDetail<span class="token operator">?.</span>holidayTypeId<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> ruleDetailForm <span class="token operator">=</span> <span class="token function">useMemo</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token generic-function"><span class="token function">createForm</span><span class="token generic class-name"><span class="token operator">&lt;</span>RuleConfigForm<span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
    initialValues<span class="token operator">:</span> <span class="token constant">RULE_CONFIG_FORM_INITIAL_VALUES</span><span class="token punctuation">,</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// eslint-disable-next-line react-hooks/exhaustive-deps</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>holidayTypeDetail<span class="token operator">?.</span>holidayTypeId<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

ruleDetailForm<span class="token punctuation">.</span><span class="token function">addEffects</span><span class="token punctuation">(</span><span class="token string">'leaveRuleDetailEffects'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token function">onFormValidateFailed</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>formStep<span class="token punctuation">.</span>current <span class="token operator">===</span> FormStepIndex<span class="token punctuation">.</span><span class="token constant">RULE_CONFIG</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token function">sendMessage</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> id<span class="token operator">:</span> <span class="token constant">ERROR_MESSAGE_ID</span><span class="token punctuation">,</span> content<span class="token operator">:</span> <span class="token string">'基本规则配置有误'</span><span class="token punctuation">,</span> type<span class="token operator">:</span> <span class="token string">'error'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// ========================= render 部分 =================================</span>
<span class="token comment">// ...</span>
 <span class="token operator">&lt;</span>FormProvider form<span class="token operator">=</span><span class="token punctuation">&#123;</span>ruleDetailForm<span class="token punctuation">&#125;</span><span class="token operator">></span>
  <span class="token punctuation">&#123;</span><span class="token comment">/* 假期类型为不限额或者加班调休时，没有发假规则 */</span><span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#123;</span><span class="token operator">!</span>showSendRule <span class="token operator">?</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>RuleConfig <span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>VoidField
      name<span class="token operator">=</span><span class="token string">"holidayRule"</span>
      component<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">[</span>
        FormStep<span class="token punctuation">.</span>JsxFormStep<span class="token punctuation">,</span>
        <span class="token punctuation">&#123;</span>
          className<span class="token operator">:</span> styles<span class="token punctuation">.</span>navWrap<span class="token punctuation">,</span>
          minWidth<span class="token operator">:</span> <span class="token number">284</span><span class="token punctuation">,</span>
          formStep<span class="token operator">:</span> formStep<span class="token punctuation">,</span> <span class="token comment">// 关联 formStepModel</span>
          steps<span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">&#123;</span>
              title<span class="token operator">:</span> <span class="token string">'基本规则'</span><span class="token punctuation">,</span>
              name<span class="token operator">:</span> FormStepName<span class="token punctuation">.</span><span class="token constant">RULE_CONFIG</span><span class="token punctuation">,</span>
              content<span class="token operator">:</span> <span class="token operator">&lt;</span>RuleConfig <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">,</span>
            <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
            <span class="token punctuation">&#123;</span>
              title<span class="token operator">:</span> <span class="token string">'发假规则'</span><span class="token punctuation">,</span>
              name<span class="token operator">:</span> FormStepName<span class="token punctuation">.</span><span class="token constant">SEND_RULE_CONFIG</span><span class="token punctuation">,</span>
              content<span class="token operator">:</span> <span class="token operator">&lt;</span>SendRuleConfig <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">,</span>
            <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
          <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
      <span class="token punctuation">]</span><span class="token punctuation">&#125;</span>
    <span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">&#125;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>FormProvider<span class="token operator">></span>
<span class="token comment">// ...</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<blockquote>
<p>官网的最佳实践：<a href="https://reactive.formilyjs.org/zh-CN/guide/best-practice">https://reactive.formilyjs.org/zh-CN/guide/best-practice</a></p>
</blockquote>
<p>在使用@formily/reactive 的时候，我们只需要注意以下几点即可：</p>
<ul>
<li>尽量少用 observable/observable.deep 进行深度包装，不是非不得已就多用 observable.ref/observable.shallow，这样性能会更好</li>
<li>领域模型中多用 computed 计算属性，它可以智能缓存计算结果</li>
<li>虽然批量操作不是必须的，但是尽量多用 batch 模式，这样可以减少 Reaction 执行次数</li>
<li>使用 autorun/reaction 的时候，一定记得调用 dispose 释放函数(也就是调用函数所返回的二阶函数)，否则会内存泄漏</li>
</ul>
<h3 id="formily-reactive-中-action-与-batch-的区别"><a href="#formily-reactive-中-action-与-batch-的区别" class="headerlink" title="@formily/reactive 中 action 与 batch 的区别"></a>@formily/reactive 中 action 与 batch 的区别</h3><blockquote>
<p>参考社区的 discussions：<a href="https://github.com/alibaba/formily/discussions/1928">https://github.com/alibaba/formily/discussions/1928</a></p>
</blockquote>
<p><a href="https://reactive.formilyjs.org/zh-CN/api/batch">batch</a>：定义批量操作，内部可以收集依赖</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 只做batch，不阻止track</span>
<span class="token keyword">interface</span> <span class="token class-name">batch</span> <span class="token punctuation">&#123;</span>
  <span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span><span class="token punctuation">(</span>callback<span class="token operator">?</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token constant">T</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token constant">T</span> <span class="token comment">//原地batch</span>
  <span class="token generic-function"><span class="token function">scope</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span></span><span class="token punctuation">(</span>callback<span class="token operator">?</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token constant">T</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token constant">T</span> <span class="token comment">//原地局部batch</span>
  bound<span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token builtin">any</span><span class="token operator">></span><span class="token punctuation">(</span>callback<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">,</span> context<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token constant">T</span> <span class="token comment">//高阶绑定</span>
  <span class="token function">endpoint</span><span class="token punctuation">(</span>callback<span class="token operator">?</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">void</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token comment">//注册批量执行结束回调</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><a href="https://reactive.formilyjs.org/zh-CN/api/action">action</a>：定义一个批量动作。与 batch 的唯一差别就是 action 内部是无法收集依赖的</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// batch+untrack</span>
<span class="token keyword">interface</span> <span class="token class-name">action</span> <span class="token punctuation">&#123;</span>
  <span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span><span class="token punctuation">(</span>callback<span class="token operator">?</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token constant">T</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token constant">T</span> <span class="token comment">//原地action</span>
  <span class="token generic-function"><span class="token function">scope</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span></span><span class="token punctuation">(</span>callback<span class="token operator">?</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token constant">T</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token constant">T</span> <span class="token comment">//原地局部action</span>
  bound<span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token builtin">any</span><span class="token operator">></span><span class="token punctuation">(</span>callback<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">,</span> context<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token constant">T</span> <span class="token comment">//高阶绑定</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>





<h1 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h1><ul>
<li><p>formliy 官网：<a href="https://formilyjs.org/zh-CN/guide">https://formilyjs.org/zh-CN/guide</a></p>
</li>
<li><p>formily github：<a href="https://github.com/alibaba/formily">https://github.com/alibaba/formily</a></p>
</li>
<li><p>@formily/reactive：<a href="https://reactive.formilyjs.org/">https://reactive.formilyjs.org/</a></p>
</li>
<li><p>@formily/core:  <a href="https://core.formilyjs.org/">https://core.formilyjs.org/</a></p>
</li>
<li><p>@formily/react: <a href="https://react.formilyjs.org/">https://react.formilyjs.org/</a></p>
</li>
<li><p>formily 2.0 更新概要：<a href="https://github.com/alibaba/formily/discussions/1087">https://github.com/alibaba/formily/discussions/1087</a></p>
</li>
<li><p><a href="https://juejin.cn/post/6954278031464595486">可能是你见过最专业的表单方案—解密Formily2.0 - 掘金</a></p>
</li>
</ul>
<h2 id="Formily-交流群"><a href="#Formily-交流群" class="headerlink" title="Formily 交流群"></a>Formily 交流群</h2><p><img src="/./formily%E4%BA%A4%E6%B5%81%E7%BE%A4.png" alt="formily交流群"></p>
]]></content>
      <categories>
        <category>前端</category>
        <category>react</category>
      </categories>
      <tags>
        <tag>前端</tag>
        <tag>react</tag>
        <tag>formily</tag>
      </tags>
  </entry>
  <entry>
    <title>react系列-react-router</title>
    <url>/posts/1dc97ed6/</url>
    <content><![CDATA[<p>官方网站：<a href="https://reactrouter.com/">https://reactrouter.com/</a></p>
<h3 id="基础"><a href="#基础" class="headerlink" title="基础"></a>基础</h3><h4 id="路由"><a href="#路由" class="headerlink" title="路由"></a>路由</h4><p>路由的含义：网络工程的术语。路由（routing）就是通过互联的网络把信息从源地址传输到目的地址的活动。</p>
<blockquote>
<p>路由器提供了两种机制：路由和转送。</p>
<ul>
<li>路由是决定数据包从来源到目的地的路径</li>
<li>转送将输入端的数据转移到合适的输出端</li>
</ul>
</blockquote>
<p>路由中的概念：</p>
<ul>
<li>路由表：本质是一个映射表，决定了数据包的指向。</li>
</ul>
<h4 id="前端路由的原理"><a href="#前端路由的原理" class="headerlink" title="前端路由的原理"></a>前端路由的原理</h4><h5 id="前端路由的核心"><a href="#前端路由的核心" class="headerlink" title="前端路由的核心"></a>前端路由的核心</h5><ul>
<li>改变URL，但是页面不要进行强制刷新（a标签会造成强制刷新，所以需要阻止默认行为）</li>
<li>监听URL的改变，并且改变之后自己改变页面的内容</li>
</ul>
<p>URL发生变化，同时不引起页面的刷新有两个办法：</p>
<ul>
<li>通过 URL 的 hash 改变 URL，如 <code>localhost:3000/#/abc</code></li>
<li>通过 HTML5 中的 history 模式修改 URL</li>
</ul>
<blockquote>
<p>具体可以参考链接：<a href="https://datura35422.github.io/posts/26103/#%E4%BF%AE%E6%94%B9%E8%B7%AF%E5%BE%84URL%E4%B8%8D%E5%88%B7%E6%96%B0%E9%A1%B5%E9%9D%A2">修改路径URL不刷新页面</a></p>
</blockquote>
<h4 id="版本"><a href="#版本" class="headerlink" title="版本"></a>版本</h4><p>react-router-dom：针对浏览器</p>
<p>react-router-native：针对原生应用</p>
<h4 id="API-amp-高阶组件"><a href="#API-amp-高阶组件" class="headerlink" title="API &amp; 高阶组件"></a>API &amp; 高阶组件</h4><ul>
<li><p>BrowerRouter ：使用 history 模式对路径改变的处理</p>
</li>
<li><p>HashRouter ：使用 hash 模式对路径改变的处理</p>
</li>
<li><p>Link ：通常路径的跳转使用的，最终会被渲染成 a 标签，to 属性用于设置跳转到的路径</p>
</li>
<li><p>NavLink ：在 Link 基础之上增加了一些样式属性，默认进行模糊匹配</p>
</li>
<li><p>Route ：用于路径的匹配，匹配的组件占位</p>
</li>
<li><p>Switch ：只渲染唯一匹配到的路由（排他操作），如果能够匹配到较为精确的路由就不显示通配路由配置</p>
</li>
<li><p>Redirect ：路由重定向。会执行跳转到对应的 to 路径中</p>
</li>
<li><p>history ：手动进行跳转时，需要获取 history 对象。</p>
<p>获取到 history 对象的方式：</p>
<ul>
<li>如果该组件是通过路由直接跳转过来的，那么可以直接从 props 中获取到 history、location、match对象，路径跳转到目标组件时；</li>
<li>如果该组件是一个普通渲染的组件，那么不可以直接获取 history、location、match对象</li>
</ul>
</li>
<li><p>withRouter ：高阶组件。将 history、location、match对象包裹传入到普通组件中。可以让普通组件使用history、location、match对象。必须包裹在 Router 组件中</p>
</li>
</ul>
<h4 id="参数传递"><a href="#参数传递" class="headerlink" title="参数传递"></a>参数传递</h4><p>方式：</p>
<ul>
<li>动态路由，<code>to=&#39;/detaitl/:id&#39;</code> 的形式传参，使用 <code>props.match.params.id</code> 获取传参</li>
<li>search传递参数，<code>to=&#39;detail?id=123&#39;</code> 的形式传参，使用 <code>props.location.search</code> 获取传参，需要进行解析传参</li>
<li>Link 中 to 传入对象，对象中的 state 属性可以传递对象数据，使用 <code>props.location.state</code> 获取传参。数据比较复杂的情况下使用</li>
</ul>
<h4 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h4><p>类似于 vue-router 的方式使用配置的方式进行创建 router</p>
<p>需要安装额外的依赖包 <a href="https://github.com/ReactTraining/react-router/tree/master/packages/react-router-config"><code>react-router-config</code></a></p>
<p>使用 <code>renderRoutes(routes)</code> 方式进行渲染。</p>
<h3 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h3><h4 id="基础示例"><a href="#基础示例" class="headerlink" title="基础示例"></a>基础示例</h4><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> PureComponent <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span>
    BrowserRouter<span class="token punctuation">,</span>
    NavLink<span class="token punctuation">,</span>
    Link<span class="token punctuation">,</span>
    Route<span class="token punctuation">,</span>
    Switch
<span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'react-router-dom'</span>

<span class="token keyword">class</span> <span class="token class-name">Home</span> <span class="token keyword">extends</span> <span class="token class-name">PureComponent</span> <span class="token punctuation">&#123;</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>
            <span class="token operator">&lt;</span>h4<span class="token operator">></span>Home<span class="token operator">&lt;</span><span class="token operator">/</span>h4<span class="token operator">></span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">class</span> <span class="token class-name">About</span> <span class="token keyword">extends</span> <span class="token class-name">PureComponent</span> <span class="token punctuation">&#123;</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>
            <span class="token operator">&lt;</span>h4<span class="token operator">></span>About<span class="token operator">&lt;</span><span class="token operator">/</span>h4<span class="token operator">></span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">useRouter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
        <span class="token operator">&lt;</span>BrowserRouter<span class="token operator">></span>
            <span class="token punctuation">&#123;</span><span class="token comment">/* &lt;Link to='/'>首页&lt;/Link>
            &lt;Link to='/about'>关于&lt;/Link> */</span><span class="token punctuation">&#125;</span>
            <span class="token operator">&lt;</span>NavLink exact to<span class="token operator">=</span><span class="token string">'/'</span> activeStyle<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span><span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token string">'red'</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token operator">></span>首页<span class="token operator">&lt;</span><span class="token operator">/</span>NavLink<span class="token operator">></span>
            <span class="token operator">&lt;</span>NavLink to<span class="token operator">=</span><span class="token string">'/about'</span> activeStyle<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span><span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token string">'red'</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token operator">></span>关于<span class="token operator">&lt;</span><span class="token operator">/</span>NavLink<span class="token operator">></span>

            <span class="token operator">&lt;</span>Switch<span class="token operator">></span>
                 <span class="token punctuation">&#123;</span><span class="token comment">/* 路径匹配通常是模糊匹配 只有根路径时需要设置精确匹配 */</span><span class="token punctuation">&#125;</span>
                <span class="token operator">&lt;</span>Route exact path<span class="token operator">=</span><span class="token string">'/'</span><span class="token operator">></span>
                    <span class="token operator">&lt;</span>Home<span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>Home<span class="token operator">></span>
                <span class="token operator">&lt;</span><span class="token operator">/</span>Route<span class="token operator">></span>

                <span class="token operator">&lt;</span>Route path<span class="token operator">=</span><span class="token string">'/about'</span> component<span class="token operator">=</span><span class="token punctuation">&#123;</span>About<span class="token punctuation">&#125;</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>Route<span class="token operator">></span>
            <span class="token operator">&lt;</span><span class="token operator">/</span>Switch<span class="token operator">></span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>BrowserRouter<span class="token operator">></span>
    <span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h4 id="路由嵌套"><a href="#路由嵌套" class="headerlink" title="路由嵌套"></a>路由嵌套</h4><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> PureComponent <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span>
    BrowserRouter<span class="token punctuation">,</span>
    NavLink<span class="token punctuation">,</span>
    Link<span class="token punctuation">,</span>
    Route<span class="token punctuation">,</span>
    Switch
<span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'react-router-dom'</span>

<span class="token keyword">class</span> <span class="token class-name">Home</span> <span class="token keyword">extends</span> <span class="token class-name">PureComponent</span> <span class="token punctuation">&#123;</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>
            <span class="token operator">&lt;</span>h4<span class="token operator">></span>Home<span class="token operator">&lt;</span><span class="token operator">/</span>h4<span class="token operator">></span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">class</span> <span class="token class-name">About</span> <span class="token keyword">extends</span> <span class="token class-name">PureComponent</span> <span class="token punctuation">&#123;</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>
            <span class="token operator">&lt;</span>div<span class="token operator">></span>
                <span class="token operator">&lt;</span>NavLink exact to<span class="token operator">=</span><span class="token string">'/about'</span> activeStyle<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span><span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token string">'green'</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token operator">></span>关于我们<span class="token operator">&lt;</span><span class="token operator">/</span>NavLink<span class="token operator">></span>
                <span class="token operator">&lt;</span>NavLink to<span class="token operator">=</span><span class="token string">'/about/history'</span> activeStyle<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span><span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token string">'green'</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token operator">></span>历史<span class="token operator">&lt;</span><span class="token operator">/</span>NavLink<span class="token operator">></span>
                <span class="token operator">&lt;</span>NavLink to<span class="token operator">=</span><span class="token string">'/about/culture'</span> activeStyle<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span><span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token string">'green'</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token operator">></span>文化<span class="token operator">&lt;</span><span class="token operator">/</span>NavLink<span class="token operator">></span>
                
                <span class="token operator">&lt;</span>Switch<span class="token operator">></span>
                    <span class="token operator">&lt;</span>Route exact path<span class="token operator">=</span><span class="token string">'/about'</span><span class="token operator">></span>
                        <span class="token operator">&lt;</span>h4<span class="token operator">></span>About<span class="token operator">&lt;</span><span class="token operator">/</span>h4<span class="token operator">></span>
                    <span class="token operator">&lt;</span><span class="token operator">/</span>Route<span class="token operator">></span>
                    <span class="token operator">&lt;</span>Route path<span class="token operator">=</span><span class="token string">'/about/history'</span><span class="token operator">></span>
                        <span class="token operator">&lt;</span>h4<span class="token operator">></span>历史<span class="token operator">&lt;</span><span class="token operator">/</span>h4<span class="token operator">></span>
                    <span class="token operator">&lt;</span><span class="token operator">/</span>Route<span class="token operator">></span>
                    <span class="token operator">&lt;</span>Route path<span class="token operator">=</span><span class="token string">'/about/culture'</span><span class="token operator">></span>
                        <span class="token operator">&lt;</span>h4<span class="token operator">></span>文化<span class="token operator">&lt;</span><span class="token operator">/</span>h4<span class="token operator">></span>
                    <span class="token operator">&lt;</span><span class="token operator">/</span>Route<span class="token operator">></span>
                <span class="token operator">&lt;</span><span class="token operator">/</span>Switch<span class="token operator">></span>
            <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">useRouter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
        <span class="token operator">&lt;</span>BrowserRouter<span class="token operator">></span>
            <span class="token punctuation">&#123;</span><span class="token comment">/* &lt;Link to='/'>首页&lt;/Link>
            &lt;Link to='/about'>关于&lt;/Link> */</span><span class="token punctuation">&#125;</span>
            <span class="token operator">&lt;</span>NavLink exact to<span class="token operator">=</span><span class="token string">'/'</span> activeStyle<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span><span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token string">'red'</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token operator">></span>首页<span class="token operator">&lt;</span><span class="token operator">/</span>NavLink<span class="token operator">></span>
            <span class="token operator">&lt;</span>NavLink to<span class="token operator">=</span><span class="token string">'/about'</span> activeStyle<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span><span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token string">'red'</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token operator">></span>关于<span class="token operator">&lt;</span><span class="token operator">/</span>NavLink<span class="token operator">></span>

            <span class="token operator">&lt;</span>Switch<span class="token operator">></span>
                 <span class="token punctuation">&#123;</span><span class="token comment">/* 路径匹配通常是模糊匹配 只有根路径时需要设置精确匹配 */</span><span class="token punctuation">&#125;</span>
                <span class="token operator">&lt;</span>Route exact path<span class="token operator">=</span><span class="token string">'/'</span><span class="token operator">></span>
                    <span class="token operator">&lt;</span>Home<span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>Home<span class="token operator">></span>
                <span class="token operator">&lt;</span><span class="token operator">/</span>Route<span class="token operator">></span>

                <span class="token operator">&lt;</span>Route path<span class="token operator">=</span><span class="token string">'/about'</span> component<span class="token operator">=</span><span class="token punctuation">&#123;</span>About<span class="token punctuation">&#125;</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>Route<span class="token operator">></span>
            <span class="token operator">&lt;</span><span class="token operator">/</span>Switch<span class="token operator">></span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>BrowserRouter<span class="token operator">></span>
    <span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



]]></content>
      <categories>
        <category>前端</category>
        <category>react</category>
      </categories>
      <tags>
        <tag>前端</tag>
        <tag>react</tag>
        <tag>react-router</tag>
      </tags>
  </entry>
  <entry>
    <title>react系列-react项目实战</title>
    <url>/posts/fff65bfb/</url>
    <content><![CDATA[<h3 id="ANTD"><a href="#ANTD" class="headerlink" title="ANTD"></a>ANTD</h3><p>官方文档：<a href="https://ant.design/docs/react/introduce-cn">https://ant.design/docs/react/introduce-cn</a></p>
<p>github：<a href="https://github.com/ant-design/ant-design/">https://github.com/ant-design/ant-design/</a></p>
<h4 id="修改默认配置"><a href="#修改默认配置" class="headerlink" title="修改默认配置"></a>修改默认配置</h4><p>如果使用常规的手段是需要将 create-react-app 的配置全部暴露出来，进行手动修改配置，会造成后期维护困难等问题。</p>
<h5 id="方案："><a href="#方案：" class="headerlink" title="方案："></a>方案：</h5><ul>
<li>react-app-rewired + customize-cra（antd 早期推荐的方案）</li>
<li>craco（目前 antd 推荐的方案）</li>
</ul>
<h4 id="优化"><a href="#优化" class="headerlink" title="优化"></a>优化</h4><h5 id="antd-是否会将一些没有用的代码（组件或逻辑代码）引入，造成包很大"><a href="#antd-是否会将一些没有用的代码（组件或逻辑代码）引入，造成包很大" class="headerlink" title="antd 是否会将一些没有用的代码（组件或逻辑代码）引入，造成包很大"></a>antd 是否会将一些没有用的代码（组件或逻辑代码）引入，造成包很大</h5><p>antd 官网有提到： antd 的 JS 代码默认支持基于 ES modules 的 tree shaking，对于 js 部分，直接引入 <code>import &#123; Button &#125; from &#39;antd&#39;</code> 就会有按需加载的效果。</p>
<h3 id="ANTD-Pro"><a href="#ANTD-Pro" class="headerlink" title="ANTD Pro"></a>ANTD Pro</h3><p>参考链接：<a href="https://ant.design/docs/react/practical-projects-cn">https://ant.design/docs/react/practical-projects-cn</a></p>
<p>这是一个基于 umi、dva 和 ant design 的开箱即用的中台前端/设计解决方案。</p>
<h4 id="umi"><a href="#umi" class="headerlink" title="umi"></a><a href="https://umijs.org/zh-CN/docs">umi</a></h4><p><a href="https://umijs.org/zh-CN">umi</a> 则是一个可插拔的企业级 react 应用框架。umi 以路由为基础的，支持<a href="https://umijs.org/zh-CN/docs/convention-routing">类 next.js 的约定式路由</a>，以及各种进阶的路由功能，并以此进行功能扩展，比如<a href="https://umijs.org/zh-CN/config#dynamicimport">支持路由级的按需加载</a>。然后配以完善的<a href="https://umijs.org/zh-CN/plugins/api">插件体系</a>，覆盖从源码到构建产物的每个生命周期，支持各种功能扩展和业务需求，同时提供 <a href="https://umijs.org/zh-CN/docs/use-umi-ui">Umi UI</a> 通过可视化辅助编程（VAP）提高开发体验和研发效率。</p>
<h4 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h4><p>初始化</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 使用 npm</span>
npx create-umi myapp
<span class="token comment"># 使用 yarn</span>
<span class="token function">yarn</span> create umi myapp<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>





<h3 id="网易云音乐-web"><a href="#网易云音乐-web" class="headerlink" title="网易云音乐 web"></a>网易云音乐 web</h3><p>真实项目：</p>
<p><a href="https://music.163.com/#">https://music.163.com/#</a></p>
<p>项目参考：</p>
<p><a href="https://github.com/coderwhy/hy-react-web-music">https://github.com/coderwhy/hy-react-web-music</a></p>
<p><a href="https://github.com/wanguano/Music163-React">https://github.com/wanguano/Music163-React</a></p>
<h3 id="React-TypeScript-打造自己的组件库"><a href="#React-TypeScript-打造自己的组件库" class="headerlink" title="React + TypeScript 打造自己的组件库"></a>React + TypeScript 打造自己的组件库</h3><p>课程文档：<a href="https://vikingship.xyz/">https://vikingship.xyz/</a></p>
<p>参考文档：ts in jsx - <a href="https://www.typescriptlang.org/docs/handbook/jsx.html">https://www.typescriptlang.org/docs/handbook/jsx.html</a></p>
<h4 id="完成一个组件库需要考虑的问题"><a href="#完成一个组件库需要考虑的问题" class="headerlink" title="完成一个组件库需要考虑的问题"></a>完成一个组件库需要考虑的问题</h4><ul>
<li>代码结构，参考文章：<a href="https://zh-hans.reactjs.org/docs/faq-structure.html">https://zh-hans.reactjs.org/docs/faq-structure.html</a></li>
<li>样式解决方案，参考文章：<a href="https://zh-hans.reactjs.org/docs/faq-styling.html">https://zh-hans.reactjs.org/docs/faq-styling.html</a></li>
<li>组件需求分析和编码</li>
<li>组件测试用例分析和编码</li>
<li>代码打包输出和发布</li>
<li>CI/CD，文档生成等</li>
</ul>
]]></content>
      <categories>
        <category>前端</category>
        <category>react</category>
      </categories>
      <tags>
        <tag>前端</tag>
        <tag>react</tag>
        <tag>项目实战</tag>
      </tags>
  </entry>
  <entry>
    <title>react系列-redux</title>
    <url>/posts/6ab9f816/</url>
    <content><![CDATA[<p>官方网站：<a href="https://redux.js.org/">https://redux.js.org/</a></p>
<p>中文文档：<a href="https://cn.redux.js.org/">https://cn.redux.js.org/</a></p>
<h3 id="基础"><a href="#基础" class="headerlink" title="基础"></a>基础</h3><h4 id="目的"><a href="#目的" class="headerlink" title="目的"></a>目的</h4><p><strong>状态管理器</strong></p>
<p>JavaScript 需要管理的状态越来越多，越来越复杂；</p>
<p>这些状态包括服务器返回的数据、缓存数据、用户操作生产的数据等等，也包括一些 UI 的状态，比如某些元素是否被选中，是否显示加载动效，当前分页等；</p>
<p>当应用程序复杂时，state 在什么时候，因为什么原因而发生了变化，发生了怎样的变化，会变得非常难以控制和追踪。</p>
<h4 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h4><p><strong>Redux 是 JavaScript 的状态容器，提供了可预测的状态管理。</strong></p>
<p>跟框架无关，可以结合 vue 等其他框架使用。</p>
<h4 id="核心理念"><a href="#核心理念" class="headerlink" title="核心理念"></a>核心理念</h4><p>redux = reducer + flux</p>
<h5 id="store"><a href="#store" class="headerlink" title="store"></a>store</h5><p>保存 state 数据</p>
<h5 id="action"><a href="#action" class="headerlink" title="action"></a>action</h5><p>Redux 要求我们通过 action 来更新数据：</p>
<ul>
<li>所有数据的变化，必须通过派发（dispatch）action 来更新；</li>
<li>action 是一个普通的 JavaScript 对象，用来描述这次更新的 type 和 content；</li>
</ul>
<h5 id="reducer"><a href="#reducer" class="headerlink" title="reducer"></a>reducer</h5><p>reducer 将 state 和 action 联系起来</p>
<p>reducer 是一个纯函数</p>
<p>reducer 做的事情就是将传入的 state 和 action 结合起来生成一个新的 state</p>
<h4 id="原则"><a href="#原则" class="headerlink" title="原则"></a><a href="https://redux.js.org/tutorials/essentials/part-1-overview-concepts">原则</a></h4><h5 id="单一数据源、单向数据流"><a href="#单一数据源、单向数据流" class="headerlink" title="单一数据源、单向数据流"></a>单一数据源、单向数据流</h5><p><strong>store 是唯一的。</strong></p>
<p>整个应用程序的state被存储再一颗 object tree 中，并且这个 object tree只存储在一个 store 中；</p>
<p>Redux 并没有强制让我们不能创建多个 Store，但是那样做不利于数据的维护；</p>
<p>单一的数据源可以让整个应用程序的 state 变得方便维护、追踪、修改；</p>
<h5 id="State是只读的"><a href="#State是只读的" class="headerlink" title="State是只读的"></a>State是只读的</h5><p>唯一修改 State 的方法是触发 action，不要视图在其他地方通过任何的方式来修改 State；</p>
<p>这样可以保证所有的修改都被集中化处理，并且按照严格的顺序来执行，所以不需要担心 race condition（竞态）的问题。</p>
<blockquote>
<p>只有 store 更改 state 数据内容，reducer 可以接受 state，但不能改变 state。</p>
</blockquote>
<h5 id="使用纯函数来执行修改"><a href="#使用纯函数来执行修改" class="headerlink" title="使用纯函数来执行修改"></a>使用纯函数来执行修改</h5><p>通过 reducer 将旧 state 和 actions 联系在一起，并且返回一个新的 state；</p>
<p>随着应用程序的复杂度增加，我们可以将 reducer 拆分成多个小的 reducers，分别操作不同 state tree的一部分；</p>
<p><strong>所有的 reducer 都应该是纯函数，不能产生任何副作用。</strong></p>
<p>redux 数据交互流程</p>
<p><img src="/./redux%E4%BD%BF%E7%94%A8%E6%B5%81%E7%A8%8B.jpg" alt="redux使用流程"></p>
<p>redux数据流动方向：<strong>单向数据流</strong></p>
<img src="./ReduxDataFlowDiagram.gif" alt="ReduxDataFlowDiagram" style="zoom: 67%;" />



<h4 id="异步请求"><a href="#异步请求" class="headerlink" title="异步请求"></a>异步请求</h4><p>网络请求到的数据属于状态管理的一部分，所以请求数据应该由 redux 进行管理。</p>
<p>然而，redux 本身没有异步请求的概念，需要借助中间件进行实现。</p>
<p>redux 中间件的作用是对 store 的 dispatch 方法进行升级，如果传入的是函数，会将函数执行后再进行其他操作。</p>
<p><img src="/posts/6ab9f816/redux_async.jpg" alt="redux_async"></p>
<h5 id="redux-thunk"><a href="#redux-thunk" class="headerlink" title="redux-thunk"></a><a href="https://github.com/reduxjs/redux-thunk">redux-thunk</a></h5><p>官方推荐，用于处理store中的异步事件。</p>
<p>一般使用 actionCreateor 返回的是对象，使用 redux-thunk 后可以返回异步函数，action 为函数，store.dispatch(action) 执行的是函数并获取返回结果。</p>
<h5 id="redux-saga"><a href="#redux-saga" class="headerlink" title="redux-saga"></a><a href="https://redux-saga.js.org/">redux-saga</a></h5><p>redux-saga 使用过程中，在 store.dispatch(action)时，store 和 saga 能够同时接收到 action 参数</p>
<blockquote>
<p>redux-saga 和 redux-thunk 的作用相同，用法不同。</p>
<p>redux-thunk 提供的接口少，适用于中小型项目。</p>
<p>redux-saga 有丰富的接口，适用于逻辑复杂的大型项目。</p>
</blockquote>
<h4 id="中间件"><a href="#中间件" class="headerlink" title="中间件"></a>中间件</h4><p>api 文档：<a href="https://redux.js.org/api/applymiddleware">https://redux.js.org/api/applymiddleware</a></p>
<h5 id="redux-使用中间件"><a href="#redux-使用中间件" class="headerlink" title="redux 使用中间件"></a>redux 使用中间件</h5><p>store/index.js</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> createStore<span class="token punctuation">,</span> applyMiddleware <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'redux'</span>
<span class="token keyword">import</span> thunkMiddleware <span class="token keyword">from</span> <span class="token string">'redux-thunk'</span>
<span class="token keyword">import</span> reducer <span class="token keyword">from</span> <span class="token string">'./reducer'</span>

<span class="token comment">// 应用一些中间件</span>
<span class="token keyword">const</span> storeEnhancer <span class="token operator">=</span> <span class="token function">applyMiddleware</span><span class="token punctuation">(</span>thunkMiddleware<span class="token punctuation">)</span>

<span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">createStore</span><span class="token punctuation">(</span>reducer<span class="token punctuation">,</span> storeEnhancer<span class="token punctuation">)</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> store<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>actionCreators.js</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// redux-thunk 中定义的函数</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">getHomeMultidataAction</span> <span class="token operator">=</span> <span class="token parameter">dispatch</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token function">axios</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
        <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">'http://123.207.32.32:8000/home/multidata'</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">banner</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">list</span><span class="token operator">:</span> banners <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token literal-property property">recommend</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">list</span><span class="token operator">:</span> recommends <span class="token punctuation">&#125;</span> <span class="token punctuation">&#125;</span> <span class="token punctuation">&#125;</span> <span class="token operator">=</span> res<span class="token punctuation">.</span>data
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>banners<span class="token punctuation">)</span>
        <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token function">changeBannersAction</span><span class="token punctuation">(</span>banners<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token function">changeRecommendsAction</span><span class="token punctuation">(</span>recommends<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h5 id="实现简单的中间件（中间件原理）"><a href="#实现简单的中间件（中间件原理）" class="headerlink" title="实现简单的中间件（中间件原理）"></a>实现简单的中间件（中间件原理）</h5><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> redux <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'redux'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> actionTypes <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    <span class="token constant">ADD_NUMBER</span><span class="token operator">:</span> <span class="token string">'ADD_NUMBER'</span><span class="token punctuation">,</span>
    <span class="token constant">SUB_NUMBER</span><span class="token operator">:</span> <span class="token string">'SUB_NUMBER'</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">const</span> actionCreators <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    <span class="token function">addAction</span><span class="token punctuation">(</span><span class="token parameter">num</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>
            <span class="token literal-property property">type</span><span class="token operator">:</span> actionTypes<span class="token punctuation">.</span><span class="token constant">ADD_NUMBER</span><span class="token punctuation">,</span>
            num
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token function">subAction</span><span class="token punctuation">(</span><span class="token parameter">num</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>
            <span class="token literal-property property">type</span><span class="token operator">:</span> actionTypes<span class="token punctuation">.</span><span class="token constant">SUB_NUMBER</span><span class="token punctuation">,</span>
            num
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token function">thunkAction</span><span class="token punctuation">(</span><span class="token parameter">dispatch<span class="token punctuation">,</span> getState</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token function">dispatch</span><span class="token punctuation">(</span>actionCreators<span class="token punctuation">.</span><span class="token function">subAction</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'state: '</span><span class="token punctuation">,</span> <span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">const</span> initialState <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    <span class="token literal-property property">counter</span><span class="token operator">:</span> <span class="token number">0</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// reducer </span>
<span class="token comment">// 默认情况下 初始化state是没有值的，所以此时要赋值初始值</span>
<span class="token keyword">function</span> <span class="token function">reducer</span><span class="token punctuation">(</span><span class="token parameter">state <span class="token operator">=</span> initialState<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">case</span> actionTypes<span class="token punctuation">.</span><span class="token constant">ADD_NUMBER</span><span class="token operator">:</span>
            <span class="token keyword">return</span> <span class="token punctuation">&#123;</span><span class="token operator">...</span>state<span class="token punctuation">,</span> <span class="token literal-property property">counter</span><span class="token operator">:</span> state<span class="token punctuation">.</span>counter <span class="token operator">+</span> action<span class="token punctuation">.</span>num<span class="token punctuation">&#125;</span>
        <span class="token keyword">case</span> actionTypes<span class="token punctuation">.</span><span class="token constant">SUB_NUMBER</span><span class="token operator">:</span>
            <span class="token keyword">return</span> <span class="token punctuation">&#123;</span><span class="token operator">...</span>state<span class="token punctuation">,</span> <span class="token literal-property property">counter</span><span class="token operator">:</span> state<span class="token punctuation">.</span>counter <span class="token operator">-</span> action<span class="token punctuation">.</span>num<span class="token punctuation">&#125;</span>
        <span class="token keyword">default</span><span class="token operator">:</span>
            <span class="token keyword">return</span> state
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// store （创建的时候需要传入 reducer）</span>
<span class="token keyword">const</span> store <span class="token operator">=</span> redux<span class="token punctuation">.</span><span class="token function">createStore</span><span class="token punctuation">(</span>reducer<span class="token punctuation">)</span>

<span class="token comment">// 调用 ====================================================</span>
<span class="token comment">// store.dispatch(actionCreators.addAction(10))</span>
<span class="token comment">// console.log(store.getState())</span>


<span class="token comment">// 根据需求封装中间件</span>
<span class="token comment">// 需求：在 dispatch 之前打印一下数据，在 dispatch 之后打印一下数据</span>

<span class="token comment">// 方式一 创建一个函数进行包裹</span>
<span class="token comment">// function dispatchAndLogging(action) &#123;</span>
<span class="token comment">//     console.log('dispatch before--dispatching action: ', action)</span>
<span class="token comment">//     store.dispatch(action)</span>
<span class="token comment">//     console.log('dispatch after--new state: ', store.getState())</span>
<span class="token comment">// &#125;</span>

<span class="token comment">// dispatchAndLogging(actionCreators.addAction(10))</span>

<span class="token comment">// 方式二 hack技巧  monkeyingpatch 将原有的api重新进行定义 使用时依旧按照原来的使用方式进行</span>
<span class="token keyword">function</span> <span class="token function">patchLogging</span><span class="token punctuation">(</span><span class="token parameter">store</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">const</span> next <span class="token operator">=</span> store<span class="token punctuation">.</span>dispatch 
    <span class="token keyword">function</span> <span class="token function">dispatchAndLogging</span><span class="token punctuation">(</span><span class="token parameter">action</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'dispatch before--dispatching action: '</span><span class="token punctuation">,</span> action<span class="token punctuation">)</span>
        <span class="token function">next</span><span class="token punctuation">(</span>action<span class="token punctuation">)</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'dispatch after--new state: '</span><span class="token punctuation">,</span> store<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
    store<span class="token punctuation">.</span>dispatch <span class="token operator">=</span> dispatchAndLogging
    <span class="token comment">// return dispatchAndLogging // 使用 applyMiddlewares</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 同理 封装 thunk 方法 处理 actionCreator是函数的情况</span>
<span class="token keyword">function</span> <span class="token function">patchThunk</span><span class="token punctuation">(</span><span class="token parameter">store</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">const</span> next <span class="token operator">=</span> store<span class="token punctuation">.</span>dispatch
    <span class="token keyword">function</span> <span class="token function">dispatchAndThunk</span><span class="token punctuation">(</span><span class="token parameter">action</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> action <span class="token operator">===</span> <span class="token string">'function'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token function">action</span><span class="token punctuation">(</span>next<span class="token punctuation">,</span> store<span class="token punctuation">.</span>getState<span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
            <span class="token function">next</span><span class="token punctuation">(</span>action<span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
    store<span class="token punctuation">.</span>dispatch <span class="token operator">=</span> dispatchAndThunk
    <span class="token comment">// return dispatchAndThunk // 使用 applyMiddlewares</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 封装 applyMiddlewares 需要中间件函数返回纯函数的方式进行</span>
<span class="token comment">// function applyMiddlewares(...middlewares) &#123;</span>
<span class="token comment">//     middlewares.forEach(middleware => &#123;</span>
<span class="token comment">//         store.dispatch = middleware(store)</span>
<span class="token comment">//     &#125;)</span>
<span class="token comment">// &#125;</span>
<span class="token comment">// applyMiddlewares(patchLogging, patchThunk)</span>

<span class="token function">patchLogging</span><span class="token punctuation">(</span>store<span class="token punctuation">)</span> <span class="token comment">// 装载 store.dispatch </span>
<span class="token function">patchThunk</span><span class="token punctuation">(</span>store<span class="token punctuation">)</span>
store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span>actionCreators<span class="token punctuation">.</span><span class="token function">addAction</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 依旧按照原来的方式进行调用</span>
store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span>actionCreators<span class="token punctuation">.</span>thunkAction<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>实现中间件的一种方式，还有其他方式，可以参考其他 redux 中间件源码。</p>
<h3 id="实战"><a href="#实战" class="headerlink" title="实战"></a>实战</h3><h4 id="node-redux"><a href="#node-redux" class="headerlink" title="node + redux"></a>node + redux</h4><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> redux <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'redux'</span><span class="token punctuation">)</span>

<span class="token comment">// 常量</span>
<span class="token comment">// const actionTypes = &#123;</span>
<span class="token comment">//     INCREMENT: 'INCREMENT',</span>
<span class="token comment">//     DECREMENT: 'DECREMENT',</span>
<span class="token comment">//     ADD_NUMBER: 'ADD_NUMBER',</span>
<span class="token comment">//     SUB_NUMBER: 'SUB_NUMBER'</span>
<span class="token comment">// &#125;</span>
<span class="token keyword">const</span> actionTypes <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    <span class="token constant">INCREMENT</span><span class="token operator">:</span> <span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token string">'INCREMENT'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token constant">DECREMENT</span><span class="token operator">:</span> <span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token string">'DECREMENT'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token constant">ADD_NUMBER</span><span class="token operator">:</span> <span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token string">'ADD_NUMBER'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token constant">SUB_NUMBER</span><span class="token operator">:</span> <span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token string">'SUB_NUMBER'</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 初始值</span>
<span class="token keyword">const</span> initialState <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    <span class="token literal-property property">counter</span><span class="token operator">:</span> <span class="token number">0</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// reducer </span>
<span class="token comment">// 默认情况下 初始化state是没有值的，所以此时要赋值初始值</span>
<span class="token keyword">function</span> <span class="token function">reducer</span><span class="token punctuation">(</span><span class="token parameter">state <span class="token operator">=</span> initialState<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">case</span> actionTypes<span class="token punctuation">.</span><span class="token constant">INCREMENT</span><span class="token operator">:</span>
            <span class="token keyword">return</span> <span class="token punctuation">&#123;</span><span class="token operator">...</span>state<span class="token punctuation">,</span> <span class="token literal-property property">counter</span><span class="token operator">:</span> state<span class="token punctuation">.</span>counter <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">&#125;</span>
        <span class="token keyword">case</span> actionTypes<span class="token punctuation">.</span><span class="token constant">DECREMENT</span><span class="token operator">:</span>
            <span class="token keyword">return</span> <span class="token punctuation">&#123;</span><span class="token operator">...</span>state<span class="token punctuation">,</span> <span class="token literal-property property">counter</span><span class="token operator">:</span> state<span class="token punctuation">.</span>counter <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">&#125;</span>
        <span class="token keyword">case</span> actionTypes<span class="token punctuation">.</span><span class="token constant">ADD_NUMBER</span><span class="token operator">:</span>
            <span class="token keyword">return</span> <span class="token punctuation">&#123;</span><span class="token operator">...</span>state<span class="token punctuation">,</span> <span class="token literal-property property">counter</span><span class="token operator">:</span> state<span class="token punctuation">.</span>counter <span class="token operator">+</span> action<span class="token punctuation">.</span>num<span class="token punctuation">&#125;</span>
        <span class="token keyword">case</span> actionTypes<span class="token punctuation">.</span><span class="token constant">SUB_NUMBER</span><span class="token operator">:</span>
            <span class="token keyword">return</span> <span class="token punctuation">&#123;</span><span class="token operator">...</span>state<span class="token punctuation">,</span> <span class="token literal-property property">counter</span><span class="token operator">:</span> state<span class="token punctuation">.</span>counter <span class="token operator">-</span> action<span class="token punctuation">.</span>num<span class="token punctuation">&#125;</span>
        <span class="token keyword">default</span><span class="token operator">:</span>
            <span class="token keyword">return</span> state
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// store （创建的时候需要传入 reducer）</span>
<span class="token keyword">const</span> store <span class="token operator">=</span> redux<span class="token punctuation">.</span><span class="token function">createStore</span><span class="token punctuation">(</span>reducer<span class="token punctuation">)</span>

<span class="token comment">// 订阅 store 的修改 要在派发action之前做</span>
store<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'state 发生了修改'</span><span class="token punctuation">,</span> store<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>counter<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>

<span class="token comment">// actions </span>
<span class="token keyword">const</span> action1 <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token literal-property property">type</span><span class="token operator">:</span> actionTypes<span class="token punctuation">.</span><span class="token constant">INCREMENT</span><span class="token punctuation">&#125;</span>
<span class="token keyword">const</span> action2 <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token literal-property property">type</span><span class="token operator">:</span> actionTypes<span class="token punctuation">.</span><span class="token constant">DECREMENT</span><span class="token punctuation">&#125;</span>

<span class="token keyword">const</span> action3 <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token literal-property property">type</span><span class="token operator">:</span> actionTypes<span class="token punctuation">.</span><span class="token constant">ADD_NUMBER</span><span class="token punctuation">,</span> <span class="token literal-property property">num</span><span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">&#125;</span>
<span class="token keyword">const</span> action4 <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token literal-property property">type</span><span class="token operator">:</span> actionTypes<span class="token punctuation">.</span><span class="token constant">SUB_NUMBER</span><span class="token punctuation">,</span> <span class="token literal-property property">num</span><span class="token operator">:</span> <span class="token number">12</span><span class="token punctuation">&#125;</span>
<span class="token comment">// 函数方式动态设置传入参数</span>
<span class="token keyword">const</span> <span class="token function-variable function">action5</span> <span class="token operator">=</span> <span class="token parameter">num</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token punctuation">&#123;</span><span class="token literal-property property">type</span><span class="token operator">:</span> actionTypes<span class="token punctuation">.</span><span class="token constant">ADD_NUMBER</span><span class="token punctuation">,</span> num<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 派发 action 然后执行 reducer纯函数进行处理数据</span>
store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span>action1<span class="token punctuation">)</span>
store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span>action2<span class="token punctuation">)</span>
store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span>action3<span class="token punctuation">)</span>
store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span>action4<span class="token punctuation">)</span>
store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token function">action5</span><span class="token punctuation">(</span><span class="token number">90</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>使用 symbol类型定义 action type 不利于 redux devtool 跟踪查看数据变化</p>
</blockquote>
<h4 id="react-redux"><a href="#react-redux" class="headerlink" title="react + redux"></a>react + redux</h4><p>使用 redux 的组件示例</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> PureComponent <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> store <span class="token keyword">from</span> <span class="token string">'../../store'</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span>
    increment<span class="token punctuation">,</span>
    addNumber
<span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'../../store/actionCreators'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Home</span> <span class="token keyword">extends</span> <span class="token class-name">PureComponent</span> <span class="token punctuation">&#123;</span>

    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span>

        <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
            <span class="token literal-property property">counter</span><span class="token operator">:</span> store<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>counter
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// 订阅</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>unsubscribe <span class="token operator">=</span> store<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
                <span class="token literal-property property">counter</span><span class="token operator">:</span> store<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>counter
            <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>

    <span class="token function">componentWillUnmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// 取消订阅</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">unsubscribe</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>

    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>
            <span class="token operator">&lt;</span>div<span class="token operator">></span>
                <span class="token operator">&lt;</span>h4<span class="token operator">></span>Home <span class="token operator">-</span> 当前计数： <span class="token punctuation">&#123;</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>counter<span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>h4<span class="token operator">></span>
                <span class="token operator">&lt;</span>div<span class="token operator">></span>
                    <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token parameter">e</span> <span class="token operator">=></span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token operator">></span><span class="token operator">+</span><span class="token number">1</span><span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>
                    <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token parameter">e</span> <span class="token operator">=></span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">addNumber</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token operator">></span><span class="token operator">+</span><span class="token number">5</span><span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>
                <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
            <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>

    <span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>

    <span class="token function">addNumber</span><span class="token punctuation">(</span><span class="token parameter">num</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token function">addNumber</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h5 id="抽取-redux-与-组件链接的公共代码"><a href="#抽取-redux-与-组件链接的公共代码" class="headerlink" title="抽取 redux 与 组件链接的公共代码"></a>抽取 redux 与 组件链接的公共代码</h5><h6 id="使用-store-进行数据交互"><a href="#使用-store-进行数据交互" class="headerlink" title="使用 store 进行数据交互"></a>使用 store 进行数据交互</h6><p>使用高阶组件封装 工具函数</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> PureComponent <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">"react"</span>
<span class="token keyword">import</span> store <span class="token keyword">from</span> <span class="token string">"../store"</span>

<span class="token comment">/**
 * 建立 react 与 redux 的连接
 * @param &#123;function&#125; mapStateToProps 组件中需要使用的 store 中的数据映射到 props 中，返回值为对象
 * @param &#123;function&#125; mapDispachToProp 组件中需要派发的 action 映射到 props 中，返回值为对象
 */</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">connect</span><span class="token punctuation">(</span><span class="token parameter">mapStateToProps<span class="token punctuation">,</span> mapDispachToProp</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// 高阶组件</span>
    <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token function">enhanceHOC</span><span class="token punctuation">(</span><span class="token parameter">WrappedComponend</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token keyword">class</span> <span class="token class-name">extends</span> PureComponent <span class="token punctuation">&#123;</span>
            <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span>

                <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
                    <span class="token comment">// 返回组件中需要的 state</span>
                    <span class="token literal-property property">storeState</span><span class="token operator">:</span> <span class="token function">mapStateToProps</span><span class="token punctuation">(</span>store<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span>

            <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token comment">// 建立监听</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>unsubscribe <span class="token operator">=</span> store<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
                    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
                        <span class="token literal-property property">storeState</span><span class="token operator">:</span> <span class="token function">mapStateToProps</span><span class="token punctuation">(</span>store<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
                <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
            <span class="token punctuation">&#125;</span>

            <span class="token function">componentWillUnmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token comment">// 取消监听</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">unsubscribe</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">&#125;</span>

            <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token comment">// props 穿透</span>
                <span class="token keyword">return</span> <span class="token operator">&lt;</span>WrappedComponend 
                        <span class="token punctuation">&#123;</span><span class="token operator">...</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">&#125;</span> 
                        <span class="token punctuation">&#123;</span><span class="token operator">...</span><span class="token function">mapStateToProps</span><span class="token punctuation">(</span>store<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span> 
                        <span class="token punctuation">&#123;</span><span class="token operator">...</span><span class="token function">mapDispachToProp</span><span class="token punctuation">(</span>store<span class="token punctuation">.</span>dispatch<span class="token punctuation">)</span><span class="token punctuation">&#125;</span> <span class="token operator">/</span><span class="token operator">></span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>组件使用</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> connect <span class="token keyword">from</span> <span class="token string">'../../utils/connect'</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span>
    increment<span class="token punctuation">,</span>
    addNumber
<span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'../../store/actionCreators'</span>

<span class="token keyword">function</span> <span class="token function">Home</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
        <span class="token operator">&lt;</span>div<span class="token operator">></span>
            <span class="token operator">&lt;</span>h4<span class="token operator">></span>Home <span class="token operator">-</span> 当前计数： <span class="token punctuation">&#123;</span>props<span class="token punctuation">.</span>counter<span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>h4<span class="token operator">></span>
            <span class="token operator">&lt;</span>div<span class="token operator">></span>
                <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token parameter">e</span> <span class="token operator">=></span> props<span class="token punctuation">.</span><span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token operator">></span><span class="token operator">+</span><span class="token number">1</span><span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>
                <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token parameter">e</span> <span class="token operator">=></span> props<span class="token punctuation">.</span><span class="token function">addNumber</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token operator">></span><span class="token operator">+</span><span class="token number">5</span><span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>
            <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
    <span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">const</span> <span class="token function-variable function">mapStateToProps</span> <span class="token operator">=</span> <span class="token parameter">state</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>
        <span class="token literal-property property">counter</span><span class="token operator">:</span> state<span class="token punctuation">.</span>counter
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">const</span> <span class="token function-variable function">mapDipatchToProps</span> <span class="token operator">=</span> <span class="token parameter">dispatch</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>
        <span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token function">addNumber</span><span class="token punctuation">(</span><span class="token parameter">num</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token function">addNumber</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">connect</span><span class="token punctuation">(</span>mapStateToProps<span class="token punctuation">,</span> mapDipatchToProps<span class="token punctuation">)</span><span class="token punctuation">(</span>Home<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h6 id="进一步优化，抽离-store-数据"><a href="#进一步优化，抽离-store-数据" class="headerlink" title="进一步优化，抽离 store 数据"></a>进一步优化，抽离 store 数据</h6><p>减少业务代码耦合，使用 context 进行抽离业务数据。</p>
<p>context.js</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token keyword">const</span> StoreContext <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">createContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">export</span> <span class="token punctuation">&#123;</span>
    StoreContext
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>connect.js</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 优化 connect 工具函数 将 store 利用 context 抽离出去</span>
<span class="token comment">// 减少业务代码耦合</span>

<span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> PureComponent <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">"react"</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> StoreContext <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">"./context"</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">connect</span><span class="token punctuation">(</span><span class="token parameter">mapStateToProps<span class="token punctuation">,</span> mapDispachToProp</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
     <span class="token comment">// 高阶组件</span>
     <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token function">enhanceHOC</span><span class="token punctuation">(</span><span class="token parameter">WrappedComponend</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">class</span> <span class="token class-name">EnhanceComponent</span> <span class="token keyword">extends</span> <span class="token class-name">PureComponent</span> <span class="token punctuation">&#123;</span>
            <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">props<span class="token punctuation">,</span> context</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">,</span> context<span class="token punctuation">)</span>

                <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
                    <span class="token comment">// 返回组件中需要的 state</span>
                    <span class="token literal-property property">storeState</span><span class="token operator">:</span> <span class="token function">mapStateToProps</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span>

            <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token comment">// 建立监听</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>unsubscribe <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>context<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
                    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
                        <span class="token literal-property property">storeState</span><span class="token operator">:</span> <span class="token function">mapStateToProps</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>context<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
                <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
            <span class="token punctuation">&#125;</span>

            <span class="token function">componentWillUnmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token comment">// 取消监听</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">unsubscribe</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">&#125;</span>

            <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token comment">// props 穿透</span>
                <span class="token keyword">return</span> <span class="token operator">&lt;</span>WrappedComponend 
                        <span class="token punctuation">&#123;</span><span class="token operator">...</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">&#125;</span> 
                        <span class="token punctuation">&#123;</span><span class="token operator">...</span><span class="token function">mapStateToProps</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>context<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span> 
                        <span class="token punctuation">&#123;</span><span class="token operator">...</span><span class="token function">mapDispachToProp</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>context<span class="token punctuation">.</span>dispatch<span class="token punctuation">)</span><span class="token punctuation">&#125;</span> <span class="token operator">/</span><span class="token operator">></span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>

        EnhanceComponent<span class="token punctuation">.</span>contextType <span class="token operator">=</span> StoreContext

        <span class="token keyword">return</span> EnhanceComponent
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>父组件使用，将store与context建立连接，提供数据</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> Home <span class="token keyword">from</span> <span class="token string">'./Home'</span>
<span class="token keyword">import</span> About <span class="token keyword">from</span> <span class="token string">'./About'</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> StoreContext <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'../../utils/context'</span>
<span class="token keyword">import</span> store <span class="token keyword">from</span> <span class="token string">'../../store'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">UseConnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
        <span class="token operator">&lt;</span>StoreContext<span class="token punctuation">.</span>Provider value<span class="token operator">=</span><span class="token punctuation">&#123;</span> store <span class="token punctuation">&#125;</span><span class="token operator">></span>
            <span class="token operator">&lt;</span>Home<span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>Home<span class="token operator">></span>
            <span class="token operator">&lt;</span>About<span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>About<span class="token operator">></span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>StoreContext<span class="token punctuation">.</span>Provider<span class="token operator">></span>
    <span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>子组件中和 store 方法一致</p>
<h6 id="相关第三方库"><a href="#相关第三方库" class="headerlink" title="相关第三方库"></a>相关第三方库</h6><p><a href="https://github.com/reduxjs/react-redux">react-redux</a> ：官方库，灵活绑定 react 和 redux 。</p>
<h4 id="拆分-reducer"><a href="#拆分-reducer" class="headerlink" title="拆分 reducer"></a>拆分 reducer</h4><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> combineReducers <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'redux'</span>
<span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> actionTypes <span class="token keyword">from</span> <span class="token string">'./actionTypes'</span>

<span class="token comment">// 初始值</span>
<span class="token comment">// const initialState = &#123;</span>
<span class="token comment">//     counter: 0,</span>
<span class="token comment">//     banners: [],</span>
<span class="token comment">//     recommends: [],</span>
<span class="token comment">// &#125;</span>

<span class="token comment">// function reducer(state = initialState, action) &#123;</span>
<span class="token comment">//     switch (action.type) &#123;</span>
<span class="token comment">//         case actionTypes.INCREMENT:</span>
<span class="token comment">//             return &#123;...state, counter: state.counter + 1&#125;</span>
<span class="token comment">//         case actionTypes.DECREMENT:</span>
<span class="token comment">//             return &#123;...state, counter: state.counter - 1&#125;</span>
<span class="token comment">//         case actionTypes.ADD_NUMBER:</span>
<span class="token comment">//             return &#123;...state, counter: state.counter + action.num&#125;</span>
<span class="token comment">//         case actionTypes.SUB_NUMBER:</span>
<span class="token comment">//             return &#123;...state, counter: state.counter - action.num&#125;</span>
<span class="token comment">//         case actionTypes.CHANGE_BANNERS:</span>
<span class="token comment">//             return &#123;...state, banners: action.banners&#125;</span>
<span class="token comment">//         case actionTypes.CHANGE_RECOMMENDS:</span>
<span class="token comment">//             return &#123;...state, recommends: action.recommends&#125;</span>
<span class="token comment">//         default:</span>
<span class="token comment">//             return state</span>
<span class="token comment">//     &#125;</span>
<span class="token comment">// &#125;</span>

<span class="token comment">// reducer 拆分 state 调用的地方需要一起修改</span>
<span class="token keyword">const</span> defaultCounterState <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    <span class="token literal-property property">counter</span><span class="token operator">:</span> <span class="token number">0</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">function</span> <span class="token function">counterReducer</span><span class="token punctuation">(</span><span class="token parameter">state <span class="token operator">=</span> defaultCounterState<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">case</span> actionTypes<span class="token punctuation">.</span><span class="token constant">INCREMENT</span><span class="token operator">:</span>
            <span class="token keyword">return</span> <span class="token punctuation">&#123;</span><span class="token operator">...</span>state<span class="token punctuation">,</span> <span class="token literal-property property">counter</span><span class="token operator">:</span> state<span class="token punctuation">.</span>counter <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">&#125;</span>
        <span class="token keyword">case</span> actionTypes<span class="token punctuation">.</span><span class="token constant">DECREMENT</span><span class="token operator">:</span>
            <span class="token keyword">return</span> <span class="token punctuation">&#123;</span><span class="token operator">...</span>state<span class="token punctuation">,</span> <span class="token literal-property property">counter</span><span class="token operator">:</span> state<span class="token punctuation">.</span>counter <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">&#125;</span>
        <span class="token keyword">case</span> actionTypes<span class="token punctuation">.</span><span class="token constant">ADD_NUMBER</span><span class="token operator">:</span>
            <span class="token keyword">return</span> <span class="token punctuation">&#123;</span><span class="token operator">...</span>state<span class="token punctuation">,</span> <span class="token literal-property property">counter</span><span class="token operator">:</span> state<span class="token punctuation">.</span>counter <span class="token operator">+</span> action<span class="token punctuation">.</span>num<span class="token punctuation">&#125;</span>
        <span class="token keyword">case</span> actionTypes<span class="token punctuation">.</span><span class="token constant">SUB_NUMBER</span><span class="token operator">:</span>
            <span class="token keyword">return</span> <span class="token punctuation">&#123;</span><span class="token operator">...</span>state<span class="token punctuation">,</span> <span class="token literal-property property">counter</span><span class="token operator">:</span> state<span class="token punctuation">.</span>counter <span class="token operator">-</span> action<span class="token punctuation">.</span>num<span class="token punctuation">&#125;</span>
        <span class="token keyword">default</span><span class="token operator">:</span>
            <span class="token keyword">return</span> state
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">const</span> defaultHomeState <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    <span class="token literal-property property">banners</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token literal-property property">recommends</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">function</span> <span class="token function">homeReducer</span><span class="token punctuation">(</span><span class="token parameter">state <span class="token operator">=</span> defaultHomeState<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">case</span> actionTypes<span class="token punctuation">.</span><span class="token constant">CHANGE_BANNERS</span><span class="token operator">:</span>
            <span class="token keyword">return</span> <span class="token punctuation">&#123;</span><span class="token operator">...</span>state<span class="token punctuation">,</span> <span class="token literal-property property">banners</span><span class="token operator">:</span> action<span class="token punctuation">.</span>banners<span class="token punctuation">&#125;</span>
        <span class="token keyword">case</span> actionTypes<span class="token punctuation">.</span><span class="token constant">CHANGE_RECOMMENDS</span><span class="token operator">:</span>
            <span class="token keyword">return</span> <span class="token punctuation">&#123;</span><span class="token operator">...</span>state<span class="token punctuation">,</span> <span class="token literal-property property">recommends</span><span class="token operator">:</span> action<span class="token punctuation">.</span>recommends<span class="token punctuation">&#125;</span>
        <span class="token keyword">default</span><span class="token operator">:</span>
            <span class="token keyword">return</span> state
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// function reducer(state = &#123;&#125;, action) &#123;</span>
<span class="token comment">//     return &#123;</span>
<span class="token comment">//         counterInfo: counterReducer(state.counterInfo, action),</span>
<span class="token comment">//         homeInfo: homeReducer(state.homeInfo, action)</span>
<span class="token comment">//     &#125;</span>
<span class="token comment">// &#125;</span>
<span class="token comment">// 最终的结果是 reducer 返回和 state = &#123; counterInfo: &#123;&#125;, homeInfo: &#123;&#125; &#125; 一样的对象格式</span>

<span class="token comment">// 使用 redux combineReducers(reducers) api 进一步优化</span>
<span class="token keyword">const</span> reducer <span class="token operator">=</span> <span class="token function">combineReducers</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> 
    <span class="token literal-property property">counterInfo</span><span class="token operator">:</span> counterReducer<span class="token punctuation">,</span> 
    <span class="token literal-property property">homeInfo</span><span class="token operator">:</span> homeReducer 
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> reducer<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>combineReducers 函数 将我们传入的 reducers 合并到一个对象中，最终返回一个 combination 的函数，在执行 combination 函数的过程中，它会通过判断前后返回的数据是否相同来决定返回之前的 state 还是新的 state。新的 state 会触发订阅者发生对应的刷新，而旧的 state 可以有效的阻止订阅者发生刷新。 </p>
</blockquote>
<h4 id="结合-ImmutableJs"><a href="#结合-ImmutableJs" class="headerlink" title="结合 ImmutableJs"></a>结合 <a href="https://github.com/immutable-js/immutable-js">ImmutableJs</a></h4><p><a href="https://github.com/immutable-js/immutable-js">ImmutableJs</a> ：使用不可变的数据。</p>
<p><a href="https://github.com/gajus/redux-immutable#readme">redux-immutable</a>：使用 combineReducer 函数结合redux 和 immutable.js 的功能。</p>
<blockquote>
<p>fromJS 会进行深层比较，而 map 会进行浅层的比较，根据业务需求来确定使用哪一个 api ，fromJS 的性能会比 map 的性能更低。</p>
</blockquote>
<p>更多阅读： <a href="https://redux.js.org/faq/immutable-data">https://redux.js.org/faq/immutable-data</a></p>
<h4 id="性能优化"><a href="#性能优化" class="headerlink" title="性能优化"></a>性能优化</h4><h3 id="扩展"><a href="#扩展" class="headerlink" title="扩展"></a>扩展</h3><p>生态：<a href="https://redux.js.org/introduction/ecosystem">https://redux.js.org/introduction/ecosystem</a></p>
<h4 id="工具"><a href="#工具" class="headerlink" title="工具"></a>工具</h4><p><a href="https://github.com/reduxjs/redux-devtools/tree/master/extension">redux devtool</a> ：不同的场景需要手动设置使用方式，<a href="https://github.com/reduxjs/redux-devtools/tree/master/extension#usage">https://github.com/reduxjs/redux-devtools/tree/master/extension#usage</a></p>
<p>基础使用方式，需要在创建 store 时声明使用</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">createStore</span><span class="token punctuation">(</span>
  reducer<span class="token punctuation">,</span> <span class="token comment">/* preloadedState, */</span>
  window<span class="token punctuation">.</span>__REDUX_DEVTOOLS_EXTENSION__ <span class="token operator">&amp;&amp;</span> window<span class="token punctuation">.</span><span class="token function">__REDUX_DEVTOOLS_EXTENSION__</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>



]]></content>
      <categories>
        <category>前端</category>
        <category>react</category>
      </categories>
      <tags>
        <tag>前端</tag>
        <tag>react</tag>
        <tag>redux</tag>
      </tags>
  </entry>
  <entry>
    <title>react系列-react入门</title>
    <url>/posts/bd48304/</url>
    <content><![CDATA[<p>React官网：<a href="https://reactjs.org/docs/getting-started.html">https://reactjs.org/docs/getting-started.html</a></p>
<p>Creat-react-app官网：<a href="https://create-react-app.dev/">https://create-react-app.dev/</a></p>
<p>教程：</p>
<p><a href="https://github.com/the-road-to-learn-react">https://github.com/the-road-to-learn-react</a></p>
<h3 id="构建"><a href="#构建" class="headerlink" title="构建"></a>构建</h3><p>脚手架工具搭建项目的优势：</p>
<ul>
<li>帮助我们搭建项目的通用性目录结构，进行通用的组织划分</li>
<li>管理文件之间的项目依赖</li>
<li>项目打包和压缩等通用性配置</li>
</ul>
<h4 id="添加-ts-支持"><a href="#添加-ts-支持" class="headerlink" title="添加 ts 支持"></a>添加 ts 支持</h4><p><a href="https://create-react-app.dev/docs/adding-typescript/">https://create-react-app.dev/docs/adding-typescript/</a></p>
<p>创建一个新的 app ：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">npx create-react-app my-app <span class="token parameter variable">--template</span> typescript

<span class="token comment"># or</span>

<span class="token function">yarn</span> create react-app my-app <span class="token parameter variable">--template</span> typescript<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>在已存在的项目中添加 typescript 支持：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> <span class="token parameter variable">--save</span> typescript @types/node @types/react @types/react-dom @types/jest

<span class="token comment"># or</span>

<span class="token function">yarn</span> <span class="token function">add</span> typescript @types/node @types/react @types/react-dom @types/jest<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="基础"><a href="#基础" class="headerlink" title="基础"></a>基础</h3><h4 id="常见概念"><a href="#常见概念" class="headerlink" title="常见概念"></a>常见概念</h4><p>声明式编程</p>
<blockquote>
<p>将传统的命令式编程，如jQuery，转变为声明式编程</p>
<p>声明式写法强调结果的，命令式写法是强调过程的。</p>
</blockquote>
<p>React 元素是<strong>不可变对象</strong>。一旦被创建，就无法更改它的子元素或者属性。</p>
<p>React组件一般不提供方法，而是某种状态机。</p>
<p>状态提升：通常情况下，同一个数据的变化需要几个不同的组件来反映。建议提升共享的状态到它们最近的祖先组件中。</p>
<p>在一个 React 应用中，对于任何可变的数据都应该循序“单一数据源”原则。</p>
<h4 id="JSX"><a href="#JSX" class="headerlink" title="JSX"></a>JSX</h4><p>在属性中嵌入 JavaScript 表达式时，不要在大括号外面加上引号。你应该仅使用引号（对于字符串值）或大括号（对于表达式）中的一个，对于同一属性不能同时使用这两种符号。</p>
<p>React DOM 在渲染所有输入内容之前，默认会进行<a href="https://stackoverflow.com/questions/7381974/which-characters-need-to-be-escaped-on-html">转义</a>。它可以确保在你的应用中，永远不会注入那些并非自己明确编写的内容。所有的内容在渲染之前都被转换成了字符串。这样可以有效地防止 <a href="https://en.wikipedia.org/wiki/Cross-site_scripting">XSS（cross-site-scripting, 跨站脚本）</a>攻击。</p>
<p>无效值不会展示在前端界面，如undefined、null、NaN等数据，如果需要展示则要转换成 string 的数据格式。</p>
<h5 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h5><p>严格区分大小写。<strong>默认组件首字母大写。首字母小写则会被判断为普通标签元素</strong>。</p>
<blockquote>
<p>html 中是对大小写不敏感</p>
</blockquote>
<h6 id="注释写法"><a href="#注释写法" class="headerlink" title="注释写法"></a>注释写法</h6><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx"><span class="token punctuation">&#123;</span><span class="token comment">/* 注释 */</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>js中的关键字不能和html标签中的属性混合，如 html标签中的class属性 需要使用 className 替代，与js中的class 关键字区分开。label标签的for属性需要使用htmlFor进行替代。</p>
<h5 id="本质"><a href="#本质" class="headerlink" title="本质"></a>本质</h5><p>可以使用 <a href="https://babeljs.io/repl#?browsers=defaults%2C%20not%20ie%2011%2C%20not%20ie_mob%2011&build=&builtIns=false&corejs=3.6&spec=false&loose=false&code_lz=DwEwlgbgfAUABHYALATFAtgZwObAPSqwLABGArgC4UD2AdlAMZICGt2ApvuVXVAgjHzhoQA&debug=false&forceAllTransforms=false&shippedProposals=false&circleciRepo=&evaluate=false&fileSize=false&timeTravel=false&sourceType=module&lineWrap=true&presets=env%2Creact&prettier=false&targets=&version=7.14.4&externalPlugins=">babeljs 在线转换工具</a> 进行体验。</p>
<p>jsx写法（script 标签需要写type=”text/babel”，进行转义）：</p>
<pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx"><span class="token keyword">const</span> msg <span class="token operator">=</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">></span></span><span class="token plain-text">hello react</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">></span></span>
ReactDOM<span class="token punctuation">.</span><span class="token function">reader</span><span class="token punctuation">(</span>msg<span class="token punctuation">,</span> decument<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'app'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>javascript写法（script 标签上可以不用写type）：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> msg2 <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'h2'</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">'hello react'</span><span class="token punctuation">)</span>
ReactDOM<span class="token punctuation">.</span><span class="token function">reader</span><span class="token punctuation">(</span>msg2<span class="token punctuation">,</span> decument<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'app'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<blockquote>
<p>jsx -&gt; babel -&gt;React.createElement()</p>
</blockquote>
<p>React.createElement 纯函数最终创建出来一个 ReactElement 对象。</p>
<p>React 利用 ReactElement 对象组成了一个 JavaScript 的对象树（AST树，即虚拟DOM树）</p>
<p>ReactDOM.render 将对象树渲染到目标节点中。</p>
<h4 id="state"><a href="#state" class="headerlink" title="state"></a>state</h4><p>不能直接修改state。出于性能考虑，使用<code>setState()</code>去修改 state 。</p>
<p>因为 <code>this.props</code> 和 <code>this.state</code> 可能会异步更新，所以你不要依赖他们的值来更新下一个状态。</p>
<p>可以让 <code>setState()</code> 接收一个函数而不是一个对象。这个函数用上一个 state 作为第一个参数，将此次更新被应用时的 props 做为第二个参数:</p>
<pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx"><span class="token comment">// Correct</span>
<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> props</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
  <span class="token literal-property property">counter</span><span class="token operator">:</span> state<span class="token punctuation">.</span>counter <span class="token operator">+</span> props<span class="token punctuation">.</span>increment
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>setState() 之后会重新进行 render（重新渲染）。</p>
<h5 id="setState"><a href="#setState" class="headerlink" title="setState"></a><a href="https://zh-hans.reactjs.org/docs/react-component.html#setstate">setState</a></h5><p>react 中没有实现数据的响应式，所以数据更新需要进行手动调用 setState 方法来告知 react 数据发生了变化。</p>
<p><strong>异步更新</strong>数据（<u>但是具体也要分情况，有存在同步的情况</u>）。</p>
<blockquote>
<p>在组件生命周期或 React 合成事件中，setState 是异步的；</p>
<p>在 setTimeout 或 原生 DOM 事件中，setState 是同步的；</p>
</blockquote>
<h6 id="为什么设计为异步更新？"><a href="#为什么设计为异步更新？" class="headerlink" title="为什么设计为异步更新？"></a>为什么设计为异步更新？</h6><p>参考链接：</p>
<p><a href="https://zh-hans.reactjs.org/docs/faq-state.html#when-is-setstate-asynchronous">https://zh-hans.reactjs.org/docs/faq-state.html#when-is-setstate-asynchronous</a></p>
<p><a href="https://github.com/facebook/react/issues/11527#issuecomment-360199710">https://github.com/facebook/react/issues/11527#issuecomment-360199710</a></p>
<ul>
<li>setState 设计为异步，可以显著的提升性能；<ul>
<li>如果每次调用 setState 都进行一次更新，那么意味着 render 函数会被频繁调用，界面重新渲染，这样效率是很低的；</li>
<li>最好的办法应该是获取到多个更新，之后进行批量更新；</li>
</ul>
</li>
<li>如果同步更新了 state，但是还没有执行 render 函数，那么 state 和 props 不能保持同步；<ul>
<li>state 和 props 不能保持一致性，会在开发中产生很多的问题；</li>
</ul>
</li>
</ul>
<h6 id="如何获取异步更新后的数据"><a href="#如何获取异步更新后的数据" class="headerlink" title="如何获取异步更新后的数据"></a>如何获取异步更新后的数据</h6><p>方法一：使用 setState 方法的回调函数，回调函数会等待 setState 数据更新后立即执行。</p>
<blockquote>
<p>类似 vue 中的 nextTick</p>
</blockquote>
<p>方法二：生命周期函数 componentDidUpdate ，会在 render 函数执行后执行。此时可以拿到最新的 state 数据。</p>
<blockquote>
<p>会先执行 componentDidUpdate 之后再执行 setState 的回调函数</p>
</blockquote>
<h6 id="setState-同步的情况"><a href="#setState-同步的情况" class="headerlink" title="setState 同步的情况"></a>setState 同步的情况</h6><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx"><span class="token comment">// 情况一：将 setState 放入到定时器中</span>
<span class="token function">changeText</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
            <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">'xxxx'</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>message<span class="token punctuation">)</span> <span class="token comment">// xxxx</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">// 情况二：原生DOM事件</span>
<span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">const</span> btnEl <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'btn'</span><span class="token punctuation">)</span>
    btnEl<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
            <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">'xxxx'</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>message<span class="token punctuation">)</span> <span class="token comment">// xxxx</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h6 id="合并"><a href="#合并" class="headerlink" title="合并"></a>合并</h6><ul>
<li><p>本身调用合并</p>
<p>同时多次调用 setState 会合并成一个操作， react 内部会维护一个数据更新队列，将队列中的结果进行合并，执行最终的数据更新结果。</p>
<pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx"><span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>counter<span class="token punctuation">)</span> <span class="token comment">// 0</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
        <span class="token literal-property property">counter</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>counter <span class="token operator">+</span> <span class="token number">1</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
        <span class="token literal-property property">counter</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>counter <span class="token operator">+</span> <span class="token number">1</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
        <span class="token literal-property property">counter</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>counter <span class="token operator">+</span> <span class="token number">1</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">// 最终的结果是 1</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
<li><p>合并时进行累加</p>
<p>将同时多次调用 setState 传入函数的方式，可以将上一次更新的数据用在下一次更新数据中。</p>
<pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx"><span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>counter<span class="token punctuation">)</span> <span class="token comment">// 0</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">prevState<span class="token punctuation">,</span> props</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>
            <span class="token literal-property property">counter</span><span class="token operator">:</span> prevState<span class="token punctuation">.</span>counter <span class="token operator">+</span> <span class="token number">1</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">prevState<span class="token punctuation">,</span> props</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>
            <span class="token literal-property property">counter</span><span class="token operator">:</span> prevState<span class="token punctuation">.</span>counter <span class="token operator">+</span> <span class="token number">1</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">prevState<span class="token punctuation">,</span> props</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>
            <span class="token literal-property property">counter</span><span class="token operator">:</span> prevState<span class="token punctuation">.</span>counter <span class="token operator">+</span> <span class="token number">1</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
    <span class="token comment">// 一次性就会加 3次</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">// 最终的结果是 3</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ul>
<h6 id="setState-传递的数据需要是不可变的数据"><a href="#setState-传递的数据需要是不可变的数据" class="headerlink" title="setState 传递的数据需要是不可变的数据"></a>setState 传递的数据需要是不可变的数据</h6><p>参考链接：<a href="https://zh-hans.reactjs.org/docs/optimizing-performance.html#the-power-of-not-mutating-data">https://zh-hans.reactjs.org/docs/optimizing-performance.html#the-power-of-not-mutating-data</a></p>
<p>如直接修改引用类型的数据，shouldComponentUpdate 函数中进行数据是否变更对比时，因为引用类型地址未变，所以拿到的新旧数据都是一致的（已更新过的），这是就会容易出现无法监控到数据变更问题 。</p>
<p>深层拷贝容易消耗性能，不能滥用。</p>
<h5 id="更新机制"><a href="#更新机制" class="headerlink" title="更新机制"></a>更新机制</h5><h6 id="渲染流程"><a href="#渲染流程" class="headerlink" title="渲染流程"></a>渲染流程</h6><p>JSX ——&gt; 虚拟 DOM ——&gt; 真实 DOM</p>
<h6 id="更新流程"><a href="#更新流程" class="headerlink" title="更新流程"></a>更新流程</h6><ol>
<li>props / state 改变</li>
<li>render 函数重新执行</li>
<li>产生新的 DOM 树</li>
<li>新旧 DOM 树进行 diff 比较</li>
<li>计算出差异进行更新</li>
<li>更新到真实的 DOM</li>
</ol>
<h6 id="diff-算法"><a href="#diff-算法" class="headerlink" title="diff 算法"></a><a href="https://zh-hans.reactjs.org/docs/reconciliation.html#the-diffing-algorithm">diff 算法</a></h6><p>对<a href="https://grfia.dlsi.ua.es/ml/algorithms/references/editsurvey_bille.pdf">当前最优的diff算法</a>进行了优化（简化），时间复杂度从O(n^3)变为O(n).</p>
<ul>
<li><p>同层节点之间相互比较，不会跨节点比较；</p>
</li>
<li><p>不同类型的节点，产生不同的树结构；</p>
<ul>
<li><p>当节点为不同的元素，React会拆卸原有的树，并且建立起新的树；这个流程会触发组件的生命周期。</p>
<blockquote>
<p>即如果新旧DOM树中父节点和不同就不会再进行比较子节点了，即使子节点相同，会更新以父节点为根的整棵DOM子树</p>
</blockquote>
</li>
<li><p>当比对两个相同类型的 React 元素时，React 会保留 DOM 节点，仅更新有改变的属性。会继续向下比对子节点。</p>
<blockquote>
<p>变更的属性细粒程度，如 style 中的 color 元素改变，其他元素不变时，仅更新 color 元素。</p>
</blockquote>
</li>
<li><p>如果是同类型的组件元素，组件会保持不变，React 会更新该组件的 props，并且调用相关更新的生命周期函数后，调用 render 方法，diff 算法会在 render 函数后再进行递归比较。</p>
</li>
<li><p>同时遍历新旧DOM树节点，如第一个节点和第一个节点进行比较。例如，list 向前插入数据，就会发现第一个子节点不一样，react 就会直接更新节点第一个节点，而旧树的第二个和新树的第三个节点相同也不会进行复用。</p>
<blockquote>
<p>这里和 vue 2.x中的diff算法不同，vue 中的diff算法即使没有key值也会比对普通节点的元素是否完全一致。</p>
</blockquote>
</li>
</ul>
</li>
<li><p>开发中，可以通过 key 来指定哪些节点在不同的渲染下保持稳定；</p>
<p>当子元素有 key 属性时，React 使用 key 来匹配旧DOM树上的子元素以及最新树上的子元素。可以提高树的转换效率和复用程度。</p>
<p>使用数组下标作为key值，如果数组元素不进行重新排序时比较合适，如果有顺序修改则 diff 就会变慢。</p>
<p>所以<strong>避免使用数组下标或随机数作为key值</strong>，这样和不使用key值可能效率一样。</p>
</li>
</ul>
<h5 id="react-中的-state-如何管理"><a href="#react-中的-state-如何管理" class="headerlink" title="react 中的 state 如何管理"></a>react 中的 state 如何管理</h5><p>管理方式：</p>
<ul>
<li>组件中自己的 state 管理</li>
<li>Context 数据的共享状态</li>
<li>Redux 管理应用状态</li>
</ul>
<p>建议的 state 管理方案：</p>
<ul>
<li>UI 相关的组件内部可以维护的状态，在组件内部自己来维护；</li>
<li>大部分需要共享的状态，都交给 redux 来管理和维护；</li>
<li>从服务器请求的数据（包括请求的操作），交给 redux 来维护；</li>
</ul>
<h4 id="虚拟DOM"><a href="#虚拟DOM" class="headerlink" title="虚拟DOM"></a>虚拟DOM</h4><p>原因：</p>
<ul>
<li><p>很难跟踪状态的发生；</p>
</li>
<li><p>频繁操作真实DOM性能较低</p>
<blockquote>
<p>比如容易频繁引起浏览器的回流和重绘，虚拟DOM比较容易批量进行DOM操作</p>
</blockquote>
</li>
</ul>
<p>优势：</p>
<ul>
<li>从命令式编程（传统jQuery方式）转到了声明式编程模式</li>
<li>UI以一种虚拟化的方式保存在内存中，并且是一个相对简单的 JavaScript 对象</li>
<li>协调：通过ReactDOM.render 让虚拟DOM 和 真实DOM 同步起来 </li>
</ul>
<h4 id="事件"><a href="#事件" class="headerlink" title="事件"></a><a href="https://zh-hans.reactjs.org/docs/handling-events.html">事件</a></h4><p>React 元素的事件处理：</p>
<ul>
<li>React 事件的命名采用小驼峰式（camelCase），而不是纯小写。</li>
<li>使用 JSX 语法时你需要传入一个函数作为事件处理函数，而不是一个字符串。</li>
</ul>
<blockquote>
<p>对于绑定原生 DOM 上的事件返回的都是合成事件。</p>
</blockquote>
<pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx"><span class="token keyword">const</span> el <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'app'</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">&#123;</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
            <span class="token literal-property property">msg</span><span class="token operator">:</span> <span class="token string">'hello world'</span><span class="token punctuation">,</span>
            <span class="token literal-property property">list</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token comment">// 写法一</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> state<span class="token punctuation">,</span> change <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token keyword">this</span>
        <span class="token comment">// 列表写法一</span>
        <span class="token keyword">const</span> listArr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> item <span class="token keyword">of</span> state<span class="token punctuation">.</span>list<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            listArr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">></span></span><span class="token punctuation">&#123;</span> item <span class="token punctuation">&#125;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span><span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span>

        <span class="token keyword">return</span> <span class="token punctuation">(</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">
                </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">></span></span><span class="token punctuation">&#123;</span> state<span class="token punctuation">.</span>msg <span class="token punctuation">&#125;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">></span></span><span class="token plain-text">
                </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token function">change</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token punctuation">></span></span><span class="token plain-text">change</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text">
                </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">></span></span><span class="token plain-text">
                    </span><span class="token punctuation">&#123;</span> <span class="token comment">/* 列表写法二 */</span><span class="token punctuation">&#125;</span><span class="token plain-text">
                    </span><span class="token punctuation">&#123;</span>
                        state<span class="token punctuation">.</span>list<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
                            <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">></span></span><span class="token punctuation">&#123;</span> item <span class="token punctuation">&#125;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span><span class="token punctuation">)</span>
                        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
                    <span class="token punctuation">&#125;</span><span class="token plain-text">
                    </span><span class="token punctuation">&#123;</span> listArr <span class="token punctuation">&#125;</span><span class="token plain-text">
                </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">></span></span><span class="token plain-text">  
            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>

    <span class="token function">change</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
            <span class="token literal-property property">msg</span><span class="token operator">:</span> <span class="token string">'hello react'</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>

    <span class="token comment">// 写法二</span>
    <span class="token comment">// render() &#123;</span>
    <span class="token comment">//     const &#123; state &#125; = this</span>
    <span class="token comment">//     return (</span>
    <span class="token comment">//         &lt;div></span>
    <span class="token comment">//             &lt;h2>&#123; state.msg &#125;&lt;/h2></span>
    <span class="token comment">//             &lt;button onClick=&#123;() => this.setState(&#123; msg: 'hello react' &#125;)&#125;>change&lt;/button>    </span>
    <span class="token comment">//         &lt;/div></span>
    <span class="token comment">//     )</span>
    <span class="token comment">// &#125;</span>
<span class="token punctuation">&#125;</span>

ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">App</span></span> <span class="token punctuation">/></span></span><span class="token punctuation">,</span> el<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h5 id="合成事件SyntheticEvent"><a href="#合成事件SyntheticEvent" class="headerlink" title="合成事件SyntheticEvent"></a><a href="https://zh-hans.reactjs.org/docs/events.html">合成事件<code>SyntheticEvent</code></a></h5><p><code>SyntheticEvent</code> 实例将被传递给你的事件处理函数，它是浏览器的原生事件的跨浏览器包装器。除兼容所有浏览器外，它还拥有和浏览器原生事件相同的接口，包括 <code>stopPropagation()</code> 和 <code>preventDefault()</code>。</p>
<p><strong>如果因为某些原因，当你需要使用浏览器的底层事件时，只需要使用 <code>nativeEvent</code> 属性来获取即可</strong>。<strong>合成事件与浏览器的原生事件不同，也不会直接映射到原生事件</strong>。例如，在 <code>onMouseLeave</code> 事件中 <code>event.nativeEvent</code> 将指向 <code>mouseout</code> 事件。</p>
<p>React 通过将事件 normalize 以让他们在不同浏览器中拥有一致的属性。</p>
<p><strong>大部分事件处理函数在冒泡阶段被触发。如需注册捕获阶段的事件处理函数，则应为事件名添加 <code>Capture</code>。</strong>例如，处理捕获阶段的点击事件请使用 <code>onClickCapture</code>，而不是 <code>onClick</code>。</p>
<p><u>当使用事件时，需要查看是否有合成事件，如果没有则需要使用原生事件。</u></p>
<p>参考链接：</p>
<p><a href="https://juejin.cn/post/6844903502729183239">React合成事件和DOM原生事件混用须知</a></p>
<p><a href="https://juejin.cn/post/6903805279483297805">React 合成事件和 DOM 原生事件混用</a></p>
<h4 id="组件化"><a href="#组件化" class="headerlink" title="组件化"></a>组件化</h4><p><strong>分而治之</strong>思想的应用。</p>
<p>尽可能的将页面拆分成一个个小的、可复用的组件，降低代码耦合性，更加方便组织和管理，并且扩展性也更强。</p>
<p>React 的规则：<strong>所有 React 组件都必须像纯函数一样保护它们的 props 不被更改。</strong></p>
<p><strong>单向数据流</strong>，数据从父组件通过 props 流向子组件，而子组件不能修改父组件的内容。</p>
<h5 id="组件分类"><a href="#组件分类" class="headerlink" title="组件分类"></a>组件分类</h5><p>相对于Vue而言，可以按照不同的方式分成很多类组件：</p>
<ul>
<li>根据组件的定义方式，分为：函数式组件（Functional Component）和类组件（Class Component）</li>
<li>根据组件内部是否有状态需要维护，分为：无状态组件（Stateless Component）和有状态组件（Stateful Component）</li>
<li>根据组件的不同职责，分为：展示型组件（Presentational Component）和容器型组件（Container Component）</li>
</ul>
<blockquote>
<p>组件分类具有概念重叠部分，还有其他组件概念如异步组件、高阶组件等</p>
</blockquote>
<p>总结：</p>
<p>最主要是关注数据逻辑和UI展示的分离，</p>
<ul>
<li>函数组件、无状态组件、展示型组件主要关注UI的展示</li>
<li>类组件、有状态组件、容器型组件主要关注数据逻辑</li>
</ul>
<h6 id="类组件"><a href="#类组件" class="headerlink" title="类组件"></a>类组件</h6><p>定义：</p>
<ul>
<li>组件的名称是首字母大写（<strong>所有的组件名称约定为大写驼峰</strong>）</li>
<li>类组件需要继承自 <code>React.Component</code></li>
<li>类组件必须实现 <code>render</code> 函数 </li>
</ul>
<p>使用 class 定义一个组件：</p>
<ul>
<li>constructor 是可选的，通常在constructor 中初始化一些数据</li>
<li>this.state 中维护的就是组件内部的数据</li>
<li>render() 方法是 class 组件中唯一必须实现的方法</li>
</ul>
<p>缺点：</p>
<ul>
<li>复杂组件变得难以理解，难以拆分。强行拆分反而会造成过度设计，增加代码的复杂度。</li>
<li>组件复用状态很难。类似于 Provider、Consumer类共享一些状态，多次使用Consumer时，代码会出现很多层嵌套。</li>
</ul>
<h6 id="函数式组件"><a href="#函数式组件" class="headerlink" title="函数式组件"></a>函数式组件</h6><p>定义：函数组件是使用function来进行定义的函数，只是这个函数会返回和类组件中render函数返回一样的内容。</p>
<p>特点：</p>
<ul>
<li>没有this对象</li>
<li>没有内部状态，不需要涉及到状态更新和数据交互（可以使用hooks）</li>
<li>没有生命周期，也会被更新并挂载，但是没有生命周期函数</li>
</ul>
<h4 id="生命周期"><a href="#生命周期" class="headerlink" title="生命周期"></a><a href="https://zh-hans.reactjs.org/docs/react-component.html#the-component-lifecycle">生命周期</a></h4><p>从创建到销毁的过程</p>
<p>生命周期和生命周期函数的关系：</p>
<p>React 内部为了告诉我们当前处于那些阶段，会对组件内部实现的某些函数进行回调，这些就是生命周期函数。</p>
<p><a href="https://projects.wojtekmaj.pl/react-lifecycle-methods-diagram/"><strong>常用的生命周期函数</strong></a>：</p>
<p><img src="/./react%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E5%87%BD%E6%95%B0part.jpg" alt="react生命周期函数part"></p>
<h5 id="constructor-NaN"><a href="#constructor-NaN" class="headerlink" title="constructor"></a>constructor</h5><p>如果不初始化 state 或不进行方法绑定，则不需要为 React 组件实现构造函数。</p>
<p>constructor中通常只做两件事情：</p>
<ul>
<li>通过给 this.state 赋值对象来初始化内部的state</li>
<li>为事件绑定实例（this）</li>
</ul>
<blockquote>
<p>避免把props赋值给state</p>
</blockquote>
<h5 id="render"><a href="#render" class="headerlink" title="render()"></a>render()</h5><p>是 class 组件中唯一必须实现的方法。</p>
<p>render函数应该为<strong>纯函数</strong>，并且不会直接与浏览器交互。</p>
<h6 id="render函数的返回值"><a href="#render函数的返回值" class="headerlink" title="render函数的返回值"></a>render函数的返回值</h6><p>当 render 被调用时，会检查 this.props 和 this.state 的变化并返回以下类型之一：</p>
<ul>
<li><p>React元素</p>
<ul>
<li>通常通过 JSX 创建</li>
</ul>
</li>
<li><p>数组或 fragments（片段）：使得 render 方法可以返回多个元素</p>
</li>
<li><p>Portals：可以渲染子节点到不同的 DOM 子树中</p>
<blockquote>
<p>Portal 提供了一种将子节点渲染到存在于父组件以外的 DOM 节点的优秀的方案。</p>
</blockquote>
</li>
<li><p>字符串或数值类型：在DOM 中会被渲染为文本节点</p>
</li>
<li><p>布尔类型或 null：什么都不渲染</p>
</li>
</ul>
<h5 id="componentDidMount"><a href="#componentDidMount" class="headerlink" title="componentDidMount()"></a>componentDidMount()</h5><p>componentDidMount() 会在组件挂载后（插入DOM树中）立即调用</p>
<p>componentDidMount 中通常进行：</p>
<ul>
<li>依赖于DOM操作可以在这个方法中执行</li>
<li>在此处发送网络请求（官方建议）</li>
<li>可以在此处添加一些订阅和监听（会在componentWillUnmount取消订阅和监听）</li>
</ul>
<h5 id="componentDidUpdate-prevProps-prevState-snapshot"><a href="#componentDidUpdate-prevProps-prevState-snapshot" class="headerlink" title="componentDidUpdate(prevProps, prevState, snapshot)"></a>componentDidUpdate(prevProps, prevState, snapshot)</h5><p>componentDidUpdate() 会在更新后会被立即调用，首次渲染不会执行此方法</p>
<ul>
<li>当组件更新后，可以在此处对 DOM 进行操作</li>
<li>如果对更新前后的props进行了比较，可以选择在此处进行网络请求（例如，当 props 未变化时，则不会执行网络请求）</li>
</ul>
<blockquote>
<p>setState 时注意避免导致死循环</p>
<p>如果组件实现了 getSnapshotBeforeUpdate() 方法，则它的返回值作为 componentDidUpdate() 的第三个参数”snapshot”参数传递，否则此参数将为 undefined 。</p>
</blockquote>
<h5 id="componentWillUnmount"><a href="#componentWillUnmount" class="headerlink" title="componentWillUnmount()"></a>componentWillUnmount()</h5><p>componentWillUnmount() 会在组件卸载及销毁之前直接调用</p>
<ul>
<li>在此方法中执行必要的清理操作，例如，清理 timer，取消网络请求或清楚在 componentDidMount() 中创建的订阅等</li>
</ul>
<blockquote>
<p>不要调用 setState ，因为不会重新渲染执行</p>
</blockquote>
<h5 id="不常用的生命周期"><a href="#不常用的生命周期" class="headerlink" title="不常用的生命周期"></a>不常用的生命周期</h5><p><strong>完整的生命周期函数</strong>：</p>
<p><img src="/./react%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E5%87%BD%E6%95%B0all.jpg" alt="react生命周期函数all"></p>
<h6 id="static-getDerivedStateFromProps-props-state"><a href="#static-getDerivedStateFromProps-props-state" class="headerlink" title="static getDerivedStateFromProps(props, state)"></a>static getDerivedStateFromProps(props, state)</h6><p>getDerivedStateFromProps 会在调用 render 方法之前调用，并且在初始挂载后续更新时都会被调用。它应返回一个对象来更新 state，如果返回 null 则不更新任何内容。</p>
<p><strong>此方法适用于 state 的值在任何时候都取决于 props</strong>。例如，实现 <code>&lt;Transition&gt;</code> 组件可能很方便，该组件会比较当前组件与下一组件，以决定针对哪些组件进行转场动画。</p>
<p><strong>此方法不能访问组件实例</strong>。</p>
<p><strong>注意</strong>：派生状态会导致代码冗余，并使组件难以维护。</p>
<blockquote>
<p>可以使用替代方案进行处理时尽量使用可替代方案。详细查看：<a href="https://zh-hans.reactjs.org/blog/2018/06/07/you-probably-dont-need-derived-state.html">你可能不需要使用派生state</a></p>
</blockquote>
<h6 id="shouldComponentUpdate-nextProps-nextState"><a href="#shouldComponentUpdate-nextProps-nextState" class="headerlink" title="shouldComponentUpdate(nextProps, nextState)"></a>shouldComponentUpdate(nextProps, nextState)</h6><p>shouldComponentUpdate() 会在当 props 和 state 发生变化渲染执行前被调用。返回值默认为 true 。首次渲染或使用 forceUpdate() 时不会调用此方法。</p>
<p>返回 false 可以跳过更新，但是并不会阻止子组件在 state 更改时重新渲染。</p>
<p>此方法进作为<strong>性能优化</strong>的方式而存在。</p>
<p>可以使用 PureComponent 组件进行替代，PureComponent 会对 props 和 state 进行浅层比较，并减少了跳过必要更新的可能性。</p>
<p>**避免在此方法中进行深层次比较或使用 JSON.stringify()**，这样非常影响效率，且会损害性能。</p>
<h6 id="getSnapshotBeforeUpdate-prevProps-prevState"><a href="#getSnapshotBeforeUpdate-prevProps-prevState" class="headerlink" title="getSnapshotBeforeUpdate(prevProps, prevState)"></a>getSnapshotBeforeUpdate(prevProps, prevState)</h6><p>getSnapshotBeforeUpdate() 在最近一次渲染输出（提交到 DOM 节点）之前调用。它使得组件能在发生更改之前从 DOM 中捕获一些信息（例如：滚动位置）。此生命周期方法的任何返回值将作为参数传递给 componentDidUpdate() 。</p>
<blockquote>
<p>render 阶段生命周期（如 <code>render</code>）和 “commit” 阶段生命周期（如 <code>getSnapshotBeforeUpdate</code> 和 <code>componentDidUpdate</code>）之间可能存在延迟。</p>
</blockquote>
<h6 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h6><ul>
<li>减少不常用的生命周期方法的使用，如果有可替代方案则使用可替代方案</li>
<li>不要使用过期的生命周期方法</li>
</ul>
<h4 id="组件之间的通信"><a href="#组件之间的通信" class="headerlink" title="组件之间的通信"></a>组件之间的通信</h4><h5 id="参数验证-propTypes"><a href="#参数验证-propTypes" class="headerlink" title="参数验证 propTypes"></a>参数验证 propTypes</h5><ul>
<li><a href="https://zh-hans.reactjs.org/docs/static-type-checking.html">使用 TypeScript 或 Flow 进行类型验证</a></li>
<li><a href="https://zh-hans.reactjs.org/docs/typechecking-with-proptypes.html">通过 prop-types 库来进行参数验证</a></li>
</ul>
<h5 id="父子组件间的通信"><a href="#父子组件间的通信" class="headerlink" title="父子组件间的通信"></a>父子组件间的通信</h5><h6 id="父组件传递给子组件"><a href="#父组件传递给子组件" class="headerlink" title="父组件传递给子组件"></a>父组件传递给子组件</h6><p>父组件通过 属性=值 的形式来传递数据给子组件</p>
<p>子组件通过 props 参数获取父组件传递过来的数据</p>
<blockquote>
<p>类组件中不进行显式存储props 或 将props传递给父类存储，依旧可以在生命周期函数和 render 函数中获取到 this.props 的值。</p>
<p>原因：<a href="https://zh-hans.reactjs.org/docs/test-renderer.html">https://zh-hans.reactjs.org/docs/test-renderer.html</a></p>
<p>react-test-renderer 库中进行了手动赋值 props，使得进行显式存储props依旧可以获取到 this.props 的值。</p>
</blockquote>
<pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> Component <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> PropTypes <span class="token keyword">from</span> <span class="token string">'prop-types'</span>

<span class="token keyword">class</span> <span class="token class-name">Parent</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">&#123;</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">
                </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">SonClass</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>xxx<span class="token punctuation">"</span></span> <span class="token attr-name">age</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>18<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">SonClass</span></span><span class="token punctuation">></span></span><span class="token plain-text">
                </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">SonClassNoCon</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>xxx<span class="token punctuation">"</span></span> <span class="token attr-name">age</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token number">18</span><span class="token punctuation">&#125;</span></span> <span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">SonClassNoCon</span></span><span class="token punctuation">></span></span><span class="token plain-text">
                </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">SonFun</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>yyy<span class="token punctuation">"</span></span> <span class="token attr-name">age</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>18<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">SonFun</span></span><span class="token punctuation">></span></span><span class="token plain-text">
            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">class</span> <span class="token class-name">SonClass</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">&#123;</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>props <span class="token operator">=</span> props
    <span class="token punctuation">&#125;</span>

    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> name<span class="token punctuation">,</span> age <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props
        <span class="token keyword">return</span> <span class="token punctuation">(</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">
                类子组件：</span><span class="token punctuation">&#123;</span> name <span class="token operator">+</span> <span class="token string">' '</span> <span class="token operator">+</span> age <span class="token punctuation">&#125;</span><span class="token plain-text">
            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 属性类型验证</span>
SonClass<span class="token punctuation">.</span>propTypes <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> PropTypes<span class="token punctuation">.</span>string<span class="token punctuation">,</span>
    <span class="token literal-property property">age</span><span class="token operator">:</span> PropTypes<span class="token punctuation">.</span>number<span class="token punctuation">.</span>isRequired<span class="token punctuation">,</span> <span class="token comment">// 必传参数</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 属性默认值</span>
SonClass<span class="token punctuation">.</span>defaultProps <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'defaultName'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">25</span><span class="token punctuation">,</span>
    <span class="token literal-property property">height</span><span class="token operator">:</span> <span class="token number">180</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">class</span> <span class="token class-name">SonClassNoCon</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// constructor(props) &#123;  // 非必须可以省略 1. Component父类源码中传入了 props 2. 派生类默认写法将传入的参数通过super的方式传入父类</span>
    <span class="token comment">//     super(props) // 传给父类的属性最终是通过call 的形式挂载到当前子类this上 具体可以进行babel转换成es5后查看</span>
    <span class="token comment">// &#125;</span>

    <span class="token comment">// es6 中的 class field 属性</span>
    <span class="token keyword">static</span> propTypes <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token comment">// 类属性</span>
        <span class="token literal-property property">name</span><span class="token operator">:</span> PropTypes<span class="token punctuation">.</span>string<span class="token punctuation">,</span>
        <span class="token literal-property property">age</span><span class="token operator">:</span> PropTypes<span class="token punctuation">.</span>number<span class="token punctuation">.</span>isRequired<span class="token punctuation">,</span> <span class="token comment">// 必传参数</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">static</span> defaultProps <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
        <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'defaultName'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">25</span><span class="token punctuation">,</span>
        <span class="token literal-property property">height</span><span class="token operator">:</span> <span class="token number">180</span>
    <span class="token punctuation">&#125;</span>

    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> name<span class="token punctuation">,</span> age<span class="token punctuation">,</span> height <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props
        <span class="token keyword">return</span> <span class="token punctuation">(</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">
                类子组件：</span><span class="token punctuation">&#123;</span> name <span class="token operator">+</span> <span class="token string">' '</span> <span class="token operator">+</span> age <span class="token operator">+</span> <span class="token string">' '</span> <span class="token operator">+</span> height <span class="token punctuation">&#125;</span><span class="token plain-text">
            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">function</span> <span class="token function">SonFun</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> name<span class="token punctuation">,</span> age <span class="token punctuation">&#125;</span> <span class="token operator">=</span> props
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">
            函数子组件：</span><span class="token punctuation">&#123;</span> name <span class="token operator">+</span> <span class="token string">' '</span> <span class="token operator">+</span> age <span class="token punctuation">&#125;</span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
    <span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> Parent<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h6 id="子组件给父组件传值"><a href="#子组件给父组件传值" class="headerlink" title="子组件给父组件传值"></a>子组件给父组件传值</h6><p>可以通过自定义事件调用时向父组件传值</p>
<p>事件：父组件给子组件传递一个回调函数，在子组件中调用这个函数即可</p>
<pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx"><span class="token comment">// 事件通信</span>
<span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> Component <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token keyword">class</span> <span class="token class-name">EventCommunication</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">&#123;</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
            <span class="token literal-property property">counter</span><span class="token operator">:</span> <span class="token number">0</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
    
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">
                </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h3</span><span class="token punctuation">></span></span><span class="token punctuation">&#123;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>counter <span class="token punctuation">&#125;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h3</span><span class="token punctuation">></span></span><span class="token plain-text">
                </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Button</span></span> <span class="token attr-name">increment</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">
            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>

    <span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
            <span class="token literal-property property">counter</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>counter <span class="token operator">+</span> <span class="token number">1</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">class</span> <span class="token class-name">Button</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">&#123;</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> increment <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props
        <span class="token keyword">return</span> <span class="token punctuation">(</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span>increment<span class="token punctuation">&#125;</span></span><span class="token punctuation">></span></span><span class="token plain-text">+1</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> EventCommunication<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h5 id="跨组件通讯"><a href="#跨组件通讯" class="headerlink" title="跨组件通讯"></a>跨组件通讯</h5><h6 id="基础-props-层层传递"><a href="#基础-props-层层传递" class="headerlink" title="基础 props 层层传递"></a>基础 props 层层传递</h6><p>祖孙组件之间通过 props 自上而下层层传递。（可以使用<a href="https://zh-hans.reactjs.org/docs/jsx-in-depth.html#spread-attributes">属性展开</a>）</p>
<p>容易造成数据冗余</p>
<h6 id="Context"><a href="#Context" class="headerlink" title="Context"></a><a href="https://zh-hans.reactjs.org/docs/context.html">Context</a></h6><p>Context 提供了一个无需为每层组件手动添加 props，就能在组件树间进行数据传递的方法。</p>
<p>应用场景：非父子组件数据的共享。</p>
<p>设计目的：为了共享那些对于一个组件树而言是“全局”的数据。</p>
<p>多个 Context 可以进行嵌套使用， 替代方案： Redux 或 Hooks。</p>
<blockquote>
<p>函数式组件无法使用 this.context 方法，但是可以使用 Context.Consumer 的方式进行操作</p>
</blockquote>
<h6 id="Event"><a href="#Event" class="headerlink" title="Event"></a>Event</h6><p>跨组件事件传递，可以使用 EventBus（事件总线） 的方式进行处理。</p>
<blockquote>
<p>vue 中内置了eventBus 的 api，如果 react 需要使用可以安装第三方库（event）进行。</p>
</blockquote>
<h6 id="Redux-或-Hooks"><a href="#Redux-或-Hooks" class="headerlink" title="Redux 或 Hooks"></a>Redux 或 Hooks</h6><p>应用于更加复杂的场景，简化 Context 操作。</p>
<h5 id="关于-slot"><a href="#关于-slot" class="headerlink" title="关于 slot"></a>关于 slot</h5><p>react 中没有插槽的概念，但是可以使用 props.children 实现，或者使用 JSX 将 html 元素当作 props 传到子组件中。</p>
<pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> Component <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token keyword">class</span> <span class="token class-name">SlotComponent</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">&#123;</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">
                </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Slot</span></span><span class="token punctuation">></span></span><span class="token plain-text">
                    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">aaaa</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">
                    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">bbbb</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">
                </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Slot</span></span><span class="token punctuation">></span></span><span class="token plain-text">
                </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">================</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">
                </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Slot2</span></span> <span class="token attr-name">leftSlot</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">xxxx</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token punctuation">&#125;</span></span> <span class="token attr-name">rightSlot</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">yyyy</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token punctuation">&#125;</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Slot2</span></span><span class="token punctuation">></span></span><span class="token plain-text">
            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">class</span> <span class="token class-name">Slot</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">&#123;</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> children <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props
        <span class="token keyword">return</span> <span class="token punctuation">(</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">
                </span><span class="token punctuation">&#123;</span> children<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token punctuation">&#125;</span><span class="token plain-text">
                </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">-------------------</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">
                </span><span class="token punctuation">&#123;</span> children<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token punctuation">&#125;</span><span class="token plain-text">
            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">class</span> <span class="token class-name">Slot2</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">&#123;</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> leftSlot<span class="token punctuation">,</span> rightSlot <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props
        <span class="token keyword">return</span> <span class="token punctuation">(</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">
                </span><span class="token punctuation">&#123;</span> leftSlot <span class="token punctuation">&#125;</span><span class="token plain-text">
                </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">-------------------</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">
                </span><span class="token punctuation">&#123;</span> rightSlot <span class="token punctuation">&#125;</span><span class="token plain-text">
            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>


<span class="token keyword">export</span> <span class="token keyword">default</span> SlotComponent<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h4 id="Ref"><a href="#Ref" class="headerlink" title="Ref"></a><a href="https://zh-hans.reactjs.org/docs/refs-and-the-dom.html">Ref</a></h4><p>访问DOM元素，进行DOM操作，可以避免直接操作原生DOM。</p>
<p>应用场景如：管理焦点，文本选择或媒体播放；触发强制动画；集成第三方 DOM 库。</p>
<h5 id="获取-refs-的方式："><a href="#获取-refs-的方式：" class="headerlink" title="获取 refs 的方式："></a>获取 refs 的方式：</h5><h6 id="方式一：传入一个对象（推荐）"><a href="#方式一：传入一个对象（推荐）" class="headerlink" title="方式一：传入一个对象（推荐）"></a>方式一：传入一个对象（推荐）</h6><p>对象是通过 React.createRef() 方式创建出来的；</p>
<p>使用时获取到创建的对象其中一个 current 属性就是对应的元素；</p>
<h6 id="方式二：传入一个函数"><a href="#方式二：传入一个函数" class="headerlink" title="方式二：传入一个函数"></a>方式二：传入一个函数</h6><p>该函数会在 DOM 被挂载时进行回调，这个函数会传入一个元素对象，我们可以自己保存，使用时，直接拿到之前保存的元素对象即可。</p>
<h5 id="refs-的类型"><a href="#refs-的类型" class="headerlink" title="refs 的类型"></a>refs 的类型</h5><p>ref 的值根据节点的类型而有所不同：</p>
<ul>
<li>当 ref 属性用于 HTML 元素时，构造函数中使用 React.createRef() 创建的 ref 接收底层 DOM 元素作为其 current 属性；</li>
<li>当 ref 属性用于自定义 class 组件时，ref 对象接收组件的挂载实例作为其 current 属性；</li>
<li><strong>不能在函数组件上直接使用 ref 属性</strong>，因为函数组件没有实例。如果想要获取函数式组件中的某个DOM 元素，可以通过 <a href="https://zh-hans.reactjs.org/docs/forwarding-refs.html">React.forwardRef</a> 进行 ref 转发操作。</li>
</ul>
<h5 id="refs-转发"><a href="#refs-转发" class="headerlink" title="refs 转发"></a>refs 转发</h5><p>Ref 转发是将 ref 自动地通过组件传递到其一子组件的一种技巧。对于可重用的组件库很有用。</p>
<p><strong>Ref 转发是一个可选特性，其允许某些组件接收 ref，并将其向下传递给子组件。</strong></p>
<h4 id="受控和非受控组件"><a href="#受控和非受控组件" class="headerlink" title="受控和非受控组件"></a>受控和非受控组件</h4><h5 id="受控组件"><a href="#受控组件" class="headerlink" title="受控组件"></a><a href="https://zh-hans.reactjs.org/docs/forms.html#controlled-components">受控组件</a></h5><p>在 React 中，可变元素通常保存在组件的 state 属性中，并且只能通过使用 setState() 来更新。</p>
<p>将两者结合起来，使 React 的 state 成为“唯一数据源”。渲染表单的 React 组件还控制着用户输入过程中表单发生的操作。</p>
<p>被 React 以这种方式控制取值的表单输入元素就叫做“受控组件”。</p>
<pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> PureComponent <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Form</span> <span class="token keyword">extends</span> <span class="token class-name">PureComponent</span> <span class="token punctuation">&#123;</span>

    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span>

        <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
            <span class="token literal-property property">username</span><span class="token operator">:</span> <span class="token string">''</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">
                </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">onSubmit</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token parameter">e</span> <span class="token operator">=></span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">handleSubmit</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token punctuation">></span></span><span class="token plain-text">
                    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">htmlFor</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>username<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token plain-text">
                        用户名： 
                      	</span><span class="token punctuation">&#123;</span><span class="token comment">/* 受控组件 */</span><span class="token punctuation">&#125;</span><span class="token plain-text">
                        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>username<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>username <span class="token punctuation">&#125;</span></span> <span class="token attr-name">onChange</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token parameter">e</span> <span class="token operator">=></span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">handleChange</span><span class="token punctuation">(</span>e<span class="token punctuation">,</span> <span class="token string">'username'</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">
                    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">></span></span><span class="token plain-text">
                    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>提交<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">
                </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">></span></span><span class="token plain-text">
            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
    <span class="token function">handleSubmit</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
        e<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
    <span class="token function">handleChange</span><span class="token punctuation">(</span><span class="token parameter">e<span class="token punctuation">,</span> type</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">,</span> type<span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
            <span class="token punctuation">[</span>type<span class="token punctuation">]</span><span class="token operator">:</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>React 推荐大多数情况下使用 受控组件 来处理表单数据：一个受控组件中，表单数据是由 React 组件来管理的；另一种替代方案是使用非受控组件，这时表单数据将交由 DOM 节点来处理。</p>
<h5 id="非受控组件"><a href="#非受控组件" class="headerlink" title="非受控组件"></a><a href="https://zh-hans.reactjs.org/docs/uncontrolled-components.html">非受控组件</a></h5><p>要编写一个非受控组件，而不是为每个状态更新都编写数据处理函数，可以使用 ref 来从 DOM 节点中获取表单数据。</p>
<h4 id="高阶组件HOC"><a href="#高阶组件HOC" class="headerlink" title="高阶组件HOC"></a><a href="https://zh-hans.reactjs.org/docs/higher-order-components.html">高阶组件HOC</a></h4><p><strong>高阶函数</strong>：接受一个或多个函数作为输入，输出一个函数。</p>
<p>常见的高阶函数：filter、map、reduce等。</p>
<p><strong>高阶组件：参数为组件，返回值为新组件的函数。</strong>对组件实现了一个拦截。</p>
<p>高阶组件是一种基于 React 的组合特性而形成的设计模式。</p>
<p>高阶组件将组件转换成另一个新的组件。</p>
<p>高阶组件在一些 React 第三方库中非常常见：</p>
<ul>
<li>如 redux 中的 connect</li>
<li>如 react-router 的 withRouter</li>
<li>如 React.forwardRef()</li>
</ul>
<pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx"><span class="token keyword">class</span> <span class="token class-name">Main</span> <span class="token keyword">extends</span> <span class="token class-name">PureComponent</span> <span class="token punctuation">&#123;</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'main:'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">
                高阶组件
            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">/**
 * 高阶组件 返回类组件
 * @param &#123;Component&#125; WrappedComponent 
 * @returns 
 */</span>
<span class="token keyword">function</span> <span class="token function">enhanceComponent</span><span class="token punctuation">(</span><span class="token parameter">WrappedComponent</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token keyword">class</span> <span class="token class-name">NewComponent</span> <span class="token keyword">extends</span> <span class="token class-name">PureComponent</span> <span class="token punctuation">&#123;</span>
        <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'enhanceComponent'</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">WrappedComponent</span></span> <span class="token spread"><span class="token punctuation">&#123;</span><span class="token operator">...</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">&#125;</span></span> <span class="token punctuation">/></span></span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">/**
 * 高阶组件 返回函数式组件
 * @param &#123;Component&#125; WrappedComponent 
 * @returns 
 */</span>
<span class="token keyword">function</span> <span class="token function">enhanceComponent2</span><span class="token punctuation">(</span><span class="token parameter">WrappedComponent</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token function">NewComponent</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">WrappedComponent</span></span> <span class="token spread"><span class="token punctuation">&#123;</span><span class="token operator">...</span>props<span class="token punctuation">&#125;</span></span> <span class="token punctuation">/></span></span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">const</span> EnhanceComponent <span class="token operator">=</span> <span class="token function">enhanceComponent</span><span class="token punctuation">(</span>Main<span class="token punctuation">)</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> EnhanceComponent<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h5 id="使用场景"><a href="#使用场景" class="headerlink" title="使用场景"></a>使用场景</h5><ul>
<li><p>对原有的组件 props 再多加属性，使用高阶函数对原本导出的组件进行处理，避免修改多个文件的组件使用，和避免修改旧组件使用。</p>
</li>
<li><p>多个组件使用 context 共享数据，相同代码可以使用高阶组件进行抽取。</p>
</li>
<li><p>渲染判断鉴权，根据 props 显示不同的组件。</p>
</li>
<li><p>生命周期劫持。</p>
</li>
<li><p>注意使用高阶组件透传 ref。</p>
<pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">logProps</span><span class="token punctuation">(</span><span class="token parameter">Component</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">class</span> <span class="token class-name">LogProps</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">&#123;</span>
    <span class="token function">componentDidUpdate</span><span class="token punctuation">(</span><span class="token parameter">prevProps</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'old props:'</span><span class="token punctuation">,</span> prevProps<span class="token punctuation">)</span><span class="token punctuation">;</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'new props:'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">const</span> <span class="token punctuation">&#123;</span>forwardedRef<span class="token punctuation">,</span> <span class="token operator">...</span>rest<span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">;</span>

      <span class="token comment">// 将自定义的 prop 属性 “forwardedRef” 定义为 ref</span>
      <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Component</span></span> <span class="token attr-name">ref</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span>forwardedRef<span class="token punctuation">&#125;</span></span> <span class="token spread"><span class="token punctuation">&#123;</span><span class="token operator">...</span>rest<span class="token punctuation">&#125;</span></span> <span class="token punctuation">/></span></span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>

  <span class="token comment">// 注意 React.forwardRef 回调的第二个参数 “ref”。</span>
  <span class="token comment">// 我们可以将其作为常规 prop 属性传递给 LogProps，例如 “forwardedRef”</span>
  <span class="token comment">// 然后它就可以被挂载到被 LogProps 包裹的子组件上。</span>
  <span class="token keyword">return</span> React<span class="token punctuation">.</span><span class="token function">forwardRef</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">props<span class="token punctuation">,</span> ref</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">LogProps</span></span> <span class="token spread"><span class="token punctuation">&#123;</span><span class="token operator">...</span>props<span class="token punctuation">&#125;</span></span> <span class="token attr-name">forwardedRef</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span>ref<span class="token punctuation">&#125;</span></span> <span class="token punctuation">/></span></span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ul>
<h5 id="HOC的意义"><a href="#HOC的意义" class="headerlink" title="HOC的意义"></a>HOC的意义</h5><ul>
<li>Mixin的替代方案<ul>
<li>Mixin 可能会项目依赖，相互耦合，不利于代码维护</li>
<li>不同的 Mixin 中的方法可能会相互冲突</li>
<li>Mixin 非常多时，组件是可以感知到的，甚至还要为其做相关处理，这样会给代码造成滚雪球式的复杂性</li>
</ul>
</li>
</ul>
<h5 id="HOC的缺陷"><a href="#HOC的缺陷" class="headerlink" title="HOC的缺陷"></a>HOC的缺陷</h5><ul>
<li>HOC 需要在原组件上进行包裹或者嵌套，如果大量使用 HOC，将会产生非常多的嵌套，这让调试变得非常困难；</li>
<li>HOC 可以劫持 props，在不遵守约定的情况下可能造成冲突；</li>
</ul>
<h4 id="Portals"><a href="#Portals" class="headerlink" title="Portals"></a>Portals</h4><p>Portal 提供了一种将子节点渲染到存在于父组件以外的 DOM 节点的方案。</p>
<p>某些情况下，我们希望渲染的内容独立于父组件，甚至是独立于当前挂载到的 DOM 元素中（默认都是挂载到 id 为 root 的DOM元素上的）。</p>
<h5 id="用法"><a href="#用法" class="headerlink" title="用法"></a>用法</h5><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> PureComponent <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> ReactDOM <span class="token keyword">from</span> <span class="token string">'react-dom'</span>

<span class="token keyword">const</span> el <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span>
document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>el<span class="token punctuation">)</span>

<span class="token keyword">class</span> <span class="token class-name">Home</span> <span class="token keyword">extends</span> <span class="token class-name">PureComponent</span> <span class="token punctuation">&#123;</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> ReactDOM<span class="token punctuation">.</span><span class="token function">createPortal</span><span class="token punctuation">(</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>children<span class="token punctuation">,</span>
            el
        <span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">class</span> <span class="token class-name">UsePortals</span> <span class="token keyword">extends</span> <span class="token class-name">PureComponent</span> <span class="token punctuation">&#123;</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">
                </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Home</span></span><span class="token punctuation">></span></span><span class="token plain-text">portals' content</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Home</span></span><span class="token punctuation">></span></span><span class="token plain-text">
            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> UsePortals<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h5 id="应用场景"><a href="#应用场景" class="headerlink" title="应用场景"></a>应用场景</h5><p>在组件中创建全屏的弹窗。</p>
<h4 id="性能优化"><a href="#性能优化" class="headerlink" title="性能优化"></a><a href="https://zh-hans.reactjs.org/docs/optimizing-performance.html">性能优化</a></h4><h5 id="组件的-key-值"><a href="#组件的-key-值" class="headerlink" title="组件的 key 值"></a>组件的 key 值</h5><h5 id="组件嵌套的render调用"><a href="#组件嵌套的render调用" class="headerlink" title="组件嵌套的render调用"></a>组件嵌套的render调用</h5><p>如果父组件中修改了 state 仅修改父组件中的数据，与子组件无关，但是会重复调用子组件的render 重新渲染。</p>
<ul>
<li><p>使用 shouldComponentUpdate 生命周期函数来控制类组件的 render 函数调用。</p>
</li>
<li><p>继承 <a href="https://zh-hans.reactjs.org/docs/react-api.html#reactpurecomponent">PureComponent</a> 类创建<u>类组件</u>，避免类组件过多重新渲染，提升页面性能。</p>
<blockquote>
<p>PureComponent类 比 Component类中多实现了一个 shouldComponentUpdate 生命周期函数，以浅层对比 prop 和 state 的方式进行比较。</p>
</blockquote>
</li>
<li><p>继承 <a href="https://zh-hans.reactjs.org/docs/react-api.html#reactmemo">memo</a> 类创建<u>函数式组件</u>，可以避免函数式组件过多重新渲染问题。</p>
<blockquote>
<p>如果你的组件在相同 props 的情况下渲染相同的结果，那么你可以通过将其包装在 <code>React.memo</code> 中调用，以此通过记忆组件渲染结果的方式来提高组件的性能表现。这意味着在这种情况下，React 将跳过渲染组件的操作并直接复用最近一次渲染的结果。</p>
</blockquote>
</li>
</ul>
<h5 id="避免直接修改原始数据"><a href="#避免直接修改原始数据" class="headerlink" title="避免直接修改原始数据"></a>避免直接修改原始数据</h5><h4 id="HOOK"><a href="#HOOK" class="headerlink" title="HOOK"></a><a href="https://zh-hans.reactjs.org/docs/hooks-intro.html">HOOK</a></h4><p>可以让我们在不编写 class 的情况下使用 state 以及其他的 React 特性（比如生命周期）。</p>
<p>Hook 就是 JavaScript 函数，这个函数可以钩入（hook into）React State以及生命周期等特性。</p>
<blockquote>
<p>Hook 指的类似于 userState、useEffect这类的函数</p>
<p>Hooks 是对这类函数的统称</p>
</blockquote>
<p>使用场景：</p>
<ul>
<li>Hook 的出现基本可以代替我们之前所有使用 class 组件的地方（除了一些非常不常用的场景）；</li>
<li>Hook 完全向下兼容，可以渐进式进行使用；</li>
<li>Hook 只能在函数组件中使用，不能在类组件，或者函数组件之外的地方使用；</li>
</ul>
<p><a href="https://zh-hans.reactjs.org/docs/hooks-rules.html">使用规则</a>：</p>
<p>只能在函数最外层调用 Hook。不要在循环、条件判断或者子函数中调用。</p>
<p>只能在 React 的函数组件中调用 Hook。不要在其他 JavaScript 函数中调用。</p>
<p>可以在自定义 Hook 中调用其他 Hook</p>
<blockquote>
<p>有相关 <a href="https://www.npmjs.com/package/eslint-plugin-react-hooks">linter 插件</a>进行约束</p>
</blockquote>
<p><a href="https://zh-hans.reactjs.org/docs/hooks-faq.html#under-the-hood">底层原理</a></p>
<blockquote>
<p>Hooks 内部是以 链表的形式顺序存储的，如果使用循环或条件判断会打乱链表顺序。</p>
</blockquote>
<h5 id="useState"><a href="#useState" class="headerlink" title="useState"></a><a href="https://zh-hans.reactjs.org/docs/hooks-state.html">useState</a></h5><p>是一个 Hook 需要从 react 中导入。</p>
<p>参数：初始化值，如果不设置则为 undefined。可以传入值或函数返回的值。</p>
<p>返回值： 数组。包含两个元素：元素一，当前状态的值（第一调用为初始化值）；元素二，设置状态值的函数。</p>
<p>更新值之后，组件会重新渲染，并且更具新的值返回 DOM 结构。</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> useState <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">CounterHook</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// Hook: useState 本身是一个函数，来自 react 包，参数为声明变量的初始值，返回值为数组 [当前的状态, 设置状态的函数]</span>
    <span class="token comment">// 声明 counter 变量 初始值为0</span>
    <span class="token comment">// const arr = userState(0) </span>
    <span class="token comment">// const counter = arr[0]</span>
    <span class="token comment">// const setState = arr[1]</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span> counter<span class="token punctuation">,</span> setCounter <span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>

    <span class="token keyword">return</span> <span class="token punctuation">(</span>
        <span class="token operator">&lt;</span>div<span class="token operator">></span>
            <span class="token operator">&lt;</span>hr <span class="token operator">/</span><span class="token operator">></span>
            <span class="token operator">&lt;</span>h4<span class="token operator">></span>Hook 当前计数：<span class="token punctuation">&#123;</span> counter <span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>h4<span class="token operator">></span>
            <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">setCounter</span><span class="token punctuation">(</span> counter <span class="token operator">+</span> <span class="token number">1</span> <span class="token punctuation">)</span><span class="token punctuation">&#125;</span> <span class="token operator">></span> <span class="token operator">+</span><span class="token number">1</span> <span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>
            <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">setCounter</span><span class="token punctuation">(</span> counter <span class="token operator">-</span> <span class="token number">1</span> <span class="token punctuation">)</span><span class="token punctuation">&#125;</span> <span class="token operator">></span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
    <span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>set 函数类似于 setState 方法的使用，进行的是异步操作，同时多个操作会进行合并，可以接收函数的形式如<code>setCounter(prevCounter =&gt; prevCounter + 1)</code> 获取到原来的值进行处理。</p>
<blockquote>
<p> 源码中，useState 本质上是使用的 useReducer</p>
</blockquote>
<h5 id="useEffect"><a href="#useEffect" class="headerlink" title="useEffect"></a><a href="https://zh-hans.reactjs.org/docs/hooks-effect.html">useEffect</a></h5><p>Effect Hook 可以在函数组件中执行副作用操作。</p>
<blockquote>
<p>副作用操作，类似于网络请求、手动更新DOM、事件监听等。</p>
</blockquote>
<p>Effect Hook 可以完成一些类似于 Class组件中生命周期的功能。</p>
<p>如果不传入依赖变量或者 [] 则会在每次渲染之后执行。</p>
<p>使用 <code>useEffect</code> 调度的 effect 不会阻塞浏览器更新屏幕，这会让应用看起来响应更快。</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> useState<span class="token punctuation">,</span> useEffect <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token keyword">function</span> <span class="token function">TestShow</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'组件挂载'</span><span class="token punctuation">)</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'订阅一些事件'</span><span class="token punctuation">)</span>
        <span class="token comment">// 可选的清除机制  React 会在组件卸载和更新的时候执行清除操作 会在执行当前 effect 之前对上一个 effect 进行清除 </span>
        <span class="token comment">// 如果 effect 不需要清除则不需要设置返回函数</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'组件卸载'</span><span class="token punctuation">)</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'取消订阅事件'</span><span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">// 如果传入 [] 则表示只会在组件挂载和卸载时执行</span>

    <span class="token keyword">return</span> <span class="token punctuation">(</span>
        <span class="token operator">&lt;</span>div<span class="token operator">></span>test show<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
    <span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">CounterHook</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span> counter<span class="token punctuation">,</span> setCounter <span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span> show<span class="token punctuation">,</span> setShow <span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>

    <span class="token comment">// useEffect 会在每次渲染后都执行</span>
    <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        document<span class="token punctuation">.</span>title <span class="token operator">=</span> counter
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>counter<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">// 仅在 counter 更改时更新 </span>

    <span class="token keyword">return</span> <span class="token punctuation">(</span>
        <span class="token operator">&lt;</span>div<span class="token operator">></span>
            <span class="token operator">&lt;</span>hr <span class="token operator">/</span><span class="token operator">></span>
            <span class="token operator">&lt;</span>h4<span class="token operator">></span>Hook 当前计数：<span class="token punctuation">&#123;</span> counter <span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>h4<span class="token operator">></span>
            <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">setCounter</span><span class="token punctuation">(</span> counter <span class="token operator">+</span> <span class="token number">1</span> <span class="token punctuation">)</span><span class="token punctuation">&#125;</span> <span class="token operator">></span> <span class="token operator">+</span><span class="token number">1</span> <span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>
            <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">setCounter</span><span class="token punctuation">(</span> counter <span class="token operator">-</span> <span class="token number">1</span> <span class="token punctuation">)</span><span class="token punctuation">&#125;</span> <span class="token operator">></span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>
            <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">setShow</span><span class="token punctuation">(</span> <span class="token operator">!</span>show <span class="token punctuation">)</span><span class="token punctuation">&#125;</span> <span class="token operator">></span> <span class="token keyword">switch</span> show <span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>
            <span class="token punctuation">&#123;</span> show <span class="token operator">&amp;&amp;</span> <span class="token operator">&lt;</span>TestShow <span class="token operator">/</span><span class="token operator">></span> <span class="token punctuation">&#125;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
    <span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h6 id="数据频繁变化"><a href="#数据频繁变化" class="headerlink" title="数据频繁变化"></a><a href="https://zh-hans.reactjs.org/docs/hooks-faq.html#what-can-i-do-if-my-effect-dependencies-change-too-often">数据频繁变化</a></h6><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">Counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">const</span> id <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
      <span class="token function">setCount</span><span class="token punctuation">(</span><span class="token parameter">c</span> <span class="token operator">=></span> c <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ✅ 在这不依赖于外部的 `count` 变量</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">clearInterval</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ✅ 我们的 effect 不使用组件作用域中的任何变量</span>

  <span class="token keyword">return</span> <span class="token operator">&lt;</span>h1<span class="token operator">></span><span class="token punctuation">&#123;</span>count<span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">></span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>只要 Hook 的调用顺序在多次渲染之间保持一致，React 就能正确地将内部 state 和对应的 Hook 进行关联。但是容易出现 bug，所以需要Hook 在组件的最顶层调用，将条件判断放在 effect 中。</p>
</blockquote>
<h5 id="useContext"><a href="#useContext" class="headerlink" title="useContext"></a><a href="https://zh-hans.reactjs.org/docs/hooks-reference.html#usecontext">useContext</a></h5><p>接收一个 context 对象（<code>React.createContext</code> 的返回值）并返回该 context 的当前值。当前的 context 值由上层组件中距离当前组件最近的 <code>&lt;MyContext.Provider&gt;</code> 的 <code>value</code> prop 决定。</p>
<p>当组件上层最近的 <code>&lt;MyContext.Provider&gt;</code> 更新时，该 Hook 会触发重渲染，并使用最新传递给 <code>MyContext</code> provider 的 context <code>value</code> 值。即使祖先使用 <a href="https://zh-hans.reactjs.org/docs/react-api.html#reactmemo"><code>React.memo</code></a> 或 <a href="https://zh-hans.reactjs.org/docs/react-component.html#shouldcomponentupdate"><code>shouldComponentUpdate</code></a>，也会在组件本身使用 <code>useContext</code> 时重新渲染。</p>
<p> <code>useContext</code> 的参数必须是 <em>context 对象本身</em></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> createContext<span class="token punctuation">,</span> useContext <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token keyword">const</span> UserContext <span class="token operator">=</span> <span class="token function">createContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> ThemeContext <span class="token operator">=</span> <span class="token function">createContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">function</span> <span class="token function">Son</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">const</span> sonUserInfo <span class="token operator">=</span> <span class="token function">useContext</span><span class="token punctuation">(</span>UserContext<span class="token punctuation">)</span>
    <span class="token keyword">const</span> sonTheme <span class="token operator">=</span> <span class="token function">useContext</span><span class="token punctuation">(</span>ThemeContext<span class="token punctuation">)</span>

    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>sonUserInfo<span class="token punctuation">,</span> sonTheme<span class="token punctuation">)</span>

    <span class="token keyword">return</span> <span class="token punctuation">(</span>
        <span class="token operator">&lt;</span>div style<span class="token operator">=</span><span class="token punctuation">&#123;</span>sonTheme<span class="token punctuation">&#125;</span><span class="token operator">></span>
            <span class="token punctuation">&#123;</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">name: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>sonUserInfo<span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">, age: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>sonUserInfo<span class="token punctuation">.</span>age<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span> <span class="token punctuation">&#125;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
    <span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">UseContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">const</span> userInfo <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
        <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'xxx'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">18</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">const</span> themeData <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
        <span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token string">'blue'</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">return</span> <span class="token punctuation">(</span>
        <span class="token operator">&lt;</span>UserContext<span class="token punctuation">.</span>Provider value<span class="token operator">=</span><span class="token punctuation">&#123;</span>userInfo<span class="token punctuation">&#125;</span><span class="token operator">></span>
            <span class="token operator">&lt;</span>ThemeContext<span class="token punctuation">.</span>Provider value<span class="token operator">=</span><span class="token punctuation">&#123;</span>themeData<span class="token punctuation">&#125;</span><span class="token operator">></span>
                <span class="token operator">&lt;</span>Son<span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>Son<span class="token operator">></span>
            <span class="token operator">&lt;</span><span class="token operator">/</span>ThemeContext<span class="token punctuation">.</span>Provider<span class="token operator">></span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>UserContext<span class="token punctuation">.</span>Provider<span class="token operator">></span>
    <span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h5 id="useReducer"><a href="#useReducer" class="headerlink" title="useReducer"></a><a href="https://zh-hans.reactjs.org/docs/hooks-reference.html#usereducer">useReducer</a></h5><p>useState 的替代方案，搭配 reducer 使用。它接收一个形如 <code>(state, action) =&gt; newState</code> 的 reducer，并返回当前的 state 以及与其配套的 <code>dispatch</code> 方法。</p>
<p>在某些场景下，<code>useReducer</code> 会比 <code>useState</code> 更适用，例如 state 逻辑较复杂且包含多个子值，或者下一个 state 依赖于之前的 state 等。并且，使用 <code>useReducer</code> 还能给那些会触发深更新的组件做性能优化，因为<a href="https://zh-hans.reactjs.org/docs/hooks-faq.html#how-to-avoid-passing-callbacks-down">你可以向子组件传递 <code>dispatch</code> 而不是回调函数</a> 。</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> useReducer <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token keyword">const</span> actionTypes <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    <span class="token constant">INCREMENT</span><span class="token operator">:</span> <span class="token string">'increment'</span><span class="token punctuation">,</span>
    <span class="token constant">DECREMENT</span><span class="token operator">:</span> <span class="token string">'decrement'</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">function</span> <span class="token function">reducer</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">case</span> actionTypes<span class="token punctuation">.</span><span class="token constant">INCREMENT</span><span class="token operator">:</span>
            <span class="token keyword">return</span> <span class="token punctuation">&#123;</span><span class="token operator">...</span>state<span class="token punctuation">,</span> <span class="token literal-property property">counter</span><span class="token operator">:</span> state<span class="token punctuation">.</span>counter <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">&#125;</span>
        <span class="token keyword">case</span> actionTypes<span class="token punctuation">.</span><span class="token constant">DECREMENT</span><span class="token operator">:</span>
            <span class="token keyword">return</span> <span class="token punctuation">&#123;</span><span class="token operator">...</span>state<span class="token punctuation">,</span> <span class="token literal-property property">counter</span><span class="token operator">:</span> state<span class="token punctuation">.</span>counter <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">&#125;</span>
        <span class="token keyword">default</span><span class="token operator">:</span>
            <span class="token keyword">return</span> state
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">UseReducer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span>state<span class="token punctuation">,</span> dispatch<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useReducer</span><span class="token punctuation">(</span>reducer<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">counter</span><span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>

    <span class="token keyword">return</span> <span class="token punctuation">(</span>
        <span class="token operator">&lt;</span>div<span class="token operator">></span>
            <span class="token operator">&lt;</span>hr <span class="token operator">/</span><span class="token operator">></span>
            <span class="token operator">&lt;</span>h4<span class="token operator">></span>UseReducer 当前计数：<span class="token punctuation">&#123;</span> state<span class="token punctuation">.</span>counter <span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>h4<span class="token operator">></span>
            <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token literal-property property">type</span><span class="token operator">:</span> actionTypes<span class="token punctuation">.</span><span class="token constant">INCREMENT</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span> <span class="token operator">></span> <span class="token operator">+</span><span class="token number">1</span> <span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>
            <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token literal-property property">type</span><span class="token operator">:</span> actionTypes<span class="token punctuation">.</span><span class="token constant">DECREMENT</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span> <span class="token operator">></span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
    <span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h5 id="useCallback"><a href="#useCallback" class="headerlink" title="useCallback"></a>useCallback</h5><p>useCallback 实际的目的是为了进行<strong>性能的优化</strong>。</p>
<p>useCallback 会返回一个函数的 memoized（记忆的）值。</p>
<p>在依赖不变的情况下，多次定义的时候，返回的值是相同的。</p>
<p>当你把回调函数传递给经过优化的并使用引用相等性去避免非必要渲染（例如 <code>shouldComponentUpdate</code>）的子组件时，它将非常有用。</p>
<p>使用场景：<u>在将一个组件中的函数，传递给子组件进行回调使用时，使用 useCallback 对函数进行处理。</u></p>
<p><strong>useCallback 搭配高阶组件 memo 使用</strong>，处理函数组件，避免组件非必要渲染。</p>
<p><strong>针对函数进行优化。</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> useCallback<span class="token punctuation">,</span> useState<span class="token punctuation">,</span> memo <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token keyword">const</span> Button <span class="token operator">=</span> <span class="token function">memo</span><span class="token punctuation">(</span><span class="token parameter">props</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Button 重新渲染 '</span><span class="token punctuation">,</span> props<span class="token punctuation">.</span>title<span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
        <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">&#123;</span>props<span class="token punctuation">.</span>callback<span class="token punctuation">&#125;</span><span class="token operator">></span>Button <span class="token punctuation">&#123;</span> props<span class="token punctuation">.</span>title <span class="token punctuation">&#125;</span> counter<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>
    <span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">UseCallback</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span>counter<span class="token punctuation">,</span> setCounter<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span>isShow<span class="token punctuation">,</span> setIsShow<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>

    <span class="token comment">// 每次重新渲染时都会重新创建并执行</span>
    <span class="token keyword">const</span> <span class="token function-variable function">callback</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'callback'</span><span class="token punctuation">)</span>
        <span class="token function">setCounter</span><span class="token punctuation">(</span>counter <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">const</span> callback2 <span class="token operator">=</span> <span class="token function">useCallback</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'callback2'</span><span class="token punctuation">)</span>
        <span class="token function">setCounter</span><span class="token punctuation">(</span>counter <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>counter<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">// 如果没有任何依赖 则设置空数组 表示只会在挂载组件时 定义一次 闭包环境保留定义时的数值</span>

    <span class="token keyword">return</span> <span class="token punctuation">(</span>
        <span class="token operator">&lt;</span>div<span class="token operator">></span>
            <span class="token operator">&lt;</span>hr <span class="token operator">/</span><span class="token operator">></span>
            <span class="token operator">&lt;</span>h4<span class="token operator">></span>useCallback counter<span class="token operator">:</span> <span class="token punctuation">&#123;</span> counter <span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>h4<span class="token operator">></span>
            <span class="token operator">&lt;</span>Button title<span class="token operator">=</span><span class="token string">'callback1'</span> callback<span class="token operator">=</span><span class="token punctuation">&#123;</span>callback<span class="token punctuation">&#125;</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>Button<span class="token operator">></span>
            <span class="token operator">&lt;</span>Button title<span class="token operator">=</span><span class="token string">'callback2'</span> callback<span class="token operator">=</span><span class="token punctuation">&#123;</span>callback2<span class="token punctuation">&#125;</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>Button<span class="token operator">></span>
            <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span> <span class="token function">setIsShow</span><span class="token punctuation">(</span><span class="token operator">!</span>isShow<span class="token punctuation">)</span> <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token operator">></span><span class="token keyword">switch</span> isShow<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
    <span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h6 id="使用-useMemo-转换-useCallback"><a href="#使用-useMemo-转换-useCallback" class="headerlink" title="使用 useMemo 转换 useCallback"></a>使用 useMemo 转换 useCallback</h6><p><code>useCallback(fn, deps)</code> 相当于 <code>useMemo(() =&gt; fn, deps)</code>。</p>
<h5 id="useMemo"><a href="#useMemo" class="headerlink" title="useMemo"></a>useMemo</h5><p>useMemo 实际目的是为了进行性能的优化。</p>
<p>useMemo 返回的是一个 memoized（记忆的）值。</p>
<p>在依赖不变的情况下，多次定义的时候，返回的值是相同的。</p>
<p>把“创建”函数和依赖项数组作为参数传入 <code>useMemo</code>，它仅会在某个依赖项改变时才重新计算 memoized 值。这种优化有助于避免在每次渲染时都进行高开销的计算。</p>
<p>传入 <code>useMemo</code> 的函数会在渲染期间执行。</p>
<p>如果没有提供依赖项数组，<code>useMemo</code> 在每次渲染时都会计算新的值。</p>
<p><strong>useMemo 搭配高阶组件 memo 使用</strong>，处理函数组件，避免组件非必要渲染。</p>
<p><strong>针对返回值进行优化。</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> useState<span class="token punctuation">,</span> useMemo<span class="token punctuation">,</span> memo <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token keyword">const</span> <span class="token function-variable function">calcSum</span> <span class="token operator">=</span> <span class="token parameter">counter</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'calcSum 重新计算'</span><span class="token punctuation">)</span>
    <span class="token keyword">let</span> total <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> counter<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        total <span class="token operator">+=</span> i
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">return</span> total
<span class="token punctuation">&#125;</span>

<span class="token keyword">const</span> Info <span class="token operator">=</span> <span class="token function">memo</span><span class="token punctuation">(</span><span class="token parameter">props</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Info 组件重新渲染'</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
        <span class="token operator">&lt;</span>div<span class="token operator">></span>name<span class="token operator">:</span> <span class="token punctuation">&#123;</span>props<span class="token punctuation">.</span>info<span class="token punctuation">.</span>name<span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>props<span class="token punctuation">.</span>info<span class="token punctuation">.</span>age<span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
    <span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">UseMemo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span>counter<span class="token punctuation">,</span> setCounter<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span>show<span class="token punctuation">,</span> setShow<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>

    <span class="token comment">// const total = calcSum(counter) // 这种方式 组件的值改变重新渲染时会重新进行计算</span>
    <span class="token keyword">const</span> total <span class="token operator">=</span> <span class="token function">useMemo</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">calcSum</span><span class="token punctuation">(</span>counter<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>counter<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">// 使用 useMemo 依赖值不改变 则不会进行重新计算</span>

    <span class="token comment">// 这种方式 组件重新渲染时会重新定义 info 导致组件重新渲染</span>
    <span class="token comment">// const info = &#123;</span>
    <span class="token comment">//     name: 'xxx',</span>
    <span class="token comment">//     age: 18</span>
    <span class="token comment">// &#125;</span>
    <span class="token comment">// 使用 useMemo 依赖值不改变 则不会重新定义 搭配高阶组件 memo 进行使用</span>
    <span class="token keyword">const</span> info <span class="token operator">=</span> <span class="token function">useMemo</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'xxx'</span><span class="token punctuation">,</span> <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">18</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

    <span class="token keyword">return</span> <span class="token punctuation">(</span>
        <span class="token operator">&lt;</span>div<span class="token operator">></span>
            <span class="token operator">&lt;</span>hr <span class="token operator">/</span><span class="token operator">></span>
            <span class="token operator">&lt;</span>h4<span class="token operator">></span>useMemo counter sum<span class="token operator">:</span> <span class="token punctuation">&#123;</span> total <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token literal-property property">show</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token function">String</span><span class="token punctuation">(</span>show<span class="token punctuation">)</span> <span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>h4<span class="token operator">></span>
            <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">setCounter</span><span class="token punctuation">(</span>counter <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token operator">></span> <span class="token operator">+</span><span class="token number">1</span> <span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>
            <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">setShow</span><span class="token punctuation">(</span><span class="token operator">!</span>show<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token operator">></span><span class="token keyword">switch</span> show<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>
            <span class="token operator">&lt;</span>Info info<span class="token operator">=</span><span class="token punctuation">&#123;</span>info<span class="token punctuation">&#125;</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>Info<span class="token operator">></span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
    <span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h5 id="useRef"><a href="#useRef" class="headerlink" title="useRef"></a>useRef</h5><p>useRef 返回一个 ref 对象， 其 <code>.current</code> 属性被初始化为传入的参数（<code>initialValue</code>）。返回的 ref 对象在组件的整个生命周期保持不变。</p>
<p>用法：</p>
<ul>
<li>引入 DOM （或者组件，但是需要是 class 组件）元素；</li>
<li>保存一个数据，这个对象在整个生命周期中可以保存不变；</li>
</ul>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> PureComponent<span class="token punctuation">,</span> useRef<span class="token punctuation">,</span> useState<span class="token punctuation">,</span> useEffect <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token keyword">class</span> <span class="token class-name">Text</span> <span class="token keyword">extends</span> <span class="token class-name">PureComponent</span><span class="token punctuation">&#123;</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>
            <span class="token operator">&lt;</span>div<span class="token operator">></span><span class="token keyword">class</span> <span class="token class-name">component</span> text<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">UseRef</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span>counter<span class="token punctuation">,</span> setCounter<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>

    <span class="token keyword">const</span> titleRef <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> textRef <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> oldCountRef <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span>counter<span class="token punctuation">)</span>

    <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        oldCountRef<span class="token punctuation">.</span>current <span class="token operator">=</span> counter
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>counter<span class="token punctuation">]</span><span class="token punctuation">)</span>

    <span class="token keyword">const</span> <span class="token function-variable function">changeText</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>titleRef<span class="token punctuation">.</span>current<span class="token punctuation">)</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>textRef<span class="token punctuation">.</span>current<span class="token punctuation">)</span>
        titleRef<span class="token punctuation">.</span>current<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">'Hello world'</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">return</span> <span class="token punctuation">(</span>
        <span class="token operator">&lt;</span>div<span class="token operator">></span>
            <span class="token operator">&lt;</span>hr <span class="token operator">/</span><span class="token operator">></span>
            <span class="token operator">&lt;</span>h4 ref<span class="token operator">=</span><span class="token punctuation">&#123;</span>titleRef<span class="token punctuation">&#125;</span><span class="token operator">></span>useRef hook<span class="token operator">&lt;</span><span class="token operator">/</span>h4<span class="token operator">></span>
            <span class="token operator">&lt;</span>Text ref<span class="token operator">=</span><span class="token punctuation">&#123;</span>textRef<span class="token punctuation">&#125;</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>Text<span class="token operator">></span>
            <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">changeText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token operator">></span>change text<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>
            <span class="token operator">&lt;</span>div<span class="token operator">></span>上一次的数据：<span class="token punctuation">&#123;</span> oldCountRef<span class="token punctuation">.</span>current <span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
            <span class="token operator">&lt;</span>div<span class="token operator">></span>当前的数据：<span class="token punctuation">&#123;</span> counter <span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
            <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">setCounter</span><span class="token punctuation">(</span>counter <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token operator">></span> <span class="token operator">+</span><span class="token number">1</span> <span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
    <span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h5 id="useImperativeHandle"><a href="#useImperativeHandle" class="headerlink" title="useImperativeHandle"></a>useImperativeHandle</h5><p>useImpertiveHandle 可以在使用 ref 时自定义暴露给父组件的实例值。<strong>限制父组件使用子组件实例的自由度。</strong>useImperativeHandle 应当与 forwardRef 一起使用。</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> useRef<span class="token punctuation">,</span> useImperativeHandle<span class="token punctuation">,</span> forwardRef <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token keyword">const</span> Input <span class="token operator">=</span> <span class="token function">forwardRef</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">props<span class="token punctuation">,</span> ref</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">const</span> sonInputRef <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token function">useImperativeHandle</span><span class="token punctuation">(</span>ref<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
        <span class="token function">onFocus</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            sonInputRef<span class="token punctuation">.</span>current<span class="token punctuation">.</span><span class="token function">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">return</span> <span class="token punctuation">(</span>
        <span class="token operator">&lt;</span>input ref<span class="token operator">=</span><span class="token punctuation">&#123;</span>sonInputRef<span class="token punctuation">&#125;</span> type<span class="token operator">=</span><span class="token string">"text"</span> <span class="token operator">/</span><span class="token operator">></span>
    <span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">UseImperativeHandle</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">const</span> inputRef <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">return</span> <span class="token punctuation">(</span>
        <span class="token operator">&lt;</span>div<span class="token operator">></span>
            <span class="token operator">&lt;</span>hr <span class="token operator">/</span><span class="token operator">></span>
            <span class="token operator">&lt;</span>h4<span class="token operator">></span>usesImperativeHandle test<span class="token operator">&lt;</span><span class="token operator">/</span>h4<span class="token operator">></span>
            <span class="token operator">&lt;</span>Input ref<span class="token operator">=</span><span class="token punctuation">&#123;</span>inputRef<span class="token punctuation">&#125;</span> <span class="token operator">/</span><span class="token operator">></span>
            <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> inputRef<span class="token punctuation">.</span>current<span class="token punctuation">.</span><span class="token function">onFocus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token operator">></span>onfocus<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
    <span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h5 id="useLayoutEffect"><a href="#useLayoutEffect" class="headerlink" title="useLayoutEffect"></a>useLayoutEffect</h5><p>useLayoutEffect 会在所有的 DOM 变更之后同步调用 effect。</p>
<p>可以使用它来读取 DOM 布局并同步触发重渲染。</p>
<p>在浏览器执行绘制之前，<code>useLayoutEffect</code> 内部的更新计划将被同步刷新。</p>
<p>与 useEffect 的区别：</p>
<ul>
<li>useEffect 会在渲染的内容更新到 DOM 上后执行，不会阻塞 DOM 的更新；</li>
<li>userLayoutEffect 会在渲染的内容更新到 DOM 上之前执行，会阻塞 DOM 的更新；</li>
</ul>
<p>如果希望在某些操作发生之后再更新 DOM ，那么应该将这个操作放到 useLayoutEffect。</p>
<p><strong>尽可能使用标准的 <code>useEffect</code> 以避免阻塞视觉更新。</strong></p>
<blockquote>
<p>useLayoutEffect 的调用阶段与 componentDidMount、componentDidUpdate 的调用阶段时一样的。</p>
</blockquote>
<h5 id="自定义HOOK"><a href="#自定义HOOK" class="headerlink" title="自定义HOOK"></a><a href="https://zh-hans.reactjs.org/docs/hooks-custom.html">自定义HOOK</a></h5><p>自定义 Hook 本质上只是一种函数代码逻辑的抽取，严格意义上来说，它本身并不算 React 的特性。</p>
<p><strong>自定义 Hook 是一个函数，其名称以 “<code>use</code>” 开头，函数内部可以调用其他的 Hook。</strong></p>
<p>与组件中一致，请确保只在自定义 Hook 的顶层无条件地调用其他 Hook。</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> useEffect<span class="token punctuation">,</span> useState <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token comment">/**
 * 需求： 所有组件在创建喝销毁时都进行打印
 * 组件被创建：打印 组件被创建了
 * 组件被销毁：打印 组件被销毁了
 * @returns 
 */</span>
<span class="token keyword">function</span> <span class="token function">useLoggerLife</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>name<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string"> 被创建</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>name<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string"> 被销毁</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">const</span> <span class="token function-variable function">Test</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token function">useLoggerLife</span><span class="token punctuation">(</span><span class="token string">'Test'</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
        <span class="token operator">&lt;</span>div<span class="token operator">></span>test component<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
    <span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">CustomLifeHook</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span>show<span class="token punctuation">,</span> setShow<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
    <span class="token function">useLoggerLife</span><span class="token punctuation">(</span><span class="token string">'CustomLifeHook'</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
        <span class="token operator">&lt;</span>div<span class="token operator">></span>
            <span class="token operator">&lt;</span>hr <span class="token operator">/</span><span class="token operator">></span>
            <span class="token operator">&lt;</span>h4<span class="token operator">></span>custom hook<span class="token operator">&lt;</span><span class="token operator">/</span>h4<span class="token operator">></span>
            <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">setShow</span><span class="token punctuation">(</span><span class="token operator">!</span>show<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token operator">></span><span class="token keyword">switch</span> show<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>
            <span class="token punctuation">&#123;</span> show <span class="token operator">&amp;&amp;</span> <span class="token operator">&lt;</span>Test<span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>Test<span class="token operator">></span> <span class="token punctuation">&#125;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
    <span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>查找其他人写的hooks资源：<a href="https://usehooks.com/">https://usehooks.com/</a></p>
<h5 id="关于优化"><a href="#关于优化" class="headerlink" title="关于优化"></a>关于优化</h5><h6 id="禁止不必要的useCallback和useMemo"><a href="#禁止不必要的useCallback和useMemo" class="headerlink" title="禁止不必要的useCallback和useMemo"></a>禁止不必要的useCallback和useMemo</h6><p>有些初学hooks的同学喜欢见到callback就useCallback，见到calculate就useMemo，这些都属于“过早优化”的典型表现。你以为这样可以提升性能，实际上这一点不一定，但有一点可以肯定的是代码更容易出bug。</p>
<p>具体可以看<a href="https://dmitripavlutin.com/dont-overuse-react-usecallback/">这篇文章</a></p>
<p>只有在必要的时候使用useCallback和useMemo，什么叫必要的时候呢？就是不使用useCallback和useMemo就会导致性能瓶颈的时候。</p>
<h4 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h4><blockquote>
<p>vue-cli 使用了 webpack-chain进行 webpack配置扩展和自定义</p>
</blockquote>
<p>react 项目进行扩展配置：</p>
<p>方法一：使用 <code>react-scripts eject</code>将配置文件暴露出来，然后进行修改。</p>
<p>方法二：不进行暴露项目初始配置，在初始配置上进行扩展修改，参考链接：<a href="https://github.com/timarney/react-app-rewired/blob/master/README_zh.md">https://github.com/timarney/react-app-rewired/blob/master/README_zh.md</a></p>
<p>方法三：使用 <a href="https://github.com/gsoft-inc/craco">craco</a> 库进行配置扩展（推荐）</p>
<h3 id="样式"><a href="#样式" class="headerlink" title="样式"></a>样式</h3><p>使用 className 定义组件或标签的样式类名。</p>
<blockquote>
<p>不使用 class 为了和 js 中的 class 类关键字区分开</p>
</blockquote>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> PureComponent <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> classNames <span class="token keyword">from</span> <span class="token string">'classnames'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">UseClassname</span> <span class="token keyword">extends</span> <span class="token class-name">PureComponent</span> <span class="token punctuation">&#123;</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">const</span> isActive <span class="token operator">=</span> <span class="token boolean">true</span>
        <span class="token keyword">const</span> isFoo <span class="token operator">=</span> <span class="token boolean">true</span>
        <span class="token keyword">const</span> isBar <span class="token operator">=</span> <span class="token boolean">false</span>
        <span class="token keyword">const</span> errClass <span class="token operator">=</span> <span class="token string">'error'</span>
        <span class="token keyword">const</span> warnClass <span class="token operator">=</span> <span class="token keyword">null</span> <span class="token comment">// undefined 0</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>
            <span class="token operator">&lt;</span>div<span class="token operator">></span>
                <span class="token punctuation">&#123;</span><span class="token comment">/* 原生中添加 className 的方法 */</span><span class="token punctuation">&#125;</span>
                <span class="token operator">&lt;</span>h5 className<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token string">'foo bar baz'</span><span class="token punctuation">&#125;</span> <span class="token operator">></span>classnames title <span class="token number">1</span><span class="token operator">&lt;</span><span class="token operator">/</span>h5<span class="token operator">></span>
                <span class="token operator">&lt;</span>h5 className<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token string">'title'</span> <span class="token operator">+</span> <span class="token punctuation">(</span>isActive <span class="token operator">?</span> <span class="token string">' active'</span> <span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">)</span> <span class="token punctuation">&#125;</span> <span class="token operator">></span>classnames title <span class="token number">2</span><span class="token operator">&lt;</span><span class="token operator">/</span>h5<span class="token operator">></span>
                <span class="token operator">&lt;</span>h5 className<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">[</span><span class="token string">'title'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>isActive <span class="token operator">?</span> <span class="token string">' active'</span> <span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span> <span class="token operator">></span>classnames title <span class="token number">3</span><span class="token operator">&lt;</span><span class="token operator">/</span>h5<span class="token operator">></span>

                <span class="token punctuation">&#123;</span><span class="token comment">/* classnames库添加class */</span><span class="token punctuation">&#125;</span>
                <span class="token operator">&lt;</span>h5 className<span class="token operator">=</span><span class="token string">'foo bar baz'</span> <span class="token operator">></span>classnames title <span class="token number">4</span><span class="token operator">&lt;</span><span class="token operator">/</span>h5<span class="token operator">></span>
                <span class="token operator">&lt;</span>h5 className<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token function">classNames</span><span class="token punctuation">(</span><span class="token string">'foo bar baz'</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span> <span class="token operator">></span>classnames title <span class="token number">5</span><span class="token operator">&lt;</span><span class="token operator">/</span>h5<span class="token operator">></span>
                <span class="token operator">&lt;</span>h5 className<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token function">classNames</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string-property property">'active'</span><span class="token operator">:</span> isActive<span class="token punctuation">,</span> <span class="token string-property property">'bar'</span><span class="token operator">:</span> isBar<span class="token punctuation">,</span> <span class="token string-property property">'foo'</span><span class="token operator">:</span> isFoo<span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token string">'title'</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span> <span class="token operator">></span>classnames title <span class="token number">6</span><span class="token operator">&lt;</span><span class="token operator">/</span>h5<span class="token operator">></span>
                <span class="token operator">&lt;</span>h5 className<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token function">classNames</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">,</span> errClass<span class="token punctuation">,</span> warnClass<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> <span class="token string-property property">"active"</span><span class="token operator">:</span> isActive <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span> <span class="token operator">></span>classnames title <span class="token number">7</span><span class="token operator">&lt;</span><span class="token operator">/</span>h5<span class="token operator">></span>
                <span class="token operator">&lt;</span>h5 className<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token function">classNames</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'active'</span><span class="token punctuation">,</span> <span class="token string">'title'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span> <span class="token operator">></span>classnames title <span class="token number">8</span><span class="token operator">&lt;</span><span class="token operator">/</span>h5<span class="token operator">></span>
                <span class="token operator">&lt;</span>h5 className<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token function">classNames</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'active'</span><span class="token punctuation">,</span> <span class="token string">'title'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token string-property property">'foo'</span><span class="token operator">:</span> isFoo<span class="token punctuation">&#125;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span> <span class="token operator">></span>classnames title <span class="token number">9</span><span class="token operator">&lt;</span><span class="token operator">/</span>h5<span class="token operator">></span>
            <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>常用的方式：</p>
<ul>
<li><p>原生的CSS</p>
</li>
<li><p>内联样式 </p>
</li>
<li><p>CSS Modules</p>
<p>React 脚手架中已经内置了关于 CSS Modules 的相关配置，可以直接使用，将相关的 css/less/scss 文件后缀改为 .module.[css/less/scss] 。</p>
<pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> PureComponent <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> Style <span class="token keyword">from</span> <span class="token string">'./style.module.css'</span>


<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">UseStyle</span> <span class="token keyword">extends</span> <span class="token class-name">PureComponent</span> <span class="token punctuation">&#123;</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">
                </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span> Style<span class="token punctuation">.</span>title <span class="token punctuation">&#125;</span></span><span class="token punctuation">></span></span><span class="token plain-text">use style component</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">
            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
<li><p>CSS in JS</p>
<p>指一种模式，其中 CSS 由 JS 生成而不是在外部文件中定义。<em>注意此功能并不是 React 的一部分，而是由第三方库提供。</em> </p>
<p>目前比较流行的 CSS-in-JS 的库有：</p>
<ul>
<li><p><a href="https://github.com/styled-components/styled-components">styled-components</a></p>
</li>
<li><p>emotion</p>
</li>
<li><p>glamorous</p>
</li>
</ul>
</li>
</ul>
<h4 id="其他常用的第三方库"><a href="#其他常用的第三方库" class="headerlink" title="其他常用的第三方库"></a>其他常用的第三方库</h4><p><a href="https://github.com/JedWatson/classnames">classnames</a>：帮助动态设置 classname，类似 vue 中提供的写法。</p>
<p><a href="https://reactcommunity.org/react-transition-group/">react-transition-group</a>：组件 transition 过渡动画。</p>
<h3 id="小技巧"><a href="#小技巧" class="headerlink" title="小技巧"></a>小技巧</h3><h4 id="组件名重定义（chorme-插件上显示）"><a href="#组件名重定义（chorme-插件上显示）" class="headerlink" title="组件名重定义（chorme 插件上显示）"></a>组件名重定义（chorme 插件上显示）</h4><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx"><span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">PureComponent</span> <span class="token punctuation">&#123;</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>
        	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">app</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
App<span class="token punctuation">.</span>displayName <span class="token operator">=</span> <span class="token string">'DisplayApp'</span>
<span class="token comment">// 在chorme插件上展示的就是DisplayApp组件名</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h4 id="扩展属性（属性全部传递给子组件）"><a href="#扩展属性（属性全部传递给子组件）" class="headerlink" title="扩展属性（属性全部传递给子组件）"></a>扩展属性（属性全部传递给子组件）</h4><p>props 穿透</p>
<pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx"><span class="token keyword">class</span> <span class="token class-name">NewComponent</span> <span class="token keyword">extends</span> <span class="token class-name">PureComponent</span> <span class="token punctuation">&#123;</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">WrappedComponent</span></span> <span class="token spread"><span class="token punctuation">&#123;</span><span class="token operator">...</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">&#125;</span></span> <span class="token punctuation">/></span></span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h4 id="严格模式"><a href="#严格模式" class="headerlink" title="严格模式"></a><a href="https://zh-hans.reactjs.org/docs/strict-mode.html">严格模式</a></h4><p><strong>严格模式会刻意地调用多次组件。</strong></p>
<p>StrictMode 有助于：</p>
<ul>
<li><p>识别不安全的生命周期</p>
</li>
<li><p>使用果实字符串ref  API 的警告</p>
</li>
<li><p>使用废弃的 findDOMNode 方法的警告</p>
</li>
<li><p>检测意外的副作用</p>
<p>在开发环境下，<strong>故意重复调用</strong>以下函数来检测发现是否存在副作用：</p>
<ul>
<li>class 组件的 <code>constructor</code>，<code>render</code> 以及 <code>shouldComponentUpdate</code> 方法</li>
<li>class 组件的生命周期方法 <code>getDerivedStateFromProps</code></li>
<li>函数组件体</li>
<li>状态更新函数 (即 <code>setState</code> 的第一个参数）</li>
<li>函数组件通过使用 <code>useState</code>，<code>useMemo</code> 或者 <code>useReducer</code></li>
</ul>
</li>
<li><p>检测过时的 context API</p>
</li>
</ul>
<h4 id="数据的不可变性"><a href="#数据的不可变性" class="headerlink" title="数据的不可变性"></a>数据的不可变性</h4><h5 id="immutable-js"><a href="#immutable-js" class="headerlink" title="immutable.js"></a><a href="https://github.com/immutable-js/immutable-js">immutable.js</a></h5><p>数据的不可变性，主要解决了两个问题：</p>
<ol>
<li>以防数据发生不可预知的改变；</li>
<li>当数据量大的时浅拷贝或深拷贝赋值变量再修改数据，带来的性能问题和内存浪费。</li>
</ol>
<p>Immutable 对象的特点时只要修改了对象，就会返回一个新的对象，旧的对象不会发生改变。</p>
<p>为了节约内存，出现了一个新的算法：Persistent Data Structure（<strong>持久化数据结构</strong>或一致性数据结构）。</p>
<blockquote>
<p>持久化数据结构：使用了<strong>树</strong>结构，当数据被修改时，会返回一个对象，但是新的对象会尽可能的利用之前的数据结构而不会对内存造成浪费。结构共享。</p>
</blockquote>
<p>更多阅读：</p>
<p><a href="https://medium.com/@dtinth/immutable-js-persistent-data-structures-and-structural-sharing-6d163fbd73d2">Immutable.js, persistent data structures and structural sharing</a></p>
]]></content>
      <categories>
        <category>前端</category>
        <category>react</category>
      </categories>
      <tags>
        <tag>前端</tag>
        <tag>react</tag>
      </tags>
  </entry>
  <entry>
    <title>typescript系列-Typechallenge-中等</title>
    <url>/posts/c3cffbe5/</url>
    <content><![CDATA[<p>答案参考：<a href="https://ghaiklor.github.io/type-challenges-solutions/zh/">https://ghaiklor.github.io/type-challenges-solutions/zh/</a></p>
<h3 id="获取函数返回类型"><a href="#获取函数返回类型" class="headerlink" title="获取函数返回类型"></a>获取函数返回类型</h3><p>题目链接：<a href="https://github.com/type-challenges/type-challenges/blob/master/questions/2-medium-return-type/README.zh-CN.md">https://github.com/type-challenges/type-challenges/blob/master/questions/2-medium-return-type/README.zh-CN.md</a></p>
<p>不使用 <code>ReturnType</code> 实现 TypeScript 的 <code>ReturnType&lt;T&gt;</code> 泛型。</p>
<p><a href="https://www.typescriptlang.org/docs/handbook/utility-types.html#returntypetype"><code>ReturnType&lt;Type&gt;</code></a>：构造函数的返回类型；</p>
<h4 id="用法"><a href="#用法" class="headerlink" title="用法"></a>用法</h4><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">declare</span> <span class="token keyword">function</span> <span class="token function">f1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> a<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span> b<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
 
<span class="token keyword">type</span> <span class="token class-name"><span class="token constant">T0</span></span> <span class="token operator">=</span> ReturnType<span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token builtin">string</span><span class="token operator">></span><span class="token punctuation">;</span>
     <span class="token comment">// type T0 = string</span>
<span class="token keyword">type</span> <span class="token class-name"><span class="token constant">T1</span></span> <span class="token operator">=</span> ReturnType<span class="token operator">&lt;</span><span class="token punctuation">(</span>s<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">void</span><span class="token operator">></span><span class="token punctuation">;</span>
     <span class="token comment">// type T1 = void</span>
<span class="token keyword">type</span> <span class="token class-name"><span class="token constant">T2</span></span> <span class="token operator">=</span> ReturnType<span class="token operator">&lt;&lt;</span><span class="token constant">T</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token constant">T</span><span class="token operator">></span><span class="token punctuation">;</span>
     <span class="token comment">// type T2 = unknown</span>
<span class="token keyword">type</span> <span class="token class-name"><span class="token constant">T3</span></span> <span class="token operator">=</span> ReturnType<span class="token operator">&lt;&lt;</span><span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token class-name"><span class="token constant">U</span></span><span class="token punctuation">,</span> <span class="token constant">U</span> <span class="token keyword">extends</span> <span class="token class-name"><span class="token builtin">number</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token constant">T</span><span class="token operator">></span><span class="token punctuation">;</span>
     <span class="token comment">// type T3 = number[]</span>
<span class="token keyword">type</span> <span class="token class-name"><span class="token constant">T4</span></span> <span class="token operator">=</span> ReturnType<span class="token operator">&lt;</span><span class="token keyword">typeof</span> f1<span class="token operator">></span><span class="token punctuation">;</span>
     <span class="token comment">// type T4 = &#123;</span>
		 <span class="token comment">//    a: number;</span>
		 <span class="token comment">//    b: string;</span>
		 <span class="token comment">// &#125;</span>
<span class="token keyword">type</span> <span class="token class-name"><span class="token constant">T5</span></span> <span class="token operator">=</span> ReturnType<span class="token operator">&lt;</span><span class="token builtin">any</span><span class="token operator">></span><span class="token punctuation">;</span>
     <span class="token comment">// type T5 = any</span>
<span class="token keyword">type</span> <span class="token class-name"><span class="token constant">T6</span></span> <span class="token operator">=</span> ReturnType<span class="token operator">&lt;</span><span class="token builtin">never</span><span class="token operator">></span><span class="token punctuation">;</span>
     <span class="token comment">// type T6 = never</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="其他实现方式"><a href="#其他实现方式" class="headerlink" title="其他实现方式"></a>其他实现方式</h4><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">const</span> <span class="token function-variable function">fn</span> <span class="token operator">=</span> <span class="token punctuation">(</span>v<span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>v<span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token number">1</span>
  <span class="token keyword">else</span>
    <span class="token keyword">return</span> <span class="token number">2</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">type</span> <span class="token class-name">a</span> <span class="token operator">=</span> MyReturnType<span class="token operator">&lt;</span><span class="token keyword">typeof</span> fn<span class="token operator">></span> <span class="token comment">// 应推导出 "1 | 2"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="实现-Omit"><a href="#实现-Omit" class="headerlink" title="实现 Omit"></a>实现 Omit</h3><p>题目链接：<a href="https://github.com/type-challenges/type-challenges/blob/master/questions/3-medium-omit/README.zh-CN.md">https://github.com/type-challenges/type-challenges/blob/master/questions/3-medium-omit/README.zh-CN.md</a></p>
<p>不使用 <code>Omit</code> 实现 TypeScript 的 <code>Omit&lt;T, K&gt;</code> 范型。</p>
<p><code>Omit</code> 会创建一个省略 <code>K</code> 中字段的 <code>T</code> 对象。</p>
<p><a href="https://www.typescriptlang.org/docs/handbook/utility-types.html#omittype-keys"><code>Omit&lt;T, K&gt;</code></a>：删除类型中的某个属性来构造一个新类型。</p>
<h4 id="用法-1"><a href="#用法-1" class="headerlink" title="用法"></a>用法</h4><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">type</span> <span class="token class-name">TodoInfo</span> <span class="token operator">=</span> Omit<span class="token operator">&lt;</span>Todo<span class="token punctuation">,</span> <span class="token string">"completed"</span> <span class="token operator">|</span> <span class="token string">"createdAt"</span><span class="token operator">></span><span class="token punctuation">;</span>
 
<span class="token keyword">const</span> todoInfo<span class="token operator">:</span> TodoInfo <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  title<span class="token operator">:</span> <span class="token string">"Pick up kids"</span><span class="token punctuation">,</span>
  description<span class="token operator">:</span> <span class="token string">"Kindergarten closes at 5pm"</span><span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="其他实现方式-1"><a href="#其他实现方式-1" class="headerlink" title="其他实现方式"></a>其他实现方式</h4><p>例如：</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">interface</span> <span class="token class-name">Todo</span> <span class="token punctuation">&#123;</span>
  title<span class="token operator">:</span> <span class="token builtin">string</span>
  description<span class="token operator">:</span> <span class="token builtin">string</span>
  completed<span class="token operator">:</span> <span class="token builtin">boolean</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">type</span> <span class="token class-name">TodoPreview</span> <span class="token operator">=</span> MyOmit<span class="token operator">&lt;</span>Todo<span class="token punctuation">,</span> <span class="token string">'description'</span> <span class="token operator">|</span> <span class="token string">'title'</span><span class="token operator">></span>

<span class="token keyword">const</span> todo<span class="token operator">:</span> TodoPreview <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  completed<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// ====================================================</span>
<span class="token comment">// 实现</span>
<span class="token keyword">type</span> <span class="token class-name">MyOmit<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token punctuation">,</span> <span class="token constant">K</span><span class="token operator">></span></span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  <span class="token punctuation">[</span>key <span class="token keyword">in</span> <span class="token keyword">keyof</span> <span class="token constant">T</span> <span class="token keyword">as</span> Exclude<span class="token operator">&lt;</span>key<span class="token punctuation">,</span> <span class="token constant">K</span><span class="token operator">></span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">[</span>key<span class="token punctuation">]</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>参考链接：<a href="https://www.typescriptlang.org/docs/handbook/2/mapped-types.html#key-remapping-via-as">https://www.typescriptlang.org/docs/handbook/2/mapped-types.html#key-remapping-via-as</a></p>
]]></content>
      <categories>
        <category>前端</category>
        <category>typescript</category>
      </categories>
      <tags>
        <tag>前端</tag>
        <tag>typescript</tag>
        <tag>type challenge</tag>
      </tags>
  </entry>
  <entry>
    <title>typescript系列-typescript入门</title>
    <url>/posts/7a98b4ff/</url>
    <content><![CDATA[<p>官方网站：<a href="https://www.typescriptlang.org/zh/">https://www.typescriptlang.org/zh/</a></p>
<p>官网文档：<a href="https://www.typescriptlang.org/zh/docs/">https://www.typescriptlang.org/zh/docs/</a> 、<a href="https://www.tslang.cn/docs/home.html">https://www.tslang.cn/docs/home.html</a></p>
<p>入门教程：<a href="https://ts.xcatliu.com/">https://ts.xcatliu.com/</a></p>
<p>中文文档：<a href="https://zhongsp.gitbooks.io/typescript-handbook/content/">https://zhongsp.gitbooks.io/typescript-handbook/content/</a></p>
<p>中文手册：<a href="https://typescript.bootcss.com/tutorials/typescript-in-5-minutes.html">https://typescript.bootcss.com/tutorials/typescript-in-5-minutes.html</a></p>
<p>相关文档：</p>
<p>react 支持 ts：<a href="https://typescript.bootcss.com/tutorials/react.html">https://typescript.bootcss.com/tutorials/react.html</a></p>
<p>相关书籍：</p>
<p>深入理解 TypeScript：<a href="https://jkchao.github.io/typescript-book-chinese/#why">https://jkchao.github.io/typescript-book-chinese/#why</a></p>
<p>相关工具：</p>
<p>Typescript AST Viewer：<a href="https://ts-ast-viewer.com/">https://ts-ast-viewer.com/</a></p>
<blockquote>
<p>入门(适合0基础):</p>
<p>typescript in 5 minutes <a href="https://www.typescriptlang.org/docs/handbook/typescript-in-5-minutes.html">https://www.typescriptlang.org/docs/handbook/typescript-in-5-minutes.html</a></p>
<p>进阶(适合有一定基础):</p>
<p>Deep Dive into Typescript(深入理解Typescript) <a href="https://basarat.gitbook.io/typescript/">https://basarat.gitbook.io/typescript/</a> </p>
<p>中文版(可能有些落后):<a href="https://jkchao.github.io/typescript-book-chinese/">https://jkchao.github.io/typescript-book-chinese/</a></p>
<p>在项目中使用ts前必读(不管你有没有基础):</p>
<p>react typescript cheatsheet <a href="https://react-typescript-cheatsheet.netlify.app/docs/basic/setup">https://react-typescript-cheatsheet.netlify.app/docs/basic/setup</a></p>
<p>总结性文章（进阶推荐！！！非常实用）：<a href="https://mp.weixin.qq.com/s/-x8iVK-hlQd3-OZDC04A5A?st=32BEE844941CDACAB34F919763AFACB826804276981245F474E08AA1E4E5DC83797A473EE45DF70F1A67A21A311E2DAA9BBC4D53090A71843825F94B69601DFA26D2A2DF824A689BB0EDD36671A51CCA18F13783C98E1919CB28570FFBAEB64779D1934BBAFC5B48ECC219800979CF1E4DACB35F568EE3C11D5BEE82E5035D1C9F8CEB64693D7FEA19FE0605685EDA9069BD7E32894B76406784D89F671C838B79287745F1FAFB4E7EFF686387D64B56B45CB1F117E15DDDCD823B97065B6821C35FF1B1557E23F6F397D872498DD1925DD6DA74C947FFB59CB89A207AF94628&vid=1688854762253601&cst=E64071BC5FE4E518C8D4162217CCBF77AD14BEA7E1B9EBA1D59BAA191345A80A7AA5D1A3A46C3D9A1D1158802A286092&deviceid=ccf29672-c9e6-473d-9fba-d2697d75fe33&version=3.1.18.70072&platform=mac">TypeScript 类型编程: 从基础到编译器实战 - 抖音前端</a></p>
</blockquote>
<h3 id="TypeScript-是什么"><a href="#TypeScript-是什么" class="headerlink" title="TypeScript 是什么"></a>TypeScript 是什么</h3><p>JavaScript 的超集。TypeScript = JavaScript + 静态类型系统</p>
<p>TypeScript 可以在运行代码之前找到错误并提供修复</p>
<p>TypeScript 是结构类型系统，类型之间的对比只会比较它们最终的结构，而会忽略它们定义时的关系。</p>
<p>需要编译成 JavaScript 才能在浏览器和 node 环境（任何可以运行JavaScript的环境）中运行。</p>
<h4 id="优势"><a href="#优势" class="headerlink" title="优势"></a>优势</h4><ul>
<li>开发过程中及时发现潜在问题</li>
<li>代码语义更清晰易懂</li>
</ul>
<h4 id="解决了"><a href="#解决了" class="headerlink" title="解决了"></a>解决了</h4><p>多人开发时变量类型混乱，语义混乱等问题</p>
<p>在开发过程中无法排查的类型引用等问题</p>
<h3 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h3><ul>
<li>node环境</li>
<li>安装 <code>ts-node</code> (<code>npm i ts-node -g</code>) 对 ts 文件进行编译 <code>tsc xx.ts</code> 和运行 <code>ts-node xx.ts</code></li>
<li>安装 typescript (<code>npm i typescript -g</code>)</li>
<li>配置 <a href="https://www.typescriptlang.org/tsconfig"><code>tsconfig.json</code></a></li>
</ul>
<blockquote>
<p>ts-node 与 tsc （typescript 自带的编译方式）编译的区别</p>
<p>tsc根据 tsconfig 进行编译所有文件，ts-node 将从入口文件开始，并根据导入 / 导出逐步在树中转移文件。</p>
</blockquote>
<h4 id="局部环境"><a href="#局部环境" class="headerlink" title="局部环境"></a>局部环境</h4><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 初始化项目</span>
<span class="token function">npm</span> init <span class="token parameter variable">-y</span>

<span class="token function">yarn</span> <span class="token function">add</span> ts-node typescript <span class="token parameter variable">-D</span>

<span class="token comment"># 初始化ts</span>
npx tsc <span class="token parameter variable">--init</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h4 id="工具"><a href="#工具" class="headerlink" title="工具"></a>工具</h4><p><a href="https://github.com/remy/nodemon"><code>nodemon</code></a>：nodemon是一种工具，可在检测到目录中的文件更改时通过自动重新启动节点应用程序来帮助开发基于node.js的应用程序。</p>
<p><a href="https://github.com/kimmobrunfeldt/concurrently#readme"><code>concurrently</code></a>：并行解决方案。<code>concurrently npm:dev:*</code></p>
<p><a href="https://www.parceljs.cn/"><code>parcel</code></a>：web应用打包工具</p>
<h3 id="常见概念"><a href="#常见概念" class="headerlink" title="常见概念"></a>常见概念</h3><p>静态类型定义：string、number、boolean、object/{}、Array&lt;元素类型&gt;/元素类型[]、any、void。</p>
<p><strong>类型注解</strong>：TypeScript 里的类型注解是一种轻量级的为函数或变量添加约束的方式。 TypeScript提供了静态的代码分析，它可以分析代码结构和提供的类型注解。</p>
<p><strong>类型推断</strong>：TypeScript 会自动进行推断没有定义类型注解的变量类型。</p>
<p><strong>类型保护</strong>：判断数据类型来做相应的操作，方法有：as 断言、in 检查是否存在、typeof 和 instanceof 检查数据类型</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// as 断言</span>
<span class="token comment">// in 方法</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<h4 id="注意点"><a href="#注意点" class="headerlink" title="注意点"></a>注意点</h4><ul>
<li>尽管有错误，<code>js</code>文件还是会被创建了。 </li>
<li>this 没有隐式的 any</li>
</ul>
<h4 id="基础类型"><a href="#基础类型" class="headerlink" title="基础类型"></a>基础类型</h4><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// boolean</span>
<span class="token keyword">let</span> isDone<span class="token operator">:</span> <span class="token builtin">boolean</span> <span class="token operator">=</span> <span class="token boolean">false</span>

<span class="token comment">// number</span>
<span class="token keyword">let</span> num<span class="token operator">:</span> <span class="token builtin">number</span> <span class="token operator">=</span> <span class="token number">1</span>

<span class="token comment">// string</span>
<span class="token keyword">let</span> str<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">=</span> <span class="token string">'xxx'</span>

<span class="token comment">// array</span>
<span class="token keyword">let</span> numList<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span>
<span class="token keyword">let</span> strList<span class="token operator">:</span> <span class="token builtin">Array</span><span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'1'</span><span class="token punctuation">,</span> <span class="token string">'2'</span><span class="token punctuation">]</span>

<span class="token comment">// 元组 tuple: 元组类型允许表示一个已知元素数量和类型的数组，各元素的类型不必相同。</span>
<span class="token comment">// 当访问越界元素，会使用联合类型替代</span>
<span class="token keyword">let</span> arrTuple<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token builtin">number</span><span class="token punctuation">]</span>
arrTuple <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'x'</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span>
arrTuple <span class="token operator">=</span> <span class="token string">'y'</span> <span class="token comment">// true 字符串可以赋值给(string | number)类型</span>

<span class="token comment">// 枚举 enum: enum类型是对JavaScript标准数据类型的一个补充。</span>
<span class="token comment">// 默认情况下，从0开始为元素编号。也可以手动的指定成员的数值。</span>
<span class="token keyword">enum</span> Color <span class="token punctuation">&#123;</span>
    Red<span class="token punctuation">,</span>
    Green
<span class="token punctuation">&#125;</span>
<span class="token keyword">let</span> color<span class="token operator">:</span> Color <span class="token operator">=</span> Color<span class="token punctuation">.</span>Red <span class="token comment">// 0</span>
<span class="token keyword">let</span> colorName<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">=</span> Color<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token comment">// Green</span>

<span class="token comment">// any: 未知类型，可以用来指定动态内容</span>
<span class="token keyword">let</span> anyValue<span class="token operator">:</span> <span class="token builtin">any</span> <span class="token operator">=</span> <span class="token number">4</span>
anyValue <span class="token operator">=</span> <span class="token string">'4'</span>

<span class="token comment">// void: 表示没有任何类型。当一个函数没有返回值时可以使用。</span>
<span class="token keyword">function</span> <span class="token function">warnUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">&#123;</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"This is my warning message"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">let</span> unusable<span class="token operator">:</span> <span class="token keyword">void</span> <span class="token operator">=</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span> <span class="token comment">// 只能赋予undefined和null</span>

<span class="token comment">// null | undefined: 默认情况下null和undefined是所有类型的子类型。 就是说你可以把 null和undefined赋值给number类型的变量。</span>

<span class="token comment">// never: 表示的是那些永不存在的值的类型。</span>
<span class="token comment">// never类型是那些总是会抛出异常或根本就不会有返回值的函数表达式或箭头函数表达式的返回值类型； 变量也可能是 never类型，当它们被永不为真的类型保护所约束时。</span>
<span class="token comment">// never类型是任何类型的子类型，也可以赋值给任何类型；然而，没有类型是never的子类型或可以赋值给never类型（除了never本身之外）。 即使 any也不可以赋值给never。</span>
<span class="token comment">// 返回never的函数必须存在无法达到的终点</span>
<span class="token keyword">function</span> <span class="token function">error</span><span class="token punctuation">(</span>message<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">never</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 推断的返回值类型为never</span>
<span class="token keyword">function</span> <span class="token function">fail</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"Something failed"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 返回never的函数必须存在无法达到的终点</span>
<span class="token keyword">function</span> <span class="token function">infiniteLoop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">never</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// object: 表示非原始类型，也就是除number，string，boolean，symbol，null或undefined之外的类型。</span>
<span class="token comment">// Object类型的变量只是允许你给它赋任意值 - 但是却不能够在它上面调用任意的方法，即便它真的有这些方法。</span>
<span class="token keyword">let</span> prettySure<span class="token operator">:</span> Object <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>
prettySure<span class="token punctuation">.</span><span class="token function">toFixed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Error: Property 'toFixed' doesn't exist on type 'Object'.</span>
<span class="token comment">// 使用object类型，就可以更好的表示像Object.create这样的API。</span>
<span class="token keyword">declare</span> <span class="token keyword">function</span> <span class="token function">create</span><span class="token punctuation">(</span>o<span class="token operator">:</span> object <span class="token operator">|</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
<span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> prop<span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// OK</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h4 id="对象类型"><a href="#对象类型" class="headerlink" title="对象类型"></a>对象类型</h4><h5 id="属性设置"><a href="#属性设置" class="headerlink" title="属性设置"></a>属性设置</h5><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">interface</span> <span class="token class-name">Person</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">readonly</span> id<span class="token operator">:</span> numbser<span class="token punctuation">;</span> <span class="token comment">// 只读项</span>
    name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
    age<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span> <span class="token comment">// 可选项</span>
    <span class="token punctuation">[</span>propName<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">;</span> <span class="token comment">// 表示可以传入其他属性</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>不设置可传入其他属性，当函数传参是对象时，如果传入的是字面量定义的对象则会进行强校验，有多余未注解属性则会报错，而如果是变量定义的对象则不会。</p>
</blockquote>
<h4 id="函数类型"><a href="#函数类型" class="headerlink" title="函数类型"></a>函数类型</h4><h5 id="注解函数参数和返回值类型"><a href="#注解函数参数和返回值类型" class="headerlink" title="注解函数参数和返回值类型"></a>注解函数参数和返回值类型</h5><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 方法一</span>
<span class="token keyword">const</span> func1 <span class="token operator">=</span> <span class="token punctuation">(</span> str<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">number</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">// 方法二</span>
<span class="token keyword">const</span> <span class="token function-variable function">func2</span><span class="token operator">:</span> <span class="token punctuation">(</span> str<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function-variable function">number</span> <span class="token operator">=</span> <span class="token punctuation">(</span>str<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">// 方法三 利用类型推断</span>
<span class="token keyword">const</span> <span class="token function-variable function">func1</span> <span class="token operator">=</span> <span class="token punctuation">(</span> str<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h5 id="使用解构参数"><a href="#使用解构参数" class="headerlink" title="使用解构参数"></a>使用解构参数</h5><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">function</span> <span class="token function">add</span><span class="token punctuation">(</span>
	<span class="token punctuation">&#123;</span> first<span class="token punctuation">,</span> second <span class="token punctuation">&#125;</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> first<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span> second<span class="token operator">:</span> <span class="token builtin">number</span> <span class="token punctuation">&#125;</span>
<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">number</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> first <span class="token operator">+</span> second
<span class="token punctuation">&#125;</span>

<span class="token keyword">const</span> total <span class="token operator">=</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> first<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> second<span class="token operator">:</span> <span class="token number">2</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h5 id="可选参数"><a href="#可选参数" class="headerlink" title="可选参数"></a>可选参数</h5><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">function</span> <span class="token function">buildName</span><span class="token punctuation">(</span>firstName<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> lastName<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>lastName<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> firstName <span class="token operator">+</span> <span class="token string">' '</span> <span class="token operator">+</span> lastName<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> firstName<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">let</span> tomcat <span class="token operator">=</span> <span class="token function">buildName</span><span class="token punctuation">(</span><span class="token string">'Tom'</span><span class="token punctuation">,</span> <span class="token string">'Cat'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> tom <span class="token operator">=</span> <span class="token function">buildName</span><span class="token punctuation">(</span><span class="token string">'Tom'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>可选参数后不能再出现必选参数。</p>
</blockquote>
<h5 id="用接口定义函数"><a href="#用接口定义函数" class="headerlink" title="用接口定义函数"></a>用接口定义函数</h5><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">interface</span> <span class="token class-name">SearchFunc</span> <span class="token punctuation">&#123;</span>
    <span class="token punctuation">(</span>source<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> subString<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">let</span> mySearch<span class="token operator">:</span> SearchFunc<span class="token punctuation">;</span>
<span class="token function-variable function">mySearch</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>source<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> subString<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> source<span class="token punctuation">.</span><span class="token function">search</span><span class="token punctuation">(</span>subString<span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>采用函数表达式|接口定义函数的方式时，对等号左侧进行类型限制，可以保证以后对函数名赋值时保证参数个数、参数类型、返回值类型不变。</p>
<h5 id="重载"><a href="#重载" class="headerlink" title="重载"></a>重载</h5><p>重载允许一个函数接受不同数量或类型的参数时，做出不同的处理。</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">function</span> <span class="token function">reverse</span><span class="token punctuation">(</span>x<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">reverse</span><span class="token punctuation">(</span>x<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">reverse</span><span class="token punctuation">(</span>x<span class="token operator">:</span> <span class="token builtin">number</span> <span class="token operator">|</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">number</span> <span class="token operator">|</span> <span class="token builtin">string</span> <span class="token operator">|</span> <span class="token keyword">void</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> x <span class="token operator">===</span> <span class="token string">'number'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token function">Number</span><span class="token punctuation">(</span>x<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">reverse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> x <span class="token operator">===</span> <span class="token string">'string'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> x<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">reverse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>注意，TypeScript 会优先从最前面的函数定义开始匹配，所以多个函数定义如果有包含关系，需要优先把精确的定义写在前面。</p>
<h4 id="枚举类型（enum）"><a href="#枚举类型（enum）" class="headerlink" title="枚举类型（enum）"></a>枚举类型（enum）</h4><p>枚举（Enum）类型用于取值被限定在一定范围内的场景。</p>
<p>枚举成员会被赋值为从 <code>0</code> 开始递增的数字，同时也会对枚举值到枚举名进行反向映射：</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">enum</span> Days <span class="token punctuation">&#123;</span>Sun<span class="token punctuation">,</span> Mon<span class="token punctuation">,</span> Tue<span class="token punctuation">,</span> Wed<span class="token punctuation">,</span> Thu<span class="token punctuation">,</span> Fri<span class="token punctuation">,</span> Sat<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Days<span class="token punctuation">[</span><span class="token string">"Sun"</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Days<span class="token punctuation">[</span><span class="token string">"Mon"</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Days<span class="token punctuation">[</span><span class="token string">"Tue"</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Days<span class="token punctuation">[</span><span class="token string">"Sat"</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>

<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Days<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string">"Sun"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Days<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string">"Mon"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Days<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string">"Tue"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Days<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string">"Sat"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h4 id="泛型"><a href="#泛型" class="headerlink" title="泛型"></a>泛型</h4><p>参考链接：<a href="https://ts.xcatliu.com/advanced/generics.html">https://ts.xcatliu.com/advanced/generics.html</a></p>
<p>泛型（Generics）是指在定义函数、接口或类的时候，不预先指定具体的类型，而在使用的时候再指定类型的一种特性。</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// T 仅表示占位符 可以使用其他字符表示</span>
<span class="token keyword">function</span> <span class="token generic-function"><span class="token function">createArray</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span></span><span class="token punctuation">(</span>length<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span> value<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Array</span><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">let</span> result<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        result<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> value<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">return</span> result<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token generic-function"><span class="token function">createArray</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">'x'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ['x', 'x', 'x']</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h5 id="约束泛型"><a href="#约束泛型" class="headerlink" title="约束泛型"></a>约束泛型</h5><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 约束泛型</span>
<span class="token keyword">interface</span> <span class="token class-name">WithLength</span> <span class="token punctuation">&#123;</span>
  length<span class="token operator">:</span> <span class="token builtin">number</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">// 使用 extends 进行约束条件</span>
<span class="token keyword">function</span> <span class="token generic-function"><span class="token function">echoWithLength</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token keyword">extends</span> WithLength<span class="token operator">></span></span></span><span class="token punctuation">(</span>arg<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token constant">T</span> <span class="token punctuation">&#123;</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arg<span class="token punctuation">.</span>length<span class="token punctuation">)</span>
  <span class="token keyword">return</span> arg
<span class="token punctuation">&#125;</span>
<span class="token keyword">const</span> str <span class="token operator">=</span> <span class="token function">echoWithLength</span><span class="token punctuation">(</span><span class="token string">'str'</span><span class="token punctuation">)</span>

<span class="token comment">// 在约束泛型中使用类型参数</span>
<span class="token keyword">function</span> <span class="token generic-function"><span class="token function">getProperty</span><span class="token generic class-name"><span class="token operator">&lt;</span>Type<span class="token punctuation">,</span> Key <span class="token keyword">extends</span> <span class="token keyword">keyof</span> Type<span class="token operator">></span></span></span><span class="token punctuation">(</span>obj<span class="token operator">:</span> Type<span class="token punctuation">,</span> key<span class="token operator">:</span> Key<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> obj<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token punctuation">&#123;</span> a<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> b<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> c<span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span> d<span class="token operator">:</span> <span class="token number">4</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token function">getProperty</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token string">"a"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h5 id="函数使用泛型"><a href="#函数使用泛型" class="headerlink" title="函数使用泛型"></a>函数使用泛型</h5><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">function</span> <span class="token generic-function"><span class="token function">identity</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span></span><span class="token punctuation">(</span>arg<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token constant">T</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> arg<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
 
<span class="token keyword">let</span> myIdentity<span class="token operator">:</span> <span class="token operator">&lt;</span>Input<span class="token operator">></span><span class="token punctuation">(</span>arg<span class="token operator">:</span> Input<span class="token punctuation">)</span> <span class="token operator">=></span> Input <span class="token operator">=</span> identity<span class="token punctuation">;</span>

<span class="token comment">// 使用对象声明类型</span>
<span class="token keyword">let</span> myIdentity<span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token operator">&lt;</span>Type<span class="token operator">></span><span class="token punctuation">(</span>arg<span class="token operator">:</span> Type<span class="token punctuation">)</span><span class="token operator">:</span> Type <span class="token punctuation">&#125;</span> <span class="token operator">=</span> identity<span class="token punctuation">;</span>

<span class="token comment">// 使用 interface 声明类型</span>
<span class="token keyword">interface</span> <span class="token class-name">GenericIdentityFn</span> <span class="token punctuation">&#123;</span>
  <span class="token operator">&lt;</span>Type<span class="token operator">></span><span class="token punctuation">(</span>arg<span class="token operator">:</span> Type<span class="token punctuation">)</span><span class="token operator">:</span> Type<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">function</span> <span class="token generic-function"><span class="token function">identity</span><span class="token generic class-name"><span class="token operator">&lt;</span>Type<span class="token operator">></span></span></span><span class="token punctuation">(</span>arg<span class="token operator">:</span> Type<span class="token punctuation">)</span><span class="token operator">:</span> Type <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> arg<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">let</span> myIdentity<span class="token operator">:</span> GenericIdentityFn <span class="token operator">=</span> identity<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h5 id="泛型递归调用"><a href="#泛型递归调用" class="headerlink" title="泛型递归调用"></a>泛型递归调用</h5><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 泛型调用支持递归</span>
<span class="token keyword">type</span> <span class="token class-name">RecursiveGenerics<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span> <span class="token operator">=</span> <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token class-name"><span class="token builtin">string</span></span> <span class="token operator">?</span> <span class="token constant">T</span> <span class="token operator">:</span> RecursiveGenerics<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span><span class="token punctuation">;</span>

<span class="token comment">// 比如类型对象的深度优先遍历、实现循环等等</span>
<span class="token comment">// 例如 斐波那契数列</span>
<span class="token comment">// 辅助函数，暂时不用关心</span>
<span class="token keyword">type</span> <span class="token class-name">NumberToArray<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token punctuation">,</span> <span class="token constant">I</span> <span class="token keyword">extends</span> <span class="token builtin">any</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">></span></span> <span class="token operator">=</span> <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token class-name"><span class="token constant">T</span></span> <span class="token operator">?</span> <span class="token constant">I</span><span class="token punctuation">[</span><span class="token string">'length'</span><span class="token punctuation">]</span> <span class="token keyword">extends</span> <span class="token class-name"><span class="token constant">T</span></span> <span class="token operator">?</span> <span class="token constant">I</span> <span class="token operator">:</span> NumberToArray<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token builtin">any</span><span class="token punctuation">,</span> <span class="token operator">...</span><span class="token constant">I</span><span class="token punctuation">]</span><span class="token operator">></span> <span class="token operator">:</span> <span class="token builtin">never</span><span class="token punctuation">;</span>
<span class="token keyword">type</span> <span class="token class-name">Add<span class="token operator">&lt;</span><span class="token constant">A</span><span class="token punctuation">,</span> <span class="token constant">B</span><span class="token operator">></span></span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">...</span>NumberToArray<span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">...</span>NumberToArray<span class="token operator">&lt;</span><span class="token constant">B</span><span class="token operator">></span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'length'</span><span class="token punctuation">]</span>
<span class="token keyword">type</span> <span class="token class-name">Sub1<span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token builtin">number</span><span class="token operator">></span></span> <span class="token operator">=</span> NumberToArray<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span> <span class="token keyword">extends</span> <span class="token punctuation">[</span><span class="token keyword">infer</span> _<span class="token punctuation">,</span> <span class="token operator">...</span><span class="token keyword">infer</span> <span class="token constant">R</span><span class="token punctuation">]</span> <span class="token operator">?</span> <span class="token constant">R</span><span class="token punctuation">[</span><span class="token string">'length'</span><span class="token punctuation">]</span> <span class="token operator">:</span> <span class="token builtin">never</span><span class="token punctuation">;</span>
<span class="token keyword">type</span> <span class="token class-name">Sub2<span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token builtin">number</span><span class="token operator">></span></span> <span class="token operator">=</span> NumberToArray<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span> <span class="token keyword">extends</span> <span class="token punctuation">[</span><span class="token keyword">infer</span> _<span class="token punctuation">,</span> <span class="token keyword">infer</span> __<span class="token punctuation">,</span> <span class="token operator">...</span><span class="token keyword">infer</span> <span class="token constant">R</span><span class="token punctuation">]</span> <span class="token operator">?</span> <span class="token constant">R</span><span class="token punctuation">[</span><span class="token string">'length'</span><span class="token punctuation">]</span> <span class="token operator">:</span> <span class="token builtin">never</span><span class="token punctuation">;</span>

<span class="token comment">// 计算斐波那契数列 使用条件类型判断边界</span>
<span class="token keyword">type</span> <span class="token class-name">Fibonacci<span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token builtin">number</span><span class="token operator">></span></span> <span class="token operator">=</span> 
  <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token number">1</span> <span class="token operator">?</span> <span class="token number">1</span> <span class="token operator">:</span>
  <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token number">2</span> <span class="token operator">?</span> <span class="token number">1</span> <span class="token operator">:</span>
  Add<span class="token operator">&lt;</span>Fibonacci<span class="token operator">&lt;</span>Sub1<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">>></span><span class="token punctuation">,</span> Fibonacci<span class="token operator">&lt;</span>Sub2<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">>>></span><span class="token punctuation">;</span>
  
  <span class="token keyword">type</span> <span class="token class-name">Fibonacci9</span> <span class="token operator">=</span> Fibonacci<span class="token operator">&lt;</span><span class="token number">9</span><span class="token operator">></span><span class="token punctuation">;</span>
  <span class="token comment">/** 得到结果
  type Fibonacci9 = 34
  */</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>





<h5 id="类使用泛型"><a href="#类使用泛型" class="headerlink" title="类使用泛型"></a>类使用泛型</h5><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 类使用泛型</span>
<span class="token keyword">class</span> <span class="token class-name">Queue<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">private</span> data<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token function">push</span><span class="token punctuation">(</span>item<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span>
  <span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token constant">T</span> <span class="token operator">|</span> <span class="token keyword">undefined</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span><span class="token function">shift</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">const</span> queue <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Queue<span class="token operator">&lt;</span><span class="token builtin">number</span><span class="token operator">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
queue<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>queue<span class="token operator">?.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?.</span><span class="token function">toFixed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>类具有两种类型数据：实例数据和静态数据。泛型只能定义实例数据的类型，静态数据不能使用类的类型参数。</p>
<h5 id="泛型类"><a href="#泛型类" class="headerlink" title="泛型类"></a>泛型类</h5><p>当我们创建一个工厂函数的时候，有必要参考类的构造函数。</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">function</span> <span class="token generic-function"><span class="token function">create</span><span class="token generic class-name"><span class="token operator">&lt;</span>Type<span class="token operator">></span></span></span><span class="token punctuation">(</span>c<span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token keyword">new</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> Type <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token operator">:</span> Type <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">c</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>利用原型属性进行类型推断和约束类的实例属性的类型。</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">class</span> <span class="token class-name">BeeKeeper</span> <span class="token punctuation">&#123;</span>
  hasMask<span class="token operator">:</span> <span class="token builtin">boolean</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
 
<span class="token keyword">class</span> <span class="token class-name">ZooKeeper</span> <span class="token punctuation">&#123;</span>
  nametag<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">=</span> <span class="token string">"Mikle"</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
 
<span class="token keyword">class</span> <span class="token class-name">Animal</span> <span class="token punctuation">&#123;</span>
  numLegs<span class="token operator">:</span> <span class="token builtin">number</span> <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
 
<span class="token keyword">class</span> <span class="token class-name">Bee</span> <span class="token keyword">extends</span> <span class="token class-name">Animal</span> <span class="token punctuation">&#123;</span>
  keeper<span class="token operator">:</span> BeeKeeper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BeeKeeper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
 
<span class="token keyword">class</span> <span class="token class-name">Lion</span> <span class="token keyword">extends</span> <span class="token class-name">Animal</span> <span class="token punctuation">&#123;</span>
  keeper<span class="token operator">:</span> ZooKeeper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ZooKeeper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
 
<span class="token keyword">function</span> <span class="token generic-function"><span class="token function">createInstance</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">A</span> <span class="token keyword">extends</span> Animal<span class="token operator">></span></span></span><span class="token punctuation">(</span>c<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token constant">A</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token constant">A</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">c</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
 
<span class="token function">createInstance</span><span class="token punctuation">(</span>Lion<span class="token punctuation">)</span><span class="token punctuation">.</span>keeper<span class="token punctuation">.</span>nametag<span class="token punctuation">;</span>
<span class="token function">createInstance</span><span class="token punctuation">(</span>Bee<span class="token punctuation">)</span><span class="token punctuation">.</span>keeper<span class="token punctuation">.</span>hasMask<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h4 id="类型断言"><a href="#类型断言" class="headerlink" title="类型断言"></a>类型断言</h4><p>可以用来手动指定一个值的类型。</p>
<p>类型断言只会影响 TypeScript 编译时的类型，类型断言语句在编译结果中会被删除。</p>
<p>形式：</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">let</span> someValue<span class="token operator">:</span> <span class="token builtin">any</span> <span class="token operator">=</span> <span class="token string">"this is a string"</span><span class="token punctuation">;</span>

<span class="token comment">// 形式一 尖括号 语法</span>
<span class="token keyword">let</span> strLength<span class="token operator">:</span> <span class="token builtin">number</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token operator">></span>someValue<span class="token punctuation">)</span><span class="token punctuation">.</span>length<span class="token punctuation">;</span>

<span class="token comment">// 形式二 as 语法 jsx中只能使用这种方式（推荐使用）</span>
<span class="token keyword">let</span> strLength<span class="token operator">:</span> <span class="token builtin">number</span> <span class="token operator">=</span> <span class="token punctuation">(</span>someValue <span class="token keyword">as</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h5 id="应用场景"><a href="#应用场景" class="headerlink" title="应用场景"></a>应用场景</h5><p><strong>将一个联合类型断言为其中一个类型。</strong>要使用联合类型中的某个类型特定的属性时，如果直接判断则会报错，所以可以使用类型断言，断言成有用该特定属性的类型。</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">interface</span> <span class="token class-name">Cat</span> <span class="token punctuation">&#123;</span>
    name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
    <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">interface</span> <span class="token class-name">Fish</span> <span class="token punctuation">&#123;</span>
    name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
    <span class="token function">swim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">function</span> <span class="token function">isFish</span><span class="token punctuation">(</span>animal<span class="token operator">:</span> Cat <span class="token operator">|</span> Fish<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> <span class="token punctuation">(</span>animal <span class="token keyword">as</span> Fish<span class="token punctuation">)</span><span class="token punctuation">.</span>swim <span class="token operator">===</span> <span class="token string">'function'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>类型断言只能够「欺骗」TypeScript 编译器，无法避免运行时的错误，反而滥用类型断言可能会导致运行时错误。</p>
<p>使用类型断言时一定要格外小心，尽量避免断言后调用方法或引用深层属性，以减少不必要的运行时错误。</p>
</blockquote>
<p><strong>将一个父类断言为更加具体的子类。</strong></p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">interface</span> <span class="token class-name">ApiError</span> <span class="token keyword">extends</span> <span class="token class-name">Error</span> <span class="token punctuation">&#123;</span>
    code<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">interface</span> <span class="token class-name">HttpError</span> <span class="token keyword">extends</span> <span class="token class-name">Error</span> <span class="token punctuation">&#123;</span>
    statusCode<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">function</span> <span class="token function">isApiError</span><span class="token punctuation">(</span>error<span class="token operator">:</span> Error<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> <span class="token punctuation">(</span>error <span class="token keyword">as</span> ApiError<span class="token punctuation">)</span><span class="token punctuation">.</span>code <span class="token operator">===</span> <span class="token string">'number'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>将任何一个类型断言为any。</strong></p>
<p>如果向 window 对象上添加一个属性，但是取值的时候 ts 会判断错误，这时可以将 window 临时断言为 any 类型。将一个变量断言为 <code>any</code> 可以说是解决 TypeScript 中类型问题的最后一个手段。</p>
<blockquote>
<p>但是这样会带来一些问题，<strong>一方面不能滥用 <code>as any</code>，它极有可能掩盖了真正的类型错误，所以如果不是非常确定，就不要使用 <code>as any</code>。另一方面也不要完全否定它的作用，我们需要在类型的严格性和开发的便利性之间掌握平衡</strong></p>
</blockquote>
<p><strong>将 any 断言为一个具体的类型。</strong>弥补旧代码中的 any 类型，提高代码的可维护性。</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">function</span> <span class="token function">getCacheData</span><span class="token punctuation">(</span>key<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">any</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>window <span class="token keyword">as</span> <span class="token builtin">any</span><span class="token punctuation">)</span><span class="token punctuation">.</span>cache<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">interface</span> <span class="token class-name">Cat</span> <span class="token punctuation">&#123;</span>
    name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
    <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">const</span> tom <span class="token operator">=</span> <span class="token function">getCacheData</span><span class="token punctuation">(</span><span class="token string">'tom'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> Cat<span class="token punctuation">;</span>
tom<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>以上代码可以使用 泛型 更加规范的约束</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">function</span> <span class="token generic-function"><span class="token function">getCacheData</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span></span><span class="token punctuation">(</span>key<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token constant">T</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>window <span class="token keyword">as</span> <span class="token builtin">any</span><span class="token punctuation">)</span><span class="token punctuation">.</span>cache<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">interface</span> <span class="token class-name">Cat</span> <span class="token punctuation">&#123;</span>
    name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
    <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">const</span> tom <span class="token operator">=</span> <span class="token generic-function"><span class="token function">getCacheData</span><span class="token generic class-name"><span class="token operator">&lt;</span>Cat<span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token string">'tom'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
tom<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</blockquote>
<h5 id="类型断言的限制"><a href="#类型断言的限制" class="headerlink" title="类型断言的限制"></a>类型断言的限制</h5><ul>
<li>联合类型可以被断言为其中一个类型</li>
<li>父类可以被断言为子类</li>
<li>任何类型都可以被断言为 any</li>
<li>any 可以被断言为任何类型</li>
<li>要使得 <code>A</code> 能够被断言为 <code>B</code>，只需要 <code>A</code> 兼容 <code>B</code> 或 <code>B</code> 兼容 <code>A</code> 即可</li>
</ul>
<h5 id="类型断言-amp-类型声明"><a href="#类型断言-amp-类型声明" class="headerlink" title="类型断言 &amp; 类型声明"></a>类型断言 &amp; 类型声明</h5><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">interface</span> <span class="token class-name">Animal</span> <span class="token punctuation">&#123;</span>
    name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">interface</span> <span class="token class-name">Cat</span> <span class="token punctuation">&#123;</span>
    name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
    <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">const</span> animal<span class="token operator">:</span> Animal <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    name<span class="token operator">:</span> <span class="token string">'tom'</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token comment">// 类型断言</span>
<span class="token keyword">let</span> tom <span class="token operator">=</span> animal <span class="token keyword">as</span> Cat<span class="token punctuation">;</span>

<span class="token comment">// 类型声明</span>
<span class="token keyword">let</span> tom<span class="token operator">:</span> Cat <span class="token operator">=</span> animal<span class="token punctuation">;</span>
<span class="token comment">// index.ts:12:5 - error TS2741: Property 'run' is missing in type 'Animal' but required in type 'Cat'.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>核心区别：</p>
<ul>
<li><code>animal</code> 断言为 <code>Cat</code>，只需要满足 <code>Animal</code> 兼容 <code>Cat</code> 或 <code>Cat</code> 兼容 <code>Animal</code> 即可</li>
<li><code>animal</code> 赋值给 <code>tom</code>，需要满足 <code>Cat</code> 兼容 <code>Animal</code> 才行</li>
</ul>
<p>所以，类型声明比类型断言更加严格，因此<strong>优先使用类型声明</strong>。</p>
<h4 id="类型别名"><a href="#类型别名" class="headerlink" title="类型别名"></a><a href="https://www.typescriptlang.org/docs/handbook/2/everyday-types.html#type-aliases">类型别名</a></h4><p>类型别名用来给一个类型起个新名字。</p>
<p>通常注解对象类型和联合类型时使用。</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">type</span> <span class="token class-name">Name</span> <span class="token operator">=</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token keyword">type</span> <span class="token class-name">NameResolver</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token keyword">type</span> <span class="token class-name">NameOrResolver</span> <span class="token operator">=</span> Name <span class="token operator">|</span> NameResolver<span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">getName</span><span class="token punctuation">(</span>n<span class="token operator">:</span> NameOrResolver<span class="token punctuation">)</span><span class="token operator">:</span> Name <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> n <span class="token operator">===</span> <span class="token string">'string'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> n<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token function">n</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 函数</span>
<span class="token keyword">type</span> <span class="token class-name">PlusType</span> <span class="token operator">=</span> <span class="token punctuation">(</span>x<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span> y<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token builtin">number</span>
<span class="token keyword">function</span> <span class="token function">sum</span><span class="token punctuation">(</span>x<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span> y<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token builtin">number</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> x <span class="token operator">+</span> y
<span class="token punctuation">&#125;</span>
<span class="token keyword">const</span> sum2<span class="token operator">:</span> PlusType <span class="token operator">=</span> sum
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>扩展</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">type</span> <span class="token class-name">Animal</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  name<span class="token operator">:</span> <span class="token builtin">string</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">type</span> <span class="token class-name">Bear</span> <span class="token operator">=</span> Animal <span class="token operator">&amp;</span> <span class="token punctuation">&#123;</span> 
  honey<span class="token operator">:</span> <span class="token builtin">boolean</span> 
<span class="token punctuation">&#125;</span>

<span class="token keyword">const</span> bear <span class="token operator">=</span> <span class="token function">getBear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
bear<span class="token punctuation">.</span>name<span class="token punctuation">;</span>
bear<span class="token punctuation">.</span>honey<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h4 id="interface-接口"><a href="#interface-接口" class="headerlink" title="interface 接口"></a>interface 接口</h4><p>在 TypeScript 里，只在两个类型内部的结构兼容那么这两个类型就是兼容的。 这就允许我们在实现接口时候只要保证包含了接口要求的结构就可以，而不必明确地使用 <code>implements</code>语句。</p>
<p>注解对象中的属性或注解函数。</p>
<p>接口之间可以进行继承（extends）。</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">interface</span> <span class="token class-name">Person</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">readonly</span> id<span class="token operator">:</span> numbser<span class="token punctuation">;</span> <span class="token comment">// 只读项</span>
    name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
    age<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span> <span class="token comment">// 可选项</span>
    <span class="token punctuation">[</span>propName<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">;</span> <span class="token comment">// 表示可以传入其他属性 泛匹配</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 扩展</span>
<span class="token keyword">interface</span> <span class="token class-name">Teacher</span> <span class="token keyword">extends</span> <span class="token class-name">Person</span> <span class="token punctuation">&#123;</span>
    <span class="token function">teach</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">interface</span> <span class="token class-name">say</span> <span class="token punctuation">&#123;</span>
    <span class="token punctuation">(</span>word<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h5 id="类型别名（type）-和-interface-的区别"><a href="#类型别名（type）-和-interface-的区别" class="headerlink" title="类型别名（type） 和 interface 的区别"></a><a href="https://www.typescriptlang.org/docs/handbook/2/everyday-types.html#differences-between-type-aliases-and-interfaces">类型别名（type） 和 interface 的区别</a></h5><ul>
<li><p>类型别名可以直接重新定义基础类型名称，而 interface 不可以，只能设置对象类型。</p>
</li>
<li><p>实战中，interface 比类型别名更加常用，如果无法使用 interface，则使用类型别名。</p>
</li>
<li><p>interface 可以重复声明，但是类型别名不能重复声明。</p>
</li>
<li><p>interface 可以进行声明合并，但是类型别名不可以。</p>
</li>
<li><p>interface 只能声明对象属性组成，但是不能声明基本类型。</p>
</li>
</ul>
<h5 id="只能使用-interface-不能使用-type-的情况"><a href="#只能使用-interface-不能使用-type-的情况" class="headerlink" title="只能使用 interface 不能使用 type 的情况"></a>只能使用 interface 不能使用 type 的情况</h5><p>往函数上挂载属性。</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">interface</span> <span class="token class-name">FuncWithAttachment</span> <span class="token punctuation">&#123;</span>
  <span class="token punctuation">(</span>param<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span>
  someProperty<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">const</span> testFunc<span class="token operator">:</span> FuncWithAttachment <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token function">testFunc</span><span class="token punctuation">(</span><span class="token string">'mike'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 有类型提醒</span>
testFunc<span class="token punctuation">.</span>someProperty <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span> <span class="token comment">// 有类型提醒</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h5 id="声明合并"><a href="#声明合并" class="headerlink" title="声明合并"></a>声明合并</h5><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">interface</span> <span class="token class-name">Alarm</span> <span class="token punctuation">&#123;</span>
    price<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">interface</span> <span class="token class-name">Alarm</span> <span class="token punctuation">&#123;</span>
    weight<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 相当于</span>
<span class="token keyword">interface</span> <span class="token class-name">Alarm</span> <span class="token punctuation">&#123;</span>
    price<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
    weight<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>注意：合并的属性的类型必须是唯一的，属性类型不一致</p>
</blockquote>
<h4 id="class-类"><a href="#class-类" class="headerlink" title="class 类"></a>class 类</h4><p><code>implements</code>：class 类应用 interface(接口) 。</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token keyword">implements</span> <span class="token class-name">Person</span> <span class="token punctuation">&#123;</span>
    name <span class="token operator">=</span> <span class="token string">'xx'</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<h5 id="构造函数"><a href="#构造函数" class="headerlink" title="构造函数"></a>构造函数</h5><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 等价于 简化写法</span>
<span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token punctuation">&#123;</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token keyword">public</span> name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h6 id="readonly"><a href="#readonly" class="headerlink" title="readonly"></a>readonly</h6><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">readonly</span> name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span>name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h5 id="抽象类"><a href="#抽象类" class="headerlink" title="抽象类"></a>抽象类</h5><p>abstract 关键字定义抽象类</p>
<p>抽象类只能被继承不能被实例化。子类必须要实现抽象类中定义的抽象方法。</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">Geom</span> <span class="token punctuation">&#123;</span> <span class="token comment">// 定义抽象类</span>
    width<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
    <span class="token function">getType</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token string">'Gemo'</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">abstract</span> <span class="token function">getArea</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span> <span class="token comment">// 定义抽象方法</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">class</span> <span class="token class-name">Circle</span> <span class="token keyword">extends</span> <span class="token class-name">Geom</span> <span class="token punctuation">&#123;</span>
    <span class="token function">getArea</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token number">123</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h5 id="单例模式"><a href="#单例模式" class="headerlink" title="单例模式"></a>单例模式</h5><p>只生成一个对象。</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">class</span> <span class="token class-name">Demo</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> instance<span class="token operator">:</span> Demo<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token keyword">public</span> name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
    
    <span class="token keyword">static</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>instance <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>instance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Demo</span><span class="token punctuation">(</span><span class="token string">'xxxx'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>instance<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 使用</span>
<span class="token keyword">const</span> demo1 <span class="token operator">=</span> Demo<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> demo2 <span class="token operator">=</span> Demo<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>demo1<span class="token punctuation">.</span>name<span class="token punctuation">)</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>demo2<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="类型操作符"><a href="#类型操作符" class="headerlink" title="类型操作符"></a>类型操作符</h3><p>&amp;（对象类型合并）、|（联合类型）</p>
<h4 id="keyof-的使用"><a href="#keyof-的使用" class="headerlink" title="keyof 的使用"></a><a href="https://www.typescriptlang.org/docs/handbook/2/keyof-types.html#handbook-content">keyof 的使用</a></h4><p>获取对象类型的键。结合类型映射会非常好用。</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">interface</span> <span class="token class-name">Person</span> <span class="token punctuation">&#123;</span>
    name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
    age<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
    gender<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">class</span> <span class="token class-name">Teacher</span> <span class="token punctuation">&#123;</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token keyword">private</span> info<span class="token operator">:</span> Person<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
    <span class="token generic-function"><span class="token function">getInfo</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token keyword">keyof</span> Person<span class="token operator">></span></span></span><span class="token punctuation">(</span>key<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">)</span><span class="token operator">:</span> Person<span class="token punctuation">[</span><span class="token constant">T</span><span class="token punctuation">]</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>info<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">// keyof 循环类似于 type类型别名</span>
<span class="token comment">// type T = 'name';</span>
<span class="token comment">// key: 'name';</span>
<span class="token comment">// Person['name'];</span>

<span class="token keyword">type</span> <span class="token class-name">Arrayish</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token punctuation">[</span>n<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token builtin">unknown</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token keyword">type</span> <span class="token class-name"><span class="token constant">A</span></span> <span class="token operator">=</span> <span class="token keyword">keyof</span> Arrayish<span class="token punctuation">;</span>
<span class="token comment">// type A = number;</span>

<span class="token keyword">type</span> <span class="token class-name">Mapish</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token punctuation">[</span>k<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token builtin">boolean</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token keyword">type</span> <span class="token class-name"><span class="token constant">M</span></span> <span class="token operator">=</span> <span class="token keyword">keyof</span> Mapish<span class="token punctuation">;</span>
<span class="token comment">// type M = string | number;</span>

<span class="token comment">// ===================================</span>
<span class="token keyword">type</span> <span class="token class-name">t<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span> <span class="token operator">=</span> <span class="token keyword">keyof</span> <span class="token constant">T</span><span class="token punctuation">;</span>

<span class="token keyword">interface</span> <span class="token class-name">Test</span> <span class="token punctuation">&#123;</span>
  a<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  b<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">type</span> <span class="token class-name">TestType</span> <span class="token operator">=</span> t<span class="token operator">&lt;</span>Test<span class="token operator">></span><span class="token punctuation">;</span> <span class="token comment">// type TestType = 'a' | 'b'</span>

<span class="token keyword">const</span> test<span class="token operator">:</span> TestType <span class="token operator">=</span> <span class="token string">'a'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>注意 keyof 只能对类型使用，如果想要对值使用，需要先使用 typeof 获取类型。</p>
</blockquote>
<h4 id="typeof-关键字"><a href="#typeof-关键字" class="headerlink" title="typeof 关键字"></a><a href="https://www.typescriptlang.org/docs/handbook/2/typeof-types.html#handbook-content">typeof 关键字</a></h4><p>获取值的类型。</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">const</span> Test <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  a<span class="token operator">:</span> <span class="token string">'1'</span><span class="token punctuation">,</span>
  b<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">type</span> <span class="token class-name">TestType</span> <span class="token operator">=</span> <span class="token keyword">typeof</span> Test<span class="token punctuation">;</span>

<span class="token keyword">const</span> test<span class="token operator">:</span> TestType <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  a<span class="token operator">:</span> <span class="token string">'3'</span><span class="token punctuation">,</span>
  b<span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token comment">// 搭配 ReturnType&lt;T> 使用</span>
<span class="token keyword">function</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token punctuation">&#123;</span> x<span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span> y<span class="token operator">:</span> <span class="token number">3</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">type</span> <span class="token class-name"><span class="token constant">P</span></span> <span class="token operator">=</span> ReturnType<span class="token operator">&lt;</span><span class="token keyword">typeof</span> f<span class="token operator">></span><span class="token punctuation">;</span> 
    <span class="token comment">// type P = &#123;</span>
    <span class="token comment">//     x: number;</span>
    <span class="token comment">//     y: number;</span>
    <span class="token comment">// &#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>注意对于 <code>enum</code> 需要先进行 <code>typeof</code> 操作获取类型，才能通过 <code>keyof</code> 等类型操作完成正确的类型计算（因为 enum 可以是类型也可以是值，如果不使用 typeof 会当值计算）:</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">enum</span> <span class="token constant">E1</span> <span class="token punctuation">&#123;</span>
  <span class="token constant">A</span><span class="token punctuation">,</span>
  <span class="token constant">B</span><span class="token punctuation">,</span>
  <span class="token constant">C</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">type</span> <span class="token class-name"><span class="token constant">TE1</span></span> <span class="token operator">=</span> <span class="token keyword">keyof</span> <span class="token constant">E1</span><span class="token punctuation">;</span>
<span class="token comment">/**
拿到的是错误的类型
type TE1 = "toString" | "toFixed" | "toExponential" | "toPrecision" | "valueOf" | "toLocaleString"
*/</span>

<span class="token keyword">type</span> <span class="token class-name"><span class="token constant">TE2</span></span> <span class="token operator">=</span> <span class="token keyword">keyof</span> <span class="token keyword">typeof</span> <span class="token constant">E1</span><span class="token punctuation">;</span>
<span class="token comment">/**
拿到的是正确的类型
type TE2 = "A" | "B" | "C"
*/</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</blockquote>
<h4 id="获取类型中的某个属性类型"><a href="#获取类型中的某个属性类型" class="headerlink" title="获取类型中的某个属性类型"></a><a href="https://www.typescriptlang.org/docs/handbook/2/indexed-access-types.html">获取类型中的某个属性类型</a></h4><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 常规用法</span>
<span class="token keyword">type</span> <span class="token class-name">Person</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span> age<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span> name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span> alive<span class="token operator">:</span> <span class="token builtin">boolean</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span> <span class="token comment">// 换成 interfafce 也适用</span>
<span class="token keyword">type</span> <span class="token class-name">Age</span> <span class="token operator">=</span> Person<span class="token punctuation">[</span><span class="token string">"age"</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// type Age = number;</span>

<span class="token comment">// 使用 union / keyof / others type</span>
<span class="token class-name"><span class="token keyword">type</span></span> <span class="token constant">I1</span> <span class="token operator">=</span> Person<span class="token punctuation">[</span><span class="token string">"age"</span> <span class="token operator">|</span> <span class="token string">"name"</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// type I1 = string | number</span>
 
<span class="token keyword">type</span> <span class="token class-name"><span class="token constant">I2</span></span> <span class="token operator">=</span> Person<span class="token punctuation">[</span><span class="token keyword">keyof</span> Person<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// type I2 = string | number | boolean</span>
 
<span class="token keyword">type</span> <span class="token class-name">AliveOrName</span> <span class="token operator">=</span> <span class="token string">"alive"</span> <span class="token operator">|</span> <span class="token string">"name"</span><span class="token punctuation">;</span>
<span class="token keyword">type</span> <span class="token class-name"><span class="token constant">I3</span></span> <span class="token operator">=</span> Person<span class="token punctuation">[</span>AliveOrName<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// type I3 = boolean ｜ string</span>

<span class="token comment">// 使用 typeof 数字 获取数组中的子元素类型</span>
<span class="token keyword">const</span> MyArray <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token punctuation">&#123;</span> name<span class="token operator">:</span> <span class="token string">"Alice"</span><span class="token punctuation">,</span> age<span class="token operator">:</span> <span class="token number">15</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token punctuation">&#123;</span> name<span class="token operator">:</span> <span class="token string">"Bob"</span><span class="token punctuation">,</span> age<span class="token operator">:</span> <span class="token number">23</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token punctuation">&#123;</span> name<span class="token operator">:</span> <span class="token string">"Eve"</span><span class="token punctuation">,</span> age<span class="token operator">:</span> <span class="token number">38</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
 
<span class="token keyword">type</span> <span class="token class-name">Person</span> <span class="token operator">=</span> <span class="token keyword">typeof</span> MyArray<span class="token punctuation">[</span><span class="token builtin">number</span><span class="token punctuation">]</span><span class="token punctuation">;</span>      
<span class="token comment">// type Person = &#123;</span>
<span class="token comment">//     name: string;</span>
<span class="token comment">//     age: number;</span>
<span class="token comment">// &#125;</span>
<span class="token keyword">type</span> <span class="token class-name">Age</span> <span class="token operator">=</span> <span class="token keyword">typeof</span> MyArray<span class="token punctuation">[</span><span class="token builtin">number</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"age"</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// type Age = number</span>
<span class="token keyword">type</span> <span class="token class-name">Age2</span> <span class="token operator">=</span> Person<span class="token punctuation">[</span><span class="token string">"age"</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// type Age2 = number</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h4 id="in-遍历对象键值"><a href="#in-遍历对象键值" class="headerlink" title="in 遍历对象键值"></a>in 遍历对象键值</h4><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 下述示例遍历 '1' | '2' | 3' 三个值，然后依次赋值给 K，K 作为一个临时的类型变量可以在后面直接使用 </span>
<span class="token comment">/**
下述示例最终的计算结果是：
type MyType = &#123;
    1: "1";
    2: "2";
    3: "3";
&#125;
因为 K 类型变量的值在每次遍历中依次是 '1', '2', '3' 所以每次遍历时对象的键和值分别是 &#123; '1': '2' &#125; &#123; '2': '2' &#125; 和 &#123; '3': '3' &#125;，
最终结果是这个三个结果取 &amp;
*/</span>
<span class="token keyword">type</span> <span class="token class-name">MyType</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  <span class="token comment">// 注意能遍历的类型只有 string、number、symbol，也就是对象键允许的类型</span>
  <span class="token punctuation">[</span><span class="token constant">K</span> <span class="token keyword">in</span> <span class="token string">'1'</span> <span class="token operator">|</span> <span class="token string">'2'</span> <span class="token operator">|</span> <span class="token string">'3'</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token constant">K</span> 
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>[in] 常常和 keyof 搭配使用，遍历某一个对象的键，做相应的计算后得到新的类型，如下：</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">type</span> <span class="token class-name">Obj</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  a<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  b<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">/**
遍历 Obj 的所有键，然后将所有键对应的值的类型改成 boolean | K，返回结果如下：
type MyObj = &#123;
    a: boolean | "a";
    b: boolean | "b";
&#125;
这样我们就实现了给 Obj 的所有值的类型加上 | boolean 的效果
*/</span>
<span class="token keyword">type</span> <span class="token class-name">MyObj</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  <span class="token punctuation">[</span><span class="token constant">K</span> <span class="token keyword">in</span> <span class="token keyword">keyof</span> Obj<span class="token punctuation">]</span><span class="token operator">:</span> <span class="token builtin">boolean</span> <span class="token operator">|</span> <span class="token constant">K</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>in 后面还可以接 as，as 后面可以接类型表达式（文档：<a href="https://www.typescriptlang.org/docs/handbook/2/mapped-types.html#key-remapping-via-as%EF%BC%89">https://www.typescriptlang.org/docs/handbook/2/mapped-types.html#key-remapping-via-as）</a></p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">type</span> <span class="token class-name">Getters<span class="token operator">&lt;</span>Type<span class="token operator">></span></span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    <span class="token punctuation">[</span>Property <span class="token keyword">in</span> <span class="token keyword">keyof</span> Type <span class="token keyword">as</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">get</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>Capitalize<span class="token operator">&lt;</span>string <span class="token operator">&amp;</span> Property<span class="token operator">></span><span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> Type<span class="token punctuation">[</span>Property<span class="token punctuation">]</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>



<h4 id="条件语句"><a href="#条件语句" class="headerlink" title="条件语句"></a>条件语句</h4><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 条件表达式 类型表达式1 extends 类型表达式2 ？ 类型表达式 : 类型表达式</span>
SomeType <span class="token keyword">extends</span> <span class="token class-name">OtherType</span> <span class="token operator">?</span> TrueType <span class="token operator">:</span> FalseType<span class="token punctuation">;</span>

<span class="token comment">// 使用 泛型 进行扩展</span>
<span class="token keyword">type</span> <span class="token class-name">NameOrId<span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token builtin">number</span> <span class="token operator">|</span> <span class="token builtin">string</span><span class="token operator">></span></span> <span class="token operator">=</span> <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token class-name"><span class="token builtin">number</span></span>
  <span class="token operator">?</span> IdLabel
  <span class="token operator">:</span> NameLabel<span class="token punctuation">;</span>

<span class="token comment">// 条件类型约束</span>
<span class="token keyword">type</span> <span class="token class-name">MessageOf<span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token punctuation">&#123;</span> message<span class="token operator">:</span> <span class="token builtin">unknown</span> <span class="token punctuation">&#125;</span><span class="token operator">></span></span> <span class="token operator">=</span> <span class="token constant">T</span><span class="token punctuation">[</span><span class="token string">"message"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
 
<span class="token keyword">interface</span> <span class="token class-name">Email</span> <span class="token punctuation">&#123;</span>
  message<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
 
<span class="token keyword">type</span> <span class="token class-name">EmailMessageContents</span> <span class="token operator">=</span> MessageOf<span class="token operator">&lt;</span>Email<span class="token operator">></span><span class="token punctuation">;</span> <span class="token comment">// type EmailMessageContents = string</span>

<span class="token comment">// 移动约束 和 条件约束</span>
<span class="token keyword">type</span> <span class="token class-name">MessageOf<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span> <span class="token operator">=</span> <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token punctuation">&#123;</span> message<span class="token operator">:</span> <span class="token builtin">unknown</span> <span class="token punctuation">&#125;</span> <span class="token operator">?</span> <span class="token constant">T</span><span class="token punctuation">[</span><span class="token string">"message"</span><span class="token punctuation">]</span> <span class="token operator">:</span> <span class="token builtin">never</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h5 id="Flatten"><a href="#Flatten" class="headerlink" title="Flatten"></a>Flatten</h5><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">type</span> <span class="token class-name">Flatten<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span> <span class="token operator">=</span> <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token class-name"><span class="token builtin">any</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">?</span> <span class="token constant">T</span><span class="token punctuation">[</span><span class="token builtin">number</span><span class="token punctuation">]</span> <span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">;</span>
 
<span class="token comment">// Extracts out the element type.</span>
<span class="token keyword">type</span> <span class="token class-name">Str</span> <span class="token operator">=</span> Flatten<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">></span><span class="token punctuation">;</span> <span class="token comment">// type Str = string</span>
 
<span class="token comment">// Leaves the type alone.</span>
<span class="token keyword">type</span> <span class="token class-name">Num</span> <span class="token operator">=</span> Flatten<span class="token operator">&lt;</span><span class="token builtin">number</span><span class="token operator">></span><span class="token punctuation">;</span> <span class="token comment">// type Num = number</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h5 id="推断扁平的数据类型"><a href="#推断扁平的数据类型" class="headerlink" title="推断扁平的数据类型"></a>推断扁平的数据类型</h5><p>改进上一步 flatten</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">type</span> <span class="token class-name">Flatten<span class="token operator">&lt;</span>Type<span class="token operator">></span></span> <span class="token operator">=</span> Type <span class="token keyword">extends</span> <span class="token class-name"><span class="token builtin">Array</span><span class="token operator">&lt;</span><span class="token keyword">infer</span> Item<span class="token operator">></span></span> <span class="token operator">?</span> Item <span class="token operator">:</span> Type<span class="token punctuation">;</span>
<span class="token keyword">type</span> <span class="token class-name"><span class="token constant">T</span></span> <span class="token operator">=</span> Flatten<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">></span><span class="token punctuation">;</span> 
<span class="token comment">/* T = string, 因为推断出 string[] = Array&lt;string>，所以 Item = string，类型返回 Item */</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>注意：infer 只能在条件类型里面使用</p>
</blockquote>
<h4 id="infer-推断类型"><a href="#infer-推断类型" class="headerlink" title="infer 推断类型"></a>infer 推断类型</h4><blockquote>
<p>infer 关键词：<a href="https://www.typescriptlang.org/docs/handbook/2/conditional-types.html#inferring-within-conditional-types">https://www.typescriptlang.org/docs/handbook/2/conditional-types.html#inferring-within-conditional-types</a></p>
</blockquote>
<p>可以使用 infer 关键字推断条件类型中的某一个条件类型，然后将该类型赋值给一个临时的类型变量。<br>类型推断可以用于 extends 后任何可以使用类型表达式的位置。</p>
<p>可以通过 infer 关键字实现很多内置类型的操作：</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 自动推断参数 P 的类型，如果是则泛型返回值是 P</span>
<span class="token keyword">type</span> <span class="token class-name">MyParameters<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span> <span class="token operator">=</span> <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token operator">:</span> <span class="token keyword">infer</span> <span class="token constant">P</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token builtin">any</span> <span class="token operator">?</span> <span class="token constant">P</span> <span class="token operator">:</span> <span class="token builtin">never</span><span class="token punctuation">;</span>
<span class="token comment">/**
推断参数的类型成功
type Params = [a: string, b: number]
*/</span>
<span class="token keyword">type</span> <span class="token class-name">Params</span> <span class="token operator">=</span> MyParameters<span class="token operator">&lt;</span><span class="token punctuation">(</span>a<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> b<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">void</span><span class="token operator">></span><span class="token punctuation">;</span>

<span class="token comment">// 同样的方式，我们可以推断 ReturnType</span>
<span class="token keyword">type</span> <span class="token class-name">MyReturnType<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span> <span class="token operator">=</span> <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">infer</span> <span class="token constant">R</span> <span class="token operator">?</span> <span class="token constant">R</span> <span class="token operator">:</span> <span class="token builtin">never</span><span class="token punctuation">;</span>
<span class="token comment">/**
团队返回值的类型成功
type Ret = void
*/</span>
<span class="token keyword">type</span> <span class="token class-name">Ret</span> <span class="token operator">=</span> MyReturnType<span class="token operator">&lt;</span><span class="token punctuation">(</span>a<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> b<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">void</span><span class="token operator">></span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>infer 还可以和元组或者模版字符串结合：</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 计算元组中的第一个元素</span>
<span class="token keyword">type</span> <span class="token class-name">Head<span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token builtin">any</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">></span></span> <span class="token operator">=</span> <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token punctuation">[</span><span class="token keyword">infer</span> <span class="token constant">F</span><span class="token punctuation">,</span> <span class="token operator">...</span><span class="token keyword">infer</span> <span class="token constant">R</span><span class="token punctuation">]</span> <span class="token operator">?</span> <span class="token constant">F</span> <span class="token operator">:</span> <span class="token builtin">never</span><span class="token punctuation">;</span>

<span class="token comment">// 解析 `1 + 2 + 3` 形式的字符串，并返回 AST</span>
<span class="token comment">// T extends $&#123;infer ExpressionA&#125; + $&#123;infer ExpressionB&#125;，如果字符串满足 A + B 的模式，即可通过 infer 推断出 A 和 B 的字符串</span>
<span class="token keyword">type</span> <span class="token class-name">Parse<span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token builtin">string</span><span class="token operator">></span></span> <span class="token operator">=</span> <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span><span class="token keyword">infer</span> ExpressionA<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string"> + </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span><span class="token keyword">infer</span> ExpressionB<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span> <span class="token operator">?</span> <span class="token punctuation">&#123;</span>
  type<span class="token operator">:</span> <span class="token string">'operator'</span><span class="token punctuation">,</span>
  left<span class="token operator">:</span> Parse<span class="token operator">&lt;</span>ExpressionA<span class="token operator">></span><span class="token punctuation">,</span>
  right<span class="token operator">:</span> Parse<span class="token operator">&lt;</span>ExpressionB<span class="token operator">></span>
<span class="token punctuation">&#125;</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
  type<span class="token operator">:</span> <span class="token string">'expression'</span><span class="token punctuation">,</span>
  value<span class="token operator">:</span> <span class="token constant">T</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="进阶"><a href="#进阶" class="headerlink" title="进阶"></a>进阶</h3><h4 id="动态扩展类型变量"><a href="#动态扩展类型变量" class="headerlink" title="动态扩展类型变量"></a>动态扩展类型变量</h4><p>T 中可保存上一次调用 option 后的值，然后通过类型递归，扩展 T 的类型，当最后调用 get() 时，拿到的就是扩展后的 T 的类型：</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">type</span> <span class="token class-name">Chainable<span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token operator">></span></span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  <span class="token generic-function"><span class="token function">option</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">K</span> <span class="token keyword">extends</span> <span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token constant">V</span> <span class="token keyword">extends</span> <span class="token builtin">any</span><span class="token operator">></span></span></span><span class="token punctuation">(</span>key<span class="token operator">:</span> <span class="token constant">K</span><span class="token punctuation">,</span> value<span class="token operator">:</span> <span class="token constant">V</span><span class="token punctuation">)</span><span class="token operator">:</span> Chainable<span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token operator">&amp;</span> <span class="token punctuation">&#123;</span> <span class="token punctuation">[</span>key <span class="token keyword">in</span> <span class="token constant">K</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token constant">V</span> <span class="token punctuation">&#125;</span><span class="token operator">></span>
  <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token constant">T</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>使用了<strong>默认泛型</strong> + <strong>递归</strong>两个特性，利用递归保存上下文，就可以实现对已有类型变量的扩展。</p>
<p>利用这个特性可以保存链式调用中的上下文。</p>
<h4 id="动态更改对象类型的-key"><a href="#动态更改对象类型的-key" class="headerlink" title="动态更改对象类型的 key"></a>动态更改对象类型的 key</h4><p>通过 <code>key in keyof T as xxx</code>形式可以重写 key。可以通过这种形式来实现动态更改对象类型的 key，比如实现 <code>OptionalKeys</code> 或者 <code>RequiresKeys</code> 或者 <code>ReadonlyKeys</code>。</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">type</span> <span class="token class-name">IsOptional<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token punctuation">,</span> <span class="token constant">K</span> <span class="token keyword">extends</span> <span class="token keyword">keyof</span> <span class="token constant">T</span><span class="token operator">></span></span> <span class="token operator">=</span> Partial<span class="token operator">&lt;</span>Pick<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token punctuation">,</span> <span class="token constant">K</span><span class="token operator">>></span> <span class="token keyword">extends</span> <span class="token class-name">Pick<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token punctuation">,</span> <span class="token constant">K</span><span class="token operator">></span></span> <span class="token operator">?</span> <span class="token boolean">true</span> <span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

<span class="token keyword">type</span> <span class="token class-name">OptionalKeys<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span> <span class="token operator">=</span> <span class="token keyword">keyof</span> <span class="token punctuation">&#123;</span>
  <span class="token punctuation">[</span><span class="token constant">K</span> <span class="token keyword">in</span> <span class="token keyword">keyof</span> <span class="token constant">T</span> <span class="token keyword">as</span> IsOptional<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token punctuation">,</span> <span class="token constant">K</span><span class="token operator">></span> <span class="token keyword">extends</span> <span class="token class-name"><span class="token boolean">true</span></span> <span class="token operator">?</span> <span class="token constant">K</span> <span class="token operator">:</span> <span class="token builtin">never</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">[</span><span class="token constant">K</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token keyword">type</span> <span class="token class-name">RequiredKeys<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  <span class="token punctuation">[</span><span class="token constant">K</span> <span class="token keyword">in</span> <span class="token keyword">keyof</span> <span class="token constant">T</span><span class="token punctuation">]</span><span class="token operator">:</span> IsOptional<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token punctuation">,</span> <span class="token constant">K</span><span class="token operator">></span> <span class="token keyword">extends</span> <span class="token class-name"><span class="token boolean">true</span></span> <span class="token operator">?</span> <span class="token builtin">never</span> <span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">[</span><span class="token constant">K</span><span class="token punctuation">]</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>这里注意 as 后面可以接一个类型表达式，我们可以通过临时变量 K 以及辅助的类型表达式，实现对键的复杂的操作，比如增加、删除特定的键，将特定的键标记为可选，将特定的键标记为 readonly 等等。</p>
<blockquote>
<p>上述根据条件将 K 的类型重写为 never 可以去掉该 key，但是注意将值的返回类型设置成 never 是无法更改 key 的数量的，如下：</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">type</span> <span class="token class-name">RequiredKeys<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  <span class="token punctuation">[</span><span class="token constant">K</span> <span class="token keyword">in</span> <span class="token keyword">keyof</span> <span class="token constant">T</span><span class="token punctuation">]</span><span class="token operator">:</span> IsOptional<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token punctuation">,</span> <span class="token constant">K</span><span class="token operator">></span> <span class="token keyword">extends</span> <span class="token class-name"><span class="token boolean">true</span></span> <span class="token operator">?</span> <span class="token builtin">never</span> <span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">[</span><span class="token constant">K</span><span class="token punctuation">]</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>返回的 never 值将会变为 undefined。</p>
</blockquote>
<h4 id="构造器"><a href="#构造器" class="headerlink" title="构造器"></a>构造器</h4><p>文档：<a href="https://www.tslang.cn/docs/handbook/decorators.html">https://www.tslang.cn/docs/handbook/decorators.html</a></p>
<p>属性构造器，可以返回一个 <code>propertyDescriptor</code> 去修改属性的读写能力。</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">function</span> <span class="token function">nameDecorator</span><span class="token punctuation">(</span>target<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">,</span> key<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">any</span> <span class="token punctuation">&#123;</span> 
    <span class="token comment">// 返回值必须是 void 或 any</span>
    <span class="token comment">// target指向的是类的原型prototype 而不是实例 无法对属性值做修改</span>
    <span class="token keyword">const</span> descriptor<span class="token operator">:</span> PropertyDescriptor <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
        writable<span class="token operator">:</span> <span class="token boolean">false</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">return</span> descriptor
<span class="token punctuation">&#125;</span>

<span class="token keyword">class</span> <span class="token class-name">Test</span> <span class="token punctuation">&#123;</span>
    <span class="token decorator"><span class="token at operator">@</span><span class="token function">nameDecorator</span></span>
    name <span class="token operator">=</span> <span class="token string">'xxx'</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">const</span> test <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h4 id="reflect-拦截"><a href="#reflect-拦截" class="headerlink" title="reflect 拦截"></a>reflect 拦截</h4><p>Reflect Metadata 是 ES7 的一个提案，它主要用来在声明的时候添加和读取元数据。TypeScript 在 1.5+ 的版本已经支持它。</p>
<p>使用库：<a href="https://github.com/rbuckton/reflect-metadata">reflect-metadata</a></p>
<p>参考文章：</p>
<p><a href="https://juejin.cn/post/6844904152812748807">https://juejin.cn/post/6844904152812748807</a></p>
<p><a href="https://jkchao.github.io/typescript-book-chinese/tips/metadata.html">https://jkchao.github.io/typescript-book-chinese/tips/metadata.html</a></p>
<h4 id="声明文件"><a href="#声明文件" class="headerlink" title="声明文件"></a>声明文件</h4><p>参考文章：<a href="https://ts.xcatliu.com/basics/declaration-files.html">https://ts.xcatliu.com/basics/declaration-files.html</a></p>
<p>当使用第三方库时，我们需要引用它的声明文件，才能获得对应的代码补全、接口提示等功能。</p>
<p>xxx.d.ts</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 定义全局变量</span>
<span class="token keyword">declare</span> <span class="token keyword">var</span> <span class="token function-variable function">$</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token function-variable function">params</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">void</span><span class="token punctuation">;</span>

<span class="token comment">// 定义全局函数</span>
<span class="token keyword">interface</span> <span class="token class-name">JqueryInstance</span> <span class="token punctuation">&#123;</span>
    <span class="token function-variable function">html</span><span class="token operator">:</span> <span class="token punctuation">(</span>html<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token operator">=></span> JqueryInstance<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">// 函数重载</span>
<span class="token keyword">declare</span> <span class="token keyword">function</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token function-variable function">readyFunc</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">void</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
<span class="token keyword">declare</span> <span class="token keyword">function</span> <span class="token function">$</span><span class="token punctuation">(</span>selector<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> JqueryInstance<span class="token punctuation">;</span>
<span class="token comment">// 对对象进行类型定义，以及对类进行类型定义、命名空间的嵌套  [使用$.fn.init()]</span>
<span class="token keyword">declare</span> <span class="token keyword">namespace</span> $ <span class="token punctuation">&#123;</span>
    <span class="token keyword">namespace</span> fn <span class="token punctuation">&#123;</span>
        <span class="token keyword">class</span> <span class="token class-name">init</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 使用 interface 实现函数重载</span>
<span class="token keyword">interface</span> <span class="token class-name">Jquery</span> <span class="token punctuation">&#123;</span>
    <span class="token punctuation">(</span><span class="token function-variable function">readyFunc</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">void</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
    <span class="token punctuation">(</span>selector<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> JqueryInstance<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">declare</span> <span class="token keyword">var</span> $<span class="token operator">:</span> Jquery<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>ES6 module处理</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">declare</span> <span class="token keyword">module</span> <span class="token string">'jquery'</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">interface</span> <span class="token class-name">JqueryInstance</span> <span class="token punctuation">&#123;</span>
        <span class="token function-variable function">html</span><span class="token operator">:</span> <span class="token punctuation">(</span>html<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token operator">=></span> JqueryInstance<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token comment">// 混合类型</span>
    <span class="token keyword">function</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token function-variable function">readyFunc</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">void</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
    <span class="token keyword">function</span> <span class="token function">$</span><span class="token punctuation">(</span>selector<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> JqueryInstance<span class="token punctuation">;</span>
    <span class="token keyword">namespace</span> $ <span class="token punctuation">&#123;</span>
        <span class="token keyword">namespace</span> fn <span class="token punctuation">&#123;</span>
            <span class="token keyword">class</span> <span class="token class-name">init</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
        
    <span class="token keyword">export</span> <span class="token operator">=</span> $<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><ul>
<li><code>noImplicitReturns</code> ：会防止你忘记在函数末尾返回值。</li>
<li><code>noFallthroughCasesInSwitch</code> ：会防止在<code>switch</code>代码块里的两个<code>case</code>之间忘记添加<code>break</code>语句。</li>
<li><code>noImplicitAny</code> ：防止将没有明确指定的类型默默地推断为 <code>any</code>类型。</li>
<li><code>noEmitOnError</code> ：</li>
</ul>
<p>TypeScript还能发现那些执行不到的代码和标签，你可以通过设置<code>allowUnreachableCode</code>和<code>allowUnusedLabels</code>选项来禁用。</p>
<h3 id="实战"><a href="#实战" class="headerlink" title="实战"></a>实战</h3><h4 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h4><ul>
<li><strong>应该聪明地使用类型断言（as）</strong> <ul>
<li>什么时候应该使用as：当我比ts编译器能够更精确地确定类型的时候(最好使用type guards)</li>
<li>什么时候不应该使用as：当我也不知道咋回事，只是想让ts类型检查不报错的时候</li>
</ul>
</li>
<li><strong>好的typescrip代码是不怎么需要写类型的，要充分利用typescript的类型推导能力（流动的类型）</strong></li>
<li><strong>好的typescript代码是不需要写各种判断的，要充分利用typescript的类型组合能力，也就是所谓的：好的类型应该是更紧的类型</strong></li>
</ul>
<h4 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h4><h5 id="类型描述文件"><a href="#类型描述文件" class="headerlink" title="类型描述文件"></a>类型描述文件</h5><p>当 ts 文件引入 <code>js</code> 库时，需要使用 <code>.d.ts</code> 翻译文件。翻译文件会帮助 ts 文件引入 js 文件。</p>
<p>安装 .d.ts 文件，<code>npm i @types/xxx -D</code></p>
<h5 id="类型描述文件不准确"><a href="#类型描述文件不准确" class="headerlink" title="类型描述文件不准确"></a>类型描述文件不准确</h5><p>使用 interface extends 方法进行扩展属性。</p>
<h5 id="如何动态改变数据类型"><a href="#如何动态改变数据类型" class="headerlink" title="如何动态改变数据类型"></a>如何动态改变数据类型</h5><p>如使用 express 中间件对 require 和 response 做了修改，但是在初始声明类型时是 express 自带的类型，没有新增的属性声明。</p>
<p>使用类型融合的方法，创建一个新的 <code>.d.ts</code> 文件扩展原框架中的类型定义，ts 底层会自动进行 mixin。</p>
<h5 id="关于使用-interface-还是-type"><a href="#关于使用-interface-还是-type" class="headerlink" title="关于使用 interface 还是 type"></a>关于使用 interface 还是 type</h5><p>Use Interface until You Need Type - <a href="https://twitter.com/orta/status/1356129195835973632?s=20">orta</a>.</p>
<h6 id="More-Advice"><a href="#More-Advice" class="headerlink" title="More Advice"></a><a href="https://react-typescript-cheatsheet.netlify.app/docs/basic/getting-started/basic_type_example/#more-advice">More Advice</a></h6><p>Here’s a helpful rule of thumb:</p>
<ul>
<li>always use <code>interface</code> for public API’s definition when authoring a library or 3rd party ambient type definitions, as this allows a consumer to extend them via <em>declaration merging</em> if some definitions are missing.</li>
<li>consider using <code>type</code> for your React Component Props and State, for consistency and because it is more constrained.</li>
</ul>
<p>You can read more about the reasoning behind this rule of thumb in <a href="https://medium.com/@martin_hotell/interface-vs-type-alias-in-typescript-2-7-2a8f1777af4c">Interface vs Type alias in TypeScript 2.7</a>.</p>
<p>The TypeScript Handbook now also includes guidance on <a href="https://www.typescriptlang.org/docs/handbook/2/everyday-types.html#differences-between-type-aliases-and-interfaces">Differences Between Type Aliases and Interfaces</a>.</p>
<blockquote>
<p>Note: At scale, there are performance reasons to prefer interfaces (see official Microsoft notes on this) but take this with a grain of salt</p>
</blockquote>
<p>Types are useful for union types (e.g. <code>type MyType = TypeA | TypeB</code>) whereas Interfaces are better for declaring dictionary shapes and then <code>implementing</code> or <code>extending</code> them.</p>
<blockquote>
<p><a href="https://pro.ant.design/zh-CN/docs/type-script#%E4%BB%80%E4%B9%88%E6%97%B6%E5%80%99%E6%8E%A8%E8%8D%90%E7%94%A8-type-%E4%BB%80%E4%B9%88%E6%97%B6%E5%80%99%E7%94%A8-interface-%EF%BC%9F">什么时候推荐用 type 什么时候用 interface ？</a></p>
<p>大多数情况下使用 interface，而不是 type</p>
</blockquote>
<h4 id="扩展"><a href="#扩展" class="headerlink" title="扩展"></a>扩展</h4><p>ts 工具类型：<a href="https://www.typescriptlang.org/docs/handbook/utility-types.html">https://www.typescriptlang.org/docs/handbook/utility-types.html</a></p>
]]></content>
      <categories>
        <category>前端</category>
        <category>typescript</category>
      </categories>
      <tags>
        <tag>前端</tag>
        <tag>typescript</tag>
      </tags>
  </entry>
  <entry>
    <title>vscode使用</title>
    <url>/posts/a2598390/</url>
    <content><![CDATA[<p>官网：<a href="https://code.visualstudio.com/docs">https://code.visualstudio.com/docs</a></p>
<h3 id="快捷键"><a href="#快捷键" class="headerlink" title="快捷键"></a><a href="https://code.visualstudio.com/docs/getstarted/keybindings">快捷键</a></h3><ul>
<li><code>ctrl + shift + p</code>  / <code>F1</code> ：打开命令面板。输入 <code>?</code> 可以查看可使用的命令行列表。</li>
<li><code>ctrl + p</code> ：打开文件</li>
<li><code>ctrl + shift + o</code> ：定位到文件某个位置</li>
<li><code>ctrl + g</code> ：定位到某一行</li>
<li><code>ctrl + Tab</code> ：显示最近编辑的文件</li>
<li><code>ctrl + ,</code> ：打开 <code>setting</code></li>
<li><code>ctrl + w</code> ：关闭所有的编辑器界面</li>
<li><code>ctrl + 1</code> ：到最左边的编辑器界面</li>
<li><code>ctrl + 2</code> ：到中间的编辑器界面</li>
<li><code>ctrl + 3</code> ：到最右边的编辑器界面</li>
<li><code>ctrl + F4</code> ：关闭当前活动的编辑器界面</li>
<li><code>ctrl + shift + x</code> ：打开插件界面。类目搜索如 <code>@category:&quot;theme&quot;</code> 进行筛选。</li>
<li><code>ctrl + d</code> ：当前选中的元素，多选</li>
<li><code>ctrl + alt + down / up</code> ：多行</li>
<li><code>ctrl + shift + alt + up / down</code> ：多行选中</li>
<li><code>ctrl + shift + alt + left / right</code> ：多行左右选中</li>
<li><code>ctrl + shift + alt + pageUp / pageDown</code> ：page多行选中</li>
<li><code>ctrl + shift + l</code> ：全选中当前选中的元素</li>
<li><code>alt + click</code> ：点击自定义多选行和位置</li>
<li><code>ctrl + [ / ]</code> ：控制缩进</li>
<li><code>ctrl + shift + [ / ]</code> ：控制代码块折叠</li>
<li><code>ctrl + 0</code> ：代码块全部折叠</li>
<li><code>ctrl + /</code> ：注释代码</li>
<li><code>alt + shift + f</code> ：格式化代码</li>
<li><code>alt + shift + up</code> ：复制一行到上一行</li>
<li><code>alt + shift + down</code> ：复制一行到下一行</li>
<li><code>ctrl + alt + n</code> ：运行当前文件</li>
</ul>
<h3 id="配置-setting-json"><a href="#配置-setting-json" class="headerlink" title="配置 setting.json"></a>配置 <a href="https://code.visualstudio.com/docs/getstarted/settings">setting.json</a></h3><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>
    <span class="token comment">// tabs</span>
    <span class="token property">"workbench.editor.showTabs"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// 不使用tab</span>
    <span class="token property">"workbench.editor.openPositioning"</span><span class="token operator">:</span> <span class="token string">"left"</span><span class="token punctuation">,</span> <span class="token comment">// tab order</span>
    <span class="token comment">// preview mode 预览模式 单击进入预览模式 双击打开文件 关闭预览模式需要设置以下两个参数</span>
    <span class="token property">"workbench.editor.enablePreview"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 默认启用预览模式</span>
    <span class="token property">"workbench.editor.enablePreviewFromQuickOpen"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// 快速打开文件，即单击打开文件 </span>
    <span class="token comment">// 编辑器界面</span>
    <span class="token property">"workbench.editor.closeEmptyGroups"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// 不关闭空的 editor group</span>
    <span class="token property">"workbench.editor.openSideBySideDirection"</span><span class="token operator">:</span> <span class="token string">"down"</span><span class="token punctuation">,</span> <span class="token comment">// 预设打开新的编辑器界面的方向 默认为右边</span>
    <span class="token comment">// 窗口配置 重启窗口 有效值为 on off default</span>
    <span class="token property">"window.openFoldersInNewWindow"</span><span class="token operator">:</span> <span class="token string">"default"</span><span class="token punctuation">,</span> <span class="token comment">// 打开新的文件夹</span>
    <span class="token property">"window.openFilesInNewWindow"</span><span class="token operator">:</span> <span class="token string">"default"</span><span class="token punctuation">,</span> <span class="token comment">// 打开新的文件</span>
    <span class="token comment">// 主题</span>
    <span class="token property">"workbench.colorTheme"</span><span class="token operator">:</span> <span class="token string">"Default Dark+"</span><span class="token punctuation">,</span>
    <span class="token comment">// 自定义主题 such as list &amp; trees (File Explorer, suggestions widget), diff editor, Activity Bar, notifications, scroll bar, split view, buttons, and more </span>
    <span class="token comment">// https://code.visualstudio.com/api/references/theme-color</span>
    <span class="token property">"workbench.colorCustomizations"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        <span class="token property">"activityBar.foreground"</span><span class="token operator">:</span> <span class="token string">"#00FFFF"</span><span class="token punctuation">,</span>
        ...
        <span class="token comment">// 或 对特殊主题设置</span>
        <span class="token property">"[Monokai]"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
            <span class="token property">"sideBar.background"</span><span class="token operator">:</span> <span class="token string">"#00FFFF"</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token comment">// 高亮 comments、function、keywords、numbers...</span>
    <span class="token property">"editor.tokenColorCustomizations"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        <span class="token property">"comments"</span><span class="token operator">:</span> <span class="token string">"#FF9900"</span><span class="token punctuation">,</span>
        ...
        <span class="token comment">// 使用文件内容配置</span>
        <span class="token property">"textMateRules"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">&#123;</span>
                <span class="token property">"scope"</span><span class="token operator">:</span> <span class="token string">"support.type.property-name.json"</span><span class="token punctuation">,</span>
                <span class="token property">"settings"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
                    <span class="token property">"foreground"</span><span class="token operator">:</span> <span class="token string">"#00FFFF"</span>
                <span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token comment">// 对特殊主题设置</span>
        <span class="token property">"[Monokai]"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
            <span class="token property">"comments"</span><span class="token operator">:</span> <span class="token string">"#00FFFF"</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token comment">// 更加详细的颜色配置 https://code.visualstudio.com/api/extension-guides/color-theme</span>
    <span class="token comment">// 特殊语言的语义主题配置 https://code.visualstudio.com/api/language-extensions/semantic-highlight-guide</span>
    <span class="token property">"editor.semanticTokenColorCustomizations"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        <span class="token property">"[Rouge]"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
            <span class="token property">"enabled"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
            <span class="token property">"rules"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
                <span class="token property">"*.declaration"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token property">"bold"</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token comment">// icon theme</span>
  	<span class="token property">"workbench.iconTheme"</span><span class="token operator">:</span> <span class="token string">"vs-seti"</span><span class="token punctuation">,</span>
    
    <span class="token comment">// 特殊语言设置</span>
    <span class="token property">"[typescript]"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        <span class="token property">"editor.formatOnSave"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token property">"editor.formatOnPaste"</span><span class="token operator">:</span> <span class="token boolean">true</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token property">"[markdown]"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        <span class="token property">"editor.formatOnSave"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token property">"editor.wordWrap"</span><span class="token operator">:</span> <span class="token string">"on"</span><span class="token punctuation">,</span>
        <span class="token property">"editor.renderWhitespace"</span><span class="token operator">:</span> <span class="token string">"all"</span><span class="token punctuation">,</span>
        <span class="token property">"editor.acceptSuggestionOnEnter"</span><span class="token operator">:</span> <span class="token string">"off"</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><h4 id="Emmet"><a href="#Emmet" class="headerlink" title="Emmet"></a><a href="https://code.visualstudio.com/docs/editor/emmet">Emmet</a></h4><p>添加 snippet : file -&gt; preferences -&gt; user snippets</p>
<p>snippet生成工具：snippet generator - <a href="https://snippet-generator.app/">https://snippet-generator.app/</a></p>
<p>参考文章：<a href="https://juejin.cn/post/6844903869424599053">https://juejin.cn/post/6844903869424599053</a></p>
<h3 id="常用插件"><a href="#常用插件" class="headerlink" title="常用插件"></a><a href="https://code.visualstudio.com/docs/editor/extension-marketplace">常用插件</a></h3><h5 id="美观："><a href="#美观：" class="headerlink" title="美观："></a>美观：</h5><ul>
<li>Dracula Official：暗黑主题</li>
<li>vscode-icons：vscode 文件图标</li>
</ul>
<h5 id="代码相关："><a href="#代码相关：" class="headerlink" title="代码相关："></a>代码相关：</h5><ul>
<li>EsLint：一个语法规则和代码风格的检查工具，可以用来保证写出语法正确、风格统一的代码。</li>
<li>Prettier：代码格式化</li>
<li>Document This：标准代码注释格式</li>
<li>Bracket Pair Colorizer：括号匹配着色，可以查看括号是否匹配问题</li>
<li>IntelliSense for CSS class names in HTML：CSS类名智能感知提示</li>
<li>Code Spell Checker：代码拼写检查</li>
<li>TODO Highlight：TODO标注功能</li>
<li>Auto rename tag：自动匹配重命名标签</li>
<li>stylelint：css、scss、less格式化</li>
<li>vue相关：（二选一）<ul>
<li>vue 2.0：Vetur</li>
<li>vue 3.0：Volar</li>
<li>VueHelper：vue 语法提示工具，更多的Snippets</li>
</ul>
</li>
<li>react相关：<ul>
<li>ES7 React/Redux/GraphQL/React-Native snippets：快速生成代码块。</li>
</ul>
</li>
</ul>
<h5 id="调试相关："><a href="#调试相关：" class="headerlink" title="调试相关："></a>调试相关：</h5><ul>
<li>LiveServer：web服务器，可以本地起服务，在浏览器进行实时调试</li>
<li>Code Runner：万能语言运行环境，避免搭建语言的开发环境</li>
<li>Debug Visualizer：调试可视化，可以进行代码算法可视化调试</li>
</ul>
<h5 id="代码版本管理："><a href="#代码版本管理：" class="headerlink" title="代码版本管理："></a>代码版本管理：</h5><ul>
<li>GitLens：git 版本管理插件</li>
<li>Git Graph：git 提交可视化</li>
<li>Git History：查看文件提交日志、比较每次提交内容</li>
</ul>
<h5 id="其他："><a href="#其他：" class="headerlink" title="其他："></a>其他：</h5><ul>
<li>Bookmarks：标签，用于读源码打标签</li>
<li>Docker：（官方）更方便创建、管理和调试容器应用。</li>
<li>Debug Visualizer：调试可视化。主要刷算法逻辑。</li>
</ul>
<h5 id="更多阅读："><a href="#更多阅读：" class="headerlink" title="更多阅读："></a>更多阅读：</h5><p><a href="https://blog.cmyr.ltd/archives/44a0df8f.html">https://blog.cmyr.ltd/archives/44a0df8f.html</a></p>
<h3 id="工具"><a href="#工具" class="headerlink" title="工具"></a>工具</h3>]]></content>
      <categories>
        <category>指南</category>
      </categories>
      <tags>
        <tag>工具</tag>
        <tag>vscode</tag>
      </tags>
  </entry>
  <entry>
    <title>vue系列-vue-router</title>
    <url>/posts/63840/</url>
    <content><![CDATA[<p>Vue-Router官网：<a href="https://router.vuejs.org/zh/guide/">https://router.vuejs.org/zh/guide/</a></p>
<h3 id="基础"><a href="#基础" class="headerlink" title="基础"></a>基础</h3><h4 id="vue-router是什么"><a href="#vue-router是什么" class="headerlink" title="vue-router是什么"></a><a href="https://router.vuejs.org/zh/">vue-router是什么</a></h4><p>Vue Router 是 <a href="http://cn.vuejs.org/">Vue.js</a> 官方的路由管理器。它和 Vue.js 的核心深度集成，让构建<strong>单页面应用</strong>变得易如反掌。包含的功能有：</p>
<ul>
<li>嵌套的路由/视图表</li>
<li>模块化的、基于组件的路由配置</li>
<li>路由参数、查询、通配符</li>
<li>基于 Vue.js 过渡系统的视图过渡效果</li>
<li>细粒度的导航控制</li>
<li>带有自动激活的 CSS class 的链接</li>
<li>HTML5 历史模式或 hash 模式，在 IE9 中自动降级</li>
<li>自定义的滚动条行为</li>
</ul>
<h4 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h4><p>模块化方式安装。</p>
<p>vue-router 依赖包安装 <code>npm install vue-router</code> 后，需要在vue实例上进行挂载。</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 0. 如果使用模块化机制编程，导入Vue和VueRouter，要调用 Vue.use(VueRouter)</span>

<span class="token comment">// 1. 定义 (路由) 组件。</span>
<span class="token comment">// 可以从其他文件 import 进来</span>
<span class="token keyword">const</span> Foo <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">template</span><span class="token operator">:</span> <span class="token string">'&lt;div>foo&lt;/div>'</span> <span class="token punctuation">&#125;</span>
<span class="token keyword">const</span> Bar <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">template</span><span class="token operator">:</span> <span class="token string">'&lt;div>bar&lt;/div>'</span> <span class="token punctuation">&#125;</span>

<span class="token comment">// 2. 定义路由</span>
<span class="token comment">// 每个路由应该映射一个组件。 其中"component" 可以是</span>
<span class="token comment">// 通过 Vue.extend() 创建的组件构造器，</span>
<span class="token comment">// 或者，只是一个组件配置对象。</span>
<span class="token comment">// 我们晚点再讨论嵌套路由。</span>
<span class="token keyword">const</span> routes <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token punctuation">&#123;</span> <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">'/foo'</span><span class="token punctuation">,</span> <span class="token literal-property property">component</span><span class="token operator">:</span> Foo <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token punctuation">&#123;</span> <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">'/bar'</span><span class="token punctuation">,</span> <span class="token literal-property property">component</span><span class="token operator">:</span> Bar <span class="token punctuation">&#125;</span>
<span class="token punctuation">]</span>

<span class="token comment">// 3. 创建 router 实例，然后传 `routes` 配置</span>
<span class="token comment">// 你还可以传别的配置参数, 不过先这么简单着吧。</span>
<span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">VueRouter</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
  routes <span class="token comment">// (缩写) 相当于 routes: routes</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>

<span class="token comment">// 4. 创建和挂载根实例。</span>
<span class="token comment">// 记得要通过 router 配置参数注入路由，</span>
<span class="token comment">// 从而让整个应用都有路由功能</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
  router
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">$mount</span><span class="token punctuation">(</span><span class="token string">'#app'</span><span class="token punctuation">)</span>

<span class="token comment">// 现在，应用已经启动了！</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h4 id="动态路由匹配"><a href="#动态路由匹配" class="headerlink" title="动态路由匹配"></a><a href="https://router.vuejs.org/zh/guide/essentials/dynamic-matching.html#%E5%8A%A8%E6%80%81%E8%B7%AF%E7%94%B1%E5%8C%B9%E9%85%8D">动态路由匹配</a></h4><p>当使用路由参数时，例如从 <code>/user/foo</code> 导航到 <code>/user/bar</code>，<strong>原来的组件实例会被复用</strong>。<strong>所以组件的生命周期钩子不会再被调用</strong>。</p>
<p>复用组件时，想对路由参数的变化作出响应的话，你可以简单地 watch (监测变化) <code>$route</code> 对象：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> User <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  <span class="token literal-property property">template</span><span class="token operator">:</span> <span class="token string">'&lt;div>User&lt;/div>'</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">VueRouter</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
  <span class="token literal-property property">routes</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token comment">// 动态路径参数 以冒号开头</span>
    <span class="token punctuation">&#123;</span> <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">'/user/:id'</span><span class="token punctuation">,</span> <span class="token literal-property property">component</span><span class="token operator">:</span> User <span class="token punctuation">&#125;</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>在搭建页面框架时需要注意到这点，复用 <code>pageRouter</code> 和 <code>pageHeader</code></p>
</blockquote>
<p>在一个路由中设置多段“路径参数”，对应的值都会设置到 <code>$route.params</code> 中。</p>
<h5 id="路径匹配"><a href="#路径匹配" class="headerlink" title="路径匹配"></a>路径匹配</h5><p>常规参数只会匹配被 <code>/</code> 分隔的 URL 片段中的字符。如果想匹配<strong>任意路径</strong>，我们可以使用通配符 (<code>*</code>)。</p>
<p>匹配路径是循环遍历，所以如果前面没有匹配到的路由可以匹配最后的通配符。</p>
<blockquote>
<p>当使用<em>通配符</em>路由时，请确保路由的顺序是正确的，也就是说含有<em>通配符</em>的路由应该放在最后。路由 <code>&#123; path: &#39;*&#39; &#125;</code> 通常用于客户端 404 错误。history模式下，需要后端配合或者在 Vue 应用里面覆盖所有的路由情况，然后在给出一个 404 页面。</p>
</blockquote>
<h5 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h5><p><strong>以 <code>/</code> 开头的嵌套路径会被当作根路径。</strong> </p>
<p><strong>参数或查询的改变并不会触发进入/离开的导航守卫</strong>。</p>
<p><strong>确保 <code>next</code> 函数在任何给定的导航守卫中都被严格调用一次。它可以出现多于一次，但是只能在所有的逻辑路径都不重叠的情况下，否则钩子永远都不会被解析或报错</strong>。</p>
<h4 id="router-link组件"><a href="#router-link组件" class="headerlink" title="router-link组件"></a><a href="https://router.vuejs.org/zh/api/#router-link">router-link组件</a></h4><p><code>&lt;router-link&gt;</code> 组件支持用户在具有路由功能的应用中 (点击) 导航。 通过 <code>to</code> 属性指定目标地址，默认渲染成带有正确链接的 <code>&lt;a&gt;</code> 标签，可以通过配置 <code>tag</code> 属性生成别的标签.。另外，当目标路由成功激活时，链接元素自动设置一个表示激活的 CSS 类名。</p>
<p><code>&lt;router-link&gt;</code> 比起写死的 <code>&lt;a href=&quot;...&quot;&gt;</code> 会好一些，理由如下：</p>
<ul>
<li>无论是 HTML5 history 模式还是 hash 模式，它的表现行为一致，所以，当你要切换路由模式，或者在 IE9 降级使用 hash 模式，无须作任何变动。</li>
<li>在 HTML5 history 模式下，<code>router-link</code> 会守卫点击事件，让浏览器不再重新加载页面。</li>
<li>当你在 HTML5 history 模式下使用 <code>base</code> 选项之后，所有的 <code>to</code> 属性都不需要写 (基路径) 了。</li>
<li>a 标签会造成页面的强制刷新，需要手动阻止默认行为。</li>
</ul>
<p>属性值 props：</p>
<ul>
<li>to： 表示目标路由的链接。</li>
<li>replace：切换路由时使用router.replace</li>
<li>append：在当前（相对）路径前添加基路径。</li>
<li>tag：指定 router-link 渲染成其他标签，默认为 a 标签。</li>
<li>active-class：设置连接激活时使用的 css 类名。默认值可以通过路由的构造选项 linkActiveClass 来全局配置。</li>
<li>exact：启用“精确匹配模式”。“是否激活”默认类名的依据是包含匹配。</li>
<li>event：可以用来触发导航的事件。</li>
<li>exact-active-class：当连接被精确匹配时应激活的 class 样式。默认值可以通过路由构造函数选项 linkExactActiveClass 进行全局配置。</li>
<li>aria-current-value：当链接根据精确匹配规则激活时配置的 <code>aria-current</code> 的值。这个值应该是 ARIA 规范中<a href="https://www.w3.org/TR/wai-aria-1.2/#aria-current">允许的 aria-current 的值 (opens new window)</a>。在绝大多数场景下，默认值 <code>page</code> 应该是最合适的。</li>
</ul>
<h4 id="router-view组件"><a href="#router-view组件" class="headerlink" title="router-view组件"></a><a href="https://router.vuejs.org/zh/api/#router-view">router-view组件</a></h4><p><code>&lt;router-view&gt;</code> 组件是一个 functional 组件，渲染路径匹配到的视图组件。<code>&lt;router-view&gt;</code> 渲染的组件还可以内嵌自己的 <code>&lt;router-view&gt;</code>，根据嵌套路径，渲染嵌套组件。</p>
<p>其他属性 (非 router-view 使用的属性) 都直接传给渲染的组件， 很多时候，每个路由的数据都是包含在路由参数中。</p>
<p>因为它也是个组件，所以可以配合 <code>&lt;transition&gt;</code> 和 <code>&lt;keep-alive&gt;</code> 使用。如果两个结合一起用，要确保在内层使用 <code>&lt;keep-alive&gt;</code>：</p>
<pre class="line-numbers language-vue" data-language="vue"><code class="language-vue">&lt;transition&gt;
  &lt;keep-alive&gt;
    &lt;router-view&gt;&lt;&#x2F;router-view&gt;
  &lt;&#x2F;keep-alive&gt;
&lt;&#x2F;transition&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>设置<strong>命名视图</strong>，可以在同一个组件中使用多个 <code>router-view</code> 组件。</p>
<p>一个视图使用一个组件渲染，因此对于同个路由，多个视图就需要多个组件。确保正确使用 <code>components</code> 配置 (带上 s)：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">VueRouter</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
  <span class="token literal-property property">routes</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">&#123;</span>
      <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">'/'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">components</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">default</span><span class="token operator">:</span> Foo<span class="token punctuation">,</span>
        <span class="token literal-property property">a</span><span class="token operator">:</span> Bar<span class="token punctuation">,</span>
        <span class="token literal-property property">b</span><span class="token operator">:</span> Baz
      <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>route 是响应式的，路由发生了变化会改变 app.route 响应 route 的 setter 导致 router-view 组件的 render 函数。</p>
</blockquote>
<h3 id="源码"><a href="#源码" class="headerlink" title="源码"></a>源码</h3><h4 id="初始化"><a href="#初始化" class="headerlink" title="初始化"></a>初始化</h4><p>Vue-Router 的 install 方法会给每一个组件注入 beforeCreated 和 destroyed 钩子函数，在 beforeCreated 做一些私有属性定义和路由初始化工作。</p>
<p>路由初始化的时机是在组件的初始化阶段，执行到 beforeCreate 钩子函数的时候会执行 router.init 方法。然后又会执行 history.transitionTo 方法做路由过渡</p>
<h4 id="matcher"><a href="#matcher" class="headerlink" title="matcher"></a>matcher</h4><p>createMatcher 的初始化就是根据路由的配置描述创建映射表，包括路径、名称到路由 record 的映射关系。</p>
<p>match 会根据传入的位置和路径计算出新的位置，并匹配到对应的路由record，然后根据新的位置和 record 创建新的路径并返回。</p>
<h4 id="路径切换"><a href="#路径切换" class="headerlink" title="路径切换"></a>路径切换</h4><p>路由始终会维护当前的线路，路由切换的时候会把当前线路切换到目标线路，切换过程中会执行一系列的导航守卫钩子函数，会更改url，同样也会渲染对应的组件，切换完毕后会把目标线路更新替换当前线路，这样就会作为下一次的路径切换的依据。</p>
<h3 id="面试题"><a href="#面试题" class="headerlink" title="面试题"></a>面试题</h3><p>**参考：<a href="https://juejin.cn/post/6844903961745440775">Vue-Router面试题汇总 - 掘金</a></p>
<h4 id="路由有几种模式，区别"><a href="#路由有几种模式，区别" class="headerlink" title="路由有几种模式，区别"></a>路由有几种<a href="https://router.vuejs.org/zh/api/#mode">模式</a>，区别</h4><ul>
<li><strong>hash模式</strong>：使用 URL hash 值来作路由。支持所有浏览器，包括不支持 HTML5 History Api 的浏览器。例<a href="http://www.abc.com/#/index%EF%BC%8Chash%E5%80%BC%E4%B8%BA#/index%EF%BC%8C">http://www.abc.com/#/index，hash值为#/index，</a> hash的改变会触发hashchange事件，通过监听hashchange事件来完成操作实现前端路由。hash值变化不会让浏览器向服务器请求。主要使用 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Window/location"><code>window.location</code></a> 方式进行页面跳转，如<code>window.location.assign()</code>、<code>window.location.replace()</code>。</li>
<li><strong>history模式</strong>：依赖 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/History_API">HTML5 History API</a> 和服务器配置。没有<code>#</code>，路由地址跟正常的url一样，但是初次访问或者刷新都会向服务器请求，如果没有请求到对应的资源就会返回404，所以路由地址匹配不到任何静态资源，则应该返回同一个index.html 页面，需要在nginx中配置。页面路径操作为<code>history api</code>的方式，如<code>history.pushState()</code>、<code>history.replaceState()</code></li>
<li><strong>abstract模式</strong>：支持所有 JavaScript 运行环境，如 Node.js 服务器端。<strong>如果发现没有浏览器的 API，路由会自动强制进入这个模式。</strong></li>
</ul>
<h4 id="完整的导航守卫流程"><a href="#完整的导航守卫流程" class="headerlink" title="完整的导航守卫流程"></a><a href="https://router.vuejs.org/zh/guide/advanced/navigation-guards.html#%E5%AE%8C%E6%95%B4%E7%9A%84%E5%AF%BC%E8%88%AA%E8%A7%A3%E6%9E%90%E6%B5%81%E7%A8%8B">完整的导航守卫流程</a></h4><ul>
<li>导航被触发。</li>
<li>如果不是首次加载页面，在失活的组件里调用<strong>组件内</strong>离开钩子<code>beforeRouteLeave(to,from,next)</code>。</li>
<li>调用<strong>全局</strong>前置守卫<code>beforeEach((to,from,next) =&gt; &#123;&#125; )</code>，可以改变导航本身。守卫是异步解析执行，此时导航在所有守卫 resolve 完之前一直处于 <strong>等待中</strong>。</li>
<li>在重用的组件里调用<strong>组件内</strong>的更新守卫 <code>beforeRouteUpdate(to,from,next)</code> 。</li>
<li>在路由配置里调用<strong>路由独享</strong>的守卫<code>beforeEnter(to,from,next)</code>，在配置路由时定义。</li>
<li>解析异步路由组件。</li>
<li>在被激活的组件里调用<strong>组件内</strong>的前置钩子 <code>beforeRouteEnter(to,from,next)</code>，此时不能访问 this ，因为守卫在导航确认前被调用，因此即将登场的新组件还没被创建，可以设置 next 回调来访问组件实例。</li>
<li>在所有组件内守卫和异步路由组件被解析之后调用<strong>全局</strong>解析守 <code>beforeResolve((to,from,next) =&gt; &#123;&#125; )</code>。</li>
<li>导航被确认。</li>
<li>调用<strong>全局</strong>后置钩子<code>afterEach((to,from) =&gt; &#123;&#125; )</code>，不会改变导航本身。</li>
<li>触发 DOM 更新，执行 vue 组件的生命周期，组件创建挂载后。</li>
<li>用创建好的实例调用<strong>组件内</strong>的前置钩子 <code>beforeRouteEnter</code> 中传给 next 的回调函数。</li>
</ul>
<p>图示为首次渲染进入页面的调用顺序。</p>
<p><img src="/./vur-router%E5%AE%88%E5%8D%AB.jpg" alt="vur-router守卫"></p>
<h4 id="如何获取路由传过来的参数"><a href="#如何获取路由传过来的参数" class="headerlink" title="如何获取路由传过来的参数"></a>如何获取路由传过来的参数</h4><ul>
<li>router配置参数meta：如<code>this.$route.meta.title</code></li>
<li>url上携带的参数query：使用 path 和 query 配合传参。如浏览器地址：<code>http://localhost:8036/home?userId=123</code> 获取方式：<code>this.$route.query.userId</code></li>
<li>params传参：使用 name 和 params 配合传参。<code>router.push(&#123; name: &#39;user&#39;, params: &#123; userId: &#39;123&#39; &#125;&#125;)</code> 获取参数：<code>this.$route.params.userId</code></li>
<li>在配置router时，设置props属性，可以在组件的props中获取：<a href="https://router.vuejs.org/zh/guide/essentials/passing-props.html#%E5%B8%83%E5%B0%94%E6%A8%A1%E5%BC%8F">props方式</a></li>
</ul>
<h4 id="路由之间的跳转"><a href="#路由之间的跳转" class="headerlink" title="路由之间的跳转"></a>路由之间的跳转</h4><ul>
<li>声明式：通过使用内置组件<code>&lt;router-link :to=&quot;/home&quot;&gt;</code>来跳转</li>
<li>编程式：通过调用router实例的push方法<code>router.push(&#123; path: &#39;/home&#39; &#125;)</code>或 replace 方法<code>router.replace(&#123; path: &#39;/home&#39; &#125;)</code></li>
</ul>
<h4 id="Route与Router的关系"><a href="#Route与Router的关系" class="headerlink" title="Route与Router的关系"></a>Route与Router的关系</h4><ul>
<li><strong>route</strong>是“路由信息对象”，包括path，params，hash，query，fullPath，matched，name等路由信息参数。 </li>
<li><strong>router</strong>是“路由实例对象”，包括了路由的跳转方法，钩子函数等。</li>
</ul>
<h4 id="Vue路由如何打开新窗口"><a href="#Vue路由如何打开新窗口" class="headerlink" title="Vue路由如何打开新窗口"></a>Vue路由如何打开新窗口</h4><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    <span class="token literal-property property">path</span><span class="token operator">:</span> xxx<span class="token punctuation">,</span><span class="token comment">//路由地址</span>
    <span class="token literal-property property">query</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
       <span class="token literal-property property">mid</span><span class="token operator">:</span> data<span class="token punctuation">.</span>id<span class="token comment">//可以带参数</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">&#123;</span>href<span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$router<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
window<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>href<span class="token punctuation">,</span> <span class="token string">'_blank'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h4 id="Vue-Router-切换页面-与-window-location-的区别"><a href="#Vue-Router-切换页面-与-window-location-的区别" class="headerlink" title="Vue-Router 切换页面 与 window.location 的区别"></a>Vue-Router 切换页面 与 <code>window.location</code> 的区别</h4><p>要区分路由导航的方式。</p>
<table>
<thead>
<tr>
<th>router导航方式</th>
<th>hash模式</th>
<th>history模式</th>
</tr>
</thead>
<tbody><tr>
<td>router.replace(…)</td>
<td>window.location.replace(…)</td>
<td>history.replaceState(…)</td>
</tr>
<tr>
<td>router.push(…)</td>
<td>window.location.hash(…)</td>
<td>history.pushState(…)</td>
</tr>
<tr>
<td>router.go(n)</td>
<td>window.history.go(<em>n</em>)</td>
<td>window.history.go(<em>n</em>)</td>
</tr>
<tr>
<td>事件监听</td>
<td><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Window/hashchange_event">hashchange</a></td>
<td><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/WindowEventHandlers/onpopstate">popstate</a></td>
</tr>
</tbody></table>
<blockquote>
<p>在支持window.history的情况下，hash模式也是使用history模式的api操作，如果history.pushState失败会使用window.location.assign(…)处理异常。回退事件会触发 popstate 事件监听。</p>
<p>不支持 window.history 的情况下，hash模式则会使用 window.location 方式进行操作 url，回退事件会触发 hashchange 事件监听。</p>
</blockquote>
<p>本质上就是问 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/History_API"><code>window.history</code></a> 与 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Window/location"><code>window.location</code></a> 的区别。 </p>
<p><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/History_API#pushstate_%E6%96%B9%E6%B3%95%E7%9A%84%E4%BE%8B%E5%AD%90"><strong>history.pushState(…)</strong></a>：调用 <code>pushState()</code> 后浏览器并不会立即加载这个URL，但可能会在稍后某些情况下加载这个URL，比如在用户重新打开浏览器时，后退时。新URL不必须为绝对路径。如果新URL是相对路径，那么它将被作为相对于当前URL处理。新URL必须与当前URL同源，否则 <code>pushState()</code> 会抛出一个异常。该参数是可选的，缺省为当前URL。</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">window<span class="token punctuation">.</span><span class="token function-variable function">onpopstate</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
   <span class="token function">alert</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">let</span> stateObj <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    <span class="token literal-property property">foo</span><span class="token operator">:</span> <span class="token string">"bar"</span><span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

history<span class="token punctuation">.</span><span class="token function">pushState</span><span class="token punctuation">(</span>stateObj<span class="token punctuation">,</span> <span class="token string">"page 2"</span><span class="token punctuation">,</span> <span class="token string">"bar.html"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 假如现在用户在bar.html点击了返回按钮，将会执行alert(2)。</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>window.location</strong>：只要赋给 location 对象一个新值，文档就会使用新的 URL 加载，就好像使用修改后的 URL 调用了  <code>window.location.assign()</code> 一样。需要注意的是，安全设置，如 CORS（跨域资源共享），可能会限制实际加载新页面。<strong>会立即触发 <code>popstate</code> 或 <code>hashchange</code>监听</strong>。</p>
<blockquote>
<p><code>window.location.href</code>、<code>window.location.hash</code> 的操作结果和<code>window.location</code>一致。</p>
</blockquote>
<p>在某种意义上，调用 <code>pushState()</code> 与 设置 <code>window.location = &quot;#foo&quot;</code> 类似，二者都会在当前页面创建并激活新的历史记录。但 <code>pushState()</code> 具有如下几条优点：</p>
<ul>
<li>新的 URL 可以是与当前URL同源的任意URL 。相反，只有在修改哈希时，设置 <code>window.location</code> 才能是同一个 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Document"><code>document</code></a>。</li>
<li>如果你不想改URL，就不用改。相反，设置 <code>window.location = &quot;#foo&quot;;</code>在当前哈希不是 <code>#foo</code> 时， 才能创建新的历史记录项。</li>
<li>你可以将任意数据和新的历史记录项相关联。而基于哈希的方式，要把所有相关数据编码为短字符串。 </li>
<li>如果 <code>title</code>参数，随后还会被浏览器所用到，那么这个数据是可以被使用的（哈希则不是）。</li>
</ul>
<p>注意 <code>pushState()</code> 绝对不会触发 <code>hashchange</code> 事件，即使新的URL与旧的URL仅哈希不同也是如此。</p>
<blockquote>
<p>调用<code>history.pushState()</code>或者<code>history.replaceState()</code>不会触发popstate事件. <code>popstate</code>事件只会在浏览器某些行为下触发, 比如点击后退、前进按钮(或者在JavaScript中调用<code>history.back()、history.forward()、history.go()</code>方法)，此外，a 标签的锚点也会触发该事件.</p>
</blockquote>
<p><strong>如果vue项目是单页面项目，其实router操作只是组件的显隐，所以不是真正的页面跳转。如果使用页面跳转会耗费更多的性能去加载渲染页面。</strong></p>
<p>vue-router 跳转原理类似于 pjax (pushState + ajax) 都使用了history state API。</p>
<h5 id="关于-history-pushState-："><a href="#关于-history-pushState-：" class="headerlink" title="关于 history.pushState ："></a>关于 history.pushState ：</h5><p>更多阅读：<a href="https://blog.csdn.net/helloxiaoliang/article/details/73850428">https://blog.csdn.net/helloxiaoliang/article/details/73850428</a></p>
<p>在浏览器中改变地址栏url，将会触发页面资源的重新加载，这使得我们可以在不同的页面间进行跳转，得以浏览不同的内容。但随着单页应用的增多，越来越多的网站采用ajax来加载资源。因为异步加载的特性，地址栏上的资源路径没有被改变，随之而来的问题就是页面的状态无法被保存。这导致我们难以通过熟悉的方式（点击浏览器前进/后退按钮），在前后的页面状态间进行切换。 </p>
<p>为了解决ajax页面状态不能返回的问题，人们想出了一些曲线救国的方法，比如利用浏览器hash的特性，将新的资源路径伪装成锚点，通过<code>onhashchange</code>事件来改变状态，同时又避免了浏览器刷新。但这样始终显得有些hack。 </p>
<p>现在HTML5规范为 <code>window.history</code>引入了两个新api，<code>pushState</code> 和 <code>replaceState</code>，我们可以使用它很方便的达到改变url不重载页面的目的。</p>
]]></content>
      <categories>
        <category>前端</category>
        <category>vue</category>
      </categories>
      <tags>
        <tag>前端</tag>
        <tag>vue</tag>
        <tag>vue-router</tag>
      </tags>
  </entry>
  <entry>
    <title>vue系列-vue-cli</title>
    <url>/posts/23219/</url>
    <content><![CDATA[<h3 id="基础"><a href="#基础" class="headerlink" title="基础"></a>基础</h3><h4 id="单个文件开发"><a href="#单个文件开发" class="headerlink" title="单个文件开发"></a>单个文件开发</h4><p>只适用于快速原型开发。</p>
<p>需要安装全局扩展 <code>@vue/cli-service-global</code>，开发环境得不到一致性的保证：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> <span class="token parameter variable">-g</span> @vue/cli-service-global<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h5 id="vue-serve"><a href="#vue-serve" class="headerlink" title="vue serve"></a><a href="https://cli.vuejs.org/zh/guide/prototyping.html#vue-serve">vue serve</a></h5><pre class="line-numbers language-none"><code class="language-none">Usage: serve [options] [entry]

在开发环境模式下零配置为 .js 或 .vue 文件启动一个服务器

Options:

  -o, --open  打开浏览器
  -c, --copy  将本地 URL 复制到剪切板
  -h, --help  输出用法信息<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><code>vue serve</code> 使用了和 <code>vue create</code> 创建的项目相同的默认设置 (webpack、Babel、PostCSS 和 ESLint)。它会在当前目录自动推导入口文件——入口可以是 <code>main.js</code>、<code>index.js</code>、<code>App.vue</code> 或 <code>app.vue</code> 中的一个。你也可以显式地指定入口文件：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">vue serve MyComponent.vue<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>如果需要，你还可以提供一个 <code>index.html</code>、<code>package.json</code>、安装并使用本地依赖、甚至通过相应的配置文件配置 Babel、PostCSS 和 ESLint。</p>
<h5 id="vue-build"><a href="#vue-build" class="headerlink" title="vue build"></a><a href="https://cli.vuejs.org/zh/guide/prototyping.html#vue-build">vue build</a></h5><pre class="line-numbers language-text" data-language="text"><code class="language-text">Usage: build [options] [entry]

在生产环境模式下零配置构建一个 .js 或 .vue 文件

Options:

  -t, --target &lt;target>  构建目标 (app | lib | wc | wc-async, 默认值：app)
  -n, --name &lt;name>      库的名字或 Web Components 组件的名字 (默认值：入口文件名)
  -d, --dest &lt;dir>       输出目录 (默认值：dist)
  -h, --help             输出用法信息<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>你也可以使用 <code>vue build</code> 将目标文件构建成一个生产环境的包并用来部署：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">vue build MyComponent.vue<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><code>vue build</code> 也提供了将组件构建成为一个库或一个 Web Components 组件的能力。</p>
<h4 id="项目开发"><a href="#项目开发" class="headerlink" title="项目开发"></a>项目开发</h4><h5 id="vue-create"><a href="#vue-create" class="headerlink" title="vue create"></a>vue create</h5><pre class="line-numbers language-text" data-language="text"><code class="language-text">用法：create [options] &lt;app-name>

创建一个由 `vue-cli-service` 提供支持的新项目

选项：

  -p, --preset &lt;presetName>       忽略提示符并使用已保存的或远程的预设选项
  -d, --default                   忽略提示符并使用默认预设选项
  -i, --inlinePreset &lt;json>       忽略提示符并使用内联的 JSON 字符串预设选项
  -m, --packageManager &lt;command>  在安装依赖时使用指定的 npm 客户端
  -r, --registry &lt;url>            在安装依赖时使用指定的 npm registry
  -g, --git [message]             强制 / 跳过 git 初始化，并可选的指定初始化提交信息
  -n, --no-git                    跳过 git 初始化
  -f, --force                     覆写目标目录可能存在的配置
  -c, --clone                     使用 git clone 获取远程预设选项
  -x, --proxy                     使用指定的代理创建项目
  -b, --bare                      创建项目时省略默认组件中的新手指导信息
  -h, --help                      输出使用帮助信息<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h5 id="vue-ui"><a href="#vue-ui" class="headerlink" title="vue ui"></a>vue ui</h5><p>以图形化界面创建和管理项目。</p>
<h3 id="开发"><a href="#开发" class="headerlink" title="开发"></a>开发</h3><h4 id="审查项目配置"><a href="#审查项目配置" class="headerlink" title="审查项目配置"></a>审查项目配置</h4><p>获得 vue-cli 搭建的 vue 项目的所有配置，可以使用 inspect 命令进行审查解析好的 webpack 配置。</p>
<p>在项目目录下的命令行中运行  <code>npx vue inspect &gt; output.js</code> ，将解析出来的 webpack 配置、包括链式访问规则和插件的提示输出到 output 文件中。</p>
<p>只审查部分配置：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 只审查第一条规则</span>
vue inspect module.rules.0
<span class="token comment"># 审查一个规则</span>
vue inspect <span class="token parameter variable">--rule</span> vue
<span class="token comment"># 审查一个插件名字</span>
vue inspect <span class="token parameter variable">--plugin</span> html
<span class="token comment"># 审查所有的规则</span>
vue inspect <span class="token parameter variable">--rules</span>
<span class="token comment"># 审查所有的插件</span>
vue inspect <span class="token parameter variable">--plugins</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h4 id="修改配置"><a href="#修改配置" class="headerlink" title="修改配置"></a>修改配置</h4><p><code>vue-cli@v3+</code> 使用 <a href="https://github.com/neutrinojs/webpack-chain/tree/master"><code>webpack-chain</code></a> 插件将 <code>webpack</code> 配置封装了，相对于之前的版本少了 <code>config</code> 配置文件夹，但是如果想要修改默认配置，需要创建 <code>vue.config.js</code> 文件来修改默认配置，该文件需要在项目根目录下，编译 <code>vue</code> 项目时 <code>@vue/cli-service</code> 会自动加载 <code>vue.config.js</code> 文件。</p>
<blockquote>
<p>webpack-chain 提供了一个 webpack 原始配置的上层抽象，使其可以定义具名的 loader 规则和具名插件，并有机会在后期进入这些规则并对它们的选项进行修改。</p>
<p>中文文档：<a href="https://github.com/Yatoo2018/webpack-chain/tree/zh-cmn-Hans">https://github.com/Yatoo2018/webpack-chain/tree/zh-cmn-Hans</a></p>
</blockquote>
<p><code>@vue/cli-service</code> 对 <code>webpack</code> 配置进行了抽象，但是提供了一些基础的配置入口，可以在 <a href="https://cli.vuejs.org/zh/config/#vue-config-js"><code>vue.config.js</code></a> 中覆盖或合并默认配置。</p>
<p>具体配置内容在 <code>&lt;projectRoot&gt;/node_modules/@vue/cli-service/webpack.config.js</code>。可以使用 <code>vue inspect</code> 进行审查部分配置。</p>
<h4 id="模式"><a href="#模式" class="headerlink" title="模式"></a>模式</h4><p>设置模式可以在 <code>npm scripts</code> 中设置，如：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">vue-cli-service build <span class="token parameter variable">--mode</span> development <span class="token comment"># 表示 build 采用development模式</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<ul>
<li><code>development</code> 模式用于 <code>vue-cli-service serve</code></li>
<li><code>test</code> 模式用于 <code>vue-cli-service test:unit</code></li>
<li><code>production</code> 模式用于 <code>vue-cli-service build</code> 和 <code>vue-cli-service test:e2e</code></li>
</ul>
<blockquote>
<p>环境文件中的 NODE_ENV 属性值会覆盖命令行中的mode</p>
</blockquote>
<h4 id="环境变量"><a href="#环境变量" class="headerlink" title="环境变量"></a>环境变量</h4><p>使用环境变量文件进行环境变量赋值。</p>
<ul>
<li><code>vue-cli-service build</code> 会加载可能存在的 <code>.env</code>、<code>.env.production</code> 和 <code>.env.production.local</code> 文件然后构建出生产环境应用。</li>
<li><code>vue-cli-service build --mode staging</code> 会在 staging 模式下加载可能存在的 <code>.env</code>、<code>.env.staging</code> 和 <code>.env.staging.local</code> 文件然后构建出生产环境应用。</li>
</ul>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">.env                <span class="token comment"># 在所有的环境中被载入</span>
.env.local          <span class="token comment"># 在所有的环境中被载入，但会被 git 忽略</span>
.env.<span class="token punctuation">[</span>mode<span class="token punctuation">]</span>         <span class="token comment"># 只在指定的模式中被载入</span>
.env.<span class="token punctuation">[</span>mode<span class="token punctuation">]</span>.local   <span class="token comment"># 只在指定的模式中被载入，但会被 git 忽略</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>环境文件写法</p>
<pre class="line-numbers language-none"><code class="language-none">NODE_EVN&#x3D;production
VUE_APP_NOT_SECRET_CODE&#x3D;some_value<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<blockquote>
<p>为一个特定模式准备的环境文件 (例如 <code>.env.production</code>) 将会比一般的环境文件 (例如 <code>.env</code>) 拥有更高的优先级。</p>
<p>此外，Vue CLI 启动时已经存在的环境变量拥有最高优先级，并不会被 <code>.env</code> 文件覆写。</p>
<p><code>.env</code> 环境文件是通过运行 <code>vue-cli-service</code> 命令载入的，因此环境文件发生变化，你需要重启服务。</p>
</blockquote>
<h3 id="优化"><a href="#优化" class="headerlink" title="优化"></a>优化</h3><p>vue-cli 已经内置了 optimization 选项，大部分优化问题已经被处理了，需要优化更多的细节。</p>
<ul>
<li><p>合理的 polyfill </p>
</li>
<li><p>vue-cli 会帮我们进行资源的<a href="https://cli.vuejs.org/zh/guide/html-and-static-assets.html#preload">preload</a> 和 <a href="https://cli.vuejs.org/zh/guide/html-and-static-assets.html#prefetch">prefetch</a>，所以如果不需要进行 prefetch 则可以取消 vue-cli 中的设置。</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">config<span class="token punctuation">.</span>plugins<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token string">'prefetch'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<blockquote>
<p>preload：用来指定页面加载后很快会被用到的资源，所以在页面加载的过程中，我们希望在浏览器开始主体渲染之前尽早 preload。 </p>
<p>prefetch：用来告诉浏览器在页面加载完成后，利用空闲时间提前获取用户未来可能会访问的内容。</p>
<p>可能会引发一系列问题参考：<a href="https://bangkk.github.io/blog/2020/07/09/%E8%AE%B0%E4%B8%80%E4%B8%AAprefetch%E7%96%91%E9%97%AE%E5%8F%8A%E5%88%86%E6%9E%90%E8%BF%87%E7%A8%8B/">🤔记一个 prefetch 疑问及分析过程</a></p>
</blockquote>
</li>
<li><p>第三方库使用 CDN 加载，进行 external 。</p>
</li>
<li><p>路由懒加载</p>
</li>
</ul>
]]></content>
      <categories>
        <category>前端</category>
        <category>vue</category>
      </categories>
      <tags>
        <tag>vue</tag>
      </tags>
  </entry>
  <entry>
    <title>vue系列-vue3入门</title>
    <url>/posts/518f6081/</url>
    <content><![CDATA[<p>Vue3.x 官网：<a href="https://v3.cn.vuejs.org/">https://v3.cn.vuejs.org/</a></p>
<h3 id="理论"><a href="#理论" class="headerlink" title="理论"></a>理论</h3><h4 id="与Vue-2-x版本的比较"><a href="#与Vue-2-x版本的比较" class="headerlink" title="与Vue 2.x版本的比较"></a>与Vue 2.x版本的比较</h4><blockquote>
<p> Vue2.x 的组织代码形式，叫 <code>Options API</code>，而 Vue3 最大的特点是 <strong>Composition API</strong> 中文名是<strong>合成函数：以函数为载体，将业务相关的逻辑代码抽取到一起，整体打包对外提供相应能力</strong>。可以理解它是我们组织代码，解决逻辑复用的一种方案。</p>
<p>其中 <code>setup</code> 是 <code>Composition API</code> 的入口函数，是在 <code>beforeCreate</code> 声明周期函数之前执行的。还提供了 <code>ref</code> 函数定义一个响应式的数据，<code>reactive</code> 函数定义多个数据的响应式等等。</p>
</blockquote>
<ul>
<li>组合式 API 方式组织代码进行业务和逻辑的解耦。</li>
<li>生命周期调用</li>
<li>响应式原理</li>
<li>vue 2使用的是 Flow.js ，vue 3使用的是 typescript</li>
</ul>
<h4 id="组合式-API"><a href="#组合式-API" class="headerlink" title="组合式 API"></a>组合式 API</h4><h5 id="为什么"><a href="#为什么" class="headerlink" title="为什么"></a>为什么</h5><p>组件变大时，逻辑关注点列表也会增长，导致组件难以维护。</p>
<p>如果能够将同一个逻辑关注点相关代码收集在一起会更好。</p>
<p>业务代码和逻辑代码解耦。</p>
<blockquote>
<p><strong>合成函数：以函数为载体，将业务相关的逻辑代码抽取到一起，整体打包对外提供相应能力</strong></p>
</blockquote>
<h5 id="setup"><a href="#setup" class="headerlink" title="setup()"></a>setup()</h5><p>新的 <code>setup</code> 选项在组件创建<strong>之前</strong>执行，一旦 <code>props</code> 被解析，就将作为组合式 API 的入口。</p>
<blockquote>
<p>在 <code>setup</code> 中你应该避免使用 <code>this</code>，因为它不会找到组件实例。<code>setup</code> 的调用发生在 <code>data</code> property、<code>computed</code> property 或 <code>methods</code> 被解析之前，所以它们无法在 <code>setup</code> 中被获取。</p>
</blockquote>
<p><code>setup</code> 选项是一个接收 <code>props</code> 和 <code>context</code> 的函数。此外，我们将 <code>setup</code> 返回的所有内容都暴露给组件的其余部分 (计算属性、方法、生命周期钩子等等) 以及组件的模板。</p>
<p>如果在setup函数中定义并返回的数据需要添加响应式，则需要使用ref函数进行包裹。</p>
<h5 id="ref"><a href="#ref" class="headerlink" title="ref()"></a>ref()</h5><p>可以通过一个新的 <code>ref</code> 函数使任何响应式变量在任何地方起作用。</p>
<p><code>ref</code> 接收参数并将其包裹在一个带有 <code>value</code> property 的对象中返回，然后可以使用该 property 访问或更改响应式变量的值。</p>
<p><strong><code>ref</code> 为我们的值创建了一个响应式引用。在整个组合式 API 中会经常使用引用的概念。</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> ref <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>

<span class="token keyword">const</span> counter <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>counter<span class="token punctuation">)</span> <span class="token comment">// &#123; value: 0 &#125;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>counter<span class="token punctuation">.</span>value<span class="token punctuation">)</span> <span class="token comment">// 0</span>

counter<span class="token punctuation">.</span>value<span class="token operator">++</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>counter<span class="token punctuation">.</span>value<span class="token punctuation">)</span> <span class="token comment">// 1</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>在任何值周围都有一个封装对象，这样我们就可以在整个应用中安全地传递它，而不必担心在某个地方失去它的响应性。</p>
<h5 id="watch-和-computed"><a href="#watch-和-computed" class="headerlink" title="watch 和 computed"></a>watch 和 computed</h5><p>watch 和 computed 函数可以从 vue 中导出，在 setup 函数中使用。</p>
<p>效果与 watch 和 computed API一样。</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// src/components/UserRepositories.vue `setup` function</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> fetchUserRepositories <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'@/api/repositories'</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> ref<span class="token punctuation">,</span> onMounted<span class="token punctuation">,</span> watch<span class="token punctuation">,</span> toRefs<span class="token punctuation">,</span> computed <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>

<span class="token comment">// 在我们的组件中</span>
<span class="token function">setup</span> <span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token comment">// 使用 `toRefs` 创建对 props 中的 `user` property 的响应式引用</span>
  <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> user <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token function">toRefs</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span>

  <span class="token keyword">const</span> repositories <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> <span class="token function-variable function">getUserRepositories</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// 更新 `props.user ` 到 `user.value` 访问引用值</span>
    repositories<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetchUserRepositories</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span>value<span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span>

  <span class="token function">onMounted</span><span class="token punctuation">(</span>getUserRepositories<span class="token punctuation">)</span>

  <span class="token comment">// 在 user prop 的响应式引用上设置一个侦听器</span>
  <span class="token function">watch</span><span class="token punctuation">(</span>user<span class="token punctuation">,</span> getUserRepositories<span class="token punctuation">)</span>

  <span class="token keyword">const</span> searchQuery <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> repositoriesMatchingSearchQuery <span class="token operator">=</span> <span class="token function">computed</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> repositories<span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>
      <span class="token parameter">repository</span> <span class="token operator">=></span> repository<span class="token punctuation">.</span>name<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>searchQuery<span class="token punctuation">.</span>value<span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>

  <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>
    repositories<span class="token punctuation">,</span>
    getUserRepositories<span class="token punctuation">,</span>
    searchQuery<span class="token punctuation">,</span>
    repositoriesMatchingSearchQuery
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>setup函数中可以进一步拆分，将相关代码提出模块导入使用。</p>
<h4 id="生命周期"><a href="#生命周期" class="headerlink" title="生命周期"></a>生命周期</h4><p><img src="/posts/518f6081/lifecycle.svg" alt="lifecycle"></p>
<p>你可以通过在生命周期钩子前面加上 “on” 来访问组件的生命周期钩子。</p>
<p>下表包含如何在 <a href="https://v3.cn.vuejs.org/guide/composition-api-setup.html">setup ()</a> 内部调用生命周期钩子：</p>
<table>
<thead>
<tr>
<th>选项式 API</th>
<th>Hook inside <code>setup</code></th>
</tr>
</thead>
<tbody><tr>
<td><code>beforeCreate</code></td>
<td>Not needed*</td>
</tr>
<tr>
<td><code>created</code></td>
<td>Not needed*</td>
</tr>
<tr>
<td><code>beforeMount</code></td>
<td><code>onBeforeMount</code></td>
</tr>
<tr>
<td><code>mounted</code></td>
<td><code>onMounted</code></td>
</tr>
<tr>
<td><code>beforeUpdate</code></td>
<td><code>onBeforeUpdate</code></td>
</tr>
<tr>
<td><code>updated</code></td>
<td><code>onUpdated</code></td>
</tr>
<tr>
<td><code>beforeUnmount</code></td>
<td><code>onBeforeUnmount</code></td>
</tr>
<tr>
<td><code>unmounted</code></td>
<td><code>onUnmounted</code></td>
</tr>
<tr>
<td><code>errorCaptured</code></td>
<td><code>onErrorCaptured</code></td>
</tr>
<tr>
<td><code>renderTracked</code></td>
<td><code>onRenderTracked</code></td>
</tr>
<tr>
<td><code>renderTriggered</code></td>
<td><code>onRenderTriggered</code></td>
</tr>
<tr>
<td><code>activated</code></td>
<td><code>onActivated</code></td>
</tr>
<tr>
<td><code>deactivated</code></td>
<td><code>onDeactivated</code></td>
</tr>
</tbody></table>
<h5 id="与vue2-x-对比，新增的生命周期"><a href="#与vue2-x-对比，新增的生命周期" class="headerlink" title="与vue2.x 对比，新增的生命周期"></a>与vue2.x 对比，新增的生命周期</h5><ul>
<li>renderTracked：跟踪虚拟 DOM 重新渲染时调用。钩子接收 <code>debugger event</code> 作为参数。此事件告诉你哪个操作跟踪了组件以及该操作的目标对象和键。</li>
<li>renderTriggered：当虚拟 DOM 重新渲染被触发时调用。和 <a href="https://v3.cn.vuejs.org/api/options-lifecycle-hooks.html#rendertracked"><code>renderTracked</code></a> 类似，接收 <code>debugger event</code> 作为参数。此事件告诉你是什么操作触发了重新渲染，以及该操作的目标对象和键。</li>
</ul>
<h4 id="响应式原理"><a href="#响应式原理" class="headerlink" title="响应式原理"></a><a href="https://v3.cn.vuejs.org/guide/reactivity.html#%E4%BB%80%E4%B9%88%E6%98%AF%E5%93%8D%E5%BA%94%E6%80%A7">响应式原理</a></h4><p>推荐阅读：<a href="https://juejin.cn/post/7001999813344493581">林三心画了8张图，最通俗易懂的Vue3响应式核心原理解析</a></p>
<h5 id="什么是响应式"><a href="#什么是响应式" class="headerlink" title="什么是响应式"></a>什么是响应式</h5><ul>
<li>当一个值被读取时进行追踪</li>
<li>当某个值改变时进行检测</li>
<li>重新运行代码来读取原始值</li>
</ul>
<h5 id="vue-如何知道哪些代码在执行"><a href="#vue-如何知道哪些代码在执行" class="headerlink" title="vue 如何知道哪些代码在执行"></a>vue 如何知道哪些代码在执行</h5><p><strong>跟踪局部变量分配</strong></p>
<p>Vue 通过一个<em>副作用 (effect)</em> 来跟踪当前正在运行的函数。副作用是一个函数的包裹器，在函数被调用之前就启动跟踪。Vue 知道哪个副作用在何时运行，并能在需要时再次执行它。</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 维持一个执行副作用的栈</span>
<span class="token keyword">const</span> runningEffects <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

<span class="token keyword">const</span> <span class="token function-variable function">createEffect</span> <span class="token operator">=</span> <span class="token parameter">fn</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token comment">// 将传来的 fn 包裹在一个副作用函数中</span>
  <span class="token keyword">const</span> <span class="token function-variable function">effect</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    runningEffects<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>effect<span class="token punctuation">)</span>
    <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    runningEffects<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span>

  <span class="token comment">// 立即自动执行副作用</span>
  <span class="token function">effect</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>当我们的副作用被调用时，在调用 <code>fn</code> 之前，它会把自己推到 <code>runningEffects</code> 数组中。这个数组可以用来检查当前正在运行的副作用。</p>
<p>副作用是许多关键功能的起点。例如，<strong>组件的渲染和计算属性都在内部使用副作用</strong>。任何时候，只要有东西对数据变化做出奇妙的回应，你就可以肯定它已经被包裹在一个副作用中了。</p>
<h5 id="vue-如何跟踪变化"><a href="#vue-如何跟踪变化" class="headerlink" title="vue 如何跟踪变化"></a>vue 如何跟踪变化</h5><p>当我们从一个组件的 <code>data</code> 函数中返回一个普通的 JavaScript 对象时，Vue 会将该对象包裹在一个带有 <code>get</code> 和 <code>set</code> 处理程序的 <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy">Proxy</a> 中。Proxy 是在 ES6 中引入的，它使 Vue 3 避免了 Vue 早期版本中存在的一些响应性问题。</p>
<p><strong>Proxy 是一个对象，它包装了另一个对象，并允许你拦截对该对象的任何交互。</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> dinner <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  <span class="token literal-property property">meal</span><span class="token operator">:</span> <span class="token string">'tacos'</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">const</span> handler <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  <span class="token function">get</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> property<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'intercepted!'</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> target<span class="token punctuation">[</span>property<span class="token punctuation">]</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">const</span> proxy <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span>dinner<span class="token punctuation">,</span> handler<span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>proxy<span class="token punctuation">.</span>meal<span class="token punctuation">)</span>

<span class="token comment">// intercepted!</span>
<span class="token comment">// tacos</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>这里我们截获了读取目标对象 property 的举动。像这样的处理函数也称为一个*捕捉器 (trap)*。有许多可用的不同类型的捕捉器，每个都处理不同类型的交互。</p>
<p>除了控制台日志，我们可以在这里做任何我们想做的事情。如果我们愿意，我们甚至可以不返回实际值。这就是为什么 Proxy 对于创建 API 如此强大。</p>
<p><strong>使用 <code>Reflect</code> 帮助 Proxy 进行 this 绑定。</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> dinner <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  <span class="token literal-property property">meal</span><span class="token operator">:</span> <span class="token string">'tacos'</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">const</span> handler <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  <span class="token function">get</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> property<span class="token punctuation">,</span> receiver<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// 第1步 收集依赖</span>
    <span class="token comment">// track函数中处理 跟踪一个 property 何时被读取</span>
    <span class="token comment">// 检查当前运行的是哪个 effect，并将其与 target 和 property 记录在一起 </span>
    <span class="token comment">// 即Vue如何知道这个 property 是该副作用的依赖项（收集依赖）</span>
    <span class="token function">track</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> property<span class="token punctuation">)</span>
    <span class="token keyword">return</span> Reflect<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token operator">...</span>arguments<span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token comment">// 第2步 调用 set 处理函数</span>
  <span class="token comment">// 在property值更改时重新运行这个副作用</span>
  <span class="token function">set</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> property<span class="token punctuation">,</span> value<span class="token punctuation">,</span> receiver<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// 第3步 触发依赖</span>
    <span class="token comment">// trigger 函数查找那些副作用依赖于该 property 并执行他们</span>
    <span class="token function">trigger</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> property<span class="token punctuation">)</span>
    <span class="token keyword">return</span> Reflect<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token operator">...</span>arguments<span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">const</span> proxy <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span>dinner<span class="token punctuation">,</span> handler<span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>proxy<span class="token punctuation">.</span>meal<span class="token punctuation">)</span>

<span class="token comment">// tacos</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>从 Vue 3 开始，我们的响应性现在可以在一个<a href="https://github.com/vuejs/vue-next/tree/master/packages/reactivity">独立包</a>中使用。将 <code>$data</code> 包裹在一个代理中的函数被称为 <a href="https://v3.cn.vuejs.org/api/basic-reactivity.html#reactive"><code>reactive</code></a>。我们可以自己直接调用这个函数，允许我们在不需要使用组件的情况下将一个对象包裹在一个响应式代理中。</p>
</blockquote>
<h5 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h5><ul>
<li>Vue 在内部跟踪所有已经被转成响应式的对象，所以它总是为同一个对象返回相同的代理。当从一个响应式代理中访问一个嵌套对象时，该对象在被返回之前<em>也</em>被转换为一个代理。</li>
<li>proxy 代理的对象与原对象不等。不能使用 includes 或 indexOf 进行严等（===）比较操作。</li>
</ul>
<h5 id="Vue-3-x-数据劫持的优势"><a href="#Vue-3-x-数据劫持的优势" class="headerlink" title="Vue 3.x 数据劫持的优势"></a>Vue 3.x 数据劫持的优势</h5><p><code>Proxy</code> 的优势如下:</p>
<ul>
<li>Proxy 可以直接监听对象（<code>const proxy = new Proxy(target, handler)</code>）；defineProperty 需要遍历对象属性进行监听。</li>
<li>Proxy 可以直接监听对象新增的属性；defineProperty 只能劫持一开始就存在的属性，新增属性需要手动 Observer。</li>
<li>Proxy 可以直接监听数组的变化；defineProperty 无法监听数组的变化。</li>
<li>Proxy 有多达 13 种拦截方法：不限于 <code>get</code>、<code>set</code>、<code>has</code>、<code>deleteProperty</code>、<code>apply</code>、<code>ownKeys</code>、<code>construct</code> 等等；除开 <code>get</code> 和 <code>set</code> 其他都是 <code>defineProperty</code> 不具备的。</li>
<li>Proxy 返回的是一个新对象，我们可以只操作新的对象达到目的；defineProperty 只能遍历对象属性直接修改；</li>
</ul>
<p><code>Proxy</code> 的劣势如下:</p>
<ul>
<li>ES6 的 Proxy 的存在浏览器兼容性问题。</li>
</ul>
<blockquote>
<p>Proxy 和 Reflect 结合实现 Vue3 底层数据劫持原理。Reflect 设计的目的是为了优化 Object 的一些操作方法以及合理的返回 Object 操作返回的结果，对于一些命令式的 Object 行为，Reflect 对象可以将其变为函数式的行为。比如 <code>（&#39;name&#39; in obj）</code> = <code>Reflect.has(obj, &#39;name&#39;)</code></p>
</blockquote>
]]></content>
      <categories>
        <category>前端</category>
        <category>vue</category>
      </categories>
      <tags>
        <tag>前端</tag>
        <tag>vue</tag>
      </tags>
  </entry>
  <entry>
    <title>vue系列-vuex</title>
    <url>/posts/10722/</url>
    <content><![CDATA[<p>Vuex官网：<a href="https://vuex.vuejs.org/zh/">https://vuex.vuejs.org/zh/</a></p>
<h3 id="基础"><a href="#基础" class="headerlink" title="基础"></a>基础</h3><h4 id="vuex是什么"><a href="#vuex是什么" class="headerlink" title="vuex是什么"></a><a href="https://vuex.vuejs.org/zh/#vuex-%E6%98%AF%E4%BB%80%E4%B9%88">vuex是什么</a></h4><p>Vuex 是一个专为 Vue.js 应用程序开发的<strong>状态管理模式</strong>。它采用集中式存储管理应用的所有组件的状态，并以相应的规则保证状态以一种可预测的方式发生变化。</p>
<p>Vuex 是专门为 Vue.js 设计的状态管理库，以利用 Vue.js 的细粒度数据响应机制来进行高效的状态更新。</p>
<p><img src="/posts/10722/vuex.png" alt="vuex"></p>
<h5 id="状态自管理应用"><a href="#状态自管理应用" class="headerlink" title="状态自管理应用"></a>状态自管理应用</h5><ul>
<li><strong>state</strong>，驱动应用的数据源；</li>
<li><strong>view</strong>，以声明方式将 <strong>state</strong> 映射到视图；</li>
<li><strong>actions</strong>，响应在 <strong>view</strong> 上的用户输入导致的状态变化。</li>
</ul>
<h5 id="单向数据流"><a href="#单向数据流" class="headerlink" title="单向数据流"></a>单向数据流</h5><p><img src="/posts/10722/data-flow.png" alt="data-flow"></p>
<h5 id="使用场景"><a href="#使用场景" class="headerlink" title="使用场景"></a>使用场景</h5><p>Vuex 可以帮助我们管理共享状态，并附带了更多的概念和框架。这需要对短期和长期效益进行权衡。</p>
<p>如果您不打算开发大型单页应用，使用 Vuex 可能是繁琐冗余的。确实是如此——如果您的应用够简单，您最好不要使用 Vuex。一个简单的 <a href="https://cn.vuejs.org/v2/guide/state-management.html#%E7%AE%80%E5%8D%95%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86%E8%B5%B7%E6%AD%A5%E4%BD%BF%E7%94%A8">store 模式</a> 就足够您所需了。但是，如果您需要构建一个中大型单页应用，您很可能会考虑如何更好地在组件外部管理状态，Vuex 将会成为自然而然的选择。</p>
<h5 id="核心内容"><a href="#核心内容" class="headerlink" title="核心内容"></a>核心内容</h5><p>每一个 Vuex 应用的核心就是 store（仓库）。“store”基本上就是一个容器，它包含着你的应用中大部分的**状态 (state)**。Vuex 和单纯的全局对象有以下两点不同：</p>
<ol>
<li>Vuex 的状态存储是响应式的。当 Vue 组件从 store 中读取状态的时候，若 store 中的状态发生变化，那么相应的组件也会相应地得到高效更新。</li>
<li>你不能直接改变 store 中的状态。改变 store 中的状态的唯一途径就是显式地<strong>提交 (commit) mutation</strong>。这样使得我们可以方便地跟踪每一个状态的变化，从而让我们能够实现一些工具帮助我们更好地了解我们的应用。</li>
</ol>
<h4 id="store"><a href="#store" class="headerlink" title="store"></a>store</h4><p>store 就是一个数据仓库，为了更方便的管理仓库，我们把一个大的 store 拆成一些 modules ，整个 modules 是一个树型结构。每个 module 又分别定义了 state、getters、mutations、actions，通过递归遍历模块的方式完成了它们的初始化。</p>
<h4 id="state"><a href="#state" class="headerlink" title="state"></a>state</h4><p>从 store 实例中读取状态最简单的方法就是在 <a href="https://cn.vuejs.org/guide/computed.html">计算属性</a> 中返回某个状态：</p>
<p>如每当 <code>store.state.count</code> 变化的时候, 都会重新求取计算属性，并且触发更新相关联的 DOM。</p>
<p>然而，这种模式导致组件依赖全局状态单例。在模块化的构建系统中，在每个需要使用 state 的组件中需要频繁地导入，并且在测试组件时需要模拟状态。</p>
<p>Vuex 通过 <code>store</code> 选项，提供了一种机制将状态从根组件“注入”到每一个子组件中（需调用 <code>Vue.use(Vuex)</code>）。</p>
<p>通过在根实例中注册 <code>store</code> 选项，该 store 实例会注入到根组件下的所有子组件中，且子组件能通过 <code>this.$store</code> 访问到。</p>
<h4 id="getters"><a href="#getters" class="headerlink" title="getters"></a><a href="https://vuex.vuejs.org/zh/guide/getters.html">getters</a></h4><p>从 state 中派生出一些状态，可以认为是 store 的计算属性。例如对列表进行过滤并计数：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token literal-property property">computed</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
  <span class="token function">doneTodosCount</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$store<span class="token punctuation">.</span>state<span class="token punctuation">.</span>todos<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">todo</span> <span class="token operator">=></span> todo<span class="token punctuation">.</span>done<span class="token punctuation">)</span><span class="token punctuation">.</span>length
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>注意，在 Vue computed 中使用 getter时， getter 在通过属性访问时是作为 Vue 的响应式系统的一部分缓存其中的。</p>
<h4 id="mutations"><a href="#mutations" class="headerlink" title="mutations"></a><a href="https://vuex.vuejs.org/zh/guide/mutations.html">mutations</a></h4><p>mutation 是同步进行 state 数据操作的。</p>
<p>更改 store 中的状态。</p>
<p>每个 mutation 都有一个字符串的事件类型（type）和一个回调函数（handler）</p>
<p>注意：</p>
<ul>
<li>最好提前在 store 中初始化好所有所需属性。</li>
<li>当需要在对象上添加新属性时，应该建立起响应式关系：<ul>
<li>使用 <code>Vue.set(obj, &#39;newProp&#39;, 123)</code></li>
<li>以新对象替换老对象</li>
</ul>
</li>
</ul>
<h4 id="actions"><a href="#actions" class="headerlink" title="actions"></a><a href="https://vuex.vuejs.org/zh/guide/actions.html">actions</a></h4><p>action 可以进行异步操作。action 提交的是 mutation。</p>
<p>内部会进行 Promise 化，最终调用结果返回是一个 promise 。</p>
<p>使用 <code>store.dispatch</code> 的方法进行派发 action。</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token function">dispatch</span> <span class="token punctuation">(</span><span class="token parameter">_type<span class="token punctuation">,</span> _payload</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">const</span> <span class="token punctuation">&#123;</span>
        type<span class="token punctuation">,</span>
        payload
    <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token function">unifyObjectStyle</span><span class="token punctuation">(</span>_type<span class="token punctuation">,</span> _payload<span class="token punctuation">)</span>

    <span class="token keyword">const</span> action <span class="token operator">=</span> <span class="token punctuation">&#123;</span> type<span class="token punctuation">,</span> payload <span class="token punctuation">&#125;</span>
    <span class="token keyword">const</span> entry <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_actions<span class="token punctuation">[</span>type<span class="token punctuation">]</span>

    <span class="token comment">// ...</span>
    <span class="token keyword">const</span> result <span class="token operator">=</span> entry<span class="token punctuation">.</span>length <span class="token operator">></span> <span class="token number">1</span>
    <span class="token operator">?</span> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span>entry<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">handler</span> <span class="token operator">=></span> <span class="token function">handler</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token operator">:</span> entry<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span>
    <span class="token comment">// ...</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>promise.all 可以最大限度进行异步操作并发</p>
</blockquote>
<p>在多个action中修改同一个state，因为很有可能每个action赋给state的新值都有所不同，并且不能保证最后一个有返回结果action是哪一个action，所以最后赋予state的值可能是错误的</p>
<h4 id="modules"><a href="#modules" class="headerlink" title="modules"></a><a href="https://vuex.vuejs.org/zh/guide/modules.html">modules</a></h4><p>可以将 <code>Vuex</code> 分为多个模块甚至嵌套子模块，但是需要注意命名空间的使用。</p>
<h4 id="API"><a href="#API" class="headerlink" title="API"></a>API</h4><h5 id="mapState"><a href="#mapState" class="headerlink" title="mapState"></a>mapState</h5><h5 id="mapGetters"><a href="#mapGetters" class="headerlink" title="mapGetters"></a>mapGetters</h5><h5 id="mapActions"><a href="#mapActions" class="headerlink" title="mapActions"></a>mapActions</h5><h5 id="mapMutations"><a href="#mapMutations" class="headerlink" title="mapMutations"></a>mapMutations</h5><h5 id="createNamespacedHelpers"><a href="#createNamespacedHelpers" class="headerlink" title="createNamespacedHelpers"></a>createNamespacedHelpers</h5><p>通过使用 <code>createNamespacedHelpers</code> 创建基于某个命名空间辅助函数。它返回一个对象，对象里有新的绑定在给定命名空间值上的组件绑定辅助函数：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> createNamespacedHelpers <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'vuex'</span>

<span class="token keyword">const</span> <span class="token punctuation">&#123;</span> mapState<span class="token punctuation">,</span> mapActions <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token function">createNamespacedHelpers</span><span class="token punctuation">(</span><span class="token string">'some/nested/module'</span><span class="token punctuation">)</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">&#123;</span>
  <span class="token literal-property property">computed</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// 在 `some/nested/module` 中查找</span>
    <span class="token operator">...</span><span class="token function">mapState</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
      <span class="token function-variable function">a</span><span class="token operator">:</span> <span class="token parameter">state</span> <span class="token operator">=></span> state<span class="token punctuation">.</span>a<span class="token punctuation">,</span>
      <span class="token function-variable function">b</span><span class="token operator">:</span> <span class="token parameter">state</span> <span class="token operator">=></span> state<span class="token punctuation">.</span>b
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">methods</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// 在 `some/nested/module` 中查找</span>
    <span class="token operator">...</span><span class="token function">mapActions</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
      <span class="token string">'foo'</span><span class="token punctuation">,</span>
      <span class="token string">'bar'</span>
    <span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>Vuex 提供这些 API 都是方便我们在对 store 做各种操作来完成各种能力，尤其是 mapXXX 的设计，让我们在使用 API 的时候更加方便，这也是我们今后在设计一些 JavaScript 库的时候，从 API 设计角度中应该学习的方向。</p>
</blockquote>
<h4 id="插件"><a href="#插件" class="headerlink" title="插件"></a>插件</h4><p>Vuex 从设计上支持了插件，让我们很好地从外部追踪 store 内部地变化，Logger 插件在我们地开发阶段也提供了很好地指引作用。当然我们也可以自己去实现 Vuex 的插件，来帮助我们实现一些特定的需求。</p>
<h3 id="源码"><a href="#源码" class="headerlink" title="源码"></a>源码</h3><h4 id="工具函数"><a href="#工具函数" class="headerlink" title="工具函数"></a>工具函数</h4><h5 id="深拷贝"><a href="#深拷贝" class="headerlink" title="深拷贝"></a>深拷贝</h5><p><a href="https://datura35422.github.io/posts/57752/#Vuex%E6%BA%90%E7%A0%81">https://datura35422.github.io/posts/57752/#Vuex%E6%BA%90%E7%A0%81</a></p>
<h5 id="循环对象键值对"><a href="#循环对象键值对" class="headerlink" title="循环对象键值对"></a>循环对象键值对</h5><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">/**
 * forEach for object
 */</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">forEachValue</span> <span class="token punctuation">(</span><span class="token parameter">obj<span class="token punctuation">,</span> fn</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">key</span> <span class="token operator">=></span> <span class="token function">fn</span><span class="token punctuation">(</span>obj<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h5 id="判断数据类型"><a href="#判断数据类型" class="headerlink" title="判断数据类型"></a>判断数据类型</h5><p>判断数据是否是对象应该还要考虑数组的情况 <code>typeof [] === &#39;object&#39;</code></p>
<p>判断数据是否是 <code>promise</code> 类型，其实就是判断 <code>thenable</code> 类型</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">isObject</span> <span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> obj <span class="token operator">!==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">typeof</span> obj <span class="token operator">===</span> <span class="token string">'object'</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">isPromise</span> <span class="token punctuation">(</span><span class="token parameter">val</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> val <span class="token operator">&amp;&amp;</span> <span class="token keyword">typeof</span> val<span class="token punctuation">.</span>then <span class="token operator">===</span> <span class="token string">'function'</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h5 id="高级函数"><a href="#高级函数" class="headerlink" title="高级函数"></a>高级函数</h5><p>使用闭包的方式将函数和参数存储起来，延迟执行。</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">partial</span> <span class="token punctuation">(</span><span class="token parameter">fn<span class="token punctuation">,</span> arg</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token function">fn</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="面试题"><a href="#面试题" class="headerlink" title="面试题"></a>面试题</h3><p><a href="https://github.com/vuejs/vuex/tree/dev/examples/shopping-cart">基于Vue设计一个购物车（组件结构，vuex state 数据结构）</a></p>
<p><a href="https://juejin.cn/post/6844903993374670855">Vuex面试题汇总</a></p>
<p><a href="https://juejin.cn/post/6844904054108192776">vuex为什么不建议在action中修改state</a></p>
<h3 id="更多阅读"><a href="#更多阅读" class="headerlink" title="更多阅读"></a>更多阅读</h3><p><a href="https://github.com/zero2one3/Vuex-Analysis">https://github.com/zero2one3/Vuex-Analysis</a></p>
<p><a href="https://mp.weixin.qq.com/s/qQxUCbPBYSq9vU7dvDOCzg">学习 vuex 源码整体架构，打造属于自己的状态管理库 - 若川视野</a>：<a href="https://github.com/lxchuan12/vuex-analysis">https://github.com/lxchuan12/vuex-analysis</a></p>
<p><a href="https://ustbhuangyi.github.io/vue-analysis/v2/vuex/#vuex-%E6%A0%B8%E5%BF%83%E6%80%9D%E6%83%B3">https://ustbhuangyi.github.io/vue-analysis/v2/vuex/#vuex-%E6%A0%B8%E5%BF%83%E6%80%9D%E6%83%B3</a></p>
<p><a href="https://mp.weixin.qq.com/s/TYdppDvscuGpkblOmaosDQ">Vuex 4.0 正式发布！新年，官方生态齐聚一堂。</a></p>
]]></content>
      <categories>
        <category>前端</category>
        <category>vue</category>
      </categories>
      <tags>
        <tag>前端</tag>
        <tag>vue</tag>
        <tag>vuex</tag>
      </tags>
  </entry>
  <entry>
    <title>vue系列-vue进阶</title>
    <url>/posts/26604/</url>
    <content><![CDATA[<h3 id="源码学习总结"><a href="#源码学习总结" class="headerlink" title="源码学习总结"></a>源码学习总结</h3><ol>
<li><p>函数柯里化的使用，如patch部分。</p>
</li>
<li><p>工具类纯函数的封装和解耦，不管多小的功能，如判断值是否有效，<code>!== null || !== undefined</code> 也可以封装成纯函数。</p>
</li>
<li><p>代码中节点的处理使用了深度优先的思想和递归。</p>
</li>
<li><p>闭包。善用闭包，将简单的暂存操作也可以提取成闭包进行代码优化。</p>
</li>
<li><p>策略模式。options的合并策略。</p>
</li>
<li><p>链表数据结构。类似链表的数据结构建立组件间的父子关系。</p>
</li>
<li><p>确保函数只执行一次。</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">once</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">fn</span><span class="token operator">:</span> Function</span><span class="token punctuation">)</span><span class="token operator">:</span> Function <span class="token punctuation">&#123;</span>
  <span class="token keyword">let</span> called <span class="token operator">=</span> <span class="token boolean">false</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>called<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      called <span class="token operator">=</span> <span class="token boolean">true</span>
      <span class="token function">fn</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> arguments<span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
<li></li>
</ol>
<h4 id="patch"><a href="#patch" class="headerlink" title="patch"></a>patch</h4><p>patch 的整体流程： createComponent -&gt; 子组件初始化 -&gt; 子组件 render -&gt; 子组件patch</p>
<p>activeInstance 为当前激活的 vm 实例；vm.$vnode 为组件的占位 vnode；vm._vnode 为组件的渲染 vnode。</p>
<p>嵌套组件的插入顺序是先子后父。</p>
<h4 id="子组件构造"><a href="#子组件构造" class="headerlink" title="子组件构造"></a>子组件构造</h4><p>子组件的构造器是继承于Vue构造器的。</p>
<p>组件的插入是先子后父，递归到子组件深度后执行插入。</p>
<p>占位符VNode表示在父组件中占位的组件，真实渲染是需要进入到占位符的组件中去拿到数据渲染。</p>
<h4 id="合并策略"><a href="#合并策略" class="headerlink" title="合并策略"></a>合并策略</h4><p>外部调用场景下的合并配置是通过 mergeOption，并遵循一定的合并策略。</p>
<p>组件合并是通过 initInternalComponent，它的合并更快。</p>
<p>框架、库的设计都是类似，自身定义了默认配置，同时可以在初始化阶段传入配置，然后 merge 配置，来达到定制化不同需求的目的。</p>
<h3 id="周边生态"><a href="#周边生态" class="headerlink" title="周边生态"></a>周边生态</h3><h4 id="插件编写"><a href="#插件编写" class="headerlink" title="插件编写"></a>插件编写</h4><p>Vue 编写插件的时候通常要提供静态的 install 方法。</p>
<p>如果没有 install 方法则插件本身就是安装过程。</p>
<h3 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h3><h4 id="系列链接"><a href="#系列链接" class="headerlink" title="系列链接"></a>系列链接</h4><p><a href="http://hcysun.me/vue-design/zh/essence-of-comp.html">Vue 渲染器 - Hcysunyang</a></p>
<p><a href="https://ustbhuangyi.github.io/vue-analysis/v2/prepare/">Vue.js技术揭秘</a>：GitHub源码部分 - <a href="https://github.com/ustbhuangyi/vue-analysis">https://github.com/ustbhuangyi/vue-analysis</a></p>
<p><a href="https://www.kancloud.cn/hanxt/vuejs2/1301787">VUE深入浅出系列 – 看云</a></p>
<p><a href="http://hcysun.me/vue-design/zh/essence-of-comp.html#%E7%BB%84%E4%BB%B6%E7%9A%84%E4%BA%A7%E5%87%BA%E6%98%AF%E4%BB%80%E4%B9%88">Vue源码分析</a></p>
<h4 id="涉及到的MDN知识点部分"><a href="#涉及到的MDN知识点部分" class="headerlink" title="涉及到的MDN知识点部分"></a>涉及到的MDN知识点部分</h4><p>因为后面懒得整理了。</p>
<p><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Document/querySelector">document.querySelector()</a>：文档对象模型<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Document"><code>Document</code></a>引用的<code>querySelector()</code>方法返回文档中与指定选择器或选择器组匹配的第一个 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/HTMLElement"><code>HTMLElement</code></a>对象。 如果找不到匹配项，则返回<code>null</code>。</p>
<blockquote>
<p><strong>提示</strong>: 匹配是使用<em>深度优先先序遍历</em>，从文档标记中的第一个元素开始，并按子节点的顺序依次遍历。</p>
</blockquote>
<p><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Element/outerHTML">element.outerHTML</a>： <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Element"><code>element</code></a> DOM接口的<code>outerHTML</code>属性获取描述元素（包括其后代）的序列化HTML片段。它也可以设置为用从给定字符串解析的节点替换元素。</p>
]]></content>
      <categories>
        <category>前端</category>
        <category>vue</category>
      </categories>
      <tags>
        <tag>前端</tag>
        <tag>vue</tag>
      </tags>
  </entry>
  <entry>
    <title>vue系列-vue入门</title>
    <url>/posts/28605/</url>
    <content><![CDATA[<p>Vue官网：<a href="https://cn.vuejs.org/v2/guide/installation.html">https://cn.vuejs.org/v2/guide/installation.html</a></p>
<p>Vue-Cli 官网：<a href="https://cli.vuejs.org/zh/guide/">https://cli.vuejs.org/zh/guide/</a></p>
<p>当前文档为<strong>2.x</strong>版本</p>
<h3 id="理论"><a href="#理论" class="headerlink" title="理论"></a>理论</h3><h4 id="常见概念"><a href="#常见概念" class="headerlink" title="常见概念"></a>常见概念</h4><p><strong>双向绑定</strong>：在表单控件或者组件上使用 v-model 创建双向绑定。数据修改视图会进行修改，视图修改数据也会跟着修改。即vue实例中的data与其渲染的DOM元素的内容保持一致，无论谁被改变，另一方会相应的更新为相同的数据。这是通过设置属性访问器实现的。</p>
<blockquote>
<p>双向绑定 = 单向绑定 + UI事件监听</p>
</blockquote>
<h4 id="vue是什么"><a href="#vue是什么" class="headerlink" title="vue是什么"></a><a href="https://cn.vuejs.org/v2/guide/index.html">vue是什么</a></h4><p>Vue 是一套用于构建用户界面的<strong>渐进式框架</strong>。</p>
<p>与其它大型框架不同的是，Vue 被设计为可以<strong>自底向上逐层应用</strong>。</p>
<p>Vue 的核心库<strong>只关注视图层</strong>，不仅易于上手，还便于与第三方库或既有项目整合。</p>
<p>另一方面，当与<a href="https://cn.vuejs.org/v2/guide/single-file-components.html">现代化的工具链</a>以及各种<a href="https://github.com/vuejs/awesome-vue#libraries--plugins">支持类库</a>结合使用时，Vue 也完全能够为复杂的单页应用提供驱动。</p>
<blockquote>
<p><a href="https://www.zhihu.com/question/51907207">Vue2.0 中，“渐进式框架”和“自底向上增量开发的设计”这两个概念是什么？</a></p>
<p>框架做分层设计，每层都可选，不同层可以灵活接入其他方案。</p>
</blockquote>
<p>Vue.js 一个核心思想是<strong>数据驱动</strong>。所谓数据驱动，是指视图是由数据驱动生成的，我们对视图的修改，不会直接操作 DOM，而是通过修改数据。</p>
<blockquote>
<p>没有完全遵循 <a href="https://zh.wikipedia.org/wiki/MVVM">MVVM 模型</a>，但是核心思想相同。<a href="https://datura35422.github.io/posts/17715/">MVVM与其他架构模型有什么不同</a></p>
</blockquote>
<p><img src="/./vue%E7%89%B9%E7%82%B9.jpg" alt="vue特点"></p>
<h5 id="版本"><a href="#版本" class="headerlink" title="版本"></a>版本</h5><h6 id="Runtime-Compiler"><a href="#Runtime-Compiler" class="headerlink" title="Runtime + Compiler"></a>Runtime + Compiler</h6><p>包含编译代码的，可以把编译过程放在运行时做。引用的 <code>vue</code> 版本文件<code>vue.js</code></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 需要编译器</span>
<span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
  <span class="token literal-property property">template</span><span class="token operator">:</span> <span class="token string">'&lt;div>&#123;&#123; hi &#125;&#125;&lt;/div>'</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>编译器会将 <code>template</code> 进行<code>parse AST -&gt; optimiz -&gt; codegen</code> 后生成使用 <code>with(this)&#123;...&#125;</code> 包裹的函数，然后在运行的时候进行使用。</p>
<h6 id="Runtime-Only"><a href="#Runtime-Only" class="headerlink" title="Runtime Only"></a>Runtime Only</h6><p>推荐使用。不包含编译代码的，需要借助 webpack 的 <code>vue-loader</code> 事先把模板编译成 <code>render</code>函数。引用的 <code>vue</code> 版本文件<code>vue.runtime.js</code></p>
<blockquote>
<p>当使用 <code>vue-loader</code> 的时候，<code>*.vue</code> 文件内部的模板会在构建时预编译成 JavaScript。</p>
</blockquote>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 不需要编译器</span>
<span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
  <span class="token function">render</span> <span class="token punctuation">(</span><span class="token parameter">h</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>hi<span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h4 id="响应式系统"><a href="#响应式系统" class="headerlink" title="响应式系统"></a><a href="https://cn.vuejs.org/v2/guide/reactivity.html">响应式系统</a></h4><p>当一个 Vue 实例被创建时，它将 <code>data</code> 对象中的所有的 property 加入到 Vue 的<strong>响应式系统</strong>中。当这些 property 的值发生改变时，视图将会产生“响应”，即匹配更新为新的值。当这些数据改变时，视图会进行重渲染。值得注意的是只有当实例被创建时就已经存在于 <code>data</code> 中的 property 才是<strong>响应式</strong>的。</p>
<p>当你把一个普通的 JavaScript 对象传入 Vue 实例作为 <code>data</code> 选项，Vue 将遍历此对象所有的 property，并使用 <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object/defineProperty"><code>Object.defineProperty</code></a> 把这些 property 全部转为 <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Guide/Working_with_Objects#%E5%AE%9A%E4%B9%89_getters_%E4%B8%8E_setters">getter/setter</a>。</p>
<blockquote>
<p>在 setter 中设置监听，在 getter 中响应监听事件</p>
</blockquote>
<p>每个组件实例都对应一个 <strong>watcher</strong> 实例，它会在组件渲染的过程中把“接触”过的数据 property 记录为依赖（进行依赖收集）。之后当依赖项的 setter 触发时，会通知 watcher，从而使它关联的组件重新渲染。</p>
<blockquote>
<p><code>Object.defineProperty</code> 是 ES5 中一个无法 shim 的特性，这也就是 Vue 不支持 IE8 以及更低版本浏览器的原因。</p>
</blockquote>
<p><img src="/./%E5%93%8D%E5%BA%94%E5%BC%8F%E5%8E%9F%E7%90%86.png" alt="响应式原理"></p>
<h5 id="检测变化的注意事项"><a href="#检测变化的注意事项" class="headerlink" title="检测变化的注意事项"></a>检测变化的注意事项</h5><p>由于 js 的限制，vue不能检测数组和对象的变化。</p>
<p>由于 Vue 不允许动态添加根级响应式 property，所以你<strong>必须在初始化实例前声明所有根级响应式 property</strong>，哪怕只是一个空值。</p>
<h6 id="对于对象"><a href="#对于对象" class="headerlink" title="对于对象"></a>对于对象</h6><p><strong>Vue 无法检测 property 的添加或移除</strong>。由于 Vue 会在初始化时对对象进行 <code>getter / setter</code> 的转化，所以 property 必须在 data 对象上存在才能让 Vue 将它转换为响应式的。</p>
<p>对于已经创建的实例，Vue 不允许动态添加根级别的响应式 property。但是，可以使用 <code>Vue.set(object, propertyName, value)</code> 方法向嵌套对象添加响应式 property。</p>
<blockquote>
<p>还可以使用 <code>vm.$set</code> 实例方法，这也是全局 <code>Vue.set</code> 方法的别名</p>
</blockquote>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> vm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
  <span class="token literal-property property">data</span><span class="token operator">:</span><span class="token punctuation">&#123;</span>
    <span class="token literal-property property">a</span><span class="token operator">:</span><span class="token number">1</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>

<span class="token comment">// `vm.a` 是响应式的</span>

vm<span class="token punctuation">.</span>b <span class="token operator">=</span> <span class="token number">2</span>
<span class="token comment">// `vm.b` 是非响应式的</span>

<span class="token comment">// 添加响应式属性</span>
Vue<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>vm<span class="token punctuation">.</span>someObject<span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
<span class="token comment">// 或</span>
<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$set</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>someObject<span class="token punctuation">,</span><span class="token string">'b'</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>有时需要为已有对象赋值多个新 property，比如使用 <code>Object.assign()</code> 或 <code>_.extend()</code>。但是，这样添加到对象上的新 property 不会触发更新。在这种情况下，应该用原对象与要混合进去的对象的 property 一起创建一个新的对象。</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 代替 `Object.assign(this.someObject, &#123; a: 1, b: 2 &#125;)`</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>someObject <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>someObject<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token literal-property property">b</span><span class="token operator">:</span> <span class="token number">2</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<h6 id="对于数组"><a href="#对于数组" class="headerlink" title="对于数组"></a>对于数组</h6><p>Vue 不能检测一下的数组变动：</p>
<ol>
<li>当你利用索引直接设置一个数组项时，例如：<code>vm.items[indexOfItem] = newValue</code></li>
<li>当你修改数组的长度时，例如：<code>vm.items.length = newLength</code></li>
</ol>
<p>使用 Vue.set 的方式触发数组的响应式状态更新。</p>
<p>或者使用 push、pop、shift、unshift、splice、sort、reverse进行操作原数组，Vue 实现了这些方法的重写。</p>
 <pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> def <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'../util/index'</span>

<span class="token comment">// 重写原型链上修改数组的方法 利用原型链继承的方式重新设置数组类型</span>
<span class="token keyword">const</span> arrayProto <span class="token operator">=</span> <span class="token class-name">Array</span><span class="token punctuation">.</span>prototype
<span class="token keyword">export</span> <span class="token keyword">const</span> arrayMethods <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>arrayProto<span class="token punctuation">)</span>

<span class="token keyword">const</span> methodsToPatch <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token string">'push'</span><span class="token punctuation">,</span>
  <span class="token string">'pop'</span><span class="token punctuation">,</span>
  <span class="token string">'shift'</span><span class="token punctuation">,</span>
  <span class="token string">'unshift'</span><span class="token punctuation">,</span>
  <span class="token string">'splice'</span><span class="token punctuation">,</span>
  <span class="token string">'sort'</span><span class="token punctuation">,</span>
  <span class="token string">'reverse'</span>
<span class="token punctuation">]</span>

<span class="token comment">/**
 * Intercept mutating methods and emit events
 */</span>
methodsToPatch<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">method</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token comment">// cache original method</span>
  <span class="token keyword">const</span> original <span class="token operator">=</span> arrayProto<span class="token punctuation">[</span>method<span class="token punctuation">]</span>
  <span class="token function">def</span><span class="token punctuation">(</span>arrayMethods<span class="token punctuation">,</span> method<span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token function">mutator</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token function">original</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span>
    <span class="token keyword">const</span> ob <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>__ob__
    <span class="token keyword">let</span> inserted
    <span class="token keyword">switch</span> <span class="token punctuation">(</span>method<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">case</span> <span class="token string">'push'</span><span class="token operator">:</span>
      <span class="token keyword">case</span> <span class="token string">'unshift'</span><span class="token operator">:</span>
        inserted <span class="token operator">=</span> args
        <span class="token keyword">break</span>
      <span class="token keyword">case</span> <span class="token string">'splice'</span><span class="token operator">:</span>
        inserted <span class="token operator">=</span> args<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
        <span class="token keyword">break</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>inserted<span class="token punctuation">)</span> ob<span class="token punctuation">.</span><span class="token function">observeArray</span><span class="token punctuation">(</span>inserted<span class="token punctuation">)</span>
    <span class="token comment">// notify change</span>
    <span class="token comment">// 修改数组的方法绑定了响应式 进行修改数组api操作就会通知数据修改</span>
    ob<span class="token punctuation">.</span>dep<span class="token punctuation">.</span><span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> result
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h5 id="异步更新队列"><a href="#异步更新队列" class="headerlink" title="异步更新队列"></a>异步更新队列</h5><p>Vue 在更新 DOM 时是<strong>异步</strong>执行的。</p>
<p>只要侦听到数据变化，Vue 将开启一个队列，并缓冲在同一事件循环中发生的所有数据变更。如果同一个 watcher 被多次触发，只会被推入到队列中一次。这种在缓冲时去除重复数据对于避免不必要的计算和 DOM 操作是非常重要的。</p>
<p>然后，在下一个的事件循环“tick”中（微任务），Vue 刷新队列并执行实际 (已去重的) 工作。Vue 在内部对异步队列尝试使用原生的 <code>Promise.then</code>、<code>MutationObserver</code> 和 <code>setImmediate</code>，如果执行环境不支持，则会采用 <code>setTimeout(fn, 0)</code> 代替。</p>
<p>为了在数据变化之后等待 Vue 完成更新 DOM，可以在数据变化之后立即使用 <code>Vue.nextTick(callback)</code>。</p>
<h5 id="如何进行的依赖收集"><a href="#如何进行的依赖收集" class="headerlink" title="如何进行的依赖收集"></a>如何进行的依赖收集</h5><p>时机：<strong>在初始化数据（props / data）的时候就进行依赖收集</strong>。</p>
<p>data初始化时做了是对定义 <code>data</code> 函数返回对象的遍历，通过 <code>proxy</code> 把每一个值 <code>vm._data.xxx</code> 都代理到 <code>vm.xxx</code> 上；同时调用 <code>observe</code> 方法观测整个 <code>data</code> 的变化，把 <code>data</code> 也变成响应式，可以通过 <code>vm._data.xxx</code> 访问到定义 <code>data</code> 返回函数中对应的属性。</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">initData</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">vm</span><span class="token operator">:</span> Component</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">let</span> data <span class="token operator">=</span> vm<span class="token punctuation">.</span>$options<span class="token punctuation">.</span>data
  data <span class="token operator">=</span> vm<span class="token punctuation">.</span>_data <span class="token operator">=</span> <span class="token keyword">typeof</span> data <span class="token operator">===</span> <span class="token string">'function'</span>
    <span class="token operator">?</span> <span class="token function">getData</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> vm<span class="token punctuation">)</span>
    <span class="token operator">:</span> data <span class="token operator">||</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isPlainObject</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    data <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
    process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">'production'</span> <span class="token operator">&amp;&amp;</span> <span class="token function">warn</span><span class="token punctuation">(</span>
      <span class="token string">'data functions should return an object:\n'</span> <span class="token operator">+</span>
      <span class="token string">'https://vuejs.org/v2/guide/components.html#data-Must-Be-a-Function'</span><span class="token punctuation">,</span>
      vm
    <span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span>
  <span class="token comment">// proxy data on instance</span>
  <span class="token keyword">const</span> keys <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token comment">// 获取到data的属性</span>
  <span class="token keyword">const</span> props <span class="token operator">=</span> vm<span class="token punctuation">.</span>$options<span class="token punctuation">.</span>props
  <span class="token keyword">const</span> methods <span class="token operator">=</span> vm<span class="token punctuation">.</span>$options<span class="token punctuation">.</span>methods
  <span class="token keyword">let</span> i <span class="token operator">=</span> keys<span class="token punctuation">.</span>length
  <span class="token keyword">while</span> <span class="token punctuation">(</span>i<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">// 遍历每个属性，进行判断是否和props、methods的属性名是否重合 如果重合则抛出错误</span>
    <span class="token keyword">const</span> key <span class="token operator">=</span> keys<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">'production'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>methods <span class="token operator">&amp;&amp;</span> <span class="token function">hasOwn</span><span class="token punctuation">(</span>methods<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">// Object.prototype.hasOwnProperty.call(obj, key)</span>
        <span class="token function">warn</span><span class="token punctuation">(</span>
          <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Method "</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>key<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">" has already been defined as a data property.</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
          vm
        <span class="token punctuation">)</span>
      <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>props <span class="token operator">&amp;&amp;</span> <span class="token function">hasOwn</span><span class="token punctuation">(</span>props<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">'production'</span> <span class="token operator">&amp;&amp;</span> <span class="token function">warn</span><span class="token punctuation">(</span>
        <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">The data property "</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>key<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">" is already declared as a prop. </span><span class="token template-punctuation string">`</span></span> <span class="token operator">+</span>
        <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Use prop default value instead.</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
        vm
      <span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isReserved</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">// Check if a string starts with $ or _ 其实就是检查这个属性是不是自定义属性 和vm实例上的vue属性区分开</span>
      <span class="token comment">// 将data的值代理到vm实例上</span>
      <span class="token function">proxy</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">_data</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> key<span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>
  <span class="token comment">// observe data 响应式处理data</span>
  <span class="token function">observe</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> <span class="token boolean">true</span> <span class="token comment">/* asRootData */</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>自定义的 proxy 方法实现通过 <code>Object.defineProperty</code> 把 <code>target[sourceKey][key]</code> 的读写变成了对 <code>target[key]</code> 的读写。将 data 中的数据挂在到实例上。</p>
<p><code>observe</code> 的功能就是用来监测数据的变化。<code>observe</code> 方法的作用就是给非 VNode 的对象类型数据添加一个 <code>Observer</code>，如果已经添加过则直接返回，否则在满足一定条件下去实例化一个 <code>Observer</code> 对象实例。</p>
<p><code>Observer</code> 的构造函数，接下来会对 <code>value</code> 做判断，对于数组会调用 <code>observeArray</code> 方法，否则对纯对象调用 <code>walk</code> 方法。</p>
<p><code>defineReactive</code> 函数最开始初始化 <code>Dep</code> 对象的实例，接着拿到 <code>obj</code> 的属性描述符，然后对子对象递归调用 <code>observe</code> 方法，这样就保证了无论 <code>obj</code> 的结构多复杂，它的所有子属性也能变成响应式的对象，这样我们访问或修改 <code>obj</code> 中一个嵌套较深的属性，也能触发 getter 和 setter。最后利用 <code>Object.defineProperty</code> 去给 <code>obj</code> 的属性 <code>key</code> 添加 getter 和 setter。</p>
<blockquote>
<p>观察者模式</p>
</blockquote>
<h4 id="生命周期钩子"><a href="#生命周期钩子" class="headerlink" title="生命周期钩子"></a><a href="https://cn.vuejs.org/v2/guide/instance.html#%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E5%9B%BE%E7%A4%BA">生命周期钩子</a></h4><p>每个 Vue 实例在被创建时都要经过一系列的初始化过程——例如，需要设置数据监听、编译模板、将实例挂载到 DOM 并在数据变化时更新 DOM 等。同时在这个过程中也会运行一些叫做<strong>生命周期钩子</strong>的函数，这给了用户在不同阶段添加自己的代码的机会。</p>
<blockquote>
<p>生命周期函数就是在初始化及数据更新过程各个阶段执行不同的钩子函数</p>
</blockquote>
<p><img src="/posts/28605/lifecycle.png" alt="lifecycle"></p>
<p>生命周期钩子的 <code>this</code> 上下文指向调用它的 Vue 实例。</p>
<blockquote>
<p>所以不能使用箭头函数来定义一个生命周期方法。箭头函数绑定了父级上下文，this 无法指向预期的组件实例。</p>
</blockquote>
<p>在<code>beforeCreate</code>时，<code>data/prop</code>还没有注入到<code>vm</code>实例中，所以是无法获取到<code>data</code>数据的。</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// vue2.6x源码部分 4999-5008</span>
<span class="token comment">// expose real self</span>
vm<span class="token punctuation">.</span>_self <span class="token operator">=</span> vm
<span class="token function">initLifecycle</span><span class="token punctuation">(</span>vm<span class="token punctuation">)</span> <span class="token comment">// 初始化生命周期</span>
<span class="token function">initEvents</span><span class="token punctuation">(</span>vm<span class="token punctuation">)</span> <span class="token comment">// 初始化事件</span>
<span class="token function">initRender</span><span class="token punctuation">(</span>vm<span class="token punctuation">)</span> <span class="token comment">// 初始化渲染函数</span>
<span class="token function">callHook</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> <span class="token string">'beforeCreate'</span><span class="token punctuation">)</span>
<span class="token function">initInjections</span><span class="token punctuation">(</span>vm<span class="token punctuation">)</span> <span class="token comment">// resolve injections before data/props</span>
<span class="token function">initState</span><span class="token punctuation">(</span>vm<span class="token punctuation">)</span> <span class="token comment">// 初始化状态 初始化顺序 props methods data computed watch</span>
<span class="token function">initProvide</span><span class="token punctuation">(</span>vm<span class="token punctuation">)</span> <span class="token comment">// resolve provide after data/props</span>
<span class="token function">callHook</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> <span class="token string">'created'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>所以在<code>created</code>时才能获取到<code>data/prop</code>数据并进行交互。</p>
<h5 id="子组件和父组件的生命周期调用"><a href="#子组件和父组件的生命周期调用" class="headerlink" title="子组件和父组件的生命周期调用"></a>子组件和父组件的生命周期调用</h5><p>子组件的其他生命周期在<code>patch</code>时传入，父组件先进行<code>beforeMount</code>然后进行对子组件的递归处理。所以父子组件<em>创建-挂载</em>的生命周期执行顺序是：<code>parent beforeCreate -&gt; parent created -&gt; parent beforeMount -&gt; son beforeCreate -&gt; son created -&gt; son beforeMount -&gt; son mounted -&gt; parent mounted</code></p>
<p>父组件销毁时，父子组件<em>销毁</em>的生命周期执行顺序时：<code>parent beforeDestroy -&gt; son beforeDestroy -&gt; son destroyed -&gt; parent destroyed</code></p>
<p>所以：</p>
<ul>
<li>在created钩子函数中可以访问到数据</li>
<li>在mounted钩子函数中可以访问到DOM</li>
<li>在destroyed钩子函数中可以做一些定时器销毁工作</li>
</ul>
<h5 id="除了常规的组件生命周期，还有"><a href="#除了常规的组件生命周期，还有" class="headerlink" title="除了常规的组件生命周期，还有"></a>除了常规的组件生命周期，还有</h5><ul>
<li><p>activated：被 keep-alive 缓存的组件激活时调用。该钩子在服务器渲染期间不被调用。</p>
</li>
<li><p>deactivated：被 keep-alive 缓存的组件失活时调用。该钩子在服务器渲染期间不被调用。</p>
</li>
<li><p>errorCaptured：在捕获一个来自后代组件的错误时被调用。此钩子会收到三个参数：错误对象、发生错误的组件实例以及一个包含错误来源信息的字符串。此钩子可以返回 <code>false</code> 以阻止该错误继续向上传播。</p>
<blockquote>
<p>你可以在此钩子中修改组件的状态。因此在捕获错误时，在模板或渲染函数中有一个条件判断来绕过其它内容就很重要；不然该组件可能会进入一个无限的渲染循环。</p>
<p><strong>错误传播规则</strong></p>
<ul>
<li>默认情况下，如果全局的 <code>config.errorHandler</code> 被定义，所有的错误仍会发送它，因此这些错误仍然会向单一的分析服务的地方进行汇报。</li>
<li>如果一个组件的 inheritance chain (继承链)或 parent chain (父链)中存在多个 <code>errorCaptured</code> 钩子，则它们将会被相同的错误逐个唤起。</li>
<li>如果此 <code>errorCaptured</code> 钩子自身抛出了一个错误，则这个新错误和原本被捕获的错误都会发送给全局的 <code>config.errorHandler</code>。</li>
<li>一个 <code>errorCaptured</code> 钩子能够返回 <code>false</code> 以阻止错误继续向上传播。本质上是说“这个错误已经被搞定了且应该被忽略”。它会阻止其它任何会被这个错误唤起的 <code>errorCaptured</code> 钩子和全局的 <code>config.errorHandler</code>。</li>
</ul>
</blockquote>
</li>
</ul>
<h5 id="服务端的生命周期"><a href="#服务端的生命周期" class="headerlink" title="服务端的生命周期"></a>服务端的生命周期</h5><p>SSR 服务器渲染的生命周期和web渲染的生命周期不同，部分生命周期在服务器渲染期间不被调用。只会调用 beforeCreated、created 生命周期函数。</p>
<h5 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h5><p>Vue.js 的生命周期函数就是在初始化及数据更新过程各个阶段执行不同的钩子函数。</p>
<p>在 created 钩子函数中可以访问到数据，在 mounted 钩子函数中可以访问到 DOM，在 destroyed 钩子函数中可以做一些定时器销毁工作。</p>
<h4 id="虚拟DOM（Virtual-DOM）"><a href="#虚拟DOM（Virtual-DOM）" class="headerlink" title="虚拟DOM（Virtual DOM）"></a>虚拟DOM（Virtual DOM）</h4><p><code>Virtual DOM</code> 就是用一个原生的 JS 对象去描述一个 DOM 节点，所以它比创建一个 DOM 的代价要小很多。在 Vue.js 中，Virtual DOM 是用 <code>VNode</code> 这么一个 Class 去描述。</p>
<p>其实 VNode 是对真实 DOM 的一种抽象描述，它的核心定义无非就几个关键属性，标签名、数据、子节点、键值等，其它属性都是用来扩展 VNode 的灵活性以及实现一些特殊 feature 的。由于 VNode 只是用来映射到真实 DOM 的渲染，不需要包含操作 DOM 的方法，因此它是非常轻量和简单的。</p>
<h4 id="组件化"><a href="#组件化" class="headerlink" title="组件化"></a>组件化</h4><p>所谓组件化，就是把页面拆分成多个组件 (component)，每个组件依赖的 CSS、JavaScript、模板、图片等资源放在一起开发和维护。组件是资源独立的，组件在系统内部可复用，组件和组件之间可以嵌套。</p>
<p>就可以类似搭积木的方式去拼装页面。</p>
<p>实现业务和功能解耦。降低了页面的维护成本。</p>
<p>组件注册的两种方式：<strong>全局注册</strong>（<code>Vue.component(&#39;app&#39;, App)</code>）和<strong>局部注册</strong>（<code>components: &#123;app: App&#125;</code>）。</p>
<p>全局注册的方式会在<code>Vue</code>原型链上进行扩展，一次引入任意地方使用，而局部注册的方式只是在父组件上添加，只有引入才能使用。全局注册的组件可以在任意地方使用，而局部注册的组件只能在当前组件内使用。</p>
<p>通常组件库中的基础组件会使用全局注册，而业务相关的组件会进行局部注册。</p>
<p>组件引入优化，组件库组件进行按需注册，全部注册也会造成资源的浪费。如使用<a href="https://antdv.com/docs/vue/getting-started-cn/"><code>Antd</code></a>组件库进行开发。</p>
<h4 id="Diff算法"><a href="#Diff算法" class="headerlink" title="Diff算法"></a>Diff算法</h4><p>推荐阅读：<a href="https://juejin.cn/post/6994959998283907102">15张图，20分钟吃透Diff算法核心原理，我说的！！！</a></p>
<p>patch组件的情况有：</p>
<ul>
<li>首次渲染创建新节点；</li>
<li>仅旧节点存在新节点的不存在表示移除旧节点；</li>
<li>仅新节点存在旧节点不存在表示新增新节点；</li>
<li>挂载真实节点，新旧节点不一致则表示销毁旧节点挂载新节点，新旧节点一致进行内容比对。</li>
</ul>
<p>主要讨论新旧节点一致（且新节点的父节点不为真实节点）的情况。</p>
<p>这里的<strong>一致</strong>表示在key值相等的前提下，tag（tagName）、同为或同不为注释节点、定义了data、同为或同不为input元素的条件都满足或同为异步组件的条件下，才判定为是相同的节点。（data中包含了id、class、style的属性值。）</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">sameVnode</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token comment">// key值相等是前提 然后再进行比对（tag、注释节点、data、都是Input节点） 或 （异步节点 异步包装函数相同 b节点的异步包装函数error未定义）</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    a<span class="token punctuation">.</span>key <span class="token operator">===</span> b<span class="token punctuation">.</span>key <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>
      <span class="token punctuation">(</span>
        a<span class="token punctuation">.</span>tag <span class="token operator">===</span> b<span class="token punctuation">.</span>tag <span class="token operator">&amp;&amp;</span>
        a<span class="token punctuation">.</span>isComment <span class="token operator">===</span> b<span class="token punctuation">.</span>isComment <span class="token operator">&amp;&amp;</span>
        <span class="token function">isDef</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>data<span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token function">isDef</span><span class="token punctuation">(</span>b<span class="token punctuation">.</span>data<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
        <span class="token function">sameInputType</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span>
      <span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">(</span>
        <span class="token function">isTrue</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>isAsyncPlaceholder<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
        a<span class="token punctuation">.</span>asyncFactory <span class="token operator">===</span> b<span class="token punctuation">.</span>asyncFactory <span class="token operator">&amp;&amp;</span>
        <span class="token function">isUndef</span><span class="token punctuation">(</span>b<span class="token punctuation">.</span>asyncFactory<span class="token punctuation">.</span>error<span class="token punctuation">)</span>
      <span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 比较两个input节点是否相同 或都不是input节点</span>
<span class="token keyword">function</span> <span class="token function">sameInputType</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>a<span class="token punctuation">.</span>tag <span class="token operator">!==</span> <span class="token string">'input'</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">true</span>
  <span class="token keyword">let</span> i
  <span class="token keyword">const</span> typeA <span class="token operator">=</span> <span class="token function">isDef</span><span class="token punctuation">(</span>i <span class="token operator">=</span> a<span class="token punctuation">.</span>data<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isDef</span><span class="token punctuation">(</span>i <span class="token operator">=</span> i<span class="token punctuation">.</span>attrs<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> i<span class="token punctuation">.</span>type
  <span class="token keyword">const</span> typeB <span class="token operator">=</span> <span class="token function">isDef</span><span class="token punctuation">(</span>i <span class="token operator">=</span> b<span class="token punctuation">.</span>data<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isDef</span><span class="token punctuation">(</span>i <span class="token operator">=</span> i<span class="token punctuation">.</span>attrs<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> i<span class="token punctuation">.</span>type
  <span class="token keyword">return</span> typeA <span class="token operator">===</span> typeB <span class="token operator">||</span> <span class="token function">isTextInputType</span><span class="token punctuation">(</span>typeA<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isTextInputType</span><span class="token punctuation">(</span>typeB<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p><strong>进行新旧节点比对（patchVnode）</strong>：</p>
<ul>
<li>如果旧节点等于新节点则直接退出比对。</li>
<li>如果是非异步组件，判断新节点的 <code>prepatch</code> 方法是否存在，存在则执行<code>prepatch(oldVnode, vnode)</code>方法。</li>
<li>如果新节点定义了data且为可挂载节点（有真实节点实例），循环执行 <code>update hook</code> 。</li>
<li>判断是否为文本节点（文本节点已经为组件的最内层的节点了）：<ul>
<li>如果新节点不是文本节点，则进一步判断新旧节点是否都存在子节点。<ul>
<li>如果都存在子节点且不相等就更新子节点（updateChildren）。</li>
<li>如果仅新节点存在子节点则进一步判断旧节点是否为文本节点是就置空，添加新节点。</li>
<li>如果仅旧节点存在子节点则删除旧节点的子节点。</li>
<li>如果都不存在子节点，且旧节点为文本节点，则置空旧节点的文本。</li>
</ul>
</li>
<li>如果新旧节点都是文本节点且值不相等，则直接替换旧节点的文本节点。</li>
</ul>
</li>
<li>如果新节点的<code>postpatch</code>方法存在，则执行<code>postpatch(oldVnode, vnode)</code>方法。</li>
</ul>
<p><strong>子节点比对更新（updateChildren），采用头尾指针的方式进行，先设置新旧子节点的头尾index值、node值，循环遍历新旧节点的子节点差异，直到旧节点的子节点（oldCh）头尾指针交叉或新节点的子节点（newCh）头尾指针交叉为止</strong>：</p>
<ul>
<li><p>oldCh 头指针指向的node节点无效，oldCh继续向后查找<code>++oldStartIdx</code>。</p>
</li>
<li><p>oldCh 尾指针指向的node节点无效，oldCh继续向前查找<code>--oldEndIdx</code>。</p>
</li>
<li><p>oldCh 和 newCh 头指针指向的node节点一致，进行 <code>patchVnode</code> 递归，比对后出栈，oldCh 和 newCh 都继续向后查找。</p>
</li>
<li><p>oldCh 和 newCh 尾指针指向的node节点一致，进行 <code>patchVnode</code> 递归，比对后出栈，oldCh 和 newCh 都继续向前查找。</p>
</li>
<li><p>oldCh 头指针和 newCh 尾指针指向的node节点一致，进行 <code>patchVnode</code> 递归，比对后出栈，如果节点可移动（transition-group组件不可移动），则将比对更新后的 oldCh 头指针节点元素插入到当前oldCh尾指针的后面，oldCh 向后查找，newCh 向前查找。</p>
</li>
<li><p>oldCh 尾指针和 newCh 头指针指向的node节点一致，进行 <code>patchVnode</code> 递归，比对后出栈，如果节点可移动，则将比对更新后的 oldCh 尾指针节点元素插入到当前 oldCh 头指针的前面，oldCh 向前查找，newCh 向后查找。</p>
</li>
<li><p>如果oldCh 和 newCh 当前头尾指针指向的节点都没有关系，即完全没有一致的情况。先遍历获取 oldCh 的 key 值并以<code>key: index</code>键值对的方式存到对象<code>oldKeyToIdx</code>中。如果当前newCh的头指针节点有key值，则在<code>oldKeyToIdx</code>中查找，否则就在oldCh中进行遍历比对如果找到相等的node则返回所在oldCh中的索引，找不到则默认返回undefined。</p>
<ul>
<li>如果在oldCh中没有找到和newCh头指针一致的节点，就克隆newCh头指针的节点并插入到 oldCh 的头指针前。</li>
<li>如果在oldCh中找到了key值相同的节点：<ul>
<li>如果两个节点一致，则进行 <code>patchVnode</code> 递归，比对后出栈，如果当前节点可以可移动，则将更新后的 oldCh 子节点元素插入到 oldCh 头指针前，并置空 oldCh 中index对应的节点，避免重复处理。</li>
<li>如果两个节点不一致，即key值相同，但其实不同的节点，那就作为新的节点对待，克隆newCh头指针的节点并插入到 oldCh 的头指针前。</li>
</ul>
</li>
</ul>
<p>然后 newCh 向后查找。</p>
</li>
<li><p>循环遍历结束后。判断交叉情况：</p>
<ul>
<li>如果 oldCh 的头尾指针交叉，则表示 newCh 中有部分节点没有访问到，确定 newCh 中没有访问到的部分边界，如果 newCh 尾指针后一个节点为未定义，则表明 newCh 头指针及以后的节点都没有被访问到，否则未访问范围为当前 newCh 头指针到尾指针。</li>
<li>如果 newCh 的头尾指针交叉，则表示 oldCh 中有部分节点没有访问到，则移除这部分节点。</li>
</ul>
</li>
</ul>
<blockquote>
<p>使用双指针的方式进行比较，以及克隆节点的方式，能够有效的提升性能。</p>
</blockquote>
<p>可以从diff算法流程中得出，如果随意定义组件的key值则会造成不必要的步骤。diff算法对重排子组件的性能有明显的提升，使用了旧的节点元素进行拼接。</p>
<h4 id="编译"><a href="#编译" class="headerlink" title="编译"></a>编译</h4><h5 id="codegen"><a href="#codegen" class="headerlink" title="codegen"></a>codegen</h5><p>codegen 的目标是把 AST 树转换成代码字符串。</p>
<p>整个 codegen 过程就是深度遍历 AST 树根据不同条件生成不同代码的过程。</p>
<h3 id="实践"><a href="#实践" class="headerlink" title="实践"></a>实践</h3><h4 id="指令"><a href="#指令" class="headerlink" title="指令"></a>指令</h4><p>v-if 和 v-for 不能同时使用，v-for 的优先级要比 v-if 高，但是如果需要一起使用时，使用 template 组件进行v-if 判断后再进行 v-for 循环渲染。v-for 循环渲染避免每个元素进行 v-if 判断。</p>
<p><a href="https://cn.vuejs.org/v2/api/#v-pre"><code>v-pre</code></a>：跳过这个元素和它的子元素的编译过程。可以用来显示原始 Mustache 标签。跳过大量没有指令的节点会加快编译。</p>
<p><a href="https://cn.vuejs.org/v2/api/#v-cloak"><code>v-cloak</code></a>：这个指令保持在元素上直到关联实例结束编译。和 CSS 规则如 <code>[v-cloak] &#123; display: none &#125;</code> 一起用时，这个指令可以隐藏未编译的 Mustache 标签直到实例准备完毕。<strong>用于优化显示</strong>。</p>
<p><a href="https://cn.vuejs.org/v2/api/#v-once"><code>v-once</code></a>：只渲染元素和组件<strong>一次</strong>。随后的重新渲染，元素/组件及其所有的子节点将被视为静态内容并跳过。这可以用于优化更新性能。</p>
<h4 id="事件触发"><a href="#事件触发" class="headerlink" title="事件触发"></a>事件触发</h4><h5 id="事件穿透解决方案："><a href="#事件穿透解决方案：" class="headerlink" title="事件穿透解决方案："></a>事件穿透解决方案：</h5><p>参考链接：</p>
<p><a href="https://zhuanlan.zhihu.com/p/86347430">https://zhuanlan.zhihu.com/p/86347430</a></p>
<p>vue框架内置指令v-on:click有300ms的延迟响应，这是为了判断区分单击和双击。vue为移动端提供了触摸方法touchstart、touchmove、touchend，但却没有提供tap指令，因此需要自己手动定义v-tap去消除300ms延迟，提升移动端用户体验。</p>
<h5 id="Event事件"><a href="#Event事件" class="headerlink" title="Event事件"></a>Event事件</h5><p>event 在编译阶段生成相关的data，对于 DOM 事件在 patch 过程中的创建阶段和更新阶段执行 updateDOMListeners 生成 DOM 事件；对于自定义事件，会在组件初始化阶段通过 initEvents 创建。</p>
<p>原生 DOM 事件和自定义事件主要的区别在于添加和删除事件的方式不一样，并且自定义事件的派发是往当前实例上（子组件实例）派发，但是可以利用在父组件环境定义回调函数来实现父子组件的通讯。</p>
<h4 id="双向数据绑定-v-model"><a href="#双向数据绑定-v-model" class="headerlink" title="双向数据绑定 v-model"></a>双向数据绑定 v-model</h4><p>在<code>&lt;input&gt;</code>、<code>&lt;select&gt;</code>、<code>&lt;textarea&gt;</code> 表单元素上创建双向数据绑定，会根据控件类型自动选取正确的方法来更新元素。负责监听用户的输入事件以更新数据，并对一些极端场景进行一些特殊处理。</p>
<p>v-model 会忽略所有表单元素的 value、checked、selected属性的初始值，而总是将 Vue 实例的数据作为数据来源。</p>
<ul>
<li>text 和 textarea 元素使用 value 属性和 input 事件</li>
<li>checkbox 和 radio 使用 checked 属性和 change 事件</li>
<li>select 字段将 value 属性作为 prop 并将 change 作为事件</li>
</ul>
<h5 id="修饰符："><a href="#修饰符：" class="headerlink" title="修饰符："></a>修饰符：</h5><p>.lazy：在 change 事件之后进行同步。默认状态为在 input 事件出发后进行数据同步。</p>
<p>.number：自动将用户输入值转为数值类型。如果值无法被 parseFloat() 解析，则返回原始值。</p>
<p>.trim：自动过滤用户输入的首尾空白字符。</p>
<h5 id="应用场景："><a href="#应用场景：" class="headerlink" title="应用场景："></a>应用场景：</h5><ul>
<li><p>表单使用</p>
<ul>
<li>input 组件<ul>
<li>v-model 的功能与<code>&lt;input :value=&quot;message&quot; @input=&quot;message=$event.target.value&quot;&gt;</code>大致相同。</li>
<li>v-model 和 v-bind:value 的方式区别，v-model内部使用了 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Element/compositionstart_event">compositionstart</a> 事件监听，在用户使用输入法进行拼写的时候，拼写完成才触发 input 事件，减少了事件触发频率。</li>
</ul>
</li>
</ul>
</li>
<li><p><a href="https://cn.vuejs.org/v2/guide/components-custom-events.html#%E8%87%AA%E5%AE%9A%E4%B9%89%E7%BB%84%E4%BB%B6%E7%9A%84-v-model">组件使用</a></p>
<p>v-model 在子组件上使用会默认生成 prop 中的 value 属性和 input 事件。将父组件的值传入子组件 prop 的 value 中，使用 input 的函数进行派发传值，父子通讯。</p>
<p>也可以在子组件中定义 model 对象，指定 父组件的 v-model 对应子组件中自定义的 prop 和methods </p>
</li>
</ul>
<h5 id="总结："><a href="#总结：" class="headerlink" title="总结："></a>总结：</h5><ul>
<li>v-model 的本质就是语法糖，但是运行时也做了一些优化。</li>
<li>v-model 即可以支持原生表单元素，也可以支持组件。在组件的实现中，可以配置子组件接收的 prop 名称，以及派发的事件名称。</li>
</ul>
<h4 id="组件"><a href="#组件" class="headerlink" title="组件"></a>组件</h4><p><strong>一个组件的 <code>data</code> 选项必须是一个函数</strong>，因此每个实例可以维护一份被返回对象的独立的拷贝。<strong>避免组件复用时数据相互影响</strong>。使用闭包的原理封装出独立的环境。</p>
<p>数据流向：单向流动。父组件流向子组件。子组件不能修改prop值。</p>
<blockquote>
<p>防止从子组件意外变更父级组件的状态，从而导致你的应用的数据流向难以理解。</p>
<p>每次父级组件发生变更时，子组件中所有的 prop 都将会刷新为最新的值。</p>
<p>注意在 JavaScript 中对象和数组是通过引用传入的，所以对于一个数组或对象类型的 prop 来说，在子组件中改变变更这个对象或数组本身<strong>将会</strong>影响到父组件的状态。<strong>如果子组件复制prop的引用类型最好要进行深拷贝</strong>。</p>
</blockquote>
<p>子组件中的prop设置校验规则后，会在创建子组件实例之前校验prop。</p>
<h5 id="组件注册"><a href="#组件注册" class="headerlink" title="组件注册"></a><a href="https://cn.vuejs.org/v2/guide/components-registration.html">组件注册</a></h5><p>全局组件注册要在初始化Vue实例之前进行。使用<code>Vue.component(...)</code>方式进行创建。</p>
<h5 id="异步组件"><a href="#异步组件" class="headerlink" title="异步组件"></a><a href="https://cn.vuejs.org/v2/guide/components-dynamic-async.html">异步组件</a></h5><p>异步组件使用工厂函数进行异步导入组件，将应用分割成小一些的代码块。</p>
<blockquote>
<p>会进行两次及以上的渲染，因为 Vue 通常是数据驱动视图重新渲染，但是在整个异步组件加载过程中是没有数据发生变化的，所以要渲染异步组件需要强制刷新。</p>
</blockquote>
<h6 id="webpack-code-splitting"><a href="#webpack-code-splitting" class="headerlink" title="webpack + code splitting"></a>webpack + code splitting</h6><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">Vue<span class="token punctuation">.</span><span class="token function">component</span><span class="token punctuation">(</span><span class="token string">'async-webpack-example'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token comment">// 这个特殊的 `require` 语法将会告诉 webpack</span>
  <span class="token comment">// 自动将你的构建代码切割成多个包，这些包</span>
  <span class="token comment">// 会通过 Ajax 请求加载</span>
  <span class="token function">require</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'./my-async-component'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> resolve<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h6 id="import异步导入"><a href="#import异步导入" class="headerlink" title="import异步导入"></a>import异步导入</h6><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 全局注册</span>
Vue<span class="token punctuation">.</span><span class="token function">component</span><span class="token punctuation">(</span>
  <span class="token string">'async-webpack-example'</span><span class="token punctuation">,</span>
  <span class="token comment">// 这个动态导入会返回一个 `Promise` 对象。</span>
  <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'./my-async-component'</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>

<span class="token comment">// 局部注册</span>
<span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
  <span class="token comment">// ...</span>
  <span class="token literal-property property">components</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token string-property property">'my-component'</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'./my-async-component'</span><span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h6 id="高级异步组件-–-组件加载状态"><a href="#高级异步组件-–-组件加载状态" class="headerlink" title="高级异步组件 – 组件加载状态"></a>高级异步组件 – 组件加载状态</h6><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> LoadingComp <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  <span class="token literal-property property">template</span><span class="token operator">:</span> <span class="token string">'&lt;div>loading&lt;/div>'</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">const</span> ErrorComp <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  <span class="token literal-property property">template</span><span class="token operator">:</span> <span class="token string">'&lt;div>error&lt;/div>'</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">const</span> <span class="token function-variable function">AsyncComponent</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
  <span class="token comment">// 需要加载的组件 (应该是一个 `Promise` 对象)</span>
  <span class="token literal-property property">component</span><span class="token operator">:</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'./MyComponent.vue'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token comment">// 异步组件加载时使用的组件</span>
  <span class="token literal-property property">loading</span><span class="token operator">:</span> LoadingComponent<span class="token punctuation">,</span>
  <span class="token comment">// 加载失败时使用的组件</span>
  <span class="token literal-property property">error</span><span class="token operator">:</span> ErrorComponent<span class="token punctuation">,</span>
  <span class="token comment">// 展示加载时组件的延时时间。默认值是 200 (毫秒)</span>
  <span class="token literal-property property">delay</span><span class="token operator">:</span> <span class="token number">200</span><span class="token punctuation">,</span>
  <span class="token comment">// 如果提供了超时时间且组件加载也超时了，</span>
  <span class="token comment">// 则使用加载失败时使用的组件。默认值是：`Infinity`</span>
  <span class="token literal-property property">timeout</span><span class="token operator">:</span> <span class="token number">3000</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h5 id="组件间传值"><a href="#组件间传值" class="headerlink" title="组件间传值"></a>组件间传值</h5><h6 id="使用v-bind-prop传值"><a href="#使用v-bind-prop传值" class="headerlink" title="使用v-bind prop传值"></a>使用v-bind prop传值</h6><p>传入单个值。可以传入静态值或动态值。</p>
<pre class="line-numbers language-vue" data-language="vue"><code class="language-vue">&#x2F;&#x2F; 父组件
&lt;template&gt;
  &lt;div id&#x3D;&quot;app&quot;&gt;
    &lt;HelloWorld v-bind:authorObj&#x3D;&quot;author&quot; v-bind:author&#x3D;&quot;&#123; name: &#39;Veronica&#39;, company: &#39;Veridian Dynamics&#39; &#125;&quot; &#x2F;&gt;
  &lt;&#x2F;div&gt;
&lt;&#x2F;template&gt;

&#x2F;&#x2F; 子组件
props: &#123;
    author: Object,
	authorObj: Object
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>传入多个值。将所有欲传入子组件的值全部放到一个对象中。</p>
<pre class="line-numbers language-vue" data-language="vue"><code class="language-vue">&#x2F;&#x2F; 父组件
&lt;template&gt;
  &lt;div id&#x3D;&quot;app&quot;&gt;
    &lt;HelloWorld v-bind&#x3D;&quot;post&quot; &#x2F;&gt;
  &lt;&#x2F;div&gt;
&lt;&#x2F;template&gt;
...
data() &#123;
	return &#123;
		post: &#123;
            msg1: &#39;xxxx&#39;,
            author: &#123; name: &#39;Veronica&#39;, company: &#39;Veridian Dynamics&#39; &#125;
		&#125;
	&#125;
&#125;
...
&#x2F;&#x2F; 子组件
props: [&#39;msg&#39;,&#39;author&#39;],<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h6 id="省略v-bind-prop传值"><a href="#省略v-bind-prop传值" class="headerlink" title="省略v-bind prop传值"></a>省略v-bind prop传值</h6><p>单个传值。</p>
<pre class="line-numbers language-vue" data-language="vue"><code class="language-vue">&#x2F;&#x2F; 父组件
&lt;template&gt;
  &lt;div id&#x3D;&quot;app&quot;&gt;
    &lt;HelloWorld msg&#x3D;&quot;Welcome to Your Vue.js App&quot; :msg1&#x3D;&quot;msg1&quot; :bol&#x3D;&quot;true&quot; :num&#x3D;&quot;123&quot; :arr&#x3D;&quot;[1, 2, 3]&quot; &#x2F;&gt;
  &lt;&#x2F;div&gt;
&lt;&#x2F;template&gt;

&#x2F;&#x2F; 子组件
props: &#123;
    msg: String,
	msg1: String,
	bol: Boolean,
	num: Number,
	arr: Array
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>注：只有<code>String</code>类型才能省略<code>:</code> 进行静态传值，其他类型的值会被识别为字符串类型。其他类型使用静态传值时必须使用<code>:</code></p>
<h4 id="响应式原理"><a href="#响应式原理" class="headerlink" title="响应式原理"></a>响应式原理</h4><p><strong>使用 Object.defineProperty()，将依赖关系定义为 watcher 数组并设置到每个值的 getter 中，当一个数据发生改变会将会触发订阅了当前数据的数据发生改变。</strong></p>
<h5 id="nextTick"><a href="#nextTick" class="headerlink" title="nextTick"></a>nextTick</h5><p>vue维护的是一个函数队列，先进先出的规则，先声明的函数会先执行，所以如果nextTick在数据更新前声明，则拿到的数据是未更新的数据。同时也要注意数据更新后<strong>同步</strong>拿到DOM中innerHTML是旧数据，只有进行触发了update才能拿到新数据，nextTick就可以使用微任务机制，在宏任务执行完成即更新数据后（update hook &amp; activate hook）执行微任务（nextTick）获取DOM中的数据，此时数据已经是新数据了。</p>
<p><strong>vue的数据更新是异步的</strong>。</p>
<blockquote>
<p>nextTick理解其实就是回调函数，但是由于回调函数层层传递过于复杂，使用微任务机制可以更加清晰明了，不用在意宏任务里面做了什么操作，只需要宏任务执行完成后立马执行微任务。</p>
<p>回调函数本质也是在执行某些操作后立马执行回调函数，但是回调函数会影响到多层函数。</p>
</blockquote>
<h5 id="数据改变无法检测到的情况"><a href="#数据改变无法检测到的情况" class="headerlink" title="数据改变无法检测到的情况"></a>数据改变无法检测到的情况</h5><p>对于引用类型如对象设置新属性（<code>obj.a = &#39;a&#39;</code>）和数组添加元素（<code>arr[1] = 1</code>），无法触发数据的setter，所以要使用Vue.set 接口进行解决，操作数组数据的原生api如<code>shift</code>等其实是底层进行了重写和封装，添加了数据改变的通知，对象的delete操作也是一样。</p>
<h5 id="computed和watch"><a href="#computed和watch" class="headerlink" title="computed和watch"></a>computed和watch</h5><p><strong>computed计算属性是基于它们的响应式依赖进行缓存的</strong>，只在相关响应式依赖发生改变时它们才会重新求值，如果新值和旧值相同也不会触发重新渲染。computed属性定义如果是函数则默认为getter函数，如果需要设置computed的值则将定义声明为对象，对象中的getter和setter函数分别设置到computed属性上。不推荐使用调用方法是因为当重新渲染时会重新执行一遍调用方法，而使用computed属性能够使用缓存值减少重新计算。</p>
<p><strong>watch侦听属性是在一些数据变动时需要做额外的操作时使用</strong>，如当数据发生变化时请求接口。watch实现引用类型的深度监听，需要定义handler函数和deep属性。可以使用数组声明需要回调的一系列函数。使用sync属性能立马响应watch的回调而不用等到nextTick时才进行响应。使用immediate属性则会在监听开始之后被立即调用。</p>
<p>watch监听引用类型（数组和对象，即使定义deep属性也不行），拿不到oldVal，oldVal和newVal是一样的。但是如果对象监听到具体的某个属性，则可以获取到oldVal。</p>
<p>watch侦听属性除了使用数据的方式声明还可以使用实例挂载的方式<a href="https://cn.vuejs.org/v2/api/#vm-watch"><code>vm.$watch</code></a>，实例方法能够做更加复杂的操作。Vue 实例将会在实例化时调用 <code>$watch()</code>，遍历 watch 对象的每一个 property。</p>
<p><strong>应用场景</strong>：computed计算属性适合在模板渲染中，某个值是依赖了其他的响应式对象甚至是计算属性计算而来；watch侦听属性适用于观测某个值的变化去完成一段复杂的业务逻辑。</p>
<h5 id="set使用"><a href="#set使用" class="headerlink" title="$set使用"></a>$set使用</h5><p>$set方法对象的使用：this.$set(this.obj, “key”, “value”)，在对象中新增一个属性，将该属性手动进行响应式处理。</p>
<p>push()、pop()、shift()、unshift()、splice()、sort()、reverse()这些方法会改变被操作的数组，所以会触发数组更改的响应式。</p>
<h4 id="插槽-v-slot"><a href="#插槽-v-slot" class="headerlink" title="插槽 v-slot"></a>插槽 v-slot</h4><p>如果子组件的 <code>template</code> 中<strong>没有</strong>包含一个 <code>&lt;slot&gt;</code> 元素，则该组件起始标签和结束标签之间的任何内容都会被抛弃。</p>
<p><strong>父级模板里的所有内容都是在父级作用域中编译的；子模板里的所有内容都是在子作用域中编译的。</strong></p>
<blockquote>
<p>普通插槽在父组件中定义子组件中 slot 的内容是在父组件的作用域中编译的，父组件的内容无法访问到子组件中的内容。</p>
<p>如果想要访问到子组件的作用域，则需要使用作用域插槽。</p>
</blockquote>
<p>可以使用 <strong><code>#</code></strong> 进行缩写。</p>
<p>如果父组件没有定义 slot 内容，则子组件的 slot 如果定义了默认内容则会显示默认内容。</p>
<h5 id="普通插槽"><a href="#普通插槽" class="headerlink" title="普通插槽"></a>普通插槽</h5><p>父组件</p>
<pre class="line-numbers language-vue" data-language="vue"><code class="language-vue">&lt;template&gt;
  &lt;div id&#x3D;&quot;app&quot;&gt;
    &lt;HelloWorld&gt;
      &lt;template v-slot&gt;slot&lt;&#x2F;template&gt;
    &lt;&#x2F;HelloWorld&gt;
  &lt;&#x2F;div&gt;
&lt;&#x2F;template&gt;

&lt;script&gt;
import HelloWorld from &#39;.&#x2F;components&#x2F;HelloWorld.vue&#39;

export default &#123;
  name: &#39;App&#39;,
  components: &#123;
    HelloWorld
  &#125;,
&#125;
&lt;&#x2F;script&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>子组件</p>
<pre class="line-numbers language-vue" data-language="vue"><code class="language-vue">&lt;template&gt;
  &lt;div class&#x3D;&quot;hello&quot;&gt;
    &lt;slot&gt;默认内容&lt;&#x2F;slot&gt;
  &lt;&#x2F;div&gt;
&lt;&#x2F;template&gt;

&lt;script&gt;
export default &#123;
  name: &#39;HelloWorld&#39;,
&#125;
&lt;&#x2F;script&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>在父组件编译和渲染阶段生成vnodes，所以数据的作用域是父组件实例，子组件渲染的时候直接拿到这些渲染好的vnodes。</p>
<h5 id="具名插槽"><a href="#具名插槽" class="headerlink" title="具名插槽"></a>具名插槽</h5><p>父组件</p>
<pre class="line-numbers language-vue" data-language="vue"><code class="language-vue">&lt;template&gt;
  &lt;div id&#x3D;&quot;app&quot;&gt;
    &lt;HelloWorld&gt;
      &lt;template v-slot:header&gt;Header&lt;&#x2F;template&gt;
      &lt;template v-slot:footer&gt;Footer&lt;&#x2F;template&gt;
    &lt;&#x2F;HelloWorld&gt;
  &lt;&#x2F;div&gt;
&lt;&#x2F;template&gt;

&lt;script&gt;
import HelloWorld from &#39;.&#x2F;components&#x2F;HelloWorld.vue&#39;

export default &#123;
  name: &#39;App&#39;,
  components: &#123;
    HelloWorld
  &#125;,
&#125;
&lt;&#x2F;script&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>子组件</p>
<pre class="line-numbers language-vue" data-language="vue"><code class="language-vue">&lt;template&gt;
  &lt;div class&#x3D;&quot;hello&quot;&gt;
    &lt;slot name&#x3D;&quot;header&quot;&gt;&lt;&#x2F;slot&gt;
    &lt;slot name&#x3D;&quot;footer&quot;&gt;&lt;&#x2F;slot&gt;
  &lt;&#x2F;div&gt;
&lt;&#x2F;template&gt;

&lt;script&gt;
export default &#123;
  name: &#39;HelloWorld&#39;,
&#125;
&lt;&#x2F;script&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h5 id="作用域插槽"><a href="#作用域插槽" class="headerlink" title="作用域插槽"></a>作用域插槽</h5><p>插槽需要访问子组件中才有的数据。子组件中的 slot 上绑定父组件需要使用的值，即插槽prop。在父组件就可以拿到插槽 prop 合并成的对象，父组件将这个对象自定义命名，然后就可以在插槽中使用子组件中的值了。</p>
<p>父组件</p>
<pre class="line-numbers language-vue" data-language="vue"><code class="language-vue">&lt;template&gt;
  &lt;div id&#x3D;&quot;app&quot;&gt;
    &lt;HelloWorld&gt;
      &lt;template #header&#x3D;&quot;slotProps&quot;&gt; 
          app: &#123;&#123; slotProps.testObj.test &#125;&#125;\&#123;&#123; slotProps.test &#125;&#125;
	  &lt;&#x2F;template&gt;
    &lt;&#x2F;HelloWorld&gt;
  &lt;&#x2F;div&gt;
&lt;&#x2F;template&gt;

&lt;script&gt;
import HelloWorld from &#39;.&#x2F;components&#x2F;HelloWorld.vue&#39;

export default &#123;
  name: &#39;App&#39;,
  components: &#123;
    HelloWorld
  &#125;,
&#125;
&lt;&#x2F;script&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>子组件</p>
<pre class="line-numbers language-vue" data-language="vue"><code class="language-vue">&lt;template&gt;
  &lt;div class&#x3D;&quot;hello&quot;&gt;
    &lt;slot name&#x3D;&quot;header&quot; :testObj&#x3D;&quot;testObj&quot; :test&#x3D;&quot;test&quot;&gt;
      HelloWorld: &#123;&#123; test &#125;&#125;
    &lt;&#x2F;slot&gt;
  &lt;&#x2F;div&gt;
&lt;&#x2F;template&gt;

&lt;script&gt;
export default &#123;
  name: &#39;HelloWorld&#39;,
  data() &#123;
    return &#123;
      test: &#39;xxx&#39;,
      testObj: &#123;
        test: &#39;ss&#39;
      &#125;,
    &#125;
  &#125;,
&#125;
&lt;&#x2F;script&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>父组件在编译和渲染阶段并不会直接生成 vnodes ，而是在父节点 vnode 的 data 中保留一个scopedSlots 对象，存储着不同名称的插槽以及它们对应的渲染函数，只有在渲染子组件阶段才会执行这个渲染函数生成 vnodes ，所以父组件中的 slot 可以访问到子组件的插槽prop。</p>
<h4 id="keep-alive"><a href="#keep-alive" class="headerlink" title="keep-alive"></a><a href="https://cn.vuejs.org/v2/api/#keep-alive">keep-alive</a></h4><p>抽象组件，保存组件状态，防止重复渲染导致性能问题。<code>&lt;keep-alive&gt;</code>包裹动态组件时，会缓存不活动的组件实例，而不是销毁它们。</p>
<blockquote>
<p>keep-alive 要求被切换到的组件都要有自己的名字，不论时通过组件的name选项还是局部/全局注册。</p>
<p>不会在函数式组件中正常工作，因为函数式组件没有缓存实例。</p>
<p>抽象组件，自身不会渲染一个DOM元素，也不会出现在组件的父组件链中。</p>
</blockquote>
<pre class="line-numbers language-vue" data-language="vue"><code class="language-vue">&lt;!-- 失活的组件将会被缓存！--&gt;
&lt;keep-alive&gt;
  &lt;component v-bind:is&#x3D;&quot;currentTabComponent&quot;&gt;&lt;&#x2F;component&gt;
&lt;&#x2F;keep-alive&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>当组件在 <code>keep-alive</code> 内被切换，会执行 activated 和 deactivated 生命周期钩子会执行。</p>
<blockquote>
<p>这两个生命周期钩子是 keep-alive 特有的。</p>
<p>组件初始化时，mounted 生命周期钩子执行完后，才执行activated 生命周期钩子。但如果组件已经进行缓存了，则组件再次被激活时不会触发mounted生命周期钩子函数，只会触发activated 生命周期钩子函数。</p>
</blockquote>
<ul>
<li><p><code>include</code> - 字符串或正则表达式。只有名称匹配的组件会被缓存。</p>
<blockquote>
<p>匹配首先检查组件自身的 <code>name</code> 选项，如果 <code>name</code> 选项不可用，则匹配它的局部注册名称 (父组件 <code>components</code> 选项的键值)。匿名组件不能被匹配。</p>
</blockquote>
</li>
<li><p><code>exclude</code> - 字符串或正则表达式。任何名称匹配的组件都不会被缓存。</p>
</li>
<li><p><code>max</code> - 数字。最多可以缓存多少组件实例。</p>
</li>
</ul>
<pre class="line-numbers language-vue" data-language="vue"><code class="language-vue">&lt;!-- 逗号分隔字符串 --&gt;
&lt;keep-alive include&#x3D;&quot;a,b&quot;&gt;
  &lt;component :is&#x3D;&quot;view&quot;&gt;&lt;&#x2F;component&gt;
&lt;&#x2F;keep-alive&gt;

&lt;!-- 正则表达式 (使用 &#96;v-bind&#96;) --&gt;
&lt;keep-alive :include&#x3D;&quot;&#x2F;a|b&#x2F;&quot;&gt;
  &lt;component :is&#x3D;&quot;view&quot;&gt;&lt;&#x2F;component&gt;
&lt;&#x2F;keep-alive&gt;

&lt;!-- 数组 (使用 &#96;v-bind&#96;) --&gt;
&lt;keep-alive :include&#x3D;&quot;[&#39;a&#39;, &#39;b&#39;]&quot;&gt;
  &lt;component :is&#x3D;&quot;view&quot;&gt;&lt;&#x2F;component&gt;
&lt;&#x2F;keep-alive&gt;

&lt;!-- 使用max --&gt;
&lt;keep-alive :max&#x3D;&quot;10&quot;&gt;
  &lt;component :is&#x3D;&quot;view&quot;&gt;&lt;&#x2F;component&gt;
&lt;&#x2F;keep-alive&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>在首次渲染时会直接执行 activated 钩子函数，在再次激活组件时会在 nextTick 后先执行 activated 钩子函数然后执行 updated 钩子函数。失活组件的时候会执行 deactivated 钩子函数。</p>
<h5 id="总结-1"><a href="#总结-1" class="headerlink" title="总结"></a>总结</h5><p>keep-alive 组件时一个内置抽象组件，它的实现通过自定义 render 函数并且利用了插槽。</p>
<p>keep-alive 组件的渲染分为首次渲染和缓存渲染。首次渲染时会将实例缓存起来，当命中缓存，则不会再执行 created 和 mounted 钩子函数，而会执行 activated 钩子函数。销毁时也不会执行 destroyed 钩子函数，而会执行 deactivated 钩子函数。</p>
<p>keep-alive 的 max 属性采用的最近最少使用算法（LRU）进行处理，避免缓存内容过多占用内容。</p>
<h4 id="过渡动画"><a href="#过渡动画" class="headerlink" title="过渡动画"></a>过渡动画</h4><h5 id="transition"><a href="#transition" class="headerlink" title="transition"></a>transition</h5><p>内置<strong>抽象</strong>组件。</p>
<p>当插入或删除包含在 <code>transition</code> 组件中的元素时，Vue 将会做以下处理：</p>
<ol>
<li>自动嗅探目标元素是否应用了 CSS 过渡或动画，如果是，在恰当的时机添加/删除 CSS 类名。</li>
<li>如果过渡组件提供了 <a href="https://cn.vuejs.org/v2/guide/transitions.html#JavaScript-%E9%92%A9%E5%AD%90">JavaScript 钩子函数</a>，这些钩子函数将在恰当的时机被调用。</li>
<li>如果没有找到 JavaScript 钩子并且也没有检测到 CSS 过渡/动画，DOM 操作 (插入/删除) 在下一帧中立即执行。(注意：此指浏览器逐帧动画机制，和 Vue 的 <code>nextTick</code> 概念不同)</li>
</ol>
<p>过渡的css类名：</p>
<ol>
<li><code>v-enter</code>：定义进入过渡的开始状态。在元素被插入之前生效，在元素被插入之后的下一帧移除。</li>
<li><code>v-enter-active</code>：定义进入过渡生效时的状态。在整个进入过渡的阶段中应用，在元素被插入之前生效，在过渡/动画完成之后移除。这个类可以被用来定义进入过渡的过程时间，延迟和曲线函数。</li>
<li><code>v-enter-to</code>：定义进入过渡的结束状态。在元素被插入之后下一帧生效 (与此同时 <code>v-enter</code> 被移除)，在过渡/动画完成之后移除。</li>
<li><code>v-leave</code>：定义离开过渡的开始状态。在离开过渡被触发时立刻生效，下一帧被移除。</li>
<li><code>v-leave-active</code>：定义离开过渡生效时的状态。在整个离开过渡的阶段中应用，在离开过渡被触发时立刻生效，在过渡/动画完成之后移除。这个类可以被用来定义离开过渡的过程时间，延迟和曲线函数。</li>
<li><code>v-leave-to</code>：定义离开过渡的结束状态。在离开过渡被触发之后下一帧生效 (与此同时 <code>v-leave</code> 被删除)，在过渡/动画完成之后移除。</li>
</ol>
<blockquote>
<p>以上的过渡类名为默认类名，可以自定义声明 name ，会将自定义name 替换掉 v-，如 name 为 fade 则类名为 fade-enter。</p>
<p><code>v-enter-active</code> 和 <code>v-leave-active</code> 可以控制进入/离开过渡的不同的缓和曲线。</p>
</blockquote>
<p><img src="/posts/28605/transition.jpg" alt="transition"></p>
<h5 id="transition-group"><a href="#transition-group" class="headerlink" title="transition-group"></a>transition-group</h5><ul>
<li><p>会渲染成真实的元素。默认为一个 <code>&lt;span&gt;</code>。你也可以通过 <code>tag</code> attribute 更换为其他元素。</p>
</li>
<li><p><a href="https://cn.vuejs.org/v2/guide/transitions.html#%E8%BF%87%E6%B8%A1%E6%A8%A1%E5%BC%8F">过渡模式</a>不可用，因为我们不再相互切换特有的元素。</p>
</li>
<li><p>内部元素<strong>总是需要</strong>提供唯一的 <code>key</code> attribute 值。</p>
</li>
<li><p>CSS 过渡的类将会应用在内部的元素中，而不是这个组/容器本身。</p>
</li>
<li><p>transition-group组件属性是在transition组件上进行扩展的，所以transition组件的属性transition-group组件也可以使用。</p>
</li>
</ul>
<h6 id="总结-2"><a href="#总结-2" class="headerlink" title="总结"></a>总结</h6><p><code>transition-group</code> 组件时为了做列表的过渡，它会渲染成真实的元素。</p>
<p>当我们去修改列表的数据的时候，如果是添加或者删除数据，则会触发相应元素本身的过渡动画，这点和 <code>&lt;transition&gt;</code>组件实现效果一样，除此之外 <code>&lt;transition-group&gt;</code>还实现了 move 的过渡效果，让我们的列表过渡动画更加丰富。</p>
<h3 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h3><h4 id="v-if-和-v-show-的区别"><a href="#v-if-和-v-show-的区别" class="headerlink" title="v-if 和 v-show 的区别"></a>v-if 和 v-show 的区别</h4><p>v-show 会在页面首次渲染的时候进行渲染加载，修改条件后不会重新渲染。</p>
<p>v-if 不会在页面初始化的时候渲染，但是条件为真值时会进行渲染加载，条件为假值时会进行销毁。</p>
<p>组件显示条件修改不是很频繁则使用 v-if，反之使用 v-show。</p>
<h4 id="为何-v-for-中要用key"><a href="#为何-v-for-中要用key" class="headerlink" title="为何 v-for 中要用key"></a>为何 v-for 中要用key</h4><p><a href="https://cn.vuejs.org/v2/api/#key">key</a>：<code>key</code> 的特殊 attribute 主要用在 Vue 的虚拟 DOM 算法，在新旧 nodes 对比时辨识 VNodes。如果不使用 key，Vue 会使用一种最大限度减少动态元素并且尽可能的尝试就地修改/复用相同类型元素的算法。而使用 key 时，它会基于 key 的变化重新排列元素顺序，并且会移除 key 不存在的元素。</p>
<p>有相同父元素的子元素必须有<strong>独特的 key</strong>。重复的 key 会造成渲染错误。</p>
<p>更新key值可以完整地触发组件的生命周期钩子，触发过渡。</p>
<h4 id="描述Vue组件生命周期（有父子组件的情况）"><a href="#描述Vue组件生命周期（有父子组件的情况）" class="headerlink" title="描述Vue组件生命周期（有父子组件的情况）"></a>描述Vue组件生命周期（有父子组件的情况）</h4><p>更详细的参考：<a href="https://juejin.cn/post/6904536680183791623">https://juejin.cn/post/6904536680183791623</a></p>
<h4 id="父子组件通讯"><a href="#父子组件通讯" class="headerlink" title="父子组件通讯"></a>父子组件通讯</h4><p>子组件获取父组件数据：</p>
<ul>
<li>父组件 props 传值</li>
<li>子组件访问父组件实例：this.$parent</li>
<li>子组件访问根组件实例：this.$root</li>
<li>分发监听 this.$root.$emit(‘eventName’, data)</li>
<li><a href="https://cn.vuejs.org/v2/api/#provide-inject">inject</a> - 在任何后代组件里，我们都可以使用 <code>inject</code> 选项来接收指定的我们想要添加在这个实例上的 property</li>
<li>vuex</li>
</ul>
<p>父组件获取子组件传值：</p>
<ul>
<li>子组件 this.$emit(‘eventName’, data) </li>
<li>建立监听 this.$root.$on(‘eventName’, callback)</li>
<li><a href="https://cn.vuejs.org/v2/api/#provide-inject">provide</a> - 选项允许我们指定我们想要<strong>提供</strong>给后代组件的数据/方法</li>
<li>this.$refs.elm</li>
<li>vuex</li>
<li>v-model</li>
</ul>
<h4 id="兄弟组件通讯"><a href="#兄弟组件通讯" class="headerlink" title="兄弟组件通讯"></a>兄弟组件通讯</h4><ul>
<li>父组件搭桥，兄弟组件通过 $emit 方式将值传递给父组件，父组件再传值给兄弟组件</li>
<li>vuex </li>
<li>eventBus</li>
</ul>
<h4 id="描述组件渲染和更新的过程"><a href="#描述组件渲染和更新的过程" class="headerlink" title="描述组件渲染和更新的过程"></a>描述组件渲染和更新的过程</h4><p>参考链接：<a href="https://blog.csdn.net/qq_42072086/article/details/108006061">https://blog.csdn.net/qq_42072086/article/details/108006061</a></p>
<p>渲染组件时，会通过 Vue.extend 方法构建子组件的构造函数，初始化组件的时候会进行实例化。终手动调用 $mount() 进行组件挂载渲染。更新组件时会进行 patchVnode 流程。核心就是diﬀ算法。</p>
<p><img src="/./%E7%BB%84%E4%BB%B6%E6%B8%B2%E6%9F%93%E6%9B%B4%E6%96%B0.png" alt="组件渲染更新"></p>
<h4 id="双向数据绑定v-model的实现原理"><a href="#双向数据绑定v-model的实现原理" class="headerlink" title="双向数据绑定v-model的实现原理"></a>双向数据绑定v-model的实现原理</h4><h4 id="为什么Vue组件中的data要使用function的方式"><a href="#为什么Vue组件中的data要使用function的方式" class="headerlink" title="为什么Vue组件中的data要使用function的方式"></a>为什么Vue组件中的data要使用function的方式</h4><p>参考官网：<a href="https://cn.vuejs.org/v2/guide/components.html#data-%E5%BF%85%E9%A1%BB%E6%98%AF%E4%B8%80%E4%B8%AA%E5%87%BD%E6%95%B0"><code>data</code> 必须是一个函数</a></p>
<p><strong>一个组件的 <code>data</code> 选项必须是一个函数</strong>，因此每个实例可以维护一份被返回对象的独立的拷贝。 </p>
<p>对于组件复用而言，每个组件的data要相互独立，互不影响。如果data是一个对象，多个组件引用的则是同一个内存地址上的对象数据。使用函数返回一个对象，则形成了一个闭包，创建了独立的对象引用地址。</p>
<h4 id="为什么要使用计算属性"><a href="#为什么要使用计算属性" class="headerlink" title="为什么要使用计算属性"></a>为什么要使用计算属性</h4><p>避免在模板中放入太多的逻辑，导致模板过重且难以维护。</p>
<p>计算属性是基于它们的响应式依赖进行缓存的,只在相关响应式依赖发生改变时它们才会重新求值。</p>
<h4 id="watch监听属性"><a href="#watch监听属性" class="headerlink" title="watch监听属性"></a>watch监听属性</h4><p>watch监听属性不可以使用箭头函数进行定义，因为箭头函数中的this指向的是定义时的this，而不是执行时的this，所以不会指向Vue实例的上下文，而是 <code>undefined</code>。</p>
<p>watch定义的函数中 this 指向为 当前组件实例 vm。</p>
<h4 id="组件的选项和混入的选项是怎么合并的"><a href="#组件的选项和混入的选项是怎么合并的" class="headerlink" title="组件的选项和混入的选项是怎么合并的"></a>组件的选项和混入的选项是怎么合并的</h4><ul>
<li>数据对象（data选项），在内部进行递归合并，并在发生冲突时以<strong>组件数据</strong>优先；</li>
<li>同名钩子函数将合并为一个数组，因此都将被调用。另外，混入对象的钩子将在组件自身钩子<strong>之前</strong>调用；</li>
<li>watch对象合并时，相同的key合成一个对象，且混入监听在组件监听之前调用；</li>
<li>值为对象的选项，如filters选项、computed选项、methods选项、components选项、directives选项，将被合并为同一个对象。两个对象键名冲突时，取组件对象的键值对。</li>
</ul>
<h4 id="强制刷新组件的方法"><a href="#强制刷新组件的方法" class="headerlink" title="强制刷新组件的方法"></a>强制刷新组件的方法</h4><ul>
<li>vm.$forceUpdate()。</li>
<li>组件上定义key值，修改key值。</li>
</ul>
<h4 id="销毁组件"><a href="#销毁组件" class="headerlink" title="销毁组件"></a>销毁组件</h4><ul>
<li>没有 keep-alive 时的路由切换</li>
<li>v-if=”false”</li>
<li>执行vm.$destroy()</li>
</ul>
<h3 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h3><p><code>vue2.x</code>版本使用 <code>Flow.js</code> 进行数据类型检测。</p>
<h4 id="router"><a href="#router" class="headerlink" title="router"></a>router</h4><p>注意点：不同的页面使用的是同一个component，默认情况下当这两个页面切换时并不会触发vue的created或者mounted钩子，可以通过watch $route的变化来做处理，另一种方法在 router-view 上加上一个唯一的key，来保证路由切换时都会重新渲染触发钩子了。</p>
<pre class="line-numbers language-vue" data-language="vue"><code class="language-vue">&lt;router-view :key&#x3D;&quot;key&quot;&gt;&lt;&#x2F;router-view&gt;

computed: &#123;
    key() &#123;
        return this.$route.name !&#x3D;&#x3D; undefined? this.$route.name + +new Date(): this.$route + +new Date()
    &#125;
 &#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h4 id="vue实例方法"><a href="#vue实例方法" class="headerlink" title="vue实例方法"></a><a href="https://cn.vuejs.org/v2/api/#%E5%AE%9E%E4%BE%8B%E6%96%B9%E6%B3%95-%E4%BA%8B%E4%BB%B6">vue实例方法</a></h4><p><code>vm.$on(event, callback)</code>、<code>vm.$once(event, callback)</code>、<code>vm.$off([event, callback])</code> <code>vm.$emit(eventName, [...args])</code>四个方法，vue自带了订阅-发布模式。</p>
<h3 id="自检"><a href="#自检" class="headerlink" title="自检"></a>自检</h3><h4 id="面试题"><a href="#面试题" class="headerlink" title="面试题"></a>面试题</h4><p><a href="https://juejin.cn/post/6844903874709766152">Vue初级前端工程师面试必备 - 掘金</a></p>
<p><a href="https://juejin.cn/post/6844903934306287629">Vue初级面试题汇总 - 掘金</a></p>
<p><a href="https://juejin.cn/post/6844903934314676231">Vue中级面试题汇总 - 掘金</a></p>
<p><a href="https://juejin.cn/post/6844903913498345479">Vue高级面试题汇总 - 掘金</a></p>
<p>（以上面试题，可看题目，部分解答有问题，自行判断）</p>
<p>推荐：vue面试题 - <a href="https://juejin.cn/post/6947847527253311496">https://juejin.cn/post/6947847527253311496</a></p>
<h4 id="更多阅读"><a href="#更多阅读" class="headerlink" title="更多阅读"></a>更多阅读</h4><p>vue源码分析 - <a href="https://juejin.cn/post/6886266739378618382#heading-9">https://juejin.cn/post/6886266739378618382#heading-9</a></p>
<p><a href="https://godbasin.github.io/vue-ebook/">深入理解 vue.js 实战</a>：（源码）<a href="https://github.com/godbasin/vue-ebook">https://github.com/godbasin/vue-ebook</a></p>
<p><a href="https://www.kancloud.cn/cyyspring/vuejs/936826">Vue&amp;&amp;TypeSprict–基础总结</a></p>
<p><a href="https://ustbhuangyi.github.io/vue-analysis/v2/prepare/">vue.js 技术揭秘</a></p>
]]></content>
      <categories>
        <category>前端</category>
        <category>vue</category>
      </categories>
      <tags>
        <tag>前端</tag>
        <tag>vue</tag>
      </tags>
  </entry>
  <entry>
    <title>webpack系列-pug实战</title>
    <url>/posts/52386/</url>
    <content><![CDATA[<h3 id="Pug-jade"><a href="#Pug-jade" class="headerlink" title="Pug(jade)"></a><a href="https://www.pugjs.cn/api/getting-started.html">Pug(jade)</a></h3><p>模板引擎。类似于JSP、FreeMarker之类Java相关的模板引擎。Pug(原称是jade)是Nodejs相关的模板引擎，可以和Express进行集成。</p>
<p>类似的Nodejs相关的模板引擎：<a href="https://github.com/mde/ejs">ejs</a>、<a href="https://github.com/aui/art-template">art-template</a>、<a href="https://github.com/olado/doT">doT</a>、<a href="https://handlebarsjs.com/zh/guide/">Handlebars</a>、<a href="https://github.com/janl/mustache.js">Mustache</a>等</p>
<p>模板引擎通常都是有后端搭配进行数据传输，但是有的时候只需要静态页面不需要后端时，类似Java的模板引擎就不好用了。可以在node环境下使用模板引擎可以生成静态页面后发布。</p>
<p>模板引擎的好处在于可以将重复的代码提出来进行模块化，可以进行灵活的嵌入、继承、扩展等，降低后期维护难度和代码修改工作量。</p>
<p>主要问题在于数据传值部分。</p>
<ul>
<li>可以将数据写在模板里定义常量进行数据取值，但是灵活性不高，如果不同的网站数据相同的样式，需要重新创建文件定义常量。</li>
<li>可以将数据写在JSON文档中，可以进行单文件或多文件进行命令行编译。</li>
<li>可以使用webpack进行打包，补充兼容、压缩和优化代码，但是难点在于webpack配置和pug配置，如特殊需要，可能需要编写插件或loader。</li>
</ul>
<p>实例代码：<a href="https://github.com/Datura35422/pug-demo/tree/master/website">https://github.com/Datura35422/pug-demo/tree/master/website</a></p>
<h4 id="项目配置"><a href="#项目配置" class="headerlink" title="项目配置"></a>项目配置</h4><p>package.json</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>
  <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"website"</span><span class="token punctuation">,</span>
  <span class="token property">"version"</span><span class="token operator">:</span> <span class="token string">"1.0.0"</span><span class="token punctuation">,</span>
  <span class="token property">"description"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>
  <span class="token property">"dependencies"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token property">"jquery"</span><span class="token operator">:</span> <span class="token string">"^3.6.0"</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token property">"devDependencies"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token property">"@babel/core"</span><span class="token operator">:</span> <span class="token string">"^7.13.10"</span><span class="token punctuation">,</span>
    <span class="token property">"@babel/preset-env"</span><span class="token operator">:</span> <span class="token string">"^7.13.10"</span><span class="token punctuation">,</span>
    <span class="token property">"autoprefixer"</span><span class="token operator">:</span> <span class="token string">"^10.2.5"</span><span class="token punctuation">,</span>
    <span class="token property">"babel-loader"</span><span class="token operator">:</span> <span class="token string">"^8.2.2"</span><span class="token punctuation">,</span>
    <span class="token property">"clean-webpack-plugin"</span><span class="token operator">:</span> <span class="token string">"^3.0.0"</span><span class="token punctuation">,</span>
    <span class="token property">"copy-webpack-plugin"</span><span class="token operator">:</span> <span class="token string">"^8.0.0"</span><span class="token punctuation">,</span>
    <span class="token property">"css-loader"</span><span class="token operator">:</span> <span class="token string">"^5.1.3"</span><span class="token punctuation">,</span>
    <span class="token property">"css-mqpacker"</span><span class="token operator">:</span> <span class="token string">"^7.0.0"</span><span class="token punctuation">,</span>
    <span class="token property">"cssnano"</span><span class="token operator">:</span> <span class="token string">"^4.1.10"</span><span class="token punctuation">,</span>
    <span class="token property">"file-loader"</span><span class="token operator">:</span> <span class="token string">"^6.2.0"</span><span class="token punctuation">,</span>
    <span class="token property">"html-webpack-injector"</span><span class="token operator">:</span> <span class="token string">"^1.1.4"</span><span class="token punctuation">,</span>
    <span class="token property">"html-webpack-plugin"</span><span class="token operator">:</span> <span class="token string">"^5.3.1"</span><span class="token punctuation">,</span>
    <span class="token property">"mini-css-extract-plugin"</span><span class="token operator">:</span> <span class="token string">"^1.3.9"</span><span class="token punctuation">,</span>
    <span class="token property">"postcss-loader"</span><span class="token operator">:</span> <span class="token string">"^5.2.0"</span><span class="token punctuation">,</span>
    <span class="token property">"pug-loader"</span><span class="token operator">:</span> <span class="token string">"^2.4.0"</span><span class="token punctuation">,</span>
    <span class="token property">"url-loader"</span><span class="token operator">:</span> <span class="token string">"^4.1.1"</span><span class="token punctuation">,</span>
    <span class="token property">"webpack"</span><span class="token operator">:</span> <span class="token string">"^5.26.3"</span><span class="token punctuation">,</span>
    <span class="token property">"webpack-cli"</span><span class="token operator">:</span> <span class="token string">"^4.5.0"</span><span class="token punctuation">,</span>
    <span class="token property">"webpack-dev-server"</span><span class="token operator">:</span> <span class="token string">"^3.11.2"</span><span class="token punctuation">,</span>
    <span class="token property">"webpack-merge"</span><span class="token operator">:</span> <span class="token string">"^5.7.3"</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token property">"scripts"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token property">"build"</span><span class="token operator">:</span> <span class="token string">"npx webpack --config ./build/webpack.build.conf.js"</span><span class="token punctuation">,</span>
    <span class="token property">"debug"</span><span class="token operator">:</span> <span class="token string">"node --inspect --inspect-brk webpack --config ./build/webpack.build.conf.js"</span><span class="token punctuation">,</span>
    <span class="token property">"dev"</span><span class="token operator">:</span> <span class="token string">"npx webpack-dev-server --open --config ./build/webpack.dev.conf.js"</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token property">"author"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>
  <span class="token property">"license"</span><span class="token operator">:</span> <span class="token string">"ISC"</span><span class="token punctuation">,</span>
  <span class="token property">"browserslist"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">"> 1%"</span><span class="token punctuation">,</span>
    <span class="token string">"last 3 version"</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h4 id="webpack-配置"><a href="#webpack-配置" class="headerlink" title="webpack 配置"></a>webpack 配置</h4><p>webpack.base.conf.js</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// reference https://github.com/vedees/webpack-template-pug &amp; https://github.com/vedees/webpack-template</span>

<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> HtmlWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'html-webpack-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> HtmlWebpackInjector <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'html-webpack-injector'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> MiniCssExtractPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'mini-css-extract-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> CopyWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'copy-webpack-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">&#123;</span> CleanWebpackPlugin <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'clean-webpack-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> dataJson <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../src/data/home.json'</span><span class="token punctuation">)</span>

<span class="token comment">// Main const</span>
<span class="token keyword">const</span> <span class="token constant">PATHS</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  <span class="token comment">// Path to main app dir</span>
  <span class="token literal-property property">src</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'../src'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token comment">// Path to Output dir</span>
  <span class="token literal-property property">dist</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'../dist'</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// Pages const for HtmlWebpackPlugin</span>
<span class="token keyword">const</span> <span class="token constant">PAGES_DIR</span> <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span><span class="token constant">PATHS</span><span class="token punctuation">.</span>src<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">/pages/</span><span class="token template-punctuation string">`</span></span>
<span class="token keyword">const</span> <span class="token constant">PAGES</span> <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readdirSync</span><span class="token punctuation">(</span><span class="token constant">PAGES_DIR</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">fileName</span> <span class="token operator">=></span> fileName<span class="token punctuation">.</span><span class="token function">endsWith</span><span class="token punctuation">(</span><span class="token string">'.pug'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  <span class="token comment">// BASE config</span>
  <span class="token literal-property property">externals</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token literal-property property">paths</span><span class="token operator">:</span> <span class="token constant">PATHS</span> <span class="token comment">// webpack.dev.conf 中 devServer中会使用</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">entry</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token literal-property property">index</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span><span class="token constant">PATHS</span><span class="token punctuation">.</span>src<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">/js/index.js</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
    <span class="token literal-property property">index_head</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span><span class="token constant">PATHS</span><span class="token punctuation">.</span>src<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">/js/judegDevice.js</span><span class="token template-punctuation string">`</span></span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">js/[name].[fullhash].js</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
    <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token constant">PATHS</span><span class="token punctuation">.</span>dist<span class="token punctuation">,</span>
    <span class="token literal-property property">publicPath</span><span class="token operator">:</span> <span class="token string">'./'</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token comment">// 优化</span>
  <span class="token literal-property property">optimization</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token literal-property property">splitChunks</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
      <span class="token literal-property property">cacheGroups</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        <span class="token literal-property property">vendor</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
          <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'vendors'</span><span class="token punctuation">,</span>
          <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">node_modules</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
          <span class="token literal-property property">chunks</span><span class="token operator">:</span> <span class="token string">'all'</span><span class="token punctuation">,</span>
          <span class="token literal-property property">enforce</span><span class="token operator">:</span> <span class="token boolean">true</span>
        <span class="token punctuation">&#125;</span>
      <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">CleanWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">MiniCssExtractPlugin</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token comment">// 压缩优化css</span>
      <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">css/[name].[fullhash].css</span><span class="token template-punctuation string">`</span></span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token comment">// 处理静态文件 将静态引入的文件复制到目标目录下 要与html中的文件引用一样 不然HtmlWebpackPlugin会编译出错</span>
    <span class="token keyword">new</span> <span class="token class-name">CopyWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
      <span class="token literal-property property">patterns</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">&#123;</span>
          <span class="token literal-property property">from</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">src/imgs</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
          <span class="token literal-property property">to</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">imgs</span><span class="token template-punctuation string">`</span></span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token punctuation">&#123;</span>
          <span class="token literal-property property">from</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">src/favicon.ico</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
          <span class="token literal-property property">to</span><span class="token operator">:</span>  <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">favicon.ico</span><span class="token template-punctuation string">`</span></span>
        <span class="token punctuation">&#125;</span>
      <span class="token punctuation">]</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token comment">// 自动加载模块</span>
    <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>ProvidePlugin</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token comment">// 其他js文件中使用jquery 进行自动导入</span>
      <span class="token literal-property property">$</span><span class="token operator">:</span> <span class="token string">'jquery'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">jQuery</span><span class="token operator">:</span> <span class="token string">'jquery'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">jquery</span><span class="token operator">:</span> <span class="token string">'jquery'</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

    <span class="token comment">// Automatic creation any html pages (Don't forget to RERUN dev server)</span>
    <span class="token comment">// see more: https://github.com/vedees/webpack-template/blob/master/README.md#create-another-html-files</span>
    <span class="token comment">// best way to create pages: https://github.com/vedees/webpack-template/blob/master/README.md#third-method-best</span>
    <span class="token operator">...</span><span class="token constant">PAGES</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">page</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
        <span class="token literal-property property">minify</span><span class="token operator">:</span> <span class="token string">'production'</span><span class="token punctuation">,</span> <span class="token comment">// 压缩</span>
        <span class="token literal-property property">template</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span><span class="token constant">PAGES_DIR</span><span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>page<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
        <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>page<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.pug</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span><span class="token string">'.html'</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
        <span class="token literal-property property">chunks</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'index'</span><span class="token punctuation">,</span> <span class="token string">'index_head'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token literal-property property">data</span><span class="token operator">:</span> dataJson
        <span class="token comment">// chunksConfig: &#123;             // Added option</span>
        <span class="token comment">//   async: ["index_head"],    </span>
        <span class="token comment">//   defer: ["index"]</span>
        <span class="token comment">// &#125;</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackInjector</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// js分开注入</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token literal-property property">stats</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token literal-property property">children</span><span class="token operator">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">&#123;</span>
        <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.pug$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">&#123;</span>
            <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">'pug-loader'</span><span class="token punctuation">,</span>
            <span class="token literal-property property">options</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token comment">// 配置参考 pug api：https://pugjs.org/zh-cn/api/reference.html</span>
              <span class="token literal-property property">pretty</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 不压缩html</span>
              <span class="token literal-property property">self</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token comment">// 局部变量</span>
            <span class="token punctuation">&#125;</span>
          <span class="token punctuation">&#125;</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> 
      <span class="token punctuation">&#123;</span>
        <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.js$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        <span class="token literal-property property">exclude</span><span class="token operator">:</span> <span class="token string">'/node_modules/'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'babel-loader'</span><span class="token punctuation">]</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> 
      <span class="token punctuation">&#123;</span>
        <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.(png|jpe?g|gif|svg)$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">&#123;</span>
            <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">'url-loader'</span><span class="token punctuation">,</span> <span class="token comment">// 处理js、css中出现的img</span>
            <span class="token literal-property property">options</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
              <span class="token comment">// 为css内的图片、文件等外部资源指定一个自定义的公共路径</span>
              <span class="token function">name</span><span class="token punctuation">(</span><span class="token parameter">resourcePath</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">// 替换css中的文件名</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'resourcePath: '</span><span class="token punctuation">,</span> resourcePath<span class="token punctuation">)</span>
                <span class="token keyword">let</span> url <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">relative</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span><span class="token constant">PATHS</span><span class="token punctuation">.</span>src<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">/imgs/</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> path<span class="token punctuation">.</span><span class="token function">dirname</span><span class="token punctuation">(</span>resourcePath<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'/[name].[ext]'</span>
                url <span class="token operator">=</span> url<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">'\\'</span><span class="token punctuation">,</span> <span class="token string">'/'</span><span class="token punctuation">)</span>
                <span class="token keyword">return</span> url<span class="token punctuation">;</span>
              <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
              <span class="token literal-property property">outputPath</span><span class="token operator">:</span> <span class="token string">'imgs'</span><span class="token punctuation">,</span> <span class="token comment">// 输出目录, 如果配置好路径的话可以不用配置</span>
              <span class="token literal-property property">limit</span><span class="token operator">:</span> <span class="token number">8190</span>
            <span class="token punctuation">&#125;</span>
          <span class="token punctuation">&#125;</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'javascript/auto'</span> <span class="token comment">// webpack v5</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> 
      <span class="token punctuation">&#123;</span>
        <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.css$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">&#123;</span>
            <span class="token literal-property property">loader</span><span class="token operator">:</span> MiniCssExtractPlugin<span class="token punctuation">.</span>loader<span class="token punctuation">,</span>
            <span class="token literal-property property">options</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
              <span class="token comment">// 将 CSS 提取到单独的文件中，为每个包含 CSS 的 JS 文件创建一个 CSS 文件，并且支持 CSS 和 SourceMaps 的按需加载。</span>
              <span class="token function-variable function">publicPath</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">resourcePath</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
                <span class="token keyword">return</span> path<span class="token punctuation">.</span><span class="token function">relative</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">dirname</span><span class="token punctuation">(</span>resourcePath<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span><span class="token constant">PATHS</span><span class="token punctuation">.</span>src<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">/</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'/'</span><span class="token punctuation">;</span>
              <span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span>
          <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
          <span class="token string">'css-loader'</span><span class="token punctuation">,</span>
          <span class="token string">'postcss-loader'</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">&#125;</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>webpack.dev.conf.js</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> webpack <span class="token operator">=</span>  <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token punctuation">&#123;</span> merge <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack-merge'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> baseWebpackConfig <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./webpack.base.conf'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> devWebpackConfig <span class="token operator">=</span> <span class="token function">merge</span><span class="token punctuation">(</span>baseWebpackConfig<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>
  <span class="token comment">// DEV config</span>
  <span class="token literal-property property">mode</span><span class="token operator">:</span> <span class="token string">'development'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">devtool</span><span class="token operator">:</span> <span class="token string">'cheap-module-eval-source-map'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">devServer</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token literal-property property">contentBase</span><span class="token operator">:</span> baseWebpackConfig<span class="token punctuation">.</span>externals<span class="token punctuation">.</span>paths<span class="token punctuation">.</span>dist<span class="token punctuation">,</span> <span class="token comment">// 且仅在使用静态资源的时候配置</span>
    <span class="token literal-property property">port</span><span class="token operator">:</span> <span class="token number">8081</span><span class="token punctuation">,</span>
    <span class="token literal-property property">open</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token literal-property property">hot</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token literal-property property">hotOnly</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 热更新</span>
    <span class="token comment">// historyApiFallback: true, // 响应html内容</span>
    <span class="token literal-property property">overlay</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token comment">// 编译器警告</span>
      <span class="token literal-property property">warnings</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token literal-property property">errors</span><span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>SourceMapDevToolPlugin</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
      <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">'[file].map'</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token function">resolve</span><span class="token punctuation">(</span>devWebpackConfig<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>webpack.build.conf.js</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> <span class="token punctuation">&#123;</span> merge <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack-merge'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> baseWebpackConfig <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./webpack.base.conf'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> buildWebpackConfig <span class="token operator">=</span> <span class="token function">merge</span><span class="token punctuation">(</span>baseWebpackConfig<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>
  <span class="token comment">// BUILD config</span>
  <span class="token literal-property property">mode</span><span class="token operator">:</span> <span class="token string">'production'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token function">resolve</span><span class="token punctuation">(</span>buildWebpackConfig<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h4 id="其他配置"><a href="#其他配置" class="headerlink" title="其他配置"></a>其他配置</h4><p>postcss.config.js</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// autoprefixer - https://github.com/postcss/autoprefixer</span>
<span class="token comment">// css-mqpacker - https://github.com/hail2u/node-css-mqpacker</span>
<span class="token comment">// cssnano      - https://github.com/hail2u/node-css-mqpacker</span>

<span class="token comment">// npm install postcss-loader autoprefixer css-mqpacker cssnano --save-dev</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'autoprefixer'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'css-mqpacker'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'cssnano'</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
            <span class="token literal-property property">preset</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                <span class="token string">'default'</span><span class="token punctuation">,</span> 
                <span class="token punctuation">&#123;</span>
                    <span class="token literal-property property">discardComments</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
                        <span class="token literal-property property">removeAll</span><span class="token operator">:</span> <span class="token boolean">true</span>
                    <span class="token punctuation">&#125;</span>
                <span class="token punctuation">&#125;</span>
            <span class="token punctuation">]</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>.babelrc</p>
<pre class="line-numbers language-none"><code class="language-none">&#123;
    &quot;presets&quot;: [
    	&quot;@babel&#x2F;preset-env&quot;
    ]
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>



]]></content>
      <categories>
        <category>前端</category>
        <category>webpack</category>
      </categories>
      <tags>
        <tag>前端</tag>
        <tag>webpack</tag>
        <tag>pug</tag>
      </tags>
  </entry>
  <entry>
    <title>vue的UI框架整理</title>
    <url>/posts/29902/</url>
    <content><![CDATA[<h4 id="同时适用于PC端和移动端的UI框架"><a href="#同时适用于PC端和移动端的UI框架" class="headerlink" title="同时适用于PC端和移动端的UI框架"></a>同时适用于PC端和移动端的UI框架</h4><h5 id="1-Muse-ui-基于-Vue-2-0-和-Material-Design-的-UI-组件库"><a href="#1-Muse-ui-基于-Vue-2-0-和-Material-Design-的-UI-组件库" class="headerlink" title="1.Muse-ui 基于 Vue 2.0 和 Material Design 的 UI 组件库"></a>1.Muse-ui 基于 Vue 2.0 和 Material Design 的 UI 组件库</h5><p>github：<a href="https://github.com/museui/muse-ui">https://github.com/museui/muse-ui</a></p>
<p>文档：<a href="https://muse-ui.org/">https://muse-ui.org/</a></p>
<h5 id="2-vue-material-为-Vue-js-打造的-Material-风格的组件"><a href="#2-vue-material-为-Vue-js-打造的-Material-风格的组件" class="headerlink" title="2.vue-material 为 Vue.js 打造的 Material 风格的组件"></a>2.vue-material 为 Vue.js 打造的 Material 风格的组件</h5><p>github：<a href="https://github.com/vuematerial/vue-material">https://github.com/vuematerial/vue-material</a><br>文档：<a href="https://vuematerial.github.io/#/">https://vuematerial.github.io/#/</a></p>
<h5 id="3-ant-design-vue-ant-design的vue版！！！"><a href="#3-ant-design-vue-ant-design的vue版！！！" class="headerlink" title="3.ant-design-vue ant-design的vue版！！！"></a>3.ant-design-vue ant-design的vue版！！！</h5><p>github：<a href="https://github.com/vueComponent/ant-design-vue">https://github.com/vueComponent/ant-design-vue</a></p>
<p>文档：<a href="https://vue.ant.design/docs/vue/introduce-cn/">https://vue.ant.design/docs/vue/introduce-cn/</a></p>
<h5 id="4-Vuetify-渐进式框架"><a href="#4-Vuetify-渐进式框架" class="headerlink" title="4.Vuetify 渐进式框架"></a>4.Vuetify 渐进式框架</h5><p>github：<a href="https://github.com/vuetifyjs/vuetify">https://github.com/vuetifyjs/vuetify</a></p>
<p>文档：<a href="https://vuetifyjs.com/zh-Hans/getting-started/quick-start">https://vuetifyjs.com/zh-Hans/getting-started/quick-start</a></p>
<h4 id="只适用于PC端"><a href="#只适用于PC端" class="headerlink" title="只适用于PC端"></a>只适用于PC端</h4><h5 id="1-Element-饿了么-vue-2-0后台UI框架"><a href="#1-Element-饿了么-vue-2-0后台UI框架" class="headerlink" title="1.Element 饿了么 vue 2.0后台UI框架"></a>1.Element 饿了么 vue 2.0后台UI框架</h5><p>github：<a href="https://github.com/ElemeFE/element">https://github.com/ElemeFE/element</a></p>
<h5 id="2-iview组件库-主要服务于-PC-界面的中后台业务"><a href="#2-iview组件库-主要服务于-PC-界面的中后台业务" class="headerlink" title="2.iview组件库 主要服务于 PC 界面的中后台业务"></a>2.iview组件库 主要服务于 PC 界面的中后台业务</h5><p>github：<a href="https://github.com/iview/iview">https://github.com/iview/iview</a><br>文档：<a href="https://iviewui.com/">https://iviewui.com/</a></p>
<h5 id="3-Vux-基于WeUI和Vue-2-x-开发的移动端UI组件库"><a href="#3-Vux-基于WeUI和Vue-2-x-开发的移动端UI组件库" class="headerlink" title="3.Vux 基于WeUI和Vue(2.x)开发的移动端UI组件库"></a>3.Vux 基于WeUI和Vue(2.x)开发的移动端UI组件库</h5><p>github：<a href="https://github.com/airyland/vux">https://github.com/airyland/vux</a><br>文档：<a href="https://vux.li/">https://vux.li/</a></p>
<h5 id="4-KeenUI-基于Material-Design的UI库"><a href="#4-KeenUI-基于Material-Design的UI库" class="headerlink" title="4.KeenUI 基于Material Design的UI库"></a>4.KeenUI 基于Material Design的UI库</h5><p>不包含网格系统、排版等样式</p>
<p>github：<a href="https://josephuspaye.github.io/Keen-UI/">https://josephuspaye.github.io/Keen-UI/</a></p>
<h5 id="5-buefy-基于bulma的UI框架"><a href="#5-buefy-基于bulma的UI框架" class="headerlink" title="5.buefy 基于bulma的UI框架"></a>5.buefy 基于bulma的UI框架</h5><p>github：<a href="https://github.com/buefy/buefy">https://github.com/buefy/buefy</a></p>
<p>文档：<a href="https://buefy.org/documentation/start">https://buefy.org/documentation/start</a></p>
<h5 id="6-heyUI-主要服务于一些中后台产品"><a href="#6-heyUI-主要服务于一些中后台产品" class="headerlink" title="6.heyUI 主要服务于一些中后台产品"></a>6.heyUI 主要服务于一些中后台产品</h5><p>github：<a href="https://github.com/heyui/heyui">https://github.com/heyui/heyui</a></p>
<p>文档：<a href="https://www.heyui.top/">https://www.heyui.top/</a></p>
<h5 id="7-vue-blu-基于Bulma开发的开源UI组件库-中后台产品"><a href="#7-vue-blu-基于Bulma开发的开源UI组件库-中后台产品" class="headerlink" title="7.vue-blu 基于Bulma开发的开源UI组件库 中后台产品"></a>7.vue-blu 基于Bulma开发的开源UI组件库 中后台产品</h5><p>github：<a href="https://github.com/chenz24/vue-blu">https://github.com/chenz24/vue-blu</a></p>
<p>文档：<a href="https://chenz24.github.io/vue-blu/#/">https://chenz24.github.io/vue-blu/#/</a></p>
<h5 id="8-at-ui-主要开发中后台产品"><a href="#8-at-ui-主要开发中后台产品" class="headerlink" title="8.at-ui 主要开发中后台产品"></a>8.at-ui 主要开发中后台产品</h5><p>github：<a href="https://github.com/AT-UI/at-ui">https://github.com/AT-UI/at-ui</a></p>
<p>文档：<a href="https://at-ui.github.io/at-ui/#/zh/docs/introduction">https://at-ui.github.io/at-ui/#/zh/docs/introduction</a></p>
<h5 id="9-bootstrap-vue-基于Bootstrap的UI组件库"><a href="#9-bootstrap-vue-基于Bootstrap的UI组件库" class="headerlink" title="9.bootstrap-vue 基于Bootstrap的UI组件库"></a>9.bootstrap-vue 基于Bootstrap的UI组件库</h5><p>github：<a href="https://github.com/bootstrap-vue/bootstrap-vue">https://github.com/bootstrap-vue/bootstrap-vue</a></p>
<p>文档：<a href="https://bootstrap-vue.js.org/docs/">https://bootstrap-vue.js.org/docs/</a></p>
<h5 id="10-semantic-ui-vue-基于Semantic-UI的UI组件库（开发阶段）"><a href="#10-semantic-ui-vue-基于Semantic-UI的UI组件库（开发阶段）" class="headerlink" title="10.semantic-ui-vue 基于Semantic UI的UI组件库（开发阶段）"></a>10.semantic-ui-vue 基于Semantic UI的UI组件库（开发阶段）</h5><p>github：<a href="https://github.com/Semantic-UI-Vue/Semantic-UI-Vue">https://github.com/Semantic-UI-Vue/Semantic-UI-Vue</a></p>
<p>文档：<a href="https://semantic-ui-vue.github.io/#/">https://semantic-ui-vue.github.io/#/</a></p>
<h5 id="11-veui-采用组件库样式与逻辑分离的方式开发，来自百度团队"><a href="#11-veui-采用组件库样式与逻辑分离的方式开发，来自百度团队" class="headerlink" title="11.veui 采用组件库样式与逻辑分离的方式开发，来自百度团队"></a>11.veui 采用组件库样式与逻辑分离的方式开发，来自百度团队</h5><p>github：<a href="https://github.com/ecomfe/veui">https://github.com/ecomfe/veui</a></p>
<p>文档：<a href="https://veui.dev/">https://veui.dev/</a></p>
<h5 id="12-n3-components"><a href="#12-n3-components" class="headerlink" title="12.n3-components"></a>12.n3-components</h5><p>github：<a href="https://github.com/N3-components/N3-components">https://github.com/N3-components/N3-components</a></p>
<p>文档：<a href="https://n3-components.github.io/N3-components/component.html">https://n3-components.github.io/N3-components/component.html</a></p>
<h4 id="只适用于移动端"><a href="#只适用于移动端" class="headerlink" title="只适用于移动端"></a>只适用于移动端</h4><h5 id="1-vonic-基于ionic的UI框架"><a href="#1-vonic-基于ionic的UI框架" class="headerlink" title="1.vonic 基于ionic的UI框架"></a>1.vonic 基于ionic的UI框架</h5><p>github：<a href="https://github.com/wangdahoo/vonic/">https://github.com/wangdahoo/vonic/</a><br>文档：<a href="https://wangdahoo.github.io/vonic/docs/#/">https://wangdahoo.github.io/vonic/docs/#/</a></p>
<h5 id="2-vant-移动版-小程序"><a href="#2-vant-移动版-小程序" class="headerlink" title="2.vant 移动版-小程序"></a>2.vant 移动版-小程序</h5><p>github：<a href="https://github.com/youzan/vant">https://github.com/youzan/vant</a></p>
<p>文档：<a href="https://youzan.github.io/vant/#/zh-CN/intro">https://youzan.github.io/vant/#/zh-CN/intro</a></p>
<h5 id="3-cube-ui-滴滴移动端UI框架"><a href="#3-cube-ui-滴滴移动端UI框架" class="headerlink" title="3.cube-ui 滴滴移动端UI框架"></a>3.cube-ui 滴滴移动端UI框架</h5><p>github：<a href="https://github.com/didi/cube-ui">https://github.com/didi/cube-ui</a></p>
<p>文档：<a href="https://didi.github.io/cube-ui/">https://didi.github.io/cube-ui/</a></p>
<h5 id="4-mand-mobile-滴滴面向金融场景的移动端UI组件库"><a href="#4-mand-mobile-滴滴面向金融场景的移动端UI组件库" class="headerlink" title="4.mand-mobile 滴滴面向金融场景的移动端UI组件库"></a>4.mand-mobile 滴滴面向金融场景的移动端UI组件库</h5><p>github：<a href="https://github.com/didi/mand-mobile">https://github.com/didi/mand-mobile</a></p>
<p>文档：<a href="https://didi.github.io/mand-mobile/">https://didi.github.io/mand-mobile/</a></p>
<h5 id="5-vue-ydui-移动端和微信UI"><a href="#5-vue-ydui-移动端和微信UI" class="headerlink" title="5.vue-ydui 移动端和微信UI"></a>5.vue-ydui 移动端和微信UI</h5><p>github：<a href="https://github.com/ydcss/vue-ydui">https://github.com/ydcss/vue-ydui</a></p>
<p>文档：<a href="http://vue.ydui.org/docs/#/quickstart">http://vue.ydui.org/docs/#/quickstart</a></p>
<h5 id="6-we-vue-移动端和微信UI"><a href="#6-we-vue-移动端和微信UI" class="headerlink" title="6.we-vue 移动端和微信UI"></a>6.we-vue 移动端和微信UI</h5><p>github：<a href="https://github.com/tianyong90/we-vue">https://github.com/tianyong90/we-vue</a></p>
<p>文档：<a href="https://wevue.org/doc/v2/index">https://wevue.org/doc/v2/index</a></p>
]]></content>
      <categories>
        <category>整理</category>
      </categories>
      <tags>
        <tag>前端</tag>
        <tag>vue</tag>
        <tag>UI框架</tag>
      </tags>
  </entry>
  <entry>
    <title>webpack系列-优化vue项目</title>
    <url>/posts/43272967/</url>
    <content><![CDATA[<p>前情提要：</p>
<p>后台管理系统由于两年来公司项目发展较快，增加了很多有的没的业务代码，由于初期太菜没有考虑到优化，导致 <code>antd-vue</code> 全局导入，使用的 <code>admin</code> 模板框架，没有及时删除无用的代码，雪球越滚越大，以致于现在首屏加载巨慢无比。</p>
<p>参考项目：<a href="https://github.com/edenleung/think-ant-vue">https://github.com/edenleung/think-ant-vue</a> 其中的 <code>issure#14</code> 具有相关介绍。</p>
<p>参考文章：</p>
<p><a href="https://github.com/neutrinojs/webpack-chain/tree/v4">webpack-chain@v4</a></p>
<p><a href="https://github.com/zhouzhili/blog/issues/2">webpack 区分环境使用CDN以及HtmlWebpackPlugin插件的编写</a></p>
<p><a href="https://segmentfault.com/a/1190000012113011">webpack externals 深入理解</a></p>
<p><a href="https://webpack.docschina.org/plugins/compression-webpack-plugin/">compression-webpack-plugin - webpack</a></p>
<p><a href="https://github.com/webpack-contrib/compression-webpack-plugin">compression-webpack-plugin - Github</a></p>
<p><a href="https://cli.vuejs.org/zh/guide/webpack.html#%E7%AE%80%E5%8D%95%E7%9A%84%E9%85%8D%E7%BD%AE%E6%96%B9%E5%BC%8F">vue-cli webpack相关</a></p>
<p><a href="https://juejin.cn/post/6844904180587479054">Vue cli 配置CDN及Gzip</a></p>
<p>关于使用：brotli-webpack-plugin</p>
<p><a href="https://slashgear.github.io/why-you-should-use-compression-webpack-plugin/">Why you should use Compression Webpack Plugin?</a></p>
<p><a href="https://tech.groww.in/enable-brotli-compression-in-webpack-with-fallback-to-gzip-397a57cf9fc6">Enable Brotli Compression in Webpack with Fallback to Gzip</a></p>
<p><a href="https://www.codementor.io/@rachitgulati/express-brotli-webpack-uarb1of3j">Express + Brotli + Webpack</a></p>
<p>问题解决：</p>
<p><a href="https://stackoverflow.com/questions/65156116/typeerror-cannot-read-property-tappromise-of-undefined">TypeError: Cannot read property ‘tapPromise’ of undefined</a></p>
<p>遇到这个问题主要是 <code>compression-webpack-plugin</code> 版本太新，换了一个旧版本就ok了。</p>
<h3 id="项目实现"><a href="#项目实现" class="headerlink" title="项目实现"></a>项目实现</h3><p>项目环境：</p>
<ul>
<li>vue 2.x</li>
<li>vue-cli 3.x</li>
<li>webpack 4.x</li>
</ul>
<h4 id="public-index-html"><a href="#public-index-html" class="headerlink" title="public/index.html"></a>public/index.html</h4><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>zh-cmn-Hans<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>utf-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>X-UA-Compatible<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>IE=edge<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>width=device-width,initial-scale=1.0<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>icon<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>&lt;%= BASE_URL %>logo.ico<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>后台管理系统<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>
    <span class="token comment">&lt;!-- require cdn assets css --></span>
    &lt;% for (var i in htmlWebpackPlugin.options.cdn &amp;&amp; htmlWebpackPlugin.options.cdn.css) &#123; %>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>stylesheet<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>&lt;%= htmlWebpackPlugin.options.cdn.css[i] %><span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
    &lt;% &#125; %>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>noscript</span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>strong</span><span class="token punctuation">></span></span>We're sorry but vue-antd-pro doesn't work properly without JavaScript enabled. Please enable it to continue.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>strong</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>noscript</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>app<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>preloadingAnimation<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>lds-roller</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>load-tips</span><span class="token punctuation">></span></span>Loading<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
    <span class="token comment">&lt;!-- require cdn assets js --></span>
    &lt;% for (var i in htmlWebpackPlugin.options.cdn &amp;&amp; htmlWebpackPlugin.options.cdn.js) &#123; %>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text/javascript<span class="token punctuation">"</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>&lt;%= htmlWebpackPlugin.options.cdn.js[i] %><span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>
    &lt;% &#125; %>
    <span class="token comment">&lt;!-- built files will be auto injected --></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>//cdn.ronghub.com/RongIMLib-2.5.5.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>使用 <code>htmlWebpackPlugin</code> 传值，对 <code>html template</code> 进行编译。</p>
<h4 id="vue-config-js"><a href="#vue-config-js" class="headerlink" title="vue.config.js"></a>vue.config.js</h4><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> CompressionWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'compression-webpack-plugin'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> zopfli <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'@gfx/zopfli'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> BrotliPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'brotli-webpack-plugin'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> BundleAnalyzerPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack-bundle-analyzer'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>BundleAnalyzerPlugin

<span class="token keyword">const</span> <span class="token constant">NEED_ANALYSE</span> <span class="token operator">=</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">ANALYSE</span> <span class="token operator">==</span> <span class="token string">'on'</span>
<span class="token keyword">const</span> <span class="token constant">IS_PROD</span> <span class="token operator">=</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">===</span> <span class="token string">'production'</span>

<span class="token keyword">function</span> <span class="token function">resolve</span> <span class="token punctuation">(</span><span class="token parameter">dir</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	<span class="token keyword">return</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> dir<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">const</span> assetsCDN <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
	<span class="token literal-property property">externals</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
		<span class="token string-property property">'vue'</span><span class="token operator">:</span> <span class="token string">'Vue'</span><span class="token punctuation">,</span>
		<span class="token string-property property">'vuex'</span><span class="token operator">:</span> <span class="token string">'Vuex'</span><span class="token punctuation">,</span>
		<span class="token string-property property">'vue-router'</span><span class="token operator">:</span> <span class="token string">'VueRouter'</span><span class="token punctuation">,</span>
		<span class="token string-property property">'axios'</span><span class="token operator">:</span> <span class="token string">'axios'</span><span class="token punctuation">,</span>
		<span class="token string-property property">'moment'</span><span class="token operator">:</span> <span class="token string">'moment'</span><span class="token punctuation">,</span>
		<span class="token string-property property">'ant-design-vue'</span><span class="token operator">:</span> <span class="token string">'antd'</span><span class="token punctuation">,</span>
		<span class="token string-property property">'viser-vue'</span><span class="token operator">:</span> <span class="token string">'ViserVue'</span><span class="token punctuation">,</span> <span class="token comment">// viserVue 会使用g2</span>
	<span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
	<span class="token literal-property property">css</span><span class="token operator">:</span> <span class="token punctuation">[</span>
		<span class="token string">'//cdn.jsdelivr.net/npm/ant-design-vue@1.7.5/dist/antd.min.css'</span>
	<span class="token punctuation">]</span><span class="token punctuation">,</span>
	<span class="token literal-property property">js</span><span class="token operator">:</span> <span class="token punctuation">[</span>
		<span class="token string">'//cdnjs.cloudflare.com/ajax/libs/vue/2.5.13/vue.min.js'</span><span class="token punctuation">,</span>
		<span class="token string">'//cdnjs.cloudflare.com/ajax/libs/vuex/3.1.0/vuex.min.js'</span><span class="token punctuation">,</span>
		<span class="token string">'//cdnjs.cloudflare.com/ajax/libs/vue-router/3.0.1/vue-router.min.js'</span><span class="token punctuation">,</span>
		<span class="token string">'//cdnjs.cloudflare.com/ajax/libs/moment.js/2.24.0/moment.min.js'</span><span class="token punctuation">,</span>
		<span class="token string">'//cdnjs.cloudflare.com/ajax/libs/moment.js/2.24.0/locale/zh-cn.js'</span><span class="token punctuation">,</span>
		<span class="token string">'//cdnjs.cloudflare.com/ajax/libs/axios/0.18.0/axios.min.js'</span><span class="token punctuation">,</span>
		<span class="token string">'//cdn.jsdelivr.net/npm/ant-design-vue@1.7.5/dist/antd.min.js'</span><span class="token punctuation">,</span>
		<span class="token string">'//cdn.jsdelivr.net/npm/viser-vue@2.4.3/umd/viser-vue.min.js'</span>
	<span class="token punctuation">]</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// vue.config.js</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
	<span class="token comment">// 基本路径</span>
	<span class="token literal-property property">publicPath</span><span class="token operator">:</span> <span class="token string">'./'</span><span class="token punctuation">,</span>
	<span class="token comment">// 输出文件目录</span>
	<span class="token literal-property property">outputDir</span><span class="token operator">:</span> <span class="token string">'dist'</span><span class="token punctuation">,</span>
	<span class="token literal-property property">assetsDir</span><span class="token operator">:</span> <span class="token string">'static'</span><span class="token punctuation">,</span>
	<span class="token literal-property property">productionSourceMap</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
	<span class="token function-variable function">configureWebpack</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
		<span class="token keyword">const</span> config <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
		<span class="token keyword">const</span> plugins <span class="token operator">=</span> <span class="token punctuation">[</span>
            <span class="token comment">// 存在问题 moment 进行cdn了 但是还是打包了 可能是其他库进行了引入 待确认</span>
			<span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>IgnorePlugin</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^\.\/locale$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">moment$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">)</span> <span class="token comment">// 忽略 moment/locale 下的所有文件</span>
		<span class="token punctuation">]</span>
		<span class="token constant">NEED_ANALYSE</span> <span class="token operator">&amp;&amp;</span> plugins<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>
			<span class="token keyword">new</span> <span class="token class-name">BundleAnalyzerPlugin</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
				<span class="token literal-property property">analyzerMode</span><span class="token operator">:</span> <span class="token string">'server'</span>
			<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
		<span class="token punctuation">)</span>

		<span class="token constant">IS_PROD</span> <span class="token operator">&amp;&amp;</span> plugins<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>
			<span class="token comment">// Gzip</span>
			<span class="token keyword">new</span> <span class="token class-name">CompressionWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
				<span class="token function">algorithm</span><span class="token punctuation">(</span><span class="token parameter">input<span class="token punctuation">,</span> compressionOptions<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
					<span class="token keyword">return</span> zopfli<span class="token punctuation">.</span><span class="token function">gzip</span><span class="token punctuation">(</span>input<span class="token punctuation">,</span> compressionOptions<span class="token punctuation">,</span> callback<span class="token punctuation">)</span>
				<span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
				<span class="token literal-property property">compressionOptions</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
					<span class="token literal-property property">numiterations</span><span class="token operator">:</span> <span class="token number">15</span>
				<span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
				<span class="token literal-property property">minRatio</span><span class="token operator">:</span> <span class="token number">0.99</span><span class="token punctuation">,</span>
				<span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.(js|css|json|txt|html|ico|svg)(\?.*)?$</span><span class="token regex-delimiter">/</span><span class="token regex-flags">i</span></span>
			<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
			<span class="token keyword">new</span> <span class="token class-name">BrotliPlugin</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
				<span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.(js|css|json|txt|html|ico|svg)(\?.*)?$</span><span class="token regex-delimiter">/</span><span class="token regex-flags">i</span></span><span class="token punctuation">,</span>
				<span class="token literal-property property">minRatio</span><span class="token operator">:</span> <span class="token number">0.99</span>
			<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
		<span class="token punctuation">)</span>

		config<span class="token punctuation">.</span>plugins <span class="token operator">=</span> plugins
		config<span class="token punctuation">.</span>externals <span class="token operator">=</span> <span class="token constant">IS_PROD</span> <span class="token operator">?</span> assetsCDN<span class="token punctuation">.</span>externals <span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>

		<span class="token keyword">return</span> config
	<span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
	<span class="token comment">// chainWebpack文档 https://github.com/Yatoo2018/webpack-chain/tree/zh-cmn-Hans</span>
	<span class="token function-variable function">chainWebpack</span><span class="token operator">:</span> <span class="token parameter">config</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
		config<span class="token punctuation">.</span>resolve<span class="token punctuation">.</span>alias
			<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'@$'</span><span class="token punctuation">,</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'src'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
			<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'@api'</span><span class="token punctuation">,</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'src/api'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
			<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'@assets'</span><span class="token punctuation">,</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'src/assets'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
			<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'@comp'</span><span class="token punctuation">,</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'src/components'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
			<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'@views'</span><span class="token punctuation">,</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'src/views'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
			<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'@layout'</span><span class="token punctuation">,</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'src/layout'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
			<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'@static'</span><span class="token punctuation">,</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'src/static'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

		<span class="token comment">// 替换svg 处理 loader </span>
		<span class="token keyword">const</span> svgRule <span class="token operator">=</span> config<span class="token punctuation">.</span>module<span class="token punctuation">.</span><span class="token function">rule</span><span class="token punctuation">(</span><span class="token string">'svg'</span><span class="token punctuation">)</span>
		svgRule<span class="token punctuation">.</span>uses<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		svgRule
			<span class="token punctuation">.</span><span class="token function">oneOf</span><span class="token punctuation">(</span><span class="token string">'inline'</span><span class="token punctuation">)</span>
			<span class="token punctuation">.</span><span class="token function">resourceQuery</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">inline</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">)</span>
			<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">'vue-svg-icon-loader'</span><span class="token punctuation">)</span>
			<span class="token punctuation">.</span><span class="token function">loader</span><span class="token punctuation">(</span><span class="token string">'vue-svg-icon-loader'</span><span class="token punctuation">)</span>
			<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
			<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
			<span class="token punctuation">.</span><span class="token function">oneOf</span><span class="token punctuation">(</span><span class="token string">'external'</span><span class="token punctuation">)</span>
			<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">'file-loader'</span><span class="token punctuation">)</span>
			<span class="token punctuation">.</span><span class="token function">loader</span><span class="token punctuation">(</span><span class="token string">'file-loader'</span><span class="token punctuation">)</span>
			<span class="token punctuation">.</span><span class="token function">options</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
				<span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'assets/[name].[hash:8].[ext]'</span>
			<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>

		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">IS_PROD</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
			<span class="token comment">// 利用 html-webpack-plugin</span>
			config<span class="token punctuation">.</span><span class="token function">plugin</span><span class="token punctuation">(</span><span class="token string">'html'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token parameter">args</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
				args<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>cdn <span class="token operator">=</span> assetsCDN
				<span class="token keyword">return</span> args
			<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
		<span class="token punctuation">&#125;</span>

		<span class="token comment">// config.plugins.delete('prefetch')</span>
	<span class="token punctuation">&#125;</span><span class="token punctuation">,</span>

	<span class="token literal-property property">css</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
		<span class="token literal-property property">loaderOptions</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
			<span class="token literal-property property">less</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
				<span class="token literal-property property">modifyVars</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
					<span class="token comment">/* less 变量覆盖，用于自定义 ant design 主题 */</span>
					<span class="token comment">/*
                    'primary-color': '#F5222D',
                    'link-color': '#F5222D',
                    'border-radius-base': '4px',
                    */</span>
				<span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
				<span class="token literal-property property">javascriptEnabled</span><span class="token operator">:</span> <span class="token boolean">true</span>
			<span class="token punctuation">&#125;</span>
		<span class="token punctuation">&#125;</span>
	<span class="token punctuation">&#125;</span><span class="token punctuation">,</span>

	<span class="token literal-property property">lintOnSave</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
	<span class="token comment">// babel-loader no-ignore node_modules/*</span>
	<span class="token literal-property property">transpileDependencies</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h4 id="package-json"><a href="#package-json" class="headerlink" title="package.json"></a>package.json</h4><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>
    ...
    <span class="token property">"scripts"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        <span class="token property">"serve"</span><span class="token operator">:</span> <span class="token string">"vue-cli-service serve --open --mode development"</span><span class="token punctuation">,</span>
        <span class="token property">"build"</span><span class="token operator">:</span> <span class="token string">"vue-cli-service build"</span><span class="token punctuation">,</span>
        <span class="token property">"dev-build"</span><span class="token operator">:</span> <span class="token string">"vue-cli-service build --mode development"</span><span class="token punctuation">,</span>
        <span class="token property">"lint"</span><span class="token operator">:</span> <span class="token string">"vue-cli-service lint"</span><span class="token punctuation">,</span>
        <span class="token property">"test:unit"</span><span class="token operator">:</span> <span class="token string">"vue-cli-service test:unit"</span><span class="token punctuation">,</span>
        <span class="token property">"analyse"</span><span class="token operator">:</span> <span class="token string">"cross-env ANALYSE=on NODE_ENV=production vue-cli-service build"</span><span class="token punctuation">,</span>
        <span class="token property">"rebuild"</span><span class="token operator">:</span> <span class="token string">"sh scripts/rebuild.sh"</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    ...
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h4 id="效果"><a href="#效果" class="headerlink" title="效果"></a>效果</h4><h5 id="未优化前"><a href="#未优化前" class="headerlink" title="未优化前"></a>未优化前</h5><p><img src="./before_parse.png" alt="before_parse" style="zoom:80%;" /><img src="./before_gzip.png" alt="before_gzip" style="zoom:80%;" /></p>
<h5 id="优化后"><a href="#优化后" class="headerlink" title="优化后"></a>优化后</h5><p><img src="./after_parse.png" alt="after_parse" style="zoom:67%;" /><img src="./after_gzip.png" alt="after_gzip" style="zoom:67%;" /></p>
<h3 id="项目总结"><a href="#项目总结" class="headerlink" title="项目总结"></a>项目总结</h3><p>对于最基础的项目优化来说，应该是 UI组件库 的按需加载。</p>
<p>如果使用 CDN 进行导入，<a href="https://cn.vuejs.org/v2/guide/installation.html#%E5%AF%B9%E4%B8%8D%E5%90%8C%E6%9E%84%E5%BB%BA%E7%89%88%E6%9C%AC%E7%9A%84%E8%A7%A3%E9%87%8A">vue 版本是完整版本</a>，包含了编译器和运行时的版本，会比 npm 导入的运行时版本 要大大约 30%。UI组件库也是完整版本，因此会加载很多没有使用到的组件，且不会<code>tree-sharking</code>。</p>
<p>因此，对于项目的最初搭建，按需加载时最好的优化手段。到项目后期再考虑是否使用 <code>externals</code> 抽离使用 CDN 。</p>
<p><code>compression-webpack-plugin</code> 主要是通过内容编码优化压缩为服务器提供压缩版本，生成<code>.gz</code>文件。这需要 nginx 服务器也要做相应的<a href="https://www.fxss.work/vue-blog/detail/99#nginx-%E9%9D%99%E6%80%81%E5%8E%8B%E7%BC%A9">配置</a>。</p>
<p><code>brotli-webpack-plugin</code> 算法比 <code>gzip</code> 压缩更好，生成<code>.br</code>文件供服务器使用，但是<a href="https://caniuse.com/?search=brotli">支持率</a>没有 gzip 广，所以要有一个 gzip 的版本进行 shim。</p>
<blockquote>
<p>对于 prefetch 来说，可以使用 prefetch 进行 CDN 请求处理，但是需要考虑兼容性。要做的话需要参考 vue-cli 如何实现 prefetch 的。</p>
</blockquote>
<p>待做部分：</p>
<ul>
<li><input disabled="" type="checkbox"> visterVue CDN 抽离影响。</li>
</ul>
]]></content>
      <categories>
        <category>前端</category>
        <category>webpack</category>
      </categories>
      <tags>
        <tag>前端</tag>
        <tag>vue</tag>
        <tag>webpack</tag>
        <tag>vue-cli</tag>
      </tags>
  </entry>
  <entry>
    <title>webpack系列-进阶</title>
    <url>/posts/26727/</url>
    <content><![CDATA[<h4 id="编写一个简单的Loader"><a href="#编写一个简单的Loader" class="headerlink" title="编写一个简单的Loader"></a>编写一个简单的Loader</h4><h5 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h5><p>loader api: <a href="https://webpack.docschina.org/api/loaders/">https://webpack.docschina.org/api/loaders/</a></p>
<p>resolveLoader: <a href="https://webpack.docschina.org/configuration/resolve/#resolveloader">https://webpack.docschina.org/configuration/resolve/#resolveloader</a></p>
<h5 id="初始化简单的项目"><a href="#初始化简单的项目" class="headerlink" title="初始化简单的项目"></a>初始化简单的项目</h5><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">npm</span> init <span class="token parameter variable">-y</span>

<span class="token function">npm</span> <span class="token function">install</span> --save-dev webpack webpack-cli
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<h5 id="创建loader"><a href="#创建loader" class="headerlink" title="创建loader"></a>创建loader</h5><p>loader本质就是函数</p>
<p>创建完成本地的loader之后，在本地项目中使用<code>webpack.config.js</code>：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  <span class="token literal-property property">mode</span><span class="token operator">:</span> <span class="token string">'development'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">entry</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token literal-property property">main</span><span class="token operator">:</span> <span class="token string">'./src/index.js'</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">&#123;</span>
        <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.js</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token comment">// 使用本地loader</span>
          path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'./loaders/replaceLoader.js'</span><span class="token punctuation">)</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">&#125;</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token literal-property property">path</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'dist'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">'[name].js'</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>使用更多的配置项，让loader中可以获取到配置项内容：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// webpack.config.js</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  <span class="token operator">...</span>
  <span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">&#123;</span>
        <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.js</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token comment">// 使用本地loader</span>
          <span class="token punctuation">&#123;</span>
            <span class="token literal-property property">loader</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'./loaders/replaceLoader.js'</span><span class="token punctuation">)</span>
            <span class="token literal-property property">options</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token comment">// loader中可以通过this.query获取配置内容</span>
              <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'dellLee'</span>
            <span class="token punctuation">&#125;</span>
          <span class="token punctuation">&#125;</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">&#125;</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">&#125;</span>
  <span class="token operator">...</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// loader.js</span>
module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">source</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>query<span class="token punctuation">)</span> <span class="token comment">// &#123; name: 'dellLee &#125;</span>
  <span class="token keyword">return</span> source<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">'dell'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>query<span class="token punctuation">.</span>name<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>需要返回多余的信息使用this.callback，使用this.async进行异步操作</p>
</blockquote>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// loader中使用this.async进行处理</span>
module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">source</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">const</span> options <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> callback <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">async</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// this.async返回一个this.callback</span>
    
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">const</span> result <span class="token operator">=</span> source<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">'dell'</span><span class="token punctuation">,</span> opthions<span class="token punctuation">.</span>name<span class="token punctuation">)</span>
        <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>使用<code>resolveLoader</code>用于解析本地的<code>webpack</code> <code>loader</code>包</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    <span class="token literal-property property">resolveLoader</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        <span class="token literal-property property">modules</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'node_modules'</span><span class="token punctuation">,</span> <span class="token string">'./loaders'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// 会先在node_modules查找loader，如果查找不到则会到第二个配置查找</span>
       <span class="token literal-property property">extensions</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'.js'</span><span class="token punctuation">,</span> <span class="token string">'.json'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token comment">// 配合resolveLoader本地loader使用</span>
            <span class="token punctuation">&#123;</span>
                <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">'replaceLoader'</span><span class="token punctuation">,</span>
                <span class="token literal-property property">options</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token comment">// loader中可以通过this.query获取配置内容</span>
                  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'dellLee'</span>
                <span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>可以使用loader做全局处理，如国际化、错误报警等。</p>
<h4 id="编写一个简单的plugin"><a href="#编写一个简单的plugin" class="headerlink" title="编写一个简单的plugin"></a>编写一个简单的plugin</h4><p>plugin的核心机制：事件驱动，发布订阅的设计模式。</p>
<h5 id="参考文档-1"><a href="#参考文档-1" class="headerlink" title="参考文档"></a>参考文档</h5><p>Plugins: <a href="https://webpack.docschina.org/api/compiler-hooks/">https://webpack.docschina.org/api/compiler-hooks/</a></p>
<p>钩子类型描述：<a href="https://github.com/webpack/tapable#tapable">https://github.com/webpack/tapable#tapable</a></p>
<h5 id="创建插件plugin"><a href="#创建插件plugin" class="headerlink" title="创建插件plugin"></a>创建插件plugin</h5><p>plugin的本质是对象</p>
<p>创建一个简单的plugin用于打印copyright一些信息：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">class</span> <span class="token class-name">CopyrightWebpackPlugin</span> <span class="token punctuation">&#123;</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'插件被使用了'</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
    
    <span class="token function">apply</span><span class="token punctuation">(</span><span class="token parameter">compiler</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">// compiler存放打包的内容和配置</span>
        <span class="token comment">// 输出asset到output目录之前 异步执行</span>
        compiler<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>emit<span class="token punctuation">.</span><span class="token function">tapAsync</span><span class="token punctuation">(</span><span class="token string">'CopyrightWebpackPlugin'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">compilation<span class="token punctuation">,</span> cb</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
            <span class="token comment">// compilation存放此次打包的内容</span>
            compilation<span class="token punctuation">.</span>assets<span class="token punctuation">[</span><span class="token string">'copyright.txt'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token comment">// 生成copyright文件</span>
                <span class="token function-variable function">source</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    <span class="token keyword">return</span> <span class="token string">'copyright by dell lee'</span>
                <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
                <span class="token function-variable function">size</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    <span class="token keyword">return</span> <span class="token number">21</span>
                <span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span>
            <span class="token function">cb</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> CopyrightWebpackPlugin<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><code>compilation.assets</code>中的内容：</p>
<p><img src="/webpack%E8%BF%9B%E9%98%B6/plugin_compilation_assets.png" alt="plugin_compilation_assets"></p>
<p><code>webpack.config.js</code>使用本地创建的plugin：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> CopyrightWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./plugins/copyright-webpack-plugin.js'</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  <span class="token literal-property property">mode</span><span class="token operator">:</span> <span class="token string">'development'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">entry</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token literal-property property">main</span><span class="token operator">:</span> <span class="token string">'./src/index.js'</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">new</span> <span class="token class-name">CopyrightWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
          <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'hello'</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">)</span> <span class="token comment">// 实例化插件</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token literal-property property">path</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'dist'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">'[name].js'</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h4 id="调试"><a href="#调试" class="headerlink" title="调试"></a>调试</h4><p>参考官网文章：<a href="https://www.webpackjs.com/contribute/debugging/">https://www.webpackjs.com/contribute/debugging/</a></p>
<p>安装<code>node-nightly</code>：<code>npm install node-nightly -g</code></p>
<p>安装完成后，需要在命令行中运行一次，结束安装：<code>node-nightly</code></p>
<p>可以直接使用带有 <code>--inspect</code> 标记的 <code>node-nightly</code>，在任何基于 webpack 的项目中开始构建。注意，我们不应该运行 NPM <code>scripts</code>，例如 <code>npm run build</code>，所以我们需要指定完整的 <code>node_modules</code> 路径：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">node-nightly <span class="token parameter variable">--inspect</span> ./node_modules/webpack/bin/webpack.js<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>应该输出如下内容：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">Debugger listening on ws://127.0.0.1:9229/c624201a-250f-416e-a018-300bbec7be2c
For <span class="token builtin class-name">help</span> see https://nodejs.org/en/docs/inspector<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>现在，在浏览器中访问 <code>chrome://inspect</code>，你会看到在 <em>Remote Target</em> 标题下可以进行 inspect(审查) 的活动脚本。单击每个脚本下自动连接会话的 “inspect” 链接，打开一个专门 debugger 或 <em>Open dedicated DevTools for Node</em> 链接。你还可以看到 <a href="https://chrome.google.com/webstore/detail/nodejs-v8-inspector-manag/gnhhdgbaldcilmgcpfddgdbkhjohddkj">NiM 扩展程序</a>，这是一个方便的 Chrome 插件，在每次你通过 <code>--inspect</code> 调试某个脚本时，都会自动打开 DevTools 标签页。</p>
<p>我们推荐使用 <code>--inspect-brk</code> 标记，此标记将在脚本的第一条语句处断开，以便你可以在源代码中设置断点，并根据需要启动/停止构建。此外，不要忘记，你仍然可以向脚本传递参数。例如，如果你有多个配置文件，你可以通过 <code>--config webpack.prod.js</code> 指定你想要调试的配置。</p>
<h5 id="其他参考链接"><a href="#其他参考链接" class="headerlink" title="其他参考链接"></a>其他参考链接</h5><p><code>node debugging</code>: <a href="https://nodejs.org/zh-cn/docs/guides/debugging-getting-started/">https://nodejs.org/zh-cn/docs/guides/debugging-getting-started/</a></p>
<h4 id="创建一个简易的bundler库"><a href="#创建一个简易的bundler库" class="headerlink" title="创建一个简易的bundler库"></a>创建一个简易的bundler库</h4><p>简单的ESM转CJS，<a href="https://datura35422.github.io/2021/03/05/%E6%A8%A1%E5%9D%97%E5%8C%96/">更多模块化知识</a></p>
<p><a href="https://github.com/Datura35422/study/tree/master/webpack-demos/bundler">项目仓库</a></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// index.js为仅简单的模块间相互调用的示例</span>

<span class="token comment">// 简易的打包工具</span>
<span class="token comment">// 对项目的打包，首先要先读取入口文件，对项目代码进行分析</span>
<span class="token comment">// cli-highlight插件，帮助高亮cli输出</span>
<span class="token comment">// @babel/parser 帮助进行源代码语义分析 https://www.babeljs.cn/docs/babel-parser</span>
<span class="token comment">// @babel/traverse 对解析出的抽象语法树进行遍历 https://www.babeljs.cn/docs/babel-traverse</span>
<span class="token comment">// @babel/core babel的核心模块，对代码进行转义，使得可以在浏览器中运行 https://babeljs.io/docs/en/babel-core</span>
<span class="token comment">// @babel/preset-env代码转义插件，将代码转换为目标环境可运行的代码  https://babeljs.io/docs/en/babel-preset-env</span>

<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> parser <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'@babel/parser'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> traverse <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'@babel/traverse'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>default<span class="token punctuation">;</span> <span class="token comment">// 默认ES6 module的导出，使用要用default</span>
<span class="token keyword">const</span> babel <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'@babel/core'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> <span class="token function-variable function">moduleAnalyser</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">filename</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span> <span class="token comment">// 读取文件，获取文件内容 进行解析抽象语法树</span>
    <span class="token keyword">const</span> content <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span>filename<span class="token punctuation">,</span> <span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 获取抽象语法树</span>
    <span class="token keyword">const</span> ast <span class="token operator">=</span> parser<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>content<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>
        <span class="token literal-property property">sourceType</span><span class="token operator">:</span> <span class="token string">'module'</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> dependencies <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span> <span class="token comment">// 获取依赖文件信息, 存入的路径是绝对路径或者是相对于bundle的相对路径</span>
    <span class="token comment">// 如果只存一个相对路径会在打包的时候比较麻烦，所以存一个相对路径和绝对路径</span>
    <span class="token function">traverse</span><span class="token punctuation">(</span>ast<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>
        <span class="token function">ImportDeclaration</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">&#123;</span> node <span class="token punctuation">&#125;</span></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">const</span> dirname <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">dirname</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span>
            <span class="token keyword">const</span> sourceValue <span class="token operator">=</span> node<span class="token punctuation">.</span>source<span class="token punctuation">.</span>value
            <span class="token keyword">const</span> newFile <span class="token operator">=</span> <span class="token string">'./'</span> <span class="token operator">+</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>dirname<span class="token punctuation">,</span> sourceValue<span class="token punctuation">)</span>
            dependencies<span class="token punctuation">[</span>sourceValue<span class="token punctuation">]</span> <span class="token operator">=</span> newFile<span class="token punctuation">;</span> <span class="token comment">// 键值对的方式进行存储</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 对抽象语法树进行转换, 将转换后的code取出</span>
    <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> code <span class="token punctuation">&#125;</span> <span class="token operator">=</span> babel<span class="token punctuation">.</span><span class="token function">transformFromAst</span><span class="token punctuation">(</span>ast<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>
        <span class="token literal-property property">presets</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'@babel/preset-env'</span><span class="token punctuation">]</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>
        filename<span class="token punctuation">,</span> <span class="token comment">// 文件</span>
        dependencies<span class="token punctuation">,</span> <span class="token comment">// 依赖</span>
        code <span class="token comment">// 转移后的代码</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 依赖图谱，将入口文件中的依赖文件再进一步分析，一层一层递进</span>
<span class="token keyword">const</span> <span class="token function-variable function">makeDependenciedGraph</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">entry</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// 分析入口文件</span>
    <span class="token keyword">const</span> entryModule <span class="token operator">=</span> <span class="token function">moduleAnalyser</span><span class="token punctuation">(</span>entry<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> graphArray <span class="token operator">=</span> <span class="token punctuation">[</span> entryModule <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 初始化图谱数组</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> graphArray<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">const</span> item <span class="token operator">=</span> graphArray<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> dependencies <span class="token punctuation">&#125;</span> <span class="token operator">=</span> item<span class="token punctuation">;</span> <span class="token comment">// 获取依赖文件</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>dependencies<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token comment">// 如果存在依赖，则循环依赖</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> j <span class="token keyword">in</span> dependencies<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token comment">// 对依赖文件进行分析，将分析结果存入到图谱数组中</span>
                graphArray<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>
                    <span class="token function">moduleAnalyser</span><span class="token punctuation">(</span>dependencies<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">// 依赖的对象文件 </span>
                <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 推入graphArray中后，长度变长，下一个进行遍历分析的文件</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token comment">// 关系图谱数据解构转化，将数组转化为对象</span>
    <span class="token keyword">const</span> graph <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
    graphArray<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        graph<span class="token punctuation">[</span>item<span class="token punctuation">.</span>filename<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
            <span class="token literal-property property">dependencies</span><span class="token operator">:</span> item<span class="token punctuation">.</span>dependencies<span class="token punctuation">,</span>
            <span class="token literal-property property">code</span><span class="token operator">:</span> item<span class="token punctuation">.</span>code
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> graph<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 最后的结果返回代码字符串</span>
<span class="token keyword">const</span> <span class="token function-variable function">generateCode</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">entry</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// 转化成字符串传入到闭包中</span>
    <span class="token keyword">const</span> graph <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token function">makeDependenciedGraph</span><span class="token punctuation">(</span>entry<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 代码在闭包中执行避免污染外部环境</span>
    <span class="token comment">// require无法在浏览器中直接运行，需要进行创建require方法</span>
    <span class="token comment">// export存储导出的内容 会转存到exports对象中</span>
    <span class="token comment">// 返回一个字符串</span>
    <span class="token comment">// localRequire转换文件的相对路径返回真实路径</span>
    <span class="token comment">// 递归调用到最内层的依赖文件，然后通过exports导出</span>
    <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
        (function(graph) &#123;
            function require(module) &#123;
                function localRequire(relativePath) &#123;
                    return require(graph[module].dependencies[relativePath]);
                &#125;
                var exports = &#123;&#125;;
                (function(require, exports, code) &#123;
                    eval(code);
                &#125;)(localRequire, exports, graph[module].code);
                return exports;
            &#125;;
            require('</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>entry<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">');
        &#125;)(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>graph<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">);
    </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">const</span> code <span class="token operator">=</span> <span class="token function">generateCode</span><span class="token punctuation">(</span><span class="token string">'./src/index.js'</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span>

<span class="token comment">// 注意：示例文件中本来是有注释的，但是注释加上去了之后就会出现问题，所以删除注释后在chrome://test模式下运行成功</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h4 id="webpack-管理多个项目"><a href="#webpack-管理多个项目" class="headerlink" title="webpack 管理多个项目"></a>webpack 管理多个项目</h4><p>实现多个项目共用 node_modules 和 package.json</p>
<blockquote>
<p>差异性不大的多个项目是否可以共用一个 <code>node_modules</code> ，使用公共组件部分、公共插件（抽npm）</p>
</blockquote>
<h5 id="方案"><a href="#方案" class="headerlink" title="方案"></a>方案</h5><h6 id="方案一"><a href="#方案一" class="headerlink" title="方案一"></a>方案一</h6><p>每个项目中独立配置项目差异 <code>config</code> 文件，相同配置使用根目录的 <code>webpack.base.config.js</code></p>
<p>实现：</p>
<ul>
<li>./webpack.base.config.js、</li>
<li>projectA/webpack.config.js、</li>
<li>projectB/webpack.config.js</li>
<li>根目录下的 <code>package.json</code> 的 <code>scripts</code> 命令：<code>npx webpack --config ./projectA/webpack.config.js &amp;&amp; npx webpack --config ./projectB/webpack.config.js</code>  </li>
</ul>
<h6 id="方案二"><a href="#方案二" class="headerlink" title="方案二"></a>方案二</h6><p>使用根目录统一的 config 文件进行做差异化处理</p>
<p>实现：</p>
<ul>
<li>./webpack.config.js</li>
<li>根目录下的 <code>package.json</code> 的 <code>scripts</code> 命令：<code>npx webpack --env PROJECT=projectA &amp;&amp; npx webpack --env PROJECT=projectB</code>  </li>
</ul>
<h6 id="注意点"><a href="#注意点" class="headerlink" title="注意点"></a>注意点</h6><p>两种方案都使用了 <a href="https://github.com/survivejs/webpack-merge">webpack-merge</a> 合并配置。</p>
<p>配置的主要问题是获取到具体项目的路径、以及定义配置的上下文环境 <code>context</code> 和 <code>node_modules</code> 路径解析 <code>resolve.modules</code>。</p>
<h4 id="Demo项目地址"><a href="#Demo项目地址" class="headerlink" title="Demo项目地址"></a>Demo项目地址</h4><p>study webpack: <a href="https://github.com/Datura35422/study/tree/master/webpack-demos">https://github.com/Datura35422/study/tree/master/webpack-demos</a></p>
<p>pug demo: <a href="https://github.com/Datura35422/pug-demo/tree/master/website">https://github.com/Datura35422/pug-demo/tree/master/website</a></p>
<h4 id="博文收集"><a href="#博文收集" class="headerlink" title="博文收集"></a>博文收集</h4><p><a href="https://github.com/sisterAn/blog/issues/69">窥探原理：手写一个 JavaScript 打包器 #69</a></p>
]]></content>
      <categories>
        <category>前端</category>
        <category>webpack</category>
      </categories>
      <tags>
        <tag>前端</tag>
        <tag>webpack</tag>
      </tags>
  </entry>
  <entry>
    <title>浏览器输入网址到渲染出页面流程</title>
    <url>/posts/23308/</url>
    <content><![CDATA[<h3 id="浏览器输入网址到渲染出页面流程"><a href="#浏览器输入网址到渲染出页面流程" class="headerlink" title="浏览器输入网址到渲染出页面流程"></a>浏览器输入网址到渲染出页面流程</h3><blockquote>
<p>详细阅读：github - <a href="https://github.com/skyline75489/what-happens-when-zh_CN">当你在浏览器中输入 google.com 并且按下回车之后发生了什么？</a></p>
</blockquote>
<ol>
<li><p>输入网址</p>
</li>
<li><p>浏览器进行地址解析，将解析出的域名进行 <code>DNS</code> 解析</p>
<p><strong><code>url</code>解析</strong>：网络标准规定了URL只能是字母和数字，还有一些其它特殊符号（-_.~ ! * ‘ ( ) ; : @ &amp; = + $ , / ? # [ ]，但是有部分特殊字符需要进行编码否则会出现歧义。使用<code>encodeURI(...)</code>和<code>encodeURIComponent(...)</code>进行编码。使用<code>decodeURI(...)</code>和<code>decodeURIComponent(...)</code>进行解码。规则采用<code>UTF-8</code>。</p>
<blockquote>
<p>请注意，<code>encodeURI</code> 自身<em>无法</em>产生能适用于HTTP GET 或 POST 请求的URI，例如对于 XMLHTTPRequests, 因为 “&amp;”, “+”, 和 “=” 不会被编码，然而在 GET 和 POST 请求中它们是特殊字符。然而<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/encodeURIComponent"><code>encodeURIComponent</code></a>这个方法会对这些字符编码。</p>
</blockquote>
<p><strong><code>DNS</code>解析</strong>: 先查看浏览器 <code>DNS</code> 缓存中是否有域名对应的 <code>IP</code> ，如果没有，则看操作系统 <code>DNS</code> 缓存中是否有对应的 <code>IP</code> (例如Windows的hosts文件)，依旧没有就对<strong>本地区</strong>的 <code>DNS</code> 服务器发起请求，如果还是没有，就直接到 <code>Root Server</code>域名服务器请求解析。（非转发模式）</p>
<p>一般使用 <code>UDP</code> 协议向 <code>DNS</code> 服务器进行寻址。</p>
<blockquote>
<p>DNS查询有两种模式，转发模式和非转发模式。转发模式，第一台DNS服务器查找不到，会转发到其他DNS服务器上查找，如果其他DNS服务器上也没有就会到根服务器查找。</p>
</blockquote>
<p><strong>前端DNS优化</strong>：可以在html页面头部写入dns缓存地址</p>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>x-dns-prefetch-control<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>on<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>dns-prefetch<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://bdimg.share.baidu.com<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li>
<li><p>通过 <code>IP</code> 寻址和 <code>ARP</code> ，找到目标服务器地址。</p>
<p>获取到 <code>IP</code> 后，直接通过 <code>IP</code> 寻址找到 <code>IP</code> 对应的服务器，然后通过 <code>ARP</code> 协议找到服务器的 <code>MAC</code> 地址。</p>
</li>
<li><p>进行 <code>TCP</code> 三次握手，建立 <code>TCP</code> 连接。</p>
<ul>
<li>第一次握手：主机A发送位码为SYN＝1的TCP包给服务器，并且随机产生一个作为确认号（这是tcp包的一部分），主机B收到SYN码后直到A要求建立连接;</li>
<li>第二次握手：主机B收到请求后，向A发送确认号（主机A的seq+1），syn=1，seq = 随机数 的TCP包；</li>
<li>主机A收到后检查确认号是否正确，即第一次A发送的确认号是否+1了，以及位码ack是否为1，若正确，主机A会再发送确认号(主机B的seq+1)，ack=1，主机B收到后确认seq值与ack=1则连接建立成功。</li>
</ul>
<p><img src="/./%E4%B8%89%E6%AC%A1%E6%8F%A1%E6%89%8B.jpg" alt="三次握手"></p>
</li>
<li><p>浏览器发送数据请求，等待服务器响应。</p>
<p>根据数据请求判断是否使用<a href="https://datura35422.github.io/posts/19611">浏览器缓存</a>。</p>
<p>如果使用浏览器强缓存，则不会对服务器进行请求，直接响应数据请求，返回浏览器缓存数据。</p>
<p>如果是协商缓存机制，会向服务器进行询问缓存使用结果，注意启发式缓存。</p>
<p>如果不使用缓存，则会向服务器请求数据。</p>
</li>
<li><p>服务器处理请求，并对请求做出响应。</p>
</li>
<li><p>浏览器收到服务器响应，得到网页代码。</p>
</li>
<li><p>渲染页面</p>
<p>HTML解析：HTML词法分析和语法分析</p>
<p>外部样式、脚本加载（async / defer）</p>
<ul>
<li><p><strong>构建DOM树</strong>(DOM tree)：从上到下解析HTML文档生成DOM节点树（DOM tree），也叫内容树（content tree）；</p>
<p><strong>JS会阻塞DOM树的解析，但是CSS不会阻塞DOM树的解析</strong>。所以如果不得不将JS文件放在头部，可以将JS文件放在CSS文件引入之上。且JS文件中最好不要有修改样式的操作，不然会和预期结果不一致，同时也无法进行DOM操作。</p>
</li>
<li><p><strong>构建CSSOM</strong>(CSS Object Model)树：加载解析样式生成CSSOM树；</p>
</li>
<li><p><strong>构建渲染树</strong>(render tree)：根据DOM树和CSSOM树,生成渲染树(render tree)；</p>
<p>渲染树：按顺序展示在屏幕上的一系列矩形，这些矩形带有字体，颜色和尺寸等视觉属性。</p>
<ul>
<li>浏览器从DOM树的根节点开始遍历每个可见节点。</li>
<li>对于每个可见节点，找到CSSOM树中对应的规则，并应用它们。</li>
<li>根据每个可见节点以及其对应的样式组合生成渲染树。</li>
</ul>
</li>
<li><p><strong>布局</strong>（layout）：根据渲染树将节点树的每一个节点布局在屏幕上的正确位置；</p>
</li>
<li><p><strong>绘制</strong>（painting）：遍历渲染树绘制所有节点，为每一个节点适用对应的样式，这一过程是通过UI后端模块完成；</p>
</li>
<li><p><strong>执行JavaScript</strong>：加载并执行JavaScript代码（包括内联代码或外联JavaScript文件）；</p>
</li>
<li><p><strong>回流</strong>（Reflow / 重排）：当<code>Render Tree</code>中部分或全部元素的尺寸、结构、或某些属性发生改变时，浏览器重新渲染部分或全部文档的过程称为回流。</p>
<p>回流操作：页面首次渲染、浏览器窗口大小发生改变、元素尺寸或位置发生改变、元素内容变化、元素字体大小变化、添加或删除可见的DOM元素等</p>
<p><strong>回流必将引起重绘，重绘不一定会引起回流。回流比重绘代价要更高</strong></p>
<blockquote>
<p>获取 <code>document.body.offsetHeight</code> 等一些数据会引起浏览器重绘。</p>
<p>参考资料：中文翻译：<a href="https://jinlong.github.io/2015/09/30/what-forces-layout-reflow/">是什么导致重排</a>，<a href="https://gist.github.com/paulirish/5d52fb081b3570c81e3a">英语原文</a></p>
</blockquote>
</li>
<li><p><strong>重绘</strong>（Repaint）：当页面中元素样式的改变并不影响它在文档流中的位置时（例如：<code>color</code>、<code>background-color</code>、<code>visibility</code>等），浏览器会将新样式赋予给元素并重新绘制它，这个过程称为重绘。</p>
<blockquote>
<p>更多资料：<a href="https://datura35422.github.io/posts/7090">基础系列-重绘与回流</a></p>
</blockquote>
</li>
</ul>
<blockquote>
<p>HTML词法分析和语法分析，CSS解析， 合成图层、合成线程调用光栅化线程池，生成位图后浏览器进程间通信过程，显卡缓存与显示器的关系</p>
</blockquote>
</li>
</ol>
<p><img src="/./html%E6%B8%B2%E6%9F%93%E6%B5%81%E7%A8%8B.jpg" alt="html渲染流程"></p>
<ol start="9">
<li><p>浏览器断开连接，四次挥手。</p>
<blockquote>
<p>一个http请求-响应，就会触发一次三次握手，四次挥手。</p>
<p>http 1.1 有相关长连接（keep-alive）设置。一个长连接会保持一段时间，重复用于发送一系列请求，节省了新建 TCP 连接握手的时间，还可以利用 TCP 的性能增强能力。当然这个连接也不会一直保留着：连接在空闲一段时间后会被关闭(服务器可以使用 <a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Keep-Alive"><code>Keep-Alive</code></a> 协议头来指定一个最小的连接保持时间)。</p>
<p>更多阅读：<a href="https://datura35422.github.io/posts/18836">计算机网络-HTTP系列</a></p>
</blockquote>
</li>
</ol>
<p>​        <img src="/./%E5%9B%9B%E6%AC%A1%E6%8C%A5%E6%89%8B.jpg" alt="四次挥手"></p>
<h4 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h4><p><a href="https://mp.weixin.qq.com/s/n59oQae3Cm8_kfHb4fNIFw">阿里面试官问“说一下从 url 输入到返回请求的过程”的难度就是不一样！</a></p>
<p><a href="https://blog.csdn.net/qzcsu/article/details/72861891">两张动图-彻底明白TCP的三次握手与四次挥手</a></p>
<p><a href="https://github.com/ljianshu/Blog/issues/24">从URL输入到页面展现到底发生什么</a></p>
<p><a href="https://juejin.cn/post/6844903497599549453">原来 CSS 与 JS 是这样阻塞 DOM 解析和渲染的</a></p>
<p>推荐：<a href="https://yuanrengu.com/2020/77eef79f.html">面试官，不要再问我三次握手和四次挥手</a></p>
<p>推荐：<a href="https://juejin.cn/post/6844903569087266823">浏览器的回流与重绘 (Reflow &amp; Repaint) – 掘金</a></p>
]]></content>
      <categories>
        <category>计算机网络</category>
      </categories>
      <tags>
        <tag>面试</tag>
        <tag>计算机网络</tag>
        <tag>浏览器</tag>
      </tags>
  </entry>
  <entry>
    <title>webpack系列-入门</title>
    <url>/posts/24630/</url>
    <content><![CDATA[<h3 id="webpack是什么"><a href="#webpack是什么" class="headerlink" title="webpack是什么"></a>webpack是什么</h3><p><strong>静态资源模块打包工具</strong></p>
<p>当 webpack 处理应用程序时，它会在内部构建一个依赖图(dependency graph)，此依赖图对应映射到项目所需的每个模块，并生成一个或多个包(bundle)。</p>
<blockquote>
<p>webpack打包是前端工程化必不可少的环节，可以基于webpack 解决前端一系列问题，逐渐形成一套前端工程化解决方案。</p>
</blockquote>
<h4 id="webpack解决了什么"><a href="#webpack解决了什么" class="headerlink" title="webpack解决了什么"></a>webpack解决了什么</h4><p>webpack 是从入口文件开始， 经过模块依赖加载、 分析和打包三个流程完成项目的构建。 在加载、 分析和打包的三个过程中， 可以针对性的做一些解决方案 。</p>
<ul>
<li>模块化打包， 一切皆模块， JS 是模块， CSS 等也是模块；</li>
<li>语法糖转换： 比如 ES6 转 ES5、 TypeScript；</li>
<li>预处理器编译： 比如 Less、 Sass 等；</li>
<li>项目优化： 比如压缩、 CDN、代码分割；</li>
<li>解决方案封装： 通过强大的 Loader 和插件机制， 可以完成解决方案的封装， 比如 PWA；  </li>
<li>流程对接： 比如测试流程、 语法检测等  </li>
</ul>
<h3 id="基础概念"><a href="#基础概念" class="headerlink" title="基础概念"></a>基础概念</h3><ul>
<li><p><strong>工程化</strong>：将工程方法系统化地应用到软件开发中。</p>
<blockquote>
<p>工程指的是以系统、严谨、可量化的方法开发、运营、维护软件。</p>
<p>工程化的理解可以是类似于盖房子，需要经过一系列的图纸设计、购买原材料、挖地基、搭建房子，一步一步来建造房子。</p>
<p><strong>前端工程</strong>可以定义为，将工程方法系统化地应用到前端开发中，以系统、严谨、可量化的方法开发、运营、维护前端应用程序。</p>
<p>参考链接：<a href="https://segmentfault.com/a/1190000023943703">「前端工程化」该怎么理解？</a></p>
</blockquote>
</li>
<li><p><a href="https://datura35422.github.io/2021/03/05/%E5%9F%BA%E7%A1%80%E7%B3%BB%E5%88%97-%E6%A8%A1%E5%9D%97%E5%8C%96/"><strong>模块化</strong></a>：模块化是指解决一个复杂问题时自顶向下逐层把系统划分成若干模块的过程，有多种属性，分别反映其内部特性。</p>
</li>
<li><p><strong>Bundle</strong>：分发代码是指在构建过程中，经过最小化和优化后产生的输出结果，最终将在浏览器中加载。最终打包完成的文件，一般与 chunk 是一一对应的关系，bundle 就是对chunk 进行压缩打包等处理后的结果。</p>
</li>
<li><p><strong>Chunk</strong>：每一个被打包后的文件都是一个<code>chunk</code>。</p>
</li>
<li><p><strong>Loader</strong>： 编译时对模块进行预处理，进行转化解析编译等处理。处理非JavaScript模块，例如将less解析为css。</p>
</li>
<li><p><strong>Plugin</strong>：在打包过程中的某个具体时刻进行处理。直接作用于webpack，扩展webpack能力，改变输出结果，例如打包优化和压缩。</p>
</li>
</ul>
<h3 id="创建项目"><a href="#创建项目" class="headerlink" title="创建项目"></a>创建项目</h3><p>初始化项目目录<code>npm init</code>，会自动生成package.json文件，就可以使用npm scripts定义命令，对项目进行管理。</p>
<p><strong>package.json</strong></p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>
  <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"webpacktemplate"</span><span class="token punctuation">,</span>
  <span class="token property">"version"</span><span class="token operator">:</span> <span class="token string">"1.0.0"</span><span class="token punctuation">,</span>
  <span class="token property">"description"</span><span class="token operator">:</span> <span class="token string">"My template + pug"</span><span class="token punctuation">,</span>
  <span class="token property">"main"</span><span class="token operator">:</span> <span class="token string">"index.js"</span><span class="token punctuation">,</span>
  <span class="token property">"private"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token property">"scripts"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token property">"dev"</span><span class="token operator">:</span> <span class="token string">"webpack-dev-server --open --config ./build/webpack.dev.conf.js"</span><span class="token punctuation">,</span>
    <span class="token property">"build"</span><span class="token operator">:</span> <span class="token string">"webpack --config ./build/webpack.build.conf.js"</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token property">"browserslist"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">"> 1%"</span><span class="token punctuation">,</span>
    <span class="token string">"last 3 version"</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">"keywords"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">"webpack4"</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">"license"</span><span class="token operator">:</span> <span class="token string">"MIT"</span><span class="token punctuation">,</span>
  <span class="token property">"devDependencies"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token property">"dependencies"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">mkdir</span> webpack-demo <span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">cd</span> webpack-demo
<span class="token function">npm</span> init <span class="token parameter variable">-y</span>
<span class="token function">npm</span> <span class="token function">install</span> webpack webpack-cli --save-dev<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>webpack-cli会默认安装webpack</p>
<p>webpack-cli使得可以在命令行中运行webpack命令</p>
<p>如果npm scripts中没有指明webpack配置文件，则webpack-cli会默认加载webpack.config.js文件</p>
</blockquote>
<h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><p>创建一个配置文件<code>webpack.config.js</code></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    <span class="token literal-property property">entry</span><span class="token operator">:</span> <span class="token string">'./src/index.js'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">'bundle.js'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">path</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'dist'</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token comment">// 或</span>
module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">env</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// 处理 webpack-cli 传参</span>
    <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>
        <span class="token literal-property property">entry</span><span class="token operator">:</span> <span class="token string">'./src/index.js'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
            <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">'bundle.js'</span><span class="token punctuation">,</span>
            <span class="token literal-property property">path</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'dist'</span><span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p><code>webpack</code> 最出色的功能之一就是，除了 JavaScript，还可以通过 loader <em>引入任何其他类型的文件</em>。</p>
<p>webpack运行在node环境下，遵循node的CommonJS模块化规则使用require，最后导出的是对象或函数返回的对象</p>
</blockquote>
<h4 id="Entry与Output"><a href="#Entry与Output" class="headerlink" title="Entry与Output"></a><a href="https://webpack.docschina.org/configuration/entry-context/">Entry与Output</a></h4><p>context 上下文：基础目录，绝对路径，用于从配置中解析入口点 和 加载器</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  <span class="token comment">//...</span>
  <span class="token literal-property property">context</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'app'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>默认使用当前目录process.cwd()</p>
</blockquote>
<p>单个文件输入输出</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  <span class="token literal-property property">entry</span><span class="token operator">:</span> <span class="token string">'./src/index.js'</span><span class="token punctuation">,</span> <span class="token comment">// 写法一</span>
  <span class="token comment">// entry: &#123; // 写法二</span>
  <span class="token comment">//  main: './src/index.js', </span>
  <span class="token comment">// &#125;,</span>
  <span class="token operator">...</span>
  <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">'bundle.js'</span><span class="token punctuation">,</span> <span class="token comment">// 入口文件命名规则 默认命名文件为main.js</span>
    <span class="token literal-property property">chunkFilename</span><span class="token operator">:</span> <span class="token string">'[name].chunk.js'</span><span class="token punctuation">,</span> <span class="token comment">// 文件内部异步加载的文件命名规则</span>
    <span class="token literal-property property">path</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'dist'</span><span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>多个文件输入输出，不能多个文件输入一个文件输出</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  <span class="token literal-property property">entry</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token literal-property property">app</span><span class="token operator">:</span> <span class="token string">'./src/index.js'</span><span class="token punctuation">,</span> 
    <span class="token literal-property property">main</span><span class="token operator">:</span> <span class="token string">'./src/main.js'</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">'[name].bundle.js'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">path</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'dist'</span><span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>HtmlWebpackPlugin会自动将两个打包后的js文件添加到index.html文件中。</p>
<p>webpack 默认入口文件是 src/index.js，默认输出目录是 dist/main.js</p>
</blockquote>
<p>特殊输出内容需要进行更复杂的 <a href="https://webpack.docschina.org/configuration/output/">output</a> 配置。</p>
<blockquote>
<p>与输出内容相关配置有target、externals、devtool</p>
</blockquote>
<h4 id="解析resolve"><a href="#解析resolve" class="headerlink" title="解析resolve"></a>解析<a href="https://webpack.docschina.org/configuration/resolve/">resolve</a></h4><p>概念：<a href="https://webpack.docschina.org/concepts/module-resolution/">https://webpack.docschina.org/concepts/module-resolution/</a></p>
<p>设置如何找到依赖模块和模块如何被解析。resolver 是一个帮助寻找模块绝对路径的库。 一个模块可以作为另一个模块的依赖模块，然后被后者引用，如下：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> foo <span class="token keyword">from</span> <span class="token string">'path/to/module'</span><span class="token punctuation">;</span>
<span class="token comment">// 或者</span>
<span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path/to/module'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>所依赖的模块可以是来自应用程序的代码或第三方库。 resolver 帮助 webpack 从每个 <code>require</code>/<code>import</code> 语句中，找到需要引入到 bundle 中的模块代码。 当打包模块时，webpack 使用 <a href="https://github.com/webpack/enhanced-resolve">enhanced-resolve</a> 来解析文件路径（绝对路径、相对路径、模块路径）。</p>
<h5 id="配置别名-resolve-alias"><a href="#配置别名-resolve-alias" class="headerlink" title="配置别名 resolve.alias"></a>配置别名 resolve.alias</h5><p>创建 <code>import</code> 或 <code>require</code> 的别名，来确保模块引入变得更简单。例如，一些位于 <code>src/</code> 文件夹下的常用模块：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  <span class="token comment">//...</span>
  <span class="token literal-property property">resolve</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token literal-property property">alias</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
      <span class="token literal-property property">Utilities</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'src/utilities/'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token literal-property property">Templates</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'src/templates/'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<ol>
<li><p>alias 的名字可以使用 @ ! ~ 等这些特殊字符， 实际使用中 alias 都使用一种， 或者不同类型使用一种， 这样可以跟正常的模块引入区分开， 增加辨识度；</p>
</li>
<li><p>使用 @ 注意不要跟 npm 包的scope冲突！</p>
</li>
<li><p>这时在 vscode 中会导致我们检测不到 utils 中的内容， 不能帮我们快速编写代码， 可以通过在项目根目录创建 jsconfig.json 来帮助我们定位：  </p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">//jsconfig.json</span>
<span class="token punctuation">&#123;</span>
    <span class="token string-property property">"compilerOptions"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        <span class="token string-property property">"baseUrl"</span><span class="token operator">:</span> <span class="token string">"./src"</span><span class="token punctuation">,</span>
            <span class="token string-property property">"paths"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
                <span class="token string-property property">"@lib/"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"src/lib"</span><span class="token punctuation">]</span>
            <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ol>
</blockquote>
<h5 id="resolve-mainFields"><a href="#resolve-mainFields" class="headerlink" title="resolve.mainFields"></a>resolve.mainFields</h5><p>有一些我们用到的模块会针对不同宿主环境提供几份代码， 例如提供 ES5 和 ES6 的两份代码， 或者提供浏览器环境和 nodejs 环境两份代码， 这时候在 package.json 文件里会做如下配置：  </p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token punctuation">&#123;</span>
    <span class="token string-property property">"jsnext:main"</span><span class="token operator">:</span> <span class="token string">"es/index.js"</span><span class="token punctuation">,</span> <span class="token comment">//采用ES6语法的代码入口文件</span>
    <span class="token string-property property">"main"</span><span class="token operator">:</span> <span class="token string">"lib/index.js"</span><span class="token punctuation">,</span> <span class="token comment">//采用ES5语法的代码入口文件， node</span>
    <span class="token string-property property">"browser"</span><span class="token operator">:</span> <span class="token string">"lib/web.js"</span> <span class="token comment">//这个是专门给浏览器用的版本</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>在 Webpack 中， 会根据 resolve.mainFields 的设置去决定使用哪个版本的模块代码， 在不同的 target 下对应的 resolve.mainFields 默认值不同， 默认 target=web 对应的默认值为：  </p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    <span class="token literal-property property">resolve</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        <span class="token literal-property property">mainFields</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'browser'</span><span class="token punctuation">,</span> <span class="token string">'module'</span><span class="token punctuation">,</span> <span class="token string">'main'</span><span class="token punctuation">]</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>所以在 target=web 打包时， 会寻找 browser 版本的模块代码。  </p>
<h5 id="其他配置"><a href="#其他配置" class="headerlink" title="其他配置"></a>其他配置</h5><ul>
<li><code>resolve.mainFiles</code> ： 解析目录时候的默认文件名， 默认是 index ， 即查找目录下面的 index + resolve.extensions 文件；</li>
<li><code>resolve.modules</code> ： 查找模块依赖时， 默认是 node_modules ；</li>
<li><code>resolve.symlinks</code> ： 是否解析符合链接（软连接， symlink） ；</li>
<li><code>resolve.plugins</code> ： 添加解析插件， 数组格式；</li>
<li><code>resolve.cachePredicate</code> ： 是否缓存， 支持 boolean 和 function， function 传入一个带有 path 和 require 的对象， 必须返回 boolean 值。  </li>
</ul>
<h4 id="模块module"><a href="#模块module" class="headerlink" title="模块module"></a>模块<a href="https://webpack.docschina.org/configuration/module/">module</a></h4><p>概念：<a href="https://webpack.docschina.org/concepts/modules/">https://webpack.docschina.org/concepts/modules/</a></p>
<p>在<a href="https://en.wikipedia.org/wiki/Modular_programming">模块化编程</a>中，开发者将程序分解为功能离散的 <code>chunk</code>，并称之为 <strong>模块</strong>。</p>
<p>在 webpack 解析模块时，不同的模块可以根据配置来进行特殊处理。</p>
<p>常用配置：</p>
<h5 id="module-noParse"><a href="#module-noParse" class="headerlink" title="module.noParse"></a>module.noParse</h5><p>可以让 webpack 忽略对部分没有采用模块化的文件的递归解析和处理，能够提高构建性能。</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    <span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// 使用正则表达式</span>
        <span class="token literal-property property">noParse</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">jquery|lodash</span><span class="token regex-delimiter">/</span></span>
        <span class="token comment">// 使用函数， 从 Webpack 3.0.0 开始支持</span>
        <span class="token function-variable function">noParse</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">content</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
            <span class="token comment">// content 代表一个模块的文件路径</span>
            <span class="token comment">// 返回 true or false</span>
            <span class="token keyword">return</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">jquery|lodash</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
	<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>这里一定要确定被排除出去的模块代码中不能包含 import 、 require 、 define 等内容， 以保证 webpack 的打包包含了所有的模块， 不然会导致打包出来的 js 因为缺少模块而报错  </p>
</blockquote>
<h5 id="module-rules"><a href="#module-rules" class="headerlink" title="module.rules"></a>module.rules</h5><p>在处理模块时，将符合规则条件的模块，提交给对应的处理器来处理，通常来配置loader。</p>
<h4 id="Loader"><a href="#Loader" class="headerlink" title="Loader"></a>Loader</h4><p>文件预处理需要安装配置相应的 loader 进行编译的时候处理。</p>
<p>loader 使得 webpack 具有处理多种文件格式的能力，将多种文件格式转化处理成 webpack 能够进行打包的模块。</p>
<p><code>loader</code>配置执行顺序，从下到上，从右到左。</p>
<h5 id="加载CSS、图片、字体、数据"><a href="#加载CSS、图片、字体、数据" class="headerlink" title="加载CSS、图片、字体、数据"></a>加载CSS、图片、字体、数据</h5><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> --save-dev style-loader css-loader <span class="token comment"># css</span>
<span class="token function">npm</span> <span class="token function">install</span> --save-dev file-loader <span class="token comment"># 图片/字体</span>
<span class="token function">npm</span> <span class="token function">install</span> --save-dev csv-loader xml-loader <span class="token comment"># 数据</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p><code>webpack.config.js</code></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  <span class="token literal-property property">entry</span><span class="token operator">:</span> <span class="token string">'./src/index.js'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">'bundle.js'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">path</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'dist'</span><span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
      <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token comment">// css预处理，css-loader将css处理后，style-loader将css代码插入到html文件中</span>
          <span class="token comment">// less-loader/sass-loader将相应的less/sass代码翻译成css代码</span>
          <span class="token comment">// postcss-loader自动加载浏览器厂商前缀，配合postcss.config.js使用，安装autoprefixer插件</span>
          <span class="token comment">// options:&#123; importLoaders: 2 &#125; 表示文件内引用的子文件也要走最开始的两个loader，否则容易忽略最开始的loader处理</span>
          <span class="token punctuation">&#123;</span>
              <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.css$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
              <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                  <span class="token string">'style-loader'</span><span class="token punctuation">,</span>
                  <span class="token punctuation">&#123;</span>
                      <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">'css-loader'</span><span class="token punctuation">,</span>
                      <span class="token literal-property property">modules</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token comment">// css模块化，避免样式冲突，使用方式如styleModule.className</span>
                  <span class="token punctuation">&#125;</span>
              <span class="token punctuation">]</span>
          <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
          <span class="token comment">// 图片预处理</span>
          <span class="token comment">// image-webpack-loader可以进行图片压缩</span>
          <span class="token punctuation">&#123;</span>
              <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.(png|svg|jpg|gif)$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
              <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                  <span class="token string">'file-loader'</span> <span class="token comment">// 将项目下的文件复制到打包目录下</span>
              <span class="token punctuation">]</span>
          <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
          <span class="token comment">// 图片预处理可以使用url-loader，url-loader包含file-loader功能且能够将小图片进行转换成base64</span>
          <span class="token punctuation">&#123;</span>
              <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.(jpg|png|gif)$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
              <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
                  <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">'url-loader'</span><span class="token punctuation">,</span>
                  <span class="token literal-property property">options</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
                      <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'[name]_[hash].[ext]'</span><span class="token punctuation">,</span>
                      <span class="token literal-property property">outputPath</span><span class="token operator">:</span> <span class="token string">'images/'</span><span class="token punctuation">,</span>
                      <span class="token literal-property property">limit</span><span class="token operator">:</span> <span class="token number">204800</span>
                  <span class="token punctuation">&#125;</span>
              <span class="token punctuation">&#125;</span>
          <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
          <span class="token comment">// 字体预处理</span>
          <span class="token punctuation">&#123;</span>
              <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.(woff|woff2|eot|ttf|otf)$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
              <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                  <span class="token string">'file-loader'</span>
              <span class="token punctuation">]</span>
          <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
          <span class="token comment">// 数据预处理</span>
          <span class="token punctuation">&#123;</span>
              <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.(csv|tsv)$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
              <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                  <span class="token string">'csv-loader'</span>
              <span class="token punctuation">]</span>
          <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
          <span class="token punctuation">&#123;</span>
              <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.xml$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
              <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                  <span class="token string">'xml-loader'</span>
              <span class="token punctuation">]</span>
          <span class="token punctuation">&#125;</span>
      <span class="token punctuation">]</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p><em>在使用</em> <a href="https://github.com/d3">d3</a> <em>等工具来实现某些数据可视化时，预加载数据会非常有用。我们可以不用再发送 <code>ajax</code> 请求，然后于运行时解析数据，而是在构建过程中将其提前载入并打包到模块中，以便浏览器加载模块后，可以立即从模块中解析数据。</em></p>
</blockquote>
<h4 id="Plugin"><a href="#Plugin" class="headerlink" title="Plugin"></a>Plugin</h4><p>webpack 有丰富的插件接口，许多webpack不具有的功能可以使用插件进行实现，这样使得webpack具有更大的灵活性。</p>
<p>安装</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> --save-dev html-webpack-plugin <span class="token comment"># HtmlWebpackPlugin</span>
<span class="token function">npm</span> <span class="token function">install</span> --save-dev clean-webpack-plugin <span class="token comment"># clean-webpack-plugin</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<blockquote>
<p><a href="https://github.com/jantimon/html-webpack-plugin"><code>HtmlWebpackPlugin</code></a>简化了HTML文件的创建，以便为你的webpack包提供服务。会在打包结束后，自动生成一个html文件，并把打包生成的js自动引入到这个html文件中。</p>
</blockquote>
<p><code>webpack.config.js</code></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> HtmlWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'html-webpack-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">&#123;</span> CleanWebpackPlugin <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'clean-webpack-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  <span class="token literal-property property">entry</span><span class="token operator">:</span> <span class="token string">'./src/index.js'</span><span class="token punctuation">,</span> 
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token comment">// 对每个html进行处理</span>
        <span class="token literal-property property">template</span><span class="token operator">:</span> <span class="token string">'index.js'</span><span class="token punctuation">,</span> <span class="token comment">// 模板文件</span>
        <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">'xxx'</span> <span class="token comment">// 设置页面title</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">CleanWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 清空输出文件夹</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">'bundle.js'</span><span class="token punctuation">,</span> 
    <span class="token literal-property property">path</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'dist'</span><span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h4 id="DevTool"><a href="#DevTool" class="headerlink" title="DevTool"></a>DevTool</h4><blockquote>
<p>选择一种 <a href="http://blog.teamtreehouse.com/introduction-source-maps">source map</a> 格式来增强调试过程。不同的值会明显影响到构建(build)和重新构建(rebuild)的速度。</p>
</blockquote>
<p>sourceMap关系映射，设置后在相对应模式中可以查找到报错位置。</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">module<span class="token punctuation">.</span>export <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    <span class="token literal-property property">devtool</span><span class="token operator">:</span> <span class="token string">'none'</span> <span class="token operator">|</span> <span class="token string">'source-map'</span> <span class="token operator">|</span> <span class="token operator">...</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>建议：development环境打包使用cheap-module-eval-source-map模式，production环境打包如果出错需要查看问题所在，使用cheap-module-source-map模式。</p>
</blockquote>
<h4 id="自动编译"><a href="#自动编译" class="headerlink" title="自动编译"></a>自动编译</h4><p>代码发生变化后自动编译代码，仅在开发阶段。</p>
<ul>
<li><code>--watch</code>监听代码变化后进行重新编译。<code>webpack --watch</code>无法进行<code>ajax</code>请求。</li>
<li>构建<code>node</code>服务器进行编译发布。</li>
<li><code>webpack-dev-server</code>提供了一个简单的web服务器，并且能够实现重新加载。监听文件变化后重新打包后打开浏览器并刷新。将打包的内容暂存在内存中，提升打包效率。</li>
</ul>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> --save-dev webpack-dev-server<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><code>webpack.config.js</code></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  <span class="token literal-property property">entry</span><span class="token operator">:</span> <span class="token string">'./src/index.js'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">devtool</span><span class="token operator">:</span> <span class="token string">'inline-source-map'</span><span class="token punctuation">,</span> <span class="token comment">// 帮助编译时输出错误信息</span>
  <span class="token literal-property property">devServer</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token literal-property property">contentBase</span><span class="token operator">:</span> <span class="token string">'./dist'</span><span class="token punctuation">,</span> <span class="token comment">// 告诉webpack-dev-server查找文件的位置</span>
    <span class="token literal-property property">compress</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  	<span class="token literal-property property">port</span> <span class="token operator">:</span> <span class="token number">9000</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">'bundle.js'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">path</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'dist'</span><span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>在<code>npm</code>配置中添加脚本</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token property">"script"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    ...
    <span class="token property">"start"</span><span class="token operator">:</span> <span class="token string">"webpack-dev-server --open"</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>–open参数表示编译后自动打开浏览器</p>
</blockquote>
<h4 id="模块热替换-HMR"><a href="#模块热替换-HMR" class="headerlink" title="模块热替换(HMR)"></a>模块热替换(HMR)</h4><p>允许在运行时更新各种模块，而无需进行完全刷新。</p>
<p>模块热替换运行步骤：</p>
<ol>
<li>应用程序要求 HMR runtime 检查更新。</li>
<li>HMR runtime 异步地下载更新，然后通知应用程序。</li>
<li>应用程序要求 HMR runtime 应用更新。</li>
<li>HMR runtime 同步地应用更新。</li>
</ol>
<p><code>webpack.config.js</code></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  <span class="token literal-property property">entry</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token literal-property property">app</span><span class="token operator">:</span> <span class="token string">'./src/index.js'</span><span class="token punctuation">,</span> 
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">devtool</span><span class="token operator">:</span> <span class="token string">'inline-source-map'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">devServer</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token literal-property property">contentBase</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'dist'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token literal-property property">compress</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token literal-property property">port</span> <span class="token operator">:</span> <span class="token number">9000</span><span class="token punctuation">,</span>
    <span class="token literal-property property">hot</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 启用HotModuleReplacementPlugin功能</span>
    <span class="token literal-property property">hotOnly</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token comment">// 启用热更新模块，以防HMR失效时刷新页面</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>NamedModulesPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>HotModuleReplacementPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 热更新</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">'[name].bundle.js'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">path</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'dist'</span><span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><code>package.json</code></p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token property">"script"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token property">"hot"</span><span class="token operator">:</span> <span class="token string">"webpack-dev-server"</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>在模块中控制热更新，使用<code>module.hot</code>的<a href="https://webpack.docschina.org/api/hot-module-replacement/">HMR API</a></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">if</span> <span class="token punctuation">(</span>module<span class="token punctuation">.</span>hot<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    module<span class="token punctuation">.</span>hot<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token string">'./library.js'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// 对更新过的library模块做特殊处理</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>部分loader内置了上面的功能所以不用特意去写响应热更新的代码块（手动热更新），如css-loader、vue-loader</p>
</blockquote>
<h4 id="构建目标targets"><a href="#构建目标targets" class="headerlink" title="构建目标targets"></a>构建目标<a href="https://webpack.docschina.org/configuration/target/">targets</a></h4><p>概念：<a href="https://webpack.docschina.org/concepts/targets/">https://webpack.docschina.org/concepts/targets/</a></p>
<p>告知 webpack 为 目标（target）指定一个环境。默认值为”browserslist”，如果没有找到 browserslist 的配置，则默认为”web”。</p>
<h4 id="外部扩展externals"><a href="#外部扩展externals" class="headerlink" title="外部扩展externals"></a>外部扩展<a href="https://webpack.docschina.org/configuration/externals/">externals</a></h4><p><code>externals</code> 配置选项提供了「从输出的 bundle 中排除依赖」的方法。相反，所创建的 bundle 依赖于那些存在于用户环境(consumer’s environment)中的依赖。此功能通常对 <strong>library 开发人员</strong>来说是最有用的，然而也会有各种各样的应用程序用到它。</p>
<p>一般减少依赖包打包体积会使用到该项。</p>
<h3 id="ES6-转ES5（polyfill）"><a href="#ES6-转ES5（polyfill）" class="headerlink" title="ES6+转ES5（polyfill）"></a>ES6+转ES5（polyfill）</h3><p>使用<a href="https://babeljs.io/setup#installation">babel</a>进行转换。需要安装<code>babel-loader</code>和<code>@babel/core</code>(核心库，使babel能识别js代码内容转换成ast抽象语法树，再将语法树编译成目的语法)</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> --save-dev babel-loader @babel/core<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    <span class="token operator">...</span>
    <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">&#123;</span>
        <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.m?js$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> <span class="token comment">// 如果检测到js文件则使用babel-loader处理</span>
        <span class="token literal-property property">exclude</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">node_modules</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> <span class="token comment">// 除外</span>
        <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
          <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">"babel-loader"</span><span class="token punctuation">,</span> <span class="token comment">// webpack与babel做了打通 但是并没有处理js文件</span>
          <span class="token literal-property property">options</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
            <span class="token literal-property property">presets</span><span class="token operator">:</span> <span class="token punctuation">[</span>
              <span class="token punctuation">[</span>
                <span class="token comment">// 将ES6+代码转换为ES5, 如果使用预设环境配置需要安装@babel/preset-env和配置</span>
                <span class="token string">"@babel/preset-env"</span><span class="token punctuation">,</span>
              	<span class="token punctuation">&#123;</span>
                    <span class="token literal-property property">targets</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
                      <span class="token literal-property property">chrome</span><span class="token operator">:</span> <span class="token string">"67"</span> <span class="token comment">// 目标最低版本</span>
                    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
                	<span class="token literal-property property">useBuiltIns</span><span class="token operator">:</span> <span class="token string">"entry"</span> <span class="token comment">// usage -- 仅转译使用过的代码 按需引入polyfill</span>
              	<span class="token punctuation">&#125;</span>
              <span class="token punctuation">]</span>
            <span class="token punctuation">]</span>
          <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
      <span class="token punctuation">&#125;</span>
    <span class="token punctuation">]</span>
    <span class="token operator">...</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>@babel/preset-env预设环境，在babel处理的时候就根据目标的环境能支持的语法和功能进行代码转换，如IE&gt;9</p>
<p>浏览器或electron项目需要创建<a href="https://github.com/browserslist/browserslist">.browserslist</a> 文件进行配置或在package.json中配置preset属性</p>
<p>具体配置内容可查看<a href="https://babeljs.io/docs/en/babel-preset-env">@babel/preset-env</a> 文档</p>
</blockquote>
<p>使用<a href="https://babeljs.io/docs/en/babel-polyfill">@babel/polyfill</a>补充低版本浏览器不支持的语法。进行安装<code>npm install --save @babel/polyfill</code>。要配合@babel/preset-env和 <a href="https://babeljs.io/docs/en/babel-preset-env#usebuiltins"><code>useBuiltIns</code> option</a>配置使用，使用时在全局入口文件顶部导入<code>import &quot;@babel/polyfill&quot;;</code> 但如果使用<code>usage</code>模式可以不用手动引入。</p>
<p>如果库进行兼容编译则需要引入<code>@babel/plugin-transform-runtime</code>，需要polyfill则要设置<code>core-js@3</code>。<strong>避免全局污染</strong>。</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token punctuation">&#123;</span>
  <span class="token string-property property">"plugins"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">[</span>
      <span class="token string">"@babel/plugin-transform-runtime"</span><span class="token punctuation">,</span>
      <span class="token punctuation">&#123;</span>
        <span class="token string-property property">"absoluteRuntime"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        <span class="token string-property property">"corejs"</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
        <span class="token string-property property">"helpers"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token string-property property">"regenerator"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token string-property property">"version"</span><span class="token operator">:</span> <span class="token string">"7.0.0-beta.0"</span>
      <span class="token punctuation">&#125;</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>babel相关配置可以直接抽取到<code>.babelrc</code>配置文件中</strong>。</p>
<h3 id="执行"><a href="#执行" class="headerlink" title="执行"></a>执行</h3><h4 id="webpack-cli"><a href="#webpack-cli" class="headerlink" title="webpack-cli"></a><a href="https://webpack.docschina.org/api/cli/">webpack-cli</a></h4><p>命令行配置，CLI 中传入的任何参数会在配置文件中映射为对应的参数。在命令行中可以设置webpack配置中的属性值。</p>
<p>常用配置命令：</p>
<p><code>--config</code>： 指定一个 Webpack 配置文件的路径；</p>
<p><code>--mode</code>： 指定打包环境的 mode， 取值为 development 和 production ， 分别对应着开发环境和生产环境；</p>
<p><code>--json</code>： 输mode出 Webpack 打包的结果， 可以使用 webpack –json &gt; stats.json 方式将打包结果输出到指定的文件；</p>
<p><code>--progress</code>： 显示 Webpack 打包进度；</p>
<p><code>--watch, -w</code>： watch 模式打包， 监控文件变化之后重新开始打包；</p>
<p><code>--color, --colors / –no-color, --no-colors</code>： 控制台输出的内容是否开启颜色；</p>
<p><code>--hot</code>： 开启 Hot Module Replacement模式， 后面会详细介绍；</p>
<p><code>--profile</code>： 会详细的输出每个环节的用时（ 时间） ， 方便排查打包速度瓶颈。  </p>
<p>常用命令：</p>
<ul>
<li>打包过程输出进度和颜色：<code>webpack --progress --colors</code></li>
<li>出错时打印错误详情：<code>webpack --display-error-details</code></li>
<li>开启监听模式：<code>webpack --watch</code></li>
<li>环境打包：<code>-d</code> 和 <code>-p</code> 分别代表开发环境和生产环境的打包</li>
</ul>
<h4 id="通过配置文件执行"><a href="#通过配置文件执行" class="headerlink" title="通过配置文件执行"></a>通过配置文件执行</h4><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">npx webpack <span class="token parameter variable">--config</span> webpack.config.js<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<blockquote>
<p><code>--config</code> <em>选项只是向你表明，可以传递任何名称的配置文件。</em></p>
<p>默认配置文件名webpack.config.js</p>
</blockquote>
<h4 id="设置环境-mode变量"><a href="#设置环境-mode变量" class="headerlink" title="设置环境/mode变量"></a>设置环境/<code>mode</code>变量</h4><p>参考链接：<a href="https://webpack.docschina.org/api/cli/#environment-options">Environment 选项</a></p>
<blockquote>
<p>production模式默认压缩，development模式默认不进行压缩</p>
</blockquote>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 方式一 env到文件中解析的结果是字符串（一个env参数） 或 数组（多个env参数） 如['NODE_ENV=local', 'production']</span>
npx webpack <span class="token parameter variable">--env</span> <span class="token assign-left variable">NODE_ENV</span><span class="token operator">=</span>local <span class="token parameter variable">--env</span> production <span class="token parameter variable">--progress</span>

<span class="token comment"># 方式二 env到文件中解析的结果是对象</span>
npx webpack <span class="token parameter variable">--env.NODE_ENV</span><span class="token operator">=</span>local <span class="token parameter variable">--env.production</span> <span class="token parameter variable">--progress</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>结果：<code>webpack.config.js</code></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token parameter">env</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token comment">// Use env.&lt;YOUR VARIABLE> here:</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'NODE_ENV: '</span><span class="token punctuation">,</span> env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 'local'</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Production: '</span><span class="token punctuation">,</span> env<span class="token punctuation">.</span>production<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>

  <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>
    <span class="token literal-property property">entry</span><span class="token operator">:</span> <span class="token string">'./src/index.js'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
      <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">'bundle.js'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">path</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'dist'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>只设置编译<code>mode</code></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">npx webpack <span class="token parameter variable">--mode</span><span class="token operator">=</span>development
<span class="token comment"># 或 npx webpack --mode development</span>
<span class="token comment"># mode = 'production': 'none' | 'development' | 'production'</span>
<span class="token comment"># 默认mode = 'production'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>在<code>webpack.config.js</code>中<code>process.env.NODE_ENV</code>会获取到<code>mode</code>值</p>
<p>或者配置<code>package.json</code>中的<code>script</code>执行命令设置<code>mode</code>值</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>
    ...
    <span class="token property">"script"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        <span class="token property">"dev"</span><span class="token operator">:</span> <span class="token string">"webpack-dev-server --mode=development --env.server=dev"</span><span class="token punctuation">,</span>
    	<span class="token property">"build-test"</span><span class="token operator">:</span> <span class="token string">"webpack --mode=production --env.server=test"</span><span class="token punctuation">,</span>
    	<span class="token property">"build-pro"</span><span class="token operator">:</span> <span class="token string">"webpack --mode=production --env.server=pro"</span>
    <span class="token punctuation">&#125;</span>
    ...
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>mode获取的方式和env取值的方式不同，mode两种方式都会返回mode对象。</p>
<p>mode对象中的mode值为设置的值，所以设置mode参数webpack会将设置的参数值合并到预设的mode对象中，如果设置值不是提供的mode参数，则会报错。</p>
</blockquote>
<p>可以将不同模式下的配置抽取出来放在不同的文件中，使用<code>webpack-merge</code>进行合并。</p>
<blockquote>
<p>如果想设置 node 环境值（process.env），则 <code>window</code> 下需要使用 <a href="https://www.npmjs.com/package/cross-env"><code>cross-env</code></a> 包进行设置，而 Linux 和 Mac 下可以不用进行特殊处理。参考链接：<a href="https://stackoverflow.com/questions/25112510/how-to-set-environment-variables-from-within-package-json">https://stackoverflow.com/questions/25112510/how-to-set-environment-variables-from-within-package-json</a></p>
</blockquote>
<h3 id="优化-optimization"><a href="#优化-optimization" class="headerlink" title="优化(optimization)"></a><a href="https://webpack.docschina.org/configuration/optimization/">优化(optimization)</a></h3><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    <span class="token literal-property property">optimization</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        <span class="token literal-property property">usedExports</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token comment">// production模式下自动配置了，可以省略</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><code>package.json</code></p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>
    <span class="token property">"sideEffects"</span><span class="token operator">:</span> <span class="token boolean">false</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p><code>sideEffects</code>配置<code>tree shaking</code>模式进行打包。</p>
<p>导入某些文件未进行显式使用，但实际有用如<code>import &quot;@babel/polyfill&quot;</code>，则需要在<code>sideEffects</code>中配置。</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>
    <span class="token property">"sideEffects"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token string">"@babel/polyfill"</span><span class="token punctuation">,</span>
        <span class="token string">"*.css"</span> <span class="token comment">// 防止css模块化文件被tree shaking </span>
    <span class="token punctuation">]</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>development模式下即使使用了tree shaking，但是不会去除掉。</p>
</blockquote>
<p>参考链接：<a href="https://www.jianshu.com/p/773760145ea5">使用Webpack4优化Web性能</a></p>
<h3 id="代码分割-Code-Splitting"><a href="#代码分割-Code-Splitting" class="headerlink" title="代码分割(Code Splitting)"></a><a href="https://webpack.docschina.org/guides/code-splitting/">代码分割(Code Splitting)</a></h3><p>代码分割与<code>webpack</code>无关。</p>
<p>手动进行代码分割，创建子文件。</p>
<p>使用<code>webpack</code>自带的插件 <a href="https://webpack.docschina.org/plugins/split-chunks-plugin/">split-chunk-plugin</a> 进行代码分割。</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  <span class="token comment">//...默认配置</span>
  <span class="token literal-property property">optimization</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token literal-property property">splitChunks</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
      <span class="token literal-property property">chunks</span><span class="token operator">:</span> <span class="token string">'async'</span><span class="token punctuation">,</span> <span class="token comment">// 'all' | 'initial'</span>
      <span class="token literal-property property">minSize</span><span class="token operator">:</span> <span class="token number">20000</span><span class="token punctuation">,</span> <span class="token comment">// 生成chunk的最小体积</span>
      <span class="token literal-property property">minRemainingSize</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
      <span class="token literal-property property">maxSize</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
      <span class="token literal-property property">minChunks</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment">// 拆分前必须共享模块的最小chunks数，被多个chunk文件引入的次数</span>
      <span class="token literal-property property">maxAsyncRequests</span><span class="token operator">:</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token comment">// 按需加载时的最大并行请求数</span>
      <span class="token literal-property property">maxInitialRequests</span><span class="token operator">:</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token comment">// 入口点的最大并行请求数</span>
      <span class="token literal-property property">enforceSizeThreshold</span><span class="token operator">:</span> <span class="token number">50000</span><span class="token punctuation">,</span>
      <span class="token literal-property property">cacheGroups</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> 
        <span class="token literal-property property">defaultVendors</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
          <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">[\\/]node_modules[\\/]</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> <span class="token comment">// 如果是node_modules引入的则打包出来</span>
          <span class="token literal-property property">priority</span><span class="token operator">:</span> <span class="token operator">-</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token comment">// 优先级</span>
          <span class="token literal-property property">reuseExistingChunk</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token keyword">default</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token comment">// 默认分割打包</span>
          <span class="token literal-property property">minChunks</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
          <span class="token literal-property property">priority</span><span class="token operator">:</span> <span class="token operator">-</span><span class="token number">20</span><span class="token punctuation">,</span>
          <span class="token literal-property property">reuseExistingChunk</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 如果模块之前被打包过，则直接使用之前打包的</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>文件进行分割时，从上到下开始匹配，如果到cacheGroups之后都能满足条件，则会进行优先级高的分割方式进行分割。否则不会进行代码分割。</p>
</blockquote>
<p>动态导入。使用<code>import</code>异步加载模块。无需做任何配置，会自动进行代码分割。</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">getComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'lodash'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">&#123;</span> <span class="token keyword">default</span><span class="token operator">:</span> _ <span class="token punctuation">&#125;</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">var</span> element <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span>
        element<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> _<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'-'</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> element
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token function">getComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">element</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChlid</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>可以使用魔法注释的方法去命名代码分割后的文件名，否则默认索引。</p>
<p>import(/* webpackChunkName: “lodash” */ ‘lodash’)</p>
</blockquote>
<h4 id="懒加载-Lazy-Loading"><a href="#懒加载-Lazy-Loading" class="headerlink" title="懒加载(Lazy Loading)"></a>懒加载(Lazy Loading)</h4><p>通过<code>import</code>异步加载，实现懒加载，在触发时才进行加载，提升页面初加载速度。</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">getComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token comment">/* webpackChunkName: "lodash" */</span> <span class="token string">'lodash'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">&#123;</span> <span class="token keyword">default</span><span class="token operator">:</span> _ <span class="token punctuation">&#125;</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">var</span> element <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElementNS</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    element<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> _<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'-'</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> element
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token function">getComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">element</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>

<span class="token comment">// 使用async await进行改写异步</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">getComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> <span class="token keyword">default</span><span class="token operator">:</span> _ <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token comment">/* webpackChunkName: "lodash" */</span> <span class="token string">'lodash'</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> element <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span>
    element<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> _<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> element
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>路由实现懒加载。</p>
<p><code>webpack</code>没有懒加载概念，只是能识别<code>import</code>语法进行代码分割。</p>
<p>异步打包代码在首屏渲染时加载的数据更少更快，所以<code>webpack</code>推荐异步打包代码(<code>chunks: &#39;async&#39;</code>)。</p>
<h4 id="打包分析"><a href="#打包分析" class="headerlink" title="打包分析"></a>打包分析</h4><p>分析输出结果来检查模块在何处结束。</p>
<ul>
<li><a href="https://github.com/webpack/analyse">官方分析工具</a>：<code>webpack --profile --json &gt; stats.json</code>，将分析结果放到<code>stats.json</code>文件中然后在<a href="http://webpack.github.io/analyse/">分析网站</a>上进行分析。</li>
<li><a href="https://alexkuz.github.io/webpack-chart/">webpack-chart</a>: webpack stats 可交互饼图。</li>
<li><a href="https://chrisbateman.github.io/webpack-visualizer/">webpack-visualizer</a>: 可视化并分析你的 bundle，检查哪些模块占用空间，哪些可能是重复使用的。</li>
<li><a href="https://github.com/webpack-contrib/webpack-bundle-analyzer">webpack-bundle-analyzer</a>：一个 plugin 和 CLI 工具，它将 bundle 内容展示为一个便捷的、交互式、可缩放的树状图形式。(常用)</li>
<li><a href="https://webpack.jakoblind.no/optimize">webpack bundle optimize helper</a>：这个工具会分析你的 bundle，并提供可操作的改进措施，以减少 bundle 的大小。</li>
<li><a href="https://github.com/bundle-stats/bundle-stats">bundle-stats</a>：生成一个 bundle 报告（bundle 大小、资源、模块），并比较不同构建之间的结果。</li>
</ul>
<h4 id="预获取-预加载模块-Preloading-Prefetching"><a href="#预获取-预加载模块-Preloading-Prefetching" class="headerlink" title="预获取/预加载模块 (Preloading / Prefetching)"></a>预获取/预加载模块 (Preloading / Prefetching)</h4><blockquote>
<p>提升代码利用率，但有浏览器版本兼容问题。</p>
</blockquote>
<p>在声明 import 时，使用下面这些内置指令，可以让 <code>webpack</code> 输出 “resource hint(资源提示)”，来告知浏览器：</p>
<ul>
<li><strong>prefetch</strong>(预获取)：将来某些导航下可能需要的资源</li>
<li><strong>preload</strong>(预加载)：当前导航下可能需要资源</li>
</ul>
<p><code>prefetch</code>示例：在组件中有个需要点击后按需加载的组件</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 在组件中声明</span>
<span class="token keyword">import</span><span class="token punctuation">(</span><span class="token comment">/* webpackPrefetch: true */</span> <span class="token string">'./path/to/LoginModal.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>这会生成 <code>&lt;link rel=&quot;prefetch&quot; href=&quot;login-modal-chunk.js&quot;&gt;</code> 并追加到页面头部，指示着浏览器在闲置时间预取 <code>login-modal-chunk.js</code> 文件。</p>
<blockquote>
<p>只要父 chunk 完成加载，webpack 就会添加 prefetch hint(预取提示)。</p>
</blockquote>
<p><code>prefetch</code>与<code>preload</code>的<strong>区别</strong>：</p>
<ul>
<li><code>preload chunk</code> 会在父 <code>chunk</code> 加载时，以并行方式开始加载。<code>prefetch chunk</code> 会在父 <code>chunk</code> 加载结束后开始加载。</li>
<li><code>preload chunk</code> 具有中等优先级，并立即下载。<code>prefetch chunk</code> 在浏览器闲置时下载。</li>
<li><code>preload chunk</code> 会在父 <code>chunk</code> 中立即请求，用于当下时刻。<code>prefetch chunk</code> 会用于未来的某个时刻。</li>
<li>浏览器支持程度不同。</li>
</ul>
<p><code>preload</code>示例：图表组件 <code>ChartComponent</code> 组件需要依赖一个体积巨大的 <code>ChartingLibrary</code> 库。它会在渲染时显示一个 <code>LoadingIndicator(加载进度条)</code> 组件，然后立即按需导入 <code>ChartingLibrary</code>：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// ChartingLibrary组件</span>
<span class="token keyword">import</span><span class="token punctuation">(</span><span class="token comment">/* webpackPreload: true */</span> <span class="token string">'ChartingLibrary'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>



<h4 id="CSS代码分割"><a href="#CSS代码分割" class="headerlink" title="CSS代码分割"></a>CSS代码分割</h4><p>使用<a href="https://webpack.docschina.org/plugins/mini-css-extract-plugin/">MiniCssExtractPlugin</a> 插件将CSS提取到单独的文件中，为每个包含CSS的JS文件创建一个CSS文件，并且支持CSS和SourceMaps的按需加载。</p>
<blockquote>
<p>与 extract-text-webpack-plugin 相比：</p>
<ul>
<li>异步加载</li>
<li>没有重复的编译（性能）</li>
<li>更容易使用</li>
<li>特别针对 CSS 开发</li>
</ul>
</blockquote>
<p>安装 <code>mini-css-extract-plugin</code>：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> --save-dev mini-css-extract-plugin<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>在<code>js</code>文件中引入<code>css</code>文件：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> <span class="token string">'./style.css'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<blockquote>
<p>注意tree shaking的配置，会使css无法打包出来</p>
</blockquote>
<p><code>webpack.config.js</code>配置：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> MiniCssExtractPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'mini-css-extract-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token keyword">new</span> <span class="token class-name">MiniCssExtractPlugin</span><span class="token punctuation">(</span>
  	<span class="token punctuation">&#123;</span>
        <span class="token literal-property property">fileName</span><span class="token operator">:</span> <span class="token string">'[name].css'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">chunkFilename</span><span class="token operator">:</span> <span class="token string">'[name].chunk.css'</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">&#123;</span>
        <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.css$</span><span class="token regex-delimiter">/</span><span class="token regex-flags">i</span></span><span class="token punctuation">,</span>
        <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">[</span>MiniCssExtractPlugin<span class="token punctuation">.</span>loader<span class="token punctuation">,</span> <span class="token string">'css-loader'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>要在<code>css loader</code>的最后一步使用<code>MiniCssExtractPlugin.loader</code>进行处理<code>css</code>。</p>
<p><a href="https://v4.webpack.js.org/plugins/mini-css-extract-plugin/#extracting-all-css-in-a-single-file">将多个<code>CSS</code>文件打包到一个<code>CSS</code>文件中</a></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    <span class="token literal-property property">optimization</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        <span class="token literal-property property">cacheeGroups</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
            <span class="token literal-property property">styles</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
                <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'styles'</span><span class="token punctuation">,</span>
                <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.css$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
                <span class="token literal-property property">chunks</span><span class="token operator">:</span> <span class="token string">'all'</span><span class="token punctuation">,</span>
                <span class="token literal-property property">enforce</span><span class="token operator">:</span> <span class="token boolean">true</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>使用<a href="https://webpack.docschina.org/plugins/css-minimizer-webpack-plugin/">CssMinimizerWebpackPlugin</a> 进行CSS代码压缩和<a href="https://cssnano.co/">cssnano</a>优化</p>
<p>安装<code>css-minimizer-webpack-plugin</code></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> css-minimizer-webpack-plugin --save-dev<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><code>webpack.config.js</code>配置：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> MiniCssExtractPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'mini-css-extract-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> CssMinimizerPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'css-minimizer-webpack-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  <span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token literal-property property">loaders</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">&#123;</span>
        <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">.s?css$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">[</span>MiniCssExtractPlugin<span class="token punctuation">.</span>loader<span class="token punctuation">,</span> <span class="token string">'css-loader'</span><span class="token punctuation">,</span> <span class="token string">'sass-loader'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">optimization</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token literal-property property">minimize</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token literal-property property">minimizer</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token comment">// 在 webpack@5 中，你可以使用 `...` 语法来扩展现有的 minimizer（即 `terser-webpack-plugin`），将下一行取消注释</span>
      <span class="token comment">// `...`,</span>
      <span class="token keyword">new</span> <span class="token class-name">CssMinimizerPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="预置依赖-Shimming"><a href="#预置依赖-Shimming" class="headerlink" title="预置依赖(Shimming)"></a><a href="https://v4.webpack.js.org/guides/shimming/">预置依赖(Shimming)</a></h3><blockquote>
<p>改变webpack默认打包的一些行为，或补充webpack未实现的效果</p>
</blockquote>
<p>使用<a href="https://v4.webpack.js.org/plugins/provide-plugin/">ProvidePlugin</a> 插件自动导入模块。</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack'</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>ProvidePlugin</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
            <span class="token literal-property property">$</span><span class="token operator">:</span> <span class="token string">'jquery'</span><span class="token punctuation">,</span>
  			<span class="token literal-property property">jQuery</span><span class="token operator">:</span> <span class="token string">'jquery'</span><span class="token punctuation">,</span>
            <span class="token literal-property property">_join</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'lodash'</span><span class="token punctuation">,</span> <span class="token string">'join'</span><span class="token punctuation">]</span> <span class="token comment">// 类似import &#123; join as _join &#125; from 'lodash'</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>如果在某个模块中使用了’$’字符串则会在模块中自动引入jquery模块并取名’$’</p>
</blockquote>
<p>将每个js文件的<code>this</code>默认为当前js模块自身，修改<code>this</code>指向<code>window</code>，，则需要使用<code>imports-loader</code>进行修改。</p>
<p>安装<code>imports-loader</code>：<code>npm install imports-loader --save-dev</code></p>
<p><code>webpack.config.js</code></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    <span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">&#123;</span>
            <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.js$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
            <span class="token literal-property property">exclude</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">node_modules</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
            <span class="token literal-property property">user</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                <span class="token punctuation">&#123;</span>
                    <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">'babel-loader'</span> <span class="token comment">// 对ES6语法做解析</span>
                <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
                <span class="token punctuation">&#123;</span>
                    <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">'imports-loader?this=>window'</span>
                <span class="token punctuation">&#125;</span>
            <span class="token punctuation">]</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">]</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="WebpackDevServer"><a href="#WebpackDevServer" class="headerlink" title="WebpackDevServer"></a><a href="https://v4.webpack.docschina.org/configuration/dev-server/">WebpackDevServer</a></h3><p>安装<code>npm install webpack-dev-server --save-dev</code></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    <span class="token literal-property property">devServe</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token comment">// 在开发环境下才有用</span>
        <span class="token literal-property property">constentBase</span><span class="token operator">:</span> <span class="token string">'./dist'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">open</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token literal-property property">port</span><span class="token operator">:</span> <span class="token number">8080</span><span class="token punctuation">,</span>
        <span class="token literal-property property">hot</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token literal-property property">hotOnly</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token literal-property property">proxy</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token comment">// 实现请求转发</span>
            <span class="token string-property property">'/api'</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
                <span class="token literal-property property">target</span><span class="token operator">:</span> <span class="token string">'https://xxxx.cn'</span><span class="token punctuation">,</span>
                <span class="token literal-property property">pathRewrite</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
                    <span class="token string-property property">'header.json'</span><span class="token operator">:</span> <span class="token string">'demo.json'</span> <span class="token comment">// 如果请求header.json数据其实是加载demo.json的数据</span>
                <span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>单页面应用配置<a href="https://webpack.docschina.org/configuration/dev-server/#devserverhistoryapifallback"><code>historyApiFallback</code></a> 响应<code>html</code>页面</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 只在开发环境下使用，如果需要线上转发同样有效需要配置nginx或tomcat</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  <span class="token comment">//...</span>
  <span class="token literal-property property">devServer</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token literal-property property">historyApiFallback</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 当使用h5 history api时，所有404请求都会响应index.html的内容</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token comment">// 也可以设置对象</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  <span class="token comment">//...</span>
  <span class="token literal-property property">devServer</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token literal-property property">historyApiFallback</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
      <span class="token literal-property property">rewrites</span><span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token comment">// 特殊情况转向其他页面</span>
        <span class="token punctuation">&#123;</span> <span class="token literal-property property">from</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^\/$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> <span class="token literal-property property">to</span><span class="token operator">:</span> <span class="token string">'/views/landing.html'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token punctuation">&#123;</span> <span class="token literal-property property">from</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^\/subpage</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> <span class="token literal-property property">to</span><span class="token operator">:</span> <span class="token string">'/views/subpage.html'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token punctuation">&#123;</span> <span class="token literal-property property">from</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">.</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> <span class="token literal-property property">to</span><span class="token operator">:</span> <span class="token string">'/views/404.html'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>更多的参考配置内容 <a href="https://github.com/bripkens/connect-history-api-fallback">connect-history-api-fallback</a></p>
</blockquote>
<h3 id="ESLint配置"><a href="#ESLint配置" class="headerlink" title="ESLint配置"></a><a href="https://eslint.org/docs/user-guide/configuring/">ESLint配置</a></h3><p>在项目目录下安装<code>ESLint</code>：<code>npm install eslint --save-dev</code></p>
<p>初始化<code>ESLint</code>配置文件：<code>npx eslint --init</code>，使用<code>npx</code>避免全局<code>ESLint</code>配置污染问题。</p>
<p>使用<code>ESLint</code>手动检测代码是否规范：<code>npx eslint src</code></p>
<p>有的时候不识别<code>react</code>或最新的<code>ES</code>新特性可以设置<a href="https://eslint.org/docs/user-guide/configuring/plugins#specifying-parser">指定解析器</a> 进行安装和配置。</p>
<p>在<code>.eslintrc.js</code>进行配置</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  <span class="token literal-property property">parser</span><span class="token operator">:</span> <span class="token string">"@babel/eslint-parser"</span><span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<h4 id="在webpack中配置eslint"><a href="#在webpack中配置eslint" class="headerlink" title="在webpack中配置eslint"></a>在<code>webpack</code>中配置<code>eslint</code></h4><blockquote>
<p>会降低打包的速度，可以只在开发环境下使用，配合git仓库的钩子进行判断提交代码是否符合规则。</p>
</blockquote>
<p>(<em>已过时</em>)安装<code>eslint-loader</code>：<code>npm install eslint-loader --save-dev</code></p>
<p>在<code>webpack.config.js</code>中配置</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">module<span class="token punctuation">.</span>export <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    <span class="token operator">...</span>
    <span class="token literal-property property">devServer</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        <span class="token literal-property property">overlay</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token comment">// 直接将错误信息显示在浏览器上</span>
        <span class="token operator">...</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">&#123;</span>
                <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.js$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
                <span class="token literal-property property">exclude</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">node_modules</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
                <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'babel-loader'</span><span class="token punctuation">,</span> <span class="token string">'eslint-loader'</span><span class="token punctuation">]</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>更新使用<a href="https://webpack.js.org/plugins/eslint-webpack-plugin/#root">EslintWebpackPlugin</a> 解决了<code>eslint-loader</code> 的一些问题。</p>
<p>需要先进行安装<code>eslint-webpack-plugin</code> ： <code>npm install eslint-webpack-plugin --save-dev</code></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// webpack.config.js 中使用 EslintWebpackPlugin</span>
<span class="token keyword">const</span> ESLintPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'eslint-webpack-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  <span class="token comment">// ...</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token keyword">new</span> <span class="token class-name">ESLintPlugin</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="提升webpack打包速度"><a href="#提升webpack打包速度" class="headerlink" title="提升webpack打包速度"></a>提升webpack打包速度</h3><ol>
<li><h4 id="升级版本（node、npm、yarn、webpack版本）"><a href="#升级版本（node、npm、yarn、webpack版本）" class="headerlink" title="升级版本（node、npm、yarn、webpack版本）"></a>升级版本（<code>node</code>、<code>npm</code>、<code>yarn</code>、<code>webpack</code>版本）</h4></li>
<li><h4 id="在尽可能少的模块上应用loader，合理使用exclude和include语法去优化loader。"><a href="#在尽可能少的模块上应用loader，合理使用exclude和include语法去优化loader。" class="headerlink" title="在尽可能少的模块上应用loader，合理使用exclude和include语法去优化loader。"></a>在尽可能少的模块上应用<code>loader</code>，合理使用<code>exclude</code>和<code>include</code>语法去优化<code>loader</code>。</h4></li>
<li><h4 id="Plugin尽可能精简并确保可靠性，避免冗余，选择性能好的插件，最好使用官方推荐的插件。"><a href="#Plugin尽可能精简并确保可靠性，避免冗余，选择性能好的插件，最好使用官方推荐的插件。" class="headerlink" title="Plugin尽可能精简并确保可靠性，避免冗余，选择性能好的插件，最好使用官方推荐的插件。"></a><code>Plugin</code>尽可能精简并确保可靠性，避免冗余，选择性能好的插件，最好使用官方推荐的插件。</h4></li>
<li><h4 id="resolve参数合理配置。"><a href="#resolve参数合理配置。" class="headerlink" title="resolve参数合理配置。"></a><a href="https://webpack.docschina.org/configuration/resolve/#root"><code>resolve</code>参数合理配置</a>。</h4><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// webpack.config.js</span>
module<span class="token punctuation">.</span>expotys <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    <span class="token literal-property property">resolve</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        <span class="token literal-property property">extensions</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'.js'</span><span class="token punctuation">,</span> <span class="token string">'.jsx'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// 配置模块如何解析 文件查找 导入的时候可以省略文件后缀</span>
        <span class="token literal-property property">mainFilees</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'index'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// 默认</span>
        <span class="token literal-property property">alias</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token comment">// 别名</span>
            @<span class="token operator">:</span> <span class="token string">'../src'</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
<li><h4 id="使用DllPlugin提高打包速度。"><a href="#使用DllPlugin提高打包速度。" class="headerlink" title="使用DllPlugin提高打包速度。"></a>使用<a href="https://webpack.docschina.org/plugins/dll-plugin/"><code>DllPlugin</code></a>提高打包速度。</h4><ol>
<li><p>将第三方模块单独做一次打包，打包成单独的库，使用<code>DllPlugin</code>进行分析生成映射文件。</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// webpack.dll.js</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    <span class="token literal-property property">mode</span><span class="token operator">:</span> <span class="token string">'production'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">entry</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        <span class="token literal-property property">vendors</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'lodash'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token literal-property property">react</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'react'</span><span class="token punctuation">,</span> <span class="token string">'react-dom'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token literal-property property">jquery</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'jquery'</span><span class="token punctuation">]</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">'[name].dll.js'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">path</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'../dll'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token literal-property property">library</span><span class="token operator">:</span> <span class="token string">'[name]'</span> <span class="token comment">// 将[name]为全局变量暴露出去</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>DllPlugin</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token comment">// 对暴露的文件进行分析，生成映射文件</span>
            <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'[name]'</span><span class="token punctuation">,</span>
            <span class="token literal-property property">path</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'../dll/[name].manifest.json'</span><span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
<li><p>项目中使用<a href="https://github.com/SimenB/add-asset-html-webpack-plugin">add-asset-html-webpack-plugin</a> 将打包后的库加载到项目中，使用<code>DllReferencePlugin</code>插件对映射进行解析。</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// webpack.commo.js</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token keyword">new</span> <span class="token class-name">AddAssetHtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token comment">// 需要引入多少个文件就需要使用几次插件</span>
            <span class="token literal-property property">filepath</span><span class="token operator">:</span> <span class="token string">'../dll/venders.dll.js'</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>DllReferencePlugin</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
            <span class="token literal-property property">manifeat</span><span class="token operator">:</span> <span class="token string">'../dll/vendors.maifeat.json'</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
        <span class="token operator">...</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ol>
</li>
<li><h4 id="控制包文件大小。"><a href="#控制包文件大小。" class="headerlink" title="控制包文件大小。"></a>控制包文件大小。</h4></li>
<li><h4 id="thread-loader、parallel-webpack、happypack多进程打包。"><a href="#thread-loader、parallel-webpack、happypack多进程打包。" class="headerlink" title="thread-loader、parallel-webpack、happypack多进程打包。"></a><code>thread-loader</code>、<code>parallel-webpack</code>、<code>happypack</code>多进程打包。</h4></li>
<li><h4 id="合理使用sourceMap。"><a href="#合理使用sourceMap。" class="headerlink" title="合理使用sourceMap。"></a>合理使用<code>sourceMap</code>。</h4></li>
<li><h4 id="结合stats分析打包结果。"><a href="#结合stats分析打包结果。" class="headerlink" title="结合stats分析打包结果。"></a>结合<code>stats</code>分析打包结果。</h4></li>
<li><h4 id="开发环境内存编译。"><a href="#开发环境内存编译。" class="headerlink" title="开发环境内存编译。"></a>开发环境内存编译。</h4></li>
<li><h4 id="开发环境无用插件剔除。"><a href="#开发环境无用插件剔除。" class="headerlink" title="开发环境无用插件剔除。"></a>开发环境无用插件剔除。</h4></li>
<li><h4 id="使用CDN进行导入第三方库，配置externals属性进行全局使用。"><a href="#使用CDN进行导入第三方库，配置externals属性进行全局使用。" class="headerlink" title="使用CDN进行导入第三方库，配置externals属性进行全局使用。"></a>使用CDN进行导入第三方库，配置<code>externals</code>属性进行全局使用。</h4></li>
</ol>
<blockquote>
<p>还有很多插件或loader的配置可以提升性能，如cache配置</p>
</blockquote>
<h3 id="处理多页面打包HtmlWebpackPlugin"><a href="#处理多页面打包HtmlWebpackPlugin" class="headerlink" title="处理多页面打包HtmlWebpackPlugin"></a>处理多页面打包<code>HtmlWebpackPlugin</code></h3><p>需要修改<code>entry</code>配置和<a href="https://github.com/jantimon/html-webpack-plugin">html-webpack-plugin</a> 的配置</p>
<p>多个输出文件需要多个<code>html-webpack-plugin</code>配置</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> HtmlWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'html-webpack-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    <span class="token literal-property property">entry</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token comment">// 入口</span>
        <span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token string">'src/a.js'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">b</span><span class="token operator">:</span> <span class="token string">'src/b.js'</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
      		<span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">'a.html'</span><span class="token punctuation">,</span>
      		<span class="token literal-property property">template</span><span class="token operator">:</span> <span class="token string">'src/index.html'</span><span class="token punctuation">,</span>
            <span class="token literal-property property">chunks</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'a.js'</span><span class="token punctuation">]</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
      		<span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">'b.html'</span><span class="token punctuation">,</span>
      		<span class="token literal-property property">template</span><span class="token operator">:</span> <span class="token string">'src/index.html'</span><span class="token punctuation">,</span>
        	<span class="token literal-property property">chunks</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'b.js'</span><span class="token punctuation">]</span> <span class="token comment">// 引入的js文件</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">// 会输出多个文件，且相对应的引入入口文件。(生成多个文件，一对一)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>如果多个入口文件，但只设置了一个<code>HtmlWebpackPlugin</code>则只会生成一个文件，未设置<code>chunks</code>，会都引入入口文件。(生成一个文件，多对一)</p>
<p>如果只设置一个入口文件，但设置多个<code>HtmlWebpackPlugin</code>则会生成多个文件，未设置<code>chunks</code>，且都引入入口文件。(生成多个文件，一对多)</p>
<p><code>HtmlWebpackPlugin</code>插件可以设置js文件引入位置，默认引入位置为<code>body</code>底部，可以设置为<code>head</code>标签底部引入。</p>
<p>可以自定义设置<code>js/css</code>引入位置：在基础<code>HtmlWebpackPlugin</code>上使用<a href="https://github.com/thearchitgarg/html-webpack-injector">html-webpack-injector</a>  (支持两个<code>chunks</code>分别引入位置)</p>
<blockquote>
<p>HtmlWebpackInjector会有一个问题，分开的时候会把meta注入到<body>中，解决方法可以直接将meta信息写在pug模板中，不使用HtmlWebpackPlugin进行配置动态设置</p>
</blockquote>
<h4 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h4><p>浏览器缓存失效问题，<code>[contenthash]</code>、<code>[hash]</code>未修改代码hash不一致问题（仅修改业务代码，但是库代码也重新打包）。可能是<code>webpack</code>版本过旧，需要将<code>mainfest</code>(库与业务代码的关系)提取到<code>runtime</code>中，进行以下配置：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    <span class="token literal-property property">optimization</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        <span class="token literal-property property">runtimeChunk</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
            <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'runtime'</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="更多阅读"><a href="#更多阅读" class="headerlink" title="更多阅读"></a>更多阅读</h3><p>实验项目地址：<a href="https://github.com/Datura35422/study/tree/master/webpack-demos">https://github.com/Datura35422/study/tree/master/webpack-demos</a></p>
<h4 id="webpack-v4-x"><a href="#webpack-v4-x" class="headerlink" title="webpack-v4.x"></a>webpack-v4.x</h4><p><a href="https://www.kancloud.cn/sllyli/webpack/1242347">使用 webpack 定制前端开发环境 - 看云</a></p>
<p><a href="https://whjin.github.io/frontend-dev-doc/">webpack - 实战总结</a></p>
]]></content>
      <categories>
        <category>前端</category>
        <category>webpack</category>
      </categories>
      <tags>
        <tag>前端</tag>
        <tag>webpack</tag>
      </tags>
  </entry>
  <entry>
    <title>工具函数系列-超时取消事件</title>
    <url>/posts/27382/</url>
    <content><![CDATA[<h4 id="方法1-setTimeout"><a href="#方法1-setTimeout" class="headerlink" title="方法1 setTimeout"></a>方法1 setTimeout</h4><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">timeoutify</span><span class="token punctuation">(</span><span class="token parameter">fn<span class="token punctuation">,</span> delay</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">var</span> intv <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        intv <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token function">fn</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">"Timeout!"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> delay<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// 还没有超时</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>intv<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token function">clearTimeout</span><span class="token punctuation">(</span>intv<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">fn</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h4 id="方法2-promise"><a href="#方法2-promise" class="headerlink" title="方法2 promise"></a>方法2 promise</h4><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 使用promise.race 竞速 promise状态一旦决议就无法改变</span>
<span class="token keyword">function</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'test'</span><span class="token punctuation">)</span>
            <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'test'</span><span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">function</span> <span class="token function">timeoutfn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'timeoutfn'</span><span class="token punctuation">)</span>
            <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'timeoutfn'</span><span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">4000</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

Promise<span class="token punctuation">.</span><span class="token function">race</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
    <span class="token function">timeoutfn</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'race end'</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'race err'</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

]]></content>
      <categories>
        <category>前端</category>
        <category>工具函数</category>
      </categories>
      <tags>
        <tag>前端</tag>
        <tag>工具函数</tag>
        <tag>promise</tag>
      </tags>
  </entry>
  <entry>
    <title>工具函数系列-千位符格式化处理</title>
    <url>/posts/50505/</url>
    <content><![CDATA[<p>数字千分位形式,是从个位数起，每三位之间加一个逗号,例如:1450068，经过处理之后为1,450,068</p>
<h4 id="方法一：使用Number-prototype-toLocaleString"><a href="#方法一：使用Number-prototype-toLocaleString" class="headerlink" title="方法一：使用Number.prototype.toLocaleString()"></a>方法一：使用<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Number/toLocaleString">Number.prototype.toLocaleString()</a></h4><p><code>toLocaleString()</code> 方法返回这个数字在特定语言环境下的表示字符串。</p>
<p>新的 <code>locales</code> 和 <code>options</code> 参数让应用程序可以指定要进行格式转换的语言，并且定制函数的行为。在旧的实现中，会忽略 <code>locales</code> 和 <code>options</code> 参数，使用的语言环境和返回的字符串的形式完全取决于实现方式。</p>
<h5 id="使用方式："><a href="#使用方式：" class="headerlink" title="使用方式："></a>使用方式：</h5><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> num <span class="token operator">=</span> <span class="token number">1234567890</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>num<span class="token punctuation">.</span><span class="token function">toLocaleString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>



<p><img src="/posts/50505/1.png" alt="1"></p>
<h4 id="方法二：使用正则表达式"><a href="#方法二：使用正则表达式" class="headerlink" title="方法二：使用正则表达式"></a>方法二：使用正则表达式</h4><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">toThousands</span><span class="token punctuation">(</span><span class="token parameter">num</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	<span class="token keyword">var</span> numStr <span class="token operator">=</span> <span class="token punctuation">(</span>num <span class="token operator">||</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> numStr<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">(\d)(?=(?:\d&#123;3&#125;)+$)</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">'$1,'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token function">toThousands</span><span class="token punctuation">(</span><span class="token number">1234567890</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="/posts/50505/2.png" alt="2"></p>
<h4 id="方法三：遍历"><a href="#方法三：遍历" class="headerlink" title="方法三：遍历"></a>方法三：遍历</h4><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">toThousands</span><span class="token punctuation">(</span><span class="token parameter">num</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">let</span> res <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">,</span> numStr <span class="token operator">=</span> <span class="token punctuation">(</span>num <span class="token operator">||</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span>numStr<span class="token punctuation">.</span>length <span class="token operator">></span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        res <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">,</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>numStr<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>res<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span>
        numStr <span class="token operator">=</span> numStr<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
   	numStr <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>res <span class="token operator">=</span> numStr <span class="token operator">+</span> res<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">','</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        res <span class="token operator">=</span> res<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">return</span> res
<span class="token punctuation">&#125;</span>
<span class="token function">toThousands</span><span class="token punctuation">(</span><span class="token number">1234567890</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="/posts/50505/3.png" alt="3"></p>
<h4 id="方法四：工具库"><a href="#方法四：工具库" class="headerlink" title="方法四：工具库"></a>方法四：工具库</h4><p><a href="http://numeraljs.com/">Numeral.js</a></p>
]]></content>
      <categories>
        <category>前端</category>
        <category>工具函数</category>
      </categories>
      <tags>
        <tag>面试</tag>
        <tag>工具函数</tag>
        <tag>基础</tag>
      </tags>
  </entry>
  <entry>
    <title>工具函数系列-总结</title>
    <url>/posts/47327/</url>
    <content><![CDATA[<h3 id="函数库"><a href="#函数库" class="headerlink" title="函数库"></a>函数库</h3><h4 id="Lodash"><a href="#Lodash" class="headerlink" title="Lodash"></a>Lodash</h4><p><a href="https://github.com/lodash/lodash">https://github.com/lodash/lodash</a></p>
<p>是一个一致性、模块化、高性能的 JavaScript 实用工具库。</p>
<h4 id="Underscore"><a href="#Underscore" class="headerlink" title="Underscore"></a>Underscore</h4><p><a href="https://underscorejs.org/">https://underscorejs.org/</a></p>
<p>提供了一套完善的函数式编程的接口，让我们更方便地在JavaScript中实现函数式编程。</p>
<h4 id="Ramda"><a href="#Ramda" class="headerlink" title="Ramda"></a>Ramda</h4><p><a href="https://github.com/ramda/ramda">https://github.com/ramda/ramda</a></p>
<p>Ramda的理念是<code>function first，data last</code>。Ramda 还有一个特点：所有方法都支持柯里化。<br>可以通过阮一峰的文章<a href="http://www.ruanyifeng.com/blog/2017/03/ramda.html">Ramda 函数库参考教程</a>学习。</p>
<h4 id="Outils"><a href="#Outils" class="headerlink" title="Outils"></a>Outils</h4><p><a href="https://github.com/proYang/outils">https://github.com/proYang/outils</a></p>
<p>前端业务代码工具库。统一封装常用函数，并发布到 npm，以提高开发效率。</p>
]]></content>
      <categories>
        <category>前端</category>
        <category>工具函数</category>
      </categories>
      <tags>
        <tag>前端</tag>
        <tag>工具函数</tag>
      </tags>
  </entry>
  <entry>
    <title>工具函数系列-数组拉平</title>
    <url>/posts/2907/</url>
    <content><![CDATA[<h3 id="ES6"><a href="#ES6" class="headerlink" title="ES6"></a>ES6</h3><h4 id="Array-prototype-flat"><a href="#Array-prototype-flat" class="headerlink" title="Array.prototype.flat()"></a><a href="https://developer.mozilla.org/zh-TW/docs/Web/JavaScript/Reference/Global_Objects/Array/flat">Array.prototype.flat()</a></h4><p>拉平数组，变成一维的数组，返回一个新数组。</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">flat</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// [1, 2, 3, 4]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p><code>flat()</code>的参数<strong>默认为1</strong>，表示只会<strong>拉平1层</strong>。如果要拉平多层则传入参数，表示想要拉平的层数。</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">flat</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// [1, 2, 3, [4, 5]]</span>
<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">flat</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
<span class="token comment">// [1, 2, 3, 4, 5]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>如果不管多少层数据，都要转为1层数组，可以用<code>Infinity</code>作为参数。</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">flat</span><span class="token punctuation">(</span><span class="token number">Infinity</span><span class="token punctuation">)</span>
<span class="token comment">// [1, 2, 3, 4, 5]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>如果原数组有空位，<code>flat()</code>会跳过空位</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">flat</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// [1, 2, 3, 4]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>



<h3 id="polyfill"><a href="#polyfill" class="headerlink" title="polyfill"></a>polyfill</h3><h4 id="Array-prototype-reduce"><a href="#Array-prototype-reduce" class="headerlink" title="Array.prototype.reduce()"></a><a href="https://developer.mozilla.org/zh-TW/docs/Web/JavaScript/Reference/Global_Objects/Array/Reduce">Array.prototype.reduce()</a></h4><p>会跳过原数组空位。</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span>

<span class="token keyword">function</span> <span class="token function">reduce</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> res <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> 
    a<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res<span class="token punctuation">,</span> cur</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>cur <span class="token keyword">instanceof</span> <span class="token class-name">Array</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token function">reduce</span><span class="token punctuation">(</span>cur<span class="token punctuation">,</span> res<span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
            res<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>cur<span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">return</span> res
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> res<span class="token punctuation">)</span>
    <span class="token keyword">return</span> res
<span class="token punctuation">&#125;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'res'</span><span class="token punctuation">,</span> <span class="token function">reduce</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h4 id="Array-prototype-forEach"><a href="#Array-prototype-forEach" class="headerlink" title="Array.prototype.forEach()"></a><a href="https://developer.mozilla.org/zh-TW/docs/Web/JavaScript/Reference/Global_Objects/Array/forEach">Array.prototype.forEach()</a></h4><p>会跳过原数组空位</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span>

<span class="token keyword">function</span> <span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> res <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    a<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>item <span class="token keyword">instanceof</span> <span class="token class-name">Array</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token function">forEach</span><span class="token punctuation">(</span>item<span class="token punctuation">,</span> res<span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
            res<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> res
<span class="token punctuation">&#125;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'map: '</span><span class="token punctuation">,</span> <span class="token function">forEach</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

]]></content>
      <categories>
        <category>前端</category>
        <category>工具函数</category>
      </categories>
      <tags>
        <tag>前端</tag>
        <tag>面试</tag>
        <tag>工具函数</tag>
        <tag>polyfill</tag>
        <tag>ES6+</tag>
      </tags>
  </entry>
  <entry>
    <title>工具函数系列-节流throttle</title>
    <url>/posts/11528/</url>
    <content><![CDATA[<p>节流的原理是：固定时间间隔执行函数</p>
<p>应用场景：<code>resize</code>、<code>scroll</code></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">throttle</span><span class="token punctuation">(</span><span class="token parameter">func<span class="token punctuation">,</span> wait</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">var</span> timeout<span class="token punctuation">,</span> context<span class="token punctuation">,</span> args<span class="token punctuation">;</span>
    <span class="token keyword">var</span> previous <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

    <span class="token keyword">var</span> <span class="token function-variable function">later</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        previous <span class="token operator">=</span> <span class="token operator">+</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        timeout <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token function">func</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> args<span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

    <span class="token keyword">var</span> <span class="token function-variable function">throttled</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">var</span> now <span class="token operator">=</span> <span class="token operator">+</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//下次触发 func 剩余的时间</span>
        <span class="token keyword">var</span> remaining <span class="token operator">=</span> wait <span class="token operator">-</span> <span class="token punctuation">(</span>now <span class="token operator">-</span> previous<span class="token punctuation">)</span><span class="token punctuation">;</span>
        context <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
        args <span class="token operator">=</span> arguments<span class="token punctuation">;</span>
        <span class="token comment">// 如果没有剩余的时间了或者你改了系统时间</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>remaining <span class="token operator">&lt;=</span> <span class="token number">0</span> <span class="token operator">||</span> remaining <span class="token operator">></span> wait<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>timeout<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token function">clearTimeout</span><span class="token punctuation">(</span>timeout<span class="token punctuation">)</span><span class="token punctuation">;</span>
                timeout <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
            previous <span class="token operator">=</span> now<span class="token punctuation">;</span>
            <span class="token function">func</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>timeout<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            timeout <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span>later<span class="token punctuation">,</span> remaining<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> throttled<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">function</span> <span class="token function">throttle2</span><span class="token punctuation">(</span><span class="token parameter">func<span class="token punctuation">,</span> wait</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">var</span> timeout <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> previous <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">var</span> args <span class="token operator">=</span> arguments<span class="token punctuation">;</span>
        <span class="token keyword">var</span> context <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
        <span class="token keyword">var</span> now <span class="token operator">=</span> <span class="token operator">+</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
        <span class="token keyword">var</span> remainning <span class="token operator">=</span> wait <span class="token operator">-</span> <span class="token punctuation">(</span>now <span class="token operator">-</span> previous<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 等待时间减去两次触发事件的时间差</span>
        timeout <span class="token operator">&amp;&amp;</span> <span class="token function">clearTimeout</span><span class="token punctuation">(</span>timeout<span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>remainning <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">// 两次触发时间差大于等待时间，立马执行</span>
            <span class="token function">func</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> args<span class="token punctuation">)</span>
            previous <span class="token operator">=</span> now <span class="token comment">// 更新时间</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span> <span class="token comment">// 小于等待时间，等待一段时间后执行</span>
            timeout <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token function">func</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> args<span class="token punctuation">)</span>
                provious <span class="token operator">=</span> <span class="token operator">+</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> remainning<span class="token punctuation">)</span> <span class="token comment">// 修改设置timeout时间</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>我们可以看到：鼠标移入，事件立刻执行，晃了 3s，事件再一次执行，当数字变成 3 的时候，也就是 6s 后，我们立刻移出鼠标，停止触发事件，9s 的时候，依然会再执行一次事件。</p>
</blockquote>
<h5 id="优化"><a href="#优化" class="headerlink" title="优化"></a>优化</h5><p>取消第一次执行或者取消最后一次执行</p>
<blockquote>
<p>那我们设置个 options 作为第三个参数，然后根据传的值判断到底哪种效果，我们约定:</p>
<p>leading：false 表示禁用第一次执行<br>trailing: false 表示禁用停止触发的回调</p>
<p>leading和trailing不能同时设置，如果同时设置的话，比如当你将鼠标移出的时候，因为 trailing 设置为 false，停止触发的时候不会设置定时器，所以只要再过了设置的时间，再移入的话，就会立刻执行，就违反了 leading: false，bug 就出来了</p>
</blockquote>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">throttle</span><span class="token punctuation">(</span><span class="token parameter">func<span class="token punctuation">,</span> wait<span class="token punctuation">,</span> options</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">var</span> timeout<span class="token punctuation">,</span> context<span class="token punctuation">,</span> args<span class="token punctuation">;</span>
    <span class="token keyword">var</span> previous <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>options<span class="token punctuation">)</span> options <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span> <span class="token comment">// 设置默认值 可以使用es6设置默认值的方式</span>
    
    <span class="token keyword">var</span> <span class="token function-variable function">later</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        previous <span class="token operator">=</span> options<span class="token punctuation">.</span>leading <span class="token operator">===</span> <span class="token boolean">false</span> <span class="token operator">?</span> <span class="token number">0</span> <span class="token operator">:</span> <span class="token operator">+</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        timeout <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token function">func</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>timeout<span class="token punctuation">)</span> context <span class="token operator">=</span> args <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
    
    <span class="token keyword">var</span> <span class="token function-variable function">throttled</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">var</span> now <span class="token operator">=</span> <span class="token operator">+</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>previous <span class="token operator">&amp;&amp;</span> options<span class="token punctuation">.</span>leading <span class="token operator">===</span> <span class="token boolean">false</span><span class="token punctuation">)</span> previous <span class="token operator">=</span> now<span class="token punctuation">;</span>
        <span class="token keyword">var</span> remainning <span class="token operator">=</span> wait <span class="token operator">-</span> <span class="token punctuation">(</span>now <span class="token operator">-</span> previous<span class="token punctuation">)</span><span class="token punctuation">;</span>
        context <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
        args <span class="token operator">=</span> arguments<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>remainning <span class="token operator">&lt;=</span> <span class="token number">0</span> <span class="token operator">||</span> remainning <span class="token operator">></span> wait<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>timeout<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token function">clearTimeout</span><span class="token punctuation">(</span>timeout<span class="token punctuation">)</span><span class="token punctuation">;</span>
                timeout <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
            previous <span class="token operator">=</span> now<span class="token punctuation">;</span>
            <span class="token function">func</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>timeout<span class="token punctuation">)</span> context <span class="token operator">=</span> args <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>timeout <span class="token operator">&amp;&amp;</span> options<span class="token punctuation">.</span>trailing <span class="token operator">!==</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            timeout <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span>later<span class="token punctuation">,</span> remainning<span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">return</span> throttled
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h5 id="取消"><a href="#取消" class="headerlink" title="取消"></a>取消</h5><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 接上一版</span>
throttled<span class="token punctuation">.</span><span class="token function-variable function">cancel</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token function">clearTimeout</span><span class="token punctuation">(</span>timeout<span class="token punctuation">)</span><span class="token punctuation">;</span>
    previous <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    timeout <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">// ...</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>参考文章：<a href="https://github.com/mqyqingfeng/Blog/issues/26">https://github.com/mqyqingfeng/Blog/issues/26</a></p>
<h5 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h5><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token constant">DOCTYPE</span> html<span class="token operator">></span>
<span class="token operator">&lt;</span>html lang<span class="token operator">=</span><span class="token string">"en"</span><span class="token operator">></span>

<span class="token operator">&lt;</span>head<span class="token operator">></span>
    <span class="token operator">&lt;</span>meta charset<span class="token operator">=</span><span class="token string">"utf-8"</span><span class="token operator">></span>
    <span class="token operator">&lt;</span>meta http<span class="token operator">-</span>equiv<span class="token operator">=</span><span class="token string">"x-ua-compatible"</span> content<span class="token operator">=</span><span class="token string">"IE=edge, chrome=1"</span><span class="token operator">></span>
    <span class="token operator">&lt;</span>title<span class="token operator">></span>debounce<span class="token operator">&lt;</span><span class="token operator">/</span>title<span class="token operator">></span>
    <span class="token operator">&lt;</span>style<span class="token operator">></span>
        #container<span class="token punctuation">&#123;</span>
            <span class="token literal-property property">width</span><span class="token operator">:</span> <span class="token number">100</span><span class="token operator">%</span><span class="token punctuation">;</span> height<span class="token operator">:</span> 200px<span class="token punctuation">;</span> line<span class="token operator">-</span>height<span class="token operator">:</span> 200px<span class="token punctuation">;</span> text<span class="token operator">-</span>align<span class="token operator">:</span> center<span class="token punctuation">;</span> color<span class="token operator">:</span> #fff<span class="token punctuation">;</span> background<span class="token operator">-</span>color<span class="token operator">:</span> #<span class="token number">444</span><span class="token punctuation">;</span> font<span class="token operator">-</span>size<span class="token operator">:</span> 30px<span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>style<span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>head<span class="token operator">></span>

<span class="token operator">&lt;</span>body<span class="token operator">></span>
    <span class="token operator">&lt;</span>div id<span class="token operator">=</span><span class="token string">"container"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
    <span class="token operator">&lt;</span>script<span class="token operator">></span>
        <span class="token keyword">var</span> count <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token keyword">var</span> container <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'container'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">function</span> <span class="token function">getUserAction</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">let</span> num <span class="token operator">=</span> count<span class="token operator">++</span>
            container<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> num<span class="token punctuation">;</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> num<span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

        container<span class="token punctuation">.</span>onmousemove <span class="token operator">=</span> <span class="token function">throttle</span><span class="token punctuation">(</span>getUserAction<span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">function</span> <span class="token function">throttle</span><span class="token punctuation">(</span><span class="token parameter">func<span class="token punctuation">,</span> wait</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">var</span> timeout<span class="token punctuation">,</span> context<span class="token punctuation">,</span> args<span class="token punctuation">,</span> result<span class="token punctuation">;</span>
            <span class="token keyword">var</span> previous <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

            <span class="token keyword">var</span> <span class="token function-variable function">later</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                previous <span class="token operator">=</span> <span class="token operator">+</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                timeout <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
                <span class="token function">func</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> args<span class="token punctuation">)</span>
            <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

            <span class="token keyword">var</span> <span class="token function-variable function">throttled</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token keyword">var</span> now <span class="token operator">=</span> <span class="token operator">+</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">//下次触发 func 剩余的时间</span>
                <span class="token keyword">var</span> remaining <span class="token operator">=</span> wait <span class="token operator">-</span> <span class="token punctuation">(</span>now <span class="token operator">-</span> previous<span class="token punctuation">)</span><span class="token punctuation">;</span>
                context <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
                args <span class="token operator">=</span> arguments<span class="token punctuation">;</span>
                <span class="token comment">// 如果没有剩余的时间了或者你改了系统时间</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>remaining <span class="token operator">&lt;=</span> <span class="token number">0</span> <span class="token operator">||</span> remaining <span class="token operator">></span> wait<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>timeout<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                        <span class="token function">clearTimeout</span><span class="token punctuation">(</span>timeout<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        timeout <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
                    <span class="token punctuation">&#125;</span>
                    previous <span class="token operator">=</span> now<span class="token punctuation">;</span>
                    <span class="token function">func</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>timeout<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    timeout <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span>later<span class="token punctuation">,</span> remaining<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> throttled<span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>body<span class="token operator">></span>

<span class="token operator">&lt;</span><span class="token operator">/</span>html<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

]]></content>
      <categories>
        <category>前端</category>
        <category>工具函数</category>
      </categories>
      <tags>
        <tag>前端</tag>
        <tag>面试</tag>
        <tag>工具函数</tag>
      </tags>
  </entry>
  <entry>
    <title>工具函数系列-获取url参数</title>
    <url>/posts/61137/</url>
    <content><![CDATA[<p>获取 <code>url</code> 中的参数</p>
<ol>
<li>指定参数名称，返回该参数的值 或者 空字符串</li>
<li>不指定参数名称，返回全部的参数对象 或者 {}</li>
<li>如果存在多个同名参数，则返回数组</li>
</ol>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">getUrlParam</span><span class="token punctuation">(</span><span class="token parameter">sUrl<span class="token punctuation">,</span> sKey</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">const</span> params <span class="token operator">=</span> <span class="token punctuation">(</span>sUrl<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'#'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'?'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'&amp;'</span><span class="token punctuation">)</span>
    <span class="token keyword">let</span> res <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>params<span class="token punctuation">.</span>length <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        params<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">const</span> <span class="token punctuation">[</span>key<span class="token punctuation">,</span> value<span class="token punctuation">]</span> <span class="token operator">=</span> item<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'='</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> res<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string">'undefined'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">// 如果res中不存在key</span>
                res<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> value
            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>res<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                res<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> res<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string">'string'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">// 如果已存在且同名</span>
                res<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>res<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">,</span> value<span class="token punctuation">]</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> sKey <span class="token operator">?</span> <span class="token punctuation">(</span>res<span class="token punctuation">[</span>sKey<span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token string">''</span><span class="token punctuation">)</span> <span class="token operator">:</span> res
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">return</span> res
<span class="token punctuation">&#125;</span>

<span class="token function">getUrlParam</span><span class="token punctuation">(</span><span class="token string">'http://www.nowcoder.com?key=1&amp;key=2&amp;key=3&amp;test=4#hehe'</span><span class="token punctuation">,</span> <span class="token string">'key'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>测试：</p>
<p><img src="/posts/61137/1.png" alt="1"></p>
]]></content>
      <categories>
        <category>前端</category>
        <category>工具函数</category>
      </categories>
      <tags>
        <tag>面试</tag>
        <tag>工具函数</tag>
        <tag>基础</tag>
      </tags>
  </entry>
  <entry>
    <title>工具函数系列-防抖debounce</title>
    <url>/posts/54864/</url>
    <content><![CDATA[<p>防抖的<strong>原理</strong>：触发事件，但在事件触发 n 秒后才执行，如果在一个事件触发的 n 秒内又触发了这个事件，那就以新的事件时间为准，n 秒后才执行。总之，就是要等触发完事件 n 秒内不再触发事件，才执行。</p>
<p><strong>应用场景</strong>：<code>input</code>输入</p>
<h4 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h4><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">debounce</span><span class="token punctuation">(</span><span class="token parameter">func<span class="token punctuation">,</span> wait<span class="token punctuation">,</span> immediate</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">var</span> timeout <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">,</span> result<span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">var</span> context <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span> <span class="token comment">// 修改this指向，避免指向window</span>
        <span class="token keyword">var</span> args <span class="token operator">=</span> argumenets<span class="token punctuation">;</span> <span class="token comment">// 传参</span>
        
		<span class="token keyword">if</span> <span class="token punctuation">(</span>timeout<span class="token punctuation">)</span> <span class="token function">clearTimeout</span><span class="token punctuation">(</span>timeout<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 等触发完事件n秒后执行</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>immediate<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">// 立即执行第一次 immediate判断是否立即执行</span>
            <span class="token comment">// 如果已经执行过，不再执行</span>
            <span class="token keyword">var</span> callNow <span class="token operator">=</span> <span class="token operator">!</span>timeout<span class="token punctuation">;</span> <span class="token comment">// !null = true   !12 = false</span>
            timeout <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token function">func</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> args<span class="token punctuation">)</span>
            <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> wait<span class="token punctuation">)</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>callNow<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">// 第一次执行</span>
                result <span class="token operator">=</span> <span class="token function">func</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> args<span class="token punctuation">)</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
            timeout <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token function">func</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> args<span class="token punctuation">)</span>
            <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> wait<span class="token punctuation">)</span>    
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">return</span> result<span class="token punctuation">;</span> <span class="token comment">// 只有立即执行模式才能返回结果</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h4 id="添加取消模式"><a href="#添加取消模式" class="headerlink" title="添加取消模式"></a>添加取消模式</h4><blockquote>
<p>比如说我 debounce 的时间间隔是 10 秒钟，immediate 为 true，这样的话，我只有等 10 秒后才能重新触发事件，现在我希望有一个按钮，点击后，取消防抖，这样我再去触发，就可以又立刻执行了</p>
</blockquote>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">debounce</span><span class="token punctuation">(</span><span class="token parameter">func<span class="token punctuation">,</span> wait<span class="token punctuation">,</span> immediate</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">var</span> timeout <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">,</span> result<span class="token punctuation">;</span>
    <span class="token keyword">var</span> <span class="token function-variable function">debocunced</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">var</span> context <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
        <span class="token keyword">var</span> args <span class="token operator">=</span> arguments<span class="token punctuation">;</span>
        
        <span class="token keyword">if</span> <span class="token punctuation">(</span>timeout<span class="token punctuation">)</span> <span class="token function">clearTimeout</span><span class="token punctuation">(</span>timeout<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>immediate<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">var</span> callNow <span class="token operator">=</span> <span class="token operator">!</span>timeout<span class="token punctuation">;</span>
            timeout <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token function">func</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> args<span class="token punctuation">)</span>
            <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> wait<span class="token punctuation">)</span>
            result <span class="token operator">=</span> callNow <span class="token operator">?</span> <span class="token function">func</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> args<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
            timeout <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token function">func</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> args<span class="token punctuation">)</span>
            <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> wait<span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">return</span> result<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    debounced<span class="token punctuation">.</span><span class="token function-variable function">cancel</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token function">clearTimeout</span><span class="token punctuation">(</span>timeout<span class="token punctuation">)</span>
        timeout <span class="token operator">=</span> <span class="token keyword">null</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">return</span> debounced<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>参考文章：<a href="https://github.com/mqyqingfeng/Blog/issues/22">https://github.com/mqyqingfeng/Blog/issues/22</a></p>
<h4 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h4><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token constant">DOCTYPE</span> html<span class="token operator">></span>
<span class="token operator">&lt;</span>html lang<span class="token operator">=</span><span class="token string">"en"</span><span class="token operator">></span>

<span class="token operator">&lt;</span>head<span class="token operator">></span>
    <span class="token operator">&lt;</span>meta charset<span class="token operator">=</span><span class="token string">"utf-8"</span><span class="token operator">></span>
    <span class="token operator">&lt;</span>meta http<span class="token operator">-</span>equiv<span class="token operator">=</span><span class="token string">"x-ua-compatible"</span> content<span class="token operator">=</span><span class="token string">"IE=edge, chrome=1"</span><span class="token operator">></span>
    <span class="token operator">&lt;</span>title<span class="token operator">></span>debounce<span class="token operator">&lt;</span><span class="token operator">/</span>title<span class="token operator">></span>
    <span class="token operator">&lt;</span>style<span class="token operator">></span>
        #container<span class="token punctuation">&#123;</span>
            <span class="token literal-property property">width</span><span class="token operator">:</span> <span class="token number">100</span><span class="token operator">%</span><span class="token punctuation">;</span> height<span class="token operator">:</span> 200px<span class="token punctuation">;</span> line<span class="token operator">-</span>height<span class="token operator">:</span> 200px<span class="token punctuation">;</span> text<span class="token operator">-</span>align<span class="token operator">:</span> center<span class="token punctuation">;</span> color<span class="token operator">:</span> #fff<span class="token punctuation">;</span> background<span class="token operator">-</span>color<span class="token operator">:</span> #<span class="token number">444</span><span class="token punctuation">;</span> font<span class="token operator">-</span>size<span class="token operator">:</span> 30px<span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>style<span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>head<span class="token operator">></span>

<span class="token operator">&lt;</span>body<span class="token operator">></span>
    <span class="token operator">&lt;</span>div id<span class="token operator">=</span><span class="token string">"container"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
    <span class="token operator">&lt;</span>script<span class="token operator">></span>
        <span class="token keyword">var</span> count <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token keyword">var</span> container <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'container'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">function</span> <span class="token function">getUserAction</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">let</span> num <span class="token operator">=</span> count<span class="token operator">++</span>
            container<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> num<span class="token punctuation">;</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> num<span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

        container<span class="token punctuation">.</span>onmousemove <span class="token operator">=</span> <span class="token function">debounce</span><span class="token punctuation">(</span>getUserAction<span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// function debounce()...</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>body<span class="token operator">></span>

<span class="token operator">&lt;</span><span class="token operator">/</span>html<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

]]></content>
      <categories>
        <category>前端</category>
        <category>工具函数</category>
      </categories>
      <tags>
        <tag>前端</tag>
        <tag>面试</tag>
        <tag>工具函数</tag>
      </tags>
  </entry>
  <entry>
    <title>高性能HTML5</title>
    <url>/posts/15602/</url>
    <content><![CDATA[<blockquote>
<p>《高性能HTML5》读书笔记</p>
</blockquote>
<h3 id="面试题"><a href="#面试题" class="headerlink" title="面试题"></a>面试题</h3><h4 id="页面渲染优化"><a href="#页面渲染优化" class="headerlink" title="页面渲染优化"></a>页面渲染优化</h4><ul>
<li>HTML文档结构层次尽量少，最好不深于六层；</li>
<li>脚本加载放在；</li>
<li>少量首屏样式内联放在标签内；</li>
<li>样式结构层次尽量简单；</li>
<li>在脚本中尽量减少DOM操作，尽量缓存访问DOM的样式信息，避免过度触发回流；</li>
<li>减少通过JavaScript代码修改元素样式，尽量使用修改class名方式操作样式或动画；</li>
<li>动画尽量使用在绝对定位或固定定位的元素上；</li>
<li>隐藏在屏幕外，或在页面滚动时，尽量停止动画；</li>
<li>尽量缓存DOM查找，查找器尽量简洁；</li>
<li>涉及多域名的网站，可以开启域名预解析</li>
</ul>
]]></content>
      <categories>
        <category>前端</category>
      </categories>
      <tags>
        <tag>前端</tag>
        <tag>面试</tag>
        <tag>优化</tag>
        <tag>读书笔记</tag>
      </tags>
  </entry>
  <entry>
    <title>页面性能优化</title>
    <url>/posts/56778/</url>
    <content><![CDATA[<h3 id="参考链接："><a href="#参考链接：" class="headerlink" title="参考链接："></a>参考链接：</h3><p><a href="https://segmentfault.com/a/1190000038413073">前端性能优化之图片懒加载 - segmentfault</a></p>
<p><a href="https://web.dev/fast/#prioritize-resources">https://web.dev/fast/#prioritize-resources</a></p>
<p><a href="https://github.com/fi3ework/blog/issues/16">前端性能优化之关键路径渲染优化</a></p>
]]></content>
      <categories>
        <category>前端</category>
      </categories>
      <tags>
        <tag>前端</tag>
        <tag>面试</tag>
        <tag>性能</tag>
      </tags>
  </entry>
  <entry>
    <title>高级函数-thunk</title>
    <url>/posts/4848/</url>
    <content><![CDATA[<p>形实转换程序。JavaScript中的thunk是指一个用于调用另外一个函数的函数，没有任何参数。换句话说，用一个函数定义封装函数调用，包括需要的任何参数，来定义这个调用的执行，那么这个封装函数就是一个形实转换程序。</p>
<p>同步<code>thunk</code>：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token parameter">x<span class="token punctuation">,</span>y</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	<span class="token keyword">return</span> x <span class="token operator">+</span> y<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">function</span> <span class="token function">fooThunk</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	<span class="token keyword">return</span> <span class="token function">foo</span><span class="token punctuation">(</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 稍后</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> <span class="token function">fooThunk</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">// 7</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>异步<code>thunk</code>：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token parameter">x<span class="token punctuation">,</span>y<span class="token punctuation">,</span>cb</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token function">cb</span><span class="token punctuation">(</span> x <span class="token operator">+</span> y <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">1000</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">function</span> <span class="token function">fooThunk</span><span class="token punctuation">(</span><span class="token parameter">cb</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token function">foo</span><span class="token punctuation">(</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> cb <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 稍后</span>

<span class="token function">fooThunk</span><span class="token punctuation">(</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">sum</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> sum <span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">// 7</span>
<span class="token punctuation">&#125;</span> <span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>封装<code>thunk</code>工具函数：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">thunkify</span><span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	<span class="token keyword">var</span> args <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span> arguments<span class="token punctuation">,</span> <span class="token number">1</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">cb</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
		args<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span> cb <span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token function">fn</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span> <span class="token keyword">null</span><span class="token punctuation">,</span> args <span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">var</span> fooThunk <span class="token operator">=</span> <span class="token function">thunkify</span><span class="token punctuation">(</span> foo<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 稍后</span>

<span class="token function">fooThunk</span><span class="token punctuation">(</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">sum</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> sum <span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">// 7</span>
<span class="token punctuation">&#125;</span> <span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><code>thunk</code>工厂，产生一个生成<code>thunk</code>的函数：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// thunk + factory = thunkory</span>
<span class="token keyword">function</span> <span class="token function">thunkify</span><span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	<span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
		<span class="token keyword">var</span> args <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span> arguments <span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">cb</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
			args<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span> cb <span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">return</span> <span class="token function">fn</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span> <span class="token keyword">null</span><span class="token punctuation">,</span> args <span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 用法</span>
<span class="token keyword">var</span> whatIsThis <span class="token operator">=</span> <span class="token function">thunkify</span><span class="token punctuation">(</span> foo <span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> fooThunk <span class="token operator">=</span> <span class="token function">whatIsThis</span><span class="token punctuation">(</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 稍后</span>

<span class="token function">fooThunk</span><span class="token punctuation">(</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">sum</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> sum <span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">// 7</span>
<span class="token punctuation">&#125;</span> <span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>在程序开头构造<code>thunkory</code>来封装已有的<code>API</code>方法，并在需要<code>thunk</code>时可以传递和调用这些<code>thunkory</code>，是很有用的。两个独立的步骤保留了一个更清晰的功能分离。</p>
]]></content>
      <categories>
        <category>前端</category>
        <category>高级函数</category>
      </categories>
      <tags>
        <tag>前端</tag>
        <tag>技巧</tag>
        <tag>面试</tag>
        <tag>函数</tag>
        <tag>高级函数</tag>
      </tags>
  </entry>
  <entry>
    <title>高级函数-闭包</title>
    <url>/posts/50394/</url>
    <content><![CDATA[<h3 id="什么是闭包"><a href="#什么是闭包" class="headerlink" title="什么是闭包"></a>什么是闭包</h3><p><strong>闭包是指有权访问另一个函数作用域中的变量的函数。</strong></p>
<p><strong>创建闭包的常见方式：在函数内部创建另一个函数。</strong></p>
<p>当函数可以记住并访问所在的词法作用域时，就产生了<strong>闭包</strong>，即使函数是在当前词法作用域之外执行。</p>
<p>简单来说，<strong>闭包是保存了执行环境的上下文的函数</strong>。</p>
<blockquote>
<p>词法作用域意味着作用域是由书写代码时函数声明的位置来决定的。</p>
<p>编译的词法分析阶段基本能够知道全部标识符在哪里以及是如何声明的，从而能够预测在执行过程中如何对它们进行查找。</p>
</blockquote>
<p><strong>闭包阻止了垃圾回收器释放外部函数的执行空间。</strong>参数和变量不会被垃圾回收机制回收。</p>
<blockquote>
<p>即使外部函数栈内存已经释放闭包依旧存在。</p>
<p>为什么不会被垃圾回收机制回收：</p>
<p>首先 JS 垃圾回收机制中，如果一个对象不再被引用，那么这个对象就会被垃圾机制回收，如果两个对象相互引用，而不在被第三方引用，那么这两个对象就会被垃圾回收机制回收。</p>
<p>因为闭包中，父函数被子函数引用，子函数又被外部所引用，这就是父函数不被回收的原因。</p>
</blockquote>
<p>经典闭包：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
    <span class="token keyword">function</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">return</span> bar<span class="token punctuation">;</span> <span class="token comment">// 将bar所应用的函数对象本身当作返回值</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">var</span> baz <span class="token operator">=</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 实际上只是通过不同的标识符引用调用了内部的函数bar</span>
<span class="token function">baz</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 闭包</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>通常，<code>foo()</code>执行结束后，垃圾回收器会释放不在使用的内存空间，但是因为<code>foo()</code>内部<code>bar()</code>仍在使用<code>foo()</code>的内部作用域，因此<code>foo()</code>不会被回收。<code>bar()</code>依然持有对该作用域的引用，而这个引用就叫做闭包。<code>baz()</code>被调用是可以访问被定义时的词法作用域。</p>
<p><strong>闭包使得函数可以继续访问定义时的词法作用域。</strong></p>
<p><strong>无论通过何种手段将内部函数传递到所在的词法作用域以外，闭包都会持有对原始定义作用域的引用，无论在何处执行这个函数都会使用闭包。</strong>例如：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> fn<span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
    <span class="token keyword">function</span> <span class="token function">baz</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    fn <span class="token operator">=</span> baz<span class="token punctuation">;</span> <span class="token comment">// 将baz分配给全局变量，但baz仍可以访问foo的作用域</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">function</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 闭包</span>
<span class="token punctuation">&#125;</span>
<span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 2</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>闭包作用可以避免变量全局污染</strong>，例如：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">y</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> x <span class="token operator">+</span> y
    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">var</span> addFun1 <span class="token operator">=</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> addFun2 <span class="token operator">=</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">addFun1</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">//6</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">addFun2</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">//11</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><code>addFun1</code> 和 <code>addFun2</code> 拥有自己的内部的变量，相关应用有 <code>vue</code> 组件用函数返回对象的方式定义 <code>data</code>，这样可以避免组件复用的时候 其中一个组件<code>data</code> 修改影响到其他组件。</p>
<p><strong>回调函数和<code>IIFE</code>是闭包的一种。</strong></p>
<p>立即执行函数的好处：通过定义一个匿名函数，创建了一个新的函数作用域，相当于创建了一个“私有”的命名空间，该空间的变量和方法，不会破坏和污染全局的命名空间。</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">3</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token comment">//使用IIFE</span>
    <span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">i</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">return</span> i<span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 0</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 1</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 2</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h4 id="闭包访问值范围："><a href="#闭包访问值范围：" class="headerlink" title="闭包访问值范围："></a>闭包访问值范围：</h4><ul>
<li>闭包可以访问当前函数以外的变量。</li>
<li>即使外部函数已经返回，闭包仍能访问外部函数定义的变量与参数。</li>
<li>闭包可以更新外部变量的值。</li>
<li>内层函数可以访问外层作用域。</li>
</ul>
<h3 id="闭包的应用"><a href="#闭包的应用" class="headerlink" title="闭包的应用"></a>闭包的应用</h3><ul>
<li>避免全局变量的污染。</li>
<li>能够读取函数内部的变量。</li>
<li>可以在内存中维护一个变量。（大型框架和库常用闭包进行数据传递）</li>
</ul>
<p>应用场景：</p>
<p>闭包通常用来创建内部变量，使得这些变量不能被外部随意修改，同时又可以通过指定的函数接口来操作。例如 <code>setTimeout</code> 传参、回调、IIFE、<a href="https://datura35422.github.io/posts/54864/">函数防抖</a>、<a href="https://datura35422.github.io/posts/11528/">节流</a>、<a href="https://datura35422.github.io/posts/22570/">柯里化</a>、模块化等等</p>
<h4 id="模块机制"><a href="#模块机制" class="headerlink" title="模块机制"></a>模块机制</h4><p>模块模式：</p>
<ol>
<li>必须有外部的封闭函数，该函数必须至少被调用一次。</li>
<li>封闭函数必须返回至少一个内部函数，这样内部函数才能在私有作用域中形成闭包，并且可以访问或修改私有的状态。</li>
</ol>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> MyModules <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">Manager</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">var</span> modules <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

    <span class="token keyword">function</span> <span class="token function">define</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> deps<span class="token punctuation">,</span> impl</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> deps<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            deps<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> modules<span class="token punctuation">[</span>deps<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span>
        <span class="token punctuation">&#125;</span>
        <span class="token comment">// 为了模块的定义引入了包装函数（可以传入任何依赖），并且将返回值（模块的API），储存在一个根据名字来管理的模块列表中</span>
        modules<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">impl</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>impl<span class="token punctuation">,</span> deps<span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">function</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> modules<span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>
        <span class="token literal-property property">define</span><span class="token operator">:</span> define<span class="token punctuation">,</span>
        <span class="token literal-property property">get</span><span class="token operator">:</span> get
    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 单例模式 - 当只需要一个实例时</span>

MyModules<span class="token punctuation">.</span><span class="token function">define</span><span class="token punctuation">(</span><span class="token string">'bar'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">function</span> <span class="token function">hello</span><span class="token punctuation">(</span><span class="token parameter">who</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token string">'Let me introduce: '</span> <span class="token operator">+</span> who<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>
        <span class="token literal-property property">hello</span><span class="token operator">:</span> hello
    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

MyModules<span class="token punctuation">.</span><span class="token function">define</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'bar'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">bar</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">var</span> hungry <span class="token operator">=</span> <span class="token string">'hippo'</span><span class="token punctuation">;</span>
    <span class="token keyword">function</span> <span class="token function">awesome</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>bar<span class="token punctuation">.</span><span class="token function">hello</span><span class="token punctuation">(</span>hungry<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>
        <span class="token literal-property property">awesome</span><span class="token operator">:</span> awesome
    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> bar <span class="token operator">=</span> MyModules<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'bar'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> foo <span class="token operator">=</span> MyModules<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>bar<span class="token punctuation">.</span><span class="token function">hello</span><span class="token punctuation">(</span><span class="token string">'hippo'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Let me introduce: hippo</span>
foo<span class="token punctuation">.</span><span class="token function">awesome</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// LET ME INTRODUCE: HIPPO</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>调用包装了函数定义的包装函数，并且将返回值作为该模块的API。</p>
</blockquote>
<h3 id="闭包的缺点"><a href="#闭包的缺点" class="headerlink" title="闭包的缺点"></a>闭包的缺点</h3><ul>
<li><p>维护难度加大： 闭包内部是可以访问上级作用域，改变上级作用域的私有变量，我们使用的使用一定要小心，不要随便改变上级作用域私有变量的值。</p>
</li>
<li><p>内存泄漏：由于闭包会使得函数中的变量都保存在内存中，内存消耗很大，所以不能滥用闭包，否则会造成网页的性能问题，在IE中可能导致内存泄漏。解决方法是，在退出函数之前，将不使用的局部变量全部删除（引用设置为 <code>null</code> ，这样就解除了对这个变量的引用，其引用计数也会减少，从而确保其内存可以在适当的时机回收）</p>
<blockquote>
<p>程序的运行需要内存。对于持续运行的服务进程，必须及时释放不再用到的内存，否则占用越来越高，轻则影响系统性能，重则导致进程崩溃。不再用到的内存，没有及时释放，就叫做内存泄漏</p>
</blockquote>
</li>
<li><p>this 指向：闭包的 this 指向为 window / global</p>
</li>
</ul>
<h3 id="面试题"><a href="#面试题" class="headerlink" title="面试题"></a>面试题</h3><ol>
<li><p>for 循环输出 index</p>
</li>
<li><p>题目：<a href="https://github.com/Advanced-Frontend/Daily-Interview-Question/issues/455">https://github.com/Advanced-Frontend/Daily-Interview-Question/issues/455</a></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> <span class="token function-variable function">foo</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> 
    <span class="token comment">// 要求实现函数体</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">var</span> f1 <span class="token operator">=</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span> f1<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">// 6 输出是参数的和</span>

<span class="token keyword">var</span> f2 <span class="token operator">=</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span> f2<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">// 6</span>

<span class="token keyword">var</span> f3 <span class="token operator">=</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span> f3<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">// 10</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>解答：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token function-variable function">target</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>arg1s</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token operator">...</span><span class="token punctuation">[</span><span class="token operator">...</span>args<span class="token punctuation">,</span> <span class="token operator">...</span>arg1s<span class="token punctuation">]</span><span class="token punctuation">)</span>
  target<span class="token punctuation">.</span><span class="token function-variable function">getValue</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> args<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">p<span class="token punctuation">,</span> n</span><span class="token punctuation">)</span> <span class="token operator">=></span> p<span class="token operator">+</span> n<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> target
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>个人认为这是用的递归。</p>
</li>
</ol>
<h3 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h3><p><a href="https://github.com/Advanced-Frontend/Daily-Interview-Question/issues/453">第165题：闭包的使用场景，使用闭包需要注意什么</a></p>
]]></content>
      <categories>
        <category>前端</category>
        <category>高级函数</category>
      </categories>
      <tags>
        <tag>前端</tag>
        <tag>技巧</tag>
        <tag>面试</tag>
        <tag>函数</tag>
        <tag>高级函数</tag>
      </tags>
  </entry>
  <entry>
    <title>代码规范</title>
    <url>/posts/35373/</url>
    <content><![CDATA[<blockquote>
<p>《JavaScript高级程序设计(第3版) 24章》</p>
</blockquote>
<h4 id="可维护性"><a href="#可维护性" class="headerlink" title="可维护性"></a>可维护性</h4><h5 id="特征"><a href="#特征" class="headerlink" title="特征"></a>特征</h5><p>可理解性、直观性、可适应性、可扩展性、可调试性。</p>
<h5 id="可读性"><a href="#可读性" class="headerlink" title="可读性"></a>可读性</h5><p>缩进 + 注释</p>
<ul>
<li><strong>函数和方法</strong>——每个函数或方法都应该包含一个注释，描述其目的和用于完成任务所可能使用的算法。</li>
<li><strong>大段代码</strong>——用于完成单个任务的多行代码应该在前面放一个描述任务的注释。</li>
<li><strong>复杂的算法</strong>——如果使用了一种独特的方式解决某个问题，则要在注释中解释你是如何做的。</li>
<li><strong>Hack</strong>——因为存在浏览器差异，JavaScript代码一般会包含一些hack。</li>
</ul>
<p>注释</p>
<ul>
<li>没有注释的代码不是最优的。</li>
<li>过多注释（比如每行一个）可能是拙劣代码的征兆。</li>
<li>代码应该解释为什么，而非是什么。如果编写的代码特别容易令人迷惑的话，那么注释也可以解释一下实现原理。</li>
</ul>
<h5 id="变量和函数命名"><a href="#变量和函数命名" class="headerlink" title="变量和函数命名"></a>变量和函数命名</h5><p>适当给变量和函数起名字对于增加代码可理解性和可维护性是非常重要的。</p>
<p>命名规则：</p>
<ul>
<li>变量名应为名词。</li>
<li>函数名应该以动词开始，如<code>getName()</code>。返回布尔类型值的函数一般以<code>is</code>开头，如<code>isEnable()</code>。</li>
<li>变量和函数都应使用合乎逻辑的名字，不要担心长度。</li>
</ul>
<p>命名参考链接：</p>
<p><a href="https://unbug.github.io/codelf/">https://unbug.github.io/codelf</a><a href="https://unbug.github.io/codelf/">/</a></p>
<p><a href="https://github.com/kettanaito/naming-cheatsheet">https://github.com/kettanaito/naming-cheatsheet</a></p>
<h5 id="变量类型透明"><a href="#变量类型透明" class="headerlink" title="变量类型透明"></a>变量类型透明</h5><p>初始化指定，常用方式。初始化为一个特定的数据类型可以很好的指明变量的类型。但缺点是它无法用于函数声明中的函数参数。</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 通过初始化指定变量类型</span>
<span class="token keyword">var</span> found <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span> <span class="token comment">// 布尔型</span>
<span class="token keyword">var</span> count <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// 数字</span>
<span class="token keyword">var</span> name <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span> <span class="token comment">// 字符串</span>
<span class="token keyword">var</span> person <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span> <span class="token comment">// 对象</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h5 id="松散耦合"><a href="#松散耦合" class="headerlink" title="松散耦合"></a>松散耦合</h5><h6 id="解耦HTML-JavaScript"><a href="#解耦HTML-JavaScript" class="headerlink" title="解耦HTML/JavaScript"></a>解耦HTML/JavaScript</h6><p><code>HTML</code>和<code>JavaScript</code>应该完全分离，并通过外部文件和使用<code>DOM</code>附加行为来包含<code>JavaScript</code>。一般来说，应该避免在<code>JavaScript</code>中创建大量<code>HTML</code>。<code>HTML</code>呈现应该尽可能与<code>JavaScript</code>保持分离。当<code>JavaScript</code>用于插入数据时，尽量不要直接插入标记。一般可以在页面中直接包含并隐藏标记，然后等到整个页面渲染好之后，就可以用<code>JavaScript</code>显示该标记，而非生成它。</p>
<h6 id="解耦CSS-JavaScript"><a href="#解耦CSS-JavaScript" class="headerlink" title="解耦CSS/JavaScript"></a>解耦CSS/JavaScript</h6><p>通过只修改某个元素的<code>CSS</code>类，就可以让大部分样式信息严格保留在<code>CSS</code>中。<code>JavaScript</code>可以更改样式类，但并不会直接影响到元素的样式。</p>
<h6 id="解耦应用逻辑-事件处理程序"><a href="#解耦应用逻辑-事件处理程序" class="headerlink" title="解耦应用逻辑/事件处理程序"></a>解耦应用逻辑/事件处理程序</h6><p>将应用逻辑和事件处理程序相分离，这样两者分别处理各自的东西。一个事件处理程序应该从事件对象中提取相关信息，并将这些信息传送到处理应用逻辑的某个方法中。</p>
<p><strong>应用与业务逻辑之间松散耦合的原则</strong>：</p>
<ul>
<li>勿将event对象传给其他方法；只传来自event对象中所需的数据；</li>
<li>任何可以在应用层面的动作都应该可以在不执行任何事件处理程序的情况下进行；</li>
<li>任何事件处理程序都应该处理事件，然后将处理转交给应用逻辑。</li>
</ul>
<h5 id="编程实践"><a href="#编程实践" class="headerlink" title="编程实践"></a>编程实践</h5><h6 id="尊重对象所有权"><a href="#尊重对象所有权" class="headerlink" title="尊重对象所有权"></a>尊重对象所有权</h6><ul>
<li>不要为实例或原型添加属性；</li>
<li>不要为实例或原型添加方法；</li>
<li>不要重定义已存在的方法。</li>
<li>创建包含所需功能的新对象，并用它与相关对象进行交互；</li>
<li>创建自定义类型，继承需要进行修改的类型。然后可以为自定义类型添加额外功能。</li>
</ul>
<h6 id="避免全局变量"><a href="#避免全局变量" class="headerlink" title="避免全局变量"></a>避免全局变量</h6><p>最多创建一个全局变量，让其他对象和函数存在其中。用这种方式将功能组合在一起的对象，叫做命名空间。命名空间很重要的一部分是确定每个人都同意使用的全局对象的名字，并且尽可能唯一，让其他人不太可能也使用这个名字。</p>
<p>命名空间有助于确保代码可以在同一个页面上与其他代码以无害的方式一起工作。</p>
<h6 id="避免与null进行比较"><a href="#避免与null进行比较" class="headerlink" title="避免与null进行比较"></a>避免与null进行比较</h6><p>现实中，与null比较很少适合情况而被使用。必须按照所期望的对值进行检查，而非按照不被期望的那些。</p>
<p><strong>替换与null进行比较</strong>：</p>
<ul>
<li>如果值应为一个引用类型，使用<code>instanceof</code>操作符检查其构造函数；</li>
<li>如果值应为一个基本类型，使用<code>typeof</code>检查其类型；</li>
<li>如果是希望对象包含某个特定的方法名，则使用<code>typeof</code>操作符确保指定名字的方法存在于对象上。</li>
</ul>
<h6 id="使用常量"><a href="#使用常量" class="headerlink" title="使用常量"></a>使用常量</h6><p>可以通过将数据抽取出来变成单独定义的常量的方式，将应用逻辑与数据修改隔离开来。</p>
<p>关键在于将数据和使用它的逻辑进行分离。注意事项：</p>
<ul>
<li><strong>重复值</strong>——任何在多处用到的值都应抽取为一个常量。</li>
<li><strong>用户界面字符串</strong>——任何用于显示给用户的字符串，都应被抽取出来以方便国际化。</li>
<li>**<code>URLs</code>**——在Web应用中，资源位置很容易变更，所以推荐用一个公共地方存放所有的URL。</li>
<li><strong>任意可能会更改的值</strong>——每当你在用到字面量值的时候，你都要问一下自己这个值在未来是不是会变化。</li>
</ul>
<h4 id="性能"><a href="#性能" class="headerlink" title="性能"></a>性能</h4><h5 id="注意作用域"><a href="#注意作用域" class="headerlink" title="注意作用域"></a>注意作用域</h5><p>访问全局变量总是要比访问局部变量慢，因为需要遍历作用域链。只要能减少花费在作用域链上的时间，就能增加脚本的整体性能。</p>
<h6 id="避免全局查找"><a href="#避免全局查找" class="headerlink" title="避免全局查找"></a>避免全局查找</h6><p>可能优化脚本性能最重要的就是注意全局查找。使用全局变量和函数肯定要比局部的开销更大，因为要涉及作用域链上的查找。</p>
<p><strong>将在一个函数中会用到多次的全局对象存储为局部变量使用</strong>。</p>
<h6 id="避免with语句"><a href="#避免with语句" class="headerlink" title="避免with语句"></a>避免with语句</h6><p>和函数类似，with语句会创建自己的作用域，因此会增加其中执行的代码的作用域链的长度。由于额外的作用域链查找，在with语句中执行的代码肯定会比外面执行的代码要慢。</p>
<p>必须使用with语句的情况很少，因为它主要用于消除额外的字符。在大多数情况下，<strong>可以用局部变量完成相同的事情而不引入新的作用域</strong>。</p>
<h5 id="选择正确方法"><a href="#选择正确方法" class="headerlink" title="选择正确方法"></a>选择正确方法</h5><h6 id="避免不必要的属性查找"><a href="#避免不必要的属性查找" class="headerlink" title="避免不必要的属性查找"></a>避免不必要的属性查找</h6><p><strong>使用变量和数组（O(1)操作）要比访问对象上的属性（O(n)操作）更有效率</strong>。对象上的任何属性查找都要比访问变量或者数组花费更长时间，因为必须在原型链中对拥有该名称的属性进行一次搜索。简而言之，属性查找越多，执行时间就越长。</p>
<p>进行一两次属性查找并不会导致显著的性能问题，但是进行成百上千次则肯定会减慢执行速度。</p>
<p><strong>注意获取单个值的多重属性查找</strong>。</p>
<p>一般来讲，只要能减少算法的复杂度，就要尽可能减少。<strong>尽可能多地使用局部变量将属性查找替换为值查找</strong>。进一步讲，如果即可以用数字化的数组位置进行访问，也可以使用命名属性（诸如<code>NodeList</code>对象），那么使用数字位置。</p>
<h6 id="优化循环"><a href="#优化循环" class="headerlink" title="优化循环"></a>优化循环</h6><p>循环的基本优化步骤：</p>
<ol>
<li><strong>简化终止条件</strong>——由于每次循环过程都会计算终止条件，所以必须保证它尽可能快。也就是说避免属性查找或其他O(n)的操作。</li>
<li><strong>简化循环体</strong>——循环体是执行最多的，所以要确保其被最大限度地优化。确保没有某些可以被很容易移出循环的密集计算。</li>
<li><strong>使用后测试循环</strong>——最常用<code>for</code>循环和<code>while</code>循环都是前测试循环。而如<code>do-while</code>这种后测试循环，可以避免最初终止条件的计算，因此运行更快。如<u>将终止条件和自减操作符组合成了单个语句</u>。</li>
</ol>
<blockquote>
<p>减少<code>length</code>计算。记住使用“后测试”循环时必须确保要处理的值至少有一个。空数组会导致多余的一次循环而“前测试”循环则可以避免。</p>
</blockquote>
<h6 id="展开循环"><a href="#展开循环" class="headerlink" title="展开循环"></a>展开循环</h6><p><code>Duff</code>装置</p>
<p>针对大数据集使用展开循环可以节省很多时间，但对于小数据集，额外的开销则可能得不偿失。它是要花更多的代码来完成同样的任务，如果处理的不是大数据集，一般来说并不值得。</p>
<h6 id="性能的其他注意事项"><a href="#性能的其他注意事项" class="headerlink" title="性能的其他注意事项"></a>性能的其他注意事项</h6><ul>
<li><strong>原生方法较快</strong>——<strong>只要有可能，使用原生方法而不是自己用JavaScript重写一个</strong>。原生方法是用诸如C/C++之类的编译型语言写出来的，所以要比JavaScript的快很多很多。JavaScript中最容易被忘记的就是可以在<u>Math对象中找到的复杂的数学运算</u>；这些方法要比任何用JavaScript写的同样方法如正弦、余弦快的多。</li>
<li><strong>Switch语句较快</strong>——<strong>如果有一系列复杂的if-else语句，可以转换成单个switch语句则可以得到更快的代码</strong>。还可以通过将case语句按照最可能的到最不可能的顺序进行组织，来进一步优化switch语句。</li>
<li><strong>位运算符较快</strong>——<strong>当进行数学运算的时候，位运算操作要比任何布尔运算或者算数运算快</strong>。选择性地用位运算替换算数运算可以极大提升复杂计算的性能。诸如<u>取模，逻辑与和逻辑或都可以考虑用位运算来替换</u>。</li>
</ul>
<h5 id="最小化语句数"><a href="#最小化语句数" class="headerlink" title="最小化语句数"></a>最小化语句数</h5><p>JavaScript代码中的语句数量也影响所执行的操作的速度。完成多个操作的单个语句要比完成单个操作的多个语句快。所以，就要找出可以组合在一起的语句，以减少脚本整体的执行时间。</p>
<h6 id="多个变量声明"><a href="#多个变量声明" class="headerlink" title="多个变量声明"></a>多个变量声明</h6><p>变量声明只用了一个var语句，之间由逗号隔开。在大多数情况下这种优化都非常容易做，并且要比单个变量分别声明快很多。</p>
<h6 id="插入迭代值"><a href="#插入迭代值" class="headerlink" title="插入迭代值"></a>插入迭代值</h6><p>当使用迭代值（也就是在不同的位置进行增加或减少的值）的时候，尽可能合并语句。</p>
<h6 id="使用数组和对象字面量"><a href="#使用数组和对象字面量" class="headerlink" title="使用数组和对象字面量"></a>使用数组和对象字面量</h6><p>两种创建数组和对象的方法：使用构造函数或者是使用字面量。使用构造函数总是要用到更多的语句来插入元素或者定义属性，而字面量可以将这些操作在一个语句中完成。</p>
<p>尽量使用数组和对象的字面量表达方式来消除不必要的语句。</p>
<h5 id="优化DOM交互"><a href="#优化DOM交互" class="headerlink" title="优化DOM交互"></a>优化DOM交互</h5><h6 id="最小化现场更新"><a href="#最小化现场更新" class="headerlink" title="最小化现场更新"></a>最小化现场更新</h6><p>现场更新，是因为需要立即（现场）对页面对用户的显示进行更新。每一个更改，不管是插入单个字符，还是移除整个片段，都有一个性能惩罚，因为浏览器要重新计算无数尺寸以进行更新。现场更新进行得越多，代码完成执行所花的时间就越长；完成一个操作所需的现场更新越少，代码就越快。</p>
<p>使用文档片段(<code>document.createDocumentFragment()</code>)来构建DOM结构，接着将其添加到待插入DOM元素中。</p>
<p><strong>一旦需要更新DOM，请考虑使用文档片段来构建DOM结构，然后再将其添加到现存的文档中。</strong></p>
<h6 id="使用innerHTML"><a href="#使用innerHTML" class="headerlink" title="使用innerHTML"></a>使用<code>innerHTML</code></h6><p>有两种在页面上创建DOM节点的方法：使用诸如<code>createElement()</code>和<code>appendChild()</code>之类的DOM方法，以及使用<code>innerHTML</code>。对于小的DOM更改而言，两种方法效率都差不多。然而，对于大的DOM更改，使用<code>innerHTML</code>要比使用标准DOM方法创建同样的DOM结构快得多。</p>
<p>当把<code>innerHTML</code>设置为某个值时，后台会创建一个HTML解析器，然后使用内部的DOM调用来创建DOM结构，而非基于JavaScript的DOM调用。由于内部方法是编译好的而非解释执行的，所以执行快得多。</p>
<blockquote>
<p>使用<code>innerHTML</code>可以提升性能，但也会暴露巨大的<code>XSS</code>攻击面。</p>
</blockquote>
<h6 id="使用事件委托"><a href="#使用事件委托" class="headerlink" title="使用事件委托"></a>使用事件委托</h6><p>当把<code>innerHTML</code>设置为某个值时，后台会创建一个HTML解析器，然后使用内部的DOM调用来创建DOM结构，而非基于JavaScript的DOM调用。由于内部方法是编译好的而非解释执行的，所以执行快得多。</p>
<p>事件委托利用了事件冒泡。任何可以冒泡的事件都不仅仅可以在事件目标上进行处理，目标的任何祖先节点上也能处理。使用这个知识，就可以将事件处理程序附加到更高层的地方负责多个目标的事件处理。如果可能，在文档级别附加事件处理程序，这样可以处理整个页面的事件。</p>
<h6 id="注意HTMLCollection"><a href="#注意HTMLCollection" class="headerlink" title="注意HTMLCollection"></a>注意<code>HTMLCollection</code></h6><p>任何时候要访问<code>HTMLCollection</code>，不管它是一个属性还是一个方法，都是在文档上进行一个查询，这个查询开销很昂贵。最小化访问<code>HTMLCollection</code>的次数可以极大地改进脚本的性能。</p>
<p>编写JavaScript的时候，一定要知道何时返回<code>HTMLCollection</code>对象，这样你就可以最小化对他们的访问。发生以下情况时会返回<code>HTMLCollection</code>对象：</p>
<ul>
<li>进行了对<code>getElementsByTagName()</code> 的调用；</li>
<li>获取了元素的<code>childNodes</code>属性；</li>
<li>获取了元素的<code>attributes</code>属性；</li>
<li>访问了特殊的集合，如<code>document.forms</code>、<code>document.images</code>等。</li>
</ul>
<h5 id="尾递归"><a href="#尾递归" class="headerlink" title="尾递归"></a>尾递归</h5><p>尾调用由于是函数的最后一步操作，所以不需要保留外层函数的调用记录，因为调用位置、内部变量等信息都不会再用到了，只要直接用内层函数的调用记录，取代外层函数的调用记录就可以了。</p>
<blockquote>
<p>如果不是尾调用，就需要保存每一步函数调用的内部数据，但是如果是尾调用就只保存最后一步的调用数据。</p>
</blockquote>
<p><strong>尾调用优化</strong>（<code>Tail call optimization</code>）：即只保留内层函数的调用记录。如果所有函数都是尾调用，那么完全可以做到每次执行时，调用记录只有一项，这将大大节省内存。</p>
<p><strong>尾递归</strong>：如果尾调用自身，就称为尾递归。</p>
<h4 id="优质代码写法"><a href="#优质代码写法" class="headerlink" title="优质代码写法"></a>优质代码写法</h4><h5 id="风格指南"><a href="#风格指南" class="headerlink" title="风格指南"></a>风格指南</h5><p><a href="https://github.com/zh-google-styleguide/zh-google-styleguide">https://github.com/zh-google-styleguide/zh-google-styleguide</a></p>
<h5 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h5><p><a href="https://mp.weixin.qq.com/s/O3UKTzQaRpHa--yuio2uZA">垃圾代码和优质代码的区别？</a></p>
]]></content>
      <categories>
        <category>前端</category>
      </categories>
      <tags>
        <tag>前端</tag>
        <tag>读书笔记</tag>
        <tag>代码规范</tag>
      </tags>
  </entry>
  <entry>
    <title>高级函数</title>
    <url>/posts/12933/</url>
    <content><![CDATA[<h3 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h3><h4 id="函数声明与函数表达式的区别："><a href="#函数声明与函数表达式的区别：" class="headerlink" title="函数声明与函数表达式的区别："></a>函数声明与函数表达式的区别：</h4><ol>
<li><p>写法不同；</p>
</li>
<li><p><strong>名称标识符将会绑定在何处</strong>，函数表达式是可以匿名的，而函数声明则不可以省略函数名。</p>
</li>
<li><p>变量提升。函数声明会被整体提升，而函数表达式只会提升变量，预设为undefined，然后在等待执行阶段被赋值。所以函数表达式不能在定义前被使用，而函数声明可以。</p>
<blockquote>
<p>只有声明本身会被提升，而赋值或其他运行逻辑会留在原地。</p>
<p>在执行代码块之前，解析器会先处理函数声明，并使其在执行任何代码之前可用。所以函数声明在其被声明的代码块内的任何位置都是可见的。</p>
<p>函数表达式必须等到解析器执行到所在的代码行，才会真正被节是执行，即在执行流程到达时创建。</p>
</blockquote>
</li>
</ol>
<p>更多阅读：<a href="https://zh.javascript.info/function-expressions">https://zh.javascript.info/function-expressions</a></p>
<h3 id="常见函数概念"><a href="#常见函数概念" class="headerlink" title="常见函数概念"></a>常见函数概念</h3><h4 id="高阶函数"><a href="#高阶函数" class="headerlink" title="高阶函数"></a>高阶函数</h4><p>JavaScript的函数其实都指向某个变量。既然变量可以指向函数，函数的参数能接收变量，那么一个函数就可以接收另一个函数作为参数，这种函数就称之为高阶函数。</p>
<p>最简单的高阶函数</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token parameter">x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> f</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token function">f</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">f</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 调用</span>
<span class="token keyword">var</span> x <span class="token operator">=</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> Math<span class="token punctuation">.</span>abs<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 11</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="纯函数"><a href="#纯函数" class="headerlink" title="纯函数"></a>纯函数</h4><ul>
<li>确定的输入一定会产生确定的输出</li>
<li>函数在执行过程中，不能产生副作用</li>
</ul>
<h4 id="箭头函数"><a href="#箭头函数" class="headerlink" title="箭头函数"></a>箭头函数</h4><p><a href="https://es6.ruanyifeng.com/#docs/function#%E7%AE%AD%E5%A4%B4%E5%87%BD%E6%95%B0">https://es6.ruanyifeng.com/#docs/function#%E7%AE%AD%E5%A4%B4%E5%87%BD%E6%95%B0</a></p>
<h4 id="尾递归"><a href="#尾递归" class="headerlink" title="尾递归"></a>尾递归</h4><p><a href="https://es6.ruanyifeng.com/#docs/function#%E5%B0%BE%E8%B0%83%E7%94%A8%E4%BC%98%E5%8C%96">https://es6.ruanyifeng.com/#docs/function#%E5%B0%BE%E8%B0%83%E7%94%A8%E4%BC%98%E5%8C%96</a></p>
<h4 id="可组合"><a href="#可组合" class="headerlink" title="可组合"></a>可组合</h4><h4 id="集合操作"><a href="#集合操作" class="headerlink" title="集合操作"></a>集合操作</h4><h4 id="偏函数"><a href="#偏函数" class="headerlink" title="偏函数"></a>偏函数</h4><p>参考文章：</p>
<p><a href="https://github.com/mqyqingfeng/Blog/issues/43">https://github.com/mqyqingfeng/Blog/issues/43</a></p>
<p>定义：在计算机科学中，局部应用是指固定一个函数的一些参数，然后产生另一个更小元的函数。</p>
<p>元：指函数参数的个数，比如带有两个参数的函数被成为二元函数。</p>
<h5 id="与柯里化的区别"><a href="#与柯里化的区别" class="headerlink" title="与柯里化的区别"></a>与柯里化的区别</h5><h3 id="更多阅读"><a href="#更多阅读" class="headerlink" title="更多阅读"></a>更多阅读</h3><p><a href="https://github.com/yygmind/blog/issues/36#%E6%80%9D%E8%80%83%E9%A2%98">JavaScript 高阶函数浅析</a></p>
]]></content>
      <categories>
        <category>前端</category>
        <category>高级函数</category>
      </categories>
      <tags>
        <tag>前端</tag>
        <tag>技巧</tag>
        <tag>面试</tag>
        <tag>函数</tag>
        <tag>高级函数</tag>
      </tags>
  </entry>
  <entry>
    <title>使用Hexo</title>
    <url>/posts/29164/</url>
    <content><![CDATA[<p>hexo 官方指南：<a href="https://hexo.io/zh-cn/docs/">https://hexo.io/zh-cn/docs/</a></p>
<h4 id="安装初始化Hexo"><a href="#安装初始化Hexo" class="headerlink" title="安装初始化Hexo"></a>安装初始化Hexo</h4><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup">npm install hexo -g<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>如果安装出现错误，请使用cnpm进行尝试，<br>安装后，输入<code>hexo -v</code> 检查安装是否成功，<br>安装成功后，输入<code>hexo init</code>进行初始化，<br>输入<code>npm install</code>安装所需要的组件，如果失败请使用<code>cnpm install</code>进行尝试，<br>生成静态文件，输入<code>hexo g</code>（是命令<code>hexo generate</code>缩写），<br>和线上的github相关联后，新增一篇博客<code>hexo new post &#39;博客名&#39;</code>，<br>安装插件，<code>npm install hexo-deployer-git --save</code>。</p>
<p>编辑好文章后就可以进行发布部署了，<code>hexo d -g</code></p>
<p>清除缓存<code>hexo clean</code></p>
<h4 id="本地启动Hexo服务"><a href="#本地启动Hexo服务" class="headerlink" title="本地启动Hexo服务"></a>本地启动Hexo服务</h4><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">hexo s <span class="token comment"># hexo server</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>是命令<code>hexo server</code>的缩写<br>默认启用4000端口号，修改端口号</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">hexo server <span class="token parameter variable">-p</span> <span class="token number">5000</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h4 id="新建页面"><a href="#新建页面" class="headerlink" title="新建页面"></a>新建页面</h4><h5 id="新建文章"><a href="#新建文章" class="headerlink" title="新建文章"></a>新建文章</h5><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">hexo new <span class="token string">"new post"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h5 id="新建文章分类页面"><a href="#新建文章分类页面" class="headerlink" title="新建文章分类页面"></a>新建文章分类页面</h5><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">hexo new page categories<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>配置categories页面，进入到刚才生成的<code>categories/index.md</code>文件中</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">title: 分类
date: <span class="token number">2018</span>-04-25 <span class="token number">22</span>:34:08
type: <span class="token string">"categories"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>设置每篇博客的categories</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">categories: xxx<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h5 id="新建文章标签页面"><a href="#新建文章标签页面" class="headerlink" title="新建文章标签页面"></a>新建文章标签页面</h5><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">hexo new page tags<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>配置tags页面，进入到刚才生成的<code>tags/index.md</code>文件中</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">title: 标签
date: <span class="token number">2018</span>-04-25 <span class="token number">22</span>:34:08
type: <span class="token string">"tags"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>在文章中设置标签</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">tags:<span class="token punctuation">[</span>xxx,xx,x<span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h4 id="部署"><a href="#部署" class="headerlink" title="部署"></a>部署</h4><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">hexo deploy --简写 hexo d<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h5 id="兼容node14-版本"><a href="#兼容node14-版本" class="headerlink" title="兼容node14.*版本"></a>兼容<code>node14.*</code>版本</h5><p>当前时间是2021年4月，升级了一下<code>node</code>版本到14.*，结果<code>hexo</code>发布出现了问题。</p>
<p>所以用<code>npx</code>让<code>hexo</code>运行在12.*版本上</p>
<ol>
<li>先用 <code>npm view node version</code> 查看一下 <code>node</code> 的历史版本，选一个旧一点点的版本号</li>
<li>在当前目录环境下，安装<code>node</code>依赖包 <code>npm install node@12.21.0 -D</code> </li>
<li>就可以每次发布的时候 <code>npx hexo d -g</code> 使用当前文件夹下的<code>node</code>环境</li>
<li>懒人当然在 <code>package.json</code> 中定义一下 <code>scripts</code> 这样可以避免忘记使用<code>npx</code>了</li>
</ol>
<h4 id="更新"><a href="#更新" class="headerlink" title="更新"></a>更新</h4><p>版本升级：<a href="https://novnan.github.io/Hexo/update_hexo/">https://novnan.github.io/Hexo/update_hexo/</a></p>
<p>进入 theme/next 目录，执行 git pull 。</p>
<p>冲突解决：<a href="https://stackoverflow.com/questions/15745045/how-do-i-resolve-git-saying-commit-your-changes-or-stash-them-before-you-can-me/15745424#15745424">https://stackoverflow.com/questions/15745045/how-do-i-resolve-git-saying-commit-your-changes-or-stash-them-before-you-can-me/15745424#15745424</a></p>
<p>主题更新：<a href="https://theme-next.js.org/docs/getting-started/upgrade.html">https://theme-next.js.org/docs/getting-started/upgrade.html</a></p>
<h4 id="设置"><a href="#设置" class="headerlink" title="设置"></a>设置</h4><h5 id="置顶"><a href="#置顶" class="headerlink" title="置顶"></a>置顶</h5><p>使用插件：<a href="https://github.com/netcan/hexo-generator-index-pin-top">https://github.com/netcan/hexo-generator-index-pin-top</a></p>
<h5 id="字数统计-amp-阅读时长"><a href="#字数统计-amp-阅读时长" class="headerlink" title="字数统计 &amp; 阅读时长"></a>字数统计 &amp; 阅读时长</h5><p><a href="https://github.com/theme-next/hexo-symbols-count-time">https://github.com/theme-next/hexo-symbols-count-time</a></p>
<h5 id="深色模式"><a href="#深色模式" class="headerlink" title="深色模式"></a>深色模式</h5><p><a href="https://github.com/sandoche/Darkmode.js">https://github.com/sandoche/Darkmode.js</a></p>
<p><a href="https://haomingzhang.com/hexo_3/">https://haomingzhang.com/hexo_3/</a></p>
<h5 id="提交日历"><a href="#提交日历" class="headerlink" title="提交日历"></a>提交日历</h5><p><a href="https://github.com/theme-next/theme-next-calendar">https://github.com/theme-next/theme-next-calendar</a></p>
<h5 id="静态图片插入"><a href="#静态图片插入" class="headerlink" title="静态图片插入"></a>静态图片插入</h5><p><a href="https://github.com/xcodebuild/hexo-asset-image">https://github.com/xcodebuild/hexo-asset-image</a></p>
<h5 id="更多"><a href="#更多" class="headerlink" title="更多"></a>更多</h5><p>可以参考更多设置：</p>
<p><a href="https://siriusq.top/Next%E5%8D%87%E7%BA%A7-Mac%E8%BF%81%E7%A7%BB.html">https://siriusq.top/Next%E5%8D%87%E7%BA%A7-Mac%E8%BF%81%E7%A7%BB.html</a></p>
<p><a href="https://tding.top/archives/567debe0.html">https://tding.top/archives/567debe0.html</a></p>
<p><a href="https://hexo-next.readthedocs.io/zh_CN/latest/">https://hexo-next.readthedocs.io/zh_CN/latest/</a></p>
<h4 id="美化界面"><a href="#美化界面" class="headerlink" title="美化界面"></a>美化界面</h4><h5 id="安装主题NexT"><a href="#安装主题NexT" class="headerlink" title="安装主题NexT"></a>安装主题NexT</h5><p><a href="http://theme-next.iissnan.com/getting-started.html">NexT官方文档</a></p>
<p>根据官方文档进行主题配置，还有更多的其他hexo相关的主题</p>
]]></content>
      <categories>
        <category>指南</category>
      </categories>
      <tags>
        <tag>hexo</tag>
      </tags>
  </entry>
  <entry>
    <title>设计模式-策略模式</title>
    <url>/posts/ea641220/</url>
    <content><![CDATA[<h3 id="策略模式"><a href="#策略模式" class="headerlink" title="策略模式"></a>策略模式</h3><p><strong>策略模式</strong>：定义一系列的算法，把它们一个个封装起来，并且使它们可以相互替换。</p>
<p>一个基于策略模式的程序至少由两个部分组成。</p>
<p>第一个部分是一组策略类，策略类封装了具体的算法，并负责具体的计算过程。</p>
<p>第二个部分是环境类 Context，Context 接受客户的请求，随后把请求委托给某一个策略类。</p>
<p>Context 中要维持对某个策略对象的引用。</p>
<h3 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h3><h4 id="计算奖金"><a href="#计算奖金" class="headerlink" title="计算奖金"></a>计算奖金</h4><h5 id="使用策略模式计算奖金"><a href="#使用策略模式计算奖金" class="headerlink" title="使用策略模式计算奖金"></a>使用策略模式计算奖金</h5><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 先把每种绩效的计算规则都封装在对应的策略类里面</span>
<span class="token keyword">var</span> <span class="token function-variable function">performanceS</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
performanceS<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">calculate</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">salary</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> salary <span class="token operator">*</span> <span class="token number">4</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">var</span> <span class="token function-variable function">performanceA</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
performanceA<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">calculate</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">salary</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> salary <span class="token operator">*</span> <span class="token number">3</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">var</span> <span class="token function-variable function">performanceB</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
performanceB<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">calculate</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">salary</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> salary <span class="token operator">*</span> <span class="token number">2</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 奖金类Bonus</span>
<span class="token keyword">var</span> <span class="token function-variable function">Bonus</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>salary <span class="token operator">=</span> <span class="token keyword">null</span> <span class="token comment">// 原始工资</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>strategy <span class="token operator">=</span> <span class="token keyword">null</span> <span class="token comment">// 绩效等级对应的策略对象</span>
<span class="token punctuation">&#125;</span>

<span class="token class-name">Bonus</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">setSalary</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">salary</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>salary <span class="token operator">=</span> salary <span class="token comment">// 设置员工的原始工资</span>
<span class="token punctuation">&#125;</span>

<span class="token class-name">Bonus</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">setSrategy</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">strategy</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>strategy <span class="token operator">=</span> strategy <span class="token comment">// 设置员工绩效等级对应的策略对象</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">// 取得奖金数额</span>
<span class="token class-name">Bonus</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">getBonus</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>strategy<span class="token punctuation">.</span><span class="token function">calculate</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>salary<span class="token punctuation">)</span> <span class="token comment">// 把计算奖金的操作委托给对应的策略对象</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">// 计算奖金</span>
<span class="token keyword">var</span> bonus <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Bonus</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
bonus<span class="token punctuation">.</span><span class="token function">setSalary</span><span class="token punctuation">(</span><span class="token number">10000</span><span class="token punctuation">)</span>
bonus<span class="token punctuation">.</span><span class="token function">setSrategy</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">performanceS</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 设置策略对象</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'performanceS'</span><span class="token punctuation">,</span> bonus<span class="token punctuation">.</span><span class="token function">getBonus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 获取奖金</span>
bonus<span class="token punctuation">.</span><span class="token function">setSrategy</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">performanceA</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 替换策略对象</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'performanceA'</span><span class="token punctuation">,</span> bonus<span class="token punctuation">.</span><span class="token function">getBonus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>策略模式的实现</strong>：定义一系列的算法，把它们各自封装成策略类，算法被封装在策略类内部的方法里。在客户对Context发起请求的时候，Context总是把请求委托给这些策略对象中间的某一个进行计算。</p>
<p>使用策略模式之后，代码变得更加清晰，各个类的职责更加鲜明。</p>
<h5 id="使用对象的方式改写"><a href="#使用对象的方式改写" class="headerlink" title="使用对象的方式改写"></a>使用对象的方式改写</h5><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 对象改写</span>
<span class="token keyword">var</span> strategies <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  <span class="token function-variable function">S</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">salary</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> salary <span class="token operator">*</span> <span class="token number">4</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token function-variable function">A</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">salary</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> salary <span class="token operator">*</span> <span class="token number">3</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token function-variable function">B</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">salary</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> salary <span class="token operator">*</span> <span class="token number">2</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">var</span> <span class="token function-variable function">calculateBonus</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">level<span class="token punctuation">,</span> salary</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> strategies<span class="token punctuation">[</span>level<span class="token punctuation">]</span><span class="token punctuation">(</span>salary<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'calculateBonus S'</span><span class="token punctuation">,</span> <span class="token function">calculateBonus</span><span class="token punctuation">(</span><span class="token string">'S'</span><span class="token punctuation">,</span> <span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'calculateBonus A'</span><span class="token punctuation">,</span> <span class="token function">calculateBonus</span><span class="token punctuation">(</span><span class="token string">'A'</span><span class="token punctuation">,</span> <span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h4 id="动画"><a href="#动画" class="headerlink" title="动画"></a>动画</h4><h5 id="缓动动画"><a href="#缓动动画" class="headerlink" title="缓动动画"></a>缓动动画</h5><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 缓动动画</span>
<span class="token comment">// 参数的含义分别是动画已消耗的时间、小球原始位置、小球目标位置、动画持续的总时间</span>
<span class="token comment">// 返回的值则是动画元素应该处在的当前位置</span>
<span class="token keyword">var</span> tween <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  <span class="token function-variable function">linear</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">t<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">,</span> d</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> c <span class="token operator">*</span> t <span class="token operator">/</span> d <span class="token operator">+</span> b
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token function-variable function">easeIn</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">t<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">,</span> d</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> c <span class="token operator">*</span> <span class="token punctuation">(</span>t <span class="token operator">/=</span> d<span class="token punctuation">)</span> <span class="token operator">*</span> t <span class="token operator">+</span> b
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token function-variable function">strongEaseIn</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">t<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">,</span> d</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> c <span class="token operator">*</span> <span class="token punctuation">(</span>t <span class="token operator">/=</span> d<span class="token punctuation">)</span> <span class="token operator">*</span> t <span class="token operator">*</span> t <span class="token operator">*</span> t <span class="token operator">*</span> t <span class="token operator">+</span> b
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token function-variable function">strongEaseOut</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">t<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">,</span> d</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> c <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>t <span class="token operator">=</span> t <span class="token operator">/</span> d <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> t <span class="token operator">*</span> t <span class="token operator">*</span> t <span class="token operator">*</span> t <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> b
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token function-variable function">sineaseIn</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">t<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">,</span> d</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> c <span class="token operator">*</span> <span class="token punctuation">(</span>t <span class="token operator">/=</span> d<span class="token punctuation">)</span> <span class="token operator">*</span> t <span class="token operator">*</span> t <span class="token operator">+</span> b
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token function-variable function">sineaseOut</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">t<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">,</span> d</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> c <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>t <span class="token operator">=</span> t <span class="token operator">/</span> d <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> t <span class="token operator">*</span> t <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> b
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h5 id="Animate-类"><a href="#Animate-类" class="headerlink" title="Animate 类"></a>Animate 类</h5><p>利用这个动画类和一些缓动算法就可以让小球运动起来。</p>
<p>使用策略模式把算法传入动画类中，来达到各种不同的缓动效果，这些算法都可以轻易地被替换为另外一个算法，这是策略模式的经典运用之一。</p>
<p>策略模式的实现并不复杂，关键是如何从策略模式的实现背后，找到封装变化、委托和多态性这些思想的价值。</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// Animate类</span>
<span class="token keyword">var</span> <span class="token function-variable function">Animate</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">dom</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>dom <span class="token operator">=</span> dom <span class="token comment">// 进行运动的dom节点</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>startTime <span class="token operator">=</span> <span class="token number">0</span> <span class="token comment">// 动画开始时间</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>startPos <span class="token operator">=</span> <span class="token number">0</span> <span class="token comment">// 动画开始时, dom节点的位置,即dom的初始位置</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>endPos <span class="token operator">=</span> <span class="token number">0</span> <span class="token comment">// 动画结束时,dom节点的位置,即dom的目标位置</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>propertyName <span class="token operator">=</span> <span class="token keyword">null</span> <span class="token comment">// dom节点需要被改变的css属性名</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>easing <span class="token operator">=</span> <span class="token keyword">null</span> <span class="token comment">// 缓动算法</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>duration <span class="token operator">=</span> <span class="token keyword">null</span> <span class="token comment">// 动画持续时间</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 动画启动,需要记录一些信息,供缓动算法在以后计算小球当前位置的时候使用</span>
<span class="token class-name">Animate</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">start</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">propertyName<span class="token punctuation">,</span> endPos<span class="token punctuation">,</span> duration<span class="token punctuation">,</span> easing</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>startTime <span class="token operator">=</span> <span class="token operator">+</span><span class="token keyword">new</span> <span class="token class-name">Date</span> <span class="token comment">// 动画启动时间</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>startPos <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>dom<span class="token punctuation">.</span><span class="token function">getBoundingClientRect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span>propertyName<span class="token punctuation">]</span> <span class="token comment">// dom节点初始位置</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>propertyName <span class="token operator">=</span> propertyName <span class="token comment">// dom节点需要被改变的CSS属性名</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>endPos <span class="token operator">=</span> endPos <span class="token comment">// dom节点目标</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>duration <span class="token operator">=</span> duration <span class="token comment">// 动画持续时间</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>easing <span class="token operator">=</span> tween<span class="token punctuation">[</span>easing<span class="token punctuation">]</span> <span class="token comment">// 缓动算法</span>

  <span class="token keyword">var</span> self <span class="token operator">=</span> <span class="token keyword">this</span>
  <span class="token comment">// 启动定时器,开始执行动画</span>
  <span class="token keyword">var</span> timeId <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>self<span class="token punctuation">.</span><span class="token function">step</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">// 如果动画已结束,则清除定时器</span>
      <span class="token function">clearInterval</span><span class="token punctuation">(</span>timeId<span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">19</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 设置动画每一帧需要做的事情</span>
<span class="token class-name">Animate</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">step</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">var</span> t <span class="token operator">=</span> <span class="token operator">+</span><span class="token keyword">new</span> <span class="token class-name">Date</span> <span class="token comment">// 取得当前时间</span>
  <span class="token comment">// 如果当前事件大于动画开始时间加上动画持续时间之和,说明动画已经结束,此时需要修正小球的位置</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>t <span class="token operator">>=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>startTime <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>duration<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>endPos<span class="token punctuation">)</span> <span class="token comment">// 更新小球的CSS属性值</span>
    <span class="token keyword">return</span> <span class="token boolean">false</span> <span class="token comment">// start函数清除定时器</span>
  <span class="token punctuation">&#125;</span>
  <span class="token keyword">var</span> pos <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">easing</span><span class="token punctuation">(</span>t <span class="token operator">-</span> <span class="token keyword">this</span><span class="token punctuation">.</span>startTime<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>startPos<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>endPos <span class="token operator">-</span> <span class="token keyword">this</span><span class="token punctuation">.</span>startPos<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>duration<span class="token punctuation">)</span>
  <span class="token comment">// pos为小球当前位置</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>pos<span class="token punctuation">)</span> <span class="token comment">// 更新小球的CSS属性值</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">// 更新小球CSS属性值</span>
<span class="token class-name">Animate</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">update</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">pos</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>dom<span class="token punctuation">.</span>style<span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>propertyName<span class="token punctuation">]</span> <span class="token operator">=</span> pos <span class="token operator">+</span> <span class="token string">'px'</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 测试</span>
<span class="token comment">// var div = document.getElementById('div')</span>
<span class="token comment">// var animate = new Animate(div)</span>
<span class="token comment">// animate.start('left', 500, 1000, 'strongEaseOut')</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>从定义上看，策略模式就是用来封装算法的。</p>
<p>在业务规则中使用，只要这些业务规则指向的目标一致，并且可以被替换使用，就可以用策略模式来封装。</p>
<h4 id="表单校验"><a href="#表单校验" class="headerlink" title="表单校验"></a>表单校验</h4><p>使用策略模式可以仅仅通过配置的方式完成一个表单的校验，这些校验规则也可以复用在程序的任何地方，还能作为插件的形式，方便地移植到其他项目中。</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 表单验证</span>
<span class="token comment">// 校验逻辑封装为策略对象</span>
<span class="token keyword">var</span> strategies <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  <span class="token comment">// 不为空</span>
  <span class="token function-variable function">isNotEmpty</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">value<span class="token punctuation">,</span> errorMsg</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>value <span class="token operator">===</span> <span class="token string">''</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">return</span> errorMsg
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token comment">// 限制最小长度</span>
  <span class="token function-variable function">minLength</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">value<span class="token punctuation">,</span> length<span class="token punctuation">,</span> errorMsg</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>value<span class="token punctuation">.</span>length <span class="token operator">&lt;</span> length<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">return</span> errorMsg
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token comment">// 校验手机号码格式</span>
  <span class="token function-variable function">isMobile</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">value<span class="token punctuation">,</span> errorMsg</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">(^1[3|5|8][0-9]&#123;9&#125;$)</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">return</span> errorMsg
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">// validator类作为context</span>
<span class="token keyword">var</span> <span class="token function-variable function">Validator</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>cache <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token comment">// 保存校验规则</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">// 仅验证一条规则</span>
<span class="token comment">// Validator.prototype.add = function(dom, rule, errorMsg)&#123;</span>
<span class="token comment">// 冒号前面的minLength代表客户挑选的strategy对象，冒号后面的数字6表示在校验过程中所必需的一些参数。</span>
<span class="token comment">// 'minLength:6’的意思就是校验registerForm.password这个文本输入框的value最小长度为6。</span>
<span class="token comment">// 如果这个字符串中不包含冒号，说明校验过程中不需要额外的参数信息。</span>
<span class="token comment">//   var ary = rule.split(':') // 把strategy和参数分开</span>
<span class="token comment">//   this.cache.push(function()&#123; // 把校验的步骤用控函数包装起来,并且放入cache</span>
<span class="token comment">//     var strategy = ary.shift() // 用户挑选的strategy</span>
<span class="token comment">//     ary.unshift(dom.value) // 把input的value添加进参数列表</span>
<span class="token comment">//     ary.push(errorMsg)</span>
<span class="token comment">//     return strategies[strategy].apply(dom, ary)</span>
<span class="token comment">//   &#125;)</span>
<span class="token comment">// &#125;</span>
<span class="token comment">// 多条验证规则</span>
<span class="token class-name">Validator</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">add</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">dom<span class="token punctuation">,</span> rules</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">var</span> self <span class="token operator">=</span> <span class="token keyword">this</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> rule<span class="token punctuation">;</span> rule <span class="token operator">=</span> rules<span class="token punctuation">[</span>i<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">rule</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">var</span> strategyAry <span class="token operator">=</span> rule<span class="token punctuation">.</span>strategy<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">':'</span><span class="token punctuation">)</span>
      <span class="token keyword">var</span> errorMsg <span class="token operator">=</span> rule<span class="token punctuation">.</span>errorMsg
      self<span class="token punctuation">.</span>cache<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">var</span> strategy <span class="token operator">=</span> strategyAry<span class="token punctuation">.</span><span class="token function">shift</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        strategyAry<span class="token punctuation">.</span><span class="token function">unshift</span><span class="token punctuation">(</span>dom<span class="token punctuation">.</span>value<span class="token punctuation">)</span>
        strategyAry<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>errorMsg<span class="token punctuation">)</span>
        <span class="token keyword">return</span> strategies<span class="token punctuation">[</span>strategy<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>dom<span class="token punctuation">,</span> strategyAry<span class="token punctuation">)</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">(</span>rule<span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token class-name">Validator</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">start</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> validatorFunc<span class="token punctuation">;</span> validatorFunc <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>cache<span class="token punctuation">[</span>i<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">var</span> msg <span class="token operator">=</span> <span class="token function">validatorFunc</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 开始校验,并取得校验后的返回信息</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>msg<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">// 如果有确切的返回值,说明校验没有通过</span>
      <span class="token keyword">return</span> msg
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// ================================== 使用 ======================================</span>
<span class="token keyword">var</span> <span class="token function-variable function">validatorFunc</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">var</span> validator <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Validator</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 创建一个validator对象</span>
  <span class="token comment">// 添加一些校验规则, 单条验证规则的使用</span>
  <span class="token comment">// validator.add(registerForm.userName, 'isNotEmpty', '用户名不能为空')</span>
  <span class="token comment">// validator.add(registerForm.password, 'minLength:6', '密码长度不能少于6位')</span>
  <span class="token comment">// validator.add(registerForm.phoneNumber, 'isMobile', '手机号码格式不正确')</span>
  <span class="token comment">// 多条规则的验证</span>
  validator<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>registerForm<span class="token punctuation">.</span>userName<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">&#123;</span>
    <span class="token literal-property property">strategy</span><span class="token operator">:</span> <span class="token string">'isNotEmpty'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">errorMsg</span><span class="token operator">:</span> <span class="token string">'用户名长度不能为空'</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>
    <span class="token literal-property property">strategy</span><span class="token operator">:</span> <span class="token string">'minLength:10'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">errorMsg</span><span class="token operator">:</span> <span class="token string">'用户名长度不能小于10位'</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token keyword">var</span> errorMsg <span class="token operator">=</span> validator<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 获得校验结果</span>
  <span class="token keyword">return</span> errorMsg <span class="token comment">// 返回校验结果</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">var</span> registerForm <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'registerForm'</span><span class="token punctuation">)</span>
registerForm<span class="token punctuation">.</span><span class="token function-variable function">onsubmit</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">var</span> errorMsg <span class="token operator">=</span> <span class="token function">validatorFunc</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 如果errorMsg有确切发返回值,说明未通过校验</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>errorMsg<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>errorMsg<span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token boolean">false</span> <span class="token comment">// 阻止表单提交</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="优缺点"><a href="#优缺点" class="headerlink" title="优缺点"></a>优缺点</h3><h4 id="优点"><a href="#优点" class="headerlink" title="优点"></a>优点</h4><ol>
<li>使用策略模式，可以消除了原程序中大片的条件分支语句。每个策略对象负责的算法已被各自封装在对象内部。减少了维护成本。</li>
<li>策略模式利用组合、委托和多态等技术和思想，可以有效地避免多重条件选择语句。</li>
<li>策略模式提供了对开放——封闭原则的完美支持，将算法封装在独立的 strategy 中，使得它们易于切换，易于理解，易于扩展。</li>
<li>策略模式中的算法也可以复用在系统的其他地方，从而避免许多重复的复制粘贴工作。</li>
<li>在策略模式中利用组合和委托来让 Context 拥有执行算法的能力，这也是继承的一种更轻便的替代方案。</li>
</ol>
<h4 id="缺点"><a href="#缺点" class="headerlink" title="缺点"></a>缺点</h4><ol>
<li>使用策略模式会在程序中增加许多策略类或者策略对象。</li>
<li>要使用策略模式，必须了解所有的 strategy，必须了解各个 strategy 之间的不同点，这样才能选择一个合适的 strategy。strategy 要向客户暴露它的所有实现，这是违反最少知识原则的。</li>
</ol>
<h3 id="应用与实践"><a href="#应用与实践" class="headerlink" title="应用与实践"></a>应用与实践</h3><p>在以类为中心的传统面向对象语言中，不同的算法或者行为被封装在各个策略类中，Context 将请求委托给这些策略对象，这些策略对象会根据请求返回不同的执行结果，这样便能表现出对象的多态性。</p>
<p>在函数作为一等对象的语言中，策略模式是隐形的。strategy 就是值为函数的变量。</p>
<p>在 JavaScript 语言的策略模式中，策略类往往被函数所代替，这时策略模式就成为一种“隐形”的模式。</p>
]]></content>
      <categories>
        <category>设计模式</category>
      </categories>
      <tags>
        <tag>前端</tag>
        <tag>面试</tag>
        <tag>工具函数</tag>
        <tag>设计模式</tag>
      </tags>
  </entry>
  <entry>
    <title>设计模式-工厂模式</title>
    <url>/posts/ccff2b22/</url>
    <content><![CDATA[<h3 id="工厂"><a href="#工厂" class="headerlink" title="工厂"></a>工厂</h3><p>工厂通常是一个用来创建其他对象的对象。工厂是<a href="https://zh.wikipedia.org/wiki/%E6%A7%8B%E9%80%A0%E6%96%B9%E6%B3%95">构造方法</a>的<a href="https://zh.wikipedia.org/wiki/%E6%8A%BD%E8%B1%A1%E5%8C%96_(%E8%A8%88%E7%AE%97%E6%A9%9F%E7%A7%91%E5%AD%B8)">抽象</a>，用来实现不同的分配方案。</p>
<p>工厂对象通常包含一个或多个方法，用来创建这个工厂所能创建的各种类型的对象。这些方法可能接收参数，用来指定对象创建的方式，最后返回创建的对象。</p>
<blockquote>
<p><strong>工厂方法模式</strong>、<a href="https://zh.wikipedia.org/wiki/%E6%8A%BD%E8%B1%A1%E5%B7%A5%E5%8E%82">抽象工厂模式</a>、<a href="https://zh.wikipedia.org/wiki/%E7%94%9F%E6%88%90%E5%99%A8%E6%A8%A1%E5%BC%8F">生成器模式</a>，甚至是<a href="https://zh.wikipedia.org/wiki/%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F">单例模式</a>都应用了工厂的概念</p>
</blockquote>
<h3 id="工厂模式"><a href="#工厂模式" class="headerlink" title="工厂模式"></a>工厂模式</h3><p>在工厂模式中，在创建对象时不会对客户端暴露创建逻辑，并且是通过使用一个共同的接口来指向新创建的对象。</p>
<p>工厂模式根据抽象程度的不同可以分为：简单工厂模式、工厂方法模式和抽象工厂模式。</p>
<h3 id="简单工厂模式"><a href="#简单工厂模式" class="headerlink" title="简单工厂模式"></a>简单工厂模式</h3><p>又称静态工厂方法，由一个工厂对象决定创建某一种产品对象类的实例。主要用来创建同一类对象。</p>
<blockquote>
<p>专门定义一个类（工厂类）来负责创建其他类的实例。可以根据创建方法的参数来返回不同类的实例，被创建的实例通常都具有共同的父类。</p>
</blockquote>
<h4 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h4><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">class</span> <span class="token class-name">BasketBall</span> <span class="token punctuation">&#123;</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>intro <span class="token operator">=</span> <span class="token string">'篮球盛行于美国'</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  <span class="token function">getMember</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'每个队伍需要5名队员'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">class</span> <span class="token class-name">FooterBall</span> <span class="token punctuation">&#123;</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>intro <span class="token operator">=</span> <span class="token string">'足球在世界范围内很流行'</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  <span class="token function">getMember</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'每个队伍需要11名队员'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 简单工厂模式</span>
<span class="token keyword">const</span> <span class="token function-variable function">sportsFactory</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">switch</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">case</span> <span class="token string">'NBA'</span><span class="token operator">:</span>
      <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">BasketBall</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token string">'wordcup'</span><span class="token operator">:</span>
      <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">FooterBall</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="工厂方法模式"><a href="#工厂方法模式" class="headerlink" title="工厂方法模式"></a>工厂方法模式</h3><p>通过对产品类的抽象使其创建业务主要负责用于创建多类产品的实例。</p>
<blockquote>
<p>工厂方法模式的实质是“定义一个创建对象的接口，但让实现这个接口的类来决定实例化哪个类。工厂方法让类的实例化推迟到子类中进行。”</p>
<p>创建一个对象常常需要复杂的过程，所以不适合包含在一个复合对象中。创建对象可能会导致大量的重复代码，可能会需要复合对象访问不到的信息，也可能提供不了足够级别的抽象，还可能并不是复合对象概念的一部分。工厂方法模式通过定义一个单独的创建对象的方法来解决这些问题。由<a href="https://zh.wikipedia.org/wiki/%E5%AD%90%E7%B1%BB">子类</a>实现这个方法来创建具体类型的对象。</p>
<p>对象创建中的有些过程包括决定创建哪个对象、管理对象的生命周期，以及管理特定对象的创建和销毁的概念。——<a href="https://zh.wikipedia.org/wiki/%E5%B7%A5%E5%8E%82%E6%96%B9%E6%B3%95">维基百科</a></p>
</blockquote>
<h3 id="抽象工厂模式"><a href="#抽象工厂模式" class="headerlink" title="抽象工厂模式"></a>抽象工厂模式</h3><p>在抽象工厂模式中，接口是负责创建一个相关对象的工厂，不需要显式指定它们的类。每个生成的工厂都能按照工厂模式提供对象。</p>
<blockquote>
<p>抽象工厂模式提供了一种方式，可以将一组具有同一主题的单独的<a href="https://zh.wikipedia.org/wiki/%E5%B7%A5%E5%8E%82%E6%96%B9%E6%B3%95">工厂</a>封装起来。在正常使用中，客户端程序需要创建抽象工厂的具体实现，然后使用抽象工厂作为<a href="https://zh.wikipedia.org/w/index.php?title=%E6%8E%A5%E5%8F%A3_(%E8%B5%84%E8%AE%AF%E7%A7%91%E6%8A%80)&action=edit&redlink=1">接口</a>来创建这一主题的具体对象。客户端程序不需要知道（或关心）它从这些内部的工厂方法中获得对象的具体类型，因为客户端程序仅使用这些对象的通用接口。抽象工厂模式将一组对象的实现细节与他们的一般使用分离开来。—— <a href="https://zh.wikipedia.org/wiki/%E6%8A%BD%E8%B1%A1%E5%B7%A5%E5%8E%82">维基百科</a></p>
</blockquote>
<h3 id="优缺点"><a href="#优缺点" class="headerlink" title="优缺点"></a>优缺点</h3><h4 id="优点"><a href="#优点" class="headerlink" title="优点"></a>优点</h4><ul>
<li>可以使代码结构清晰，有效地封装变化。</li>
<li>对调用者屏蔽具体的产品类。如果使用工厂模式，调用者只关心产品的接口就可以了，至于具体的实现，调用者根本无需关心。即使变更了具体的实现，对调用者来说没有任何影响。</li>
<li>降低耦合度。</li>
<li>扩展性高。</li>
</ul>
<h4 id="缺点"><a href="#缺点" class="headerlink" title="缺点"></a>缺点</h4><p>每次增加一个产品时，都需要增加一个具体类和对象实现工厂，使得系统中类的个数成倍增加，在一定程度上增加了系统的复杂度，同时也增加了系统具体类的依赖。</p>
<h3 id="应用与实践"><a href="#应用与实践" class="headerlink" title="应用与实践"></a>应用与实践</h3><h3 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h3><p><a href="https://zh.wikipedia.org/wiki/%E5%B7%A5%E5%8E%82%E6%96%B9%E6%B3%95">维基百科 - 工厂方法</a></p>
<p><a href="https://juejin.cn/post/6844903653774458888">JavaScript设计模式与实践–工厂模式 - 掘金</a></p>
<p><a href="https://juejin.cn/post/6844903795017646094">学习并理解 23 种设计模式- 掘金</a></p>
<p><a href="https://xie.infoq.cn/article/88c926822394aa1c80847dd2a">https://xie.infoq.cn/article/88c926822394aa1c80847dd2a</a></p>
]]></content>
      <categories>
        <category>设计模式</category>
      </categories>
      <tags>
        <tag>前端</tag>
        <tag>面试</tag>
        <tag>设计模式</tag>
        <tag>创建型模式</tag>
      </tags>
  </entry>
  <entry>
    <title>设计模式-单例模式</title>
    <url>/posts/69e7b86f/</url>
    <content><![CDATA[<h3 id="单例模式"><a href="#单例模式" class="headerlink" title="单例模式"></a>单例模式</h3><blockquote>
<p><strong>单例模式</strong>，也叫<strong>单子模式</strong>，是一种常用的<a href="https://zh.wikipedia.org/wiki/%E8%BD%AF%E4%BB%B6%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F">软件设计模式</a>，属于创建型模式的一种。在应用这个模式时，单例对象的<a href="https://zh.wikipedia.org/wiki/%E7%B1%BB_(%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6)">类</a>必须保证只有一个实例存在。许多时候整个系统只需要拥有一个的全局<a href="https://zh.wikipedia.org/wiki/%E5%AF%B9%E8%B1%A1">对象</a>，这样有利于我们协调系统整体的行为。—— <a href="https://zh.wikipedia.org/wiki/%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F">维基百科</a></p>
</blockquote>
<p>保证一个类仅有一个实例,并提供一个访问它的全局访问点。</p>
<p>单例模式是一种常用的模式，有一些对象我们往往只需要一个，比如线程池、全局缓存、浏览器中的window对象等。</p>
<h3 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h3><p>所有单例的实现都包含以下两个相同的步骤：</p>
<ul>
<li>将默认构造函数设为私有， 防止其他对象使用单例类的 <code>new</code>运算符。</li>
<li>新建一个静态构建方法作为构造函数。 该函数会 “偷偷” 调用私有构造函数来创建对象， 并将其保存在一个静态成员变量中。 此后所有对于该函数的调用都将返回这一缓存对象。</li>
</ul>
<h4 id="标准的单例模式"><a href="#标准的单例模式" class="headerlink" title="标准的单例模式"></a>标准的单例模式</h4><p>用一个变量来标志当前是否已经为某个类创建过对象，如果是，则在下一次获取该类的实例时，直接返回之前创建的对象。</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 实现1</span>
<span class="token keyword">var</span> <span class="token function-variable function">Singleton</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name
  <span class="token keyword">this</span><span class="token punctuation">.</span>instance <span class="token operator">=</span> <span class="token keyword">null</span>
<span class="token punctuation">&#125;</span>

<span class="token class-name">Singleton</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">getName</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

Singleton<span class="token punctuation">.</span><span class="token function-variable function">getInstance</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>instance<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>instance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Singleton</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>instance
<span class="token punctuation">&#125;</span>

<span class="token keyword">var</span> a <span class="token operator">=</span> Singleton<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token string">'test1'</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> b <span class="token operator">=</span> Singleton<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token string">'test2'</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Singleton1'</span><span class="token punctuation">,</span> a <span class="token operator">===</span> b<span class="token punctuation">)</span>

<span class="token comment">// 实现2</span>
<span class="token keyword">var</span> <span class="token function-variable function">Singleton</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name
<span class="token punctuation">&#125;</span>

<span class="token class-name">Singleton</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">getName</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">// 惰性单例: 指在需要的时候才创建对象实例.在调用的时候才创建实例,而不是页面加载好的时候就创建</span>
Singleton<span class="token punctuation">.</span>getInstance <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">var</span> instance <span class="token operator">=</span> <span class="token keyword">null</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>instance<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      instance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Singleton</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">return</span> instance
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">var</span> a <span class="token operator">=</span> Singleton<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token string">'test1'</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> b <span class="token operator">=</span> Singleton<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token string">'test2'</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Singleton2'</span><span class="token punctuation">,</span> a <span class="token operator">===</span> b<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>使用 class 的方式进行改写</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">class</span> <span class="token class-name">Singleton</span> <span class="token punctuation">&#123;</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name
  <span class="token punctuation">&#125;</span>
  <span class="token keyword">static</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>Singleton<span class="token punctuation">.</span>instance<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        Singleton<span class="token punctuation">.</span>instance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Singleton</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">return</span> Singleton<span class="token punctuation">.</span>instance
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">const</span> test <span class="token operator">=</span> Singleton2<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token string">'str1'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> test2 <span class="token operator">=</span> Singleton2<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token string">'str2'</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>test<span class="token punctuation">.</span>name<span class="token punctuation">,</span> test2<span class="token punctuation">.</span>name<span class="token punctuation">,</span> test <span class="token operator">===</span> test2<span class="token punctuation">)</span>
<span class="token comment">// str1 str1 true</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h5 id="优化"><a href="#优化" class="headerlink" title="优化"></a>优化</h5><p>透明的单例模式：用户从这个类中创建对象的时候,可以像使用其他任何普通类一样，但是使用了自执行的匿名函数和闭包,增加了程序的复杂度和可读性降低。</p>
<p>使用CreateDiv单例类，它的作用是负责在页面中创建唯一的div节点。</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> CreateDiv <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">var</span> instance
  <span class="token comment">// 构造函数</span>
  <span class="token keyword">var</span> <span class="token function-variable function">CreateDiv</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">html</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>instance<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">return</span> instance
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>html <span class="token operator">=</span> html
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> instance <span class="token operator">=</span> <span class="token keyword">this</span>
  <span class="token punctuation">&#125;</span>
  <span class="token class-name">CreateDiv</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">init</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">var</span> div <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span>
    div<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>html
    document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>div<span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span>

  <span class="token keyword">return</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CreateDiv</span><span class="token punctuation">(</span><span class="token string">'test3'</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> b <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CreateDiv</span><span class="token punctuation">(</span><span class="token string">'test4'</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a <span class="token operator">===</span> b<span class="token punctuation">)</span> <span class="token comment">// true</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="用代理实现单例模式"><a href="#用代理实现单例模式" class="headerlink" title="用代理实现单例模式"></a>用代理实现单例模式</h4><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> <span class="token function-variable function">CreateDiv</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">html</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>html <span class="token operator">=</span> html
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token class-name">CreateDiv</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">init</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
  <span class="token keyword">var</span> div <span class="token operator">=</span> documet<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span>
  div<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>html
  document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>div<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">// 使用代理的方式处理单例逻辑</span>
<span class="token keyword">var</span> ProxySingletonCreateDiv <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
  <span class="token keyword">var</span> instance
  <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">html</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>instance<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
      instance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CreateDiv</span><span class="token punctuation">(</span>html<span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">return</span> instance
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ProxySingletonCreateDiv</span><span class="token punctuation">(</span><span class="token string">'test5'</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> b <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ProxySingletonCreateDiv</span><span class="token punctuation">(</span><span class="token string">'test6'</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a <span class="token operator">===</span> b<span class="token punctuation">)</span> <span class="token comment">// true</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h4 id="注意点"><a href="#注意点" class="headerlink" title="注意点"></a>注意点</h4><ul>
<li><p>创建对象和管理单例的职责被分布在两个不同的方法中，这两个方法组合起来才具有单例模式的威力。</p>
</li>
<li><p>避免设置全局变量。全局变量容易脏成空间污染，容易发生变量名冲突，被其他代码覆盖。</p>
<ul>
<li><p>使用命名空间</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> MyApp <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
MyApp<span class="token punctuation">.</span><span class="token function-variable function">namespace</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">var</span> parts <span class="token operator">=</span> name<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">)</span>
  <span class="token keyword">var</span> current <span class="token operator">=</span> MyApp
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token keyword">in</span> parts<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>current<span class="token punctuation">[</span>parts<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      current<span class="token punctuation">[</span>parts<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
    current <span class="token operator">=</span> current<span class="token punctuation">[</span>parts<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
MyApp<span class="token punctuation">.</span><span class="token function">namespace</span><span class="token punctuation">(</span><span class="token string">'event'</span><span class="token punctuation">)</span>
MyApp<span class="token punctuation">.</span><span class="token function">namespace</span><span class="token punctuation">(</span><span class="token string">'dom.style'</span><span class="token punctuation">)</span>

<span class="token comment">// 等价于</span>
<span class="token keyword">var</span> MyApp <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  <span class="token literal-property property">event</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">dom</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token literal-property property">style</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
<li><p>使用闭包封装私有变量</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> user <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">var</span> __name <span class="token operator">=</span> <span class="token string">'test'</span><span class="token punctuation">,</span>
    __age <span class="token operator">=</span> <span class="token number">29</span>
  <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>
    <span class="token function-variable function">getUserInfo</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">return</span> __name <span class="token operator">+</span> <span class="token string">'-'</span> <span class="token operator">+</span> __age
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ul>
</li>
</ul>
<blockquote>
<p>python 中会约定两个下划线表示私有属性。</p>
<p> <a href="https://zh.wikipedia.org/wiki/%E5%8A%A8%E6%80%81%E8%AF%AD%E8%A8%80">动态编程语言</a>更需要依赖开发者的意识。</p>
</blockquote>
<h3 id="优缺点"><a href="#优缺点" class="headerlink" title="优缺点"></a>优缺点</h3><h4 id="优点"><a href="#优点" class="headerlink" title="优点"></a>优点</h4><ul>
<li>可以保证一个类只有一个实例。</li>
<li> 获得了一个指向该实例的全局访问节点。</li>
<li> 仅在首次请求单例对象时对其进行初始化。</li>
</ul>
<h4 id="缺点"><a href="#缺点" class="headerlink" title="缺点"></a>缺点</h4><ul>
<li> 违反了_单一职责原则_。 该模式同时解决了两个问题。</li>
<li> 单例模式可能掩盖不良设计， 比如程序各组件之间相互了解过多等。</li>
<li> 该模式在多线程环境下需要进行特殊处理， 避免多个线程多次创建单例对象。</li>
<li>中大型项目的应用中，全局变量的维护该是考虑的成本。</li>
</ul>
<h3 id="应用与实践"><a href="#应用与实践" class="headerlink" title="应用与实践"></a>应用与实践</h3><p>在工具库中常见。</p>
<p>比如 vuex 会创建一个全局的 store 仓库，维护全局的 store 数据，所有的相关操作都会依赖这个全局的 store 实例。</p>
<p>在小程序中使用。根据业务需求，比如只需要一个 WebSocket 连接，则就可以创建一个全局 WebSocket 对象，方便进行管理。</p>
<p>使用单例模式可以实现其他复杂的设计模式。</p>
<h3 id="参考文章"><a href="#参考文章" class="headerlink" title="参考文章"></a>参考文章</h3><p>《JavaScript设计模式与开发实践》 -  第4章 单例模式</p>
<p><a href="https://reftoringguru.cn/design-patterns/singleton">https://reftoringguru.cn/design-patterns/singleton</a></p>
]]></content>
      <categories>
        <category>设计模式</category>
      </categories>
      <tags>
        <tag>前端</tag>
        <tag>面试</tag>
        <tag>工具函数</tag>
        <tag>设计模式</tag>
      </tags>
  </entry>
  <entry>
    <title>计算机网络基础理论</title>
    <url>/posts/14112/</url>
    <content><![CDATA[<h3 id="UDP"><a href="#UDP" class="headerlink" title="UDP"></a>UDP</h3><h3 id="TCP"><a href="#TCP" class="headerlink" title="TCP"></a>TCP</h3><p><img src="/./TCP%E3%80%81http%E3%80%81websocket%E5%AF%B9%E6%AF%94.png" alt="URI"></p>
<p>从根本上讲，HTTP还是<strong>半双工</strong>的协议，也就是说，在同一时刻流量只能单向流动：客户端向服务器发送请求（单向），然后服务器响应请求（单向）。半双工的效率很低。</p>
<p>所谓<strong>套接字</strong>( <code>Socket</code> )，就是对网络中不同主机上的应用进程之间进行双向通信的端点的抽象。一个套接字就是网络上进程通信的一端，提供了应用层进程利用网络协议交换数据的机制。从所处的地位来讲，套接字上联应用进程，下联网络协议栈，是应用程序通过网络协议进行通信的接口，是应用程序与网络协议根进行交互的接口</p>
<h4 id="协议模型"><a href="#协议模型" class="headerlink" title="协议模型"></a>协议模型</h4><p><strong><code>TCP/IP</code> 协议模型</strong>只由4个层次组成：链路层、互联网层（<code>IP</code>）、传输层（<code>TCP</code>、<code>WebSocket</code>）和应用层</p>
<p><strong>OSI模型</strong> 由7个层次组成：应用层、表示层、会话层、传输层、网络层、数据链路层、物理层。</p>
<p><img src="/./%E6%A8%A1%E5%9E%8B.jpg" alt="模型"></p>
<blockquote>
<p>TCP/IP 模型合并了 OSI 模型的应用层、表示层和会话层，将 OSI 模型的数据链路层和物理层合并为网络访问层。</p>
</blockquote>
<p>参考连接：</p>
<p><a href="https://arch-long.cn/articles/network/OSI%E6%A8%A1%E5%9E%8BTCPIP%E5%8D%8F%E8%AE%AE%E6%A0%88.html">OSI 模型、TCP/IP 协议栈</a></p>
<h3 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h3><p><a href="https://www.jianshu.com/p/9f3e879a4c9c">一篇文章带你熟悉 TCP/IP 协议（网络协议篇二）</a></p>
]]></content>
      <categories>
        <category>计算机网络</category>
      </categories>
      <tags>
        <tag>计算机网络</tag>
        <tag>TCP</tag>
        <tag>UDP</tag>
        <tag>HTTP</tag>
        <tag>WebSocket</tag>
      </tags>
  </entry>
  <entry>
    <title>跨域问题</title>
    <url>/posts/48274/</url>
    <content><![CDATA[<h3 id="为什么会有跨域问题"><a href="#为什么会有跨域问题" class="headerlink" title="为什么会有跨域问题"></a>为什么会有跨域问题</h3><p>确保<a href="https://developer.mozilla.org/zh-CN/docs/Web/Security">Web安全</a>是十分重要的，避免数据窃取和受到不必要的攻击。所以浏览器中的<a href="https://developer.mozilla.org/zh-CN/docs/Web/Security/Same-origin_policy"><strong>同源策略</strong></a>，限制了一个源（origin）中加载的文档或脚本与其他源（origin）中的资源交互的方式，是为了隔离潜在恶意文档的关键<strong>安全机制</strong>，减少可能被攻击的媒介，是重要的<strong>安全策略</strong>。</p>
<p>同源：如果两个 URL 的 <a href="https://developer.mozilla.org/en-US/docs/Glossary/Protocol">protocol</a>、<a href="https://developer.mozilla.org/en-US/docs/Glossary/Port">port</a> (如果有指定的话)和 <a href="https://developer.mozilla.org/en-US/docs/Glossary/Host">host</a> 都相同的话，则这两个 URL 是<em>同源</em>。这个方案也被称为“协议/主机/端口元组”，或者直接是 “元组”。（“元组” 是指一组项目构成的整体，双重/三重/四重/五重/等的通用形式）。</p>
<p><img src="/./%E5%90%8C%E6%BA%90.jpg" alt="同源"></p>
<h4 id="跨源网络访问"><a href="#跨源网络访问" class="headerlink" title="跨源网络访问"></a>跨源网络访问</h4><p>不同源之间的交互类型：</p>
<ul>
<li><strong>跨域写入</strong>：一般是被允许的。例如链接（links），重定向以及表单提交。特定少数的HTTP请求需要添加 <a href="https://developer.mozilla.org/zh-CN/docs/HTTP/Access_control_CORS#Preflighted_requests">preflight</a>。</li>
<li><strong>跨域资源嵌入</strong>：一般是被允许。例如<code>&lt;srcipt&gt;</code>标签嵌入跨域脚本；<code>&lt;link&gt;</code>标签嵌入CSS，因CSS<a href="https://scarybeastsecurity.blogspot.com/2009/12/generic-cross-browser-cross-domain.html">松散的语法规则</a>跨域需要设置HTTP头部<code>Content-Type</code>；<code>img / video / audio / 插件 / @font-face</code>都可以通过标签引入不同源的资源；<code>iframe</code>标签可以载入任何资源，站点可以设置 <a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/X-Frame-Options"><code>X-Frame-Options</code></a> 阻止跨域，以防<strong>点击劫持攻击</strong>。</li>
<li><strong>跨域读操作</strong>：一般是不被允许的，但常可以通过内嵌资源来巧妙的进行读取访问。例如，你可以读取嵌入图片的高度和宽度，调用内嵌脚本的方法，或<a href="https://grepular.com/Abusing_HTTP_Status_Codes_to_Expose_Private_Information">availability of an embedded resource</a>.</li>
</ul>
<h4 id="阻止跨源访问"><a href="#阻止跨源访问" class="headerlink" title="阻止跨源访问"></a>阻止跨源访问</h4><ul>
<li><p><strong>阻止跨域写操作</strong>：检测请求中的<code>CSRF Token</code>，使用这个标记来阻止页面的跨站读操作。</p>
</li>
<li><p><strong>阻止资源的跨站读取</strong>：需要保证该资源是不可嵌入的。阻止嵌入行为是必须的，因为嵌入资源通常向其暴露信息。</p>
</li>
<li><p><strong>阻止跨站嵌入</strong>：可以使用<code>CSRF Token</code>来防止嵌入。</p>
</li>
</ul>
<blockquote>
<p>csrf - Cross Site Request Forgery - 跨站请求伪造。CSRF Token = Token</p>
</blockquote>
<h3 id="解决跨域问题方案"><a href="#解决跨域问题方案" class="headerlink" title="解决跨域问题方案"></a>解决跨域问题方案</h3><p>一般是解决客户端<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/XMLHttpRequest"><code>XMLHttpRequest</code></a>对象与服务器之间的数据交互的跨源问题。</p>
<p>应用场景较多的时候是前后端分离后联调进行数据交互，大部分时候还是不要开启可跨域方案。</p>
<h4 id="JSONP"><a href="#JSONP" class="headerlink" title="JSONP"></a>JSONP</h4><p>参考链接：<a href="https://www.runoob.com/json/json-jsonp.html">https://www.runoob.com/json/json-jsonp.html</a></p>
<p>利用 <code>&lt;script&gt;</code> 标签没有跨域限制的漏洞，网页可以得到从其他来源动态产生的 <code>JSON</code> 数据。</p>
<p><code>JSONP</code>是<code>json</code>的一种“使用模式”，需要服务端将传输数据包装成<code>JSONP</code>的数据格式，前端可以设置<code>ajax</code>响应数据类型<code>dataType</code>为<code>JSONP</code>类型。</p>
<p><strong>仅支持get方法的请求具有局限性，不安全可能会遭受<code>XSS</code>攻击。</strong></p>
<blockquote>
<p><a href="https://github.com/ljianshu/Blog/tree/master/%E5%A4%9A%E7%A7%8D%E8%B7%A8%E5%9F%9F%E6%96%B9%E5%BC%8F/1.jsonp">JSONP的实现流程</a> </p>
<ul>
<li>声明一个回调函数，其函数名(如show)当做参数值，要传递给跨域请求数据的服务器，函数形参为要获取目标数据(服务器返回的data)。</li>
<li>创建一个<code>&lt;script&gt;</code>标签，把那个跨域的API数据接口地址，赋值给script的src,还要在这个地址中向服务器传递该函数名（可以通过问号传参:?callback=show）。</li>
<li>服务器接收到请求后，需要进行特殊的处理：把传递进来的函数名和它需要给你的数据拼接成一个字符串,例如：传递进去的函数名是show，它准备好的数据是<code>show(&#39;我不爱你&#39;)</code>。</li>
<li>最后服务器把准备的数据通过HTTP协议返回给客户端，客户端再调用执行之前声明的回调函数（show），对返回的数据进行操作。</li>
</ul>
</blockquote>
<h4 id="CORS"><a href="#CORS" class="headerlink" title="CORS"></a>CORS</h4><p>参考链接：<a href="http://www.ruanyifeng.com/blog/2016/04/cors.html">跨域资源共享 CORS 详解 – 阮一峰</a></p>
<p><code>CORS</code>需要浏览器和服务器同时支持。目前，绝大部分浏览器都支持该功能。</p>
<h5 id="简单请求"><a href="#简单请求" class="headerlink" title="简单请求"></a>简单请求</h5><p>满足两大条件就是简单请求：</p>
<ul>
<li>请求方法是<code>HEAD</code>、<code>GET</code>、<code>POST</code>这三种。</li>
<li>HTTP头信息不超出<code>Accept</code>、<code>Accept-Language</code>、<code>Content-Language</code>、<code>Last-Event-ID</code>、<code>Content-Type</code>（仅限于<code>application/x-www-form-unlencoded</code>、<code>multipart/form-data</code>、<code>text/plain</code>）这几种字段。</li>
</ul>
<p>同时满足以上两个条件的就是简单请求，否则就是非简单请求。</p>
<h6 id="浏览器发出CORS简单请求"><a href="#浏览器发出CORS简单请求" class="headerlink" title="浏览器发出CORS简单请求"></a>浏览器发出CORS简单请求</h6><p>具体来说，就是在头信息之中，增加一个<code>Origin</code>字段。<code>Origin</code>字段用来说明，本次请求来自哪个源（协议 + 域名 + 端口）。服务器根据这个值，决定是否同意这次请求。</p>
<p>服务端如果需要<code>CORS</code>请求包含cookie，则必须在AJAX请求中打开<code>withCredentials</code>属性。</p>
<h6 id="服务器处理CORS简单请求"><a href="#服务器处理CORS简单请求" class="headerlink" title="服务器处理CORS简单请求"></a>服务器处理CORS简单请求</h6><p>服务器需要设置响应HTTP头</p>
<pre class="line-numbers language-http" data-language="http"><code class="language-http"><span class="token header"><span class="token header-name keyword">Access-Control-Allow-Origin</span><span class="token punctuation">:</span> <span class="token header-value">http://api.bob.com -- 必须，设置*表示接受任意域名的请求</span></span>
<span class="token header"><span class="token header-name keyword">Access-Control-Allow-Credentials</span><span class="token punctuation">:</span> <span class="token header-value">true -- 可选，表示是否需要cookie，默认情况下cookie不包括在CORS请求中</span></span>
<span class="token header"><span class="token header-name keyword">Access-Control-Expose-Headers</span><span class="token punctuation">:</span> <span class="token header-value">FooBar -- 可选，表示服务端想要获取的Header的字段</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>如果需要发送Cookie，Access-Control-Allow-Origin就不能设置通配符，必须要指定明确的、与请求网页一致的域名。</p>
</blockquote>
<h5 id="非简单请求"><a href="#非简单请求" class="headerlink" title="非简单请求"></a>非简单请求</h5><p>不属于简单请求的请求，就是非简单请求。</p>
<p>如请求方式是<code>PUT</code>、<code>DELETE</code>等，<code>Content-Type</code>字段类型是<code>application/json</code>等。</p>
<h6 id="浏览器发送CORS非简单请求"><a href="#浏览器发送CORS非简单请求" class="headerlink" title="浏览器发送CORS非简单请求"></a>浏览器发送CORS非简单请求</h6><p>非简单请求的<code>CORS</code>请求，会在正式通信之前，增加一次HTTP查询请求，称为”预检”请求（preflight）。会发送正式数据交互之前，发送一个<code>OPTIONS</code>方式的请求，对服务器进行询问当前域名是否在服务器的许可名单之中、可以使用哪些请求方式和头信息字段等。只有服务端回复后，如果不行就直接报错，如果可以浏览器才会发出正式的请求。</p>
<p><code>OPTIONS</code>请求头会包含询问字段</p>
<pre class="line-numbers language-http" data-language="http"><code class="language-http"><span class="token header"><span class="token header-name keyword">Origin</span><span class="token punctuation">:</span> <span class="token header-value">http://api.bob.com -- 表示请求来自哪个源</span></span>
<span class="token header"><span class="token header-name keyword">Access-Control-Request-Method</span><span class="token punctuation">:</span> <span class="token header-value">PUT -- 必须，表示接下来的操作</span></span>
<span class="token header"><span class="token header-name keyword">Access-Control-Request-Headers</span><span class="token punctuation">:</span> <span class="token header-value">X-Custom-Header -- 可选，多个值用逗号隔开，表示会额外发送的头信息字段</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<h6 id="服务器处理CORS非简单请求"><a href="#服务器处理CORS非简单请求" class="headerlink" title="服务器处理CORS非简单请求"></a>服务器处理CORS非简单请求</h6><p>服务器对预检请求OPTIONS做回应</p>
<pre class="line-numbers language-http" data-language="http"><code class="language-http"><span class="token header"><span class="token header-name keyword">Access-Control-Allow-Origin</span><span class="token punctuation">:</span> <span class="token header-value">http://api.bob.com</span></span>
<span class="token header"><span class="token header-name keyword">Access-Control-Allow-Methods</span><span class="token punctuation">:</span> <span class="token header-value">GET, POST, PUT -- 必须，表明服务器支持的所有跨域请求的方法，为了避免多次预检</span></span>
<span class="token header"><span class="token header-name keyword">Access-Control-Allow-Headers</span><span class="token punctuation">:</span> <span class="token header-value">X-Custom-Header -- 与Access-Control-Request-Headers对应，如果请求中有则响应中也必须有</span></span>
<span class="token header"><span class="token header-name keyword">Access-Control-Allow-Credentials</span><span class="token punctuation">:</span> <span class="token header-value">true</span></span>
<span class="token header"><span class="token header-name keyword">Access-Control-Max-Age</span><span class="token punctuation">:</span> <span class="token header-value">1728000 -- 可选，指定本次预检的有效期，如果没有过期再次请求就不会进行预检</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>在部分与CSRF有关的请求中，请求的Header中会携带Origin字段。字段内包含请求的域名（不包含path及query）。</p>
<p>如果Origin存在，那么直接使用Origin中的字段确认来源域名就可以。</p>
<p>但是Origin在以下两种情况下并不存在：</p>
<ul>
<li><strong>IE11同源策略：</strong> IE 11 不会在跨站CORS请求上添加Origin标头，Referer头将仍然是唯一的标识。最根本原因是因为IE 11对同源的定义和其他浏览器有不同，有两个主要的区别，可以参考<a href="https://developer.mozilla.org/en-US/docs/Web/Security/Same-origin_policy#IE_Exceptions">MDN Same-origin_policy#IE_Exceptions</a></li>
<li><strong>302重定向：</strong> 在302重定向之后Origin不包含在重定向的请求中，因为Origin可能会被认为是其他来源的敏感信息。对于302重定向的情况来说都是定向到新的服务器上的URL，因此浏览器不想将Origin泄漏到新的服务器上。</li>
</ul>
<p>解决方案：根据HTTP协议，在HTTP头中有一个<a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Referer">Referer</a>字段，记录了该HTTP请求的来源地址。 对于Ajax请求，图片和script等资源请求，<code>Referer</code>为发起请求的页面地址。对于页面跳转，<code>Referer</code>为打开页面历史记录的前一个页面地址。因此我们使用<code>Referer</code>中链接的Origin部分可以得知请求的来源域名。</p>
<p><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Referrer-Policy">Referrer Policy</a>字段的策略设置成same-origin，对于同源的链接和引用，会发送Referer，referer值为Host不带Path；跨域访问则不携带Referer。</p>
<p>以上相关内容参考链接：<a href="https://tech.meituan.com/2018/10/11/fe-security-csrf.html">https://tech.meituan.com/2018/10/11/fe-security-csrf.html</a></p>
</blockquote>
<h4 id="服务器转发"><a href="#服务器转发" class="headerlink" title="服务器转发"></a>服务器转发</h4><p>前端一般常用<code>Node</code>进行服务器代理中间件。原理与其他服务器相同。</p>
<p>同源策略仅在客户端生效，所以服务器可以进行多个源数据的请求。</p>
<ul>
<li>接受同源的客户端请求。</li>
<li>将请求转发给目标服务器。</li>
<li>拿到目标服务器的数据返回。</li>
<li>将目标服务器的数据返回给同源的客户端。</li>
<li>不一定必须同源，可以是中间转发服务器设置CORS。</li>
</ul>
<p>前端常用方法，使用<code>node</code>环境下的<code>http-server</code>实现请求转发。</p>
<blockquote>
<p>webpack中的devServer.proxy就是使用webpack-dev-server起一个本地服务器进行代理。</p>
</blockquote>
<h4 id="Nginx反向代理"><a href="#Nginx反向代理" class="headerlink" title="Nginx反向代理"></a>Nginx反向代理</h4><p>需要设置<code>nginx</code>的服务器设置。<code>nginx</code>接受到了客户端的请求，直接转发到目标服务器，目标服务器返回的数据又会被代理返回客户端。</p>
<p>通过<code>nginx</code>配置一个代理服务器（域名与<code>domain1</code>相同，端口不同）做跳板机，反向代理访问<code>domain2</code>接口，并且可以顺便修改<code>cookie</code>中<code>domain</code>信息，方便当前域<code>cookie</code>写入，实现跨域登录。</p>
<pre class="line-numbers language-none"><code class="language-none">&#x2F;&#x2F; proxy服务器
server &#123;
    listen       81;
    server_name  www.domain1.com;
    location &#x2F; &#123;
        proxy_pass   http:&#x2F;&#x2F;www.domain2.com:8080;  #反向代理
        proxy_cookie_domain www.domain2.com www.domain1.com; #修改cookie里域名
        index  index.html index.htm;

        # 当用webpack-dev-server等中间件代理接口访问nignx时，此时无浏览器参与，故没有同源限制，下面的跨域配置可不启用
        add_header Access-Control-Allow-Origin http:&#x2F;&#x2F;www.domain1.com;  #当前端只跨域不带cookie时，可为*
        add_header Access-Control-Allow-Credentials true;
    &#125;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h4 id="window-postMessage"><a href="#window-postMessage" class="headerlink" title="window.postMessage"></a><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Window/postMessage">window.postMessage</a></h4><p>可以安全地实现跨源通信。通常，对于两个不同页面的脚本，只有当执行它们的页面位于具有相同的协议，端口号，以及主机 (两个页面的模数 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Document/domain"><code>Document.domain</code></a>设置为相同的值) 时，这两个脚本才能相互通信。<code>window.postMessage()</code>方法提供了一种受控机制来规避此限制，只要正确的使用，这种方法就很安全。</p>
<p>可以用于解决的问题：</p>
<ul>
<li>页面和其打开的新窗口的数据传递（<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Window/open">window.open()</a> / <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Window/opener">window.opener</a>）</li>
<li>多窗口之间消息传递</li>
<li>页面与嵌套的<code>iframe</code>消息传递</li>
<li>上面三个场景的跨域数据传递</li>
</ul>
<p><strong>postMessage()方法允许来自不同源的脚本采用异步方式进行有限的通信，可以实现跨文本档、多窗口、跨域消息传递</strong>。</p>
<blockquote>
<p>部分小程序框架的<code>web-view</code>和<code>h5</code>页面进行通信使用的就是<code>window.postMessage()</code>。</p>
</blockquote>
<h4 id="WebSocket"><a href="#WebSocket" class="headerlink" title="WebSocket"></a>WebSocket</h4><p><code>Websocket</code>是<code>HTML5</code>的一个持久化的协议，它实现了浏览器与服务器的全双工通信，同时也是跨域的一种解决方案。</p>
<p><code>WebSocket</code>和<code>HTTP</code>都是应用层协议，都基于 TCP 协议。</p>
<p><strong><code>WebSocket</code> 是一种双向通信协议，在建立连接之后，<code>WebSocket</code> 的 server 与 client 都能主动向对方发送或接收数据</strong>。同时，<code>WebSocket</code> 在建立连接时需要借助 HTTP 协议，连接建立好了之后 client 与 server 之间的双向通信就与 HTTP 无关了。</p>
<h4 id="iframe"><a href="#iframe" class="headerlink" title="iframe"></a>iframe</h4><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Window/name">window.name</a>：窗口的名字主要用于为超链接和表单设置目标（targets）。窗口不需要有名称。</p>
<p><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Location/hash">location.hash</a></p>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>myAnchor<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/en-US/docs/Location.href#Examples<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Examples<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">var</span> anchor <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"myAnchor"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>anchor<span class="token punctuation">.</span>hash<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 返回'#Examples'</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><ul>
<li><code>CORS</code>支持所有类型的HTTP请求，是跨域HTTP请求的根本解决方案。</li>
<li><code>JSONP</code>只支持GET请求，<code>JSONP</code>的优势在于支持老式浏览器，以及可以向不支持<code>CORS</code>的网站请求数据。</li>
<li>服务器转发和<code>nginx</code>反向代理，主要是通过同源策略对服务器不加限制。</li>
<li>前后端生产环境下常用的跨域方案是<code>cors</code>和<code>nginx</code>反向代理。</li>
</ul>
<h3 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h3><p><a href="https://segmentfault.com/a/1190000015597029">不要再问我跨域的问题了 – segmentfault</a></p>
<p><a href="https://developer.mozilla.org/zh-CN/docs/Web/Security/Same-origin_policy">浏览器的同源策略 – MDN</a></p>
<p><a href="https://juejin.cn/post/6844903767226351623">九种跨域方式实现原理（完整版）– 掘金</a></p>
]]></content>
      <categories>
        <category>前端</category>
      </categories>
      <tags>
        <tag>前端</tag>
        <tag>面试</tag>
        <tag>浏览器</tag>
        <tag>跨域</tag>
        <tag>常见问题</tag>
      </tags>
  </entry>
  <entry>
    <title>常用网站整理</title>
    <url>/posts/ffce8ba0/</url>
    <content><![CDATA[<h2 id="学习网站"><a href="#学习网站" class="headerlink" title="学习网站"></a>学习网站</h2><h3 id="参考合集"><a href="#参考合集" class="headerlink" title="参考合集"></a>参考合集</h3><p>涨姿势了！22 个拓展程序员技术与视野的国外网站：<a href="https://juejin.cn/post/6931728259080339469">https://juejin.cn/post/6931728259080339469</a></p>
<h2 id="扩展"><a href="#扩展" class="headerlink" title="扩展"></a>扩展</h2><h3 id="视野-amp-趋势"><a href="#视野-amp-趋势" class="headerlink" title="视野 &amp; 趋势"></a>视野 &amp; 趋势</h3><p>state of js：<a href="https://stateofjs.com/">https://stateofjs.com/</a></p>
<h3 id="常用网络资源"><a href="#常用网络资源" class="headerlink" title="常用网络资源"></a>常用网络资源</h3><h4 id="图片"><a href="#图片" class="headerlink" title="图片"></a>图片</h4><p>dog 图片：<a href="https://dog.ceo/dog-api/">https://dog.ceo/dog-api/</a></p>
<h3 id="工具"><a href="#工具" class="headerlink" title="工具"></a>工具</h3><h4 id="开发"><a href="#开发" class="headerlink" title="开发"></a>开发</h4><p>一键取名：<a href="https://unbug.github.io/codelf/">https://unbug.github.io/codelf/</a></p>
<p>雪碧图生成：<a href="https://www.toptal.com/developers/css/sprite-generator">https://www.toptal.com/developers/css/sprite-generator</a></p>
<p>图片压缩：<a href="https://tinypng.com/">https://tinypng.com/</a></p>
<h4 id="在线编码"><a href="#在线编码" class="headerlink" title="在线编码"></a>在线编码</h4><p>参考链接： <a href="https://www.zhihu.com/question/31731104">前端常用的几种在线代码编辑器各有什么优势？ - 知乎</a></p>
<p><a href="https://segmentfault.com/a/1190000018407482">程序猿专用十大在线编译器(IDE)整理 - segmentfault</a></p>
<p>codepen：<a href="https://codepen.io/">https://codepen.io/</a></p>
<p>jsbin：<a href="https://jsbin.com/?html,output">https://jsbin.com/?html,output</a></p>
<p>Jsfiddle</p>
<p>CodeSandbox</p>
<p>github 使用在线 vscode 打开：</p>
<p>在url上将github的链接后面加1s，如：<code>https://github1s.com/Datura35422/study/tree/master/webpack-demos</code></p>
<p><a href="https://github.com/conwnet/github1s">https://github.com/conwnet/github1s</a></p>
<h4 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h4><p>在线 git emoji 参考：<a href="https://gitmoji.dev/">https://gitmoji.dev/</a></p>
<h4 id="画图-amp-展示"><a href="#画图-amp-展示" class="headerlink" title="画图 &amp; 展示"></a>画图 &amp; 展示</h4><h5 id="code-展示"><a href="#code-展示" class="headerlink" title="code 展示"></a>code 展示</h5><p>参考链接： <a href="https://cloud.tencent.com/developer/article/1729304">https://cloud.tencent.com/developer/article/1729304</a></p>
<p>carbon.now.sh：<a href="https://carbon.now.sh/">https://carbon.now.sh/</a></p>
<p>codeimg.io：<a href="https://codeimg.io/">https://codeimg.io/</a></p>
<blockquote>
<p>vscode 插件：codesnap</p>
</blockquote>
<h5 id="画图"><a href="#画图" class="headerlink" title="画图"></a>画图</h5><p>excalidraw：<a href="https://excalidraw.com/">https://excalidraw.com/</a></p>
<blockquote>
<p>可以自己画好看的流程图</p>
</blockquote>
<p>asciiflow：<a href="https://asciiflow.com/">https://asciiflow.com/</a></p>
<blockquote>
<p>可以输出文本的结构图</p>
</blockquote>
<h2 id="前端"><a href="#前端" class="headerlink" title="前端"></a>前端</h2><h3 id="特效"><a href="#特效" class="headerlink" title="特效"></a>特效</h3><p>特效工具合集：<a href="https://simular.co/resources/type/effects-tools.html">https://simular.co/resources/type/effects-tools.html</a></p>
<h3 id="CSS"><a href="#CSS" class="headerlink" title="CSS"></a>CSS</h3><h4 id="snippets"><a href="#snippets" class="headerlink" title="snippets"></a>snippets</h4><p>csseffects: <a href="https://emilkowalski.github.io/css-effects-snippets/">https://emilkowalski.github.io/css-effects-snippets/</a></p>
<p><a href="https://boguz.github.io/Spinners/">https://boguz.github.io/Spinners/</a></p>
<p>loading：</p>
<p><a href="https://loading.io/spinner/">https://loading.io/spinner/</a></p>
<p><a href="https://tobiasahlin.com/spinkit/">https://tobiasahlin.com/spinkit/</a></p>
<p><a href="https://icons8.com/cssload/en/spinners">https://icons8.com/cssload/en/spinners</a></p>
<h4 id="animation"><a href="#animation" class="headerlink" title="animation"></a>animation</h4><p><a href="https://waitanimate.wstone.io/#!/#%2F">https://waitanimate.wstone.io/#!/#%2F</a></p>
<h4 id="在线code"><a href="#在线code" class="headerlink" title="在线code"></a>在线code</h4><p><a href="https://cssdeck.com/popular">https://cssdeck.com/popular</a></p>
<h4 id="社区"><a href="#社区" class="headerlink" title="社区"></a>社区</h4><p><a href="https://css-tricks.com/">https://css-tricks.com/</a></p>
<p><a href="https://tympanus.net/codrops/">https://tympanus.net/codrops/</a></p>
<h4 id="其他-1"><a href="#其他-1" class="headerlink" title="其他"></a>其他</h4><p><a href="https://zhuanlan.zhihu.com/p/129042825">https://zhuanlan.zhihu.com/p/129042825</a></p>
<h3 id="DEMO"><a href="#DEMO" class="headerlink" title="DEMO"></a>DEMO</h3><p>demo学习合集: <a href="https://github.com/local-host-8080/demo-html-css">https://github.com/local-host-8080/demo-html-css</a></p>
<p><a href="https://segmentfault.com/a/1190000018036227">12个令人惊叹的CSS实验项目</a></p>
]]></content>
      <categories>
        <category>整理</category>
      </categories>
      <tags>
        <tag>前端</tag>
        <tag>合集</tag>
      </tags>
  </entry>
  <entry>
    <title>快应用与微信小程序的区别</title>
    <url>/posts/45150/</url>
    <content><![CDATA[<h3 id="一、区别"><a href="#一、区别" class="headerlink" title="一、区别"></a>一、区别</h3><h4 id="1-开发前准备"><a href="#1-开发前准备" class="headerlink" title="1. 开发前准备"></a>1. 开发前准备</h4><table>
<thead>
<tr>
<th></th>
<th>微信小程序</th>
<th>快应用</th>
</tr>
</thead>
<tbody><tr>
<td>开发账号准备</td>
<td>（发布前非必需）<br />微信公众平台注册申请微信小程序账号</td>
<td>（发布前非必需）<br />快应用官网注册，<br />需要绑定厂商开发者账号（至少一家）</td>
</tr>
<tr>
<td>开发环境</td>
<td>PC端：需要下载微信小程序IDE，进行预览小程序<br />手机端：需要下载微信APP</td>
<td>PC端：需要安装10.0+版本的nodejs、hap-toolkit，快应用开发IDE（非必需）<br />手机端：需要下载快应用调试器APK，多个快应用需要下载快应用预览版</td>
</tr>
<tr>
<td>开发语言</td>
<td>wxml、wxss、js脚本、wxs<br /></td>
<td>html、css、js脚本<br />开发规范与vue相近</td>
</tr>
<tr>
<td>调试预览</td>
<td>微信小程序IDE中进行预览和调试</td>
<td>快应用开发IDE中进行预览和调试<br />或在其他IDE中开发完成通过命令行进行编译后使用浏览器打开生成的预览地址，通过浏览器开发者模式进行调试<br />或使用手机连接USB进行预览</td>
</tr>
</tbody></table>
<blockquote>
<p>补充</p>
</blockquote>
<p>快应用账号申请流程图</p>
<p><img src="https://doc.quickapp.cn/tutorial/overview/images/join.jpg" alt="https://doc.quickapp.cn/tutorial/overview/images/join.jpg"></p>
<h5 id="hap-toolkit安装："><a href="#hap-toolkit安装：" class="headerlink" title="hap-toolkit安装："></a>hap-toolkit安装：</h5><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> <span class="token parameter variable">-g</span> hap-toolkit
hap <span class="token parameter variable">-v</span> // 查看当前版本，安装成功后会有版本号<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<h5 id="快应用项目调试（安装rpk包）："><a href="#快应用项目调试（安装rpk包）：" class="headerlink" title="快应用项目调试（安装rpk包）："></a>快应用项目调试（安装rpk包）：</h5><h6 id="1-启动HTTP服务器-默认端口为8000"><a href="#1-启动HTTP服务器-默认端口为8000" class="headerlink" title="1.启动HTTP服务器(默认端口为8000)"></a>1.启动HTTP服务器(默认端口为8000)</h6><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">npm</span> run server<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>自定义端口</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">npm</span> run server -- <span class="token parameter variable">--port</span> <span class="token number">8888</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h6 id="2-打开手机扫码安装（pc端和手机端在同一个局域网内，否则用USB连接）"><a href="#2-打开手机扫码安装（pc端和手机端在同一个局域网内，否则用USB连接）" class="headerlink" title="2.打开手机扫码安装（pc端和手机端在同一个局域网内，否则用USB连接）"></a>2.打开手机扫码安装（pc端和手机端在同一个局域网内，否则用USB连接）</h6><p>打开手机上的<code>快应用调试器</code> –&gt; 点击<code>扫码安装</code></p>
<p>扫描启动服务器生成的http链接上的二维码进行安装</p>
<p>点击<code>在线更新</code>唤起平台运行rpx包</p>
<blockquote>
<p>注意</p>
</blockquote>
<p><strong>快应用</strong>：<a href="mailto:&#x68;&#97;&#x70;&#45;&#x74;&#x6f;&#x6f;&#x6c;&#107;&#x69;&#116;&#64;&#x30;&#46;&#51;">&#x68;&#97;&#x70;&#45;&#x74;&#x6f;&#x6f;&#x6c;&#107;&#x69;&#116;&#64;&#x30;&#46;&#51;</a>及其以后的版本不再支持 NodeJS v8.0 以下的版本)</p>
<h4 id="2-开发框架"><a href="#2-开发框架" class="headerlink" title="2. 开发框架"></a>2. 开发框架</h4><h5 id="1-创建项目"><a href="#1-创建项目" class="headerlink" title="(1)创建项目"></a>(1)创建项目</h5><p><strong>微信小程序</strong>：微信小程序IDE中创建项目</p>
<p><strong>快应用</strong>：快应用开发IDE中创建项目，或命令行创建初始化项目</p>
<blockquote>
<p>快应用项目命令行初始化</p>
</blockquote>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">// 初始化项目
hap init <span class="token operator">&lt;</span>projectName<span class="token operator">></span>
// 安装依赖
<span class="token builtin class-name">cd</span> projectName
<span class="token function">npm</span> <span class="token function">install</span>
// 编译项目
<span class="token function">npm</span> run build
// 自动编译项目
<span class="token function">npm</span> run <span class="token function">watch</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>build：临时产出，包含编译后的页面js、图片等</p>
<p>dist：最终产出，包含rpk文件</p>
<h6 id="快应用发布前打包"><a href="#快应用发布前打包" class="headerlink" title="快应用发布前打包"></a>快应用发布前打包</h6><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">npm</span> run build<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h6 id="增加release签名"><a href="#增加release签名" class="headerlink" title="增加release签名"></a>增加release签名</h6><p>通过openssl命令等工具生成签名文件<code>private.pem</code>、<code>certificate.pem</code></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">openssl req <span class="token parameter variable">-newkey</span> rsa:2048 <span class="token parameter variable">-nodes</span> <span class="token parameter variable">-keyout</span> private.pem <span class="token parameter variable">-x509</span> <span class="token parameter variable">-days</span> <span class="token number">3650</span> <span class="token parameter variable">-out</span> certificate.pem<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>在工程的 sign 目录下创建 release 目录，将私钥文件 private.pem 和证书文件 certificate.pem 拷贝进去</p>
<h6 id="发布程序包"><a href="#发布程序包" class="headerlink" title="发布程序包"></a>发布程序包</h6><p>发布程序包前需要<code>增加release签名</code>，然后在工程的根目录下运行</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">npm</span> run release<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>生成的应用路径为/dist/.release.rpk</p>
<p>如果需要临时使用 debug 签名，可以使用</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">npm</span> run release -- <span class="token parameter variable">--debug</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>注意: debug 签名由于是公开的，安全性无法保证，一定不要使用 debug 签名签发正式上线的应用</p>
<h5 id="2-项目结构"><a href="#2-项目结构" class="headerlink" title="(2)项目结构"></a>(2)项目结构</h5><p><strong>微信小程序</strong>：</p>
<pre class="line-numbers language-none"><code class="language-none">├── pages                     页面文件夹
│   └── index                 页面文件目录，页面名和文件名相同
│       ├── index.js          页面脚本逻辑文件，需要和页面名相同
│       ├── index.json        页面配置文件，需要和页面名相同
│       ├── index.wxml        页面模板文件，需要和页面名相同
│       └── index.wxss        页面样式文件，需要和页面名相同
├── utils
│   ├── util.js               公用的资源
├── app.js                    小程序公共脚本逻辑
├── app.json                  小程序全局配置
├── app.wxss                  小程序全局样式
└── package.config.json       小程序工具配置<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>注意</p>
</blockquote>
<ul>
<li><p><strong>wxml</strong>文件：由标签、属性等等完成页面结构，类似于<code>html</code>，但有特殊标签、组件和属性</p>
</li>
<li><p><strong>wxss</strong>文件：完成页面的样式，具有<code>css</code>大部分的特性，新增了<code>rpx</code>尺寸单位</p>
</li>
</ul>
<p><strong>快应用</strong>：</p>
<pre class="line-numbers language-none"><code class="language-none">├── sign                      rpk包签名模块
│   └── debug                 调试环境
│       ├── certificate.pem   证书文件
│       └── private.pem       私钥文件
├── src                       项目源文件夹
│   ├── Common                公用的资源和组件文件
│       └── logo.png          应用图标
│   ├── Demo                  页面目录
│       └── index.ux          页面文件，可自定义页面名称
│   ├── Doc
│       └── Layout            页面目录，存放各自页面私有的资源文件和组件文件
│           └── index.ux     页面文件，文件名不必与父文件夹相同（推荐index.ux）
│   ├── app.ux                APP文件，可引入公共脚本，暴露公共数据和方法等
│   └── manifest.json         项目配置文件，配置应用图标、页面路由等
└── package.json              定义项目需要的各种模块及配置信息<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>注意</p>
</blockquote>
<ul>
<li><p><strong>sign</strong>：签名模块，当前仅有<code>debug</code>签名，如果内测上线，请添加<code>release</code>文件夹，增加线上签名；签名生成方法详见文档<a href="https://doc.quickapp.cn/tutorial/overview/use-command.html#%E5%8F%91%E5%B8%83%E5%89%8D%E6%89%93%E5%8C%85">使用命令行，发布前打包</a></p>
</li>
<li><p><strong>ux</strong>文件：文件中代码的书写方式类似于<code>vue</code>，<code>&lt;template&gt;</code>标签中写<code>html</code>页面结构，<code>&lt;script&gt;</code>标签中写<code>js</code>逻辑部分，<code>&lt;style&gt;</code>标签中写css样式部分，使用<code>less</code>需要在<code>&lt;style&gt;</code>标签中声明<code>lang=&quot;less&quot;</code></p>
</li>
</ul>
<table>
<thead>
<tr>
<th></th>
<th>微信小程序</th>
<th>快应用</th>
</tr>
</thead>
<tbody><tr>
<td>代码结构</td>
<td>页面代码是分开的，页面的结构、逻辑和样式在不同的文件中</td>
<td>页面代码是在一个<code>ux</code>文件中，支持import和require</td>
</tr>
<tr>
<td>页面配置</td>
<td><code>app.json</code>全局配置和<code>page.json</code>页面配置</td>
<td><code>manifest.json</code>配置文件中进行全局配置和页面配置</td>
</tr>
<tr>
<td>框架指令</td>
<td><code>wx:if</code>、<code>wx:elif</code>、<code>wx:else</code>、<code>wx:for</code>、<code>wx:show</code></td>
<td><code>if</code>、<code>elif</code>、<code>else</code>、<code>for</code>、<code>show</code></td>
</tr>
<tr>
<td>组件</td>
<td>有模板和自定义组件两种方式<br />引入模板的方式：<code>import</code>和<code>include</code><br />引入组件的方式：在<code>page.json</code>中声明后使用</td>
<td>有模板和自定义组件两种方式<br />两者都需要使用<code>&lt;import&gt;</code>标签导入后使用</td>
</tr>
<tr>
<td>组件通信</td>
<td>父组件通过属性的方式将数据传递给子组件<br />子组件的触发事件使用<code>triggerEvent</code>方法传递数据和父组件监听子组件事件传递数据</td>
<td>父组件通过属性和$broadcast()的方式将数据传递给子组件<br />子组件通过$dispatch()或通过$emit()节点绑定的事件进行通信</td>
</tr>
<tr>
<td>组件样式</td>
<td><code>:host选择器</code>指定组件所在节点的默认样式<br />组件样式隔离，在<code>options</code>中配置<code>styleIsolation</code>选项</td>
<td>可以设置css作用域</td>
</tr>
<tr>
<td>事件触发</td>
<td><code>bind-*</code>属性、<code>catch-*</code>属性绑定响应事件</td>
<td><code>on-*</code>绑定响应事件</td>
</tr>
<tr>
<td>事件监听</td>
<td></td>
<td><code>$on</code> 用于监听自定义事件；<br /><code>$off</code>移除对应的事件监听；<br /><code>$emitElement()</code>完成事件的动态触发</td>
</tr>
<tr>
<td>页面跳转</td>
<td>通过api进行页面跳转</td>
<td>使用组件<code>&lt;a&gt;</code>进行跳转，或通过router进行跳转<br /></td>
</tr>
<tr>
<td>API</td>
<td>可以直接使用api</td>
<td>需要在配置文件<code>manifest.json</code>中声明后，在页面文件中进行<code>import</code>或<code>require</code>导入才能使用</td>
</tr>
<tr>
<td>async</td>
<td>原生不支持<code>async</code></td>
<td>支持使用ES6语法</td>
</tr>
</tbody></table>
<blockquote>
<p> 相同部分：</p>
</blockquote>
<p>数据绑定方式相同，都有<code>&lt;block&gt;</code>组件，动态修改样式方式相同，组件的slot</p>
<blockquote>
<p>注意</p>
</blockquote>
<p><strong>微信小程序</strong>：</p>
<ul>
<li>自定义组件中，接受一个 <code>Object</code> 类型的参数。</li>
</ul>
<p><strong>快应用</strong>：</p>
<ul>
<li><p>自定义变量表示 for 指令的数组索引和数组元素时，变量名不可以用<code>$</code>或<code>_</code>开头。</p>
</li>
<li><p>快应用中<code>mainfest.json</code>中<code>widgets</code>为负一屏卡片概念，但是每个厂商的样式和规格不同要有所区别。</p>
</li>
<li><p>快应用中有<code>public</code>、<code>protected</code>、<code>private</code>概念，注意不能和data属性同时使用。子组件中只能使用data。子组件中的数据名称避免和父组件中的数据名称相同，可能会父组件覆盖子组件的数据出现错误。</p>
</li>
<li><p>if/elif/else 节点必须是相邻的兄弟节点。</p>
</li>
<li><p>子组件数据传递属性名称使用驼峰方式定义，父组件传递时使用“-”连接。</p>
</li>
<li><p><strong>组件通信</strong>：</p>
<p><em>父组件向子组件传递数据</em>：父组件通过属性传递数据；父组件通过<code>$broadcast()</code>方式传递数据。</p>
<p><em>子组件向父组件传递数据</em>：子组件通过<code>$dispatch()</code>完成事件触发，父组件通过<code>$on()</code>绑定的事件并响应（适用于祖孙组件传递数据）；子组件通过<code>$emit()</code>触发在节点上绑定的事件来执行父组件的方法。</p>
<p><em>双向事件传递</em>：</p>
<p>向下传递：父组件触发，子组件响应；调用<code>parentVm.$broadcast()</code>完成向下传递，<br>向上传递：子组件触发，父组件响应；调用<code>childVm.$dispath()</code>完成向上传递。</p>
<p>触发时传递参数，再接收时使用<code>evt.detail</code>来获取参数；</p>
<p>当传递结束后，可以调用<code>evt.stop()</code>来结束传递。</p>
</li>
<li><p>组件<code>a</code>还提供调起电话、短信、邮件的功能和加载网页的能力。</p>
</li>
<li><p><code>router</code>使用前需要导入模块<code>import router from &#39;@system.router&#39;</code></p>
</li>
<li><p>页面跳转：若希望参数允许被应用外部请求传递的数据覆盖，请在页面的 <code>ViewModel </code>的<code>public</code>属性中声明使用的属性</p>
</li>
</ul>
<h5 id="3-生命周期"><a href="#3-生命周期" class="headerlink" title="(3)生命周期"></a>(3)生命周期</h5><p><strong>微信小程序</strong>：</p>
<ul>
<li><p><strong>APP生命周期</strong>：<code>onLaunch</code>、<code>onShow</code>、<code>onHide</code>、<code>onError</code></p>
</li>
<li><p><strong>页面生命周期</strong>：<code>onLoad</code>、<code>onReady</code>、<code>onShow</code>、<code>onHide</code>、<code>onUnload</code>、<code>onPullDownRefresh</code>、<code>onReachBottom</code>、<code>onShareAppMessage</code>、<code>onPageScroll</code>、<code>onResize</code>、<code>onTabItemTap</code></p>
</li>
</ul>
<p><strong>快应用</strong>：</p>
<ul>
<li><p><strong>APP 的生命周期</strong>：<code>onCreate</code>、<code>onDestroy</code></p>
</li>
<li><p><strong>页面的生命周期</strong>：<code>onInit</code>、<code>onReady</code>、<code>onShow</code>、<code>onHide</code>、<code>onDestroy</code>、<code>onBackPress</code>、<code>onMenuPress</code>  </p>
</li>
</ul>
<h5 id="4-样式与布局"><a href="#4-样式与布局" class="headerlink" title="(4)样式与布局"></a>(4)样式与布局</h5><table>
<thead>
<tr>
<th></th>
<th>微信小程序</th>
<th>快应用</th>
</tr>
</thead>
<tbody><tr>
<td>盒模型</td>
<td>默认content-box</td>
<td>框架使用 border-box 模型，<br />暂不支持 content-box 模型与 box-sizing 属性</td>
</tr>
<tr>
<td>长度单位</td>
<td>rpx: 可以根据屏幕宽度进行自适应。规定屏幕宽为750rpx。<br />1rpx = 0.5px = 1物理像素</td>
<td>框架目前仅支持长度单位<code>px</code>和<code>%</code>。与传统 web 页面不同，<code>px</code>是相对于<code>项目配置基准宽度</code>的单位，已经适配了移动端屏幕，其原理类似于<code>rem</code><br />设计稿1px / 设计稿基准宽度 = 框架样式1px / 项目配置基准宽度</td>
</tr>
<tr>
<td>选择器</td>
<td><code>内联样式</code>、<code>tag选择器</code>、<code>class选择器</code>、<code>id选择器</code>、<code>并列选择</code>、<code>:after选择器</code>、<code>:before选择器</code></td>
<td><code>内联样式</code>、<code>tag选择器</code>、<code>class选择器</code>、<code>id选择器</code>、<code>并列选择</code>、<code>后代选择器</code></td>
</tr>
<tr>
<td>预编译</td>
<td>不支持预编译</td>
<td>支持less、postcss，需要相应的环境配置</td>
</tr>
</tbody></table>
<blockquote>
<p>注意</p>
</blockquote>
<p><strong>微信小程序</strong>：开发微信小程序时设计师可以用 iPhone6 作为视觉稿的标准。在较小的屏幕上不可避免的会有一些毛刺，请在开发时尽量避免这种情况。</p>
<p><strong>快应用</strong>：<code>项目配置基准宽度</code>：项目的配置文件（<code>&lt;ProjectName&gt;/src/manifest.json</code>）中<code>config.designWidth</code>的值，默认为 750</p>
<h4 id="3-其他"><a href="#3-其他" class="headerlink" title="3.其他"></a>3.其他</h4><table>
<thead>
<tr>
<th></th>
<th>微信小程序</th>
<th>快应用</th>
</tr>
</thead>
<tbody><tr>
<td>打开方式</td>
<td>微信中打开<br />小程序之间跳转<br />微信中服务通知打开</td>
<td>应用商店打开<br />通过连接从外部打开应用<br />H5 页面中可以通过调用接口跳转到应用（注意兼容）</td>
</tr>
<tr>
<td>分包加载</td>
<td>同一个分包中的页面享有共同的预下载大小限额 2M，限额会在工具中打包时校验。</td>
<td>整个快应用的所有分包大小不超过 4M 单个分包/基础包大小不能超过 1M</td>
</tr>
</tbody></table>
<blockquote>
<p>注意</p>
</blockquote>
<p><strong>快应用</strong>：分包注意低版本兼容，推荐采用编译时兼容方式。</p>
<h3 id="二、参考链接"><a href="#二、参考链接" class="headerlink" title="二、参考链接"></a>二、参考链接</h3><p>微信小程序官网：<a href="https://developers.weixin.qq.com/miniprogram/dev/">https://developers.weixin.qq.com/miniprogram/dev/</a></p>
<p>快应用官网：<a href="https://doc.quickapp.cn/">https://doc.quickapp.cn/</a></p>
<p>华为快应用文档：<a href="https://developer.huawei.com/consumer/cn/service/hms/catalog/fastapp.html?page=fastapp_fastapp_api_reference_card">https://developer.huawei.com/consumer/cn/service/hms/catalog/fastapp.html?page=fastapp_fastapp_api_reference_card</a></p>
]]></content>
      <categories>
        <category>整理</category>
      </categories>
      <tags>
        <tag>前端</tag>
        <tag>微信小程序</tag>
        <tag>快应用</tag>
      </tags>
  </entry>
  <entry>
    <title>前端性能监控系统</title>
    <url>/posts/43591/</url>
    <content><![CDATA[<h4 id=""><a href="#" class="headerlink" title=""></a></h4><h4 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h4><p><a href="http://fex.baidu.com/blog/2014/05/build-performance-monitor-in-7-days/">7 天打造前端性能监控系统</a></p>
<p>lighthouse </p>
]]></content>
      <categories>
        <category>前端</category>
      </categories>
      <tags>
        <tag>前端</tag>
        <tag>面试</tag>
        <tag>优化</tag>
        <tag>性能</tag>
      </tags>
  </entry>
  <entry>
    <title>基础系列-DOM</title>
    <url>/posts/a5a8e7d1/</url>
    <content><![CDATA[<p>参考阅读：</p>
<p>MDN</p>
<p>《JavaScript 高级程序设计-第四版》- 第15章</p>
<h3 id="DOM（文档对象模型）"><a href="#DOM（文档对象模型）" class="headerlink" title="DOM（文档对象模型）"></a>DOM（文档对象模型）</h3><p>dom 是针对 HTML 和 XML 文档的一个 API（应用程序编程接口）。</p>
<h4 id="节点层次"><a href="#节点层次" class="headerlink" title="节点层次"></a>节点层次</h4><p>dom 可以将任何HTML或XML文档描绘成一个由多层节点构成的结构。</p>
<p>节点分为几种不同的类型，每种类型分别表示文档中不同的信息及标记。</p>
<p>每个节点都拥有各自的特点、数据和方法，另外也与其他节点存在某种关系。</p>
<p>节点之间的关系构成了层次，而所有页面标记则表现为一个以特定节点为根节点的树形结构。</p>
<p>文档节点是每个文档的根节点。<code>&lt;html&gt;</code>元素是文档元素，文档元素是文档的最外层元素，文档中其他所有元素都包含在文档元素中。</p>
<h3 id="Node类型"><a href="#Node类型" class="headerlink" title="Node类型"></a>Node类型</h3><p>DOM1级定义了一个Node接口，改接口将由DOM中的所有节点类型实现。</p>
<p>JavaScript 中的所有节点类型都继承自Node类型，因此所有节点类型都共享着相同的基本属性和方法。</p>
<p>每个节点都有一个nodeType属性，用于表明节点的类型。</p>
<p>以下接口都从 <code>Node</code> 继承其方法和属性：</p>
<p><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Document"><code>Document</code></a>, <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Element"><code>Element</code></a>, <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Attr"><code>Attr</code></a>, <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/CharacterData"><code>CharacterData</code></a> (which <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Text"><code>Text</code></a>, <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Comment"><code>Comment</code></a>, and <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/CDATASection"><code>CDATASection</code></a> inherit), <a href="https://developer.mozilla.org/en-US/docs/Web/API/ProcessingInstruction"><code>ProcessingInstruction</code> (en-US)</a>, <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/DocumentFragment"><code>DocumentFragment</code></a>, <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/DocumentType"><code>DocumentType</code></a>, <code>Notation</code>, <code>Entity</code>, <code>EntityReference</code></p>
<p>在方法和属性不相关的特定情况下，这些接口可能返回 <code>null</code>。它们可能会抛出异常 - 例如，当将子节点添加到不允许子节点存在的节点时。</p>
<p>类数组NodeList 是实时的活动对象，是一直变化的。</p>
<h4 id="属性"><a href="#属性" class="headerlink" title="属性"></a>属性</h4><p>parentNode</p>
<p>childNodes</p>
<p>nodeName：对于元素而言，始终等于元素的标签名</p>
<p>nodeValue：对于元素而言，始终为null</p>
<p>previousSibling</p>
<p>nextSibling</p>
<p>firstChild</p>
<p>lastChild</p>
<p>ownerDocument：是一个指向代表整个文档的文档节点的指针。</p>
<h4 id="方法"><a href="#方法" class="headerlink" title="方法"></a>方法</h4><p>hasChildNodes()</p>
<p>appendChild()</p>
<p>insertBefore()：如果参照节点是null，则和appendChild()结果相同</p>
<p>replaceChild()：要插入的节点和要替换的节点</p>
<p>removeChild()：要移除的节点</p>
<p>cloneNode()：传入布尔值，表示深拷贝还是浅拷贝。深拷贝则会拷贝子元素，浅拷贝只会拷贝当前元素。</p>
<p>normalize()：标准化文本节点，如果是空文本节点则删除，如果是两个相邻的同胞节点则合并为一个文本节点。</p>
<h3 id="Document-类型"><a href="#Document-类型" class="headerlink" title="Document 类型"></a>Document 类型</h3><p>继承 Node 类型。</p>
<p>Document 类型是 JavaScript 中表示文档节点的类型。</p>
<p>文档对象 document 是 HTMLDocument 的实例，表示整个 HTML 页面。（HTMLDocument 继承 Document）</p>
<p>document 是 window 对象的属性，因此是一个全局对象。</p>
<p><code>&lt;html&gt;</code>元素获取：document.documentElement 或 document.childNodes[0] 或 document.firstChild</p>
<p><code>&lt;body&gt;</code>元素获取：document.body</p>
<p>Document 类型是只读的，只能有一个 Element 类型的子节点，即<code>&lt;html&gt;</code>。</p>
<h4 id="属性："><a href="#属性：" class="headerlink" title="属性："></a>属性：</h4><p>URL</p>
<p>domain</p>
<p>referrer</p>
<p>anchors：获取文档中所有带 name 属性的 <code>&lt;a&gt;</code> 元素</p>
<p>forms：获取文档中所有 <code>&lt;form&gt;</code> 元素</p>
<p>images：获取文档中所有 <code>&lt;img&gt;</code> 元素</p>
<p>links：获取文档中所有带 href 属性的 <code>&lt;a&gt;</code> 元素</p>
<p>implementation：提供了与浏览器 DOM 实现相关的信息和能力</p>
<p>classList：返回一个类数组 DOMTokenList 的实例，可以便捷增删改切换 className。</p>
<h4 id="方法："><a href="#方法：" class="headerlink" title="方法："></a>方法：</h4><p>getElementById</p>
<p>getElementsByTagName，返回类数组HTMLCollection对象。取得文档所有对象可以使用通配符 * ，getElementsByTagName(*)</p>
<blockquote>
<p>HTMLCollection 对象有namedItem() 通过 name 属性获取某一项的引用，也可以使用数字索引或字符串索引，数字索引会调用 item()，字符串索引会调用namedItem()</p>
</blockquote>
<p>getElementsByName</p>
<p>write，写入文本</p>
<p>writeIn，写入文本后会自动追加一个换行符</p>
<p>open，打开网页输出流</p>
<p>close，关闭网页输出流</p>
<p>querySelector：接受 CSS 选择器参数，返回匹配改模式的第一个后代元素，如果没有匹配项则返回null。会从document（文档）开始搜索</p>
<p>querySelectorAll</p>
<p>getElementsByClassName：返回匹配一个类或多个类的 NodeList。</p>
<h3 id="Element-类型"><a href="#Element-类型" class="headerlink" title="Element 类型"></a>Element 类型</h3><p>Element 类型继承 Node 类型。</p>
<p>Element 表示 XML 或 HTML 元素，对外暴露出访问元素标签名、子节点和属性的能力。</p>
<p>可以通过 nodeName 或 tagName 属性来获取元素的标签名。</p>
<p>所有 HTML 元素都通过 HTMLElement 类型表示，包括其直接实例和间接实例。所有HTML元素都是HTMLElement 或其子类型的实例。</p>
<p>HTMLElement 直接继承 Element 并增加了一些属性。</p>
<h4 id="属性-1"><a href="#属性-1" class="headerlink" title="属性"></a>属性</h4><p>id</p>
<p>title</p>
<p>lang</p>
<p>dir</p>
<p>className</p>
<p>attributes：属性包含一个类数组 NamedNodeMap 实例</p>
<blockquote>
<p>NamedNodeMap 对象包含下列方法：</p>
<p>getNamedItem(name)，返回 nodeName 属性等于 name 的节点</p>
<p>removeNamedItem(name)，删除 nodeName 属性等于 name 的节点</p>
<p>setNamedItem(node)，向列表中添加 attr node 节点，以其 nodeName 为索引。创建属性节点：document.createAttribute()</p>
</blockquote>
<h4 id="方法-1"><a href="#方法-1" class="headerlink" title="方法"></a>方法</h4><p>getAttribute</p>
<p>setAttribute</p>
<p>removeAttribute</p>
<blockquote>
<p>属性名不区分大小写</p>
</blockquote>
<p>querySelector：接受 CSS 选择器参数，返回匹配改模式的第一个后代元素，如果没有匹配项则返回null。会从当前Element的后台开始搜索。</p>
<p>querySelectorAll：返回一个 NodeList 静态实例。</p>
<p>matches：接受一个CSS选择符参数，如果元素匹配则该选择器返回 true，否则返回 false。</p>
<p>find - 浏览器未实现</p>
<p>findAll - 浏览器未实现</p>
<p>面试题：</p>
<p>HTMLElement、Element、Node 之间的关系</p>
]]></content>
      <categories>
        <category>前端</category>
        <category>基础</category>
      </categories>
      <tags>
        <tag>前端</tag>
        <tag>面试</tag>
        <tag>基础</tag>
      </tags>
  </entry>
  <entry>
    <title>基础系列-JS数据类型</title>
    <url>/posts/7930/</url>
    <content><![CDATA[<h3 id="基本数据类型"><a href="#基本数据类型" class="headerlink" title="基本数据类型"></a>基本数据类型</h3><p>指简单的数据段。基本数据类型存储在<strong>栈内存</strong>中。</p>
<p>不能给基础数据类型添加属性。</p>
<ul>
<li>存储原始数据类型</li>
<li>按值访问</li>
<li>存储的值大小固定</li>
<li>由系统自动分配内存空间</li>
<li>空间小，运行效率高</li>
<li>先进后出，后进先出</li>
</ul>
<h4 id="String"><a href="#String" class="headerlink" title="String"></a>String</h4><h4 id="Number"><a href="#Number" class="headerlink" title="Number"></a>Number</h4><h4 id="Boolean"><a href="#Boolean" class="headerlink" title="Boolean"></a>Boolean</h4><h4 id="Null"><a href="#Null" class="headerlink" title="Null"></a>Null</h4><h4 id="Undefined"><a href="#Undefined" class="headerlink" title="Undefined"></a>Undefined</h4><h4 id="Symbol"><a href="#Symbol" class="headerlink" title="Symbol"></a>Symbol</h4><h4 id="BigInt"><a href="#BigInt" class="headerlink" title="BigInt"></a>BigInt</h4><h3 id="引用数据类型"><a href="#引用数据类型" class="headerlink" title="引用数据类型"></a>引用数据类型</h3><p>指可能由多个值构成的对象。引用数据类型存储在<strong>堆内存</strong>中。</p>
<p>js 不能直接操作对象的内存空间。实际上是在操作对象的引用而不是实际的对象。</p>
<ul>
<li>存储引用数据类型</li>
<li>按引用地址访问</li>
<li>存储的值大小不定，可动态调整</li>
<li>由代码进行指定分配</li>
<li>空间大，运行效率相对较低</li>
<li>无序存储，可根据引用直接获取</li>
</ul>
<h4 id="Object"><a href="#Object" class="headerlink" title="Object"></a>Object</h4><p>null 为特殊引用类型，指针指向空地址。</p>
<p>function 是特殊的object，特殊引用类型，但不用于存储数据，所以没有“拷贝、复制”一说。</p>
<h3 id="类型判断"><a href="#类型判断" class="headerlink" title="类型判断"></a>类型判断</h3><h4 id="typeof"><a href="#typeof" class="headerlink" title="typeof"></a><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/typeof">typeof</a></h4><p><strong><code>typeof</code></strong> 操作符返回一个字符串，表示未经计算的操作数的类型。</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">typeof</span> <span class="token string">'a'</span> <span class="token comment">// 'string'</span>
<span class="token keyword">typeof</span> <span class="token number">123</span> <span class="token comment">// 'number'</span>
<span class="token keyword">typeof</span> <span class="token boolean">true</span> <span class="token comment">// 'boolean'</span>
<span class="token keyword">typeof</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token comment">// 'object'</span>
<span class="token keyword">typeof</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span> <span class="token comment">// 'object'</span>
<span class="token keyword">typeof</span> <span class="token keyword">null</span> <span class="token comment">// 'object'</span>
<span class="token keyword">typeof</span> <span class="token keyword">undefined</span> <span class="token comment">// 'undefined'</span>
<span class="token keyword">typeof</span> <span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 'symbol'</span>
<span class="token keyword">typeof</span> <span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>toString <span class="token comment">// 'function'</span>
<span class="token keyword">typeof</span> <span class="token operator">/</span><span class="token number">1232</span><span class="token operator">/</span> <span class="token comment">// 'object'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h4 id="instanceof"><a href="#instanceof" class="headerlink" title="instanceof"></a><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/instanceof">instanceof</a></h4><p><strong><code>instanceof</code></strong> <strong>运算符</strong>用于检测构造函数的 <code>prototype</code> 属性是否出现在某个<strong>实例</strong>对象的原型链上。</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token string">'abc'</span> <span class="token keyword">instanceof</span> <span class="token class-name">String</span> <span class="token comment">// false</span>
<span class="token number">123</span> <span class="token keyword">instanceof</span> <span class="token class-name">Number</span> <span class="token comment">// false</span>
<span class="token number">123</span> <span class="token keyword">instanceof</span> <span class="token class-name">Number</span> <span class="token comment">// false</span>

<span class="token boolean">true</span> <span class="token keyword">instanceof</span> <span class="token class-name">Boolean</span> <span class="token comment">// false</span>
<span class="token function">Boolean</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token keyword">instanceof</span> <span class="token class-name">Boolean</span> <span class="token comment">// false</span>
<span class="token keyword">new</span> <span class="token class-name">Boolean</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">instanceof</span> <span class="token class-name">Boolean</span> <span class="token comment">// true</span>
<span class="token keyword">new</span> <span class="token class-name">Boolean</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">instanceof</span> <span class="token class-name">Object</span> <span class="token comment">// true</span>

<span class="token keyword">null</span> <span class="token keyword">instanceof</span> <span class="token class-name">Object</span> <span class="token comment">// false</span>
<span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">instanceof</span> <span class="token class-name">Symbol</span> <span class="token comment">// false</span>
<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token keyword">instanceof</span> <span class="token class-name">Object</span> <span class="token comment">// true</span>
<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token keyword">instanceof</span> <span class="token class-name">Array</span> <span class="token comment">// true</span>
<span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>toString <span class="token keyword">instanceof</span> <span class="token class-name">Function</span> <span class="token comment">// true</span>
<span class="token operator">/</span><span class="token number">1232</span><span class="token operator">/</span> <span class="token keyword">instanceof</span> <span class="token class-name">RegExp</span> <span class="token comment">// true</span>
<span class="token operator">/</span><span class="token number">1232</span><span class="token operator">/</span> <span class="token keyword">instanceof</span> <span class="token class-name">Obejct</span> <span class="token comment">// true</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>注意对象包装器问题，<code>String()</code>、<code>Boolean()</code>、<code>Number()</code>等对象包装器，如果使用<code>new</code>进行构建，得到的是对象。</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Boolean</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token operator">!</span>a<span class="token punctuation">)</span> <span class="token comment">// false, 此时的a是对象 对象本身是truthy</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>参考链接：<a href="https://github.com/getify/You-Dont-Know-JS/blob/1ed-zh-CN/types%20%26%20grammar/ch3.md">《你不懂JS：类型与文法》第三章：原生类型</a></p>
<h4 id="Object-prototype-toString-原型链的方式"><a href="#Object-prototype-toString-原型链的方式" class="headerlink" title="Object.prototype.toString() 原型链的方式"></a><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object/toString">Object.prototype.toString()</a> 原型链的方式</h4><p>每个对象都有一个 <code>toString()</code> 方法，当该对象被表示为一个文本值时，或者一个对象以预期的字符串方式引用时自动调用。默认情况下，<code>toString()</code> 方法被每个 <code>Object</code> 对象继承。如果此方法在自定义对象中未被覆盖，<code>toString()</code> 返回 “[object <em>type</em>]”，其中 <code>type</code> 是对象的类型。以下代码说明了这一点：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> o <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
o<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// '[object Object]'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>可以通过 <code>toString()</code> 来获取每个对象的类型。为了每个对象都能通过 <code>Object.prototype.toString()</code> 来检测，需要以 <code>Function.prototype.call()</code> 或者 <code>Function.prototype.apply()</code> 的形式来调用，传递要检查的对象作为第一个参数，称为 <code>thisArg</code>。</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> toString <span class="token operator">=</span> <span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>toString<span class="token punctuation">;</span>

<span class="token function">toString</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// '[object String]'</span>
<span class="token function">toString</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// '[object String]'</span>
<span class="token function">toString</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Number</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// '[object Number]'</span>
<span class="token function">toString</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token number">123</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// '[object Number]'</span>
<span class="token function">toString</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Boolean</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// '[object Boolean]'</span>
<span class="token function">toString</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// '[object Boolean]'</span>
<span class="token function">toString</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// '[object Array]'</span>
<span class="token function">toString</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// '[object Object]'</span>
<span class="token function">toString</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// '[object Function]' </span>
<span class="token function">toString</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>Math<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// '[object Math]'</span>
<span class="token function">toString</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// '[object Date]'</span>

<span class="token comment">//Since JavaScript 1.8.5</span>
<span class="token function">toString</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">undefined</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// '[object Undefined]'</span>
<span class="token function">toString</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// '[object Null]'</span>

<span class="token keyword">function</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>arguments<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// '[object Arguments]'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>Arguments类数组</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> arguments<span class="token punctuation">)</span> <span class="token comment">// 'object'</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arguments <span class="token keyword">instanceof</span> <span class="token class-name">Object</span><span class="token punctuation">)</span> <span class="token comment">// true</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arguments <span class="token keyword">instanceof</span> <span class="token class-name">Array</span><span class="token punctuation">)</span> <span class="token comment">// false</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>arguments<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// '[object Arguments]'</span>
<span class="token punctuation">&#125;</span>
<span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>Symbol.toStringTag 可以定制’[object tag]’中的tag值</p>
<p>对象的<code>Symbol.toStringTag</code>属性，指向一个方法。在该对象上面调用<code>Object.prototype.toString</code>方法时，如果这个属性存在，它的返回值会出现在<code>toString</code>方法返回的字符串之中，表示对象的类型。也就是说，这个属性可以用来定制<code>[object Object]</code>或<code>[object Array]</code>中<code>object</code>后面的那个字符串。</p>
<p>参考链接：<a href="https://es6.ruanyifeng.com/#docs/symbol">https://es6.ruanyifeng.com/#docs/symbol</a></p>
</blockquote>
<h5 id="学习链接"><a href="#学习链接" class="headerlink" title="学习链接"></a>学习链接</h5><p><a href="https://juejin.cn/post/6844903477940846600">谈谈 Object.prototype.toString – 掘金</a></p>
]]></content>
      <categories>
        <category>前端</category>
        <category>基础</category>
      </categories>
      <tags>
        <tag>前端</tag>
        <tag>面试</tag>
        <tag>基础</tag>
      </tags>
  </entry>
  <entry>
    <title>基础系列-ECMAScript规范</title>
    <url>/posts/37130/</url>
    <content><![CDATA[<h3 id="ECMAScript"><a href="#ECMAScript" class="headerlink" title="ECMAScript"></a>ECMAScript</h3><p>ECMA是一个将信息标准化的组织。JavaScript被提交到ECMA进行标准化，由此诞生了一个新的语言标准，也就是我们所知道的ECMAScript。JavaScript是该标准（最流行）的一个实现。</p>
<p>检查各个浏览器中哪些ES6/ES6+特性可用：<a href="http://kangax.github.io/compat-table/es6/">http://kangax.github.io/compat-table/es6/</a></p>
<blockquote>
<p>can i use: <a href="https://caniuse.com/?search=rem">https://caniuse.com/?search=rem</a></p>
</blockquote>
<p>兼容ES6+的插件：<code>babel</code>、<code>polyfill</code>、<code>babel-cli</code></p>
<h4 id="使用babel编译ES6-代码"><a href="#使用babel编译ES6-代码" class="headerlink" title="使用babel编译ES6+代码"></a>使用babel编译ES6+代码</h4><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">npm</span> i babel-cli babel-preset-env <span class="token parameter variable">-D</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><code>babel</code> 编译插件，<code>babel-runtime</code> 和 <code> babel-plugin-transform-runtime</code> 的区别是，相当一前者是手动而后者是自动，每当要转译一个api时都要手动加上 <code>require(&#39;babel-runtime&#39;)</code>。其中 <code>babel-plugin-transform-runtime</code> 是在 <code>babel-runtime</code> 的基础上运行</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">npm</span> i <span class="token parameter variable">-S</span> babel-plugin-transform-runtime babel-runtime<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>安装后，新建<code>.babelrc</code>配置文件，进行配置</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>
    <span class="token property">"presets"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">[</span>
            <span class="token string">"env"</span><span class="token punctuation">,</span>
            <span class="token punctuation">&#123;</span>
                <span class="token property">"targets"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
                    <span class="token property">"node"</span><span class="token operator">:</span> <span class="token string">"current"</span>
                <span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">"plugins"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">[</span>
            <span class="token string">"transform-runtime"</span><span class="token punctuation">,</span>
            <span class="token punctuation">&#123;</span>
                <span class="token property">"polyfill"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
            	<span class="token property">"regenerator"</span><span class="token operator">:</span> <span class="token boolean">true</span>
            <span class="token punctuation">&#125;</span> 
        <span class="token punctuation">]</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>配置当前node环境后，在package.json中新增命令行使用，在此之前需要进行安装<code>nodemon</code>和<code>rimraf</code>包</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token property">"scripts"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token property">"dev"</span><span class="token operator">:</span> <span class="token string">"nodemon -w src --exec \"bable-node src --presets env\""</span><span class="token punctuation">,</span>
    <span class="token property">"build"</span><span class="token operator">:</span> <span class="token string">"rimraf dist &amp;&amp; babel src -s -D -d dist --presets env"</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p><code>npm run dev</code> 自动运行 <code>src</code> 目录下的编译后的<code>index.js</code>文件。<code>npm run build</code>自动将<code>dist</code>文件删除之后，重新编译项目放到<code>dist</code>文件中。</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> --save-dev babel-core babel-preset-es2015 babel-preset-latest
<span class="token function">npm</span> <span class="token function">install</span> --save-dev webpack babel-loader<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>



<h3 id="ES6"><a href="#ES6" class="headerlink" title="ES6"></a>ES6</h3><p>参考链接：<a href="https://262.ecma-international.org/6.0/">https://262.ecma-international.org/6.0/</a></p>
<p><img src="/posts/37130/ES2015.jpg" alt="ES2015"></p>
<h4 id="let与const"><a href="#let与const" class="headerlink" title="let与const"></a>let与const</h4><ul>
<li>在for循环中，如<code>for(let i = 0; i &lt; length; i++)</code>中let的作用域在for循环中，for循环里和循环外都不影响。</li>
<li>ES6 允许块级作用域的任意嵌套。外层作用域无法读取内层作用域的变量。内层作用域可以定义外层作用域的同名变量。</li>
<li>块级作用域的出现，实际上使得获得广泛应用的立即执行函数表达式（IIFE）不再必要了。</li>
<li>块级作用域与函数声明：允许在块级作用域内声明函数；函数声明类似于<code>var</code>，即会提升到全局作用域或函数作用域的头部；同时，函数声明还会提升到所在的块级作用域的头部。<strong>考虑到环境导致的行为差异太大，应该避免在块级作用域内声明函数。如果确实需要，也应该写成函数表达式，而不是函数声明语句。ES6 的块级作用域允许声明函数的规则，只在使用大括号的情况下成立。</strong></li>
</ul>
<blockquote>
<p>变量提升：一个普通块内部的函数声明通常会被提升到<strong>所在作用域的顶部</strong>。</p>
<p>函数声明会被首先提升，然后才是变量。</p>
<p>为什么会变量提升？</p>
<p>如 var a = 2，var a 发生在编译阶段，a = 2 发生在执行阶段。意味着无论作用域中的声明出现在什么地方，都将在代码本身被执行前首先进行处理。</p>
<p>声明本身会被提升，而包括函数表达式的赋值在内的赋值操作并不会提升。</p>
</blockquote>
<h4 id="变量的解构赋值"><a href="#变量的解构赋值" class="headerlink" title="变量的解构赋值"></a>变量的解构赋值</h4><ul>
<li><p>数组解构，<code>let [a, b, c] = [1, 2, 3];</code>常规用法，分<strong>完全解构</strong>和<strong>不完全解构</strong>。等号右边的值必须是可遍历结构。转为对象以后或本身不具备 Iterator 接口都会出错。转为对象以后不具备 Iterator 接口如<code>1, false, NaN, undefind, null</code>，本身不具备 Iterator 接口如<code>&#123;&#125;</code></p>
</li>
<li><p>默认值，<strong>ES6 内部使用严格相等运算符（<code>===</code>），判断一个位置是否有值</strong>，因此只有当一个数组成员严格等于<code>undefined</code>，默认值才会生效。如果默认值是一个表达式，那么这个表达式是惰性求值的，即只有在用到的时候，才会求值。<strong>默认值可以引用解构赋值的其他变量，但该变量必须已经声明。</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 默认值为常量</span>
<span class="token keyword">let</span> <span class="token punctuation">[</span>x <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token keyword">undefined</span><span class="token punctuation">]</span> <span class="token comment">// x = 1</span>
<span class="token keyword">let</span> <span class="token punctuation">[</span>x <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token comment">// x = 2</span>
<span class="token keyword">let</span> <span class="token punctuation">&#123;</span>x<span class="token punctuation">,</span> y <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token literal-property property">x</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">&#125;</span> <span class="token comment">// x = 1, y = 5</span>

<span class="token comment">// 默认值为表达式</span>
<span class="token keyword">function</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'run f()'</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">let</span> <span class="token punctuation">[</span>x <span class="token operator">=</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token comment">// x会等于1，不会进行默认值计算</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token comment">// 1</span>
<span class="token punctuation">[</span>x <span class="token operator">=</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token keyword">undefined</span><span class="token punctuation">]</span> <span class="token comment">// run f() 会进行默认值计算</span>

<span class="token comment">// 嵌套赋值</span>
<span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token literal-property property">foo</span><span class="token operator">:</span> obj<span class="token punctuation">.</span>prop<span class="token punctuation">,</span> <span class="token literal-property property">bar</span><span class="token operator">:</span> arr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">foo</span><span class="token operator">:</span> <span class="token number">123</span><span class="token punctuation">,</span> <span class="token literal-property property">bar</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 注意使用() js会将&#123;&#125;认为是代码块所以要用()包裹</span>
obj <span class="token comment">// &#123;prop:123&#125;</span>
arr <span class="token comment">// [true]</span>

<span class="token keyword">let</span> <span class="token punctuation">&#123;</span> p<span class="token punctuation">,</span> <span class="token literal-property property">p</span><span class="token operator">:</span> <span class="token punctuation">[</span>x<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> y <span class="token punctuation">&#125;</span><span class="token punctuation">]</span> <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">p</span><span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token string">'Hello'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">y</span><span class="token operator">:</span> <span class="token string">'World'</span> <span class="token punctuation">&#125;</span> <span class="token punctuation">]</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token comment">// p = [ 'Hello', &#123; y: 'World' &#125; ], x = 'hello' y = 'World'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
<li><p>可以取到继承的属性，类似于<code>in</code></p>
</li>
<li><p>其他类型解构。如果等号右边是数值和布尔值，会先转为对象。</p>
</li>
</ul>
<h5 id="应用："><a href="#应用：" class="headerlink" title="应用："></a>应用：</h5><ul>
<li><p>交换变量的值。</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> y <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token punctuation">[</span>x<span class="token punctuation">,</span> y<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>y<span class="token punctuation">,</span> x<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// x = 2, y = 1</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li>
<li><p>从函数返回多个值。</p>
</li>
<li><p>函数参数的定义。</p>
</li>
<li><p>提取JSON的值。</p>
</li>
<li><p>函数参数的默认值。</p>
</li>
<li><p>遍历 Map 结构，便利取出key， value</p>
</li>
<li><p>输入模块的指定方法</p>
</li>
</ul>
<h4 id="字符串扩展"><a href="#字符串扩展" class="headerlink" title="字符串扩展"></a>字符串扩展</h4><ul>
<li><p>字符的Unicode表示法，如 <code>&#39;\u0061&#39;</code> 等价于 <code>&#39;a&#39;</code>。但是仅限于码点在 <code>\u0000</code> ~ <code>\uFFFF</code> 之间的字符。超出这个范围的字符，必须用双字节的形式表示。</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 表示一个字符</span>
<span class="token string">'\z'</span> <span class="token operator">===</span> <span class="token string">'z'</span>  <span class="token comment">// true</span>
<span class="token string">'\172'</span> <span class="token operator">===</span> <span class="token string">'z'</span> <span class="token comment">// true</span>
<span class="token string">'\x7A'</span> <span class="token operator">===</span> <span class="token string">'z'</span> <span class="token comment">// true</span>
<span class="token string">'\u007A'</span> <span class="token operator">===</span> <span class="token string">'z'</span> <span class="token comment">// true</span>
<span class="token string">'\u&#123;7A&#125;'</span> <span class="token operator">===</span> <span class="token string">'z'</span> <span class="token comment">// true</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
<li><p>字符串的遍历器接口。可以使用 <code>for...of</code> 进行遍历，可以识别大于 <code>0xFFFF</code> 的码点，而传统的 <code>for</code> 循环不能识别。</p>
</li>
<li><p>模板字符串。</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 1. 基础使用</span>
<span class="token keyword">const</span> foo <span class="token operator">=</span> <span class="token string">'xxxx'</span>
<span class="token keyword">const</span> printTxt <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">print: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>foo<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span>
<span class="token keyword">const</span> printBool <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">print bool: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span> <span class="token number">1</span> <span class="token operator">></span> <span class="token number">0</span> <span class="token operator">?</span> <span class="token string">'yes'</span> <span class="token operator">:</span> <span class="token string">'no'</span><span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span>

<span class="token comment">// 2. 标签模板字符串：可以通过模板字符串的方式对一个函数进行调用</span>
<span class="token keyword">function</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>
test<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">aaaa</span><span class="token template-punctuation string">`</span></span>
test<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">print: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>foo<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span>

<span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> b <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>

tag<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Hello </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span> a <span class="token operator">+</span> b <span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string"> world </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span> a <span class="token operator">*</span> b <span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
<span class="token comment">// 等同于</span>
<span class="token function">tag</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'Hello '</span><span class="token punctuation">,</span> <span class="token string">' world '</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
<li><p><code>String.raw()</code> 是模板字符串的标签函数，返回给定模板字符串的元素字符串，即返回一个斜杠都被转义的字符串。</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">String<span class="token punctuation">.</span>raw<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Hi\n</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span><span class="token number">2</span><span class="token operator">+</span><span class="token number">3</span><span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">!</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
<span class="token comment">// 'Hi\n5!'，Hi 后面的字符不是换行符，\ 和 n 是两个不同的字符</span>

String<span class="token punctuation">.</span>raw <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Hi\u000A!</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
<span class="token comment">// "Hi\u000A!"，同上，这里得到的会是 \、u、0、0、0、A 6个字符，</span>
<span class="token comment">// 任何类型的转义形式都会失效，保留原样输出，不信你试试.length</span>

<span class="token keyword">let</span> name <span class="token operator">=</span> <span class="token string">"Bob"</span><span class="token punctuation">;</span>
String<span class="token punctuation">.</span>raw <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Hi\n</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>name<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">!</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
<span class="token comment">// "Hi\nBob!"，内插表达式还可以正常运行</span>


<span class="token comment">// 正常情况下，你也许不需要将 String.raw() 当作函数调用。</span>
<span class="token comment">// 但是为了模拟 `t$&#123;0&#125;e$&#123;1&#125;s$&#123;2&#125;t` 你可以这样做:</span>
String<span class="token punctuation">.</span><span class="token function">raw</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token literal-property property">raw</span><span class="token operator">:</span> <span class="token string">'test'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 't0e1s2t'</span>
<span class="token comment">// 注意这个测试, 传入一个 string, 和一个类似数组的对象</span>
<span class="token comment">// 下面这个函数和 `foo$&#123;2 + 3&#125;bar$&#123;'Java' + 'Script'&#125;baz` 是相等的.</span>
String<span class="token punctuation">.</span><span class="token function">raw</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
  <span class="token literal-property property">raw</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'foo'</span><span class="token punctuation">,</span> <span class="token string">'bar'</span><span class="token punctuation">,</span> <span class="token string">'baz'</span><span class="token punctuation">]</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">2</span> <span class="token operator">+</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">'Java'</span> <span class="token operator">+</span> <span class="token string">'Script'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 'foo5barJavaScriptbaz'</span>

<span class="token comment">// Polyfill</span>
String<span class="token punctuation">.</span><span class="token function-variable function">raw</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">strings<span class="token punctuation">,</span> <span class="token operator">...</span>values</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">let</span> output <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> index<span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span>index <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> index <span class="token operator">&lt;</span> values<span class="token punctuation">.</span>length<span class="token punctuation">;</span> index<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    output <span class="token operator">+=</span> strings<span class="token punctuation">.</span>raw<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">+</span> values<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>

  output <span class="token operator">+=</span> strings<span class="token punctuation">.</span>raw<span class="token punctuation">[</span>index<span class="token punctuation">]</span>
  <span class="token keyword">return</span> output<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
<li><p><code>String.fromCharPoint()</code>，将字符的 <code>Unicode</code> 码点返回对应字符。</p>
<p>与之相似功能的有ES5的 <code>String.fromCharCode()</code> ，但是不能识别大于 <code>0xFFFF</code> ，ES6刚好弥补了这点。</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">String<span class="token punctuation">.</span><span class="token function">fromCodePoint</span><span class="token punctuation">(</span><span class="token number">0x20BB7</span><span class="token punctuation">)</span>
<span class="token comment">// "𠮷" </span>
String<span class="token punctuation">.</span><span class="token function">fromCodePoint</span><span class="token punctuation">(</span><span class="token number">0x78</span><span class="token punctuation">,</span> <span class="token number">0x1f680</span><span class="token punctuation">,</span> <span class="token number">0x79</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">'x\uD83D\uDE80y'</span> <span class="token comment">// 多个参数合并成一个字符串</span>
<span class="token comment">// true</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></li>
<li><p><code>String.prototype.codePointAt(pos)</code> ，返回一个 <code>Unicode</code> 码点的非负整数，用于处理码点大于 <code>0xFFFF</code> 的字符，能够正确处理返回一个字符的码点。</p>
<p>与之相似功能的有ES5的 <code>String.prototype.charCodeAt(pos)</code> 返回给定索引处的 <code>UTF-16</code> 代码单元整数。</p>
<blockquote>
<p>JavaScript 内部，字符以 UTF-16 的格式存储，每个字符固定为 2 个字节，对于需要 4个字节存储的字符，JavaScript会认为是两个字符。</p>
</blockquote>
</li>
<li><p><code>String.prototype.normalize([form])</code> 用来将字符的不同表示方法统一为同样的形式，这称为 Unicode 正规化。</p>
</li>
<li><p><code>String.prototype.includes(searchString[, pos])</code> 返回布尔值，表示是否找到了参数字符串。</p>
</li>
<li><p><code>String.prototype.startsWith(searchString[, pos])</code> 返回布尔值，表示参数字符串是否在原字符串的头部或从目标位置开始查询。</p>
</li>
<li><p><code>String.prototype.endsWith(searchString[, pos])</code> 返回布尔值，表示参数字符串是否在原字符串的尾部或从目标位置开始查询。</p>
</li>
<li><p><code>String.prototype.repeat(count)</code> 返回一个新字符串，表示将原字符串重复n次。</p>
</li>
</ul>
<h4 id="正则扩展"><a href="#正则扩展" class="headerlink" title="正则扩展"></a>正则扩展</h4><ul>
<li><p>构造函数 RegExp()。<code>var regex = new RegExp(/xyz/, &#39;i&#39;)</code>，第二个参数会重置第一个参数设置过的flags。</p>
</li>
<li><p><code>u</code> 修饰符，用来正确处理大于 \uFFFF的 Unicode 字符。</p>
<blockquote>
<p>ES6 中新增了使用大括号表示 Unicode 字符</p>
</blockquote>
</li>
<li><p><code>RegExp.prototype.unicode</code> 属性，表示是否设置了 <code>u</code> 修饰符。</p>
</li>
<li><p><code>y</code> 修饰符，全局匹配。每次匹配都是从剩余字符串的第一位开始。</p>
<p>可以指定 <code>lastIndex</code> 属性，表示开始匹配位。</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 使用</span>
<span class="token keyword">var</span> s <span class="token operator">=</span> <span class="token string">'aaa_aa_a'</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> r1 <span class="token operator">=</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">a+</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">;</span> <span class="token comment">// g 修饰符只要剩余位置中存在匹配就可</span>
<span class="token keyword">var</span> r2 <span class="token operator">=</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">a+</span><span class="token regex-delimiter">/</span><span class="token regex-flags">y</span></span><span class="token punctuation">;</span> <span class="token comment">// y 修饰符确保匹配必须从剩余的第一个位置开始</span>

r1<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token comment">// ["aaa"]</span>
r2<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token comment">// ["aaa"]</span>

r1<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token comment">// ["aa"]</span>
r2<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token comment">// null</span>


<span class="token comment">//  y 粘性模式和 matchAll() 互相替换</span>
<span class="token comment">// y粘性模式</span>
<span class="token keyword">const</span> <span class="token function-variable function">matchYWay</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">str</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> reg <span class="token operator">=</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\[[\u4e00-\u9fa5|a-zA-Z]*\]</span><span class="token regex-delimiter">/</span><span class="token regex-flags">y</span></span>
  <span class="token keyword">let</span> match <span class="token operator">=</span> <span class="token keyword">null</span>
  <span class="token keyword">while</span> <span class="token punctuation">(</span>match <span class="token operator">=</span> reg<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
     console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>match<span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">// matchAll方式</span>
<span class="token keyword">const</span> <span class="token function-variable function">matchAllWay</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">str</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> reg <span class="token operator">=</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\[[\u4e00-\u9fa5|a-zA-Z]*\]</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> match <span class="token keyword">of</span> str<span class="token punctuation">.</span><span class="token function">matchAll</span><span class="token punctuation">(</span>reg<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>match<span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
<li></li>
</ul>
<h4 id="数值扩展"><a href="#数值扩展" class="headerlink" title="数值扩展"></a>数值扩展</h4><ul>
<li>构造函数</li>
</ul>
<h4 id="函数扩展"><a href="#函数扩展" class="headerlink" title="函数扩展"></a>函数扩展</h4><h5 id="箭头函数"><a href="#箭头函数" class="headerlink" title="箭头函数"></a>箭头函数</h5><p>箭头函数中的this指向定义箭头函数的作用域，即外层作用域。</p>
<p>箭头函数没有 constructor函数 和 arguments属性。</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 原函数</span>
<span class="token keyword">const</span> <span class="token function-variable function">arrow</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">param</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
<span class="token comment">// 箭头函数</span>
<span class="token keyword">const</span> <span class="token function-variable function">arrow</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">param</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
<span class="token comment">// 只有一个参数</span>
<span class="token keyword">const</span> <span class="token function-variable function">arrow</span> <span class="token operator">=</span> <span class="token parameter">param</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
<span class="token comment">// 有多个参数</span>
<span class="token keyword">const</span> <span class="token function-variable function">arraw</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">param1<span class="token punctuation">,</span> param2</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
<span class="token comment">// 只有一行代码处理传参</span>
<span class="token keyword">const</span> <span class="token function-variable function">arrow</span> <span class="token operator">=</span> <span class="token parameter">param</span> <span class="token operator">=></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>param<span class="token punctuation">)</span>
<span class="token comment">// 返回一个对象</span>
<span class="token keyword">const</span> <span class="token function-variable function">arrow</span> <span class="token operator">=</span> <span class="token parameter">param</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token literal-property property">param</span><span class="token operator">:</span> param <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h6 id="箭头函数注意点"><a href="#箭头函数注意点" class="headerlink" title="箭头函数注意点"></a>箭头函数注意点</h6><ul>
<li>箭头函数没有自己的 this 对象。this 就是定义时上层作用域中的 this。</li>
<li>不可以当作构造函数，即不可以对箭头函数使用 new 命令，否则会抛出错误。</li>
<li>不可以使用 arguments 对象，该对象在函数体内不存在。如果要使用 rest 参数（形式为<code>...变量名</code>），用于获取函数的多余参数。</li>
<li>不可以使用 yield 命令，因此箭头函数不能用作 Generator 函数。</li>
</ul>
<p><strong>箭头函数让 this 指向固定化，绑定 this 使得它不再可变。</strong></p>
<h4 id="数组扩展"><a href="#数组扩展" class="headerlink" title="数组扩展"></a>数组扩展</h4><h4 id="对象扩展"><a href="#对象扩展" class="headerlink" title="对象扩展"></a>对象扩展</h4><h4 id="Symbol"><a href="#Symbol" class="headerlink" title="Symbol"></a>Symbol</h4><h4 id="Set-amp-Map"><a href="#Set-amp-Map" class="headerlink" title="Set &amp; Map"></a>Set &amp; Map</h4><p><code>WeakSet</code> 和 <code>WeakMap</code> 与 <code>Set</code> 和 <code>Map</code> 的区别：</p>
<ol>
<li><code>WeakSet</code> 或 <code>WeakMap</code> 类没有 <code>entries</code>、<code>keys</code>和<code>values</code>等方法；</li>
<li>只能用对象作为键。</li>
</ol>
<p><code>WeakSet</code> 和 <code>WeakMap</code> 是弱化版本，使用这两个类主要是为了性能，使用对象作为键，没有强引用的键。这使得 <code>JavaScript</code> 的垃圾回收器可以从中清除整个入口。必须用键才能取出值。</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">&#125;</span>
<span class="token keyword">let</span> y <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token number">2</span> <span class="token punctuation">&#125;</span>
<span class="token keyword">let</span> m <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WeakMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
m<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>m<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// &#123; id: 2 &#125;</span>
x <span class="token operator">=</span> <span class="token keyword">null</span>
y <span class="token operator">=</span> <span class="token keyword">null</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>m<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// undefined</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h5 id="Map-vs-Object"><a href="#Map-vs-Object" class="headerlink" title="Map vs Object"></a>Map vs Object</h5><p>更多阅读：<a href="https://medium.com/front-end-weekly/es6-map-vs-object-what-and-when-b80621932373">https://medium.com/front-end-weekly/es6-map-vs-object-what-and-when-b80621932373</a></p>
<ul>
<li>如果你知道所有的key，它们都为字符串或整数（或是Symbol类型），你需要一个简单的结构去存储这些数据，Object是一个非常好的选择。构建一个Object并通过知道的特定key获取元素的性能要优于Map（字面量 vs 构造函数，直接获取 vs <code>get()</code>方法）。</li>
<li>如果需要在对象中保持自己独有的逻辑和属性，只能使用 Object 。</li>
<li>Map是一个纯哈希结构，而Object不是（它拥有自己的内部逻辑）。使用<code>delete</code>对Object的属性进行删除操作存在很多性能问题。所以，针对于存在大量增删操作的场景，使用Map更合适。</li>
<li>不同于Object，Map会保留所有元素的顺序。Map结构是在基于可迭代的基础上构建的，所以如果考虑到元素迭代或顺序，使用Map更好，它能够确保在所有浏览器中的迭代性能。</li>
<li>Map在存储大量数据的场景下表现更好，尤其是在 key 为未知状态，key 值得范围不限于字符串，各种类型的值（包括对象）都可以当作 key。即 Object 结构提供了“字符串—值”的对应，Map 结构提供了“值—值”的对应。</li>
</ul>
<h4 id="Proxy"><a href="#Proxy" class="headerlink" title="Proxy"></a>Proxy</h4><h4 id="Promise"><a href="#Promise" class="headerlink" title="Promise"></a>Promise</h4><h4 id="Iterator-和-for…of循环"><a href="#Iterator-和-for…of循环" class="headerlink" title="Iterator 和 for…of循环"></a>Iterator 和 for…of循环</h4><p><code>for...of</code>循环内部调用的是数据结构的<code>Symbol.iterator</code>方法。</p>
<p>数组原生具备<code>iterator</code>接口（即默认部署了<code>Symbol.iterator</code>属性），<code>for...of</code>循环本质上就是调用这个接口产生的遍历器。</p>
<h4 id="生成器-Generator"><a href="#生成器-Generator" class="headerlink" title="生成器(Generator)"></a>生成器(Generator)</h4><p>生成器是一类特殊的函数，可以一次或多次启动和停止，并不一定非要完成。</p>
<p>生成器函数是一个特殊的函数。</p>
<h4 id="Class类"><a href="#Class类" class="headerlink" title="Class类"></a>Class类</h4><p><code>this</code>指向: 静态方法中的<code>this</code>指向类，实例方法中的<code>this</code>指向类实例。静态方法不会被继承，因此静态方法中使用的<code>this</code>指向函数调用的是类的静态方法，无法调用类的实例方法。</p>
<h5 id="Class和普通构造函数有何区别"><a href="#Class和普通构造函数有何区别" class="headerlink" title="Class和普通构造函数有何区别"></a>Class和普通构造函数有何区别</h5><p>class的本质就是函数，是特殊函数。JavaScript中只有对象。</p>
<blockquote>
<p>类的 prototype 属性和__proto__属性<br>每一个对象都有__proto__属性，指向对应的构造函数的prototype属性。<br>Class 作为构造函数的语法糖，同时有prototype属性和__proto__属性，因此同时存在两条继承链。<br>（1）子类的__proto__属性，表示构造函数的继承，总是指向父类。<br>（2）子类prototype属性的__proto__属性，表示方法的继承，总是指向父类的prototype属性。</p>
</blockquote>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">class</span> <span class="token class-name">Point</span> <span class="token punctuation">&#123;</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">// 在 new 时自动执行</span>
        <span class="token comment">// ...</span>
    <span class="token punctuation">&#125;</span>

    <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// ...</span>
    <span class="token punctuation">&#125;</span>

    <span class="token function">toValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// ...</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 等同于</span>

<span class="token class-name">Point</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token function">toValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">B</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
<span class="token keyword">const</span> b <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">B</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

b<span class="token punctuation">.</span>constructor <span class="token operator">===</span> <span class="token class-name">B</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>constructor <span class="token comment">// true</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>所有实例共享一个原型对象。</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">//定义类</span>
<span class="token keyword">class</span> <span class="token class-name">Point</span> <span class="token punctuation">&#123;</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">x<span class="token punctuation">,</span> y</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>x <span class="token operator">=</span> x<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>y <span class="token operator">=</span> y<span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>

  <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token string">'('</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>x <span class="token operator">+</span> <span class="token string">', '</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>y <span class="token operator">+</span> <span class="token string">')'</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span>

<span class="token keyword">var</span> point <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Point</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

point<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// (2, 3)</span>

point<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">(</span><span class="token string">'x'</span><span class="token punctuation">)</span> <span class="token comment">// true</span>
point<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">(</span><span class="token string">'y'</span><span class="token punctuation">)</span> <span class="token comment">// true</span>
point<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">(</span><span class="token string">'toString'</span><span class="token punctuation">)</span> <span class="token comment">// false toString()是原型对象的属性</span>
point<span class="token punctuation">.</span>__proto__<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">(</span><span class="token string">'toString'</span><span class="token punctuation">)</span> <span class="token comment">// true</span>

<span class="token keyword">var</span> p1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Point</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> p2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Point</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

p1<span class="token punctuation">.</span>__proto__ <span class="token operator">===</span> p2<span class="token punctuation">.</span>__proto__ <span class="token comment">// true</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p><code>__proto__</code> 并不是语言本身的特性，这是各大厂商具体实现时添加的私有属性，虽然目前很多现代浏览器的 JS 引擎中都提供了这个私有属性，但依旧不建议在生产中使用该属性，避免对环境产生依赖。生产环境中，我们可以使用 <code>Object.getPrototypeOf</code> 方法来获取实例对象的原型，然后再来为原型添加方法/属性。</p>
</blockquote>
<h5 id="静态类与实例类"><a href="#静态类与实例类" class="headerlink" title="静态类与实例类"></a>静态类与实例类</h5><p><code>this</code>指向不一样，静态类无法获取到<code>this</code>指向。如果类函数需要使用<code>this</code>，则不能命名为静态类。</p>
<p>类可以不用创建实例就使用静态类，但是实例类必须要类进行实例后才能使用。</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">class</span> <span class="token class-name">Root</span> <span class="token punctuation">&#123;</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// 当前的this是指对象实例</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>bar <span class="token operator">=</span> <span class="token string">'bar'</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">set</span> <span class="token function">name</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">get</span> <span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>bar
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">static</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">// 静态方法，定义在 class 的对象上 this指对象</span>
        <span class="token comment">// this.bar => undefined</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>

    <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">// 实例方法，定义在 class 的原型链上</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>bar<span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">class</span> <span class="token class-name">Son</span> <span class="token keyword">extends</span> <span class="token class-name">Root</span> <span class="token punctuation">&#123;</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 调用父类的构造器</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">const</span> root <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Root</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
root<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'root'</span> <span class="token comment">// root</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>root<span class="token punctuation">.</span>name<span class="token punctuation">)</span> <span class="token comment">// bar</span>
<span class="token keyword">const</span> son <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Son</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
son<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'son'</span> <span class="token comment">// son</span>
son<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// bar</span>
Root<span class="token punctuation">.</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// foo</span>
Son<span class="token punctuation">.</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// foo</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>子类继承父类时，想要拥有父类的属性和静态方法，需要在构造函数中调用 <code>super</code> 访问父类，在重写父类定义的函数时可以使用。</p>
<blockquote>
<p>getter 和 setter 方法类似于 <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object/defineProperty">Object.defineProperty()</a> 的 getter 和 setter。</p>
</blockquote>
<h5 id="类表达式"><a href="#类表达式" class="headerlink" title="类表达式"></a>类表达式</h5><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> foo <span class="token operator">=</span> <span class="token keyword">class</span> <span class="token punctuation">&#123;</span>
    
<span class="token punctuation">&#125;</span>

<span class="token keyword">const</span> <span class="token function-variable function">enhance</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token keyword">class</span> <span class="token class-name">extend</span> parentClass <span class="token punctuation">&#123;</span> <span class="token comment">// 最终显示的是父类的名字（react）</span>
        
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>





<h4 id="模块化"><a href="#模块化" class="headerlink" title="模块化"></a>模块化</h4><p>通过 export 命令显式指定输出的代码，再通过 import 命令输入。</p>
<p>编译时加载（静态加载）</p>
<h5 id="export与import"><a href="#export与import" class="headerlink" title="export与import"></a>export与import</h5><p>export 用于规定模块的对外接口</p>
<p>import 用于输入其他模块提供的功能</p>
<p>export 默认导出，import 导入时不用与导出名相同，可以为默认导入指定任一名字</p>
<blockquote>
<p>一个模块只能有一个默认导出</p>
<p>默认导出最终导出的是名为 default 的变量</p>
</blockquote>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 导出</span>
<span class="token keyword">const</span> age <span class="token operator">=</span> <span class="token number">19</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> age
<span class="token comment">// 导入</span>
<span class="token keyword">import</span> Person <span class="token keyword">from</span> <span class="token string">'../xxx'</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Person<span class="token punctuation">.</span>age<span class="token punctuation">)</span> <span class="token comment">// 19</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>export 导出多个数据或对象，导入时可以使用花括号，并且导入名需要和导出名相同，或者使用as进行重命名。</p>
<blockquote>
<p>export 命令规定的是对外的接口，必须与模块内部的变量建立一一对应关系。</p>
<p>export 语句输出的接口与其对应的值时动态绑定关系，即通过该接口，可以取到模块内部实时的值。</p>
<p>import 命令输入的变量都是只读的，因为它的本质是输入接口。如果导入引用类型，不要轻易改写，容易出现未知问题。</p>
<p>import 命令具有提升效果。</p>
</blockquote>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 导出</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> name <span class="token operator">=</span> <span class="token string">'luck'</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">getName</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> name
<span class="token punctuation">&#125;</span>
<span class="token comment">// 或</span>
<span class="token keyword">const</span> name <span class="token operator">=</span> <span class="token string">'luck'</span>
<span class="token keyword">const</span> <span class="token function-variable function">getName2</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> name
<span class="token punctuation">&#125;</span>
<span class="token keyword">export</span> <span class="token punctuation">&#123;</span>
	name<span class="token punctuation">,</span>
    getName2 <span class="token keyword">as</span> getName <span class="token comment">// 导出时重命名</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">// 对应的导入方式</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> 
    name<span class="token punctuation">,</span> 
    getName <span class="token keyword">as</span> getName2 <span class="token comment">// 导入时重命名</span>
<span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'../xxx'</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token comment">// luck</span>
<span class="token comment">// 或 使用整体导入</span>
<span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token string">'../xxx'</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token comment">// luck</span>
<span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> Person <span class="token keyword">from</span> <span class="token string">'../xxx'</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Person<span class="token punctuation">.</span>name<span class="token punctuation">)</span> <span class="token comment">// luck</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>export 默认导出和多个数据导出的复合写法</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 导出</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> name <span class="token operator">=</span> <span class="token string">'luck'</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">getName2</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> name
<span class="token punctuation">&#125;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">&#123;</span>
    <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">18</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">// 导入</span>
<span class="token keyword">import</span> Person<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> name<span class="token punctuation">,</span> getName <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'../xxx'</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Person<span class="token punctuation">.</span>age<span class="token punctuation">,</span> name<span class="token punctuation">)</span> <span class="token comment">// 18, luck</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>export 和 import 的复合写法</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 导入 导出 用于做中转（代码规范）</span>
<span class="token keyword">export</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token string">'../xxx'</span> <span class="token comment">// 整体输出</span>

<span class="token keyword">export</span> <span class="token punctuation">&#123;</span> name <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'../xxx'</span> 
<span class="token comment">// 等同于</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> name <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'../xxx'</span>
<span class="token keyword">export</span> <span class="token punctuation">&#123;</span> name <span class="token punctuation">&#125;</span>

<span class="token keyword">export</span> <span class="token punctuation">&#123;</span> name <span class="token keyword">as</span> firstName <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'../xxx'</span>

<span class="token comment">// (ES2020)</span>
<span class="token keyword">export</span> <span class="token operator">*</span> <span class="token keyword">as</span> ns <span class="token keyword">from</span> <span class="token string">"mod"</span><span class="token punctuation">;</span>

<span class="token comment">// 等同于</span>
<span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> ns <span class="token keyword">from</span> <span class="token string">"mod"</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token punctuation">&#123;</span>ns<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>一个模块中多个复合写法，最终会合并成一个模块导出</p>
<h5 id="ES6模块化如何使用，开发环境如何打包"><a href="#ES6模块化如何使用，开发环境如何打包" class="headerlink" title="ES6模块化如何使用，开发环境如何打包"></a>ES6模块化如何使用，开发环境如何打包</h5><h3 id="ES7"><a href="#ES7" class="headerlink" title="ES7"></a>ES7</h3><p><img src="/posts/37130/es2016.jpg" alt="es2016"></p>
<h4 id="Array-prototype-includes"><a href="#Array-prototype-includes" class="headerlink" title="Array.prototype.includes()"></a>Array.prototype.includes()</h4><h4 id="指数操作符"><a href="#指数操作符" class="headerlink" title="指数操作符(**)"></a>指数操作符(**)</h4><h3 id="ES8"><a href="#ES8" class="headerlink" title="ES8"></a>ES8</h3><p><img src="/posts/37130/es2017.jpg" alt="es2017"></p>
<h4 id="Async-函数"><a href="#Async-函数" class="headerlink" title="Async 函数"></a>Async 函数</h4><h4 id="对象扩展-1"><a href="#对象扩展-1" class="headerlink" title="对象扩展"></a>对象扩展</h4><h4 id="字符串填充"><a href="#字符串填充" class="headerlink" title="字符串填充"></a>字符串填充</h4><h4 id="函数参数列表结尾允许逗号"><a href="#函数参数列表结尾允许逗号" class="headerlink" title="函数参数列表结尾允许逗号"></a>函数参数列表结尾允许逗号</h4><h4 id="SharedArrayBuffer对象"><a href="#SharedArrayBuffer对象" class="headerlink" title="SharedArrayBuffer对象"></a>SharedArrayBuffer对象</h4><h4 id="Atomics对象"><a href="#Atomics对象" class="headerlink" title="Atomics对象"></a>Atomics对象</h4><h3 id="ES9"><a href="#ES9" class="headerlink" title="ES9"></a>ES9</h3><p><img src="/posts/37130/es2018.jpg" alt="es2018"></p>
<h4 id="Promise-prototype-finally"><a href="#Promise-prototype-finally" class="headerlink" title="Promise.prototype.finally()"></a>Promise.prototype.finally()</h4><h4 id="展开运算符"><a href="#展开运算符" class="headerlink" title="展开运算符"></a>展开运算符</h4><h4 id="正则表达式"><a href="#正则表达式" class="headerlink" title="正则表达式"></a>正则表达式</h4><h4 id="异步遍历器"><a href="#异步遍历器" class="headerlink" title="异步遍历器"></a>异步遍历器</h4><h3 id="ES10"><a href="#ES10" class="headerlink" title="ES10"></a>ES10</h3><p><img src="/posts/37130/es2019.jpg" alt="es2019"></p>
<h4 id="字符串扩展-1"><a href="#字符串扩展-1" class="headerlink" title="字符串扩展"></a>字符串扩展</h4><h4 id="数组扩展-1"><a href="#数组扩展-1" class="headerlink" title="数组扩展"></a>数组扩展</h4><h4 id="Symbol扩展"><a href="#Symbol扩展" class="headerlink" title="Symbol扩展"></a>Symbol扩展</h4><h4 id="对象扩展-2"><a href="#对象扩展-2" class="headerlink" title="对象扩展"></a>对象扩展</h4><h4 id="函数扩展-1"><a href="#函数扩展-1" class="headerlink" title="函数扩展"></a>函数扩展</h4><h4 id="修改catch绑定"><a href="#修改catch绑定" class="headerlink" title="修改catch绑定"></a>修改catch绑定</h4><h3 id="ES11"><a href="#ES11" class="headerlink" title="ES11"></a>ES11</h3><p><img src="/posts/37130/es2020.jpg" alt="es2020"></p>
<h4 id="基本数据类型-BigInt"><a href="#基本数据类型-BigInt" class="headerlink" title="基本数据类型 BigInt"></a>基本数据类型 BigInt</h4><h4 id="空置处理"><a href="#空置处理" class="headerlink" title="空置处理 (??)"></a><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/Nullish_coalescing_operator">空置处理 (??)</a></h4><p><strong>空值合并操作符</strong>（**<code>??</code>**）是一个逻辑操作符，当左侧的操作数为 <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/null"><code>null</code></a> 或者 <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/undefined"><code>undefined</code></a> 时，返回其右侧操作数，否则返回左侧操作数。</p>
<p>与<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators#logical_or_2">逻辑或操作符（<code>||</code>）</a>不同，逻辑或操作符会在左侧操作数为<a href="https://developer.mozilla.org/zh-CN/docs/Glossary/Falsy">假值</a>时返回右侧操作数。也就是说，如果使用 <code>||</code> 来为某些变量设置默认值，可能会遇到意料之外的行为。比如为假值（例如，<code>&#39;&#39;</code> 或 <code>0</code>）时。</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> foo <span class="token operator">=</span> <span class="token keyword">null</span> <span class="token operator">??</span> <span class="token string">'default string'</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>foo<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// default string</span>

<span class="token keyword">const</span> baz <span class="token operator">=</span> <span class="token number">0</span> <span class="token operator">??</span> <span class="token number">42</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>baz<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 0</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>不能与 and 或 or 共用，需要用括号进行优先级处理。</p>
</blockquote>
<h4 id="可选链"><a href="#可选链" class="headerlink" title="可选链(?.)"></a><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/Optional_chaining">可选链(?.)</a></h4><p><strong>可选链</strong>操作符( <strong><code>?.</code></strong> )允许读取位于连接对象链深处的属性的值，而不必明确验证链中的每个引用是否有效。<code>?.</code> 操作符的功能类似于 <code>.</code> 链式操作符，不同之处在于，在引用为空(<a href="https://wiki.developer.mozilla.org/en-US/docs/Glossary/nullish">nullish</a> ) (<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/null"><code>null</code></a> 或者 <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/undefined"><code>undefined</code></a>) 的情况下不会引起错误，该表达式短路返回值是 <code>undefined</code>。与函数调用一起使用时，如果给定的函数不存在，则返回 <code>undefined</code>。</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> adventurer <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'Alice'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">cat</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'Dinah'</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
	<span class="token literal-property property">arr</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> dogName <span class="token operator">=</span> adventurer<span class="token punctuation">.</span>dog<span class="token operator">?.</span>name<span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>dogName<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// undefined</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>adventurer<span class="token punctuation">.</span>someNonExistentMethod<span class="token operator">?.</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// undefined</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>adventurer<span class="token punctuation">.</span>arr<span class="token operator">?.</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">// undefined</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h4 id="Promise-allSettled"><a href="#Promise-allSettled" class="headerlink" title="Promise.allSettled()"></a>Promise.allSettled()</h4><h4 id="import-动态导入"><a href="#import-动态导入" class="headerlink" title="import() 动态导入"></a>import() 动态导入</h4><p>动态导入模块，将返回一个promise</p>
<p>静态导入的方式会进行提升，加入动态导入方式，可以实现条件导入</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">../xxx.js</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
	<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">module</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>module<span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
	<span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>非模块脚本也可以使用，运行时执行，即表示运行到当前位置是导入另一段脚本执行，执行后接着当前内容继续执行</p>
</blockquote>
<p>使用场景：</p>
<ul>
<li>按需加载</li>
<li>条件加载</li>
<li>动态的模块路径</li>
</ul>
<p>与 require 的区别：require是异步加载，import() 是同步加载（promise 对象）</p>
<h4 id="globalThis"><a href="#globalThis" class="headerlink" title="globalThis"></a>globalThis</h4><h3 id="ES12"><a href="#ES12" class="headerlink" title="ES12"></a>ES12</h3><p><img src="/posts/37130/es2021.jpg" alt="es2021"></p>
<h4 id="字符串扩展-2"><a href="#字符串扩展-2" class="headerlink" title="字符串扩展"></a>字符串扩展</h4><h4 id="Promise-any"><a href="#Promise-any" class="headerlink" title="Promise.any()"></a>Promise.any()</h4><h4 id="WeakRefs对象"><a href="#WeakRefs对象" class="headerlink" title="WeakRefs对象"></a>WeakRefs对象</h4><h4 id="逻辑运算符和赋值表达式"><a href="#逻辑运算符和赋值表达式" class="headerlink" title="逻辑运算符和赋值表达式"></a>逻辑运算符和赋值表达式</h4><h4 id="数字分隔符"><a href="#数字分隔符" class="headerlink" title="数字分隔符"></a>数字分隔符</h4><h3 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h3><p>阮一峰：<a href="https://es6.ruanyifeng.com/">https://es6.ruanyifeng.com/</a></p>
<p>掘金：<a href="https://juejin.cn/post/6844903811622912014">https://juejin.cn/post/6844903811622912014</a></p>
]]></content>
      <categories>
        <category>前端</category>
        <category>基础</category>
      </categories>
      <tags>
        <tag>前端</tag>
        <tag>技巧</tag>
        <tag>面试</tag>
        <tag>基础</tag>
        <tag>es6</tag>
      </tags>
  </entry>
  <entry>
    <title>基础系列-RESTful接口</title>
    <url>/posts/bcd302c7/</url>
    <content><![CDATA[<p>参考链接：</p>
<p><a href="https://www.ruanyifeng.com/blog/2011/09/restful.html">理解RESTful架构 - 阮一峰</a></p>
<p><a href="http://restful.p2hp.com/">什么是REST</a></p>
<p><a href="https://searchapparchitecture.techtarget.com/definition/RESTful-API">https://searchapparchitecture.techtarget.com/definition/RESTful-API</a></p>
<h3 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h3><h4 id="什么是RESTful"><a href="#什么是RESTful" class="headerlink" title="什么是RESTful"></a>什么是RESTful</h4><p>REST是<strong>RE</strong>presentational <strong>S</strong>tate <strong>T</strong>ransfer<code>表述性状态转移</code> 的首字母缩写。它是<strong>分布式超媒体系统的</strong>架构风格。</p>
<p><code>RESTful</code> 就代表满足REST原则的架构。</p>
<p>与任何其他架构风格一样，REST也有自己的<a href="http://restful.p2hp.com/home/rest-architectural-constraints/">6个引导约束</a>，如果接口需要被称为<strong>RESTful</strong>，则必须满足这些<a href="http://restful.p2hp.com/home/rest-architectural-constraints/">约束</a>。这些原则如下。</p>
<h5 id="REST的指导原则"><a href="#REST的指导原则" class="headerlink" title="REST的指导原则"></a>REST的指导原则</h5><ol>
<li><strong>客户端 - 服务器</strong> - 通过将用户接口问题与数据存储问题分开，我们通过简化服务器组件来提高跨多个平台的用户接口的可移植性并提高可伸缩性。</li>
<li><strong>无状态</strong> - 从客户端到服务器的每个请求都必须包含理解请求所需的所有信息，并且不能利用服务器上任何存储的上下文。因此，会话状态完全保留在客户端上。</li>
<li><strong>可缓存</strong> - 缓存约束要求将对请求的响应中的数据隐式或显式标记为可缓存或不可缓存。如果响应是可缓存的，则客户端缓存有权重用该响应数据以用于以后的等效请求。</li>
<li><strong>统一接口</strong> - 通过将通用性的软件工程原理应用于组件接口，简化了整个系统架构，提高了交互的可见性。为了获得统一的接口，需要多个架构约束来指导组件的行为。REST由四个接口约束定义：资源识别; 通过陈述来处理资源; 自我描述性的信息; 并且，超媒体作为应用程序状态的引擎。</li>
<li><strong>分层系统</strong> - 分层系统风格允许通过约束组件行为来使体系结构由分层层组成，这样每个组件都不能“看到”超出与它们交互的直接层。</li>
<li><strong>按需编码（可选）</strong> - REST允许通过以小程序或脚本的形式下载和执行代码来扩展客户端功能。这通过减少预先实现所需的功能数量来简化客户端。</li>
</ol>
<h4 id="理解RESTful"><a href="#理解RESTful" class="headerlink" title="理解RESTful"></a>理解RESTful</h4><h5 id="资源"><a href="#资源" class="headerlink" title="资源"></a>资源</h5><p><strong>所谓”资源”，就是网络上的一个实体，或者说是网络上的一个具体信息。</strong>它可以是一段文本、一张图片、一首歌曲、一种服务，总之就是一个具体的实在。你可以用一个URI（统一资源定位符）指向它，每种资源对应一个特定的URI。要获取这个资源，访问它的URI就可以，因此URI就成了每一个资源的地址或独一无二的识别符。</p>
<h5 id="表现层Representational"><a href="#表现层Representational" class="headerlink" title="表现层Representational"></a>表现层Representational</h5><p><strong>我们把”资源”具体呈现出来的形式，叫做它的”表现层”（Representation）。</strong></p>
<p>比如，文本可以用txt格式表现，也可以用HTML格式、XML格式、JSON格式表现，甚至可以采用二进制格式；图片可以用JPG格式表现，也可以用PNG格式表现。</p>
<p>URI只代表资源的实体，不代表它的形式。严格地说，有些网址最后的”.html”后缀名是不必要的，因为这个后缀名表示格式，属于”表现层”范畴，而URI应该只代表”资源”的位置。它的具体表现形式，应该在HTTP请求的头信息中用Accept和Content-Type字段指定，这两个字段才是对”表现层”的描述。</p>
<p>任何特定时间戳的资源状态称为<strong>资源表示</strong>。表示由数据，描述数据的元数据和<strong>超媒体</strong>链接组成，这些链接可以帮助客户转换到下一个期望的状态。</p>
<p>表示的数据格式称为**<a href="https://www.iana.org/assignments/media-types/media-types.xhtml">媒体类型</a><strong>。媒体类型标识定义如何处理表示的规范。</strong>真正的RESTful API看起来像*超文本***。每个可寻址信息单元明确地（例如，链接和id属性）或隐式地（例如，从媒体类型定义和表示结构导出）携带地址。</p>
<h5 id="状态转化（State-Transfer）"><a href="#状态转化（State-Transfer）" class="headerlink" title="状态转化（State Transfer）"></a>状态转化（State Transfer）</h5><p>访问一个网站，就代表了客户端和服务器的一个互动过程。在这个过程中，势必涉及到数据和状态的变化。</p>
<p>互联网通信协议HTTP协议，是一个无状态协议。这意味着，所有的状态都保存在服务器端。因此，<strong>如果客户端想要操作服务器，必须通过某种手段，让服务器端发生”状态转化”（State Transfer）。而这种转化是建立在表现层之上的，所以就是”表现层状态转化”。</strong></p>
<h5 id="资源方法"><a href="#资源方法" class="headerlink" title="资源方法"></a>资源方法</h5><p><strong>基于查询的API结果应该由带有摘要信息的链接列表表示</strong>，而不是由原始资源表示的数组表示，因为查询不能代替资源标识。</p>
<p>客户端用到的手段，只能是HTTP协议。具体来说，就是HTTP协议里面，四个表示操作方式的动词：GET、POST、PUT、DELETE。</p>
<p>它们分别对应四种基本操作：</p>
<ul>
<li>GET用来获取资源，</li>
<li>POST用来新建资源（也可以用于更新资源），</li>
<li>PUT用来更新资源，</li>
<li>DELETE用来删除资源。</li>
</ul>
<h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><ol>
<li><p>每一个URI代表一种资源；</p>
</li>
<li><p>客户端和服务器之间，传递这种资源的某种表现层；</p>
</li>
<li><p>客户端通过四个HTTP动词，对服务器端资源进行操作，实现”表现层状态转化”。</p>
</li>
</ol>
<blockquote>
<p>简而言之，在REST架构风格中，数据和功能被视为资源，并使用统一资源标识符（URI）进行访问。通过使用一组简单，定义明确的操作来执行资源。客户端和服务器通过使用标准化接口和协议（通常是HTTP）来交换资源的表示。</p>
</blockquote>
<h5 id="优点："><a href="#优点：" class="headerlink" title="优点："></a>优点：</h5><p>资源与其表示分离，以便可以以各种格式访问其内容，例如HTML，XML，纯文本，PDF，JPEG，JSON等。例如，可以使用和使用关于资源的元数据来控制高速缓存，检测传输错误，协商适当的表示格式，以及执行认证或访问控制。最重要的是，与资源的每次交互都是无状态的。</p>
<p>RESTful应用程序简单，轻量和快速。</p>
<h4 id="设计误区"><a href="#设计误区" class="headerlink" title="设计误区"></a>设计误区</h4><h5 id="URI-包含动词"><a href="#URI-包含动词" class="headerlink" title="URI 包含动词"></a>URI 包含动词</h5><p>因为”资源”表示一种实体，所以应该是名词，URI不应该有动词，动词应该放在HTTP协议中。</p>
<h5 id="URI中加入版本号"><a href="#URI中加入版本号" class="headerlink" title="URI中加入版本号"></a>URI中加入版本号</h5><p>因为不同的版本，可以理解成同一种资源的不同表现形式，所以应该采用同一个URI。版本号可以在HTTP请求头信息的Accept字段中进行区分。<strong>但是易用性最重要。如果在HEADER中添加版本号，前端和后端都需要处理更多的事情</strong></p>
]]></content>
      <categories>
        <category>前端</category>
        <category>基础</category>
      </categories>
      <tags>
        <tag>前端</tag>
        <tag>面试</tag>
        <tag>RESTful</tag>
      </tags>
  </entry>
  <entry>
    <title>基础系列-ajax与fetch</title>
    <url>/posts/edf6ec8f/</url>
    <content><![CDATA[<h3 id="AJAX"><a href="#AJAX" class="headerlink" title="AJAX"></a><a href="https://developer.mozilla.org/zh-CN/docs/Web/Guide/AJAX">AJAX</a></h3><h4 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h4><p>Asynchronous JavaScript + XML（异步JavaScript和XML）, 其本身不是一种新技术，而是一个在 2005年被Jesse James Garrett提出的新术语，用来描述一种使用现有技术集合的‘新’方法，包括: <a href="https://developer.mozilla.org/en-US/docs/Web/HTML">HTML</a> 或 <a href="https://developer.mozilla.org/en-US/docs/Glossary/XHTML">XHTML</a>,  <a href="https://developer.mozilla.org/zh-CN/docs/Web/CSS">CSS</a>, <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript">JavaScript</a>, <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Document_Object_Model">DOM</a>, <a href="https://developer.mozilla.org/en-US/docs/Web/XML">XML</a>, <a href="https://developer.mozilla.org/en-US/docs/Web/XSLT">XSLT</a>, 以及最重要的 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/XMLHttpRequest"><code>XMLHttpRequest</code></a>。当使用结合了这些技术的AJAX模型以后， 网页应用能够快速地将增量更新呈现在用户界面上，而不需要重载（刷新）整个页面。这使得程序能够更快地回应用户的操作。</p>
<h4 id="请求的数据格式"><a href="#请求的数据格式" class="headerlink" title="请求的数据格式"></a>请求的数据格式</h4><blockquote>
<p>设置 <a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Content-Type">Content-Type</a>  实体头部用于指示资源的MIME类型</p>
</blockquote>
<p>text/html：请求 Web ⻚面时返回响应的类型，Body 中返回 html 文本。</p>
<p>application/json：常用，复杂的数据结构。</p>
<p>multipart/form-data：提交文件、非 ASCII 码的数据或者是二进制流数据。</p>
<p>application/x-www-form-urlencoded：form表单默认编码方式。</p>
<h3 id="XMLHttpRequest"><a href="#XMLHttpRequest" class="headerlink" title="XMLHttpRequest"></a><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/XMLHttpRequest">XMLHttpRequest</a></h3><h4 id="概念-1"><a href="#概念-1" class="headerlink" title="概念"></a>概念</h4><p><code>XMLHttpRequest</code>（XHR）对象用于与服务器交互。通过 XMLHttpRequest 可以在不刷新页面的情况下请求特定 URL，获取数据。这允许网页在不影响用户操作的情况下，更新页面的局部内容。<code>XMLHttpRequest</code> 在 <a href="https://developer.mozilla.org/zh-CN/docs/Glossary/AJAX">AJAX</a> 编程中被大量使用。</p>
<p><code>XMLHttpRequest</code> 可以用于获取任何类型的数据，而不仅仅是 XML。它甚至支持 <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP">HTTP</a> 以外的协议（包括 file:// 和 FTP），尽管可能受到更多出于安全等原因的限制。</p>
<h4 id="属性和方法"><a href="#属性和方法" class="headerlink" title="属性和方法"></a>属性和方法</h4><h5 id="属性"><a href="#属性" class="headerlink" title="属性"></a>属性</h5><ul>
<li>upload：（只读）上传进度。</li>
<li>status：（只读）代表请求响应状态。返回一个无符号短整型数字。</li>
<li>readyState：（只读）代表请求的状态码。<ul>
<li>0 - UNSENT - 代理被创建，但尚未调用 open() 方法</li>
<li>1 - OPENED - open() 方法已经被调用</li>
<li>2 - HEADERS_RECEIVED - send() 方法已经被调用，并且头部和状态已经可获得</li>
<li>3 - LOADING - 下载中；responseText 属性已经包含部分数据</li>
<li>4 - DONE - 下载操作已完成</li>
</ul>
</li>
<li>response：（只读）包含整个响应实体。返回一个 <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/ArrayBuffer"><code>ArrayBuffer</code></a>、<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Blob"><code>Blob</code></a>、<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Document"><code>Document</code></a>，或 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/DOMString"><code>DOMString</code></a>，具体是哪种类型取决于 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/XMLHttpRequest/responseType"><code>XMLHttpRequest.responseType</code></a> 的值。</li>
<li>responseText：（只读）返回一个 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/DOMString"><code>DOMString</code></a>，该 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/DOMString"><code>DOMString</code></a> 包含对请求的响应，如果请求未成功或尚未发送，则返回 <code>null</code>。</li>
<li>responseType：一个用于定义响应类型的枚举值。</li>
<li>responseURL：（只读）返回经过序列化（serialized）的响应 URL，如果该 URL 为空，则返回空字符串。</li>
<li>responseXML：（只读）返回一个 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Document"><code>Document</code></a>，其中包含该请求的响应，如果请求未成功、尚未发送或时不能被解析为 XML 或 HTML，则返回 <code>null</code>。</li>
<li>statusText：（只读）返回一个 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/DOMString"><code>DOMString</code></a>，其中包含 HTTP 服务器返回的响应状态。与 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/XMLHttpRequest/status"><code>XMLHTTPRequest.status</code></a> 不同的是，它包含完整的响应状态文本（例如，”<code>200 OK</code>“）。</li>
<li>timeout：超时时长。</li>
<li>ontimeout：设置一个函数处理超时问题。</li>
<li>withCredentials：一个布尔值，用来指定跨域 <code>Access-Control</code> 请求是否应当带有授权信息，如 cookie 或授权 header 头。</li>
</ul>
<h5 id="方法"><a href="#方法" class="headerlink" title="方法"></a>方法</h5><ul>
<li><code>.abort()</code>：如果请求已被发出，则立刻中止请求。</li>
<li><code>.getAllResponseHeaders()</code>：以字符串的形式返回所有用 <a href="https://developer.mozilla.org/zh-CN/docs/Glossary/CRLF">CRLF</a> 分隔的响应头，如果没有收到响应，则返回 <code>null</code>。</li>
<li><code>.getResponseHeader()</code>：返回包含指定响应头的字符串，如果响应尚未收到或响应中不存在该报头，则返回 <code>null</code>。</li>
<li><code>.open()</code>：初始化一个请求。</li>
<li><code>.overrideMimeType()</code>：覆写由服务器返回的 MIME 类型。</li>
<li><code>.send()</code>：发送请求。如果请求是异步的（默认），那么该方法将在请求发送后立即返回。</li>
<li><code>.setRequestHeader()</code>：设置 HTTP 请求头的值。<strong>必须在 <code>open()</code> 之后、<code>send()</code> 之前调用 <code>setRequestHeader()</code> 方法。</strong></li>
</ul>
<h5 id="事件"><a href="#事件" class="headerlink" title="事件"></a>事件</h5><blockquote>
<p>使用 xhr.addEventListener 的方式添加监听事件，或使用on-*属性进行设置监听</p>
</blockquote>
<ul>
<li><p>abort：可以设置监听 abort() 方法调用。</p>
</li>
<li><p>error：错误时触发。</p>
</li>
<li><p>progress：当请求接受到更多数据时，周期性地触发。</p>
</li>
<li><p>load：请求成功完成时触发。</p>
</li>
<li><p>loadend：当请求结束时触发，无论成功还是失败。</p>
</li>
<li><p>loadstart：接受到响应数据时触发。</p>
</li>
<li><p>timeout：在预设时间内没有接受到响应时触发。</p>
</li>
</ul>
<h4 id="实战"><a href="#实战" class="headerlink" title="实战"></a>实战</h4><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token parameter">data <span class="token operator">===</span> <span class="token keyword">null</span></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>data<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">const</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    xhr<span class="token punctuation">.</span><span class="token function-variable function">onreadystatechange</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// 请求操作已完成</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>readyState <span class="token operator">==</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token comment">// 判断响应状态</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>status<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">'2'</span><span class="token punctuation">)</span> <span class="token operator">||</span> xhr<span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token number">304</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token comment">// 获取返回结果</span>
                <span class="token keyword">const</span> res <span class="token operator">=</span> xhr<span class="token punctuation">.</span>response
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
              console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'error: '</span><span class="token punctuation">,</span> xhr<span class="token punctuation">.</span>status<span class="token punctuation">)</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token comment">// 初始化一个请求，第三个参数设置异步请求还是同步请求，默认值为false为异步请求</span>
    xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'GET'</span><span class="token punctuation">,</span> <span class="token string">'url.action'</span><span class="token punctuation">)</span>
    <span class="token comment">// 出错时处理</span>
    xhr<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"An error occurred during the transaction"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
    <span class="token comment">// 必须在 open 之后，send之前设置 header</span>
    xhr<span class="token punctuation">.</span><span class="token function">setRequestHeader</span><span class="token punctuation">(</span><span class="token string">'Content-Type'</span><span class="token punctuation">,</span> <span class="token string">'application/json;charset=UTF-8'</span><span class="token punctuation">)</span>
    <span class="token comment">// 设置超时</span>
    xhr<span class="token punctuation">.</span>timeout <span class="token operator">=</span> <span class="token number">10000</span> <span class="token comment">// 设置 10 秒超时</span>
    xhr<span class="token punctuation">.</span><span class="token function-variable function">ontimeout</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"Request did not return in a second."</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
    <span class="token comment">// 发送请求</span>
    xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> 
<span class="token punctuation">&#125;</span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>promise 改造</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token parameter">formData <span class="token operator">=</span> <span class="token keyword">null</span></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>formData<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">return</span>
  <span class="token punctuation">&#125;</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">const</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      xhr<span class="token punctuation">.</span><span class="token function-variable function">onreadystatechange</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
          <span class="token comment">// 请求操作已完成</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>readyState <span class="token operator">===</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
              <span class="token comment">// 判断响应状态</span>
              <span class="token keyword">if</span> <span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>status<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">'2'</span><span class="token punctuation">)</span> <span class="token operator">||</span> xhr<span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token number">304</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                  <span class="token comment">// 获取返回结果</span>
                  <span class="token keyword">const</span> res <span class="token operator">=</span> xhr<span class="token punctuation">.</span>response
                  <span class="token function">resolve</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
              <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
                  <span class="token function">reject</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>status<span class="token punctuation">)</span>
              <span class="token punctuation">&#125;</span>
          <span class="token punctuation">&#125;</span>
      <span class="token punctuation">&#125;</span>
      <span class="token comment">// 初始化一个请求，第三个参数设置异步请求还是同步请求，默认值为false为异步请求</span>
      xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>formData<span class="token punctuation">.</span>method<span class="token punctuation">,</span> formData<span class="token punctuation">.</span>url<span class="token punctuation">)</span>
      <span class="token comment">// 必须在 open 之后，send之前设置 header</span>
      xhr<span class="token punctuation">.</span><span class="token function">setRequestHeader</span><span class="token punctuation">(</span><span class="token string">'Content-Type'</span><span class="token punctuation">,</span> <span class="token string">'application/json;charset=UTF-8'</span><span class="token punctuation">)</span>
      <span class="token comment">// 设置超时</span>
      xhr<span class="token punctuation">.</span>timeout <span class="token operator">=</span> <span class="token number">10000</span> <span class="token comment">// 设置 10 秒超时</span>
      xhr<span class="token punctuation">.</span><span class="token function-variable function">ontimeout</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"Request did not return in a second."</span><span class="token punctuation">)</span>
      <span class="token punctuation">&#125;</span>
      <span class="token comment">// 发送请求</span>
      xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>formData<span class="token punctuation">.</span>data <span class="token operator">||</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 使用</span>
<span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
  <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">'GET'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">'www.baidu.com'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=></span> console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="Fetch"><a href="#Fetch" class="headerlink" title="Fetch"></a><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Fetch_API/Basic_concepts">Fetch</a></h3><p>相对于 XMLHttpRequest 相同的功能，但更具有可扩展性和高效性。</p>
<p>Fetch API 提供了一个获取资源的接口（包括跨域请求）。且基于 Promise。</p>
<h4 id="核心"><a href="#核心" class="headerlink" title="核心"></a>核心</h4><p>Fetch 的核心在于对 HTTP 接口的抽象，包括 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Request"><code>Request</code></a>，<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Response"><code>Response</code></a>，<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Headers"><code>Headers</code></a>，<code>Body</code>，以及用于初始化异步请求的 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/fetch"><code>global fetch</code></a>。得益于 JavaScript 实现的这些抽象好的 HTTP 模块，其他接口能够很方便的使用这些功能。</p>
<h5 id="Guard"><a href="#Guard" class="headerlink" title="Guard"></a>Guard</h5><p>Guard 是 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Headers"><code>Headers</code></a> 对象的特性，基于不同的情况，它可以有以下取值：<code>immutable</code>、<code>request</code>、<code>request-no-cors</code>、<code>response</code> 或 <code>none</code>。</p>
<p>头信息的 guard 会影响 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Headers/set"><code>set()</code></a>、<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Headers/delete"><code>delete()</code></a> 和 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Headers/append"><code>append()</code></a> 方法。</p>
<h4 id="实战-1"><a href="#实战-1" class="headerlink" title="实战"></a>实战</h4><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> myImage <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'img'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> myHeaders <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Headers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
myHeaders<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'Content-Type'</span><span class="token punctuation">,</span> <span class="token string">'image/jpeg'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> myInit <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">'GET'</span><span class="token punctuation">,</span>
               <span class="token literal-property property">headers</span><span class="token operator">:</span> myHeaders<span class="token punctuation">,</span>
               <span class="token literal-property property">mode</span><span class="token operator">:</span> <span class="token string">'cors'</span><span class="token punctuation">,</span>
               <span class="token literal-property property">cache</span><span class="token operator">:</span> <span class="token string">'default'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> myRequest <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Request</span><span class="token punctuation">(</span><span class="token string">'flowers.jpg'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">fetch</span><span class="token punctuation">(</span>myRequest<span class="token punctuation">,</span>myInit<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token operator">...</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
<span class="token comment">// 或</span>
<span class="token keyword">var</span> myInit <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">'GET'</span><span class="token punctuation">,</span>
               <span class="token literal-property property">headers</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
                   <span class="token string-property property">'Content-Type'</span><span class="token operator">:</span> <span class="token string">'image/jpeg'</span>
               <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
               <span class="token literal-property property">mode</span><span class="token operator">:</span> <span class="token string">'cors'</span><span class="token punctuation">,</span>
               <span class="token literal-property property">cache</span><span class="token operator">:</span> <span class="token string">'default'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> myRequest <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Request</span><span class="token punctuation">(</span><span class="token string">'flowers.jpg'</span><span class="token punctuation">,</span> myInit<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

]]></content>
      <categories>
        <category>前端</category>
        <category>基础</category>
      </categories>
      <tags>
        <tag>前端</tag>
        <tag>基础</tag>
      </tags>
  </entry>
  <entry>
    <title>基础系列-async&amp;await</title>
    <url>/posts/3776/</url>
    <content><![CDATA[<h3 id="async-函数与-await-命令的使用"><a href="#async-函数与-await-命令的使用" class="headerlink" title="async 函数与 await 命令的使用"></a>async 函数与 await 命令的使用</h3><h4 id="解决的问题："><a href="#解决的问题：" class="headerlink" title="解决的问题："></a>解决的问题：</h4><p>减少多层嵌套，可以进行同步的写法。</p>
<p>使<code>Promise</code>链式调用可控，即中间<code>promise</code>出现问题后能够跳出继续向下调用，能够及时处理错误。</p>
<h4 id="优点："><a href="#优点：" class="headerlink" title="优点："></a>优点：</h4><p>(1)内置执行器。<code>async</code> 函数的执行与普通函数一模一样，只要一行。</p>
<p>(2)更好的语义。<code>async</code> 表示函数里有异步操作，<code>await</code> 表示紧跟在后面的表达式需要等待结果。</p>
<p>(3)更广的适用性。<code>async</code> 函数的 <code>await</code> 命令后面，可以跟 <code>Promise</code> 对象和原始类型的值（数值、字符串和布尔值，但这时等同于同步操作）。</p>
<h4 id="用法："><a href="#用法：" class="headerlink" title="用法："></a>用法：</h4><p><strong><code>async</code> 函数返回一个 <code>Promise</code> 对象，可以使用 then 方法添加回调函数</strong>。当函数执行的时候，一旦遇到 <code>await</code> 就会<strong>立即调用</strong>，等到触发的异步操作完成，再接着执行函数体内后面的语句。例如：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">getStockPriceByName</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">// 获取股票报价</span>
  <span class="token keyword">var</span> symbol <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getStockSymbol</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> stockPrice <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getStockPrice</span><span class="token punctuation">(</span>symbol<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> stockPrice<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span> <span class="token comment">// async关键字表明该函数内部有异步操作</span>

<span class="token function">getStockPriceByName</span><span class="token punctuation">(</span><span class="token string">'goog'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">result</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 调用该函数时会立即返回一个Promise对象</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>指定50毫秒后输出“hello world”</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">timeout</span><span class="token punctuation">(</span><span class="token parameter">ms</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> ms<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">asyncPrint</span><span class="token punctuation">(</span><span class="token parameter">value<span class="token punctuation">,</span> ms</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">await</span> <span class="token function">timeout</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token function">asyncPrint</span><span class="token punctuation">(</span><span class="token string">'hello world'</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="注意点"><a href="#注意点" class="headerlink" title="注意点"></a>注意点</h4><p>(1) <strong>await 命令后面的 Promise 对象，运行结果可能是 rejected，所以最好把 await 命令放在 try…catch 代码块中</strong>。</p>
<p><code>await</code> 最后返回的结果是 <code>resolve</code> ，无法处理 <code>reject</code> 情况。</p>
<blockquote>
<p>如果await关键字后面的Promise对象中没有执行resolve方法，就会导致Promise一直处在pending状态，无法执行then方法，因此await后面的代码不会执行。</p>
</blockquote>
<p>错误处理：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">somethingThatReturnsAPromise</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise<span class="token punctuation">.</span>reject</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 错误处理</span>
<span class="token comment">// 写法一</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">myFunction</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">await</span> <span class="token function">somethingThatReturnsAPromise</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 写法二</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">myFunction</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">await</span> <span class="token function">somethingThatReturnsAPromise</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 写法三</span>
<span class="token keyword">function</span> <span class="token function">errPromise</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        <span class="token function">reject</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'promise err: '</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">myFunction</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">errPromise</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'await result'</span><span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token comment">// promise err: 1, await result: undefined </span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>易错情况：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 无法处理 reject 情况</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name">Promise<span class="token punctuation">.</span>reject</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'执行结束'</span><span class="token punctuation">)</span> <span class="token comment">// 报错，无法执行到console</span>
<span class="token punctuation">&#125;</span>
<span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// 改正</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">await</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
     console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'执行结束: '</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 执行结束: false</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>(2) <code>await</code> 命令只能用在 <code>async</code> 函数之中，如果用在普通函数，就会报错。</p>
<p>但是，<code>await</code> 可以用于等待一个 <code>async</code> 函数的返回值，<code>await</code> 不仅等 <code>promise</code> 对象，也可以等任意表达式的结果。</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">dbFuc</span><span class="token punctuation">(</span><span class="token parameter">db</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">let</span> docs <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

  <span class="token comment">// 报错</span>
  docs<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">doc</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">// 在function前加async关键字也有问题，db.post(doc)是并法的，而不是继发执行，应当采用for循环，而不是forEach</span>
    <span class="token keyword">await</span> db<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span>doc<span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// await 返回普通函数</span>
<span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token boolean">false</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">c</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'res: '</span><span class="token punctuation">,</span> res<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>
<span class="token function">c</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// res: false</span>

<span class="token comment">// await 返回普通包装函数</span>
<span class="token keyword">function</span> <span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token function">b</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">function</span> <span class="token function">b</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">// 注意 当前结果只处理了 resolve 情况</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">c</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'res: '</span><span class="token punctuation">,</span> res<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>
<span class="token function">c</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// 改进</span>
<span class="token keyword">function</span> <span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token function">b</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'出错: '</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">function</span> <span class="token function">b</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">// 如果是 reject(1) =》 输出结果是 出错: 1 res: undefined</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">c</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'res: '</span><span class="token punctuation">,</span> res<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token function">c</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// resolve 输出结果 res: 1</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>(3) 如果 <code>async</code> 函数返回非 <code>Promise</code> 对象，那么返回值会被封装成 <code>Promise</code> 对象。</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// async 包装普通函数为 promise</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token string">'test'</span>
<span class="token punctuation">&#125;</span>

<span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'res: '</span><span class="token punctuation">,</span> res<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span> <span class="token comment">// res: test</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>(4) 使用<code>promise.all</code>方法解决多个请求并发执行</p>
<blockquote>
<p>在定义 promise 时函数就开始执行</p>
</blockquote>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 写法一</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">dbFuc</span><span class="token punctuation">(</span><span class="token parameter">db</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">let</span> docs <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> promises <span class="token operator">=</span> docs<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">doc</span><span class="token punctuation">)</span> <span class="token operator">=></span> db<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span>doc<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">let</span> results <span class="token operator">=</span> <span class="token keyword">await</span> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span>promises<span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>results<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 写法二</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">dbFuc</span><span class="token punctuation">(</span><span class="token parameter">db</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">let</span> docs <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> promises <span class="token operator">=</span> docs<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">doc</span><span class="token punctuation">)</span> <span class="token operator">=></span> db<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span>doc<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">let</span> results <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> promise <span class="token keyword">of</span> promises<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    results<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token keyword">await</span> promise<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>results<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="使用Generators-Promise-实现-Await"><a href="#使用Generators-Promise-实现-Await" class="headerlink" title="使用Generators + Promise 实现 Await"></a>使用Generators + Promise 实现 Await</h3><p>将 <code>Generator</code>（看似同步的异步代码）与 <code>Promise</code>（可靠性和可组合性）组合起来。</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token parameter">gen</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">var</span> args <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span> arguments<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> it<span class="token punctuation">;</span>

    <span class="token comment">// 在当前的上下文环境中初始化generator</span>
    it <span class="token operator">=</span> <span class="token function">gen</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span> <span class="token keyword">this</span><span class="token punctuation">,</span> args <span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 为generator的完成返回一个promise</span>
    <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span> <span class="token keyword">function</span> <span class="token function">handleNext</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
            <span class="token comment">// 运行至下一个让出的值</span>
            <span class="token keyword">var</span> next <span class="token operator">=</span> it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span> value <span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">handleResult</span><span class="token punctuation">(</span><span class="token parameter">next</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
                <span class="token comment">// generator已经完成运行了？</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>next<span class="token punctuation">.</span>done<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    <span class="token keyword">return</span> next<span class="token punctuation">.</span>value<span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span>
                <span class="token comment">// 否则继续执行</span>
                <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
                    <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span> next<span class="token punctuation">.</span>value <span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>
                            <span class="token comment">// 在成功的情况下继续异步循环，将解析的值送回generator</span>
                            handleNext<span class="token punctuation">,</span>

                            <span class="token comment">// 如果`value`是一个拒绝的promise，就将错误传播回generator自己的错误处理</span>
                            <span class="token keyword">function</span> <span class="token function">handleErr</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                                <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>
                                    it<span class="token punctuation">.</span><span class="token function">throw</span><span class="token punctuation">(</span> err <span class="token punctuation">)</span>
                                <span class="token punctuation">)</span>
                                    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span> handleResult <span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token punctuation">&#125;</span>
                        <span class="token punctuation">)</span><span class="token punctuation">;</span>
                	<span class="token punctuation">&#125;</span>
        	<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">(</span>next<span class="token punctuation">)</span><span class="token punctuation">;</span>
    	<span class="token punctuation">&#125;</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 使用</span>
<span class="token comment">// 创建一个Generator</span>
<span class="token keyword">function</span> <span class="token operator">*</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// axios返回一个promise</span>
	<span class="token keyword">var</span> r1 <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token function">axios</span><span class="token punctuation">(</span> <span class="token string">"http://some.url.1"</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">var</span> r2 <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token function">axios</span><span class="token punctuation">(</span> <span class="token string">"http://some.url.2"</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">var</span> r3 <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token function">axios</span><span class="token punctuation">(</span>
		<span class="token string">"http://some.url.3/?v="</span> <span class="token operator">+</span> r1 <span class="token operator">+</span> <span class="token string">","</span> <span class="token operator">+</span> r2
	<span class="token punctuation">)</span><span class="token punctuation">;</span>

	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> r3 <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 使用刚才定义的`run(..)`工具</span>
<span class="token function">run</span><span class="token punctuation">(</span> foo <span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>代码为《你不知道的JavaScript（中卷）》中的示例代码</p>
</blockquote>
<h3 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h3><p>阮一峰·async 函数的含义和用法：<a href="http://www.ruanyifeng.com/blog/2015/05/async.html">http://www.ruanyifeng.com/blog/2015/05/async.html</a></p>
<p>理解 JavaScript 的 async/await：<a href="https://segmentfault.com/a/1190000007535316">https://segmentfault.com/a/1190000007535316</a></p>
]]></content>
      <categories>
        <category>前端</category>
        <category>基础</category>
      </categories>
      <tags>
        <tag>前端</tag>
        <tag>面试</tag>
        <tag>promise</tag>
        <tag>es6</tag>
        <tag>async/await</tag>
      </tags>
  </entry>
  <entry>
    <title>基础系列-onerror处理</title>
    <url>/posts/acbe5842/</url>
    <content><![CDATA[<h3 id="理论"><a href="#理论" class="headerlink" title="理论"></a>理论</h3><h4 id="GlobalEventHandlers-onerror"><a href="#GlobalEventHandlers-onerror" class="headerlink" title="GlobalEventHandlers.onerror"></a><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/GlobalEventHandlers/onerror">GlobalEventHandlers.onerror</a></h4><p>用于处理 error 事件。</p>
<p><code>Error</code>事件的<a href="https://developer.mozilla.org/en-US/docs/Web/Events/Event_handlers">事件处理程序 (en-US)</a>，在各种目标对象的不同类型错误被触发：</p>
<ul>
<li>当<strong>JavaScript运行时错误</strong>（包括语法错误）发生时，<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Window"><code>window</code></a>会触发一个<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/ErrorEvent"><code>ErrorEvent</code></a>接口的<code>error</code>事件，并执行<code>window.onerror()</code>。</li>
<li>当一项资源（如<code>&lt;img&gt;</code> 或 <code>&lt;script&gt;</code> ）<strong>加载失败</strong>，加载资源的元素会触发一个<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Event"><code>Event</code></a>接口的<code>error</code>事件，并执行该元素上的<code>onerror()</code>处理函数。<strong>这些error事件不会向上冒泡到 window</strong>，不过（至少在Firefox中）能被单一的<a href="https://developer.mozilla.org/en-US/docs/Web/API/EventTarget/addEventListener"><code>window.addEventListener</code> (en-US)</a>捕获。<strong>可以使用捕获的方式监听到资源加载失败。</strong></li>
</ul>
<p>加载一个全局的<code>error</code>事件处理函数可用于自动收集错误报告。</p>
<blockquote>
<p>由于历史原因，<code>window.onerror</code>和<code>element.onerror</code>接受不同的参数。</p>
</blockquote>
<h4 id="window-onerror"><a href="#window-onerror" class="headerlink" title="window.onerror"></a>window.onerror</h4><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">window<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">message<span class="token punctuation">,</span> source<span class="token punctuation">,</span> lineno<span class="token punctuation">,</span> colno<span class="token punctuation">,</span> error</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token operator">...</span> <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>函数参数：</p>
<ul>
<li><code>message</code>：错误信息（字符串）。可用于HTML <code>onerror=&quot;&quot;</code>处理程序中的<code>event</code>。</li>
<li><code>source</code>：发生错误的脚本URL（字符串）</li>
<li><code>lineno</code>：发生错误的行号（数字）</li>
<li><code>colno</code>：发生错误的列号（数字）</li>
<li><code>error</code>：<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Error">Error对象</a>（对象）</li>
</ul>
<p>若该函数返回<code>true</code>，则阻止执行默认事件处理函数。</p>
<p>这种方式只能捕获脚本错误问题。</p>
<h4 id="window-addEventListener-‘error’"><a href="#window-addEventListener-‘error’" class="headerlink" title="window.addEventListener(‘error’)"></a>window.addEventListener(‘error’)</h4><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token operator">...</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span> <span class="token comment">// 冒泡方式只能获取到脚本错误问题</span>
window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token operator">...</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token comment">// 捕获方式可以获取到脚本错误和资源加载失败的问题</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/ErrorEvent"><code>ErrorEvent</code></a> 类型的<code>event</code>包含有关事件和错误的所有信息。</p>
<blockquote>
<p><strong><code>ErrorEvent</code></strong> 事件对象在脚本发生错误时产生，它可以提供发生错误的脚本文件的文件名，以及发生错误时所在的行号等信息。</p>
</blockquote>
<p><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Event">Event</a> 类型为资源加载失败返回的类型。</p>
<h4 id="Element-onerror"><a href="#Element-onerror" class="headerlink" title="Element.onerror"></a>Element.onerror</h4><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">element<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token operator">...</span> <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>



<h4 id="element-addEventListener-‘error’"><a href="#element-addEventListener-‘error’" class="headerlink" title="element.addEventListener(‘error’)"></a><a href="https://developer.mozilla.org/en-US/docs/Web/API/Element/error_event">element.addEventListener(‘error’)</a></h4><p>可以监听到脚本执行错误或者资源未加载的错误。</p>
<p>html</p>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>controls<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>img-error<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>button<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Generate image error<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>bad-img<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>event-log<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span><span class="token punctuation">></span></span>Event log:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>textarea</span> <span class="token attr-name">readonly</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>event-log-contents<span class="token punctuation">"</span></span> <span class="token attr-name">rows</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>8<span class="token punctuation">"</span></span> <span class="token attr-name">cols</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>30<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>textarea</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>js</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> log <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'.event-log-contents'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> badImg <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'.bad-img'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
badImg<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    log<span class="token punctuation">.</span>textContent <span class="token operator">=</span> log<span class="token punctuation">.</span>textContent <span class="token operator">+</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>event<span class="token punctuation">.</span>type<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">: Loading image\n</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> imgError <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#img-error'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
imgError<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    badImg<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">'src'</span><span class="token punctuation">,</span> <span class="token string">'i-dont-exist'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h4 id="window-addEventListener-‘load’"><a href="#window-addEventListener-‘load’" class="headerlink" title="window.addEventListener(‘load’)"></a><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Window/load_event">window.addEventListener(‘load’)</a></h4><p>当整个页面及所有依赖资源如样式表和图片都已完成加载时，将触发<code>load</code>事件。</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'load'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'page is fully loaded'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>



<h4 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h4><p>跨域问题</p>
<p>监听设置的位置问题</p>
<h3 id="实践"><a href="#实践" class="headerlink" title="实践"></a>实践</h3><p>公司有做一个白屏检测，检测资源是否未加载。</p>
<p>逻辑为：</p>
<ol>
<li><p>先在入口文件中挂载特定的 dom，设置 window.addEventListener(‘load’, callback)，监听事件，当首页加载完毕后，响应 load 监听事件判断 dom 是否挂载，如果没有在 dom 树上找到目标元素，则表示发生了白屏事件。</p>
</li>
<li><p>设置 window.addEventListener(‘error’, callback, true) 使用捕获的方式监听到资源加载失败。其中判断 cdn 加载失败，则会重新创建 link 和 script 标签重新加载，如果二次重载的资源错误则表示用户进入了网络链接不稳定的状态。</p>
</li>
<li><p>设置 window.addEventListener(‘load’, callback, false) 监听页面资源加载完成的情况。</p>
</li>
<li><p>手动判断是否资源加载的问题，然后将问题上报到 sentry。</p>
<blockquote>
<p>但是不排除代码中出现 undefined 导致的白屏问题，比如说 A 页面跳转到 B 页面需要传参，但是发生了 undefined 的问题，则会直接导致 B 页面白屏。</p>
</blockquote>
</li>
</ol>
<h4 id="DEMO"><a href="#DEMO" class="headerlink" title="DEMO"></a>DEMO</h4><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>X-UA-Compatible<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>IE=edge<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>width=device-width, initial-scale=1.0<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>Error<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span>
  测试 error
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>someimage.png<span class="token punctuation">"</span></span> <span class="token special-attr"><span class="token attr-name">onerror</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value javascript language-javascript"><span class="token function">handleError</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span></span><span class="token punctuation">"</span></span></span> <span class="token punctuation">/></span></span>
  error
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>controls<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>img-error<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>button<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Generate image error<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>bad-img<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>event-log<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span><span class="token punctuation">></span></span>Event log:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>textarea</span> <span class="token attr-name">readonly</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>event-log-contents<span class="token punctuation">"</span></span> <span class="token attr-name">rows</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>8<span class="token punctuation">"</span></span> <span class="token attr-name">cols</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>30<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>textarea</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token special-attr"><span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value javascript language-javascript"><span class="token function">makeError</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token punctuation">"</span></span></span><span class="token punctuation">></span></span>调用error<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">function</span> <span class="token function">handleError</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'handleError: '</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>

  window<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">msg<span class="token punctuation">,</span> url<span class="token punctuation">,</span> line<span class="token punctuation">,</span> col<span class="token punctuation">,</span> error</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// 直接将错误打印到控制台</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'window.onerror: '</span><span class="token punctuation">,</span> msg<span class="token punctuation">,</span> url<span class="token punctuation">,</span> line<span class="token punctuation">,</span> col<span class="token punctuation">,</span> error<span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span>

  window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> 
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'addEventListener: '</span><span class="token punctuation">,</span> event<span class="token punctuation">,</span> event <span class="token keyword">instanceof</span> <span class="token class-name">ErrorEvent</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'addEventListener after: '</span><span class="token punctuation">,</span> event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>baseURI<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span>

  window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'load'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'page is fully loaded'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> log <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'.event-log-contents'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> badImg <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'.bad-img'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  badImg<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
      log<span class="token punctuation">.</span>textContent <span class="token operator">=</span> log<span class="token punctuation">.</span>textContent <span class="token operator">+</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>event<span class="token punctuation">.</span>type<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">: Loading image\n</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'addEventListener badImg: '</span><span class="token punctuation">,</span> event<span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> imgError <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#img-error'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  imgError<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
      badImg<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">'src'</span><span class="token punctuation">,</span> <span class="token string">'i-dont-exist'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">function</span> <span class="token function">makeError</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">var</span> name <span class="token operator">=</span> <span class="token string">"geoff"</span>
    <span class="token keyword">var</span> msg <span class="token operator">=</span> <span class="token string">"Hi, "</span> <span class="token operator">+</span> Name
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>someimage.js<span class="token punctuation">"</span></span> <span class="token special-attr"><span class="token attr-name">onerror</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value javascript language-javascript"><span class="token function">handleError</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span></span><span class="token punctuation">"</span></span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="白屏方案"><a href="#白屏方案" class="headerlink" title="白屏方案"></a>白屏方案</h3><p>参考链接：<a href="https://segmentfault.com/a/1190000040236233">https://segmentfault.com/a/1190000040236233</a></p>
<h3 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h3><p>GlobalEventHandlers.onerror：<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/GlobalEventHandlers/onerror">https://developer.mozilla.org/zh-CN/docs/Web/API/GlobalEventHandlers/onerror</a></p>
<p>GlobalEventHandlers：<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/GlobalEventHandlers">https://developer.mozilla.org/zh-CN/docs/Web/API/GlobalEventHandlers</a></p>
<p>ErrorEvent：<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/ErrorEvent">https://developer.mozilla.org/zh-CN/docs/Web/API/ErrorEvent</a></p>
]]></content>
      <categories>
        <category>前端</category>
        <category>基础</category>
      </categories>
      <tags>
        <tag>前端</tag>
        <tag>基础</tag>
        <tag>onerror</tag>
      </tags>
  </entry>
  <entry>
    <title>基础系列-less学习-1</title>
    <url>/posts/21719/</url>
    <content><![CDATA[<p>官网：<a href="https://lesscss.org/#">https://lesscss.org/#</a></p>
<h4 id="1-amp-（表示父级选择器）"><a href="#1-amp-（表示父级选择器）" class="headerlink" title="1. &amp;（表示父级选择器）"></a>1. &amp;（表示父级选择器）</h4><p>就近原则</p>
<pre class="line-numbers language-less" data-language="less"><code class="language-less"><span class="token selector">a</span> <span class="token punctuation">&#123;</span>
  <span class="token property">color</span><span class="token punctuation">:</span> blue<span class="token punctuation">;</span>
  <span class="token selector">&amp;:hover</span> <span class="token punctuation">&#123;</span>
    <span class="token property">color</span><span class="token punctuation">:</span> green<span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>编译后：</p>
<pre class="line-numbers language-less" data-language="less"><code class="language-less"><span class="token selector">a</span> <span class="token punctuation">&#123;</span>
  <span class="token property">color</span><span class="token punctuation">:</span> blue<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token selector">a:hover</span> <span class="token punctuation">&#123;</span>
  <span class="token property">color</span><span class="token punctuation">:</span> green<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h6 id="重复类名"><a href="#重复类名" class="headerlink" title="重复类名"></a>重复类名</h6><pre class="line-numbers language-less" data-language="less"><code class="language-less"><span class="token selector">.button</span> <span class="token punctuation">&#123;</span>
  <span class="token selector">&amp;-ok</span> <span class="token punctuation">&#123;</span>
    <span class="token property">background-image</span><span class="token punctuation">:</span> <span class="token url"><span class="token function">url</span><span class="token punctuation">(</span><span class="token string url">"ok.png"</span><span class="token punctuation">)</span></span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  <span class="token selector">&amp;-cancel</span> <span class="token punctuation">&#123;</span>
    <span class="token property">background-image</span><span class="token punctuation">:</span> <span class="token url"><span class="token function">url</span><span class="token punctuation">(</span><span class="token string url">"cancel.png"</span><span class="token punctuation">)</span></span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>

  <span class="token selector">&amp;-custom</span> <span class="token punctuation">&#123;</span>
    <span class="token property">background-image</span><span class="token punctuation">:</span> <span class="token url"><span class="token function">url</span><span class="token punctuation">(</span><span class="token string url">"custom.png"</span><span class="token punctuation">)</span></span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>编译后：</p>
<pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token selector">.button-ok</span> <span class="token punctuation">&#123;</span>
  <span class="token property">background-image</span><span class="token punctuation">:</span> <span class="token url"><span class="token function">url</span><span class="token punctuation">(</span><span class="token string url">"ok.png"</span><span class="token punctuation">)</span></span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token selector">.button-cancel</span> <span class="token punctuation">&#123;</span>
  <span class="token property">background-image</span><span class="token punctuation">:</span> <span class="token url"><span class="token function">url</span><span class="token punctuation">(</span><span class="token string url">"cancel.png"</span><span class="token punctuation">)</span></span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token selector">.button-custom</span> <span class="token punctuation">&#123;</span>
  <span class="token property">background-image</span><span class="token punctuation">:</span> <span class="token url"><span class="token function">url</span><span class="token punctuation">(</span><span class="token string url">"custom.png"</span><span class="token punctuation">)</span></span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h6 id="多个-amp"><a href="#多个-amp" class="headerlink" title="多个&amp;"></a>多个&amp;</h6><pre class="line-numbers language-less" data-language="less"><code class="language-less"><span class="token selector">.link</span> <span class="token punctuation">&#123;</span>
  <span class="token selector">&amp; + &amp;</span> <span class="token punctuation">&#123;</span>
    <span class="token property">color</span><span class="token punctuation">:</span> red<span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>

  <span class="token selector">&amp; &amp;</span> <span class="token punctuation">&#123;</span>
    <span class="token property">color</span><span class="token punctuation">:</span> green<span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>

  <span class="token selector">&amp;&amp;</span> <span class="token punctuation">&#123;</span>
    <span class="token property">color</span><span class="token punctuation">:</span> blue<span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>

  <span class="token selector">&amp;, &amp;ish</span> <span class="token punctuation">&#123;</span>
    <span class="token property">color</span><span class="token punctuation">:</span> cyan<span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>编译后：</p>
<pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token selector">.link + .link</span> <span class="token punctuation">&#123;</span>
  <span class="token property">color</span><span class="token punctuation">:</span> red<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token selector">.link .link</span> <span class="token punctuation">&#123;</span>
  <span class="token property">color</span><span class="token punctuation">:</span> green<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token selector">.link.link</span> <span class="token punctuation">&#123;</span>
  <span class="token property">color</span><span class="token punctuation">:</span> blue<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token selector">.link, .linkish</span> <span class="token punctuation">&#123;</span>
  <span class="token property">color</span><span class="token punctuation">:</span> cyan<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h6 id="改变选择器的顺序"><a href="#改变选择器的顺序" class="headerlink" title="改变选择器的顺序"></a>改变选择器的顺序</h6><pre class="line-numbers language-less" data-language="less"><code class="language-less"><span class="token selector">.header</span> <span class="token punctuation">&#123;</span>
  <span class="token selector">.menu</span> <span class="token punctuation">&#123;</span>
    <span class="token property">border-radius</span><span class="token punctuation">:</span> 5px<span class="token punctuation">;</span>
    <span class="token selector">.no-borderradius &amp;</span> <span class="token punctuation">&#123;</span> <span class="token comment">// .no-borderradius .header .menu</span>
      <span class="token property">background-image</span><span class="token punctuation">:</span> <span class="token url"><span class="token function">url</span><span class="token punctuation">(</span><span class="token string url">'images/button-background.png'</span><span class="token punctuation">)</span></span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h6 id="罗列所有组合"><a href="#罗列所有组合" class="headerlink" title="罗列所有组合"></a>罗列所有组合</h6><pre class="line-numbers language-less" data-language="less"><code class="language-less"><span class="token selector">p, a, ul, li</span> <span class="token punctuation">&#123;</span>
  <span class="token property">border-top</span><span class="token punctuation">:</span> 2px dotted #366<span class="token punctuation">;</span>
  <span class="token selector">&amp; + &amp;</span> <span class="token punctuation">&#123;</span> <span class="token comment">// p + p, p + a, p + ul...</span>
    <span class="token property">border-top</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h6 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h6><p>&amp;表示所有父选择器</p>
<pre class="line-numbers language-less" data-language="less"><code class="language-less"><span class="token selector">.grand</span> <span class="token punctuation">&#123;</span>
  <span class="token selector">.parent</span> <span class="token punctuation">&#123;</span>
    <span class="token selector">&amp; > &amp;</span> <span class="token punctuation">&#123;</span>
      <span class="token property">color</span><span class="token punctuation">:</span> red<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token selector">&amp; &amp;</span> <span class="token punctuation">&#123;</span>
      <span class="token property">color</span><span class="token punctuation">:</span> green<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token selector">&amp;&amp;</span> <span class="token punctuation">&#123;</span>
      <span class="token property">color</span><span class="token punctuation">:</span> blue<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token selector">&amp;, &amp;ish</span> <span class="token punctuation">&#123;</span>
      <span class="token property">color</span><span class="token punctuation">:</span> cyan<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>编译后：</p>
<pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token selector">.grand .parent > .grand .parent</span> <span class="token punctuation">&#123;</span>
  <span class="token property">color</span><span class="token punctuation">:</span> red<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token selector">.grand .parent .grand .parent</span> <span class="token punctuation">&#123;</span>
  <span class="token property">color</span><span class="token punctuation">:</span> green<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token selector">.grand .parent.grand .parent</span> <span class="token punctuation">&#123;</span>
  <span class="token property">color</span><span class="token punctuation">:</span> blue<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token selector">.grand .parent,
.grand .parentish</span> <span class="token punctuation">&#123;</span>
  <span class="token property">color</span><span class="token punctuation">:</span> cyan<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h4 id="2-Mixin"><a href="#2-Mixin" class="headerlink" title="2.Mixin"></a>2.Mixin</h4><h6 id="混合使用已存在的属性值"><a href="#混合使用已存在的属性值" class="headerlink" title="混合使用已存在的属性值"></a>混合使用已存在的属性值</h6><p>可以混合使用类选择器和id选择器</p>
<pre class="line-numbers language-less" data-language="less"><code class="language-less"><span class="token selector">.a, #b</span> <span class="token punctuation">&#123;</span> <span class="token comment">// 类选择器和id选择器</span>
  <span class="token property">color</span><span class="token punctuation">:</span> red<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token selector">.mixin-class</span> <span class="token punctuation">&#123;</span>
  <span class="token mixin-usage function">.a</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token selector">.mixin-id</span> <span class="token punctuation">&#123;</span>
  <span class="token mixin-usage function">#b</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>编译后：</p>
<pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token selector">.a, #b</span> <span class="token punctuation">&#123;</span> 
  <span class="token property">color</span><span class="token punctuation">:</span> red<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token selector">.mixin-class</span> <span class="token punctuation">&#123;</span>
  <span class="token property">color</span><span class="token punctuation">:</span> red<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token selector">.mixin-id</span> <span class="token punctuation">&#123;</span>
  <span class="token property">color</span><span class="token punctuation">:</span> red<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h6 id="不在css中输出的混合用法"><a href="#不在css中输出的混合用法" class="headerlink" title="不在css中输出的混合用法"></a>不在css中输出的混合用法</h6><pre class="line-numbers language-less" data-language="less"><code class="language-less"><span class="token selector">.my-mixin</span> <span class="token punctuation">&#123;</span>
  <span class="token property">color</span><span class="token punctuation">:</span> black<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token selector">.my-other-mixin()</span> <span class="token punctuation">&#123;</span> <span class="token comment">// 只是在less中声明，并没有实际的类与之对应</span>
  <span class="token property">background</span><span class="token punctuation">:</span> white<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token selector">.class</span> <span class="token punctuation">&#123;</span>
  <span class="token mixin-usage function">.my-mixin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token mixin-usage function">.my-other-mixin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>编译后：</p>
<pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token selector">.my-mixin</span> <span class="token punctuation">&#123;</span>
  <span class="token property">color</span><span class="token punctuation">:</span> black<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token selector">.class</span> <span class="token punctuation">&#123;</span>
  <span class="token property">color</span><span class="token punctuation">:</span> black<span class="token punctuation">;</span>
  <span class="token property">background</span><span class="token punctuation">:</span> white<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h6 id="选择器混用"><a href="#选择器混用" class="headerlink" title="选择器混用"></a>选择器混用</h6><pre class="line-numbers language-less" data-language="less"><code class="language-less"><span class="token selector">.my-hover-mixin()</span> <span class="token punctuation">&#123;</span> <span class="token comment">// 一个mixin中可以包含多个选择器或属性</span>
  <span class="token selector">&amp;:hover</span> <span class="token punctuation">&#123;</span>
    <span class="token property">border</span><span class="token punctuation">:</span> 1px solid red<span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token selector">button</span> <span class="token punctuation">&#123;</span>
  <span class="token mixin-usage function">.my-hover-mixin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>编译后：</p>
<pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token selector">button:hover</span> <span class="token punctuation">&#123;</span>
  <span class="token property">border</span><span class="token punctuation">:</span> 1px solid red<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<h6 id="namespace"><a href="#namespace" class="headerlink" title="namespace"></a>namespace</h6><p>如果在更复杂的选择器中混合属性，可以堆叠多个id或类</p>
<pre class="line-numbers language-less" data-language="less"><code class="language-less"><span class="token selector">#outer()</span> <span class="token punctuation">&#123;</span>
  <span class="token selector">.inner</span> <span class="token punctuation">&#123;</span>
    <span class="token property">color</span><span class="token punctuation">:</span> red<span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token selector">.c</span> <span class="token punctuation">&#123;</span>
  <span class="token mixin-usage function">#outer > .inner</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token selector">#my-library</span> <span class="token punctuation">&#123;</span>
  <span class="token selector">.my-mixin()</span> <span class="token punctuation">&#123;</span>
    <span class="token property">color</span><span class="token punctuation">:</span> black<span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">// which can be used like this</span>
<span class="token selector">.class</span> <span class="token punctuation">&#123;</span>
  <span class="token mixin-usage function">#my-library.my-mixin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>使用方式</p>
<pre class="line-numbers language-less" data-language="less"><code class="language-less"><span class="token comment">// all do the same thing</span>
#outer > .<span class="token function">inner</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token mixin-usage function">#outer .inner</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token mixin-usage function">#outer.inner</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<h6 id="参数混合"><a href="#参数混合" class="headerlink" title="参数混合"></a>参数混合</h6><pre class="line-numbers language-less" data-language="less"><code class="language-less"><span class="token selector">.border-radius(<span class="token variable">@radius</span>)</span> <span class="token punctuation">&#123;</span> <span class="token comment">// 默认值 .border-radius(@radius: 5px)</span>
  <span class="token property">-webkit-border-radius</span><span class="token punctuation">:</span> <span class="token variable">@radius</span><span class="token punctuation">;</span>
     <span class="token property">-moz-border-radius</span><span class="token punctuation">:</span> <span class="token variable">@radius</span><span class="token punctuation">;</span>
          <span class="token property">border-radius</span><span class="token punctuation">:</span> <span class="token variable">@radius</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">// use</span>
<span class="token selector">#header</span> <span class="token punctuation">&#123;</span>
  <span class="token mixin-usage function">.border-radius</span><span class="token punctuation">(</span>4px<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token selector">.button</span> <span class="token punctuation">&#123;</span>
  <span class="token mixin-usage function">.border-radius</span><span class="token punctuation">(</span>6px<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>多个参数用分号分隔。</p>
<p>可以定义多个名称和参数相同的mixin是合法的。</p>
<pre class="line-numbers language-less" data-language="less"><code class="language-less"><span class="token selector">.mixin(<span class="token variable">@color</span>)</span> <span class="token punctuation">&#123;</span>
  <span class="token property">color-1</span><span class="token punctuation">:</span> <span class="token variable">@color</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token selector">.mixin(<span class="token variable">@color</span>; <span class="token variable">@padding</span>: 2)</span> <span class="token punctuation">&#123;</span>
  <span class="token property">color-2</span><span class="token punctuation">:</span> <span class="token variable">@color</span><span class="token punctuation">;</span>
  <span class="token property">padding-2</span><span class="token punctuation">:</span> <span class="token variable">@padding</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token selector">.mixin(<span class="token variable">@color</span>; <span class="token variable">@padding</span>; <span class="token variable">@margin</span>: 2)</span> <span class="token punctuation">&#123;</span>
  <span class="token property">color-3</span><span class="token punctuation">:</span> <span class="token variable">@color</span><span class="token punctuation">;</span>
  <span class="token property">padding-3</span><span class="token punctuation">:</span> <span class="token variable">@padding</span><span class="token punctuation">;</span>
  <span class="token property">margin</span><span class="token punctuation">:</span> <span class="token variable">@margin</span> <span class="token variable">@margin</span> <span class="token variable">@margin</span> <span class="token variable">@margin</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token selector">.some .selector div</span> <span class="token punctuation">&#123;</span>
  <span class="token mixin-usage function">.mixin</span><span class="token punctuation">(</span>#008000<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>编译后：</p>
<pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token selector">.some .selector div</span> <span class="token punctuation">&#123;</span>
  <span class="token property">color-1</span><span class="token punctuation">:</span> #008000<span class="token punctuation">;</span>
  <span class="token property">color-2</span><span class="token punctuation">:</span> #008000<span class="token punctuation">;</span>
  <span class="token property">padding-2</span><span class="token punctuation">:</span> 2<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>命名参数</p>
<pre class="line-numbers language-less" data-language="less"><code class="language-less"><span class="token selector">.mixin(<span class="token variable">@color</span>: black; <span class="token variable">@margin</span>: 10px; <span class="token variable">@padding</span>: 20px)</span> <span class="token punctuation">&#123;</span>
  <span class="token property">color</span><span class="token punctuation">:</span> <span class="token variable">@color</span><span class="token punctuation">;</span>
  <span class="token property">margin</span><span class="token punctuation">:</span> <span class="token variable">@margin</span><span class="token punctuation">;</span>
  <span class="token property">padding</span><span class="token punctuation">:</span> <span class="token variable">@padding</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token selector">.class1</span> <span class="token punctuation">&#123;</span>
  <span class="token mixin-usage function">.mixin</span><span class="token punctuation">(</span><span class="token variable">@margin<span class="token punctuation">:</span></span> 20px<span class="token punctuation">;</span> <span class="token variable">@color<span class="token punctuation">:</span></span> #33acfe<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token selector">.class2</span> <span class="token punctuation">&#123;</span>
  <span class="token mixin-usage function">.mixin</span><span class="token punctuation">(</span>#efca44<span class="token punctuation">;</span> <span class="token variable">@padding<span class="token punctuation">:</span></span> 40px<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>@arguments参数，类似js中的函数arguments参数用法。</p>
<pre class="line-numbers language-less" data-language="less"><code class="language-less"><span class="token selector">.box-shadow(<span class="token variable">@x</span>: 0; <span class="token variable">@y</span>: 0; <span class="token variable">@blur</span>: 1px; <span class="token variable">@color</span>: #000)</span> <span class="token punctuation">&#123;</span>
  <span class="token property">-webkit-box-shadow</span><span class="token punctuation">:</span> <span class="token variable">@arguments</span><span class="token punctuation">;</span>
     <span class="token property">-moz-box-shadow</span><span class="token punctuation">:</span> <span class="token variable">@arguments</span><span class="token punctuation">;</span>
          <span class="token property">box-shadow</span><span class="token punctuation">:</span> <span class="token variable">@arguments</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token selector">.big-block</span> <span class="token punctuation">&#123;</span>
  <span class="token mixin-usage function">.box-shadow</span><span class="token punctuation">(</span>2px<span class="token punctuation">;</span> 5px<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>编译后：</p>
<pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token selector">.big-block</span> <span class="token punctuation">&#123;</span>
  <span class="token property">-webkit-box-shadow</span><span class="token punctuation">:</span> 2px 5px 1px #000<span class="token punctuation">;</span>
     <span class="token property">-moz-box-shadow</span><span class="token punctuation">:</span> 2px 5px 1px #000<span class="token punctuation">;</span>
          <span class="token property">box-shadow</span><span class="token punctuation">:</span> 2px 5px 1px #000<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h6 id="模式匹配"><a href="#模式匹配" class="headerlink" title="模式匹配"></a>模式匹配</h6><pre class="line-numbers language-less" data-language="less"><code class="language-less"><span class="token selector">.mixin(dark; <span class="token variable">@color</span>)</span> <span class="token punctuation">&#123;</span>
  <span class="token property">color</span><span class="token punctuation">:</span> <span class="token function">darken</span><span class="token punctuation">(</span><span class="token variable">@color</span><span class="token punctuation">,</span> 10%<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token selector">.mixin(light; <span class="token variable">@color</span>)</span> <span class="token punctuation">&#123;</span>
  <span class="token property">color</span><span class="token punctuation">:</span> <span class="token function">lighten</span><span class="token punctuation">(</span><span class="token variable">@color</span><span class="token punctuation">,</span> 10%<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token selector">.mixin(<span class="token variable">@_</span>; <span class="token variable">@color</span>)</span> <span class="token punctuation">&#123;</span>
  <span class="token property">display</span><span class="token punctuation">:</span> block<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// use</span>
<span class="token variable">@switch<span class="token punctuation">:</span></span> light<span class="token punctuation">;</span>

<span class="token selector">.class</span> <span class="token punctuation">&#123;</span>
  <span class="token mixin-usage function">.mixin</span><span class="token punctuation">(</span><span class="token variable">@switch</span><span class="token punctuation">;</span> #888<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>编译后:</p>
<pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token selector">.class</span> <span class="token punctuation">&#123;</span>
  <span class="token property">color</span><span class="token punctuation">:</span> #a2a2a2<span class="token punctuation">;</span>
  <span class="token property">display</span><span class="token punctuation">:</span> block<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<h6 id="namespaces-and-accessors"><a href="#namespaces-and-accessors" class="headerlink" title="namespaces and accessors"></a>namespaces and accessors</h6><p>如果在某个class中想使用某个Mixin中的样式或者修改</p>
<pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token comment">/* Mixin */</span>
<span class="token selector">#bundle()</span> <span class="token punctuation">&#123;</span>
  <span class="token selector">.button</span> <span class="token punctuation">&#123;</span>
    <span class="token property">display</span><span class="token punctuation">:</span> block<span class="token punctuation">;</span>
    <span class="token property">border</span><span class="token punctuation">:</span> 1px solid black<span class="token punctuation">;</span>
    <span class="token property">background-color</span><span class="token punctuation">:</span> grey<span class="token punctuation">;</span>
    <span class="token selector">&amp;:hover</span> <span class="token punctuation">&#123;</span>
      <span class="token property">background-color</span><span class="token punctuation">:</span> white<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>
  <span class="token selector">.tab</span> <span class="token punctuation">&#123;</span> ... <span class="token punctuation">&#125;</span>
  <span class="token selector">.citation</span> <span class="token punctuation">&#123;</span> ... <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">/* 使用Mixin中的部分样式 */</span>
<span class="token selector">#header a</span> <span class="token punctuation">&#123;</span>
  <span class="token property">color</span><span class="token punctuation">:</span> orange<span class="token punctuation">;</span>
  #bundle.<span class="token function">button</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  // can also be written as #bundle > .button
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="3-At-rule与冒泡"><a href="#3-At-rule与冒泡" class="headerlink" title="3.At-rule与冒泡"></a>3.At-rule与冒泡</h4><p>At-rule: CSS样式声明，以@开头， @charset(标识符)</p>
<h6 id="At-rule"><a href="#At-rule" class="headerlink" title="At-rule:"></a>At-rule:</h6><p>@charset – 定义被样式表使用的字符集，例如@charset “UTF-8”;</p>
<p>@import – 导入外部的CSS样式表，例如@import “./common.less”</p>
<p>@namespace – 命名空间，对于XML HTML(XHTML)元素可以用作CSS中的选择器，例如：</p>
<pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token comment">/* Namespace for XHTML */</span>
<span class="token atrule"><span class="token rule">@namespace</span> <span class="token url"><span class="token function">url</span><span class="token punctuation">(</span>http://www.w3.org/1999/xhtml<span class="token punctuation">)</span></span><span class="token punctuation">;</span></span>

<span class="token comment">/* Namespace for SVG embedded in XHTML */</span>
<span class="token atrule"><span class="token rule">@namespace</span> svg <span class="token url"><span class="token function">url</span><span class="token punctuation">(</span>http://www.w3.org/2000/svg<span class="token punctuation">)</span></span><span class="token punctuation">;</span></span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h6 id="嵌套At-rule："><a href="#嵌套At-rule：" class="headerlink" title="嵌套At-rule："></a>嵌套At-rule：</h6><p>@media – 条件组规则。如果设备符合标准定义的条件查询则使用该媒体， 常用</p>
<p>@font-face – 描述了一个将从外部下载的字体</p>
<p>@keyframes – 描述了中间步骤在CSS动画的序列</p>
<p>@page – 用于在打印文档时修改某些CSS属性</p>
<p>@supports – 条件组规则，如果浏览器满足给出的规则，则把它应用到内容中，特征查询。</p>
<p>@document – 条件组规则，如果被用到文档的CSS样式表满足了给定的标准，那么将被应用到所有的内容中。</p>
<p>常用例子：</p>
<pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token comment">/* iPhone in Portrait and Landscape */</span>
<span class="token atrule"><span class="token rule">@media</span> <span class="token keyword">only</span> screen 
  <span class="token keyword">and</span> <span class="token punctuation">(</span><span class="token property">min-device-width</span><span class="token punctuation">:</span> 320px<span class="token punctuation">)</span> 
  <span class="token keyword">and</span> <span class="token punctuation">(</span><span class="token property">max-device-width</span><span class="token punctuation">:</span> 480px<span class="token punctuation">)</span>
  <span class="token keyword">and</span> <span class="token punctuation">(</span><span class="token property">-webkit-min-device-pixel-ratio</span><span class="token punctuation">:</span> 2<span class="token punctuation">)</span></span> <span class="token punctuation">&#123;</span>
    <span class="token selector">.module</span> <span class="token punctuation">&#123;</span> <span class="token property">width</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token atrule"><span class="token rule">@font-face</span></span> <span class="token punctuation">&#123;</span>
  <span class="token property">font-family</span><span class="token punctuation">:</span> <span class="token string">'MyWebFont'</span><span class="token punctuation">;</span>
  <span class="token property">src</span><span class="token punctuation">:</span>  <span class="token url"><span class="token function">url</span><span class="token punctuation">(</span><span class="token string url">'myfont.woff2'</span><span class="token punctuation">)</span></span> <span class="token function">format</span><span class="token punctuation">(</span><span class="token string">'woff2'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token url"><span class="token function">url</span><span class="token punctuation">(</span><span class="token string url">'myfont.woff'</span><span class="token punctuation">)</span></span> <span class="token function">format</span><span class="token punctuation">(</span><span class="token string">'woff'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token atrule"><span class="token rule">@keyframes</span> pulse</span> <span class="token punctuation">&#123;</span>
  <span class="token selector">0%</span> <span class="token punctuation">&#123;</span>
    <span class="token property">background-color</span><span class="token punctuation">:</span> #001f3f<span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  <span class="token selector">100%</span> <span class="token punctuation">&#123;</span>
    <span class="token property">background-color</span><span class="token punctuation">:</span> #ff4136<span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">/* Check one supported condition */</span>
<span class="token atrule"><span class="token rule">@supports</span> <span class="token punctuation">(</span><span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">)</span></span> <span class="token punctuation">&#123;</span>
  <span class="token selector">.module</span> <span class="token punctuation">&#123;</span> <span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">/* Check multiple conditions */</span>
<span class="token atrule"><span class="token rule">@supports</span> <span class="token punctuation">(</span><span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">)</span> <span class="token keyword">and</span> <span class="token punctuation">(</span><span class="token property">-webkit-appearance</span><span class="token punctuation">:</span> checkbox<span class="token punctuation">)</span></span> <span class="token punctuation">&#123;</span>
  <span class="token selector">.module</span> <span class="token punctuation">&#123;</span> <span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h6 id="Less中使用At-rule"><a href="#Less中使用At-rule" class="headerlink" title="Less中使用At-rule"></a>Less中使用At-rule</h6><p>@media或@supports的规则可以与选择器相同的方式嵌套， 编译后At-rule会在外部，其他样式顺序不变。</p>
<pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token selector">.component</span> <span class="token punctuation">&#123;</span>
  <span class="token property">width</span><span class="token punctuation">:</span> 300px<span class="token punctuation">;</span>
  <span class="token atrule"><span class="token rule">@media</span> <span class="token punctuation">(</span><span class="token property">min-width</span><span class="token punctuation">:</span> 768px<span class="token punctuation">)</span></span> <span class="token punctuation">&#123;</span>
    <span class="token property">width</span><span class="token punctuation">:</span> 600px<span class="token punctuation">;</span>
    <span class="token atrule"><span class="token rule">@media</span>  <span class="token punctuation">(</span><span class="token property">min-resolution</span><span class="token punctuation">:</span> 192dpi<span class="token punctuation">)</span></span> <span class="token punctuation">&#123;</span>
      <span class="token property">background-image</span><span class="token punctuation">:</span> <span class="token url"><span class="token function">url</span><span class="token punctuation">(</span>/img/retina2x.png<span class="token punctuation">)</span></span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>
  <span class="token atrule"><span class="token rule">@media</span> <span class="token punctuation">(</span><span class="token property">min-width</span><span class="token punctuation">:</span> 1280px<span class="token punctuation">)</span></span> <span class="token punctuation">&#123;</span>
    <span class="token property">width</span><span class="token punctuation">:</span> 800px<span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>编译后，冒泡：</p>
<pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token selector">.component</span> <span class="token punctuation">&#123;</span>
  <span class="token property">width</span><span class="token punctuation">:</span> 300px<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token atrule"><span class="token rule">@media</span> <span class="token punctuation">(</span><span class="token property">min-width</span><span class="token punctuation">:</span> 768px<span class="token punctuation">)</span></span> <span class="token punctuation">&#123;</span>
  <span class="token selector">.component</span> <span class="token punctuation">&#123;</span>
    <span class="token property">width</span><span class="token punctuation">:</span> 600px<span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token atrule"><span class="token rule">@media</span> <span class="token punctuation">(</span><span class="token property">min-width</span><span class="token punctuation">:</span> 768px<span class="token punctuation">)</span> <span class="token keyword">and</span> <span class="token punctuation">(</span><span class="token property">min-resolution</span><span class="token punctuation">:</span> 192dpi<span class="token punctuation">)</span></span> <span class="token punctuation">&#123;</span>
  <span class="token selector">.component</span> <span class="token punctuation">&#123;</span>
    <span class="token property">background-image</span><span class="token punctuation">:</span> <span class="token url"><span class="token function">url</span><span class="token punctuation">(</span>/img/retina2x.png<span class="token punctuation">)</span></span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token atrule"><span class="token rule">@media</span> <span class="token punctuation">(</span><span class="token property">min-width</span><span class="token punctuation">:</span> 1280px<span class="token punctuation">)</span></span> <span class="token punctuation">&#123;</span>
  <span class="token selector">.component</span> <span class="token punctuation">&#123;</span>
    <span class="token property">width</span><span class="token punctuation">:</span> 800px<span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="4-运算"><a href="#4-运算" class="headerlink" title="4.运算"></a>4.运算</h4><p>运算后的结果单位以最左边有单位的数据为最终的运算结果单位</p>
<h6 id="calc"><a href="#calc" class="headerlink" title="calc()"></a>calc()</h6><p>calc()宾部队数学表达式进行计算，但是在嵌套函数中会计算变量和数学公式的值。</p>
<pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token atrule"><span class="token rule">@var</span><span class="token punctuation">:</span> 50vh/2<span class="token punctuation">;</span></span>
<span class="token property">width</span><span class="token punctuation">:</span> <span class="token function">calc</span><span class="token punctuation">(</span>50% + <span class="token punctuation">(</span><span class="token atrule"><span class="token rule">@var</span> - 20px<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>  // result is <span class="token function">calc</span><span class="token punctuation">(</span>50% + <span class="token punctuation">(</span>25vh - 20px<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<h4 id="5-转义"><a href="#5-转义" class="headerlink" title="5.转义"></a>5.转义</h4><p>转义允许使用任意字符串作为属性或变量值，使用方法像正常属性一样，除了插值</p>
<pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token atrule"><span class="token rule">@min768</span><span class="token punctuation">:</span> ~<span class="token string">"(min-width: 768px)"</span><span class="token punctuation">;</span></span>
<span class="token selector">.element</span> <span class="token punctuation">&#123;</span>
  <span class="token atrule"><span class="token rule">@media</span> @min768</span> <span class="token punctuation">&#123;</span>
    <span class="token property">font-size</span><span class="token punctuation">:</span> 1.2rem<span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>编译为：</p>
<pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token atrule"><span class="token rule">@media</span> <span class="token punctuation">(</span><span class="token property">min-width</span><span class="token punctuation">:</span> 768px<span class="token punctuation">)</span></span> <span class="token punctuation">&#123;</span>
  <span class="token selector">.element</span> <span class="token punctuation">&#123;</span>
    <span class="token property">font-size</span><span class="token punctuation">:</span> 1.2rem<span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>Less3.5后，</p>
<pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token atrule"><span class="token rule">@min768</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token property">min-width</span><span class="token punctuation">:</span> 768px<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="token selector">.element</span> <span class="token punctuation">&#123;</span>
  <span class="token atrule"><span class="token rule">@media</span> @min768</span> <span class="token punctuation">&#123;</span>
    <span class="token property">font-size</span><span class="token punctuation">:</span> 1.2rem<span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="6-函数"><a href="#6-函数" class="headerlink" title="6.函数"></a>6.<a href="https://lesscss.org/functions/#functions-overview">函数</a></h4><p>Less 内置了多种函数用于转换颜色、处理字符串、算术运算等。</p>
<p>可以使用 js 函数进行编写</p>
<h4 id="7-Maps-映射"><a href="#7-Maps-映射" class="headerlink" title="7.Maps 映射"></a>7.Maps 映射</h4><p>Less 3.5+</p>
<pre class="line-numbers language-less" data-language="less"><code class="language-less"><span class="token selector">#colors()</span> <span class="token punctuation">&#123;</span>
  <span class="token property">primary</span><span class="token punctuation">:</span> blue<span class="token punctuation">;</span>
  <span class="token property">secondary</span><span class="token punctuation">:</span> green<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token selector">.button</span> <span class="token punctuation">&#123;</span>
  <span class="token property">color</span><span class="token punctuation">:</span> #colors[primary]<span class="token punctuation">;</span>
  <span class="token property">border</span><span class="token punctuation">:</span> 1px solid #colors[secondary]<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>编译后：</p>
<pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token selector">.button</span> <span class="token punctuation">&#123;</span>
  <span class="token property">color</span><span class="token punctuation">:</span> blue<span class="token punctuation">;</span>
  <span class="token property">border</span><span class="token punctuation">:</span> 1px solid green<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="8-Scope-作用域"><a href="#8-Scope-作用域" class="headerlink" title="8.Scope(作用域)"></a>8.Scope(作用域)</h4><p>在子元素找不到可用的变量会在父级中查找继承。变量声明不用提前声明。</p>
<h4 id="9-注释"><a href="#9-注释" class="headerlink" title="9.注释"></a>9.注释</h4><pre class="line-numbers language-less" data-language="less"><code class="language-less"><span class="token comment">/* 一个块注释
 * style comment! */</span>
<span class="token variable">@var<span class="token punctuation">:</span></span> red<span class="token punctuation">;</span>

<span class="token comment">// 这一行被注释掉了！</span>
<span class="token variable">@var<span class="token punctuation">:</span></span> white<span class="token punctuation">;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="10-变量"><a href="#10-变量" class="headerlink" title="10.变量"></a>10.变量</h4><p>可以声明变量的如选择器名、属性名、urls、@import</p>
<pre class="line-numbers language-less" data-language="less"><code class="language-less"><span class="token comment">// Variables</span>
<span class="token variable">@link-color<span class="token punctuation">:</span></span>        #428bca<span class="token punctuation">;</span> <span class="token comment">// sea blue</span>
<span class="token variable">@link-color-hover<span class="token punctuation">:</span></span>  <span class="token function">darken</span><span class="token punctuation">(</span><span class="token variable">@link-color</span><span class="token punctuation">,</span> 10%<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Usage</span>
<span class="token selector">a,
.link</span> <span class="token punctuation">&#123;</span>
  <span class="token property">color</span><span class="token punctuation">:</span> <span class="token variable">@link-color</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token selector">a:hover</span> <span class="token punctuation">&#123;</span>
  <span class="token property">color</span><span class="token punctuation">:</span> <span class="token variable">@link-color-hover</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token selector">.widget</span> <span class="token punctuation">&#123;</span>
  <span class="token property">color</span><span class="token punctuation">:</span> #fff<span class="token punctuation">;</span>
  <span class="token property">background</span><span class="token punctuation">:</span> <span class="token variable">@link-color</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 选择器</span>
<span class="token comment">// Variables</span>
<span class="token variable">@my-selector<span class="token punctuation">:</span></span> banner<span class="token punctuation">;</span>

<span class="token comment">// Usage</span>
<span class="token selector">.@&#123;my-selector&#125;</span> <span class="token punctuation">&#123;</span>
  <span class="token property">font-weight</span><span class="token punctuation">:</span> bold<span class="token punctuation">;</span>
  <span class="token property">line-height</span><span class="token punctuation">:</span> 40px<span class="token punctuation">;</span>
  <span class="token property">margin</span><span class="token punctuation">:</span> 0 auto<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// urls</span>
<span class="token comment">// Variables</span>
<span class="token variable">@images<span class="token punctuation">:</span></span> <span class="token string">"../img"</span><span class="token punctuation">;</span>

<span class="token comment">// Usage</span>
<span class="token selector">body</span> <span class="token punctuation">&#123;</span>
  <span class="token property">color</span><span class="token punctuation">:</span> #444<span class="token punctuation">;</span>
  <span class="token property">background</span><span class="token punctuation">:</span> <span class="token url"><span class="token function">url</span><span class="token punctuation">(</span><span class="token string url">"@&#123;images&#125;/white-sand.png"</span><span class="token punctuation">)</span></span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// @import</span>
<span class="token comment">// Variables</span>
<span class="token variable">@themes<span class="token punctuation">:</span></span> <span class="token string">"../../src/themes"</span><span class="token punctuation">;</span>

<span class="token comment">// Usage</span>
<span class="token atrule">@import "@</span><span class="token punctuation">&#123;</span>themes<span class="token punctuation">&#125;</span><span class="token operator">/</span>tidal<span class="token operator">-</span>wave.less"<span class="token punctuation">;</span>

<span class="token comment">//properties</span>
<span class="token variable">@property<span class="token punctuation">:</span></span> color<span class="token punctuation">;</span>

<span class="token selector">.widget</span> <span class="token punctuation">&#123;</span>
  <span class="token property">@&#123;property&#125;</span><span class="token punctuation">:</span> #0ee<span class="token punctuation">;</span>
  <span class="token property">background-@&#123;property&#125;</span><span class="token punctuation">:</span> #999<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>重新声明变量</p>
<pre class="line-numbers language-less" data-language="less"><code class="language-less"><span class="token variable">@primary<span class="token punctuation">:</span></span>  green<span class="token punctuation">;</span>
<span class="token variable">@secondary<span class="token punctuation">:</span></span> blue<span class="token punctuation">;</span>

<span class="token selector">.section</span> <span class="token punctuation">&#123;</span>
  <span class="token variable">@color<span class="token punctuation">:</span></span> primary<span class="token punctuation">;</span>

  <span class="token selector">.element</span> <span class="token punctuation">&#123;</span>
    <span class="token property">color</span><span class="token punctuation">:</span> <span class="token variable">@@color</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>定义两次变量时，从当前作用域向上搜索，使用变量的最后一个定义。</p>
<h6 id="属性值作为变量"><a href="#属性值作为变量" class="headerlink" title="属性值作为变量"></a>属性值作为变量</h6><p>less 3.0.0+</p>
<pre class="line-numbers language-less" data-language="less"><code class="language-less"><span class="token selector">.widget</span> <span class="token punctuation">&#123;</span>
  <span class="token property">color</span><span class="token punctuation">:</span> #efefef<span class="token punctuation">;</span>
  <span class="token property">background-color</span><span class="token punctuation">:</span> $color<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>如果有两个相同的属性声明，最后使用的是最后属性使用的值</p>
<pre class="line-numbers language-less" data-language="less"><code class="language-less"><span class="token selector">.block</span> <span class="token punctuation">&#123;</span>
  <span class="token property">color</span><span class="token punctuation">:</span> red<span class="token punctuation">;</span> 
  <span class="token selector">.inner</span> <span class="token punctuation">&#123;</span>
    <span class="token property">background-color</span><span class="token punctuation">:</span> $color<span class="token punctuation">;</span> <span class="token comment">// blue</span>
  <span class="token punctuation">&#125;</span>
  <span class="token property">color</span><span class="token punctuation">:</span> blue<span class="token punctuation">;</span>  
<span class="token punctuation">&#125;</span> 
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="11-Exend-继承，扩展"><a href="#11-Exend-继承，扩展" class="headerlink" title="11.Exend(继承，扩展)"></a>11.Exend(继承，扩展)</h4><p>less的选择器伪类，扩展选择器，很强大的一个功能，待详细研究。</p>
<p>例如</p>
<pre class="line-numbers language-less" data-language="less"><code class="language-less"><span class="token selector">nav ul</span> <span class="token punctuation">&#123;</span>
  &amp;<span class="token punctuation">:</span><span class="token function">extend</span><span class="token punctuation">(</span>.inline<span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token comment">// 将选择器扩展到.inline类，无论.inline类出现在何处，声明块将保持原样</span>
  <span class="token property">background</span><span class="token punctuation">:</span> blue<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token selector">.inline</span> <span class="token punctuation">&#123;</span>
  <span class="token property">color</span><span class="token punctuation">:</span> red<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>编译后：</p>
<pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token selector">nav ul</span> <span class="token punctuation">&#123;</span>
  <span class="token property">background</span><span class="token punctuation">:</span> blue<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token selector">.inline,
nav ul</span> <span class="token punctuation">&#123;</span>
  <span class="token property">color</span><span class="token punctuation">:</span> red<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="12-合并"><a href="#12-合并" class="headerlink" title="12.合并"></a>12.合并</h4><p>可以将多个属性的值合并到单个属性下的都好或空格分隔列表中。对于背景、变换等属性很有用。</p>
<pre class="line-numbers language-less" data-language="less"><code class="language-less"><span class="token selector">.mixin()</span> <span class="token punctuation">&#123;</span>
  <span class="token property">box-shadow+</span><span class="token punctuation">:</span> inset 0 0 10px #555<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token selector">.myclass</span> <span class="token punctuation">&#123;</span>
  <span class="token mixin-usage function">.mixin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token property">box-shadow+</span><span class="token punctuation">:</span> 0 0 20px black<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>编译后：</p>
<pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token selector">.myclass</span> <span class="token punctuation">&#123;</span>
  <span class="token property">box-shadow</span><span class="token punctuation">:</span> inset 0 0 10px #555<span class="token punctuation">,</span> 0 0 20px black<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

]]></content>
      <categories>
        <category>前端</category>
        <category>基础</category>
      </categories>
      <tags>
        <tag>前端</tag>
        <tag>less</tag>
      </tags>
  </entry>
  <entry>
    <title>基础系列-preload与prefetch</title>
    <url>/posts/57007/</url>
    <content><![CDATA[<p>有时候为了提高网页初始加载的性能，我们会选择延迟一部分资源的加载和执行。</p>
<p>另一种情况是我们想要尽早加载资源，但是要等到合适的时机再执行。时机的影响因素包括依赖关系、执行条件、执行顺序等。</p>
<p>通常的做法是：</p>
<ul>
<li>通过插入一个页面元素来声明一个资源（比如img、script、link）。这种方式会将资源的<strong>加载和执行耦合</strong>。</li>
<li>用AJAX来加载资源。这种方式只有在时机成熟时才会加载资源，解决了执行时机问题。但是浏览器无法预解析，也就<strong>无法提前加载</strong>。另外如果页面有大量的阻塞脚本，就会造成<strong>延迟</strong>。</li>
</ul>
<h3 id="Resource-Hints"><a href="#Resource-Hints" class="headerlink" title="Resource Hints"></a>Resource Hints</h3><p>即预获取, 指的是页面后续会与另外一个节点或者资源建立连接, 让浏览器可以在合适的时间进行提前获取, 减少用户与后续节点的连接时间。</p>
<ul>
<li>preload</li>
<li>prefetch</li>
<li>preconnect</li>
</ul>
<p>W3C：<a href="https://w3c.github.io/resource-hints/">https://w3c.github.io/resource-hints/</a></p>
<p>深入阅读：<a href="https://www.keycdn.com/blog/resource-hints">https://www.keycdn.com/blog/resource-hints</a></p>
<h3 id="Preload"><a href="#Preload" class="headerlink" title="Preload"></a>Preload</h3><p>浏览器支持情况：<a href="https://caniuse.com/#feat=link-rel-preload">https://caniuse.com/#feat=link-rel-preload</a></p>
<p>即预加载，指的是页面资源加载的优先级，对最重要的资源最优先加载。专注于当前页面。</p>
<p>在 <code>html</code> 页面 head 中设置 link 标签的 <code>rel=&quot;preload&quot;</code> 属性告诉浏览器当前页面哪些资源需要优先提取。可以作用多种资源。</p>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token comment">&lt;!-- preload stylesheet resource via declarative markup --></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>preload<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/styles/base.css<span class="token punctuation">"</span></span> <span class="token attr-name">as</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>style<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>preload<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://fonts.example.com/font.woff2<span class="token punctuation">"</span></span> <span class="token attr-name">as</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>font<span class="token punctuation">"</span></span> <span class="token attr-name">crossorigin</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>font/woff2<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p><strong>as属性:</strong><br>该属性声明需要加载的资源类型, 以便浏览器可以正确处理该资源.<br><strong>crossorigin属性:</strong><br>对于开启CORS的资源, 需要添加crossorigin, 否则浏览器将无法正确加载此资源.</p>
</blockquote>
<p>当浏览器“看”到这样的声明后，就会以一定的优先级在后台加载资源。加载完的资源放在HTTP缓存中。而等到要真正执行时，再按照正常方式用标签或者代码加载，即可从HTTP缓存取出资源。</p>
<blockquote>
<p>通过网络发送到浏览器的每个字节并非都具有同等重要性，浏览器深谙此道。 浏览器采用启发式算法，尝试对首先要加载的最重要的资源作出最佳猜测，例如先加载 <code>CSS</code> 然后再加载脚本和图像。</p>
<p>即便如此，和任何启发式算法一样，这种方式并非总是有效；浏览器可能作出错误判断，原因通常在于当下获得的信息不足。 本文解释如何通过告知现代浏览器您稍后才需要的内容，充分影响浏览器中内容的优先级。</p>
<p><a href="https://web.dev/fast/#prioritize-resources">https://web.dev/fast/#prioritize-resources</a></p>
<p>浏览器预加载：浏览器预加载只预先加载在HTML中声明的资源。一旦html解析器到达资源，资源将被执行，对于何时执行资源没有灵活性。和 preload 指令不同。</p>
</blockquote>
<p><strong>特点</strong>：</p>
<ul>
<li>提前加载资源</li>
<li>资源的加载和执行分离</li>
<li>不延迟网页的load事件（除非Preload资源刚好是阻塞 window 加载的资源）</li>
</ul>
<p><strong>好处</strong>：</p>
<ul>
<li>允许浏览器来<strong>设定资源加载的优先级</strong>因此可以允许前端开发者来优化指定资源的加载。</li>
<li>赋予浏览器<strong>决定资源类型</strong>的能力，因此它能分辨这个资源在以后是否可以重复利用。</li>
<li>浏览器可以通过指定 <code>as</code> 属性来决定这个**请求是否符合 <a href="https://www.keycdn.com/support/content-security-policy/">content security policy</a>**。</li>
<li>浏览器可以基于资源的类型（比如 image/webp）来发送适当的 <code>accept</code> 头。</li>
</ul>
<p><strong>应用</strong>：</p>
<ul>
<li>在单页应用中，提前加载路由文件，提高切换路由时的渲染速度。现在大型的单页应用通常会异步加载路由文件。当用户切换路由时再异步加载相应的模块存在性能问题。可以用Preload提前加载，提升性能。</li>
<li>提前加载字体文件。由于字体文件必须等到CSSOM构建完成并且作用到页面元素了才会开始加载，会导致页面字体样式闪动（FOUT，Flash of Unstyled Text）。所以要用Preload显式告诉浏览器提前加载。假如字体文件在CSS生效之前下载完成，则可以完全消灭FOUT。</li>
</ul>
<p>参考链接：</p>
<p><a href="https://mp.weixin.qq.com/s?__biz=MzUxMTcwOTM4Mg==&mid=2247484163&idx=1&sn=16b9c907971683dd61cee251adcde79b&chksm=f96edaaace1953bcaf65a1adcf30b6d3dd66cf7b648ae59c4bf807d3f8bf460d5cd638e54ca1&token=946370022&lang=zh_CN#rd">有一种优化，叫Preload</a></p>
<p><a href="https://www.keycdn.com/support/preload-directive">preload-dirctive</a></p>
<h3 id="Prefetch"><a href="#Prefetch" class="headerlink" title="Prefetch"></a>Prefetch</h3><p>是一个低优先级的资源提示，允许<strong>浏览器在后台（空闲时）获取将来可能用得到的资源，并且将他们存储在浏览器的缓存中</strong>。一旦一个页面加载完毕就会开始下载其他的资源，然后当用户点击了一个带有 prefetched 的连接，它将可以立刻从缓存中加载内容。</p>
<p>prefetch 有三种类型：link prefetching、dns-prefetch、prerender。</p>
<p>深入阅读：<a href="https://www.keycdn.com/support/prefetching">https://www.keycdn.com/support/prefetching</a></p>
<h4 id="link-prefetching"><a href="#link-prefetching" class="headerlink" title="link prefetching"></a>link prefetching</h4><p>浏览器支持情况： <a href="https://caniuse.com/#feat=link-rel-prefetch">https://caniuse.com/#feat=link-rel-prefetch</a></p>
<p>对后续访问的资源进行提前加载, 需要指明资源类型.</p>
<pre class="line-numbers language-none"><code class="language-none">&lt;link rel&#x3D;&quot;prefetch&quot; href&#x3D;&quot;&#x2F;&#x2F;example.com&#x2F;next-page.html&quot; as&#x3D;&quot;document&quot; crossorigin&#x3D;&quot;use-credentials&quot;&gt;
&lt;link rel&#x3D;&quot;prefetch&quot; href&#x3D;&quot;&#x2F;library.js&quot; as&#x3D;&quot;script&quot;&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>



<h4 id="dns-prefetch"><a href="#dns-prefetch" class="headerlink" title="dns-prefetch"></a>dns-prefetch</h4><p>浏览器支持情况：<a href="https://caniuse.com/#feat=link-rel-dns-prefetch">https://caniuse.com/#feat=link-rel-dns-prefetch</a></p>
<p>对后续会访问的域名提前解析, 具体使用场景参考 <a href="https://github.com/Git-News/Git-News/issues/16">#16</a></p>
<pre class="line-numbers language-none"><code class="language-none">&lt;link rel&#x3D;&quot;dns-prefetch&quot; href&#x3D;&quot;&#x2F;&#x2F;example.com&quot;&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<blockquote>
<p>不过要注意的是 Chrome 已经在敲击地址栏的时候做了类似的事情，比如 <a href="https://docs.google.com/presentation/d/18zlAdKAxnc51y_kj-6sWLmnjl6TLnaru_WH0LJTjP-o/present?slide=id.g120f70e9a_041">DNS preresolve</a> 和 TCP preconnect，这些措施太酷了！你可以通过 <code>chrome://dns/</code> 来查看你的优化列表。</p>
</blockquote>
<h4 id="prerender"><a href="#prerender" class="headerlink" title="prerender"></a>prerender</h4><p>浏览器支持情况：<a href="https://caniuse.com/#feat=link-rel-prerender">https://caniuse.com/#feat=link-rel-prerender</a></p>
<p>优化了可能导航到的下一页上的资源的加载，在后台渲染了整个页面和资源。即标识后续的导航页面, 下载资源并执行, 即预读取页面, 常用于分页功能。</p>
<pre class="line-numbers language-none"><code class="language-none">&lt;link rel&#x3D;&quot;prerender&quot; href&#x3D;&quot;&#x2F;&#x2F;example.com&#x2F;next-page.html&quot;&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<blockquote>
<p>要小心的使用 prerender，因为它将会加载很多资源并且可能造成带宽的浪费，尤其是在移动设备上。还要注意的是，你无法在 Chrome DevTools 中进行测试，而是在 <code>chrome://net-internals/#prerender</code> 中看是否有页面被 prerendered 了，你也可以在 <a href="http://prerender-test.appspot.com/">prerender-test.appspot.com</a> 进行测试。</p>
</blockquote>
<p>额外的副作用：</p>
<ul>
<li>Web 统计将会收到影响而变大，尽管 Google 说已经限制了这个标签。看看这个关于页面分析将会被影响而在一次点击时产生两个 session 的 <a href="http://www.scl.com/insights/blog/google-chrome-prefetchprerender-inflating-web-analytics-stats/">文章</a>。</li>
<li>由于可能从未访问的站点下载了更多的页面（尤其是隐匿下载正在变得更加先进和多样化），用户的安全将面临更多的风险。</li>
<li>如果预取访问未经授权的内容，用户可能违反其网络或组织的可接受使用策略。</li>
</ul>
<h4 id="proload-与-prefetch-的区别"><a href="#proload-与-prefetch-的区别" class="headerlink" title="proload 与 prefetch 的区别"></a>proload 与 prefetch 的区别</h4><ul>
<li>Preload 作用在同一个请求页面的不同时段</li>
<li>Prefetch 作用与不同请求页面</li>
<li>Preload 是强制性指令, 浏览器必须按照这个指令进行执行.</li>
<li>Prefetch 是非强制性指令, 浏览器会决定是否运行此指令以及何时运行</li>
</ul>
<h3 id="preconnect"><a href="#preconnect" class="headerlink" title="preconnect"></a>preconnect</h3><p>浏览器支持情况：<a href="https://caniuse.com/#feat=link-rel-preconnect">https://caniuse.com/#feat=link-rel-preconnect</a></p>
<p>允许浏览器在一个 <strong>HTTP 请求正式发给服务器前预先执行一些操作</strong>，这包括 DNS 解析，TLS 协商，TCP 握手，这消除了往返延迟并为用户节省了时间。即对后续会访问的资源提前建立连接。</p>
<p>preconnect 可以直接添加到 HTML 中 link 标签的属性中，也可以写在 HTTP 头中或者通过 JavaScript 生成。</p>
<pre class="line-numbers language-none"><code class="language-none">&lt;link rel&#x3D;&quot;preconnect&quot; href&#x3D;&quot;&#x2F;&#x2F;example.com&quot;&gt;
&lt;link rel&#x3D;&quot;preconnect&quot; href&#x3D;&quot;&#x2F;&#x2F;cdn.example.com&quot; crossorigin&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<blockquote>
<p>按照标准, 客户端会执行 DNS+TCP for HTTP, DNS+TCP+TLS for HTTPS origins的链接请求.</p>
</blockquote>
<p>如下是为 Google Fonts 使用 preconnect 的例子，通过给 <code>fonts.gstatic.com</code> 加入 preconnect 提示，浏览器将立刻发起请求，和 CSS 请求并行执行。在这个场景下，<strong>preconnect 从关键路径中消除了三个 RTTs（Round-Trip Time）</strong> 并<strong>减少了超过半秒的延迟</strong>，lya Grigorik 的 <a href="https://www.igvita.com/2015/08/17/eliminating-roundtrips-with-preconnect/">eliminating RTTS with preconnect</a> 一文中有更详细的分析。</p>
<p><img src="/%E5%9F%BA%E7%A1%80%E7%B3%BB%E5%88%97-preload%E4%B8%8Eprefetch/preconnect.png" alt="preconnect"></p>
<p>使用 preconnect 是个有效而且克制的资源优化方法，它不仅可以优化页面并且可以防止资源利用的浪费。</p>
<p>深入了解：<a href="https://www.keycdn.com/support/preconnect">https://www.keycdn.com/support/preconnect</a></p>
<h3 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h3><p><a href="https://medium.com/reloading/preload-prefetch-and-priorities-in-chrome-776165961bbf">Preload, Prefetch And Priorities in Chrome</a></p>
<p><a href="https://github.com/fi3ework/blog/issues/32">资源提示 —— 什么是 Preload，Prefetch 和 Preconnect？</a></p>
<p><a href="https://github.com/Git-News/Git-News/issues/18">Web预加载-Preload &amp; Resource Hints</a></p>
<p>更多细节：<a href="https://github.com/happylindz/blog/issues/17">使用 Proload/Prefetch 优化你的应用</a></p>
<h4 id="附录："><a href="#附录：" class="headerlink" title="附录："></a>附录：</h4><p>W3C Preload:<br>草案: <a href="https://w3c.github.io/preload/">https://w3c.github.io/preload/</a><br>标准: <a href="https://www.w3.org/TR/preload/">https://www.w3.org/TR/preload/</a></p>
<p>W3C Resource Hints:<br>草案: <a href="https://w3c.github.io/resource-hints/">https://w3c.github.io/resource-hints/</a><br>标准: <a href="https://www.w3.org/TR/resource-hints/">https://www.w3.org/TR/resource-hints/</a></p>
]]></content>
      <categories>
        <category>前端</category>
        <category>基础</category>
      </categories>
      <tags>
        <tag>前端</tag>
        <tag>基础</tag>
        <tag>preload</tag>
        <tag>prefetch</tag>
      </tags>
  </entry>
  <entry>
    <title>基础系列-promise</title>
    <url>/posts/3968/</url>
    <content><![CDATA[<h4 id="Promise的目的"><a href="#Promise的目的" class="headerlink" title="Promise的目的"></a>Promise的目的</h4><p>人类大脑的习惯是线性的、阻塞的、单线程的语义。</p>
<p>回调表达异步流程的方式是非线性的、非顺序的，导致<strong>代码难以理解</strong>。</p>
<p>回调会收到<strong>控制反转</strong>的影响，因为回调暗中会把控制权交给第三方。如只有第三方写了执行回调，才能执行回调。</p>
<p>避免“<strong>回调地狱</strong>”，消除多层嵌套，<strong>避免竞态条件</strong>出现。</p>
<p>JavaScript异常变成异步行为，进而极大降低了竞态条件出现的可能。</p>
<p><strong>处理多个异步请求并发</strong>，需要同步处理多个异步请求结果。</p>
<h4 id="promise-作用"><a href="#promise-作用" class="headerlink" title="promise 作用"></a>promise 作用</h4><p><strong>Promise规范化了异步，并封装了时间相关值的状态，使得我们能够把他们以这种有用的方式链接到一起</strong>。</p>
<p>含义：</p>
<ol>
<li>promise对象用于异步计算</li>
<li>一种在异步任务中作为两个或更多步骤的流程控制机制，时序上的<code>this-then-that</code></li>
<li>包含两种状态，初始状态（pending）和已决议状态（fulfill和reject）</li>
<li>promise只有一个决议值（完成或拒绝），决议后的状态不会改变</li>
</ol>
<p>按照用途解释：</p>
<ol>
<li>主要用于异步计算，</li>
<li>可以将异步操作队列化，按照期望的顺序执行，返回符合预期的结果，</li>
<li>可以在对象之间传递和操作Promise，帮助我们处理队列。</li>
</ol>
<h4 id="promise-使用"><a href="#promise-使用" class="headerlink" title="promise 使用"></a>promise 使用</h4><p>初始化promise对象</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span>
	<span class="token comment">/* 执行器 executor */</span>
    <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// 异步操作</span>
        
        <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 数据处理完成</span>
        
        <span class="token function">reject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 数据处理出错</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token constant">A</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// 成功，resolve(),下一步</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token constant">B</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// 失败，reject(),作相应的处理</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>new Promise(function() {…})模式通常成为revealing constructor。<strong>传入的函数会立即执行</strong>（或同步的，不会像then(…)中的回调一样异步延迟），有两个参数是promise结果函数，resolve(…)通常标识完成，而reject(…)则标识拒绝。</p>
</blockquote>
<p>Promise是一个代理对象，它和原先要进行的操作并无关系。</p>
<p>通过引入一个回调，避免更多的回调。</p>
<p><strong>Promise的状态</strong>：</p>
<ol>
<li><p>pending: (待定)初始状态</p>
</li>
<li><p>fulfilled(resolve): (实现)操作成功</p>
</li>
<li><p>rejected: (被否决)操作失败</p>
</li>
</ol>
<p>Promise状态发生改变，就会触发<code>.then()</code>里的响应函数处理后续步骤。</p>
<p><strong>Promise状态一经改变就不会再发生改变</strong>，一直保持结果不变，可以按照需求多次查看。</p>
<p>由于Promise只能被决议一次，所以任何通过<code>then(...)</code>注册的（每个）回调就只会被调用一次。</p>
<p>执行步骤：new Promise(executer)声明实例 -&gt; executor执行器 -&gt; <code>.then()</code>下一步…</p>
<p>例如：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 示例1</span>
<span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token parameter">resolve</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'hello'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span> <span class="token parameter">value</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value <span class="token operator">+</span> <span class="token string">' world'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 输出 hello world</span>

<span class="token comment">// 示例2</span>
<span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span> <span class="token parameter">resolve</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'hello'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span> <span class="token parameter">value</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span> <span class="token parameter">resolve</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
            <span class="token function">setTimeout</span><span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
                <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'world'</span><span class="token punctuation">)</span>
            <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span> <span class="token parameter">value</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> value <span class="token operator">+</span> <span class="token string">' world'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token comment">// 输出：</span>
<span class="token comment">// hello</span>
<span class="token comment">// world world</span>

<span class="token comment">// 示例3</span>
<span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span> <span class="token parameter">resolve</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'hello'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span> <span class="token parameter">value</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'everyone'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token parameter">resolve</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
                <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
                    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'new promise'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'new peomise resolve'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span> <span class="token parameter">value</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> value <span class="token operator">+</span> <span class="token string">' world'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token comment">// 输出：</span>
<span class="token comment">// hello</span>
<span class="token comment">// everyone</span>
<span class="token comment">// false world</span>
<span class="token comment">// new promise</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>在promise中如果不直接返回新的promise对象，会顺序执行.then中的方法。</p>
<h4 id="then"><a href="#then" class="headerlink" title=".then()"></a>.then()</h4><p>(1) <code>.then()</code>受两个函数作为参数，分别代表<code>fulfilled</code>和<code>rejected</code></p>
<p>(2) <code>.then()</code>返回一个新的Promise实例，所以它可以链式调用</p>
<p>(3) 当前面的Promise状态改变时，<code>.then()</code>据其最终状态，选择特定的状态响应函数执行</p>
<p>(4) 状态响应函数可以返回新的Promise，或其它值</p>
<p>(5) 如果返回新的Promise，那么下一级<code>.then()</code>会在新Promise状态改变之后执行</p>
<p>(6) 如果返回其它任何值，则会立刻执行下一级<code>.then()</code></p>
<blockquote>
<p>注意：当<code>.then()</code>里有<code>.then()</code>的情况时，因为<code>.then()</code>返回的还是Promise实例，会等里面的<code>.then()</code>执行完，再执行外面的<code>.then()</code>。不推荐这种写法，最好是将里面的<code>.then()</code>和外面的<code>.then()</code>放在同一级链式写法，因为当返回Promise实例时，只有当promise执行完成后才会执行<code>.then()</code>.</p>
</blockquote>
<p>如果使用多个参数调用<code>resolve(...)</code>或者<code>reject(...)</code>，第一个参数之后的所有参数都会被默认忽略。如果要传递多个值，就必须要把值封装在单个值中传递，如数组或对象。默认传值参数为<code>undefined</code>。</p>
<h4 id="错误处理"><a href="#错误处理" class="headerlink" title="错误处理"></a>错误处理</h4><p>Promise会自动捕获内部异常，并交给rejected响应函数处理。</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span> <span class="token parameter">resolve</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span> <span class="token parameter">value</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> value <span class="token operator">+</span> <span class="token string">' world'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token parameter">value</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> <span class="token string">'Error: '</span><span class="token punctuation">,</span> error<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>调用<code>then()</code>时的完成处理函数或拒绝处理函数如果抛出异常，都会导致（链中的）下一个promise因这个异常而立即被拒绝。</p>
<p>如果未定义错误处理函数，默认错误处理函数只是把错误重新抛出，使得错误可以继续沿着Promise链传播下去，直到遇到显式定义的错误处理函数。</p>
<p>如果将then()的第一个参数（完成处理函数）省略或传入任何非函数值，默认的处理完成函数会把接受到的任何传入值传递给下一个promise。</p>
<p>上面代码可以改写为</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span> <span class="token parameter">resolve</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span> <span class="token parameter">value</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> value <span class="token operator">+</span> <span class="token string">' world'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 不会执行</span>
	<span class="token punctuation">&#125;</span><span class="token punctuation">)</span> <span class="token comment">// 这里使用的是默认错误处理函数</span>
    <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span> <span class="token parameter">error</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> <span class="token string">'Error: '</span><span class="token punctuation">,</span> error<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 抛出异常</span>
	<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>捕获回调之后的异常信息，<code>.then()</code>不会执行，<code>.catch()</code>抛出异常。</p>
<h5 id="catch-与-then-的区别"><a href="#catch-与-then-的区别" class="headerlink" title=".catch()与.then()的区别"></a>.catch()与.then()的区别</h5><p><code>.catch(...)</code>只接受一个拒绝回调作为参数，并自动替换默认完成回调。等价于<code>then(null, ...)</code>。</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token function">somePromise</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'oh noes'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token comment">// I caught your error! :)</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">somePromise</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'oh noes'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token comment">// I didn't catch your error! :(</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>当使用<code>.then(resolveHandler, rejectHandler)</code>这种形式时，<code>rejectHandler</code>并不会捕获由<code>resolveHandler</code>引发的异常。</p>
<h5 id="catch-后继续使用-then-及-catch-的情况："><a href="#catch-后继续使用-then-及-catch-的情况：" class="headerlink" title=".catch()后继续使用.then()及.catch()的情况："></a>.catch()后继续使用.then()及.catch()的情况：</h5><p><code>.catch()</code>返回的是一个promise实例，如果<code>.catch()</code>中没有异常抛出，会正常执行后续的<code>.then()</code>，如果抛出异常会被后面的<code>.catch()</code>接收到进行异常处理。</p>
<p>注意：在所有的队列最后都加上<code>.catch()</code>，以避免漏掉错误处理造成意想不到的问题。</p>
<blockquote>
<p>catch(…)会返回一个promise。任何Promise链的最后异步，不管是什么，总是存在着在未被查看的Promise中出现未捕获错误的可能性。</p>
<p>浏览器的垃圾回收机制可以进行处理最后的promise。</p>
</blockquote>
<h4 id="链式流"><a href="#链式流" class="headerlink" title="链式流"></a>链式流</h4><p>Promise固有行为特性：</p>
<ul>
<li>每次对Promise调用then(…)，它都会创建并返回一个新的Promise</li>
<li>不管从then(…)调用的完成回调返回值是什么，它都会被自动设置为被链接Promise（第一点中的）的完成</li>
</ul>
<p><code>Promise.resolve(...)</code>会直接返回接收到的真正<code>Promise</code>，或展开接收到的<code>thenable</code>值，并在持续展开<code>thenable</code>的同时递归地前进。</p>
<p>从完成（或拒绝）处理函数返回<code>thenable</code>或者<code>Promise</code>的时候也会发生同样的展开。</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> p <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">21</span><span class="token punctuation">)</span>

p<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">v</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span>
    
    <span class="token comment">// 创建一个promise并将其返回</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span>v <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">v</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>

<span class="token comment">// 21</span>
<span class="token comment">// 42</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>任何Promise链的最后一步，不管是什么，总是存在着在未被查看的Promise中出现未捕获错误的可能性。浏览器可以追踪Promise对象。如果在它被垃圾回收的时候其中有拒绝，浏览器就能够确保这是一个真正的未捕获错误，进而可以确定应该将其报告到开发终端。</p>
<h4 id="Promise-常用函数"><a href="#Promise-常用函数" class="headerlink" title="Promise 常用函数"></a>Promise 常用函数</h4><h5 id="1-Promise-resolve-返回一个以个定制解析后的Promise对象"><a href="#1-Promise-resolve-返回一个以个定制解析后的Promise对象" class="headerlink" title="1.Promise.resolve()  返回一个以个定制解析后的Promise对象"></a>1.Promise.resolve()  返回一个以个定制解析后的Promise对象</h5><p>如果这个值是thenable（带有<code>.then()</code>方法），返回的Promise会“跟随”这个thenable对象，采用他的最终状态（指resolved/rejected/pending），会立刻执行<code>.then()</code>函数；如果传入的value本身就是promise对象，则该对象作为Promise.resolve方法的返回值返回；否则以改为成功状态。<br>返回promise对象，如果返回值是promise对象，则不做任何改变。</p>
<p>如果向<code>Promise.resolve(...)</code>传递一个非Promise、非thenable的立即值（如常量），就会得到一个用这个值填充的promise。</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// p1和p2完全一样</span>
<span class="token keyword">var</span> p1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> p2 <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">)</span>
p1 <span class="token operator">===</span> p2 <span class="token comment">// true</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>如果向<code>Promise.resolve(...)</code>传递一个真正的Promise，就只会返回同一个promise。</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> p1 <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> p2 <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>p1<span class="token punctuation">)</span>
p1 <span class="token operator">===</span> p2 <span class="token comment">// true</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p><code>Promise.resolve(...)</code>可以接受收任何thenable，<code>then(...)</code>操作会按照promise进行响应。</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 非promise的thenable</span>
<span class="token keyword">var</span> p <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
	<span class="token function-variable function">then</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">cb<span class="token punctuation">,</span>errcb</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
		<span class="token function">cb</span><span class="token punctuation">(</span> <span class="token number">42</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">errcb</span><span class="token punctuation">(</span> <span class="token string">"evil laugh"</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

p
<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>
	<span class="token keyword">function</span> <span class="token function">fulfilled</span><span class="token punctuation">(</span><span class="token parameter">val</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> val <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 42</span>
	<span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
	<span class="token keyword">function</span> <span class="token function">rejected</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
		<span class="token comment">// 这里本不该运行</span>
		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> err <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// evil laugh</span>
	<span class="token punctuation">&#125;</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 使用promise</span>
Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span> p <span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>
	<span class="token keyword">function</span> <span class="token function">fulfilled</span><span class="token punctuation">(</span><span class="token parameter">val</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> val <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 42</span>
	<span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
	<span class="token keyword">function</span> <span class="token function">rejected</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
		<span class="token comment">// 永远不会跑到这里</span>
	<span class="token punctuation">&#125;</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>如果不确定调用的函数是thenable，可以使用Promise.resolve进行包裹</strong>。</p>
<h5 id="2-Promise-reject-返回失败状态的Promise对象"><a href="#2-Promise-reject-返回失败状态的Promise对象" class="headerlink" title="2.Promise.reject() 返回失败状态的Promise对象"></a>2.Promise.reject() 返回失败状态的Promise对象</h5><p>返回一个状态为失败的Promise对象，并将给定的失败信息传递给对应的处理方法</p>
<h5 id="3-Promise-all-…-批量执行，所有完成才完成，有一个失败就立即结束"><a href="#3-Promise-all-…-批量执行，所有完成才完成，有一个失败就立即结束" class="headerlink" title="3.Promise.all([…])  批量执行，所有完成才完成，有一个失败就立即结束"></a>3.Promise.all([…])  批量执行，所有完成才完成，有一个失败就立即结束</h5><p>Promise.all([p1, p2, p3, …])用于将多个Promise实例包装成一个新的Pomise实例，即返回普通的Promise实例。</p>
<p>接受一个数组作为参数。</p>
<p>数组里可以是Promise对象，也可以是别的值，只有Promise会等待状态改变。</p>
<p>当所有的子Promise都完成，该Promise完成，返回值是全部Promise对象的返回值的数组。</p>
<p>有任何一个失败，该Promise立即失败，返回值是失败的子Promise的结果。</p>
<p>Promise.all获得的成功的结果中数组元素的顺序和Promise.all接收到的数组顺序是一致的（与完成顺序无关）。</p>
<blockquote>
<p>如果传入空数组会立即完成。</p>
</blockquote>
<h6 id="常见用法："><a href="#常见用法：" class="headerlink" title="常见用法："></a>常见用法：</h6><p>和<code>.map()</code>一起使用</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">findLargest</span><span class="token punctuation">(</span><span class="token parameter">dir</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> FileSystem<span class="token punctuation">.</span><span class="token function">readDir</span><span class="token punctuation">(</span>dir<span class="token punctuation">,</span> <span class="token string">'utf-8'</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span> <span class="token parameter">files</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span> <span class="token comment">// 读取所有的文件</span>
        <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span> files<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span> <span class="token parameter">file</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span> <span class="token comment">// 把数组files中所有的元素都构建为一个Promise实例</span>
            fs<span class="token punctuation">.</span><span class="token function">stat</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>dir<span class="token punctuation">,</span> file<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> stat</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span> <span class="token comment">// 读取文件</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">throw</span> err<span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>stat<span class="token punctuation">.</span><span class="token function">isDirectory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    <span class="token keyword">return</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
                        <span class="token literal-property property">size</span><span class="token operator">:</span> <span class="token number">0</span>
                    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span>
                stat<span class="token punctuation">.</span>file <span class="token operator">=</span> file<span class="token punctuation">;</span>
                <span class="token function">resolve</span><span class="token punctuation">(</span>stat<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 文件状态</span>
            <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 读取所有文件之后返回一个Promise对象，并包含所有文件读取结果</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h6 id="其他方式实现promise-all"><a href="#其他方式实现promise-all" class="headerlink" title="其他方式实现promise.all:"></a>其他方式实现promise.all:</h6><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">promiseAll</span><span class="token punctuation">(</span><span class="token parameter">values</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// 判断输入参数的合法性</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>values<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">const</span> type <span class="token operator">=</span> <span class="token keyword">typeof</span> values<span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">TypeError</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">TypeError: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>type<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>values<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string"> is not iterable</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
    <span class="token comment">// 返回一个包含数组结果的promise</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">const</span> resultArr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 结果数组</span>
        <span class="token keyword">let</span> orderIndex <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// 记录返回结果是否全部结束</span>
        <span class="token comment">// 遍历数组</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> values<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">let</span> value <span class="token operator">=</span> values<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
   			<span class="token comment">// value如果是thenable，Promise.resolve包裹后.then的值是promise执行后的值或响应thenable的then函数，如果不是thenable则是原值</span>
            <span class="token comment">// 使用Promise.resolve确保是一个promise</span>
            Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
                <span class="token comment">// 将运行结果放到数组里的回调 </span>
                resultArr<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> value<span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">++</span>orderIndex <span class="token operator">===</span> values<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">// 判断是否所有的promise都返回了结果</span>
                    <span class="token function">resolve</span><span class="token punctuation">(</span>resultArr<span class="token punctuation">)</span>
                <span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> reject<span class="token punctuation">)</span> <span class="token comment">// 如果失败就直接返回失败，不处理返回成功的结果</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// ==========================================================================</span>
<span class="token comment">// 测试</span>
<span class="token keyword">function</span> <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token parameter">delay <span class="token operator">=</span> <span class="token number">0</span></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
          <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">sleep: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>delay<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> delay<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">function</span> <span class="token function">sleepReject</span><span class="token punctuation">(</span><span class="token parameter">delay <span class="token operator">=</span> <span class="token number">0</span></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
            <span class="token function">reject</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">sleepReject: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>delay<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> delay<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token function">promiseAll</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token function">sleepReject</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">data</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'resolve'</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token parameter">err</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'reject'</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span> <span class="token comment">// reject sleepReject: 100</span>

<span class="token function">promiseAll</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">data</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'resolve'</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token parameter">err</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'reject'</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span> <span class="token comment">// resolve [ 1, 'sleep: 100', 2, 3, 'sleep: 50' ]</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h5 id="4-Promise-race-…-，类似Promise-all有任意一个完成就算完成。"><a href="#4-Promise-race-…-，类似Promise-all有任意一个完成就算完成。" class="headerlink" title="4.Promise.race([…])，类似Promise.all有任意一个完成就算完成。"></a>4.Promise.race([…])，类似Promise.all有任意一个完成就算完成。</h5><p>不需要等待所有的promise完成，任意一个promise完成或失败，就是最后的结果。</p>
<blockquote>
<p>如果传入空数组，会挂住，永远不会改变为完成状态。</p>
</blockquote>
<h6 id="常见用法：-1"><a href="#常见用法：-1" class="headerlink" title="常见用法："></a>常见用法：</h6><p>把异步操作和定时器放在一起，如果定时器先触发，就认为超时，告知用户。</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 一个使Promise超时的工具</span>
<span class="token keyword">function</span> <span class="token function">timeoutPromise</span><span class="token punctuation">(</span><span class="token parameter">delay</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
		<span class="token function">setTimeout</span><span class="token punctuation">(</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
			<span class="token function">reject</span><span class="token punctuation">(</span> <span class="token string">"Timeout!"</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">&#125;</span><span class="token punctuation">,</span> delay <span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 为`foo()`设置一个超时</span>
Promise<span class="token punctuation">.</span><span class="token function">race</span><span class="token punctuation">(</span> <span class="token punctuation">[</span>
	<span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>					<span class="token comment">// 尝试调用`foo()`</span>
	<span class="token function">timeoutPromise</span><span class="token punctuation">(</span> <span class="token number">3000</span> <span class="token punctuation">)</span>	<span class="token comment">// 给它3秒钟</span>
<span class="token punctuation">]</span> <span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>
	<span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
		<span class="token comment">// `foo(..)`及时地完成了！</span>
	<span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
	<span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
		<span class="token comment">// `foo()`不是被拒绝了，就是它没有及时完成</span>
		<span class="token comment">// 那么可以考察`err`来知道是哪种情况</span>
	<span class="token punctuation">&#125;</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h5 id="5-Promise-none-…-所有promise都被拒绝"><a href="#5-Promise-none-…-所有promise都被拒绝" class="headerlink" title="5.Promise.none([…]) 所有promise都被拒绝"></a>5.Promise.none([…]) 所有promise都被拒绝</h5><p>类似于Promise.all([…])。所有的promise都要被拒绝，即拒绝转化未完成值。</p>
<h5 id="6-Promise-any-…-只需要完成一个"><a href="#6-Promise-any-…-只需要完成一个" class="headerlink" title="6.Promise.any([…]) 只需要完成一个"></a>6.Promise.any([…]) 只需要完成一个</h5><p>接收一个Promise对象的集合，当其中的一个 promise 成功，就返回那个成功的promise的值。</p>
<h5 id="7-Promise-allSettled-…-返回所有的promise结果"><a href="#7-Promise-allSettled-…-返回所有的promise结果" class="headerlink" title="7.Promise.allSettled([…])  返回所有的promise结果"></a>7.Promise.allSettled([…])  返回所有的promise结果</h5><p>该<code>Promise.allSettled()</code>方法返回一个在所有给定的promise都已经<code>fulfilled</code>或<code>rejected</code>后的promise，并带有一个对象数组，每个对象表示对应的promise结果。</p>
<p>使用<code>Promise.allSettled()</code>方法可以批量处理promise的拒绝情况。</p>
<p>注意兼容，使用<code>promise.all</code>改写：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token parameter">delay <span class="token operator">=</span> <span class="token number">0</span></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
          <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">sleep: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>delay<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> delay<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">function</span> <span class="token function">sleepReject</span><span class="token punctuation">(</span><span class="token parameter">delay <span class="token operator">=</span> <span class="token number">0</span></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
            <span class="token function">reject</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">sleepReject: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>delay<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> delay<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 添加错误处理，catch返回默认的promise（默认的promise返回结果为undefined）</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// promise.all中，出错的promise如果有错误处理函数则是错误处理函数处理过的promise</span>
Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token function">sleepReject</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">data</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'resolve'</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token parameter">err</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'reject'</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token comment">// resolve [ 1, undefined, 2, 3, 'sleep: 50' ]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h4 id="Promise常见用法"><a href="#Promise常见用法" class="headerlink" title="Promise常见用法"></a>Promise常见用法</h4><p>1.把回调包装成Promise，好处：可读性更好，返回的结果可以加入任何Promise队列。</p>
<p>2.把任何异步操作包装成Promise。</p>
<p>注意：JQuery3.0+版本已经实现完整的Promise对象</p>
<p>兼容IE，只想实现异步队列，Jquery.defered；兼容所有的平台，Bluebird类库或Promise polyfill兼容库。</p>
<p>3.多个api请求，链式调用，在第一个api调用结束之后.then()返回值中return新的promise对象调用第二个接口，在接下来的.then()函数中处理第二个api调用结果。</p>
<h4 id="thenable"><a href="#thenable" class="headerlink" title="thenable"></a>thenable</h4><p>识别Promise（或者行为类似于Promise的东西）就是定义某种成为thenable的东西，将其定义为任何具有<code>then(...)</code>方法的对象和函数。任何这样的值就是Promise一致的thenable。</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 鸭子类型判断thenable</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>
	p <span class="token operator">!==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span>
    <span class="token punctuation">(</span>
    	<span class="token keyword">typeof</span> p <span class="token operator">===</span> <span class="token string">'object'</span> <span class="token operator">||</span>
        <span class="token keyword">typeof</span> p <span class="token operator">===</span> <span class="token string">'function'</span>
    <span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> 
    <span class="token keyword">typeof</span> p<span class="token punctuation">.</span>then <span class="token operator">===</span> <span class="token string">'function'</span>
<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// 假定这是thenable</span>
<span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// 不是thenable</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h4 id="Promise局限性"><a href="#Promise局限性" class="headerlink" title="Promise局限性"></a>Promise局限性</h4><ol>
<li><p><strong>顺序错误处理</strong></p>
<p>Promise链中的错误很容易被无意中默默忽略掉。如果构建了一个没有错误处理函数的Promise链，链中任何地方的任何错误都会在链中一直传播下去，直到被查看。</p>
</li>
<li><p><strong>单一值</strong></p>
<p>Promise只能有一个完成值或一个拒绝理由。需要将多个传参用对象或数组包裹住。</p>
</li>
<li><p><strong>单决议</strong></p>
</li>
<li><p><strong>惯性</strong></p>
<p>用promise封装和兼容已有的代码。</p>
</li>
<li><p><strong>无法取消的Promise</strong></p>
<p>一旦创建了一个Promise并为其注册了完成和/或拒绝处理函数，如果出现某种情况使得这个任务悬而未决的话，你也没有办法从外部停止它的进程。（async/await出现的契机）</p>
</li>
<li><p><strong>Promise性能</strong></p>
<p>Promise使所有一切都成为异步的了，即有一些立即（同步）完成的步骤仍然会延迟到任务的下一步。意味着一个Promise任务序列可能比完全通过回调链接的同样的任务序列运行的稍慢一些。</p>
<p>Promise会有一些性能损耗，但是可以规避回调地狱。</p>
</li>
</ol>
<h4 id="实现一个满足PromiseA-规范的Promise"><a href="#实现一个满足PromiseA-规范的Promise" class="headerlink" title="实现一个满足PromiseA+规范的Promise"></a>实现一个满足PromiseA+规范的Promise</h4><p>参考链接：Promise A+ <a href="https://promisesaplus.com/">https://promisesaplus.com/</a></p>
<p>手写Promise实现符合promise A+规范的方法</p>
<blockquote>
<ol>
<li>then 的参数 <code>onFulfilled</code> 和 <code>onRejected</code> 可以缺省，如果 <code>onFulfilled</code> 或者 <code>onRejected</code>不是函数，将其忽略，且依旧可以在下面的 then 中获取到之前返回的值；「规范 Promise/A+ 2.2.1、2.2.1.1、2.2.1.2」</li>
<li>promise 可以 then 多次，每次执行完 promise.then 方法后返回的都是一个“新的promise”；「规范 Promise/A+ 2.2.7」</li>
<li>如果 then 的返回值 x 是一个普通值，那么就会把这个结果作为参数，传递给下一个 then 的成功的回调中；</li>
<li>如果 then 中抛出了异常，那么就会把这个异常作为参数，传递给下一个 then 的失败的回调中；「规范 Promise/A+ 2.2.7.2」</li>
<li>如果 then 的返回值 x 是一个 promise，那么会等这个 promise 执行完，promise 如果成功，就走下一个 then 的成功；如果失败，就走下一个 then 的失败；如果抛出异常，就走下一个 then 的失败；「规范 Promise/A+ 2.2.7.3、2.2.7.4」</li>
<li>如果 then 的返回值 x 和 promise 是同一个引用对象，造成循环引用，则抛出异常，把异常传递给下一个 then 的失败的回调中；「规范 Promise/A+ 2.3.1」</li>
<li>如果 then 的返回值 x 是一个 promise，且 x 同时调用 resolve 函数和 reject 函数，则第一次调用优先，其他所有调用被忽略；「规范 Promise/A+ 2.3.3.3.3」</li>
</ol>
</blockquote>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> <span class="token constant">PENDING</span> <span class="token operator">=</span> <span class="token string">'PENDING'</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token constant">FULFILLED</span> <span class="token operator">=</span> <span class="token string">'FULFILLED'</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token constant">REJECTED</span> <span class="token operator">=</span> <span class="token string">'REJECTED'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">resolvePromise</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">promise2<span class="token punctuation">,</span> x<span class="token punctuation">,</span> resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// 自己等待自己完成是错误的实现，用一个类型错误，结束掉 promise  Promise/A+ 2.3.1</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>promise2 <span class="token operator">===</span> x<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> 
        <span class="token keyword">return</span> <span class="token function">reject</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">TypeError</span><span class="token punctuation">(</span><span class="token string">'Chaining cycle detected for promise #&lt;Promise>'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
    <span class="token comment">// Promise/A+ 2.3.3.3.3 只能调用一次</span>
    <span class="token keyword">let</span> called<span class="token punctuation">;</span>
    <span class="token comment">// 后续的条件要严格判断 保证代码能和别的库一起使用</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> x <span class="token operator">===</span> <span class="token string">'object'</span> <span class="token operator">&amp;&amp;</span> x <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token keyword">typeof</span> x <span class="token operator">===</span> <span class="token string">'function'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> 
        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
            <span class="token comment">// 为了判断 resolve 过的就不用再 reject 了（比如 reject 和 resolve 同时调用的时候）  Promise/A+ 2.3.3.1</span>
            <span class="token keyword">let</span> then <span class="token operator">=</span> x<span class="token punctuation">.</span>then<span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> then <span class="token operator">===</span> <span class="token string">'function'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> 
                <span class="token comment">// 不要写成 x.then，直接 then.call 就可以了 因为 x.then 会再次取值，Object.defineProperty  Promise/A+ 2.3.3.3</span>
                <span class="token function">then</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token parameter">y</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span> <span class="token comment">// 根据 promise 的状态决定是成功还是失败</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>called<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
                    called <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
                    <span class="token comment">// 递归解析的过程（因为可能 promise 中还有 promise） Promise/A+ 2.3.3.3.1</span>
                    <span class="token function">resolvePromise</span><span class="token punctuation">(</span>promise2<span class="token punctuation">,</span> y<span class="token punctuation">,</span> resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span><span class="token punctuation">;</span> 
                <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token parameter">r</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
                    <span class="token comment">// 只要失败就失败 Promise/A+ 2.3.3.3.2</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>called<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
                    called <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
                    <span class="token function">reject</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
                <span class="token comment">// 如果 x.then 是个普通值就直接返回 resolve 作为结果  Promise/A+ 2.3.3.4</span>
                <span class="token function">resolve</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token comment">// Promise/A+ 2.3.3.2</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>called<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
            called <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            <span class="token function">reject</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// 如果 x 是个普通值就直接返回 resolve 作为结果  Promise/A+ 2.3.4  </span>
        <span class="token function">resolve</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">class</span> <span class="token class-name">Promise</span> <span class="token punctuation">&#123;</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">executor</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token constant">PENDING</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>reason <span class="token operator">=</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>onResolvedCallbacks <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>onRejectedCallbacks<span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

        <span class="token keyword">let</span> <span class="token function-variable function">resolve</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span>  <span class="token constant">PENDING</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token constant">FULFILLED</span><span class="token punctuation">;</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> value<span class="token punctuation">;</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>onResolvedCallbacks<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token operator">=></span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span> 

        <span class="token keyword">let</span> <span class="token function-variable function">reject</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">reason</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span>  <span class="token constant">PENDING</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token constant">REJECTED</span><span class="token punctuation">;</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>reason <span class="token operator">=</span> reason<span class="token punctuation">;</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>onRejectedCallbacks<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token operator">=></span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>

        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
            <span class="token function">executor</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span>reject<span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">onFulfilled<span class="token punctuation">,</span> onRejected</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">//解决 onFufilled，onRejected 没有传值的问题</span>
        <span class="token comment">//Promise/A+ 2.2.1 / Promise/A+ 2.2.5 / Promise/A+ 2.2.7.3 / Promise/A+ 2.2.7.4</span>
        <span class="token comment">// 箭头函数返回一个匿名函数，默认onFulfilled函数为接收传参并返回传参，默认onRejected函数为抛出错误</span>
        onFulfilled <span class="token operator">=</span> <span class="token keyword">typeof</span> onFulfilled <span class="token operator">===</span> <span class="token string">'function'</span> <span class="token operator">?</span> <span class="token function-variable function">onFulfilled</span> <span class="token operator">:</span> <span class="token parameter">v</span> <span class="token operator">=></span> v<span class="token punctuation">;</span>
        <span class="token comment">//因为错误的值要让后面访问到，所以这里也要抛出个错误，不然会在之后 then 的 resolve 中捕获</span>
        onRejected <span class="token operator">=</span> <span class="token keyword">typeof</span> onRejected <span class="token operator">===</span> <span class="token string">'function'</span> <span class="token operator">?</span> <span class="token function-variable function">onRejected</span> <span class="token operator">:</span> <span class="token parameter">err</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span> <span class="token keyword">throw</span> err <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
        <span class="token comment">// 每次调用 then 都返回一个新的 promise  Promise/A+ 2.2.7</span>
        <span class="token keyword">let</span> promise2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token constant">FULFILLED</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token comment">//Promise/A+ 2.2.2</span>
                <span class="token comment">//Promise/A+ 2.2.4 --- setTimeout</span>
                <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
                    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
                        <span class="token comment">//Promise/A+ 2.2.7.1</span>
                        <span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token function">onFulfilled</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token comment">// x可能是一个proimise</span>
                        <span class="token function">resolvePromise</span><span class="token punctuation">(</span>promise2<span class="token punctuation">,</span> x<span class="token punctuation">,</span> resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                        <span class="token comment">//Promise/A+ 2.2.7.2</span>
                        <span class="token function">reject</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
                    <span class="token punctuation">&#125;</span>
                <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>

            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token constant">REJECTED</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token comment">//Promise/A+ 2.2.3</span>
                <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
                    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
                        <span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token function">onRejected</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>reason<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token function">resolvePromise</span><span class="token punctuation">(</span>promise2<span class="token punctuation">,</span> x<span class="token punctuation">,</span> resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                        <span class="token function">reject</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
                    <span class="token punctuation">&#125;</span>
                <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>

            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token constant">PENDING</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>onResolvedCallbacks<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
                    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
                        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
                            <span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token function">onFulfilled</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token function">resolvePromise</span><span class="token punctuation">(</span>promise2<span class="token punctuation">,</span> x<span class="token punctuation">,</span> resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                            <span class="token function">reject</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
                        <span class="token punctuation">&#125;</span>
                    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token keyword">this</span><span class="token punctuation">.</span>onRejectedCallbacks<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=></span> <span class="token punctuation">&#123;</span>
                    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
                        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
                            <span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token function">onRejected</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>reason<span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token function">resolvePromise</span><span class="token punctuation">(</span>promise2<span class="token punctuation">,</span> x<span class="token punctuation">,</span> resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span>
                        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                            <span class="token function">reject</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
                        <span class="token punctuation">&#125;</span>
                    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> promise2<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// ======================================================================</span>
<span class="token comment">// 测试</span>
<span class="token keyword">const</span> promise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">'失败'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token operator">=></span><span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token parameter">err</span><span class="token operator">=></span><span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'err'</span><span class="token punctuation">,</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>





<h4 id="练习"><a href="#练习" class="headerlink" title="练习"></a>练习</h4><h5 id="1：下面的四种promise的区别时什么-来自we-have-a-problem-with-promise"><a href="#1：下面的四种promise的区别时什么-来自we-have-a-problem-with-promise" class="headerlink" title="1：下面的四种promise的区别时什么  (来自we have a problem with promise)"></a>1：下面的四种promise的区别时什么  (来自we have a problem with promise)</h5><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// #1</span>
<span class="token function">doSomething</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token function">doSomethingElse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>finalHandler<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// #2</span>
<span class="token function">doSomething</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token function">doSomethingElse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>finalHandler<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// #3</span>
<span class="token function">doSomething</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token function">doSomethingElse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>finalHandler<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// #4</span>
<span class="token function">doSomething</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>doSomethingElse<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>finalHandler<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>(1)doSomething()执行完成之后会执行doSomethingElse()，doSomethingElse()接收不到doSomething的返回结果，然后再继续往下执行<code>.then(finalHandler)</code>，finalHandler可以获取到doSomethingElse()中的返回结果。</p>
<pre class="line-numbers language-none"><code class="language-none">doSomething
|-----------------|
                  doSomethingElse(undefined)
                  |------------------|
                                     finalHandler(resultOfDoSomethingElse)
                                     |------------------|<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>(2)doSomething()执行完成之后会同时执行doSomethingElse()和下一步<code>.then(finalHandler)</code>,下一步中的<code>finalHandler</code>获取不到doSomethingElse()中的结果。</p>
<pre class="line-numbers language-none"><code class="language-none">doSomething
|-----------------|
                  doSomethingElse(undefined)
                  |------------------|
                  finalHandler(undefined)
                  |------------------|<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>(3)doSomething()和doSomethingElse()是同时执行的，<code>.then()</code>中传递的doSomethingElse是promise实例，然而后面第二个<code>.then()</code>只会处理doSomething()的返回结果，会忽略掉doSomethingElse()的执行结果。</p>
<pre class="line-numbers language-none"><code class="language-none">doSomething
|-----------------|
doSomethingElse(undefined)
|---------------------------------|
                  finalHandler(resultOfDoSomething)
                  |------------------|<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>(4)doSomething()会先执行，然后doSomethingElse()处理doSomething的返回结果，doSomethingElse()执行结束后下一个<code>.then()</code>再处理doSomethingElse()的返回结果。</p>
<pre class="line-numbers language-none"><code class="language-none">doSomething
|-----------------|
                  doSomethingElse(resultOfDoSomething)
                  |------------------|
                                     finalHandler(resultOfDoSomethingElse)
                                     |------------------|<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>*注意：永远都是往then()中传递函数</p>
<h5 id="2：promise调度"><a href="#2：promise调度" class="headerlink" title="2：promise调度"></a>2：promise调度</h5><p>一个Promise决议后，这个Promise上所有的通过then(…)注册的回调都会在下一个异步时机点上依次被立即调用。这些回调中的任意一个都无法影响或延误对其他回调的调用。</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">p<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    p<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'C'</span><span class="token punctuation">)</span> <span class="token comment">// C无法打断或抢占B</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'A'</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
p<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'B'</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token comment">// A B C</span>

<span class="token comment">// 两个独立Promise上链接的回调的相对顺序无法可靠预测</span>
<span class="token keyword">var</span> p3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'p3'</span><span class="token punctuation">)</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'B'</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span> <span class="token comment">// p3为已决议状态</span>

<span class="token keyword">var</span> p1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'p1'</span><span class="token punctuation">)</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span>p3<span class="token punctuation">)</span> <span class="token comment">// 调用p3已决议结果</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span> <span class="token comment">// p1为已决议状态</span>

<span class="token keyword">var</span> p2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'p2'</span><span class="token punctuation">)</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'A'</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span> <span class="token comment">// p2为已决议状态</span>

p1<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">v</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>

p2<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">v</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token comment">// p3</span>
<span class="token comment">// p1</span>
<span class="token comment">// p2</span>
<span class="token comment">// A</span>
<span class="token comment">// B</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h5 id="3：Promise辅助工具"><a href="#3：Promise辅助工具" class="headerlink" title="3：Promise辅助工具"></a>3：Promise辅助工具</h5><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// polyfill安全的guard检查</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>Promise<span class="token punctuation">.</span>wrap<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    Promise<span class="token punctuation">.</span><span class="token function-variable function">wrap</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">var</span> args <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>arguments<span class="token punctuation">)</span>
            <span class="token comment">// 返回的函数自动创建一个Promise并返回，并替换回调，连接到Promise完成或拒绝</span>
            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token function">fn</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>
                	<span class="token keyword">null</span><span class="token punctuation">,</span>
                    args<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> v</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">// error-first回调</span>
                        <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                            <span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
                        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
                            <span class="token function">resolve</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span>
                        <span class="token punctuation">&#125;</span>
                    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
                <span class="token punctuation">)</span>
            <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// ==================================================================</span>
<span class="token comment">// 使用</span>
<span class="token keyword">var</span> request <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">wrap</span><span class="token punctuation">(</span>ajax<span class="token punctuation">)</span> <span class="token comment">// ajax响应后就会产生一个Promise</span>
<span class="token function">request</span><span class="token punctuation">(</span><span class="token string">'http://some.url.1/'</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token operator">...</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>Promise.wrap(…)产出的是一个将产生Promise的函数，像Promise工厂。</p>
<p>把需要回调的函数封装为支持Promise的函数，可以称为Promise工厂化或提升。</p>
<h5 id="循环输出内容"><a href="#循环输出内容" class="headerlink" title="循环输出内容"></a>循环输出内容</h5><p>输出以下代码运行结果，为什么？如果希望每隔 1s 输出一个结果，应该如何改造？注意不可改动 square 方法</p>
<p>问题链接：<a href="https://github.com/Advanced-Frontend/Daily-Interview-Question/issues/389">https://github.com/Advanced-Frontend/Daily-Interview-Question/issues/389</a></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span>
<span class="token keyword">const</span> <span class="token function-variable function">square</span> <span class="token operator">=</span> <span class="token parameter">num</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span>num <span class="token operator">*</span> num<span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>forEach是不能阻塞的，默认是请求并行发起</p>
</blockquote>
<p>方法：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 方法一</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> list<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">let</span> x <span class="token operator">=</span> list<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
        <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">square</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 方法二</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> x <span class="token keyword">of</span> list<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">square</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 方法三</span>
<span class="token keyword">function</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token parameter">i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> promise <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">></span> list<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token keyword">return</span>
  promise <span class="token operator">=</span> promise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token function">square</span><span class="token punctuation">(</span>list<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
  <span class="token function">test</span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> promise<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h4 id="参考链接："><a href="#参考链接：" class="headerlink" title="参考链接："></a>参考链接：</h4><p>[翻译]We have a problem with promises：<a href="http://fex.baidu.com/blog/2015/07/we-have-a-problem-with-promises/">http://fex.baidu.com/blog/2015/07/we-have-a-problem-with-promises/</a></p>
<p>慕课网免费课程《Promise入门》</p>
<p>《你不知道的JavaScript(中卷)》第三章Promise: <a href="https://github.com/getify/You-Dont-Know-JS/blob/1ed-zh-CN/async%20%26%20performance/ch3.md">https://github.com/getify/You-Dont-Know-JS/blob/1ed-zh-CN/async%20%26%20performance/ch3.md</a></p>
<p>Promise A+： <a href="https://promisesaplus.com/">https://promisesaplus.com/</a></p>
<p>知乎-你不知道的permise：<a href="https://zhuanlan.zhihu.com/p/288384170">https://zhuanlan.zhihu.com/p/288384170</a></p>
]]></content>
      <categories>
        <category>前端</category>
        <category>基础</category>
      </categories>
      <tags>
        <tag>前端</tag>
        <tag>面试</tag>
        <tag>promise</tag>
        <tag>es6</tag>
      </tags>
  </entry>
  <entry>
    <title>基础系列-渐进式web应用PWA</title>
    <url>/posts/29356/</url>
    <content><![CDATA[<p>PWA应用是指那些<strong>使用指定技术和标准模式来开发的web应用</strong>，这将同时赋予它们web应用和原生应用的特性。</p>
<h3 id="特点"><a href="#特点" class="headerlink" title="特点"></a>特点</h3><ul>
<li><a href="https://developer.mozilla.org/en-US/Apps/Progressive/Advantages#Discoverable">Discoverable</a>, 内容可以通过搜索引擎发现。</li>
<li><a href="https://developer.mozilla.org/en-US/Apps/Progressive/Advantages#Installable">Installable</a>, 可以出现在设备的主屏幕。</li>
<li><a href="https://developer.mozilla.org/Apps/Progressive/Advantages#Linkable">Linkable</a>, 你可以简单地通过一个URL来分享它。 </li>
<li><a href="https://developer.mozilla.org/en-US/Apps/Progressive/Advantages#Network_independent">Network independent</a>, 它可以在离线状态或者是在网速很差的情况下运行。</li>
<li><a href="https://developer.mozilla.org/en-US/Apps/Progressive/Advantages#Progressive">Progressive</a>, 它在老版本的浏览器仍旧可以使用，在新版本的浏览器上可以使用全部功能。（渐进式）</li>
<li><a href="https://developer.mozilla.org/en-US/Apps/Progressive/Advantages#Re-engageable">Re-engageable</a>, 无论何时有新的内容它都可以发送通知。</li>
<li><a href="https://developer.mozilla.org/en-US/Apps/Progressive/Advantages#Responsive">Responsive</a>, 它在任何具有屏幕和浏览器的设备上可以正常使用——包括手机，平板电脑，笔记本，电视，冰箱，等。</li>
<li><a href="https://developer.mozilla.org/en-US/Apps/Progressive/Advantages#Safe">Safe</a>, 在你和应用之间的连接是安全的，可以阻止第三方访问你的敏感数据。</li>
</ul>
<h3 id="解决问题"><a href="#解决问题" class="headerlink" title="解决问题"></a>解决问题</h3><ul>
<li>可以添加至主屏幕，点击主屏幕图标可以实现启动动画以及隐藏地址栏；</li>
<li>实现离线缓存功能，即使用户手机没有网络，依然可以使用一些离线功能；</li>
<li>实现了消息推送；</li>
<li>等累死与 Native App相关的功能；</li>
</ul>
<h3 id="架构"><a href="#架构" class="headerlink" title="架构"></a>架构</h3><ul>
<li><p>服务器端渲染（SSR）</p>
</li>
<li><p>客户端渲染（CSR）</p>
</li>
</ul>
<p>将SSR与CSR混合可以获得最佳结果 - 您可以在服务器上渲染网站，缓存其内容，然后在客户端需要时更新渲染。 由于SSR，第一页加载很快，并且页面之间的导航是平滑的，因为客户端可以仅使用已更改的部分重新渲染页面。</p>
]]></content>
      <categories>
        <category>前端</category>
        <category>基础</category>
      </categories>
      <tags>
        <tag>前端</tag>
        <tag>基础</tag>
        <tag>pwa</tag>
      </tags>
  </entry>
  <entry>
    <title>基础系列-前端架构模式</title>
    <url>/posts/17715/</url>
    <content><![CDATA[<p>参考文章：</p>
<p><a href="https://www.kancloud.cn/lixianshengdezhanghao/interview/904696">MVC和MVVM的区别</a></p>
<p><a href="https://www.ruanyifeng.com/blog/2015/02/mvcmvp_mvvm.html">MVC，MVP 和 MVVM 的图示 - 阮一峰</a></p>
<p><a href="http://www.ruanyifeng.com/blog/2007/11/mvc.html">谈谈MVC模式 - 阮一峰</a></p>
<h3 id="MVC"><a href="#MVC" class="headerlink" title="MVC"></a>MVC</h3><p><img src="/posts/17715/mvc.jpg" alt="mvc"></p>
<p>M - Model - 数据层 - 最上层，直接面向用户，提供给用户操作界面</p>
<p>V - View - 视图层 - 最底层，程序需要操作的数据或信息</p>
<p>C - Controller - 控制层 - 根据用户从视图层输入的指令，选取数据层中的数据，然后进行相应的操作，产生最终结果</p>
<p><code>MVC</code>允许在不改变视图的情况下改变视图对用户输入的响应方式，用户对<code>View</code>的操作交给了<code>Controller</code>处理，在<code>Controller</code>中响应<code>View</code>的事件调用<code>Model</code>的接口对数据进行操作，一旦<code>Model</code>发生变化便通知相关视图进行更新。</p>
<p>所有通信都是<strong>单向</strong>的。</p>
<blockquote>
<p>最直接的感受就是Java中的<code>Strut2</code>框架使用，是典型的MVC架构。actions -&gt; service -&gt; dao</p>
<p>也有点像vuex的state、view、actions。state是数据源，view以声明的方式将state映射到视图，actions去更改数据</p>
</blockquote>
<h3 id="MVP"><a href="#MVP" class="headerlink" title="MVP"></a>MVP</h3><p><img src="/posts/17715/mvp.jpg" alt="mvp"></p>
<p>P -  Presenter - 主持人(直译) - 进行数据传递</p>
<p>各部分之间的通信，都是双向的。</p>
<p>View 与 Model 不发生联系，都通过 Presenter 传递。</p>
<p>View 非常薄，不部署任何业务逻辑，称为”被动视图”（Passive View），即没有任何主动性，而 Presenter非常厚，所有逻辑都部署在那里。</p>
<h3 id="MVVM"><a href="#MVVM" class="headerlink" title="MVVM"></a>MVVM</h3><p><img src="/posts/17715/mvvm.jpg" alt="mvvm"></p>
<blockquote>
<p>MVVM 模式将 Presenter 改名为 ViewModel，基本上与 MVP 模式完全一致。</p>
</blockquote>
<p>MVVM与MVP的唯一区别是：它采用双向绑定（data-binding）：View的变动，自动反映在 <code>ViewModel</code>。</p>
<p>MVVM与MVC最大的区别就是：它实现了View和Model的自动同步，也就是当Model的属性改变时，我们不用再自己手动操作Dom元素，来改变View的显示，而是改变属性后该属性对应View层显示会自动改变。（<em>vue是典型的mvvm</em>）</p>
<pre class="line-numbers language-vue" data-language="vue"><code class="language-vue">&lt;div id&#x3D;&quot;app-5&quot;&gt;
  &lt;p&gt;&#123;&#123; message &#125;&#125;&lt;&#x2F;p&gt;
  &lt;button v-on:click&#x3D;&quot;reverseMessage&quot;&gt;逆转消息&lt;&#x2F;button&gt;
&lt;&#x2F;div&gt;
var app5 &#x3D; new Vue(&#123;
  el: &#39;#app-5&#39;,
  data: &#123;
    message: &#39;Hello Vue.js!&#39;
  &#125;,
  methods: &#123;
    reverseMessage: function () &#123;
      this.message &#x3D; this.message.split(&#39;&#39;).reverse().join(&#39;&#39;)
    &#125;
  &#125;
&#125;)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>在vue中：</p>
<p>html部分相当于View层，View通过通过模板语法(<code>&#123;&#123; 表达式 &#125;&#125;</code>)来声明式的将数据渲染进DOM元素，当ViewModel对Model进行更新时，通过数据绑定更新到View。</p>
<p>Vue实例中的data相当于Model层，而ViewModel层的核心是Vue中的双向数据绑定，即Model变化时VIew可以实时更新，View变化也能让Model发生变化。</p>
<p>整体看来，MVVM比MVC精简很多，不仅简化了业务与界面的依赖，还解决了数据频繁更新的问题，不用再用选择器操作DOM元素。因为在MVVM中，View不知道Model的存在，Model和ViewModel也观察不到View，这种<strong>低耦合模式提高代码的可重用性</strong>。</p>
<h3 id="BFF（Backends-For-Frontends-服务于前端的后端）"><a href="#BFF（Backends-For-Frontends-服务于前端的后端）" class="headerlink" title="BFF（Backends For Frontends 服务于前端的后端）"></a>BFF（Backends For Frontends 服务于前端的后端）</h3><p>参考文章： <a href="https://segmentfault.com/a/1190000009558309">了解BFF架构</a></p>
<p>BFF就是服务器设计API时会考虑到不同设备的需求，也就是为不同的设备提供不同的API接口，虽然它们可能是实现相同的功能，但因为不同设备的特殊性，它们对服务端的API访问也各有其特点，需要区别处理。</p>
<p><img src="/%E5%9F%BA%E7%A1%80%E7%B3%BB%E5%88%97-%E5%89%8D%E7%AB%AF%E6%9E%B6%E6%9E%84%E6%A8%A1%E5%BC%8F/BFF.png" alt="BFF"></p>
<p>流程：如客户端都不是直接访问服务器的公共接口，而是调用BFF层提供的接口，BFF层再调用基层的公共服务，不同的客户端拥有不同的BFF层，它们定制客户端需要的API。这个需要根据现实情况决定，不同的项目环境解决手段不一样。</p>
<p>优点：</p>
<ul>
<li>能过够满足因不同客服端特殊的交互引起的对新接口的要求。可以避免在原来的接口上进行修改，避免破坏单一职责。</li>
<li>当由于某一客户端需要调用多个不同的服务端接口来实现某一功能是，可以直接在对应的BFF层编写相应的API，而不会影响到基层的公共服务，且客户端不用直接向多个后台发起调用，可以优化性能。</li>
</ul>
<p>缺点：</p>
<ul>
<li>代码重复</li>
<li>加大工作量</li>
</ul>
<h3 id="整洁前端架构"><a href="#整洁前端架构" class="headerlink" title="整洁前端架构"></a>整洁前端架构</h3><p>阅读文章：</p>
<p><a href="https://phodal.github.io/clean-frontend/#clean-frontend-architecture%EF%BC%9A%E6%95%B4%E6%B4%81%E5%89%8D%E7%AB%AF%E6%9E%B6%E6%9E%84">Clean Frontend Architecture：整洁前端架构</a></p>
<p><a href="https://segmentfault.com/a/1190000039044292">DDD分层架构最佳实践</a></p>
]]></content>
      <categories>
        <category>前端</category>
        <category>基础</category>
      </categories>
      <tags>
        <tag>前端</tag>
        <tag>面试</tag>
        <tag>架构</tag>
        <tag>MVC</tag>
        <tag>MVVM</tag>
      </tags>
  </entry>
  <entry>
    <title>基础系列-垃圾回收机制</title>
    <url>/posts/9396/</url>
    <content><![CDATA[<h3 id="垃圾回收"><a href="#垃圾回收" class="headerlink" title="垃圾回收"></a>垃圾回收</h3><p>执行环境负责代码执行时管理内存。</p>
<p>通过自动内存管理实现内存分配和闲置资源回收。</p>
<p><strong>基本思路：确定哪个变量不会再使用，然后释放它占用的内存。</strong>这个过程是周期性的，即垃圾回收程序每隔一定时间（或者说在代码执行过程中某个预定的收集时间）就会自动执行。</p>
<p>以函数中局部变量的正常生命周期为例。函数中的局部变量会在函数执行时存在。此时，栈（或堆）内存会分配空间以保存先相应的值。函数在内部使用了变量，然后退出。此时，就不再需要那个局部变量了，它占用的内存可以释放，供后面使用。</p>
<h4 id="垃圾回收标记策略"><a href="#垃圾回收标记策略" class="headerlink" title="垃圾回收标记策略"></a>垃圾回收标记策略</h4><h5 id="标记请理"><a href="#标记请理" class="headerlink" title="标记请理"></a>标记请理</h5><p>最常用。</p>
<p>垃圾回收程序运行时，</p>
<ol>
<li>会标记内存中存储的所有变量</li>
<li>会将在所有上下文中的变量（全局变量），以及被在上下文中的变量引用的变量的标记去掉。</li>
<li>在此之后被加上的标记的变量就是待删除的（任何在上下文中的变量都访问不到它们了）。</li>
<li>垃圾回收器完成内存清除工作，销毁那些带标记的值并回收它们所占用的内存空间。</li>
</ol>
<blockquote>
<p>当变量进入上下文时，这个变量会被加上存在于上下文中的标记。</p>
<p>当变量离开上下文时，会被家上离开上下文的标记。</p>
</blockquote>
<h5 id="引用计数"><a href="#引用计数" class="headerlink" title="引用计数"></a>引用计数</h5><p>跟踪记录每个值被引用的次数。</p>
<p>当声明了一个变量并将一个引用类型的值赋值给该变量时，则这个值得引用次数就是1。如果同一个值又被赋给另一个变量，则该值的引用次数加1。</p>
<p>如果包含对这个值引用的变量又取得另外一个值，则这个值的引用次数减1。</p>
<p>当这个值的引用次数变成0时，则说明没有办法再访问这个值了，因而就可以将其占用的内存空间回收回来。</p>
<p><strong>存在的问题</strong>：循环引用（对象A有个指针指向对象B，对象B也引用了对象A）</p>
<h4 id="管理内存"><a href="#管理内存" class="headerlink" title="管理内存"></a>管理内存</h4><p>内存限制目的是防止运行 JavaScript 的网页耗尽全部系统内存而导致系统崩溃。</p>
<p>内存限制问题不仅会影响给变量分配内存，同时还会影响调用栈以及在一个线程中能够同时执行的语句数量。</p>
<h5 id="优化占用内存的最佳方式"><a href="#优化占用内存的最佳方式" class="headerlink" title="优化占用内存的最佳方式"></a>优化占用内存的最佳方式</h5><p>为执行中的代码只保存必要的数据。</p>
<p>一旦数据不再有用，最好通过将其值设置为 null 来释放引用（解除引用）</p>
<p>这个做法适用于大多数全局变量和全局对象的属性。局部变量会在它们离开执行环境时自动被解除引用。</p>
<p>解除引用的真正作用是让值脱离执行环境，以便垃圾收集器下次运行时将其回收。（不是立即回收）</p>
]]></content>
      <categories>
        <category>前端</category>
        <category>基础</category>
      </categories>
      <tags>
        <tag>垃圾回收机制</tag>
      </tags>
  </entry>
  <entry>
    <title>基础系列-理论概念</title>
    <url>/posts/f71c32be/</url>
    <content><![CDATA[<p>1</p>
<p>执行环境：执行环境定义了变量或函数有权访问的其他数据，决定了它们各自的行为。全局执行环境被认为是 window 对象。</p>
<p>执行栈：每个函数都有自己的执行环境。当执行流进入一个函数时，函数的环境就会被推入一个环境栈中。而在函数执行之后，栈将其环境弹出，把控制权返回给之前的执行环境。</p>
<p>作用域：</p>
<p>作用域链：本质上是一个指向变量对象的指针列表，它只引用但不实际包含对象。</p>
<p>活动对象：</p>
<p>变量对象：每个执行环境都有一个与之关联的变量对象，韩晶中定义的所有变量和函数都保存在这个对象中。</p>
]]></content>
      <categories>
        <category>前端</category>
        <category>基础</category>
      </categories>
      <tags>
        <tag>前端</tag>
        <tag>理论概念</tag>
      </tags>
  </entry>
  <entry>
    <title>扩展系列-图片格式</title>
    <url>/posts/f7ddfdff/</url>
    <content><![CDATA[<h3 id="静态图片格式"><a href="#静态图片格式" class="headerlink" title="静态图片格式"></a>静态图片格式</h3><h4 id="JPG-JEPG"><a href="#JPG-JEPG" class="headerlink" title="JPG / JEPG"></a>JPG / JEPG</h4><h4 id="PNG"><a href="#PNG" class="headerlink" title="PNG"></a>PNG</h4><h4 id="WEBP"><a href="#WEBP" class="headerlink" title="WEBP"></a>WEBP</h4><h3 id="动态图片格式-方案"><a href="#动态图片格式-方案" class="headerlink" title="动态图片格式 / 方案"></a>动态图片格式 / 方案</h3><h4 id="GIF"><a href="#GIF" class="headerlink" title="GIF"></a>GIF</h4><h4 id="APNG"><a href="#APNG" class="headerlink" title="APNG"></a>APNG</h4><p>APNG是Mozilla在2004年推出的动图图片格式，是PNG的扩展，第一帧储存方式和普通的 PNG 一样在 IDAT 区段中，APNG 只是新增了三种区段：<br>ACTL (animation control) 用来存放帧数和播放次数，整个文件只有一个区段<br>FCTL (frame control) 用来存放每一帧的高、宽、位置、延时等信息，每一帧一个区段<br>FDAT (frame data) 用来存放除了第一帧以外后面每一帧的图片数据，采用 Deflate 压缩，每一帧一个区段</p>
<h5 id="优势"><a href="#优势" class="headerlink" title="优势"></a>优势</h5><p>1.支持全彩和透明，可容纳的颜色种类远远多出256种（实际上是1680万种颜色），更细腻、真实；<br>2.向下兼容PNG，不支持就会显示png格式；<br>3.压缩率高于GIF，同等位下，APNG的体积小于GIF动图；</p>
<p>具体的对比效果见：<a href="http://littlesvr.ca/apng/gif_vs_apng.html">http://littlesvr.ca/apng/gif_vs_apng.html</a></p>
<p>参考链接：<a href="https://course.51qux.com/1874.html">https://course.51qux.com/1874.html</a></p>
<h4 id="Lottie"><a href="#Lottie" class="headerlink" title="Lottie"></a><a href="http://airbnb.io/lottie/">Lottie</a></h4><blockquote>
<p>动效制作方案：一种是帧动画，以逐帧的方式来播放动画；第二种是骨骼动画，基于一套基础的骨架，来播放动画；然后是 Lottie 动画。</p>
<p><a href="http://zh.esotericsoftware.com/spine-in-depth#Spine">Spine</a> 是一款针对游戏开发的 2D 骨骼动画编辑工具。 Spine 旨在提供更高效和简洁 的工作流程，以创建游戏所需的动画。</p>
</blockquote>
]]></content>
      <categories>
        <category>扩展</category>
        <category>图片</category>
      </categories>
      <tags>
        <tag>图片格式</tag>
        <tag>apng</tag>
        <tag>webp</tag>
      </tags>
  </entry>
</search>
